<html>
<head>
<title>How to Fully Cover .NET C# Console Application With Unit Tests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何全面覆盖。带有单元测试的. NET C#控制台应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-fully-cover-net-c-console-application-with-unit-tests-446927a4a793?source=collection_archive---------1-----------------------#2021-11-06">https://itnext.io/how-to-fully-cover-net-c-console-application-with-unit-tests-446927a4a793?source=collection_archive---------1-----------------------#2021-11-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="110f" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">单元测试</h2><div class=""/><div class=""><h2 id="636a" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用测试驱动开发(TDD)、依赖注入(DI)、控制反转(IoC)和IoC容器实现100%覆盖率的最佳实践。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/88111a062170f8284cf8179a1cdad6dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nHnTjZPRza97euuLBP7wIw.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@anniespratt?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">安妮·斯普拉特</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄，由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>修改</figcaption></figure><p id="14e6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我的一些同事抱怨说，有时他们不能应用TDD或者为一些模块或应用程序编写单元测试，控制台应用程序<strong class="lk jd">就是其中之一。</strong></p><p id="6a36" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当输入通过按键传递，输出显示在屏幕上时，我该如何测试控制台应用程序？！！</p><p id="430f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">实际上，这种情况时有发生，你会发现自己试图为一些你似乎无法控制的事情编写单元测试。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><div class="ks kt ku kv gt ml"><a href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener follow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">订阅艾哈迈德的时事通讯？</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">订阅艾哈迈德的时事通讯📰直接获得最佳实践、教程、提示、技巧和许多其他很酷的东西…</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">medium.com</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz lb ml"/></div></div></a></div></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi na"><img src="../Images/091a9a43126df3ef29cb3f1b46b1916c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PaECSwmTkaYBZ0nayKwA1w.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae lh" href="https://unsplash.com/@sxy_selia?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">sanga Rima Roman Selia</a>拍摄</figcaption></figure><h1 id="0e8a" class="nb nc it bd nd ne nf ng nh ni nj nk nl ki nm kj nn kl no km np ko nq kp nr ns bi translated">误解</h1><p id="c9dd" class="pw-post-body-paragraph li lj it lk b ll nt kd ln lo nu kg lq lr nv lt lu lv nw lx ly lz nx mb mc md im bi translated">事实是，你没抓住重点。你不需要测试“控制台”应用，你要测试的是它背后的<strong class="lk jd">业务逻辑</strong>。</p><p id="4795" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当你在构建一个控制台应用的时候，你在构建一个给某人使用的应用，他期望传递一些输入并得到一些相应的输出，<strong class="lk jd">而这才是你真正需要测试的</strong>。</p><p id="5616" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您不想测试<code class="fe ny nz oa ob b">System.Console</code>静态类，这是一个内置类，包含在。NET框架，在这一点上你必须信任微软。</p><p id="2fa5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，您需要考虑如何将这两个领域分成单独的组件或模块，这样您就可以开始为您想要的一个编写测试，而不会干扰另一个，这就是我要向您解释的…</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oc"><img src="../Images/2c8177a9bebc93e3abbd7dd9f2b162b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AgHClKqVbgWRiCV8Z_pi0A.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">马克·弗莱彻·布朗在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="f36d" class="nb nc it bd nd ne nf ng nh ni nj nk nl ki nm kj nn kl no km np ko nq kp nr ns bi translated">这个想法</h1><p id="4e23" class="pw-post-body-paragraph li lj it lk b ll nt kd ln lo nu kg lq lr nv lt lu lv nw lx ly lz nx mb mc md im bi translated">首先，让我们想出一个愚蠢的简单的控制台应用程序的想法，并将其作为一个例子来应用。</p><p id="4453" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，你有这个简单的菜单。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi od"><img src="../Images/dbe041a697a48ef4dce47bec4b091b38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3MrI-qiGXfnFdWn5fcZRmw.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener"> Ahmed Tarek </a></figcaption></figure><p id="9a9d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当您选择选项<strong class="lk jd"> 1 </strong>并输入<strong class="lk jd">您的姓名</strong>时，您会得到如下图所示的<strong class="lk jd"> Hello </strong>消息。按回车键将关闭应用程序。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi od"><img src="../Images/9741d27e0c4926975ce9e9691af65dd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gFDRzidIUKj5RnyvwtdsVg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</figcaption></figure><p id="21d7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当您选择选项<strong class="lk jd"> 2 </strong>并输入<strong class="lk jd">您的姓名</strong>时，您会得到如下图所示的<strong class="lk jd">再见</strong>消息。按回车键将关闭应用程序。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi od"><img src="../Images/738ba78a75503d07f27d8424b66d8f5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6wqoulRItETsllWvMwTwiQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</figcaption></figure><p id="4e8b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">太简单了吧？是的，我同意你。然而，让我们假设UI、字符串、字符和你在屏幕上看到的一切都是需求的一部分。</p><p id="c6c9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这意味着，如果您要编写单元测试，这也应该以一种方式来涵盖，即产品代码中单个字符的微小变化应该会触发失败的单元测试。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oe"><img src="../Images/a1eabe2dec96ff93cea19f9ea3bf6f10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d8jiYApqes7FvB8LxxzliA.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@brett_jordan?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">布雷特·乔丹</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h2 id="4c69" class="of nc it bd nd og oh dn nh oi oj dp nl lr ok ol nn lv om on np lz oo op nr iz bi translated">这是我们的计划:</h2><ol class=""><li id="a134" class="oq or it lk b ll nt lo nu lr os lv ot lz ou md ov ow ox oy bi translated">以传统的糟糕方式构建控制台应用程序。</li><li id="e340" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">看看我们能不能写出自动化的单元测试。</li><li id="e9a0" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">以良好的方式重新实现控制台应用程序。</li><li id="8f75" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">写一些单元测试。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pe"><img src="../Images/6c6c8a4a8805057dc43d2cc3fe2b94c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KpfR6fnFnClOYPEiu1IojQ.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@messrro?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">迈赫迪</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="f598" class="nb nc it bd nd ne nf ng nh ni nj nk nl ki nm kj nn kl no km np ko nq kp nr ns bi translated">不好的方式</h1><p id="79ee" class="pw-post-body-paragraph li lj it lk b ll nt kd ln lo nu kg lq lr nv lt lu lv nw lx ly lz nx mb mc md im bi translated">简单地说，在一个地方做所有的事情。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pf pg l"/></div></figure><p id="8f00" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们在这里可以注意到:</p><ol class=""><li id="e32d" class="oq or it lk b ll lm lo lp lr ph lv pi lz pj md ov ow ox oy bi translated">一切都在一个地方。</li><li id="92ec" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">我们直接使用静态的<code class="fe ny nz oa ob b">System.Console</code>类。</li><li id="8cfc" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">不撞上<code class="fe ny nz oa ob b">System.Console</code>就无法测试业务逻辑。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oe"><img src="../Images/b5776995406efeaf8e011a34569acad6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KtZXc1rR-zF9aqx6Q-63Nw.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@brett_jordan?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">布雷特·乔丹</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="197a" class="nb nc it bd nd ne nf ng nh ni nj nk nl ki nm kj nn kl no km np ko nq kp nr ns bi translated">尝试编写单元测试</h1><p id="3cd6" class="pw-post-body-paragraph li lj it lk b ll nt kd ln lo nu kg lq lr nv lt lu lv nw lx ly lz nx mb mc md im bi translated">真的吗？您真的希望能够为该代码编写单元测试吗？</p><h2 id="c886" class="of nc it bd nd og oh dn nh oi oj dp nl lr ok ol nn lv om on np lz oo op nr iz bi translated">挑战如下:</h2><ol class=""><li id="0bc3" class="oq or it lk b ll nt lo nu lr os lv ot lz ou md ov ow ox oy bi translated">依赖于像<code class="fe ny nz oa ob b">System.Console</code>这样的静态类。</li><li id="1ad9" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">无法定义和隔离依赖关系。</li><li id="2d13" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">不能用模仿或存根替换依赖关系。</li></ol><p id="80cc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你能为此做些什么，你就是一个英雄…相信我。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pk"><img src="../Images/f3d79bf02868e5233324a3fa5b753638.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XDwbQ9zGjbFJS2t-wMf5Jg.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@volkanolmez?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">沃尔坎·奥尔梅斯</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="eb57" class="nb nc it bd nd ne nf ng nh ni nj nk nl ki nm kj nn kl no km np ko nq kp nr ns bi translated">好方法</h1><p id="987a" class="pw-post-body-paragraph li lj it lk b ll nt kd ln lo nu kg lq lr nv lt lu lv nw lx ly lz nx mb mc md im bi translated">现在，让我们将我们的解决方案分成更小的模块。</p><h2 id="6252" class="of nc it bd nd og oh dn nh oi oj dp nl lr ok ol nn lv om on np lz oo op nr iz bi translated">控制台管理器</h2><p id="108b" class="pw-post-body-paragraph li lj it lk b ll nt kd ln lo nu kg lq lr nv lt lu lv nw lx ly lz nx mb mc md im bi translated">这是负责从控制台提供我们需要的功能的模块…任何控制台。</p><p id="29fb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">该模块将由两部分组成。抽象概念。<br/> 2。实现。</p><p id="28f7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，我们将有以下内容:</p><ol class=""><li id="49b6" class="oq or it lk b ll lm lo lp lr ph lv pi lz pj md ov ow ox oy bi translated">这是定义我们对任何控制台管理器的期望的界面。</li><li id="c073" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated"><code class="fe ny nz oa ob b">ConsoleManagerBase</code>:这是实现<code class="fe ny nz oa ob b">IConsoleManager</code>的抽象类，提供所有控制台管理器之间的任何通用实现。</li><li id="4f3a" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated"><code class="fe ny nz oa ob b">ConsoleManager</code>:这是默认的控制台管理器实现，它包装了<code class="fe ny nz oa ob b">System.Console</code>，实际上在运行时使用。</li></ol><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pf pg l"/></div></figure><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pf pg l"/></div></figure><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pf pg l"/></div></figure><p id="d69d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们在这里可以注意到:</p><ol class=""><li id="2129" class="oq or it lk b ll lm lo lp lr ph lv pi lz pj md ov ow ox oy bi translated">现在我们有了<code class="fe ny nz oa ob b">IConsoleManager</code>。</li><li id="c4cd" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">在编写单元测试时，我们可以使用Mocks和Stubs来代替<code class="fe ny nz oa ob b">IConsoleManager</code>。</li><li id="833d" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">对于通用基类<code class="fe ny nz oa ob b">ConsoleManagerBase</code>，我们没有提供任何通用实现供孩子使用。</li><li id="32b0" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">我知道这不是最好的做法，但是，我这样做只是为了提醒你，这个选项是存在的，你可以在任何需要的时候使用它。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="eaf4" class="of nc it bd nd og oh dn nh oi oj dp nl lr ok ol nn lv om on np lz oo op nr iz bi translated">程序管理器</h2><p id="e3d1" class="pw-post-body-paragraph li lj it lk b ll nt kd ln lo nu kg lq lr nv lt lu lv nw lx ly lz nx mb mc md im bi translated">这是负责提供主要应用程序功能的模块。</p><p id="d1be" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这个模块将由两部分组成:<br/> 1。抽象概念。<br/> 2。实现。</p><p id="0130" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，我们将有以下内容:</p><ol class=""><li id="927c" class="oq or it lk b ll lm lo lp lr ph lv pi lz pj md ov ow ox oy bi translated">这是定义我们对任何项目经理的期望的界面。</li><li id="16de" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated"><code class="fe ny nz oa ob b">ProgramManagerBase</code>:这是实现<code class="fe ny nz oa ob b">IProgramManager</code>的抽象类，提供所有程序管理器之间的任何公共实现。</li><li id="0b6c" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated"><code class="fe ny nz oa ob b">ProgramManager</code>:这是运行时实际使用的默认程序管理器实现。这也要看<code class="fe ny nz oa ob b">IConsoleManager</code>了。</li></ol><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pf pg l"/></div></figure><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pf pg l"/></div></figure><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pf pg l"/></div></figure><p id="d77e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们在这里可以注意到:</p><ol class=""><li id="a915" class="oq or it lk b ll lm lo lp lr ph lv pi lz pj md ov ow ox oy bi translated">现在我们已经很好地定义了<code class="fe ny nz oa ob b">ProgramManager</code>对<code class="fe ny nz oa ob b">IConsoleManager</code>的依赖关系。</li><li id="fa03" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">我们有<code class="fe ny nz oa ob b">IProgramManager</code>,在编写单元测试时，我们可以使用mocks和stubs来代替<code class="fe ny nz oa ob b">IProgramManager</code>。</li><li id="411a" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">对于通用基类<code class="fe ny nz oa ob b">ProgramManagerBase</code>,我们没有提供任何通用实现供孩子使用。</li><li id="e77c" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">我知道这不是最好的做法，但是，我这样做只是为了提醒你，这个选项是存在的，你可以在任何需要的时候使用它。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pl"><img src="../Images/c9ad562fbc40843503a836d1858df4c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5LyVzWeYt6_EAOd1.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@gohrhyyan?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Goh Rhy Yan </a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="6b7c" class="nb nc it bd nd ne nf ng nh ni nj nk nl ki nm kj nn kl no km np ko nq kp nr ns bi translated">放弃</h1><p id="8de1" class="pw-post-body-paragraph li lj it lk b ll nt kd ln lo nu kg lq lr nv lt lu lv nw lx ly lz nx mb mc md im bi translated"><code class="fe ny nz oa ob b">ProgramManager</code>级可以分成更小的部分。这将使跟踪和覆盖单元测试变得更加容易。然而，这是我留给你去做的事情。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="46a1" class="nb nc it bd nd ne pm ng nh ni pn nk nl ki po kj nn kl pp km np ko pq kp nr ns bi translated">控制台应用程序</h1><p id="db4b" class="pw-post-body-paragraph li lj it lk b ll nt kd ln lo nu kg lq lr nv lt lu lv nw lx ly lz nx mb mc md im bi translated">这是主要应用。</p><p id="098b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里我们将使用<a class="ae lh" href="http://www.ninject.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd"> Ninject </strong> </a>作为我们的IoC容器。它使用简单，你可以随时查看他们的在线文档。</p><p id="aea8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在主控制台应用程序项目上，我们将创建<code class="fe ny nz oa ob b">NinjectDependencyResolver.cs</code>文件。该文件如下所示。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pf pg l"/></div></figure><p id="09b2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们在这里可以注意到:</p><ol class=""><li id="a1ab" class="oq or it lk b ll lm lo lp lr ph lv pi lz pj md ov ow ox oy bi translated"><code class="fe ny nz oa ob b">NinjectDependencyResolver</code>类继承了<code class="fe ny nz oa ob b">NinjectModule</code>。</li><li id="3963" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">我们正在覆盖<code class="fe ny nz oa ob b">void Load()</code>方法，在这里我们按照预期设置我们的绑定。</li></ol><p id="9a62" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，在<code class="fe ny nz oa ob b">Program.cs</code>上:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pf pg l"/></div></figure><p id="ad2c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们在这里可以注意到:</p><ol class=""><li id="76bb" class="oq or it lk b ll lm lo lp lr ph lv pi lz pj md ov ow ox oy bi translated">我们就靠<code class="fe ny nz oa ob b">IProgramManager</code>了。</li><li id="3255" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">我们通过<code class="fe ny nz oa ob b">var kernel = new StandardKernel();</code>创建了IoC容器。</li><li id="1640" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">然后我们通过<code class="fe ny nz oa ob b">kernel.Load(Assembly.GetExecutingAssembly());</code>将依赖关系加载到IoC容器中。这指示Ninject从当前程序集/项目中继承<code class="fe ny nz oa ob b">NinjectModule</code>的所有类中获取其绑定。</li><li id="992c" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">这意味着绑定将来自我们的<code class="fe ny nz oa ob b">NinjectDependencyResolver</code>类，因为它继承了<code class="fe ny nz oa ob b">NinjectModule</code>并位于当前的程序集/项目中。</li><li id="7422" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">为了获得<code class="fe ny nz oa ob b">IProgramManager</code>的实例，我们使用IoC容器，如下所示<code class="fe ny nz oa ob b">kernel.Get&lt;IProgramManager&gt;();</code>。</li></ol><p id="b3ba" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，让我们看看这个设计和我们到目前为止所做的工作是否已经解决了我们的问题。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pr"><img src="../Images/c4709ecb92a63cf32cd3381344fa62fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HxHoLEPKokFwd0_NMVnXUQ.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@markuswinkler?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">马库斯·温克勒</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="ebd2" class="nb nc it bd nd ne nf ng nh ni nj nk nl ki nm kj nn kl no km np ko nq kp nr ns bi translated">斗牛中的最后一剑</h1><p id="88bb" class="pw-post-body-paragraph li lj it lk b ll nt kd ln lo nu kg lq lr nv lt lu lv nw lx ly lz nx mb mc md im bi translated">所以，现在的问题是，我们能用单元测试覆盖我们的控制台应用程序吗？为了回答这个问题，让我们试着写一些单元测试…</p><h2 id="5697" class="of nc it bd nd og oh dn nh oi oj dp nl lr ok ol nn lv om on np lz oo op nr iz bi translated">存根或模拟</h2><p id="edfc" class="pw-post-body-paragraph li lj it lk b ll nt kd ln lo nu kg lq lr nv lt lu lv nw lx ly lz nx mb mc md im bi translated">如果你有一些单元测试的经验，你应该知道我们有存根和模拟来代替我们的依赖。</p><p id="9402" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">只是为了好玩，我在这里的例子中使用存根。</p><p id="94c1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，我将把<code class="fe ny nz oa ob b">ConsoleManagerStub</code>定义为<code class="fe ny nz oa ob b">IConsoleManager</code>的存根，如下所示:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pf pg l"/></div></figure><p id="c21e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，单元测试如下:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pf pg l"/></div></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ps"><img src="../Images/291d4c6f0fa5bb62824f78f7f2616cdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4iIjXejyHWprUcw3LWqqiw.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@itscakefortea?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">大卫·格里菲斯</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="5da6" class="nb nc it bd nd ne nf ng nh ni nj nk nl ki nm kj nn kl no km np ko nq kp nr ns bi translated">最后</h1><p id="5180" class="pw-post-body-paragraph li lj it lk b ll nt kd ln lo nu kg lq lr nv lt lu lv nw lx ly lz nx mb mc md im bi translated">现在我们已经能够用单元测试覆盖我们的控制台应用程序。然而，您可能认为这对于像我们这里这样的简单应用程序来说太多了。这不是矫枉过正吗？</p><p id="0eaf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">其实要看你想覆盖什么。例如，在我们的简单应用程序中，我将UI上的每个字符都作为单元测试应该涵盖的需求来处理。所以，如果你改变了主实现的一个字符，单元测试就会失败。</p><p id="c619" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">也许你的情况会有所不同。然而，即使是最小的字符，你知道如何做也总是好的。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="78cf" class="nb nc it bd nd ne pm ng nh ni pn nk nl ki po kj nn kl pp km np ko pq kp nr ns bi translated">希望这些内容对你有用。如果您想支持:</h1><p id="f11e" class="pw-post-body-paragraph li lj it lk b ll nt kd ln lo nu kg lq lr nv lt lu lv nw lx ly lz nx mb mc md im bi translated">如果您还不是<strong class="lk jd">中</strong>会员，您可以使用<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek/membership" rel="noopener"> <strong class="lk jd">我的推荐链接</strong> </a>，这样我就可以从<strong class="lk jd">中</strong>获得您的一部分费用，您无需支付任何额外费用。订阅<a class="ae lh" href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener"> <strong class="lk jd">我的简讯</strong> </a>将最佳实践、教程、提示、技巧和许多其他有趣的东西直接发送到您的收件箱。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="22d9" class="nb nc it bd nd ne pm ng nh ni pn nk nl ki po kj nn kl pp km np ko pq kp nr ns bi translated">其他资源</h1><p id="1b95" class="pw-post-body-paragraph li lj it lk b ll nt kd ln lo nu kg lq lr nv lt lu lv nw lx ly lz nx mb mc md im bi translated">还有其他有用的资源，你可能会感兴趣。</p><div class="pt pu gp gr pv ml"><a href="https://levelup.gitconnected.com/covariance-and-contravariance-in-net-c-c2b8576b2155" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">中的协方差和逆变。NET C#</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">很难理解吗？让我为你简化它。</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mu l"><div class="pw l mw mx my mu mz lb ml"/></div></div></a></div><div class="pt pu gp gr pv ml"><a href="https://levelup.gitconnected.com/a-best-practice-for-designing-interfaces-in-net-c-2c6ebdb4f1c1" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">中设计界面的最佳实践。NET C#</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">定义imi interface<t>够了吗？我也需要IMyInterface吗？</t></h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mu l"><div class="px l mw mx my mu mz lb ml"/></div></div></a></div><div class="pt pu gp gr pv ml"><a href="https://levelup.gitconnected.com/paging-partitioning-main-equations-to-make-it-easy-44fe89d5290b" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">分页/分区—简化这一过程的主要等式</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">最后，这是您理解分页/分区主要等式并学习如何在代码中应用它们的机会。</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mu l"><div class="py l mw mx my mu mz lb ml"/></div></div></a></div><p id="3d31" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">就这样，希望你觉得读这个故事和我写它一样有趣。</p></div></div>    
</body>
</html>