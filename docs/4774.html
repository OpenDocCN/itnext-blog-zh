<html>
<head>
<title>PySpark ETL from MySQL and MongoDB to Cassandra</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从MySQL和MongoDB到Cassandra的PySpark ETL</h1>
<blockquote>原文：<a href="https://itnext.io/pyspark-etl-from-mysql-and-mongodb-to-cassandra-964a5effc5e5?source=collection_archive---------1-----------------------#2020-09-14">https://itnext.io/pyspark-etl-from-mysql-and-mongodb-to-cassandra-964a5effc5e5?source=collection_archive---------1-----------------------#2020-09-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/75a09271adb41e03bfddf3e8da14e572.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VadkDiUcZ7uMgil2.jpg"/></div></div></figure><div class=""/><p id="fabd" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在Apache Spark/PySpark中，我们使用抽象，只有当我们想要具体化操作的结果时，才进行实际的处理。为了连接到不同的数据库和文件系统，我们通常使用现成的库。在这个故事中，您将学习如何将数据与MySQL和MongoDB结合起来，然后将其保存在Apache Cassandra中。</p><h1 id="0291" class="kz la je bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">环境</h1><p id="8ca0" class="pw-post-body-paragraph kb kc je kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">使用Docker，或者更准确地说是Docker Compose的理想时机。我们将使用Apache Spark运行所有数据库和Jupyter。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="a534" class="ml la je mh b gy mm mn l mo mp"># Use root/example as user/password credentials<br/>version: '3.1'<br/><br/>services:<br/>  notebook:<br/>    image: jupyter/all-spark-notebook<br/>    ports:<br/>      - 8888:8888<br/>      - 4040:4040<br/>    volumes:<br/>      - ./work:/home/jovyan/work<br/><br/>  cassandra:<br/>    image: 'bitnami/cassandra:latest'<br/><br/>  mongo:<br/>    image: mongo<br/>    environment:<br/>      MONGO_INITDB_ROOT_USERNAME: root<br/>      MONGO_INITDB_ROOT_PASSWORD: example<br/><br/>  mysql:<br/>    image: mysql:5.7<br/>    environment:<br/>      MYSQL_DATABASE: 'school'<br/>      MYSQL_USER: 'user'<br/>      MYSQL_PASSWORD: 'password'<br/>      MYSQL_ROOT_PASSWORD: 'password'</span></pre><h1 id="2758" class="kz la je bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">向MongoDB添加数据</h1><p id="679b" class="pw-post-body-paragraph kb kc je kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我们需要一些数据。我用Python写了一个简单的脚本。我们假设Mongo里有学生的数据。</p><figure class="mc md me mf gt iv"><div class="bz fp l di"><div class="mq mr l"/></div></figure><h1 id="7d94" class="kz la je bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">向MySQL添加数据</h1><p id="7696" class="pw-post-body-paragraph kb kc je kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">在MySQL中，我们有一个包含组的字典表。我们需要创建一个表并向其中添加数据。</p><figure class="mc md me mf gt iv"><div class="bz fp l di"><div class="mq mr l"/></div></figure><h1 id="da1d" class="kz la je bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">在Cassandra中创建模式</h1><p id="ae23" class="pw-post-body-paragraph kb kc je kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">如果我们想上传数据到Cassandra，我们需要创建一个keyspace和一个相应的表。Cassandra在Docker中，所以我们必须进去运行cqlsh。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="b128" class="ml la je mh b gy mm mn l mo mp">sudo docker exec -it simple-spark-etl_cassandra_1 bash<br/>cqlsh --user cassandra --password cassandra</span></pre><p id="2fad" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后用适当的模式创建一个键空间和一个表。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="87f8" class="ml la je mh b gy mm mn l mo mp">CREATE KEYSPACE school WITH replication = {'class': 'SimpleStrategy', 'replication_factor': '1'};<br/><br/>CREATE TABLE school.students (<br/>    name text,<br/>    surname text,<br/>    age int,<br/>    group_id int,<br/>    group_number text,<br/>    skills set&lt;text&gt;,<br/>    something_important int,<br/>    PRIMARY KEY (name, surname)<br/>) ;</span></pre><p id="1d5a" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这个模式是虚构的，所以不要在其中寻找任何意义。在Apache Cassandra中，数据建模是特定的。在“非训练”条件下，数据应正确建模。</p><h1 id="cb42" class="kz la je bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">PySpark ETL到Apache Cassandra</h1><figure class="mc md me mf gt iv"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="15ff" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们需要使用PYSPARK_SUBMIT_ARGS变量提供适当的库，并配置源代码。如您所见，代码并不复杂。所有的工作都由图书馆接管。</p><h1 id="e62e" class="kz la je bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">spylon内核的问题</h1><p id="0382" class="pw-post-body-paragraph kb kc je kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">最初我想用Jupyter中的Spylon内核在Scala中写w.w .代码。不幸的是，它的MongoDB库有问题。PySpark和spark-shell可以毫无问题地处理它。</p><figure class="mc md me mf gt iv"><div class="bz fp l di"><div class="mq mr l"/></div></figure><h1 id="37e7" class="kz la je bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">被卖方收回的汽车</h1><p id="c46a" class="pw-post-body-paragraph kb kc je kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated"><a class="ae ms" href="https://github.com/zorteran/wiadro-danych-simple-spark-etl" rel="noopener ugc nofollow" target="_blank">https://github.com/zorteran/wiadro-danych-simple-spark-etl</a></p></div></div>    
</body>
</html>