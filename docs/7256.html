<html>
<head>
<title>Testing Jakarta EE 9 Web Application in Servlet Containers with Arquillian</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Arquillian在Servlet容器中测试Jakarta EE 9 Web应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/testing-jakarta-ee-9-web-application-in-a-servlet-container-with-arquillian-ec2d42947cd?source=collection_archive---------1-----------------------#2022-08-01">https://itnext.io/testing-jakarta-ee-9-web-application-in-a-servlet-container-with-arquillian-ec2d42947cd?source=collection_archive---------1-----------------------#2022-08-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/bfc78e68662297020d23994c842a06a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dY00LOwrPkshDVnjDP-XwA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by &lt;a href=”<a class="ae kc" href="https://unsplash.com/@whiterainforest?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/@whiterainforest?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText</a>"&gt;White.Rainforest ∙ 易雨白林.&lt;/a&gt; on &lt;a href=”<a class="ae kc" href="https://unsplash.com/s/photos/china-mountain?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/s/photos/china-mountain?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText</a>"&gt;Unsplash&lt;/a&gt;</figcaption></figure><p id="b6b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上一篇文章<a class="ae kc" href="https://github.com/hantsy/jakartaee9-servlet-starter-boilerplate/blob/master/docs/build.md" rel="noopener ugc nofollow" target="_blank">使用Servlet容器构建Jakarta EE 9 web应用</a>中，我们描述了如何使用核心JakartaEE组件启动JakartaEE 9 Web应用，包括CDI、Jakarta Faces、Jakarta Servlet、Jakarta Pages、Jakarta REST等，并在兼容JakartaEE 9的Servlet容器中运行它。在本帖中，我们将讨论如何使用Arquillian测试框架在Servlet容器中测试这些组件。</p><p id="37a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Arquillian项目为Apache Tomcat和Eclipse Jetty提供官方支持，更多信息请访问<a class="ae kc" href="https://github.com/arquillian/arquillian-container-tomcat" rel="noopener ugc nofollow" target="_blank">Arquillian Container Tomcat</a>和<a class="ae kc" href="https://github.com/arquillian/arquillian-container-jetty" rel="noopener ugc nofollow" target="_blank"> Arquillian Container Jetty </a>。目前，这两个项目都提供了一个支持最新Apache Tomcat 10和Eclipse Jetty 11的<em class="lb">嵌入式</em>容器适配器，但是没有可用的托管和远程适配器。</p><p id="741d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你是Arquillian新手，请先阅读官方的<a class="ae kc" href="https://arquillian.org/guides/" rel="noopener ugc nofollow" target="_blank">入门指南</a>，或者探索我之前关于<a class="ae kc" href="https://hantsy.github.io/jakartaee8-starter-boilerplate/" rel="noopener ugc nofollow" target="_blank">测试Jakarta EE 8应用</a>和<a class="ae kc" href="https://hantsy.github.io/jakartaee9-starter-boilerplate/" rel="noopener ugc nofollow" target="_blank"> Jakarta EE 9应用</a>的Arquillian文章，了解Arquillian的基础知识。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="81b2" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">配置阿奎利亚语</h1><p id="2833" class="pw-post-body-paragraph kd ke iq kf b kg mh ki kj kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">首先将Arquillian Core和JUnit <em class="lb"> BOM </em>添加到项目<em class="lb"> pom.xml </em>文件的<em class="lb"> dependencyManagement </em>部分。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="c535" class="mv lk iq mr b gy mw mx l my mz">&lt;dependencyManagement&gt;<br/>    // ... <br/>    &lt;dependencies&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.jboss.arquillian&lt;/groupId&gt;<br/>            &lt;artifactId&gt;arquillian-bom&lt;/artifactId&gt;<br/>            &lt;version&gt;${arquillian-bom.version}&lt;/version&gt;<br/>            &lt;scope&gt;import&lt;/scope&gt;<br/>            &lt;type&gt;pom&lt;/type&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.junit&lt;/groupId&gt;<br/>            &lt;artifactId&gt;junit-bom&lt;/artifactId&gt;<br/>            &lt;version&gt;${junit-jupiter.version}&lt;/version&gt;<br/>            &lt;type&gt;pom&lt;/type&gt;<br/>            &lt;scope&gt;import&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>    &lt;/dependencies&gt;<br/>&lt;/dependencyManagement&gt;</span></pre><p id="f943" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在项目<em class="lb">依赖关系</em>部分添加以下依赖关系。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="7249" class="mv lk iq mr b gy mw mx l my mz">&lt;dependencies&gt;<br/>    //...<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.jboss.arquillian.protocol&lt;/groupId&gt;<br/>        &lt;artifactId&gt;arquillian-protocol-servlet-jakarta&lt;/artifactId&gt;<br/>        &lt;scope&gt;test&lt;/scope&gt;<br/>    &lt;/dependency&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.jboss.shrinkwrap.resolver&lt;/groupId&gt;<br/>        &lt;artifactId&gt;shrinkwrap-resolver-impl-maven&lt;/artifactId&gt;<br/>        &lt;scope&gt;test&lt;/scope&gt;<br/>    &lt;/dependency&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;<br/>        &lt;artifactId&gt;junit-jupiter&lt;/artifactId&gt;<br/>        &lt;scope&gt;test&lt;/scope&gt;<br/>    &lt;/dependency&gt;<br/>&lt;/dependencies&gt;</span></pre><p id="1f52" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您还可以添加以下测试实用程序库来改进您的测试代码。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="8032" class="mv lk iq mr b gy mw mx l my mz">&lt;dependencies&gt;<br/>    //....<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;<br/>        &lt;artifactId&gt;junit-jupiter-params&lt;/artifactId&gt;<br/>        &lt;scope&gt;test&lt;/scope&gt;<br/>    &lt;/dependency&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.mockito&lt;/groupId&gt;<br/>        &lt;artifactId&gt;mockito-core&lt;/artifactId&gt;<br/>        &lt;scope&gt;test&lt;/scope&gt;<br/>    &lt;/dependency&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.hamcrest&lt;/groupId&gt;<br/>        &lt;artifactId&gt;hamcrest&lt;/artifactId&gt;<br/>        &lt;scope&gt;test&lt;/scope&gt;<br/>    &lt;/dependency&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.assertj&lt;/groupId&gt;<br/>        &lt;artifactId&gt;assertj-core&lt;/artifactId&gt;<br/>        &lt;scope&gt;test&lt;/scope&gt;<br/>    &lt;/dependency&gt;<br/>&lt;/dependencies&gt;</span></pre><p id="d581" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们将配置Arquillian Tomcat嵌入式适配器，以针对嵌入式Apache Tomcat容器运行测试代码。</p><h1 id="bdee" class="lj lk iq bd ll lm na lo lp lq nb ls lt lu nc lw lx ly nd ma mb mc ne me mf mg bi translated">配置Arquillian Tomcat嵌入式适配器</h1><p id="524b" class="pw-post-body-paragraph kd ke iq kf b kg mh ki kj kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">创建一个新的Maven概要文件来集中Arquillian tomcat嵌入式适配器的所有配置。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="bd66" class="mv lk iq mr b gy mw mx l my mz">&lt;profile&gt;<br/>    &lt;id&gt;arq-tomcat-embedded&lt;/id&gt;<br/>    &lt;properties&gt;<br/>        &lt;skipTests&gt;false&lt;/skipTests&gt;<br/>    &lt;/properties&gt;<br/>    &lt;dependencies&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.jboss.arquillian.container&lt;/groupId&gt;<br/>            &lt;artifactId&gt;arquillian-tomcat-embedded-10&lt;/artifactId&gt;<br/>            &lt;version&gt;${arquillian-tomcat.version}&lt;/version&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;<br/>            &lt;artifactId&gt;tomcat-embed-core&lt;/artifactId&gt;<br/>            &lt;version&gt;${tomcat.version}&lt;/version&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;<br/>            &lt;artifactId&gt;tomcat-embed-jasper&lt;/artifactId&gt;<br/>            &lt;version&gt;${tomcat.version}&lt;/version&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;<br/>            &lt;artifactId&gt;tomcat-embed-websocket&lt;/artifactId&gt;<br/>            &lt;version&gt;${tomcat.version}&lt;/version&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>    &lt;/dependencies&gt;<br/>&lt;/profile&gt;</span></pre><p id="b16b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们将编写一些测试代码。</p><h1 id="f9bd" class="lj lk iq bd ll lm na lo lp lq nb ls lt lu nc lw lx ly nd ma mb mc ne me mf mg bi translated">测试雅加达组件</h1><p id="de7f" class="pw-post-body-paragraph kd ke iq kf b kg mh ki kj kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">对于简单的POJOs，您可以编写一个简单的JUnit测试来验证功能。例如，<code class="fe nf ng nh mr b">GreetingMessage</code>是一个简单的POJO，用于组装可读的问候消息。我们可以编写一个简单的JUnit测试来检查它是否按预期工作。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="7d04" class="mv lk iq mr b gy mw mx l my mz">public class GreetingMessageTest {</span><span id="3696" class="mv lk iq mr b gy ni mx l my mz">    @Test<br/>    public void testGreetingMessage() {<br/>        var message = GreetingMessage.of("Say Hello to JatartaEE");<br/>        assertThat(message.getMessage()).isEqualTo("Say Hello to JatartaEE");<br/>    }<br/>}</span></pre><p id="8c43" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nf ng nh mr b">GreetingService</code> bean本身只是实现了一个简单的功能，该功能用于使用<code class="fe nf ng nh mr b">buildGreetingMessage</code>方法构建问候消息，该方法接受一个参数来设置问候的目标。就像前面的测试示例一样，创建一个简单的JUnit测试来验证它是否如预期的那样工作。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="9bad" class="mv lk iq mr b gy mw mx l my mz">public class GreetingServiceUnitTest {</span><span id="5a8e" class="mv lk iq mr b gy ni mx l my mz">    GreetingService service;</span><span id="6787" class="mv lk iq mr b gy ni mx l my mz">    @BeforeEach<br/>    public void setup() {<br/>        service = new GreetingService();<br/>    }</span><span id="4d4c" class="mv lk iq mr b gy ni mx l my mz">    @Test<br/>    public void testGreeting() {<br/>        var message = service.buildGreetingMessage("JakartaEE");<br/>        assertThat(message.getMessage()).startsWith("Say Hello to JakartaEE");<br/>    }<br/>}</span></pre><p id="aede" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nf ng nh mr b">Hello</code>豆依赖于<code class="fe nf ng nh mr b">GreetingService</code>豆。为了在单元测试中测试<code class="fe nf ng nh mr b">Hello</code>的功能，我们可以使用Mockito来隔离依赖- <code class="fe nf ng nh mr b">GreetingService</code>。在下面的<code class="fe nf ng nh mr b">HelloTest</code>中，我们在测试中创建了一个<code class="fe nf ng nh mr b">GreetingService</code>的模拟对象。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="436b" class="mv lk iq mr b gy mw mx l my mz">public class HelloTest {</span><span id="c7e9" class="mv lk iq mr b gy ni mx l my mz">    @ParameterizedTest<br/>    @MethodSource("provideQueryCriteria")<br/>    public void testCreateMessage(String name, String result) {<br/>        var service = mock(GreetingService.class);<br/>        given(service.buildGreetingMessage(name)).willReturn(GreetingMessage.of("Say Hello to " + name));<br/>        <br/>        var hello = new Hello(service);<br/>        <br/>        hello.setName(name);<br/>        hello.createMessage();<br/>        assertThat(hello.getName()).isEqualTo(name);<br/>        assertThat(hello.getMessage().getMessage()).isEqualTo(result);<br/>        verify(service, times(1)).buildGreetingMessage(anyString());<br/>        verifyNoMoreInteractions(service);<br/>    }<br/>    <br/>    static Stream&lt;Arguments&gt; provideQueryCriteria() {<br/>        return Stream.of(<br/>                Arguments.of("Tomcat", "Say Hello to Tomcat"),<br/>                Arguments.of("JakartaEE", "Say Hello to JakartaEE")<br/>        );<br/>    }<br/>}</span></pre><p id="9f36" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们已经在单元测试中测试了简单的POJOs，对于其他Jakarta EE组件，如Servlet、Jakarta Pages等，我们必须验证Servlet容器中的功能，我们将使用Arquillian为这个场景编写集成测试。</p><p id="f952" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了在不同的阶段运行单元测试和集成测试，我们可以如下配置<code class="fe nf ng nh mr b">maven-surefire-plugin</code>和<code class="fe nf ng nh mr b">maven-failsafe-plugin</code>，并确保集成测试在<code class="fe nf ng nh mr b">integration-test</code>阶段运行。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="94d6" class="mv lk iq mr b gy mw mx l my mz">&lt;plugins&gt;<br/>    //...<br/>    &lt;plugin&gt;<br/>        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br/>        &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;<br/>        &lt;version&gt;${maven-surefire-plugin.version}&lt;/version&gt;<br/>        &lt;configuration&gt;<br/>            &lt;skipTests&gt;${skipTests}&lt;/skipTests&gt;<br/>        &lt;/configuration&gt;<br/>        &lt;executions&gt;<br/>            &lt;execution&gt;<br/>                &lt;id&gt;default-test&lt;/id&gt;<br/>                &lt;phase&gt;test&lt;/phase&gt;<br/>                &lt;goals&gt;<br/>                    &lt;goal&gt;test&lt;/goal&gt;<br/>                &lt;/goals&gt;<br/>                &lt;configuration&gt;<br/>                    &lt;excludes&gt;<br/>                        &lt;exclude&gt;**/it/**&lt;/exclude&gt;<br/>                    &lt;/excludes&gt;<br/>                &lt;/configuration&gt;<br/>            &lt;/execution&gt;<br/>        &lt;/executions&gt;<br/>    &lt;/plugin&gt;<br/>    &lt;plugin&gt;<br/>        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br/>        &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;<br/>        &lt;version&gt;${maven-failsafe-plugin.version}&lt;/version&gt;<br/>        &lt;configuration&gt;<br/>            &lt;skipITs&gt;${skipTests}&lt;/skipITs&gt;<br/>        &lt;/configuration&gt;<br/>        &lt;executions&gt;<br/>            &lt;execution&gt;<br/>                &lt;id&gt;integration-test&lt;/id&gt;<br/>                &lt;phase&gt;integration-test&lt;/phase&gt;<br/>                &lt;goals&gt;<br/>                    &lt;goal&gt;integration-test&lt;/goal&gt;<br/>                    &lt;goal&gt;verify&lt;/goal&gt;<br/>                &lt;/goals&gt;<br/>                &lt;configuration&gt;<br/>                    &lt;includes&gt;<br/>                        &lt;include&gt;**/it/**&lt;/include&gt;<br/>                    &lt;/includes&gt;<br/>                &lt;/configuration&gt;<br/>            &lt;/execution&gt;<br/>        &lt;/executions&gt;<br/>    &lt;/plugin&gt;<br/>&lt;/plugins&gt;</span></pre><p id="e5c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，让我们看看用于测试简单CDI bean <code class="fe nf ng nh mr b">GreetingService</code>的<code class="fe nf ng nh mr b">GreetingServiceTest</code>。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="46aa" class="mv lk iq mr b gy mw mx l my mz">@ExtendWith(ArquillianExtension.class)<br/>public class GreetingServiceTest {<br/>    <br/>    private final static Logger LOGGER = Logger.getLogger(GreetingServiceTest.class.getName());<br/>    <br/>    @Deployment<br/>    public static WebArchive createDeployment() {<br/>        var war = ShrinkWrap.create(WebArchive.class)<br/>                .addClass(GreetingMessage.class)<br/>                .addClass(GreetingService.class)<br/>                .addAsWebInfResource(EmptyAsset.INSTANCE, "beans.xml")<br/>                .addAsWebInfResource("test-web.xml", "web.xml")<br/>                .addAsWebInfResource(new File("src/main/webapp/WEB-INF/jetty-env.xml"), "jetty-env.xml");<br/>        <br/>        Deployments.addExtraJars(war);<br/>        <br/>        LOGGER.log(Level.INFO, "war deployment: {0}", war.toString(true));<br/>        return war;<br/>    }<br/>    <br/>    @Inject<br/>    GreetingService service;<br/>    <br/>    @Test<br/>    @DisplayName("testing buildGreetingMessage")<br/>    public void should_create_greeting() {<br/>        LOGGER.log(Level.INFO, " Running test:: GreetingServiceTest#should_create_greeting ... ");<br/>        var message = service.buildGreetingMessage("Jakarta EE");<br/>        assertTrue(message.getMessage().startsWith("Say Hello to Jakarta EE at "),<br/>                "message should start with \"Say Hello to Jakarta EE at \"");<br/>    }<br/>}</span></pre><p id="999c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如您所见，Arquillian集成测试用<code class="fe nf ng nh mr b">@ExtendWith(ArquillianExtension.class)</code>进行了注释，这是标准的JUnit 5扩展。</p><p id="66f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Arquillian测试中，您必须通过一个静态的<code class="fe nf ng nh mr b">@Deployment</code>注释方法创建一个最小的部署档案。在<code class="fe nf ng nh mr b">@Deployment</code>方法中，您可以在运行测试用例之前准备将要打包并部署到目标运行时的资源。</p><p id="402e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在测试类中，您可以像CDI bean一样注入可用的bean，例如，我们在这里注入<code class="fe nf ng nh mr b">GreetingService</code>，然后在测试方法中，使用<code class="fe nf ng nh mr b">GreetingService</code> bean来验证功能。</p><p id="6c6f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">打开您的终端，执行以下命令运行<code class="fe nf ng nh mr b">GreetingServiceTest</code>。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="64e6" class="mv lk iq mr b gy mw mx l my mz">mvn clean verify -Parq-tomcat-embeded -Dit.test=GreetingServiceTest</span></pre><p id="a122" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当运行Arquillian测试时，它会将部署资源打包到一个可部署的档案中，并将其部署到目标容器中，然后在容器中运行测试，JUnit客户端代理将通过与容器中的测试交互的代理收集运行结果。</p><p id="671a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们来测试一下<code class="fe nf ng nh mr b">GreetingResource</code>。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="a5ba" class="mv lk iq mr b gy mw mx l my mz">@ExtendWith(ArquillianExtension.class)<br/>public class GreetingResourceTest {<br/>    <br/>    private final static Logger LOGGER = Logger.getLogger(GreetingResourceTest.class.getName());<br/>    <br/>    @Deployment(testable = false)<br/>    public static WebArchive createDeployment() {<br/>        var war = ShrinkWrap.create(WebArchive.class)<br/>                .addClass(GreetingMessage.class)<br/>                .addClass(GreetingService.class)<br/>                .addClasses(GreetingResource.class)<br/>                .addClasses(RestActivator.class)<br/>                // Enable CDI (Optional since Java EE 7.0)<br/>                .addAsWebInfResource(EmptyAsset.INSTANCE, "beans.xml")<br/>                .addAsWebInfResource("test-web.xml", "web.xml")<br/>                .addAsWebInfResource(new File("src/main/webapp/WEB-INF/jetty-env.xml"), "jetty-env.xml");<br/>        <br/>        Deployments.addExtraJars(war);<br/>        <br/>        LOGGER.log(Level.INFO, "war deployment: {0}", war.toString(true));<br/>        return war;<br/>    }<br/>    <br/>    @ArquillianResource<br/>    private URL base;<br/>    <br/>    private Client client;<br/>    <br/>    @BeforeEach<br/>    public void setup() {<br/>        LOGGER.info("call BeforeEach");<br/>        this.client = ClientBuilder.newClient();<br/>    }<br/>    <br/>    @AfterEach<br/>    public void teardown() {<br/>        LOGGER.info("call AfterEach");<br/>        if (this.client != null) {<br/>            this.client.close();<br/>        }<br/>    }<br/>    <br/>    @Test<br/>    @DisplayName("Given a name:`JakartaEE` should return `Say Hello to JakartaEE`")<br/>    public void should_create_greeting() throws MalformedURLException {<br/>        LOGGER.log(Level.INFO, " client: {0}, baseURL: {1}", new Object[]{client, base});<br/>        final var greetingTarget = this.client.target(new URL(this.base, "api/greeting/JakartaEE").toExternalForm());<br/>        try (final Response greetingGetResponse = greetingTarget.request()<br/>                .accept(MediaType.APPLICATION_JSON)<br/>                .get()) {<br/>            assertThat(greetingGetResponse.getStatus()).isEqualTo(200);<br/>            assertThat(greetingGetResponse.readEntity(GreetingMessage.class).getMessage())<br/>                    .startsWith("Say Hello to JakartaEE");<br/>        }<br/>    }<br/>}</span></pre><p id="ea1e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">与<code class="fe nf ng nh mr b">GreetingServiceTest</code>不同，为了测试“GreetingResource”的功能，我们使用Jakarta REST客户端API与客户端视图中的HTTP APIs进行交互。</p><p id="492a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe nf ng nh mr b">@Deployment</code>注释中添加一个<code class="fe nf ng nh mr b">testable=false</code>属性意味着所有的测试都将在客户端模式下运行。</p><p id="825d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者，您也可以在测试方法上添加一个<code class="fe nf ng nh mr b">@RunAsClient</code>来本地运行它。</p><p id="fdb1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在部署之后，<code class="fe nf ng nh mr b">@ArquillianResource</code>将在容器中注入部署档案的基本URL。</p><p id="43e5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">执行以下命令运行<code class="fe nf ng nh mr b">GreetingServiceTest</code>。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="cee3" class="mv lk iq mr b gy mw mx l my mz">mvn clean verify -Parq-tomcat-embeded -Dit.test=GreetingResourceTest</span></pre><blockquote class="nj nk nl"><p id="40ac" class="kd ke lb kf b kg kh ki kj kk kl km kn nm kp kq kr nn kt ku kv no kx ky kz la ij bi translated"><em class="iq">如果在部署方法上应用了</em> <code class="fe nf ng nh mr b"><em class="iq">@Deployment(testable=true)</em></code> <em class="iq">，那么所有的测试都以客户端模式运行，我们不能像前面的例子那样在测试类中注入beans。</em></p></blockquote><p id="e6e6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">类似地，我们可以创建<em class="lb">客户端模式</em>测试来验证简单的Jakarta Servlet、Jakarta Faces、Jakarta Pages等的功能。完整的代码可以在<a class="ae kc" href="https://github.com/hantsy/jakartaee9-servlet-starter-boilerplate" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><blockquote class="nj nk nl"><p id="5b24" class="kd ke lb kf b kg kh ki kj kk kl km kn nm kp kq kr nn kt ku kv no kx ky kz la ij bi translated"><em class="iq">要验证渲染后的HTML页面中的HTML元素和Ajax交互，请查看</em> <a class="ae kc" href="https://github.com/arquillian/arquillian-extension-drone" rel="noopener ugc nofollow" target="_blank"> <em class="iq"> Arquillian扩展无人机</em> </a> <em class="iq">和</em> <a class="ae kc" href="https://github.com/arquillian/arquillian-graphene" rel="noopener ugc nofollow" target="_blank"> <em class="iq"> Arquillian石墨烯</em> </a> <em class="iq">。</em></p></blockquote><h1 id="6fdc" class="lj lk iq bd ll lm na lo lp lq nb ls lt lu nc lw lx ly nd ma mb mc ne me mf mg bi translated">配置Jetty嵌入式适配器</h1><p id="ecae" class="pw-post-body-paragraph kd ke iq kf b kg mh ki kj kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">添加新的Maven配置文件来配置Arquillian Jetty嵌入式适配器。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="50df" class="mv lk iq mr b gy mw mx l my mz">&lt;profile&gt;<br/>    &lt;id&gt;arq-jetty-embedded&lt;/id&gt;<br/>    &lt;properties&gt;<br/>        &lt;skipTests&gt;false&lt;/skipTests&gt;<br/>    &lt;/properties&gt;<br/>    &lt;dependencies&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.jboss.arquillian.container&lt;/groupId&gt;<br/>            &lt;artifactId&gt;arquillian-jetty-embedded-11&lt;/artifactId&gt;<br/>            &lt;version&gt;${arquillian-jetty.version}&lt;/version&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;<br/>            &lt;artifactId&gt;jetty-annotations&lt;/artifactId&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;<br/>            &lt;artifactId&gt;jetty-plus&lt;/artifactId&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;<br/>            &lt;artifactId&gt;jetty-deploy&lt;/artifactId&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;<br/>            &lt;artifactId&gt;jetty-servlet&lt;/artifactId&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;<br/>            &lt;artifactId&gt;jetty-webapp&lt;/artifactId&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;<br/>            &lt;artifactId&gt;jetty-cdi&lt;/artifactId&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>            &lt;!-- to remove when 11.0.10 released --&gt;<br/>            &lt;!-- see <a class="ae kc" href="https://github.com/eclipse/jetty.project/pull/7991" rel="noopener ugc nofollow" target="_blank">https://github.com/eclipse/jetty.project/pull/7991</a> --&gt;<br/>            &lt;version&gt;${jetty.version}&lt;/version&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.eclipse.jetty.websocket&lt;/groupId&gt;<br/>            &lt;artifactId&gt;websocket-jakarta-server&lt;/artifactId&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;<br/>            &lt;artifactId&gt;apache-jsp&lt;/artifactId&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;<br/>            &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;<br/>            &lt;version&gt;1.7.36&lt;/version&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;!-- see: <a class="ae kc" href="https://github.com/arquillian/arquillian-container-jetty/pull/108" rel="noopener ugc nofollow" target="_blank">https://github.com/arquillian/arquillian-container-jetty/pull/108</a> --&gt;<br/>        &lt;!--&lt;dependency&gt;<br/>            &lt;groupId&gt;org.jboss.arquillian.testenricher&lt;/groupId&gt;<br/>            &lt;artifactId&gt;arquillian-testenricher-cdi-jakarta&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;--&gt;<br/>    &lt;/dependencies&gt;<br/>&lt;/profile&gt;</span></pre><p id="70bc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，针对<code class="fe nf ng nh mr b">arq-jetty-embedded</code>概要文件运行之前的测试。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="bed8" class="mv lk iq mr b gy mw mx l my mz">mvn clean verify -Parq-jetty-embeded -Dit.test=GreetingResourceTest</span></pre><h1 id="51c1" class="lj lk iq bd ll lm na lo lp lq nb ls lt lu nc lw lx ly nd ma mb mc ne me mf mg bi translated">配置嵌入式阿奎利亚焊缝</h1><p id="c852" class="pw-post-body-paragraph kd ke iq kf b kg mh ki kj kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">Arquillian项目提供了一个官方扩展，用于在嵌入式焊接容器中测试CDI beans。</p><p id="7eaf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建一个新的Maven概要文件来配置Arquillian Weld嵌入式适配器，并使用<code class="fe nf ng nh mr b">maven-failsafe-plugin</code>过滤掉Jakarta Servlet、Jakarta Faces等的测试。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="0f22" class="mv lk iq mr b gy mw mx l my mz">&lt;profile&gt;<br/>    &lt;id&gt;arq-weld&lt;/id&gt;<br/>    &lt;properties&gt;<br/>        &lt;skipTests&gt;false&lt;/skipTests&gt;<br/>    &lt;/properties&gt;<br/>    &lt;dependencies&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.jboss.arquillian.container&lt;/groupId&gt;<br/>            &lt;artifactId&gt;arquillian-weld-embedded&lt;/artifactId&gt;<br/>            &lt;version&gt;${arquillian-weld-embedded.version}&lt;/version&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.jboss.weld&lt;/groupId&gt;<br/>            &lt;artifactId&gt;weld-core-impl&lt;/artifactId&gt;<br/>            &lt;version&gt;${weld.version}&lt;/version&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>    &lt;/dependencies&gt;<br/>    &lt;build&gt;<br/>        &lt;plugins&gt;<br/>            &lt;plugin&gt;<br/>                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br/>                &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;<br/>                &lt;version&gt;${maven-failsafe-plugin.version}&lt;/version&gt;<br/>                &lt;configuration&gt;<br/>                    &lt;systemPropertyVariables&gt;<br/>                        &lt;arquillian.launch&gt;arq-weld&lt;/arquillian.launch&gt;<br/>                    &lt;/systemPropertyVariables&gt;<br/>                    &lt;excludes&gt;<br/>                        &lt;exclude&gt;**/it/GreetingResourceTest*&lt;/exclude&gt;<br/>                        &lt;exclude&gt;**/it/GreetingServletTest*&lt;/exclude&gt;<br/>                    &lt;/excludes&gt;<br/>                &lt;/configuration&gt;<br/>            &lt;/plugin&gt;<br/>        &lt;/plugins&gt;<br/>    &lt;/build&gt;<br/>&lt;/profile&gt;</span></pre><p id="8746" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">执行以下命令运行<code class="fe nf ng nh mr b">GreetingServiceTest</code>。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="0b28" class="mv lk iq mr b gy mw mx l my mz">mvn clean verify -Parq-weld -Dit.test=GreetingServiceTest</span></pre><blockquote class="nj nk nl"><p id="0e7a" class="kd ke lb kf b kg kh ki kj kk kl km kn nm kp kq kr nn kt ku kv no kx ky kz la ij bi translated"><em class="iq">Jakarta Servlet、Jakarta Pages和Jakarta Faces的测试代码需要一个Servlet容器。</em></p></blockquote><p id="6647" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从我的Github帐户获取<a class="ae kc" href="https://github.com/hantsy/jakartaee9-servlet-starter-boilerplate" rel="noopener ugc nofollow" target="_blank">完整的源代码</a>。</p></div></div>    
</body>
</html>