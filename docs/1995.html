<html>
<head>
<title>Architecting Security &amp; Governance Across your AWS Accounts Part 2: Incident Response on AWS.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">跨您的AWS帐户构建安全性和治理第2部分:AWS上的事件响应。</h1>
<blockquote>原文：<a href="https://itnext.io/architecting-security-governance-across-your-aws-accounts-part-2-incident-response-on-aws-44b1ee01f1ee?source=collection_archive---------1-----------------------#2019-03-11">https://itnext.io/architecting-security-governance-across-your-aws-accounts-part-2-incident-response-on-aws-44b1ee01f1ee?source=collection_archive---------1-----------------------#2019-03-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/7c3cbe73e4a6ed636fd705745f9c6aa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0vivIu4ZtQY2KHwOTI1R4w.png"/></div></div></figure><p id="6902" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">注</em> </strong> <em class="kz">:这是一个多部分系列的第2部分。第一部分请点击</em><strong class="kd iu"><em class="kz"/></strong><a class="ae la" rel="noopener ugc nofollow" target="_blank" href="/architecting-security-governance-across-your-aws-accounts-part-1-introduction-ae200624424d"><strong class="kd iu"><em class="kz">这里。</em> </strong> </a></p><p id="971b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是“跨您的AWS帐户构建安全性和治理”的第二部分系列。在这一部分中，我们将在AWS云上探索事故响应计划的狭窄通道；我们还将使用云托管实施有趣的自动化事件响应活动。</p><p id="db09" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">“建立一个声誉需要20年，而几分钟的网络事件就能毁掉它。”―  <strong class="kd iu"> <em class="kz">夏羽纳珀</em> </strong></p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><blockquote class="li lj lk"><p id="186f" class="kb kc kz kd b ke kf kg kh ki kj kk kl ll kn ko kp lm kr ks kt ln kv kw kx ky im bi translated">根据<a class="ae la" href="https://www.nist.gov/" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> NIST </strong> </a>的说法，安全事件是指<em class="it">“实际或潜在危害信息系统或系统处理、存储或传输的信息的保密性、完整性或可用性，或构成违反或即将违反安全策略、安全程序或可接受的使用策略的事件。”</em></p></blockquote><p id="4871" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">好吧，那就是满嘴，我们简化一下。事件是对您的IT服务的意外降级。</p><p id="aa56" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这一部分中，我们将了解流程、AWS服务以及您轻松应对安全漏洞的雾夜所需的策略。</p><p id="d447" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有大量的事件响应框架，它们详细解释了您需要为有效的事件响应团队、行动手册和流程自动化实现什么。</p><h1 id="0019" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">让我们从谈论AWS上的事件响应阶段和攻击面开始，然后尝试将AWS Lambda招募到我们的事件响应团队，以便在出现问题时提供帮助；希望我们能付得起Lambda的工资:)</h1></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><h1 id="726d" class="lo lp it bd lq lr mm lt lu lv mn lx ly lz mo mb mc md mp mf mg mh mq mj mk ml bi translated">云中的事件响应阶段(NIST)</h1><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mr"><img src="../Images/a25bc15ec72fe9e38ba7ecef57c8745d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gn_hpSxP9ysbJaLcxjJTzQ.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">参考:NIST SP 800–53，第4版</figcaption></figure><p id="c70e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当谈到响应安全事件时，与传统数据中心相比，云中的阶段没有太大变化，但技术实现确实发生了显著的改善。让我们探索阶段。</p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><p id="88fe" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">高效运行手册的七个事件响应阶段</strong></p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi na"><img src="../Images/a2b163ad925de40f15732a3311747bc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F9ebtavsmXpLzEEsDkpAZQ.png"/></div></div></figure></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><h1 id="0781" class="lo lp it bd lq lr mm lt lu lv mn lx ly lz mo mb mc md mp mf mg mh mq mj mk ml bi translated">1-准备阶段:</h1><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi na"><img src="../Images/5ad85b23091a646f6e15f67fc464a3af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qo_PIECfexofmi8tu33CTA.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated"><strong class="bd lq">准备阶段</strong></figcaption></figure><p id="e7b0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这个阶段是关于，你猜对了，准备工作。我们需要做好准备，首先完成威胁建模，缩小攻击面，并采取任何必要的主动措施来防止安全事件的发生。我们需要启用<strong class="kd iu"><em class="kz"/></strong><strong class="kd iu"><em class="kz">监控</em></strong><strong class="kd iu"><em class="kz">加密</em></strong><strong class="kd iu">限制</strong><strong class="kd iu"><em class="kz">爆炸半径</em> </strong>。</p><h2 id="6247" class="nb lp it bd lq nc nd dn lu ne nf dp ly km ng nh mc kq ni nj mg ku nk nl mk nm bi translated">通过应用主动措施做好准备:</h2><p id="37d3" class="pw-post-body-paragraph kb kc it kd b ke nn kg kh ki no kk kl km np ko kp kq nq ks kt ku nr kw kx ky im bi translated"><em class="kz"> 1- </em> <strong class="kd iu"> <em class="kz">数据分类</em> </strong> <em class="kz">:确定数据的敏感级别、所有者和安全需求。</em></p><p id="7f1c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz"> 2- </em> <strong class="kd iu"> <em class="kz">所有权</em> </strong> <em class="kz">:所有的资源都应该被标记，知道谁拥有一组受损的资源是很好的，所有者至少可以向您提供关于可能导致受损的资源或配置中的数据存储的敏感级别的信息。提示:我们应该始终标记我们的资源！</em></p><p id="4a38" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">3- <strong class="kd iu"> <em class="kz">风险管理</em> </strong> : <em class="kz">识别威胁、风险和漏洞，弄清楚你的风险偏好，然后根据你愿意容忍的风险水平来管理你的风险和漏洞。</em></p><p id="c6d2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz"> 4- </em> <strong class="kd iu"> <em class="kz">弹性:</em> </strong> <em class="kz">架构高度可用、容错的基础设施。提示:使用AWS well architect工具并阅读well-architect白皮书。</em></p><p id="c221" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">5- <strong class="kd iu"> <em class="kz">最小特权原则</em> </strong> : <em class="kz">使用AWS IAM和资源策略，只将</em> <strong class="kd iu"> <em class="kz">有限访问权限</em> </strong> <em class="kz">授予那些需要访问数据或在您的环境中操作的人。</em></p><p id="3d52" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">6- <strong class="kd iu"> <em class="kz">测试(比赛天数):</em> </strong> <em class="kz">测试</em> <strong class="kd iu"> <em class="kz"> </em> </strong> <em class="kz">你的突发事件应对方案。我相信在真正的安全事故发生之前，您会发现您可以解决的缺点。</em></p><h2 id="cf9a" class="nb lp it bd lq nc nd dn lu ne nf dp ly km ng nh mc kq ni nj mg ku nk nl mk nm bi translated">通过记录所有内容做好准备:</h2><p id="f6d1" class="pw-post-body-paragraph kb kc it kd b ke nn kg kh ki no kk kl km np ko kp kq nq ks kt ku nr kw kx ky im bi translated">没有理由不在所有帐户和地区启用CloudTrail和其他日志服务。如果发生违规事件，您将没有证据来告诉您的资产发生了什么。</p><p id="c847" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当您启用CloudTrail时，您接触的任何AWS服务都将在Cloudtrail中记录对它们采取的操作，cloud trail也可以与CloudWatch和日志集成，并将存储在一个集中的<strong class="kd iu"> s3 bucket </strong>中。</p><p id="050f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">CloudWatch事件可以被<strong class="kd iu"> AWS Lambda </strong>用于实时补救，被<strong class="kd iu"> SNS </strong>用于实时通知。无论您使用SDK、控制台还是AWS CLI，所有操作都将被记录下来。你对AWS资源采取的任何行动都可能被用来对付你:)我知道这是不好的，我保证不会再这样做了。最后，请不要忘记启用ClouTrail日志文件验证。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ns"><img src="../Images/0a3fcab73c360058e873f20e634b63d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kNrJ1YkkW4SSjwwfZ87k1A.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated"><strong class="bd lq"> CloudTrail工作流程</strong></figcaption></figure><h2 id="5157" class="nb lp it bd lq nc nd dn lu ne nf dp ly km ng nh mc kq ni nj mg ku nk nl mk nm bi translated">通过限制爆炸半径来做准备</h2><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nt"><img src="../Images/f5042b07f837b9c4bea4dde71a562181.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bYlFccrrNhH30sVOQRMqxw.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">爆炸半径</figcaption></figure><p id="e690" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用AWS组织和VPC、子网NACLs、EC2安全组等。，通过根据业务部门、产品等隔离AWS帐户和资源来限制爆炸半径..</p><p id="f2d6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这种方法与深度防御等原则相结合，可以更好地抵御威胁。</p><h2 id="f72e" class="nb lp it bd lq nc nd dn lu ne nf dp ly km ng nh mc kq ni nj mg ku nk nl mk nm bi translated">通过加密所有内容做好准备:</h2><blockquote class="li lj lk"><p id="5218" class="kb kc kz kd b ke kf kg kh ki kj kk kl ll kn ko kp lm kr ks kt ln kv kw kx ky im bi translated">数据隐私专家会告诉你，“把你的数据当成每个人都在看，因为他们可能一直在看。”</p></blockquote><p id="d773" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">加密是通过使用加密算法和加密密钥来屏蔽数据的过程。如果使用强大的加密算法，不良分子将无法以明文形式读取您的数据，如果他们能够在传输中截获数据或在静止状态下访问数据的话。</p><p id="704e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">AWS为您提供加密数据的选项，包括但不限于KMS。</p><p id="bbf0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">AWS KMS和其他直接加密数据的服务使用一种称为<strong class="kd iu"> <em class="kz">信封</em> </strong>加密的方法来提供性能和安全性之间的平衡。见下文:</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nu"><img src="../Images/8abc1852c108118fbbf218985483b7dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EHoYYlvFbb1JimDNDFc1kA.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated"><strong class="bd lq">服务器端加密</strong></figcaption></figure></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><h1 id="f4cf" class="lo lp it bd lq lr mm lt lu lv mn lx ly lz mo mb mc md mp mf mg mh mq mj mk ml bi translated">2-识别阶段:</h1><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/0b0a0cddfa63bdeaa5286dbdd3e5aff6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jmq6uLn59rfloqXZ80c8ag.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated"><strong class="bd lq">识别阶段</strong></figcaption></figure><p id="b17b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">危害迹象很多，例如AWS GuardDuty高严重性警报，说明您的EC2实例正在向与比特币采矿相关的域发出出站调用，或者最好不是生产服务停止。</p><p id="3b0e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">识别阶段是我们发现事故正在发生的阶段。实施识别阶段的最佳方式是确保为您认为重要的所有安全发现设置警报，例如AWS root帐户登录。</p><p id="3b65" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">如果你意识到事故已经发生，你需要回答以下问题:</strong></p><p id="85b1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz"> 1- </em> <strong class="kd iu"> <em class="kz">为什么:</em> </strong> <em class="kz">了解违规背后的意图是什么，可以帮助你识别产品和资源范围以及攻击的性质。</em></p><p id="e27d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz"> 2- </em> <strong class="kd iu"> <em class="kz">什么:</em> </strong> <em class="kz">识别丢失的数据和损坏的资源，以及</em> <strong class="kd iu"> <em class="kz">什么</em> </strong> <em class="kz">你需要清理和、隔离、缓解的精力和资源。</em></p><p id="105e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz"> 3- </em> <strong class="kd iu"> <em class="kz">如何:</em> </strong> <em class="kz">找出他们利用来获得对您系统的未授权访问的弱点。</em></p><p id="67b8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz"> 4- </em> <strong class="kd iu"> <em class="kz">何时:</em> </strong> <em class="kz">确保跟踪所有事件</em></p><p id="179e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz"> 5- </em> <strong class="kd iu"> <em class="kz">谁:</em> </strong> <em class="kz">谁</em> <strong class="kd iu"> <em class="kz"> </em> </strong> <em class="kz">是坏演员。</em></p><p id="8869" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当涉及到识别安全问题时，依靠人类是一种糟糕的做法，因为我们不像机器一样善于关联离群值和异常值。使用AWS服务的自动化事件响应是一条出路，您也可以通过应用机器学习和安全分析来实现这一点。</p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><h1 id="f979" class="lo lp it bd lq lr mm lt lu lv mn lx ly lz mo mb mc md mp mf mg mh mq mj mk ml bi translated">3-遏制阶段:</h1><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nw"><img src="../Images/b699a76b8545526899824323433ca33c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UdCGsXd4xtiuqMCAmbpQJw.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">遏制阶段:</figcaption></figure><p id="f3cc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你已经通过了所有繁琐的鉴定步骤现在呢？这个阶段包括消除安全威胁。</p><p id="a8b9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们应该有一个Cloudformation或Terraform模板，它拥有为取证调查构建隔离环境所需的所有资源。我们需要采取的一些措施包括:</p><p id="f341" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz"> 1-将您的AWS帐户转移到一个拥有非常严格的AWS组织服务控制政策的组织单位。</em></p><p id="ab60" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz"> 2-拒绝访问应该应用于s3存储桶</em></p><p id="7210" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz"> 3-限制安全组，因此他们只允许指定用于调查的端口。</em></p><p id="14f7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz"> 4-全球DENY * IAM政策应附加到不涉及此阶段的所有实体</em></p><p id="ede4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">应部署自动化来阻止受损的资源、快照卷、禁用KMS加密密钥和更改的Route53记录集。</p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><h1 id="7fad" class="lo lp it bd lq lr mm lt lu lv mn lx ly lz mo mb mc md mp mf mg mh mq mj mk ml bi translated">4-调查阶段:</h1><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nx"><img src="../Images/34e26ef7f72e7f4a62426cd0d68e8f66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Brd4XDqJgDYbkQE3BZ_KBg.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">调查阶段</figcaption></figure><p id="4bd5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">调查阶段包括遏制阶段之后的活动，包括但不限于取证和一般日志分析。调查阶段应揭示事件发生的时间，不良行为者采取了什么行动来访问我们的系统，违规的副作用是什么，以及根据目前收集的证据，这种违规再次发生的可能性。如前所述，调查应在隔离的环境中进行。</p><h2 id="59b3" class="nb lp it bd lq nc nd dn lu ne nf dp ly km ng nh mc kq ni nj mg ku nk nl mk nm bi translated">您可以使用的服务:</h2><p id="5bd1" class="pw-post-body-paragraph kb kc it kd b ke nn kg kh ki no kk kl km np ko kp kq nq ks kt ku nr kw kx ky im bi translated"><em class="kz"> 1- VPC流量日志。</em></p><p id="eee7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz"> 2- CloudTrail。</em></p><p id="fafe" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">三云观察。</em></p><p id="6d34" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz"> 4- Athena用于分析日志。</em></p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><h1 id="7cdb" class="lo lp it bd lq lr mm lt lu lv mn lx ly lz mo mb mc md mp mf mg mh mq mj mk ml bi translated">5-根除阶段:</h1><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ny"><img src="../Images/024c17633bbcab1748a4cfe152f79924.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gtqtHIMSmpZGu415UySBXA.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">根除阶段</figcaption></figure><p id="5c62" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这个阶段包括小心处理受影响的资源。如果有必要，我们会删除资源，并将健康和清洁资源转移到更安全的环境中。</p><p id="0cb9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">攻击者应该无法破译加密数据，这意味着我们可以执行以下一些操作:</p><p id="f2c1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">1-禁用或删除KMS键</p><p id="39cb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2-从EBS卷中删除溢出的文件，并将干净的数据移动到新的加密EBS卷中</p><p id="a74a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">3-删除由s3服务器端加密加密的s3对象</p><p id="6a5f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">4-删除加密的s3对象和用KMS或客户密钥加密的s3对象的加密cmk</p><p id="afcd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果数据未加密，您唯一的选择是从您可以保证未被篡改的最后一个已知良好状态恢复您的存储资源。</p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><h1 id="c91f" class="lo lp it bd lq lr mm lt lu lv mn lx ly lz mo mb mc md mp mf mg mh mq mj mk ml bi translated">6-恢复阶段:</h1><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nz"><img src="../Images/adf8e7427368683798141773860e7c0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5ctSy4rkoHJPQuVRnwGvUg.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">恢复阶段</figcaption></figure><p id="d5ec" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我们已经尽了一切努力来确定发生了什么，并且尽了最大努力来执行数据清理，我们需要将我们的运营恢复到正常状态。</p><p id="5049" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以在此阶段执行的一些操作:</p><p id="7794" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">1-恢复资源。</p><p id="8f9f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2-恢复网络连接。</p><p id="2680" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">3-使用新的和改进的访问控制策略和加密密钥。</p><p id="1d16" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">4-监控你周围的任何异常行为。</p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><h1 id="1404" class="lo lp it bd lq lr mm lt lu lv mn lx ly lz mo mb mc md mp mf mg mh mq mj mk ml bi translated">7-后续阶段:</h1><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ny"><img src="../Images/dba6be7fcfcc6d40fd9886036e53b418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G8F_CmUtpaFSJZdFecVVmA.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">后续阶段</figcaption></figure><p id="74b7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">跟进阶段(也称为事后分析)是关于吸取的教训和需要实施的跟进活动，以避免新的安全事件并改进我们的事件操作手册。</p><h1 id="a0e3" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">自动化</h1><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/c2df600f183f1a58277dfaf8a15a438a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oz_s65ZBOpC0-HZRTPcSJw.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">AWS门卫自动化工作流程</figcaption></figure><p id="2346" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你已经做到了，谢谢你！让我们动手实践一个用例，这个用例应该能够让我们理解到目前为止所讨论的想法。最后，如果你不去做，光有一个可靠的计划是不够的。</p><p id="2b07" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">对于这项活动，我们需要以下内容:</strong></p><p id="0640" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">1-隔离的AWS环境。<strong class="kd iu">请不要使用您的生产环境，因为此活动会消耗资源。</strong></p><p id="5969" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2-在<strong class="kd iu">隔离的</strong> AWS环境中，<strong class="kd iu"> AWS GuardDuty </strong>必须启用，以便它生成将由<strong class="kd iu"> CloudWatch </strong>事件和AWS <strong class="kd iu"> Lambda </strong>消耗的结果。</p><p id="1c98" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">3-一个EC2实例(t2.micro)，为了生成一些安全发现，我们可以打开所有端口或类似的东西。</p><p id="7133" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">4-我们将设置<a class="ae la" href="https://github.com/cloud-custodian/cloud-custodian" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu">云托管</strong> </a>，以便它部署此活动所需的无服务器组件。</p><p id="aaa6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">注意</em> </strong> <em class="kz"> —您需要将云托管部署到您启用了</em>守护任务<em class="kz">的同一区域。</em></p><p id="6508" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当我们的云托管策略检测到由AWS GuardDuty生成的中/高严重性发现时，该解决方案非常简单，它应该对范围内的资源采取措施。</p><p id="b322" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">托管人将对受损的EC2实例采取什么行动<em class="kz">和</em>:</strong></p><p id="06ff" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz"> 1-删除附加到EC2实例的IAM角色。</em></p><p id="cc19" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz"> 2-停止EC2实例。</em></p><p id="29c9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz"> 3-对卷进行快照，以便进行取证调查。</em></p><p id="999f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们从安装云托管开始，并编写我们的第一个策略。在您的终端中运行以下命令来安装CC:</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ob"><img src="../Images/bb99f0e238f25b4c4cec43d631f3fb2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qlw9-rtKbUQTweM6W88JoQ.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">安装云托管</figcaption></figure><p id="d60f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，用以下内容创建一个名为<code class="fe oc od oe of b">custodian.yml</code>的文件:</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi og"><img src="../Images/da9962222123e19bcb6ed9cb8095189c.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*iN-enDgjo3vEviTRB8_Vgw.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">你的第一份保单</figcaption></figure><p id="23f5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这个策略所做的就是停止任何带有标签关键字“保管人”的EC2实例。</p><p id="58e2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">运行您的第一个策略:</p><p id="9886" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我假设您正在使用配置文件通过CLI访问您的AWS帐户，如果没有，您可以查看如何使用API密钥对保管人进行身份验证，或者保管人承担角色命令，如果您正在使用配置文件，下面是如何使用AWS CLI配置文件在本地运行该策略，这意味着该策略不会基于CloudTrail生成的事件或预定义的计划运行。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oh"><img src="../Images/d2418ee5d09697904a45bdfa1233b65c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_gJU0mRaKi4ll6mCNjUQIg.png"/></div></div></figure><p id="8c73" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果成功，您应该会在命令行上看到类似以下内容的输出:</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oi"><img src="../Images/9a3f57432a7511eb8d1128281d14fb70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rFoLN6so0MC5Oe-jOEH1_w.png"/></div></div></figure><p id="842b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，您是一名能够在AWS上实现安全自动化的云托管专家，让我们拿出真正的策略吧！</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/2f27622d9104ccffbdef86effa6d15c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*jxKx8py33ZKsAobQPIlr7Q.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">真正的交易</figcaption></figure><p id="e6d1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">遵循为您的第一份保单提供的步骤；编写策略，保存它，并将其部署到一个<strong class="kd iu">隔离的</strong> AWS环境中，然后看看它的神奇之处。如果GuardDuty生成了发现，那么策略Lambda将消费生成的事件，并通过采取我们上面解释的动作来做出反应。</p><p id="08f8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">好吧！事件响应部分到此为止！</strong></p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ok"><img src="../Images/e7d0a414350af4e9e79a19e5e51c38f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OjgRZyi4DYALntZ9YFDtUA.png"/></div></div></figure><p id="a5bb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">感谢您花费宝贵的时间！如果您想了解更多，请点击</strong>👏<strong class="kd iu"> <em class="kz">这样别人就能看到了</em></strong><strong class="kd iu">最重要的是在社区评论里分享你的经验。</strong></p></div></div>    
</body>
</html>