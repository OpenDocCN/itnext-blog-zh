<html>
<head>
<title>How to Make A Visual Studio Code Extension [to Generate Ducks]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何做一个Visual Studio代码扩展[生成鸭子]</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-make-a-visual-studio-code-extension-77085dce7d82?source=collection_archive---------3-----------------------#2018-06-03">https://itnext.io/how-to-make-a-visual-studio-code-extension-77085dce7d82?source=collection_archive---------3-----------------------#2018-06-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8a2a6c7303104e084adaef70124b6d37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nRsF9jRtt_-gdDwhlCn-9Q.jpeg"/></div></div></figure><p id="60e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">术语“ducks”指的是您必须使用<a class="ae kw" href="https://github.com/alexnm/re-ducks" rel="noopener ugc nofollow" target="_blank"> re-ducks </a>模式创建的用于管理redux状态的文件夹和文件。</p><p id="bf57" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">每只鸭子都需要有六到八个文件，在Visual Studio代码(VS代码)中，每次向项目中添加新的鸭子时手动创建它们是很痛苦的。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="8b52" class="lg lh iq lc b gy li lj l lk ll">/* A typical duck structure from re-ducks */</span><span id="fa4e" class="lg lh iq lc b gy lm lj l lk ll">/state<br/>  /ducks<br/>    /quack<br/>      - actions.js<br/>      - index.js<br/>      - operations.js<br/>      - reducers.js<br/>      - selectors.js // Optional, still generated<br/>      - test.js<br/>      - types.js  <br/>      - utils.js // Not generated</span></pre><h2 id="d788" class="lg lh iq bd ln lo lp dn lq lr ls dp lt kj lu lv lw kn lx ly lz kr ma mb mc md bi translated">设置</h2><p id="898d" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">您需要安装以下工具来创建VS代码的扩展:</p><ul class=""><li id="1305" class="mj mk iq ka b kb kc kf kg kj ml kn mm kr mn kv mo mp mq mr bi translated"><a class="ae kw" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码</a></li><li id="f538" class="mj mk iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated"><a class="ae kw" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Nodejs LTS(目前是8.11.x)和NPM 5.x </a></li></ul><p id="577e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从终端安装Yeoman和Visual Studio代码扩展生成器。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="746c" class="lg lh iq lc b gy li lj l lk ll">npm install -g yo generator-code</span></pre><p id="8ffd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将使用Yeoman创建一个项目模板，使用微软的首选结构和设置来开发扩展。</p><p id="1a6b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在项目文件夹中打开一个终端，运行<code class="fe mx my mz lc b">yo code</code>来启动扩展的生成器。选择“新扩展名(TypeScript)”选项。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/49335f6c9757557eaf29ac8c46e88197.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bAfMdamoVb1oacIJKOEf1w.png"/></div></div></figure><p id="cd59" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回答约曼代码生成器提出的所有问题。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/b90ae6db652faa579354ef689810279f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U6E8_qFyD-nj8ftSyef8Kw.png"/></div></div></figure><p id="f977" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">约曼发电机将产生一个“鸭子发电机”项目，其结构如下:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="82a0" class="lg lh iq lc b gy li lj l lk ll">/duck-generator<br/>  /src<br/>    /test<br/>      - extension.test.ts<br/>      - index.ts<br/>    - extension.ts<br/>  - package.json<br/>  - tsconfig.json<br/>  - tslint.json<br/>  - CHANGELOG.MD<br/>  - README.MD<br/>  - vsc-extension-quickstart.md</span></pre><p id="b398" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些是项目模板中的关键文件:</p><ul class=""><li id="92e3" class="mj mk iq ka b kb kc kf kg kj ml kn mm kr mn kv mo mp mq mr bi translated"><code class="fe mx my mz lc b">package.json</code> —描述扩展以及在哪里可以找到它的入口点和激活触发器。</li><li id="a7b9" class="mj mk iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated"><code class="fe mx my mz lc b">tsconfig.json</code>—TypeScript编译器的配置文件。</li><li id="c5b8" class="mj mk iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated"><code class="fe mx my mz lc b">tslint.json</code> —打字稿林挺规则。</li><li id="6f9c" class="mj mk iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated"><code class="fe mx my mz lc b">CHANGELOG.MD</code> —扩展的变更日志。这将显示在扩展库的“Changelog”部分。</li><li id="c030" class="mj mk iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated"><code class="fe mx my mz lc b">README.MD</code> —对您的扩展的描述。这将显示在扩展图库的“详细信息”部分。</li><li id="be01" class="mj mk iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated"><code class="fe mx my mz lc b">src/**</code> —扩展的存根代码。我们将删除并更改此目录中的文件。</li></ul><h2 id="7fcd" class="lg lh iq bd ln lo lp dn lq lr ls dp lt kj lu lv lw kn lx ly lz kr ma mb mc md bi translated">开发依赖性</h2><p id="1619" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">默认模板包括Mocha测试框架，根据<a class="ae kw" href="https://code.visualstudio.com/docs/extensions/testing-extensions" rel="noopener ugc nofollow" target="_blank">文档</a>，它的行为更像集成测试而不是单元测试:</p><blockquote class="nb nc nd"><p id="1f51" class="jy jz ne ka b kb kc kd ke kf kg kh ki nf kk kl km ng ko kp kq nh ks kt ku kv ij bi translated">…本文档主要关注VS代码集成测试。对于单元测试，你可以使用任何流行的测试框架，比如<a class="ae kw" href="https://mochajs.org/" rel="noopener ugc nofollow" target="_blank"> Mocha </a>或者<a class="ae kw" href="https://jasmine.github.io/" rel="noopener ugc nofollow" target="_blank"> Jasmine </a>。</p></blockquote><p id="5caf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将使用<a class="ae kw" href="https://facebook.github.io/jest/" rel="noopener ugc nofollow" target="_blank"> Jest </a>代替摩卡或茉莉，因为我对它最熟悉。</p><p id="7ea9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过NPM安装工具以在TypeScript中使用Jest:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="315f" class="lg lh iq lc b gy li lj l lk ll">npm install --save-dev jest ts-jest @types/jest</span></pre><p id="7309" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">包装:</p><ul class=""><li id="cd81" class="mj mk iq ka b kb kc kf kg kj ml kn mm kr mn kv mo mp mq mr bi translated"><code class="fe mx my mz lc b"><a class="ae kw" href="https://facebook.github.io/jest/" rel="noopener ugc nofollow" target="_blank">jest</a></code> —单元测试框架。</li><li id="b302" class="mj mk iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated"><code class="fe mx my mz lc b"><a class="ae kw" href="https://www.npmjs.com/package/ts-jest" rel="noopener ugc nofollow" target="_blank">ts-jest</a></code> —允许运行用TypeScript编写的jest测试的预处理器。</li><li id="8ce4" class="mj mk iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated"><code class="fe mx my mz lc b">@types/jest</code>—jest测试框架的打字稿定义。这个包将在用TypeScript编写jest测试时提供智能感知。</li></ul><h2 id="6b57" class="lg lh iq bd ln lo lp dn lq lr ls dp lt kj lu lv lw kn lx ly lz kr ma mb mc md bi translated">鸭子发电机</h2><p id="f24c" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">我们将创建一个包含创建鸭子的逻辑的类。</p><p id="44a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先在<code class="fe mx my mz lc b">src</code>目录下创建一个名为<code class="fe mx my mz lc b">duck-generator.ts</code>的文件。打开文件并存根函数。为简单起见，让它们都成为公共函数。</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="ni nj l"/></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">此类测试可在找到<a class="ae kw" href="https://github.com/vanister/duck-generator/blob/master/src/test/duck-generator.test.ts" rel="noopener ugc nofollow" target="_blank">。</a></figcaption></figure><p id="2851" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当扩展执行时，它将调用<code class="fe mx my mz lc b">DuckGenerator.execute()</code>函数来启动提示输入名称、验证输入、创建本地目录的绝对路径，最后为duck创建文件的流程。</p><p id="3bf5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们实现这些功能，从最简单的开始。</p><p id="3031" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">构造函数将接受我们从主扩展文件传入的两个参数。这将允许我们为<code class="fe mx my mz lc b">DuckGenerator</code>编写测试，而不必担心模仿vscode sdk模块中的<code class="fe mx my mz lc b">import</code>语句或模块。</p><p id="81f2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意:由于我们不想导入整个vscode sdk，我们将创建一个自定义接口(<code class="fe mx my mz lc b"><a class="ae kw" href="https://github.com/vanister/duck-generator/blob/master/src/vscode.interfaces.ts" rel="noopener ugc nofollow" target="_blank">VSCodeWindow</a></code>)，为sdk的窗口命名空间提供智能感知。</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="593a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mx my mz lc b">toAbsolutePath</code>功能。</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="b95a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mx my mz lc b">validate</code>功能。</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="7153" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mx my mz lc b">prompt</code>功能。</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="f7ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mx my mz lc b">create</code>功能。</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="a1cf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mx my mz lc b">execute</code>功能。</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="4aed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我决定将单元测试代码排除在文章之外，因为我认为这会使文章代码太多。如果你想看这个文件的测试，可以在这里找到<a class="ae kw" href="https://github.com/vanister/duck-generator/blob/master/src/test/duck-generator.test.ts" rel="noopener ugc nofollow" target="_blank"/>。</p><h2 id="64e8" class="lg lh iq bd ln lo lp dn lq lr ls dp lt kj lu lv lw kn lx ly lz kr ma mb mc md bi translated">实用程序、接口和错误</h2><p id="d1c3" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">我们将添加一个带有函数的实用模块，我们可以使用它来确定工作区文件夹在项目的当前上下文中的位置。我们将这段代码放入它自己的模块中，这样我们就可以独立于生成器和扩展入口点来测试它。</p><p id="17e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建一个名为<code class="fe mx my mz lc b">utils</code>的文件夹，并向其中添加一个名为<code class="fe mx my mz lc b">workspace-util.ts</code>的文件。从中导出一个函数，该函数将允许我们从扩展入口点调用来获取工作区根。</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="ni nj l"/></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">此处的<a class="ae kw" href="https://github.com/vanister/duck-generator/blob/master/src/test/utils/workspace-util.test.ts" rel="noopener ugc nofollow" target="_blank">为该模块的测试</a>。</figcaption></figure><p id="3715" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mx my mz lc b">DuckGenerator</code>实现了一个<code class="fe mx my mz lc b">IDisposable</code>接口，这样当扩展被销毁时，就会调用一个dispose函数。即使我们不打算使用它，让我们添加它，这样，如果我们确实从sdk或节点引入了任何稍后需要清理的资源，我们可以在dispose函数中这样做。</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="af0e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当用户试图创建一只已经存在的鸭子时，我们在类型<code class="fe mx my mz lc b">DuckExistError</code>上抛出一个错误，这是一个我们需要创建的自定义错误。</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="ni nj l"/></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">对该错误的测试是<a class="ae kw" href="https://github.com/vanister/duck-generator/blob/master/src/test/errors/duck-exists.error.test.ts" rel="noopener ugc nofollow" target="_blank">这里是</a>。</figcaption></figure><h2 id="2c4b" class="lg lh iq bd ln lo lp dn lq lr ls dp lt kj lu lv lw kn lx ly lz kr ma mb mc md bi translated">扩展</h2><p id="ff07" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">扩展的入口点在用Yeoman项目模板创建的<code class="fe mx my mz lc b">extension.ts</code>文件中。让我们编辑它，以便在激活扩展时调用我们的<code class="fe mx my mz lc b">DuckGenerator</code>。</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="86aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们没有向入口点文件添加任何功能。它的主要目的是充当我们编写和测试的代码的驱动程序，以及由vscode sdk提供的代码，以使扩展工作。</p><h2 id="f593" class="lg lh iq bd ln lo lp dn lq lr ls dp lt kj lu lv lw kn lx ly lz kr ma mb mc md bi translated">包扎</h2><p id="95c4" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">也就是说，扩展已经准备好进行测试、打包并发布到Visual Studio代码扩展库中。</p><p id="0773" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你想在本地测试扩展，只需选择“扩展调试”，启动设置并按下调试(播放按钮)或<code class="fe mx my mz lc b">F5</code>。</p><p id="4fcb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以通过安装来自NPM的<code class="fe mx my mz lc b">vsce</code>包来打包扩展。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="95a5" class="lg lh iq lc b gy li lj l lk ll">npm install -g vsce</span><span id="a406" class="lg lh iq lc b gy lm lj l lk ll">// package locally, run from extension project root<br/>vsce package</span></pre><p id="910a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您想发布该扩展，请查看微软的发布指南:<a class="ae kw" href="https://code.visualstudio.com/docs/extensions/publish-extension" rel="noopener ugc nofollow" target="_blank">https://code . visual studio . com/docs/extensions/publish-extension</a>。</p><p id="79d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇文章的代码可以在GitHub上找到:<a class="ae kw" href="https://github.com/vanister/duck-generator/tree/medium-article" rel="noopener ugc nofollow" target="_blank">https://GitHub . com/vanister/duck-generator/tree/medium-article</a>。</p><p id="5815" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我发表这个扩展到画廊:【https://marketplace.visualstudio.com/items? T4】itemName = vanister . duck generator。</p><p id="8598" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">享受制作和发布扩展！</p></div></div>    
</body>
</html>