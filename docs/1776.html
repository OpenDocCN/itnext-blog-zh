<html>
<head>
<title>Things that can go wrong without a strictly typed language — Part I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">没有严格类型化语言可能出错的事情—第一部分</h1>
<blockquote>原文：<a href="https://itnext.io/things-that-can-go-wrong-without-a-strictly-typed-language-d91d418a53a1?source=collection_archive---------0-----------------------#2019-01-26">https://itnext.io/things-that-can-go-wrong-without-a-strictly-typed-language-d91d418a53a1?source=collection_archive---------0-----------------------#2019-01-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e000" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">又名“好儿子”</p><blockquote class="kl km kn"><p id="b7e3" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">第一部分:Vue和Elm</p><p id="8d68" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated"><a class="ae ks" href="https://medium.com/@l.mugnaini/things-that-can-go-wrong-without-a-strictly-typed-language-part-ii-8b239a85f35a" rel="noopener">第二部分:反应</a></p></blockquote><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi kt"><img src="../Images/d50b2a495f02d5357a4e2d7dad135527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AcpoISFh7qM-K5kZeexJ0g.jpeg"/></div></div></figure><p id="5ca9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我主要用Elm编写代码，但是前几天我看了一下Vue，写了一个从教程视频中复制的小例子。<strong class="jp ir">出了几个问题</strong>。</p><p id="fe76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个例子:</p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="07b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个工作演示:<a class="ae ks" href="https://codepen.io/lucamug/pen/aXdPqw" rel="noopener ugc nofollow" target="_blank">https://codepen.io/lucamug/pen/aXdPqw</a></p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="lh lg l"/></div></figure><p id="7e66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个简单的应用程序，它发送一个HTTP请求，检索产品列表，将它们与库存数量一起列出，并让用户编辑数量或用一个显示库存总数的按钮将数量加1:</p><p id="bdd1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">…但是</p><h1 id="e56d" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">#1“总库存”不起作用</h1><p id="342c" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">虽然“添加1”按钮工作正常，但在输入字段中键入数字会产生错误的结果:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/87122ad8ee4eebdad62673ee99311d3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*f9v3uuMJk2pqZaCRGiupZg.gif"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated"><a class="ae ks" href="https://codepen.io/lucamug/pen/aXdPqw" rel="noopener ugc nofollow" target="_blank">密码笔</a></figcaption></figure><p id="30fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们键入<strong class="jp ir"> 123 </strong>。什么？<strong class="jp ir"> 01123052 </strong>从哪里来？我猜有人试图连接字符串，而不是添加数字。还要注意的是，数量列表现在是<strong class="jp ir">[“1123”，0，5，2] </strong>。</p><p id="5b6b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在对Vue文档进行了一些研究之后，我发现了<a class="ae ks" href="https://vuejs.org/v2/guide/forms.html#number" rel="noopener ugc nofollow" target="_blank">这个</a>:</p><p id="3500" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您希望用户输入自动转换为数字，您可以将数字修饰符添加到您的<code class="fe mq mr ms mt b">v-model</code>托管输入中</p><p id="293c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这听起来正是我们所需要的。让我们将它添加到脚本的第3行:</p><p id="71ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从</p><pre class="ku kv kw kx gt mu mt mv mw aw mx bi"><span id="d6f0" class="my lj iq mt b gy mz na l nb nc">&lt;input type="number" v-model="product.quantity"&gt;</span></pre><p id="f323" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到</p><pre class="ku kv kw kx gt mu mt mv mw aw mx bi"><span id="b6fb" class="my lj iq mt b gy mz na l nb nc">&lt;input type="number" v-model.<strong class="mt ir">number</strong>="product.quantity"&gt;</span></pre><p id="ed99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">固定！</p><h1 id="5f9d" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">#2“总库存”又破了！</h1><p id="e337" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">现在输入数字可以了，但是如果我们删除所有的数字，我们又会遇到上面讨论的同样的问题。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/aa65edbcbe72f0875c8cf457c74317eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*h_L3-T5ZP7gI5yiU87dqEw.gif"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated"><a class="ae ks" href="https://codepen.io/lucamug/pen/zerQda" rel="noopener ugc nofollow" target="_blank">密码笔</a></figcaption></figure><p id="529b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，也许我们应该重构计算总库存的函数。</p><p id="c893" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们在第20行添加一个条件，如果数量不是一个数字，这个值将被忽略。</p><p id="6f7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从</p><pre class="ku kv kw kx gt mu mt mv mw aw mx bi"><span id="8ff5" class="my lj iq mt b gy mz na l nb nc">totalProducts() {<br/>    return this.products.reduce((sum, product) =&gt; {<br/>        return sum + product.quantity<br/>    }, 0)<br/>}</span></pre><p id="4262" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到</p><pre class="ku kv kw kx gt mu mt mv mw aw mx bi"><span id="7862" class="my lj iq mt b gy mz na l nb nc">totalProducts() {<br/>    return this.products.reduce((sum, product) =&gt; {<br/>        <strong class="mt ir">if (typeof product.quantity === "number") {<br/>            return sum + product.quantity;<br/>        } else {<br/>            return sum;<br/>        }</strong><br/>    }, 0)<br/>}</span></pre><p id="f1f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">固定！</p><h1 id="eda3" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">#3“添加1”按钮有时不起作用</h1><p id="a743" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">如果在删除所有数字或键入非数字字符后按下该按钮，则该按钮不起作用:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi ml"><img src="../Images/835d6ace2d11844110aef6f02a46640b.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*_vaISrBYSohZbGl2wWcX_g.gif"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated"><a class="ae ks" href="https://codepen.io/lucamug/pen/wNMbrW" rel="noopener ugc nofollow" target="_blank"> codepen </a></figcaption></figure><p id="8479" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，是时候修理这个了。让我们将添加1(第4行)的命令从</p><pre class="ku kv kw kx gt mu mt mv mw aw mx bi"><span id="736b" class="my lj iq mt b gy mz na l nb nc">&lt;button @click="product.quantity += 1"&gt;</span></pre><p id="5e10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到</p><pre class="ku kv kw kx gt mu mt mv mw aw mx bi"><span id="6e3e" class="my lj iq mt b gy mz na l nb nc">&lt;button @click="product.quantity = <strong class="mt ir">Number</strong>(product.quantity) + 1"&gt;</span></pre><p id="b52e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">固定！</p><h1 id="8b52" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">Vue/Javascript体验</h1><p id="0927" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">也许这些问题来自于我对Vue知识的缺乏，但我期待一个更顺畅的体验。</p><p id="3f00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">也许使用神奇的双向数据绑定器<code class="fe mq mr ms mt b">v-model</code>不是一个好的实践，我们应该使用单向绑定？</p><p id="5c3a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">即使应用程序现在工作了，数量数组仍然包含字符串和数字的混合，这是将来其他问题的前奏。例如，当这些数据需要永久保存在某个地方时。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/a350b6115c8a4a9d94bdc4136c32b320.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/format:webp/1*J4maAJWzD8fIRb53OSnT7A.png"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated"><a class="ae ks" href="https://codepen.io/lucamug/pen/xMZNXy" rel="noopener ugc nofollow" target="_blank">密码笔</a></figcaption></figure><p id="e738" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，上述所有问题都是使用应用程序检测到的，而不是由开发环境自动检测到的。它们很容易被发现并投入生产。</p><h1 id="068c" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">榆树经验</h1><p id="55c4" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">榆树版演示:【https://ellie-app.com/4yx6ZpH7w2Ra1 T2】</p><p id="d6bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是代码。它由两部分组成，一个用于加载和初始化页面的小html部分，以及将编译成Javascript的Elm代码:</p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="0eca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Elm迫使我们考虑更多的案例，比如导致上述问题的案例。</p><p id="c983" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">数量是整数类型，所以不可能在其中存储任何字符串。</p><p id="e8ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在保存之前，我们需要将从输入字段获得的字符串转换成整数。然后我们需要在页面中显示它之前将其转换回字符串。</p><p id="a066" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在从字符串到整数的转换过程中，可能会出错，例如当字符串不包含有效数字时。同样在这种情况下榆树想从我们这里知道我们想如何处理这样的情况。</p><p id="9d71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中重要的一部分是，如上所述，当我们从字符串转换为整数时:</p><pre class="ku kv kw kx gt mu mt mv mw aw mx bi"><span id="bb26" class="my lj iq mt b gy mz na l nb nc">{ product<br/>    | quantity = <br/>        Maybe.withDefault product.quantity<br/>            (String.toInt newQuantity)<br/>}</span></pre><p id="bdf3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这段代码说:“如果用户输入了一个有效的号码，用新号码替换旧号码，否则保留旧号码”</p><p id="3656" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Elm版本不允许任何不可能的状态，所以它不允许删除输入字段中的所有数字，因为那不是一个有效的数字。这使得改变一位数变得困难。例如，这可以通过检查字符串是否为空并将其转换为0来解决。但是这里我们将进入与类型号输入字段相关的<a class="ae ks" href="https://codepen.io/lucamug/pen/qgbyaE" rel="noopener ugc nofollow" target="_blank">问题</a>的领域。</p><p id="dfc8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在任何情况下，总库存总是正确的，并且数量列表总是包含开箱即用的数字。</p><p id="f8e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Elm强迫我们考虑其他事情，例如HTTP请求失败的情况，但是这些超出了本文的范围。所以在Elm版本中，我们忽略了这个请求，只返回旧的产品列表，不返回命令:</p><pre class="ku kv kw kx gt mu mt mv mw aw mx bi"><span id="b825" class="my lj iq mt b gy mz na l nb nc">GotProducts (Err _) -&gt;<br/>    ( products, Cmd.none )</span></pre><h1 id="3d6a" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">关闭HTML元素</h1><p id="6543" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">有一件事我很久没有做了，那就是编写HTML，特别是关闭HTML元素。在Elm工作之前，我一直在使用HAML、杰德和帕格。</p><p id="7a45" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个例子中工作让我想起了过去的美好时光，那时我打开一个<div>并关闭一个。</div></p><h1 id="f536" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">打字稿</h1><p id="e226" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">虽然有几种类型输入错误会在Vue中产生运行时错误，但还有一些错误没有被检测出来。例如改变</p><pre class="ku kv kw kx gt mu mt mv mw aw mx bi"><span id="b05c" class="my lj iq mt b gy mz na l nb nc">&lt;input v-model.number="product.quantity"&gt;</span></pre><p id="7aa0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到…里面</p><pre class="ku kv kw kx gt mu mt mv mw aw mx bi"><span id="efb8" class="my lj iq mt b gy mz na l nb nc">&lt;input v-model.number="product.quanity"&gt;</span></pre><p id="f2ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不显示任何错误，但应用程序被破坏(所有输入字段都是空的，在它们中键入什么都不会发生。按钮仍在工作)。</p><p id="be7e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其他错误只会在界面上交互时显示，而不会在加载时显示。</p><p id="ed4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Elm中，上面的错别字会在编译时生成以下错误:</p><pre class="ku kv kw kx gt mu mt mv mw aw mx bi"><span id="550d" class="my lj iq mt b gy mz na l nb nc">Detected errors in 1 module.<br/>-- TYPE MISMATCH ----------------------------------------- Main.elm</span><span id="57c8" class="my lj iq mt b gy ne na l nb nc">The 2nd argument to `map` is not what I expect:</span><span id="951f" class="my lj iq mt b gy ne na l nb nc">84|                 products<br/>                    ^^^^^^^^</span><span id="3aea" class="my lj iq mt b gy ne na l nb nc">This `products` value is a:</span><span id="23ab" class="my lj iq mt b gy ne na l nb nc">List Product</span><span id="dd3d" class="my lj iq mt b gy ne na l nb nc">But `map` needs the 2nd argument to be:</span><span id="9e24" class="my lj iq mt b gy ne na l nb nc">List { a | id : Int, name : String, quanity : Int, quantity : Int }</span><span id="923b" class="my lj iq mt b gy ne na l nb nc">Hint: Seems like a record field typo. Maybe quanity should be quantity?</span></pre><p id="27d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意底部的“提示”部分。</p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><p id="2385" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些问题大多来自Javascript，但我认为Vue会对我们屏蔽这些问题。对于其他框架，这种体验会有所不同吗？TypeScript或Flow能解决这些问题吗？请在下面留下您的评论。</p><p id="e59a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您喜欢这篇文章，您可能会对第2部分感兴趣，在第2部分中，我使用React做了同样的练习:<a class="ae ks" href="https://medium.com/@l.mugnaini/things-that-can-go-wrong-without-a-strictly-typed-language-part-ii-8b239a85f35a" rel="noopener">https://medium . com/@ l . mugnaini/things-that-can-go-error-without-a-strict-typed-language-part-ii-8b 239 a 85 f 35 a</a></p><p id="3f32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您的阅读！</p></div></div>    
</body>
</html>