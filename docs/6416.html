<html>
<head>
<title>How to test your GitHub Pull Requests with CodeSandbox CI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用CodeSandbox CI测试您的GitHub Pull请求</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-test-your-github-pull-requests-with-codesandbox-ci-a7945f166fa?source=collection_archive---------3-----------------------#2021-11-11">https://itnext.io/how-to-test-your-github-pull-requests-with-codesandbox-ci-a7945f166fa?source=collection_archive---------3-----------------------#2021-11-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/43226f76eef955c3c575da9def2ad116.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iTiol81v7U8qzoq5.jpg"/></div></div></figure><p id="bb72" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你是一个开源项目维护者，或者你计划构建一个，你应该考虑在你的项目配置中使用CodeSandbox CI。CodeSandbox CI这是一个很棒的GitHub应用程序，可以根据请求自动构建你的开源项目。这可以节省测试和批准变更的大量时间和精力。</p><h1 id="3fa3" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">它是如何工作的？</h1><p id="bb7c" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">每当有人打开一个新的pull请求时，CodeSandbox CI都会为您的项目构建一个新版本。这些构建被发布到CodeSandbox注册表，因此您可以在那里或本地测试它，而无需将构建发布到<code class="fe lz ma mb mc b">npm⁠</code>。</p><h1 id="b5e9" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">我如何设置它？</h1><p id="9613" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">让我们创建一个演示项目来看看CodeSandbox CI的运行情况。为此，在GitHub上创建一个新项目，并将其命名为，例如，<code class="fe lz ma mb mc b">codesandbox-ci-test</code>。在本地克隆并添加一个<code class="fe lz ma mb mc b">package.json</code>文件，内容如下:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="26df" class="ml kx iq mc b gy mm mn l mo mp">{<br/>  "name": "codesandbox-ci-test",<br/>  "version": "1.0.0",<br/>  "main": "dist/index.js",<br/>  "engines": {<br/>    "node": "&gt;=12"<br/>  },<br/>  "scripts": {<br/>    "build": "kcd-scripts build"<br/>  },<br/>  "peerDependencies": {<br/>    "react": "^17.0.2"<br/>  },<br/>  "devDependencies": {<br/>    "kcd-scripts": "^11.2.2",<br/>    "react": "^17.0.2"<br/>  },<br/>  "dependencies": {<br/>    "@babel/runtime": "^7.16.0"<br/>  }<br/>}</span></pre><p id="7daf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一个JavaScript项目的标准package.json文件。我们将使用<code class="fe lz ma mb mc b">kcd-scripts</code>来构建我们的项目，并且我们将使用<code class="fe lz ma mb mc b">react</code>来为这个演示创建一个小的可重用组件。<code class="fe lz ma mb mc b">@babel/runtime</code>是<code class="fe lz ma mb mc b">kcd-scripts</code>所要求的，否则不会构建项目。</p><p id="8be9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe lz ma mb mc b">src/index.js</code>中创建一个简单的计数器组件:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="dcb6" class="ml kx iq mc b gy mm mn l mo mp">import * as React from 'react';<br/><br/>export default function Counter() {<br/>  const [count, setCount] = React.useState(0);<br/><br/>  return (<br/>    &lt;div&gt;<br/>      &lt;p&gt;You clicked {count} times!!!&lt;/p&gt;<br/>      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;Click me&lt;/button&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="cdc5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将来自https://github.com/apps/codesandbox<a class="ae mq" href="https://github.com/apps/codesandbox" rel="noopener ugc nofollow" target="_blank">的CodeSandbox Github应用程序安装到我们的新仓库中。</a></p><p id="5978" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在存储库根目录下名为<code class="fe lz ma mb mc b">.codesandbox</code>的文件夹中创建一个名为<code class="fe lz ma mb mc b">ci.json</code>的文件，并添加:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="7422" class="ml kx iq mc b gy mm mn l mo mp">{<br/>  "buildCommand": "build",<br/>  "node": "12",<br/>  "sandboxes": ["/cra-template"]<br/>}</span></pre><ul class=""><li id="9d68" class="mr ms iq ka b kb kc kf kg kj mt kn mu kr mv kv mw mx my mz bi translated"><code class="fe lz ma mb mc b">buildCommand</code>表示应该运行package.json中的哪个脚本来构建项目。</li><li id="af8b" class="mr ms iq ka b kb na kf nb kj nc kn nd kr ne kv mw mx my mz bi translated"><code class="fe lz ma mb mc b">node</code>是用于构建PR的Node.js版本。</li><li id="6f5e" class="mr ms iq ka b kb na kf nb kj nc kn nd kr ne kv mw mx my mz bi translated"><code class="fe lz ma mb mc b">sandboxes</code>是我们想要生成的沙箱列表。默认值为<code class="fe lz ma mb mc b">vanilla</code>。</li></ul><p id="1a52" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们不想使用默认的沙箱，因为我们必须手动修改沙箱代码来导入和显示计数器组件。相反，我们将创建一个定制模板，命名为<code class="fe lz ma mb mc b">cra-template</code>。</p><p id="8a51" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建一个名为<code class="fe lz ma mb mc b">cra-template</code>的新文件夹，在这个文件夹中创建一个<code class="fe lz ma mb mc b">package.json</code>:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="c08d" class="ml kx iq mc b gy mm mn l mo mp">{<br/>  "name": "react-starter-example",<br/>  "version": "1.0.0",<br/>  "description": "React example starter project",<br/>  "main": "src/index.js",<br/>  "dependencies": {<br/>    "react": "17.0.2",<br/>    "react-dom": "17.0.2",<br/>    "react-scripts": "4.0.0"<br/>  },<br/>  "devDependencies": {<br/>    "@babel/runtime": "7.13.8",<br/>    "typescript": "4.1.3"<br/>  },<br/>  "scripts": {<br/>    "start": "react-scripts start",<br/>    "build": "react-scripts build",<br/>    "test": "react-scripts test --env=jsdom",<br/>    "eject": "react-scripts eject"<br/>  },<br/>  "browserslist": ["&gt;0.2%", "not dead", "not ie &lt;= 11", "not op_mini all"]<br/>}</span></pre><p id="34ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用以下内容创建一个<code class="fe lz ma mb mc b">src</code>文件夹和一个<code class="fe lz ma mb mc b">index.js</code>文件:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="bd3f" class="ml kx iq mc b gy mm mn l mo mp">import { StrictMode } from 'react';<br/>import ReactDOM from 'react-dom';<br/>import Counter from 'codesandbox-ci-test';<br/><br/>const rootElement = document.getElementById('root');<br/>ReactDOM.render(<br/>  &lt;StrictMode&gt;<br/>    &lt;Counter /&gt;<br/>  &lt;/StrictMode&gt;,<br/>  rootElement<br/>);</span></pre><p id="8503" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用一个<code class="fe lz ma mb mc b">index.html</code>文件创建一个<code class="fe lz ma mb mc b">public</code>文件夹:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="9435" class="ml kx iq mc b gy mm mn l mo mp">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="utf-8" /&gt;<br/>    &lt;meta<br/>      name="viewport"<br/>      content="width=device-width, initial-scale=1, shrink-to-fit=no"<br/>    /&gt;<br/>    &lt;meta name="theme-color" content="#000000" /&gt;<br/>    &lt;link rel="manifest" href="%PUBLIC_URL%/manifest.json" /&gt;<br/>    &lt;link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico" /&gt;<br/>    &lt;title&gt;React App&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;noscript&gt; You need to enable JavaScript to run this app. &lt;/noscript&gt;<br/>    &lt;div id="root"&gt;&lt;/div&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="5db2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此时，我们可以创建一个新的拉请求，并查看我们的配置运行情况。CodeSandbox CI应用程序将构建项目，并将在pull请求上留下注释。</p><figure class="md me mf mg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/e4b60b4516ff110b1406fbafa798a2da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sc70amV4kgG4uZNB4wRwmg.jpeg"/></div></div></figure><p id="e606" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以查看以下链接来查看结果:</p><ul class=""><li id="e280" class="mr ms iq ka b kb kc kf kg kj mt kn mu kr mv kv mw mx my mz bi translated">PRs的CodeSandbox CI仪表板:<a class="ae mq" href="https://ci.codesandbox.io/status/abereghici/codesandbox-ci-test/pr/1/builds/186555" rel="noopener ugc nofollow" target="_blank">https://CI . code sandbox . io/status/abereghici/code sandbox-CI-test/pr/1/builds/186555</a></li><li id="d045" class="mr ms iq ka b kb na kf nb kj nc kn nd kr ne kv mw mx my mz bi translated">code sandbox app:【https://codesandbox.io/s/react-zmd24 T2】</li></ul><h1 id="cd3b" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">有用的链接和文档</h1><p id="80ce" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">如果您在这个过程中遇到了任何问题，请使用本文中的代码检查Github库【https://github.com/abereghici/codesandbox-ci-test<a class="ae mq" href="https://github.com/abereghici/codesandbox-ci-test" rel="noopener ugc nofollow" target="_blank">的</a>。</p><p id="e295" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你对在mono-repo项目中使用CodeSandbox CI感兴趣，你可以查看来自Twilio<a class="ae mq" href="https://github.com/twilio-labs/paste" rel="noopener ugc nofollow" target="_blank">https://github.com/twilio-labs/paste</a>的设计系统项目，看看它们的配置。</p><p id="8f47" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有关CodeSandbox CI的更多信息，请查看<a class="ae mq" href="https://codesandbox.io/docs/ci" rel="noopener ugc nofollow" target="_blank">文档</a>。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><p id="5eae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nn">最初发布于2021年11月10日</em><a class="ae mq" href="https://bereghici.dev/blog/how-to-test-your-github-pull-requests-with-codesandbox-ci" rel="noopener ugc nofollow" target="_blank"><em class="nn">https://</em>bereghici . dev</a><em class="nn">。</em></p></div></div>    
</body>
</html>