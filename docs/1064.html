<html>
<head>
<title>Mocking Vue.js global objects in vue-test-utils</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在vue-test-utils中模仿Vue.js全局对象</h1>
<blockquote>原文：<a href="https://itnext.io/mocking-global-objects-in-vue-test-utils-a8822df013a8?source=collection_archive---------1-----------------------#2018-07-15">https://itnext.io/mocking-global-objects-in-vue-test-utils-a8822df013a8?source=collection_archive---------1-----------------------#2018-07-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ebe471ee78559615813d14076cfd9462.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7SphAE0YVFDwRQxMPG8VxA.png"/></div></div></figure><p id="a6ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">vue-test-utils</code>提供了一种简单的方法来模拟连接到<code class="fe kw kx ky kz b">Vue.prototype</code>的全局对象，既可以逐个测试，也可以为所有测试设置默认模拟。</p><p id="a65a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以下示例中使用的测试可在处找到<a class="ae la" href="https://github.com/lmiller1990/vue-testing-handbook/blob/master/demo-app/tests/unit/Bilingual.spec.js" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><figure class="lj lk ll lm gt jr gh gi paragraph-image"><a href="http://vuejs-course.com/"><div class="gh gi li"><img src="../Images/8860e8ef1f39967845929ca6a9e3821a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g_RGGAoqizZjbVse93Z4TQ.png"/></div></a><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">来看看我的<a class="ae la" href="https://vuejs-course.com/" rel="noopener ugc nofollow" target="_blank"> Vue.js 3课程</a>！我们涵盖了组合API、类型脚本、单元测试、Vuex和Vue路由器。</figcaption></figure></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="5f67" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">模拟安装选项</h1><p id="f7e3" class="pw-post-body-paragraph jy jz iq ka b kb mp kd ke kf mq kh ki kj mr kl km kn ms kp kq kr mt kt ku kv ij bi translated">模拟挂载选项是设置附属于<code class="fe kw kx ky kz b">Vue.prototype</code>的任何属性的值的一种方式。这通常包括:</p><ul class=""><li id="5b49" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated"><code class="fe kw kx ky kz b">$store</code>，用于Vuex</li><li id="448a" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated"><code class="fe kw kx ky kz b">$router</code>，用于Vue路由器</li><li id="ab9e" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated"><code class="fe kw kx ky kz b">$t</code>，用于vue-i18n</li></ul><p id="1ea2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">和许多其他人。</p><h1 id="4133" class="lr ls iq bd lt lu ni lw lx ly nj ma mb mc nk me mf mg nl mi mj mk nm mm mn mo bi translated">vue-i18n示例</h1><p id="bd8a" class="pw-post-body-paragraph jy jz iq ka b kb mp kd ke kf mq kh ki kj mr kl km kn ms kp kq kr mt kt ku kv ij bi translated">与Vuex和Vue路由器一起使用将在相应章节中讨论，此处的<a class="ae la" href="https://lmiller1990.github.io/vue-testing-handbook/vuex-in-components.html" rel="noopener ugc nofollow" target="_blank">和此处的</a>和<a class="ae la" href="https://lmiller1990.github.io/vue-testing-handbook/vue-router.html" rel="noopener ugc nofollow" target="_blank"/>。我们来看一个<a class="ae la" href="https://github.com/kazupon/vue-i18n" rel="noopener ugc nofollow" target="_blank"> vue-i18n </a>的例子。虽然可以为每个测试使用<code class="fe kw kx ky kz b">createLocalVue</code>并安装<code class="fe kw kx ky kz b">vue-i18n</code>，但这很快会变得很麻烦，并引入许多样板文件。首先，一个使用<code class="fe kw kx ky kz b">vue-i18n</code>的<code class="fe kw kx ky kz b">&lt;Bilingual&gt;</code>组件:</p><figure class="lj lk ll lm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="4097" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">vue-i18n</code>的工作方式是你在另一个文件中声明你的翻译，然后用<code class="fe kw kx ky kz b">$t</code>引用它们。对于这个测试来说，翻译文件看起来像什么并不重要，但是对于这个组件来说，它看起来像这样:</p><figure class="lj lk ll lm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="77e2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根据语言环境，会呈现正确的翻译。让我们试着在测试中渲染组件，不要有任何嘲讽。</p><figure class="lj lk ll lm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="303e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用<code class="fe kw kx ky kz b">yarn test:unit</code>运行这个测试会抛出一个巨大的堆栈跟踪。如果仔细查看输出，您可以看到:</p><figure class="lj lk ll lm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="2fa9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是因为我们没有安装<code class="fe kw kx ky kz b">vue-i18n</code>，所以全局<code class="fe kw kx ky kz b">$t</code>方法不存在。让我们用<code class="fe kw kx ky kz b">mocks</code>安装选项来模拟一下:</p><figure class="lj lk ll lm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="e4da" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在测试通过了！<code class="fe kw kx ky kz b">mocks</code>选项有很多用途。我经常发现自己在嘲笑上面提到的三个包提供的全局对象。</p><h1 id="910e" class="lr ls iq bd lt lu ni lw lx ly nj ma mb mc nk me mf mg nl mi mj mk nm mm mn mo bi translated">使用配置设置默认模拟</h1><p id="af27" class="pw-post-body-paragraph jy jz iq ka b kb mp kd ke kf mq kh ki kj mr kl km kn ms kp kq kr mt kt ku kv ij bi translated">有时您希望mock有一个缺省值，所以不要逐个测试地创建它。您可以使用由<code class="fe kw kx ky kz b">vue-test-utils</code>提供的<a class="ae la" href="https://vue-test-utils.vuejs.org/api/#vue-test-utils-config-options" rel="noopener ugc nofollow" target="_blank">配置</a> API来完成这项工作。让我们扩展一下<code class="fe kw kx ky kz b">vue-i18n</code>的例子。通过执行以下操作，您可以在任何地方设置默认模拟:</p><figure class="lj lk ll lm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="432d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本指南的演示项目使用Jest，所以我将在<code class="fe kw kx ky kz b">jest.init.js</code>中声明默认的mock，它在测试自动运行之前加载。我还将导入前面的示例翻译对象，并在模拟实现中使用它。</p><figure class="lj lk ll lm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="942d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在一个真正的翻译将被呈现，尽管使用了一个被模仿的<code class="fe kw kx ky kz b">$t</code>函数。再次运行测试，这次使用<code class="fe kw kx ky kz b">wrapper.html()</code>上的<code class="fe kw kx ky kz b">console.log</code>并移除<code class="fe kw kx ky kz b">mocks</code>安装选项:</p><figure class="lj lk ll lm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="487e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">测试通过，并呈现以下标记:</p><figure class="lj lk ll lm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="362b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在这里阅读关于使用<code class="fe kw kx ky kz b">mocks</code>测试Vuex <a class="ae la" href="https://lmiller1990.github.io/vue-testing-handbook/vuex-in-components.html#using-a-mock-store" rel="noopener ugc nofollow" target="_blank">的内容。技术是一样的。</a></p><h1 id="414c" class="lr ls iq bd lt lu ni lw lx ly nj ma mb mc nk me mf mg nl mi mj mk nm mm mn mo bi translated">结论</h1><p id="d7ef" class="pw-post-body-paragraph jy jz iq ka b kb mp kd ke kf mq kh ki kj mr kl km kn ms kp kq kr mt kt ku kv ij bi translated">本指南讨论了:</p><ul class=""><li id="2530" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">使用<code class="fe kw kx ky kz b">mocks</code>逐个测试地模仿一个全局对象</li><li id="10e2" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated">使用<code class="fe kw kx ky kz b">config.mocks</code>设置默认模拟</li></ul></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="acc9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最初发表于<a class="ae la" href="https://github.com/lmiller1990/vue-testing-handbook" rel="noopener ugc nofollow" target="_blank"> Vue测试手册</a>。</p></div></div>    
</body>
</html>