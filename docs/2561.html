<html>
<head>
<title>Edge-Focused Compact Kubernetes with MicroPaaS (μPaaS) — k3s/k3OS and Rio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">边缘聚焦紧凑型Kubernetes和MicroPaaS (μPaaS) — k3s/k3OS和Rio</h1>
<blockquote>原文：<a href="https://itnext.io/edge-focused-compact-kubernetes-with-micropaas-%CE%BCpaas-k3s-k3os-and-rio-6f7d758e19f1?source=collection_archive---------0-----------------------#2019-06-15">https://itnext.io/edge-focused-compact-kubernetes-with-micropaas-%CE%BCpaas-k3s-k3os-and-rio-6f7d758e19f1?source=collection_archive---------0-----------------------#2019-06-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/605c7d94decb5aafc52521f9380d8c33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nMHyBJD5KbaqUYYUGXqYMg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">面向边缘、物联网和电信平台的轻量级Kubernetes平台，具有最少的PaaS</figcaption></figure><div class=""/><p id="ecb5" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">边缘资源通常是有限的，但是，在数据中心或公共云环境中，促进Kubernetes bare最低2–4gb的最低RAM要求可能不是问题，另一方面，这将成为边缘计算的限制因素，因为用户无法使用具有多个包依赖关系的大量Kubernetes发行版。</p><p id="da11" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这就是Rancher的k3s的用武之地，k3s实际上是一个Linux发行版和Kubernetes发行版的组合，只有不到40 MB的二进制文件，只需要512 MB的RAM，这使得即使在最节省资源的基础设施和低资源计算环境中部署Kubernetes也很容易。<a class="ae la" href="https://k3os.io/" rel="noopener ugc nofollow" target="_blank"> k3OS </a>是另一个基于k3s的产品，该解决方案被打包成一个完全由Kubernetes管理的操作系统。K3s省略了许多使大多数Kubernetes发行版臃肿的特性，例如很少使用的插件，并将Kubernetes发行版的各种功能合并到一个进程中。</p><p id="7414" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">k3s解决了基础设施组件，然后是部署和管理应用程序等主要挑战，因为Kubernetes本身不是一个传统的、无所不包的PaaS(平台即服务)系统。在没有PaaS的情况下，部署基于微服务的应用程序可能很简单，只需要几个地理位置集中的数据中心，但如果有数千个边缘站点，情况就完全不同了，如下所示:</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lb"><img src="../Images/9151cef8f342d42755e4881a950371f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iWlN6x-HKdUwLkrz"/></div></div></figure><p id="a623" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在传统的PaaS环境中，开发人员将在本地开发应用程序，与应用程序的部署位置隔离开来。在这里，应用程序和它的基础设施没有连接，但是同样的东西不适合Kubernetes环境，在Kubernetes环境中，应用程序的每个部分都是它自己的容器(简单地说就是微服务)。μPaaS代表了应用程序开发和部署方式的转变。应用程序不是脱离其基础设施独立开发的，而是在基础设施内部开发的<em class="lg">。</em></p><p id="472f" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Rancher's Rio 是一个微型PaaS，可以放在任何标准Kubernetes集群之上。由一些Kubernetes定制资源和一个CLI组成，以增强用户体验，用户可以轻松地将服务部署到Kubernetes，并自动获得连续交付、DNS、HTTPS、路由、监控、自动缩放、canary部署、git触发的构建等等。k3s的工作开始是作为Rio的一个组成部分，然后被分成两个不同的一流开源项目。</p><h1 id="fa02" class="lh li jf bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">K3s</h1><p id="7ba7" class="pw-post-body-paragraph kc kd jf ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">K3s是全新的Kubernetes发行版，专为需要快速可靠地将应用部署到资源受限环境(例如:具有单板计算机的边缘站点)的用户而设计，并且专为无人值守、资源受限、远程位置或物联网设备内部的生产工作负载而设计。</p><p id="1387" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">K3s通过从Kubernetes二进制文件中剥离一堆特性(例如遗留、alpha和特定于云提供商的特性)，用Containerd替换docker，并使用sqlite3作为默认DB(代替etcd，支持etcd作为选项)来实现其轻量级目标。K3s只需要最少的内核和cgroup挂载。因此，这个轻量级的Kubernetes只消耗512 MB的RAM和200 MB的磁盘空间。</p><p id="b1b5" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">K3s将Kubernetes组件(kube-apiserver、kube-controller-manager、kube-scheduler、kubelet、kube-proxy)捆绑到组合的进程中，作为一个简单的服务器和代理模型。运行k3s服务器将启动Kubernetes服务器，并自动将本地主机注册为代理。k3s支持多节点模型，用户可以使用进程启动时生成的“节点令牌”。默认情况下，k3s会安装服务器和代理(结合了Kubelet、kubeproxy和法兰绒代理进程)，可以使用'— disable-agent '来控制服务器和代理(Kubernetes术语中的主节点和节点)。</p><h2 id="d33e" class="mk li jf bd lj ml mm dn ln mn mo dp lr kn mp mq lv kr mr ms lz kv mt mu md mv bi translated"><strong class="ak">服务器启动:</strong></h2><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/a2d3b4a873959cc53a6f0f0c431eb69e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4F-RCcvPL6_7lDdI"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">k3s服务器启动/集群创建</figcaption></figure><h2 id="880b" class="mk li jf bd lj ml mm dn ln mn mo dp lr kn mp mq lv kr mr ms lz kv mt mu md mv bi translated"><strong class="ak">代理发起:</strong></h2><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/518c33a9363209174846115ecc72a1d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SaLWAWwp7IXS58FA"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">k3s代理启动</figcaption></figure><p id="dbec" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">默认情况下，k3s使用法兰绒作为CNI，同样可以使用'—no-法兰绒'从安装中省略。其他的是可配置的，因为CNI现在完全独立于Kubernetes Install，大部分被当作一个附加组件。</p><h2 id="6675" class="mk li jf bd lj ml mm dn ln mn mo dp lr kn mp mq lv kr mr ms lz kv mt mu md mv bi translated"><strong class="ak"> k3s最小资源使用:</strong></h2><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/50e4f5e77c96846123d5ddd86a0e05ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MVDk627U9sWQGeum"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">k3s资源使用</figcaption></figure><p id="52da" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">二进制启动创建一个完整的Kubernetes集群，默认情况下将kube-config文件写入“/etc/rancher/k3s”。k3s在主机上安装kubectl，并提供与k3s一起执行Kubectl和crictl命令的功能。</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/d9347bf22c0652634dbbf1968a8d6c5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PNtybOJj-kPVWgpq"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">含k3s的功能性Kubernetes簇</figcaption></figure><p id="57e5" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">由于所有的kube系统组件都作为单独的进程运行，因此在名称空间中不会创建任何容器(kube-apiserver、kube-scheduler、kube-proxy和kube-controller-manager)。只有通过清单创建的应用程序容器才被创建为由Containerd (CRI)管理的容器/pod。</p><h2 id="f7c3" class="mk li jf bd lj ml mm dn ln mn mo dp lr kn mp mq lv kr mr ms lz kv mt mu md mv bi translated"><strong class="ak"> Containerd作为容器运行时:</strong></h2><p id="a24c" class="pw-post-body-paragraph kc kd jf ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">K3s没有使用Docker的完整实例作为容器的运行时引擎，而是使用Docker的核心容器运行时，<a class="ae la" href="https://www.infoworld.com/article/3181312/open-source-tools/docker-frees-container-core-for-cloud-native-computing-foundation.html" rel="noopener ugc nofollow" target="_blank"> Containerd </a>。这样，Docker中通常包含的许多元素都可以省略。</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div class="gh gi my"><img src="../Images/83a7d5ac67be523684631522546d4eed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*iWGSc9JF4vOjvzl1"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">码头工人和集装箱工人</figcaption></figure><p id="e8bd" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">k3s使用container d——一个可以管理整个容器生命周期的容器运行时——从图像传输/存储到容器执行、监督和联网，并消除了Docker层。Docker和Containerd之间的唯一区别是:Docker使用Containerd作为Docker添加功能(如与容器运行时交互的引擎)的组件之一，并且可以被视为容器运行时接口。如下图所示，所有的容器都由Containerd直接管理，这使得它变得轻量级，去掉了Docker组件。</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mz"><img src="../Images/ba1eeee30271328c921caf744a59341e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zTVBoOYhsb6HBCPf"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">k3s crictl查询容器id</figcaption></figure><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi na"><img src="../Images/8be0d5560ba228f453061749b6b2ffb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LgNQkHG2BgqO275Z"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">由Containerd管理的容器</figcaption></figure><h2 id="0afc" class="mk li jf bd lj ml mm dn ln mn mo dp lr kn mp mq lv kr mr ms lz kv mt mu md mv bi translated"><strong class="ak"> Sqlite3作为默认存储机制:</strong></h2><p id="f023" class="pw-post-body-paragraph kc kd jf ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">默认情况下，K3s使用Sqlite作为存储后端，取代etcd。etcd3仍然可用，但不是默认的。由于SQLite的技术限制，K3s目前不支持高可用性(HA ),就像现在运行多个主节点一样。</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nb"><img src="../Images/1b2985faa7561a0913ff74b0147a3dc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ow47_QBBYV5Vdkea"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Sqlite作为数据库— k3s</figcaption></figure><h2 id="9f94" class="mk li jf bd lj ml mm dn ln mn mo dp lr kn mp mq lv kr mr ms lz kv mt mu md mv bi translated">自动部署清单:</h2><p id="5b8e" class="pw-post-body-paragraph kc kd jf ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">在/var/lib/rancher/k3s/server/manifests中找到的任何文件都将自动部署到Kubernetes，部署方式类似于kubectl apply。如下所示，Coredns会随着群集启动自动部署到群集上。</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/8da5b2113c987fd786c20fd3841a6810.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VbNsI_3Vz8hQ8LZc"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">自动部署的清单位置</figcaption></figure><p id="5a48" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">K3s支持安装舵图的CRD控制器。通过此功能，用户可以利用简单的基于YAML的清单与控制器通信，以自动部署舵图。所有需要的变量都可以通过“set”传递，这使用户能够定制和部署舵图表，作为使用上游图表或内部图表存储库的集群部署的一部分。</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nc"><img src="../Images/2a3bbbe96bcc1eaffbe83fde44479778.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HA0tlisMTK08iIlc"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">舵CRD控制器</figcaption></figure><h1 id="11d8" class="lh li jf bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">Rio-Kubernetes基微型电池</h1><p id="5ae0" class="pw-post-body-paragraph kc kd jf ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">Rio是一个“微PAAS (μPaaS)”，开发人员可以使用它轻松地将应用程序中的样板服务部署到Kubernetes，这些服务可以位于任何标准Kubernetes集群之上。Rio利用少量Kubernetes自定义资源和CLI编排了一系列应用开发基本功能，例如为服务网格或微服务之间的安全和通信设置Istio、自动扩展、构建基础架构、TLS、设置路由、无缝canary部署、A/B部署、监控服务网格内部的HTTP流量等。</p><p id="fe7a" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Rio提供了一个全面的CLI，它将屏蔽多个Kubectl和Istioctl命令来配置和部署服务。</p><h1 id="a679" class="lh li jf bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">里约概念</h1><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/b5d2f16aabbbfbb19a781b68a4e4ad96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8CbDbp_NjAQGoLdF"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">里约概念</figcaption></figure><h1 id="7a57" class="lh li jf bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">里约特色</h1><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/9c361055e9ed17d904d556197066664e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Pj-Xft669TRulC3J"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Rio支持的功能</figcaption></figure><h1 id="4574" class="lh li jf bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">里约组件</h1><p id="3882" class="pw-post-body-paragraph kc kd jf ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">Rio使用大量应用程序来促进上述功能，所有应用程序都部署到Kubernetes (K3s集群)上的“rio-system”命名空间。</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nd"><img src="../Images/175a85fa7a1cbb39b8dd6c714f0661f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AUpjpBPJiwZv_U9y"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">里约系统组件</figcaption></figure><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ne"><img src="../Images/5a249ef2cb70db94d6dd3c023aba0dcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YdiKQBYvBhF8ZXAp"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">里约系统组件</figcaption></figure><h1 id="2469" class="lh li jf bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">Rio安装</h1><p id="324f" class="pw-post-body-paragraph kc kd jf ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">Rio是一个单独的二进制文件，它可以自动在Kubernetes集群上部署所有组件。</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/a5b5fbbe29e8484cd6bd2d2d8b83b52c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Cc4oqx9N3ow9luKo"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">里约装置</figcaption></figure><h1 id="ab7e" class="lh li jf bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">使用群集域和TLS部署服务</h1><p id="cd73" class="pw-post-body-paragraph kc kd jf ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">Rio使用户能够使用一个命令带来一个具有服务网格、自动缩放、TLS和其他集成路由结构的成熟应用。这屏蔽了多个Kubectl命令来部署单个对象以及复杂的服务网格配置。</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nf"><img src="../Images/98180b67e9dc51fff129bab011b2409d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OSV386YZa-CmM2ZE"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Rio-使用TLS和服务网格进行服务部署</figcaption></figure><p id="2641" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">默认情况下，Rio将创建一个指向您的集群的DNS记录。Rio还使用Let's Encrypt为集群域创建了一个证书，这样所有服务在默认情况下都支持HTTPS。</p><p id="cdee" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Rio还创建所需的Istio配置，如目的地规则和虚拟服务，以在部署的服务上启用服务网格。Rio将所有必需的应用程序部署打包到一个命令中。Rio还部署了“Kiali ”,用于Istio特定的可视化。-服务网格</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/4a071141b5ff69dfd2d9bbf1df06855c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FXT8M61SCg97Eqou"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">服务网格地图Kiali上的可视化</figcaption></figure><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/2b9ad9e8ae71142d39088e8ad62f80f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jkXF_8JlgV1C3NCq"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">服务网格配置Kiali上的可视化</figcaption></figure><h1 id="8241" class="lh li jf bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">服务网格和金丝雀部署</h1><p id="60e5" class="pw-post-body-paragraph kc kd jf ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">里约有一个内置的服务网络，由Istio和Envoy提供支持。Rio特别要求用户不要太了解底层服务网格。</p><p id="be3b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">服务可以一次部署多个版本。然后，服务网格可以决定将多少流量路由到每个版本。</p><h2 id="9136" class="mk li jf bd lj ml mm dn ln mn mo dp lr kn mp mq lv kr mr ms lz kv mt mu md mv bi translated">使用Rio-Stage来存放同一服务的多个版本:</h2><p id="6f78" class="pw-post-body-paragraph kc kd jf ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">Rio“stage”对现有服务进行新的修改:</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ng"><img src="../Images/7814b2a2620582142f465cb5f05dcc87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qadKy7TBsBdNP94J"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">使用Rio-Stage部署同一服务的多个版本</figcaption></figure><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/740b87b257d2a76eb21e2f473f5579de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gTGJq1KTNQ0SuTZS"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">服务v0和v3 — Kiali</figcaption></figure><h2 id="232c" class="mk li jf bd lj ml mm dn ln mn mo dp lr kn mp mq lv kr mr ms lz kv mt mu md mv bi translated">使用Rio-Promote调整服务版本之间的流量:</h2><p id="273a" class="pw-post-body-paragraph kc kd jf ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">Rio“promote”使用户能够在部署的服务上使用金丝雀流，逐步调整版本之间的权重。流量将逐渐转移，默认权重每5秒增加5%(可配置)。</p><p id="383c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如下所示，上面使用rio-stage创建的服务V3已升级:</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nh"><img src="../Images/3ef8158a78d24dbb1a0b0367a16c3ee5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kZpMvY9bqYaMIQJB"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">使用称重配置调整流量，使用Rio-Promote部署金丝雀</figcaption></figure><h2 id="431d" class="mk li jf bd lj ml mm dn ln mn mo dp lr kn mp mq lv kr mr ms lz kv mt mu md mv bi translated"><em class="ni">动态调整服务权重:</em></h2><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/a570ffcac548b9c243ffe7160f420990.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0zRPIsF_STr6SBF8"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">使用Rio-Weight动态调整重量</figcaption></figure><h2 id="f731" class="mk li jf bd lj ml mm dn ln mn mo dp lr kn mp mq lv kr mr ms lz kv mt mu md mv bi translated"><em class="ni">与基亚利一起可视化:</em></h2><p id="e04f" class="pw-post-body-paragraph kc kd jf ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">Rio部署了Kiali(Istio的默认UI)和Isio堆栈。上面所做的所有配置和更改都可以很容易地从web界面中描述出来。</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/989442cf181d624992decfa9625d1d47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4OdB7mXNHpa0LLvM"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">重量变化时的交通变化</figcaption></figure><h1 id="6ebd" class="lh li jf bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">自动缩放</h1><p id="300b" class="pw-post-body-paragraph kc kd jf ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">默认情况下，Rio支持工作负载的自动扩展。根据您的工作负载的QPS和当前活动请求，Rio将工作负载扩展到适当的规模。</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/377fed58a0d1a872ba88ad0744b9ff5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Az7IjADd5GH_odwY"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">自动缩放—里约</figcaption></figure><h2 id="56f2" class="mk li jf bd lj ml mm dn ln mn mo dp lr kn mp mq lv kr mr ms lz kv mt mu md mv bi translated"><em class="ni">根据需求从零开始扩展服务:</em></h2><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/ced1976862cf6ebe9c5c0e0bd7a08d45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R_D8EesDHEKHdgBP"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">自动缩放—里约</figcaption></figure><h1 id="806b" class="lh li jf bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">部署的源代码</h1><p id="ff5a" class="pw-post-body-paragraph kc kd jf ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">Rio支持配置基于Git的源代码存储库来部署实际的工作负载。这就像给Rio一个有效的Git repository repo URL一样简单。</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/861ce36c8e94c53ceb12100e5fe360d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3dUaGFFIaFsC0a59"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">用Rio构建的源代码— Git源代码</figcaption></figure><p id="ff53" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Rio将自动观察任何提交或标签被推到一个特定的分支(默认为master)。默认情况下，Rio会以一定的时间间隔提取并检查分支，但是可以配置为使用webhook。Rio允许用户动态配置webhooks，在下面创建Kubernetes secret，并可以通过build命令传递。</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nj"><img src="../Images/3084a9ae46f66d1d0fac15511c63a682.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JdYnZf1FY_1Fh7UT"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">用Rio配置Webhook</figcaption></figure><h1 id="bf5b" class="lh li jf bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">监视</h1><p id="7fdd" class="pw-post-body-paragraph kc kd jf ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">Rio部署了Prometheus、Grafana和Kiali来监控和可视化服务部署。</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/067cdb6395c86e8a506e91b5e7b867d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EQ3QoSuu5uzZVGXB"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">普罗米修斯</figcaption></figure><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/2503df54869807e33073d30ae41e13cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4Ju_qF1tYBojTdf_"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Istio工作量/里约服务仪表板</figcaption></figure><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/ca25363b6613192d1c71cfb5e9a8f646.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yD2lkQ1R4kLbt-Qz"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Istio工作量/里约服务仪表板</figcaption></figure><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/e5634a01a6484bb1c84cac6b56062587.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BPW3AAFnxJH4npRf"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">使用Kiali实现Istio特定映射和可视化</figcaption></figure></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><p id="85e6" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">根据定义，边缘基础设施是一个资源受限的环境。K3s有潜力有效利用这些资源，从可用资源中榨取最后一点汁液。另一方面，Rio支持多功能PaaS平台在Kubernetes上部署应用程序，使K3s + Rio成为Edge生态系统的良好组合。</p><p id="b212" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然而，K3s的目标是成为一个生产级的Kubernetes发行版，包括自动证书生成和向集群添加新节点的简单方法。看看Kubernetes的精简版本是否会超过全功能部署会很有趣。</p></div></div>    
</body>
</html>