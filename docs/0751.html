<html>
<head>
<title>Google Apps Script: Creating Stateful Gmail Add-Ons</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google Apps脚本:创建有状态的Gmail插件</h1>
<blockquote>原文：<a href="https://itnext.io/google-apps-script-creating-stateful-gmail-add-ons-part-one-89186ae17f7e?source=collection_archive---------3-----------------------#2018-05-21">https://itnext.io/google-apps-script-creating-stateful-gmail-add-ons-part-one-89186ae17f7e?source=collection_archive---------3-----------------------#2018-05-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c38aa93a40e36496c4e6fb1c3a9b70aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OtETQTV8jzSmbCit."/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@rawpixel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> rawpixel </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="37b4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">嘿，你好！—我已经键入了一些关于我发现Google Apps脚本以及我为什么开始使用它的背景和故事。如果你感兴趣，请继续阅读。否则，向下滚动“志愿者注册”演示和教程。</p><p id="b2b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在2018年的前三个月探索了<a class="ae kc" href="https://flutter.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> Flutter </strong> </a>和<a class="ae kc" href="https://www.dartlang.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> Dart </strong> </a> <strong class="kf ir">，</strong> Google针对原生app开发的跨平台解决方案。大约一个月后，我决定向当地开发商寻求指导。通过联系谷歌的flutter邮件列表，我设法联系了当地的GDG分会，并获得了Portland Flutter Meetup的赞助，该会议现在每月举行一次，并将对公众免费开放。</p><p id="331c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在谷歌的Flutter团队工作的经历非常棒，所以我请求我的雇主允许我在我们公司带头开发一个本地应用程序。我被赋予了一项任务，正如他们在泰国所说的一样，相同但不同。</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lc"><img src="../Images/27216a430aa150c1c4f853c54122769e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QNbkQXpaxMauxfIDa92Hmg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图片来自<a class="ae kc" href="https://blog.google/products/g-suite/do-more-your-inbox-gmail-add-ons/" rel="noopener ugc nofollow" target="_blank">谷歌博客</a></figcaption></figure><p id="133a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我了解到我们将为我们的约会安排软件开发一个<a class="ae kc" href="https://developers.google.com/gmail/add-ons/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> Gmail插件</strong> </a> <strong class="kf ir"> </strong>。这是我第一次听说附加产品；它们是运行在Gmail和Google Drive服务中的微型程序，比如表格、文档、幻灯片和表单。我也不熟悉编程语言，<a class="ae kc" href="https://developers.google.com/apps-script/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> Google Apps脚本</strong> </a>，以及支持它的IDE。</p><p id="796d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi lh translated"><span class="l li lj lk bm ll lm ln lo lp di">" G</span><strong class="kf ir"><em class="lb">aoogle Apps脚本</em> </strong> <em class="lb">是一种</em> <strong class="kf ir"> <em class="lb"> JavaScript云脚本语言</em> </strong> <em class="lb">，它提供了简单的方法来</em> <strong class="kf ir"> <em class="lb">自动化跨Google产品和第三方服务的任务，并构建web应用</em> </strong> <em class="lb">。"</em></p><p id="18f4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Gmail插件开发工具是免费的，并附带了可靠的<a class="ae kc" href="https://developers.google.com/gmail/add-ons/" rel="noopener ugc nofollow" target="_blank">文档</a>，加上<a class="ae kc" href="https://developers.google.com/gmail/add-ons/samples" rel="noopener ugc nofollow" target="_blank">三个示例应用程序</a>可供使用。作为一名javascript开发人员，我发现Apps脚本直观且易于使用。</p><h1 id="a2c3" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><strong class="ak">第一部分——准备工作</strong></h1><h1 id="493a" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">开始为Gmail插件编程的第一步</h1><p id="3c1c" class="pw-post-body-paragraph kd ke iq kf b kg mo ki kj kk mp km kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">如果这是你第一次使用谷歌插件，你可以从他们网站上的<a class="ae kc" href="https://developers.google.com/gmail/add-ons/guides/quickstart" rel="noopener ugc nofollow" target="_blank">快速入门教程</a>中学到很多基础知识。您可以在本地或浏览器中开发附加组件。如果要在本地开发，就需要<a class="ae kc" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">节点</a>和<a class="ae kc" href="https://github.com/google/clasp" rel="noopener ugc nofollow" target="_blank">扣</a>。查看此<a class="ae kc" href="https://github.com/gsuitedevs/gmail-add-ons-samples/tree/master/github" rel="noopener ugc nofollow" target="_blank">项目演示</a>以获取本地附加开发的说明。</p><p id="f100" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我将为浏览器内的开发提供指导，以保持所涉及的技术数量最少。您将需要一个<a class="ae kc" href="https://github.com" rel="noopener ugc nofollow" target="_blank"> Github </a>帐户来克隆这个库。一旦你熟悉了基础知识，按照这些简单的步骤开始教程。</p><h1 id="9b2a" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">关于“志愿者注册”演示应用程序</h1><p id="71c2" class="pw-post-body-paragraph kd ke iq kf b kg mo ki kj kk mp km kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated"><strong class="kf ir">应用概要:</strong>在这个演示中，用户已经注册了一个贸易展览，并且将代表他们的公司自愿上一天或一夜的班。</p><p id="2642" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">应用程序功能:</strong>这款应用程序展示了几个Gmail附加功能，包括多卡导航、具有持久状态的表单输入检索(用户属性存储)和一个“确认”按钮，该按钮将用户数据打印为固定的电子邮件回复。</p><p id="2074" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">应用程序UI: </strong>该应用程序由两张卡片(如下所示)组成，标题中有一个通用设置图标(三点),用于导航。</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/e0104cf539b12eed530a8adf53d70f75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B2j1BWWrubW6KNzWeD5Ktg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">这是志愿者注册应用程序的双卡用户界面(Google Apps脚本演示)</figcaption></figure><p id="1ee3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">应用程序UX: </strong>选择他们工作的公司，这使得员工列表出现在下拉菜单中。这些设置被保存，用户导航到一张新的卡，在那里他们可以选择志愿上白班或夜班。完成后，他们进行确认，插件将创建一个带有预设回复的电子邮件回复。</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/f7bfeee28b9842678d7884c78fe9d1c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GkKQ6xN_n-JfAa8Hhff1wQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd ls">第一张卡片:</strong>用户已经从亚马逊选择了奥斯卡·皮特森，但是还没有点击保存。</figcaption></figure><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/a3ff80f3254ba5a18f83d53ab8ed422d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H9sEf6xOPUIuwPzKThIbzQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd ls">第二张卡:</strong>用户保存设置，选择夜班，点击确认。生成电子邮件回复。</figcaption></figure><h1 id="0b5b" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">如何在没有卡扣的情况下安装Gmail插件演示</h1><p id="2bb7" class="pw-post-body-paragraph kd ke iq kf b kg mo ki kj kk mp km kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated"><strong class="kf ir">步骤1) </strong> <a class="ae kc" href="https://github.com/ezrasandzerbell/Gmail-addon-stateful-demo" rel="noopener ugc nofollow" target="_blank">克隆这个“Gmail插件状态演示”Github Repo </a></p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/e02fbe1992f512057d60ac27f3cd9adb.png" data-original-src="https://miro.medium.com/v2/resize:fit:544/format:webp/1*XWj8bKGIq6Z61rhT8JhHZA.jpeg"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">这是克隆的插件演示，在<a class="ae kc" href="https://atom.io/" rel="noopener ugc nofollow" target="_blank"> Atom文本编辑器</a>中查看</figcaption></figure><p id="3394" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">步骤2)点击此处:</strong> <a class="ae kc" href="https://script.google.com/macros/create" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">创建一个新的谷歌脚本</strong> </a></p><p id="d334" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">步骤3)在IDE中，单击“查看”并选择“显示清单文件”以显示当前的appscript.json文件。</strong></p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/ba65a0bcaf170ea3ccef74199d4b1088.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*uS4NL8oOlWACVM8jiNj7Iw.png"/></div></figure><p id="c78e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">步骤4)从克隆的repo中复制appscript.json内容，并将其保存在此Google IDE的appscript.json清单文件中。</strong></p><p id="d53d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">步骤5)在</strong> <strong class="kf ir"> appscript.json中，复制并定位</strong> <a class="ae kc" href="https://developers.google.com/gmail/add-ons/concepts/scopes" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> oAuthScopes属性</strong> </a>。这些作用域在<strong class="kf ir">应用安全中扮演着重要的角色。谷歌明确表示，搜索范围应该限制在绝对必要的范围内。</strong></p><p id="22ed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个演示中，选择的<strong class="kf ir"> oAuthScopes </strong>启用持久状态管理(script.storage)并允许应用程序创建电子邮件响应。enabledAdvancedServices公开了gmail插件库。</p><pre class="ld le lf lg gt my mz na nb aw nc bi"><span id="566a" class="nd lr iq mz b gy ne nf l ng nh">{<br/>  "timeZone": "GMT",<br/>  "dependencies": {<br/>    <strong class="mz ir">"enabledAdvancedServices": [{<br/>      "userSymbol": "Gmail",<br/>      "serviceId": "gmail",<br/>      "version": "v1"<br/>    }]</strong><br/>  },<br/>  <strong class="mz ir">"oauthScopes": [ "</strong><a class="ae kc" href="https://www.googleapis.com/auth/script.storage" rel="noopener ugc nofollow" target="_blank"><strong class="mz ir">https://www.googleapis.com/auth/script.storage</strong></a><strong class="mz ir">",  "</strong><a class="ae kc" href="https://www.googleapis.com/auth/gmail.addons.execute" rel="noopener ugc nofollow" target="_blank"><strong class="mz ir">https://www.googleapis.com/auth/gmail.addons.execute</strong></a><strong class="mz ir">",  "</strong><a class="ae kc" href="https://www.googleapis.com/auth/gmail.addons.current.message.metadata" rel="noopener ugc nofollow" target="_blank"><strong class="mz ir">https://www.googleapis.com/auth/gmail.addons.current.message.metadata</strong></a><strong class="mz ir">","</strong><a class="ae kc" href="https://www.googleapis.com/auth/gmail.addons.current.message.action" rel="noopener ugc nofollow" target="_blank"><strong class="mz ir">https://www.googleapis.com/auth/gmail.addons.current.message.action</strong></a><strong class="mz ir">","</strong><a class="ae kc" href="https://www.googleapis.com/auth/gmail.addons.current.action.compose" rel="noopener ugc nofollow" target="_blank"><strong class="mz ir">https://www.googleapis.com/auth/gmail.addons.current.action.compose</strong></a><strong class="mz ir">"]</strong></span><span id="a125" class="nd lr iq mz b gy ni nf l ng nh">...}</span></pre><p id="2d6c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">第6步)</strong>接下来，使用<strong class="kf ir">文件<em class="lb">新建&gt;脚本文件</em>到</strong>到<em class="lb">创建八个新的脚本文件，分别以<em class="lb">命名。js </em>文件(例如<em class="lb"> code.js、helpers.js等</em>)。注意，IDE使用了一个<em class="lb">。gs </em>扩展名而不是<em class="lb"> .js. </em></em></p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/44eb90e89cfd00e71233e41d13793994.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mee72qzzzSWf-7Q0dGwO9Q.png"/></div></div></figure><p id="2f7d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">第7步)</strong>复制。js代码从每个文件转换到相应的。gs文件。保存所有文件。您的界面应该如下所示:</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/c3dea9f19374e788a48f2e0fa50e11b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mdsBu94bLrC359o5NfSESA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">八个脚本文件(。gs)和appscript.json清单文件都已被创建、更新和保存。</figcaption></figure><p id="8f6c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">步骤8) </strong>现在您的应用程序已经配置好了，转到<strong class="kf ir"> <em class="lb">从清单</em> </strong>发布&gt;部署，并从头部部署获取您的<strong class="kf ir">部署ID </strong>。下面的截图将带你浏览一下:</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/39b24876a8b25187802592fd69e5f1e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y1E4TdgN4EJ88P_mmVpoow.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">选择发布&gt;从清单部署</figcaption></figure><p id="7bfa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如下所示，您可以简单地点击“获取ID ”,然后复制部署ID。成功复制ID后，点击关闭按钮。</p><div class="ld le lf lg gt ab cb"><figure class="nm jr nn no np nq nr paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/6f6b5f2e5c47172b17eaccd2754da325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*u4pzhdVBmuuoYjiLD1wcrA.png"/></div></figure><figure class="nm jr ns no np nq nr paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/4d554bb452c5e4551ce99b28e183ea30.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*rilSt-6EOEdfs2gntOCfXw.png"/></div></figure></div><p id="63aa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">步骤9)点击此处:</strong> <a class="ae kc" href="https://mail.google.com/mail/u/0/#settings/addons" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">打开您的Google附加组件设置</strong> </a></p><p id="97ff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该信息图显示了Google附加组件设置屏幕。一次走一步；启用开发者加载项，然后粘贴部署ID并安装应用程序。它应该会出现</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nt"><img src="../Images/fb3ac43112a0b9e76d70180d226f0214.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-yHD3dPjEhe3uLaNcBNfSQ.png"/></div></div></figure><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nu"><img src="../Images/668d2128a78d92867af4bfd7351cf00a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xE_Eglb0mTvQMo97n7KhxA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">一旦你点击安装，谷歌将要求你确认你是否信任该插件的开发者。</figcaption></figure><h1 id="092e" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><strong class="ak">成功！</strong></h1><p id="7aa0" class="pw-post-body-paragraph kd ke iq kf b kg mo ki kj kk mp km kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">如果您正确遵循了所有步骤，应用程序应该会正确安装，您可以开始使用它了。回到你的Gmail账户，打开某人发来的邮件。几秒钟后，您的邮件右侧会出现一个图标。这是您的附加边栏！</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/3d716b2dc30a3f84e78f03d30fce8b03.png" data-original-src="https://miro.medium.com/v2/resize:fit:224/format:webp/1*z3zQvOW8688pXWiucN8UVg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">单击上面显示的图标打开演示应用程序。您也可以点击“+”来探索其他已发布的附加组件！</figcaption></figure><h1 id="6e45" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">第二部分——理解代码</h1><p id="51fd" class="pw-post-body-paragraph kd ke iq kf b kg mo ki kj kk mp km kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">现在我们已经安装了应用程序，我们可以开始查看应用程序本身了。让我们回到appscript.json文件:</p><pre class="ld le lf lg gt my mz na nb aw nc bi"><span id="5bcd" class="nd lr iq mz b gy ne nf l ng nh">"gmail": {<br/>    "name": "Volunteer Registration App",<br/>    "logoUrl": "<a class="ae kc" href="https://www.gstatic.com/images/icons/material/system/1x/receipt_black_24dp.png" rel="noopener ugc nofollow" target="_blank">https://www.gstatic.com/images/icons/material/system/1x/receipt_black_24dp.png</a>",<br/>    "contextualTriggers": [{<br/>      "unconditional": {<br/>      },<br/>     <strong class="mz ir"> "onTriggerFunction": "startApp"</strong><br/>    }],</span><span id="5a39" class="nd lr iq mz b gy ni nf l ng nh">...</span></pre><p id="6c5b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里的关键属性是<strong class="kf ir"> onTriggerfunction </strong>。它的值被设置为启动整个应用程序的函数。你可以叫它任何东西，所以我把它命名为startApp。打开<strong class="kf ir"> code.gs </strong>文件，定位startApp函数。如果您想随时查看记录器的日志文件，只需选择<strong class="kf ir"> <em class="lb">查看&gt;日志:</em> </strong></p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/ed325c7464951d817ee9713bc2f84361.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kEeZwEiaF0HvgrubyVLHiA.png"/></div></div></figure><p id="6f61" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本教程中，我直接在代码中做了注释。请跟随理解每个功能背后的逻辑:</p><pre class="ld le lf lg gt my mz na nb aw nc bi"><span id="9aa0" class="nd lr iq mz b gy ne nf l ng nh">function startApp () {</span><span id="366b" class="nd lr iq mz b gy ni nf l ng nh"><strong class="mz ir">  // First, we establish the organizationID. There are two options. <br/>  // If organizationID already exists as a property in the state's storage, then it gets that value. <br/>  // Otherwise, we get the first organization object in the jsonData array. </strong><br/>  <br/>  var organizationID = userProperties.getProperty('organizationID') || organizationSample[0].id;<br/>  <br/>  <strong class="mz ir">// Now that the organizationID var is established, we use setProperty to store that ID in our state.</strong><br/>  <br/>  userProperties.setProperty('organizationID', organizationID);<br/>  <br/>  <strong class="mz ir">// Next we gather the array of members who share the organizationID of our current selected org. <br/>  </strong><br/>  var members = memberSample.filter(function(member){<br/>    return member.organization_id === organizationID<br/>  });<br/>  <br/><strong class="mz ir">  // logs are used throughout these docs for testing purposes. </strong><br/>  <br/>  Logger.log("first member on startApp: " + members[0].name)<br/>  <br/><strong class="mz ir">  // We get a current Member ID, either from the state or from the first  member in our members array.</strong><br/>  <br/>  var memberID = userProperties.getProperty('currentMemberID') || members[0].id;<br/>  <br/>  userProperties.setProperty('currentMemberID', memberID);<br/>  <br/>  Logger.log("memberID on startApp: " + memberID)<br/>  <br/> <strong class="mz ir"> // Finally, the scheduleOptions from appscript.json are filtered by organization id to provide our schedule array.</strong><br/>  <br/>  var schedules = scheduleOptions.filter(function(schedule){<br/>    return schedule.organization_id === organizationID<br/>  });<br/>  <br/>  var scheduleID = userProperties.getProperty('currentScheduledID') || schedules[0].id;<br/>  <br/>  userProperties.setProperty('currentScheduleID', scheduleID);<br/>  <br/>  Logger.log("schedules[0].name on startApp: " + schedules[0].name);<br/>  Logger.log("schedules[1].name on startApp: " + schedules[1].name);<br/>  <br/><strong class="mz ir">  // return the function located in buildSettingsCard.gs, which loads the first card based on our stateful data</strong><br/>  <br/>  return buildSettingsCard()<br/>  <br/>}</span></pre><p id="f0c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每次应用程序启动时，都会加载这个startApp函数。当我们在页面间导航时，它不运行。如您所见，我们测试了userProperties存储中的现有状态。如果没有，我们设置属性默认值。最后，我们返回一个名为<strong class="kf ir"> buildSettingsCard() </strong>的函数，它位于。同名的gs文件。</p><pre class="ld le lf lg gt my mz na nb aw nc bi"><span id="81b4" class="nd lr iq mz b gy ne nf l ng nh"><strong class="mz ir">// Build Settings Card</strong></span><span id="ed9c" class="nd lr iq mz b gy ni nf l ng nh">function buildSettingsCard() {<br/>  <br/>  <strong class="mz ir">// create a new card</strong><br/>  var card = CardService.newCardBuilder();  <br/>    <br/>  <strong class="mz ir">// Set name and header title on card </strong><br/>  card.setName("SettingsCard").setHeader(CardService.newCardHeader().setTitle('Company Registration'));<br/>  <br/><strong class="mz ir">  // newCardSections are a that Widgets can be painted onto</strong><br/>  var sectionSettings = CardService.newCardSection();<br/>  <br/><strong class="mz ir">  // get organization object</strong><br/>  var organization = getObjectByID(organizationSample, userProperties.getProperty('organizationID'));<br/>  Logger.log("Current Organization on buildSettingsCard: " + organization.name);</span><span id="1eaa" class="nd lr iq mz b gy ni nf l ng nh"><strong class="mz ir">// get scheduleID</strong><br/>  <br/>  var schedules = scheduleOptions.filter(function(schedule){<br/>    return schedule.organization_id === organization.id<br/>  });<br/>  <br/>  var scheduleID = userProperties.getProperty('currentScheduledID') || schedules[0].id;<br/>  <br/>  userProperties.setProperty('currentScheduleID', scheduleID);  <br/>  <br/><strong class="mz ir">  // get the current member associated with current organization</strong><br/>  var currentMember = getObjectByID(memberSample, userProperties.getProperty('currentMemberID'));<br/>  Logger.log("Current Member Name on buildSettingsCard: " + currentMember.name);<br/>  <br/><strong class="mz ir">  // get currentMembers to be displayed on the member select menu</strong><br/>  <br/>  var currentMembers = memberSample.filter(function(member){<br/>    return member.organization_id === userProperties.getProperty('organizationID');<br/>  });<br/>  <br/>  Logger.log("name of member 1 associated with current organization name on buildSettingsCard: " + currentMembers[0].name);<br/>  Logger.log("name of member 2 associated with current organization name on buildSettingsCard: " + currentMembers[1].name);<br/><strong class="mz ir">  <br/>  // Add widgets to the Settings card section <br/>  <br/>  // Add the organization select menu widget to the card</strong><br/>  <br/>  sectionSettings.addWidget(getOrganizationSelectMenu(organizationSample, organization || organizationSample[0]));<br/>  <br/><strong class="mz ir">  // check that there are members associated with the current organization. If so, display the member select menu widget on the card</strong><br/>  <br/>  if (currentMembers.length &gt; 0) { <br/>    <br/>    sectionSettings.addWidget(getMembersSelectMenu(currentMembers, currentMember || memberSample[0]));<br/>  } else {<br/>    sectionSettings.addWidget(CardService.newTextParagraph().setText("No Members Available"));<br/>  };<br/>  <br/><strong class="mz ir">  // btnSaveSettings is a button located at the bottom of the card<br/>  // actSaveSettings a newAction that triggers a function called buildScheduleTypes. <br/>  // buildScheduleTypes is located in the corresponding buildScheduleTypes.gs file</strong><br/>  <br/>  var actSaveSettings = CardService.newAction()<br/>        .setFunctionName('buildScheduleTypes');<br/>  var btnSaveSettings = CardService.newTextButton()<br/>        .setText("Save")<br/>        .setOnClickAction(actSaveSettings);<br/>  <br/> <strong class="mz ir"> // add the button </strong><br/>  <br/>  sectionSettings.addWidget(btnSaveSettings);</span><span id="cb34" class="nd lr iq mz b gy ni nf l ng nh"><strong class="mz ir">// Return and build the card</strong><br/>  <br/> return card.addSection(sectionSettings).build();<br/>  <br/>}</span></pre><p id="0bf3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是你第一次看到一张新的卡片，并在其中一个部分添加了小部件。CardService小部件是Google附加组件的核心特性。这个卡上的最后一个小部件是btnSaveSettings，它被配置为运行buildScheduleTypes函数，位于。同名的gs文件:</p><pre class="ld le lf lg gt my mz na nb aw nc bi"><span id="2c87" class="nd lr iq mz b gy ne nf l ng nh"><strong class="mz ir">// Build Schedule Types</strong></span><span id="26d6" class="nd lr iq mz b gy ni nf l ng nh">function buildScheduleTypes(e) {<br/>  <br/>  var currentMemberID = userProperties.getProperty('currentMemberID');<br/>  <br/>  Logger.log("current member id: " + currentMemberID);<br/>  <br/>  <strong class="mz ir"><br/>  // re-establish state variables for local scope</strong></span><span id="b8f5" class="nd lr iq mz b gy ni nf l ng nh">var currentSchedules = scheduleOptions.filter(function(schedule){<br/>    return schedule.organization_id === userProperties.getProperty('organizationID')<br/>  });<br/>  <br/>  Logger.log("first schedule on currentSchedules: " + currentSchedules[0].name);<br/>  <br/><strong class="mz ir">  // create card and give it header title, establish section<br/>  </strong><br/>   var cardScheduleTypes = CardService.newCardBuilder()<br/>  .setName("ScheduleCard")<br/>  .setHeader(CardService.newCardHeader().setTitle("Schedule Types"));<br/>  <br/>  var sectionSchedules = CardService.newCardSection();<br/><strong class="mz ir">  <br/>  // add widgets to card section for Schedule types</strong><br/>  <br/>  if (currentSchedules.length != 0) { <br/>    sectionSchedules.addWidget(getScheduleSelectMenu(currentSchedules));<br/>  } else {<br/>    sectionSchedules.addWidget(CardService.newTextParagraph().setText("No Schedule Types Available"));<br/>  }<br/> <strong class="mz ir"><br/>  // Print-to-Email Button (see createReply.gs)<br/> </strong><br/>  <br/>  var action = CardService.newAction().setFunctionName('createReply');  <br/>  <br/>  sectionSchedules.addWidget(CardService<br/>                    .newTextButton()<br/>                    .setText('Confirm')<br/>                    .setComposeAction(action, CardService.ComposedEmailType.REPLY_AS_DRAFT));<br/>  <br/>  return cardScheduleTypes.addSection(sectionSchedules).build();  <br/>  <br/>}</span></pre><p id="97ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">测试驱动开发</strong></p><p id="90d8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">应用程序中的每个操作都与一个具有一系列数据日志的功能相关联。你可以在不同的阶段测试这个应用程序:初始启动，从下拉菜单中选择，导航到一个页面，使用通用设置链接，点击“确认”按钮。</p><p id="769d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当您在应用程序脚本IDE中查看日志时，尝试在一个选项卡中打开您的Gmail帐户。这样你就可以向前和向后移动。如果您想了解不同方法的行为方式以及它们在哪里被调用，这些Logger.log()测试会非常有帮助。</p><h1 id="5ab3" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">总结一下:</h1><p id="4b89" class="pw-post-body-paragraph kd ke iq kf b kg mo ki kj kk mp km kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">本文的主要目的是向您介绍Google Add-Ons，并向您展示一个工作演示，展示选择表单及其REPLY_AS_DRAFT特性的组合。如果你想对应用程序有一个更细致的了解，请查看应用程序中的所有文件。</p><p id="76db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以在Github <a class="ae kc" href="https://github.com/gsuitedevs/gmail-add-ons-samples" rel="noopener ugc nofollow" target="_blank">这里</a>找到更多谷歌附加示例应用。如果你喜欢这篇文章，并想阅读作者的更多内容，请参见下面的颤振文章:</p><blockquote class="nx ny nz"><p id="e419" class="kd ke lb kf b kg kh ki kj kk kl km kn oa kp kq kr ob kt ku kv oc kx ky kz la ij bi translated"><a class="ae kc" href="https://medium.com/flutter-io/creating-a-carousel-with-flutter-adf9a756e949" rel="noopener"> <strong class="kf ir">用颤振创造旋转木马(由颤振出版。</strong>IO)</a></p><p id="25b5" class="kd ke lb kf b kg kh ki kj kk kl km kn oa kp kq kr ob kt ku kv oc kx ky kz la ij bi translated"><a class="ae kc" href="https://medium.com/@ezra_69528/flutter-pinterest-style-photo-grids-b99289584b71" rel="noopener"> <strong class="kf ir">颤动:Pinterest风格的照片网格</strong> </a></p></blockquote><p id="fb2e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">再次感谢您的阅读，请随时在下面留下您的任何想法、反馈、建议、问题或喜爱的附加内容！</p></div></div>    
</body>
</html>