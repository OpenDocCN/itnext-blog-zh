<html>
<head>
<title>How to Create Multi-Lingual Gatsby React Websites</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建多语言的盖茨比反应网站</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-create-multi-lingual-gatsby-websites-react-4799b7899202?source=collection_archive---------3-----------------------#2021-06-19">https://itnext.io/how-to-create-multi-lingual-gatsby-websites-react-4799b7899202?source=collection_archive---------3-----------------------#2021-06-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e9a5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">开发多语言Gatsby网站的常见陷阱</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8303357cdface9dbf4e257ae1818b286.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8kteO0fzlopC5a3C"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@kylejglenn?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">凯尔·格伦</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="20ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你是否在做一个必须使用多种语言的盖茨比网站？根据我们的经验，我们将深入解释如何实现这一点，同时揭示常见的陷阱。</p><p id="7539" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将使用i18n处理json翻译文件。</p><h1 id="a7dc" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">选择插件</h1><p id="c286" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">有几个插件可用于国际化盖茨比网站。我们发现<code class="fe ms mt mu mv b">gatsby-plugin-intl</code>似乎是最受欢迎的，在<a class="ae ky" href="https://www.npmjs.com/package/gatsby-plugin-intl" rel="noopener ugc nofollow" target="_blank"> npm </a>上有大约6k的周下载量。它在幕后使用<code class="fe ms mt mu mv b">react-intl</code>，在<a class="ae ky" href="https://www.npmjs.com/package/react-intl" rel="noopener ugc nofollow" target="_blank"> npm </a>上有大约95万的周下载量！</p><p id="b0c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从实施来看，它做了很多开箱即用的工作，设置非常简单，如<a class="ae ky" href="https://www.gatsbyjs.com/plugins/gatsby-plugin-intl/" rel="noopener ugc nofollow" target="_blank">设置说明页</a>所示。然而，不要让这愚弄你，有一些重要的项目你应该知道，因为一些具体的工作方式将需要使用本模块的一些变通办法。</p><h1 id="d069" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">设置gatsby-plugin-intl</h1><p id="38ae" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">文档对于初始设置非常清楚，但是让我们一起来看一下。</p><p id="9cdf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，你需要安装npm包，<code class="fe ms mt mu mv b">npm install --save gatsby-plugin-intl</code>。</p><p id="fb2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其次，我们需要一个存储翻译文件的地方。通常，这存储在<code class="fe ms mt mu mv b">/src/intl/[languagecode].json</code>中。用这个结构创建空的json文件。</p><p id="7e79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe ms mt mu mv b">gatsby-config.js</code>中设置插件配置，将下面的配置粘贴到你的插件数组中。我在插件列表的开头和结尾都没有发现任何问题，但是如果你在设置上有任何错误，你可能想在你的插件列表中移动它，以防有任何冲突的Gatsby插件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="2d47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，languages数组需要包含与您之前创建的i18n json文件相同的名称。</p><p id="4cbd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设置现在已经完成，通过快速启动来确保您的Gatsby实例仍然正确运行。</p><h1 id="a61d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">使用国际化文件</h1><p id="38b1" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">接下来，我们可以开始使用翻译。假设我们有以下简单的翻译json文件<code class="fe ms mt mu mv b">/src/intl/en.json</code>。稍后我们将讨论嵌套内容。也为另一种选择的语言创建一个类似的文件，例如，<code class="fe ms mt mu mv b">/src/intl/nl.json</code>如果你也想用荷兰语。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h2 id="39c5" class="my lw it bd lx mz na dn mb nb nc dp mf li nd ne mh lm nf ng mj lq nh ni ml nj bi translated">使用intl挂钩</h2><p id="14e0" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">打开任何React组件，在那里您想要使用来自翻译的标签。首先，从<code class="fe ms mt mu mv b">gatsby-plugin-intl</code>包装中导入<code class="fe ms mt mu mv b">useIntl</code>挂钩。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="9af7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以使用这个钩子获取<code class="fe ms mt mu mv b">intl</code>对象，如下所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="efd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确实非常简单。从这一点开始，我们可以使用<code class="fe ms mt mu mv b">formatMessage</code>函数或者<code class="fe ms mt mu mv b">FormattedMessage</code> React组件来获取翻译。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="c994" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在轮到你了，试一下，看看你是否得到了正确的翻译！从<code class="fe ms mt mu mv b">localhost/en/</code>文件夹切换到<code class="fe ms mt mu mv b">localhost/nl/</code>文件夹将为您提供您在配置中定义的另一种语言的翻译。</p><h2 id="65a2" class="my lw it bd lx mz na dn mb nb nc dp mf li nd ne mh lm nf ng mj lq nh ni ml nj bi translated">使用Intl HOC(高阶组件)</h2><p id="8fbf" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">使用来自<code class="fe ms mt mu mv b">gatsby-plugin-intl</code>包的特设版本没有太大的不同。我们先导入<code class="fe ms mt mu mv b">injectIntl</code>函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="c2d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，当我们导出我们的组件时，我们用<code class="fe ms mt mu mv b">injectIntl</code>函数包装它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="1004" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们将收到作为道具的<code class="fe ms mt mu mv b">intl</code>对象。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="872c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建到其他页面的链接</h1><p id="084f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">由于URL结构有了细微的变化，包括路径中的区域设置，您也需要注意这一点。</p><p id="8386" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，您可以使用<code class="fe ms mt mu mv b">intl.locale</code>作为值，并自己生成路径，比如<code class="fe ms mt mu mv b">/${intl.locale}/contact</code>，或者您可以使用<code class="fe ms mt mu mv b">gatsby-plugin-intl</code>包中专门制作的组件。这里有一个例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="f40a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">常见陷阱</h1><p id="f9aa" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">第一次设置<code class="fe ms mt mu mv b">gatsby-plugin-intl</code>时有一些陷阱。让我们来看看最重要的几个。</p><h2 id="d307" class="my lw it bd lx mz na dn mb nb nc dp mf li nd ne mh lm nf ng mj lq nh ni ml nj bi translated">嵌套翻译</h2><p id="006e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">首先不解释这类i18n json文件中允许的结构。事实上，目前允许<strong class="lb iu">一级嵌套</strong>。例如:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="82d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，嵌套超过一层<strong class="lb iu">似乎还不支持</strong>！遗憾的是，目前我们只停留在一层嵌套上。如果您尝试这样做，您可能会得到一个神秘的跨环境反应错误。深入挖掘，你会发现错误日志提到本地化没有找到。</p><h2 id="70e0" class="my lw it bd lx mz na dn mb nb nc dp mf li nd ne mh lm nf ng mj lq nh ni ml nj bi translated">带列表的翻译</h2><p id="e050" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在i18n文件中定义数组没有像我们预期的那样工作。消息被正确定义，但是<code class="fe ms mt mu mv b">formatMessage</code>方法此时不能返回数组。例如:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="1467" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到，我们可以通过指定完整路径来检索项目，但是不可能一次检索完整的数组。</p><p id="c8fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一种解决方法是不使用<code class="fe ms mt mu mv b">/src/intl</code>文件，而是创建自己的文件结构。然后使用<code class="fe ms mt mu mv b">intl.locale</code>值，您可以导入正确的文件。这是一个想法，虽然我们还没有测试这在SEO方面意味着什么，标签是否会被立即解析。</p><h2 id="b573" class="my lw it bd lx mz na dn mb nb nc dp mf li nd ne mh lm nf ng mj lq nh ni ml nj bi translated">更新翻译文件</h2><p id="e36a" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">更新i18n转换文件后，gatsby服务器需要完全重启。<code class="fe ms mt mu mv b">gatsby develop</code>服务器热重装不起作用！</p><h1 id="55a9" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="582e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><code class="fe ms mt mu mv b">gatsby-plugin-intl</code>很棒，它自动化了开发多语言网站的许多任务。但是，您应该确切地知道如何使用它，i18n文件的结构是什么，等等。</p><p id="463d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仍然遗憾的是，它不支持多层嵌套，以及翻译文件中的数组。拥有这种支持将是一个很好的补充，有助于使用更动态的内容格式。</p><h1 id="889c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">进一步阅读</h1><p id="017f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">总而言之，我们对<code class="fe ms mt mu mv b">gatsby-plugin-intl</code>很满意，但这不是唯一可用的实现。另一个插件<code class="fe ms mt mu mv b">gatsby-plugin-i18n</code>的周下载量约为5k，略低于T7。</p><p id="3d29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由<a class="nk nl ep" href="https://medium.com/u/94f0c8061324?source=post_page-----4799b7899202--------------------------------" rel="noopener" target="_blank"> David Dal Busco </a>撰写的关于<code class="fe ms mt mu mv b">gatsby-plugin-i18n</code>的完整指南。我建议看一看他的文章，了解实现国际化的不同方式，以便做出决定并选择符合您需求的插件。</p><div class="nm nn gp gr no np"><a href="https://betterprogramming.pub/internationalization-with-gatsby-ae3991c39e92" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd iu gy z fp nu fr fs nv fu fw is bi translated">与Gatsby的国际化</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">如何用gatsby-plugin-i18n和react-intl国际化你的Gatsby网站</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">better编程. pub</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od ks np"/></div></div></a></div><p id="0009" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们强烈建议阅读npm上提供的文档，以了解完整的功能集。在本文中，我们只强调了我们认为最重要的特性。</p><div class="nm nn gp gr no np"><a href="https://www.npmjs.com/package/gatsby-plugin-intl" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd iu gy z fp nu fr fs nv fu fw is bi translated">盖茨比插件国际</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">国际化你的盖茨比网站。把你的gatsby网站变成一个国际化的框架</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">www.npmjs.com</p></div></div><div class="ny l"><div class="oe l oa ob oc ny od ks np"/></div></div></a></div></div><div class="ab cl of og hx oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="im in io ip iq"><p id="8cd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://kevinvr.medium.com/membership" rel="noopener">订阅我的媒介</a>到<strong class="lb iu">解锁</strong> <strong class="lb iu">所有</strong> <strong class="lb iu">文章</strong>。通过使用我的链接订阅，你是支持我的工作，没有额外的费用。你会得到我永远的感激。</p></div></div>    
</body>
</html>