<html>
<head>
<title>Real-Time Sensor Data Visualisation Using ReactJS, NodeJS, Socket.io and Raspberry Pi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用ReactJS、NodeJS、Socket.io和Raspberry Pi实现实时传感器数据可视化</h1>
<blockquote>原文：<a href="https://itnext.io/real-time-sensor-data-visualisation-using-reactjs-nodejs-socket-io-and-raspberry-pi-d109fd5cb19d?source=collection_archive---------0-----------------------#2020-03-26">https://itnext.io/real-time-sensor-data-visualisation-using-reactjs-nodejs-socket-io-and-raspberry-pi-d109fd5cb19d?source=collection_archive---------0-----------------------#2020-03-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/da156b2082d98132b15365139fb48c62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nRwyh9BgDDXyp1xIJPXzqw.png"/></div></div></figure><p id="8553" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在本文中，我们将了解我在物联网平台中实现的一个功能。它包括显示在平台注册的事物中执行的测量的实时图表。</p><h1 id="0fcd" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">体系结构</h1><p id="8a5a" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">在这个例子中，一个“东西”是一个带有温度和湿度传感器的Raspberry Pi，它通过IP使用套接字公开数据。</p><p id="d8bd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这些东西被注册在NodeJS后端中，它会将其信息存储在数据库中，并在MQTT代理中发布其测量结果。此外，后端将提供通过套接字连接到一个东西的可能性，这是我们将进一步详细了解的情况。</p><p id="365b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，有一个ReactJS前端，它将负责请求连接到一个东西，并在实时图表中呈现它的数据。</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mc"><img src="../Images/a0190b307c5b306b8a4fda4e93825123.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TdmoiCsXhH9F9BZOcNok0g.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">体系结构</figcaption></figure><h1 id="8900" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">给东西布线</h1><p id="e898" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">让我们从设置硬件开始。对于此使用案例，我们需要:</p><ul class=""><li id="d1fb" class="ml mm it kd b ke kf ki kj km mn kq mo ku mp ky mq mr ms mt bi translated">树莓Pi 3</li><li id="5cb5" class="ml mm it kd b ke mu ki mv km mw kq mx ku my ky mq mr ms mt bi translated"><a class="ae mz" href="https://cdn-learn.adafruit.com/downloads/pdf/dht.pdf" rel="noopener ugc nofollow" target="_blank"> DHT11 </a>:温湿度传感器</li><li id="3fdc" class="ml mm it kd b ke mu ki mv km mw kq mx ku my ky mq mr ms mt bi translated"><a class="ae mz" href="https://datasheets.maximintegrated.com/en/ds/DS18B20.pdf" rel="noopener ugc nofollow" target="_blank"> DS18B20 </a>:防水温度传感器。我们将用它来测量室外温度。</li><li id="c2da" class="ml mm it kd b ke mu ki mv km mw kq mx ku my ky mq mr ms mt bi translated">4个220ω电阻</li><li id="2af1" class="ml mm it kd b ke mu ki mv km mw kq mx ku my ky mq mr ms mt bi translated">3个LED(绿色=正常，红色=关闭，黄色=运行中)</li></ul><p id="4ac0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们按照下图将该硬件组件连接到RPi的<a class="ae mz" href="https://en.wikipedia.org/wiki/General-purpose_input/output" rel="noopener ugc nofollow" target="_blank"> GPIO </a>引脚:</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi na"><img src="../Images/c86ae136623dddc7aba0d9a4e9443431.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I4Ginqyr_QvWQUwRZY_WhQ.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">接线</figcaption></figure><h1 id="dc95" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">硬件抽象@事物</h1><p id="2df9" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">抽象是一个CS概念，它隐藏了一个实体的细节，以便专注于解决问题。在我们的例子中，实体是硬件组件，要解决的问题是获取传感器的数据，并通过打开led向用户提供反馈。</p><p id="bc57" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将使用ES6类来包装使用NodeJS本地模块访问硬件的第三方库。在DHT11的情况下，我们可以实现类似这样的东西:</p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="765f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们还需要几个类来编排这些硬件组件。<code class="fe nd ne nf ng b">SensorHandler</code>和<code class="fe nd ne nf ng b">LEDHandler</code>将完成这项工作。</p><h1 id="c85d" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">Socket.io server @ Thing</h1><p id="100c" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">如前所述，事物将通过套接字公开其数据。为此，我们将在其中运行一个Socket.io服务器。</p><p id="4380" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Socket.io背后的主要思想是通过使用基于使用websockets底层事件的API来异步通信两台机器。<code class="fe nd ne nf ng b">SocketHandler</code>将负责在配置的时间间隔内发出这些事件。注意，它们的内容将是调用<code class="fe nd ne nf ng b">SensorHandler.read()</code>的结果:</p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h1 id="5be3" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">Socket.io服务器@后端</h1><p id="1a24" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">后端也将有一个Socket.io服务器，它将作为客户端和对象之间的中间件。为了实现这一点，我们将在Socket.io实例中配置一个中间件，它将具有以下职责:</p><ul class=""><li id="796e" class="ml mm it kd b ke kf ki kj km mn kq mo ku mp ky mq mr ms mt bi translated">通过验证一个<a class="ae mz" href="https://github.com/auth0/node-jsonwebtoken" rel="noopener ugc nofollow" target="_blank"> JWT </a>来检查认证。</li><li id="b7db" class="ml mm it kd b ke mu ki mv km mw kq mx ku my ky mq mr ms mt bi translated">验证并获取客户端请求连接的对象名称。</li><li id="e3f0" class="ml mm it kd b ke mu ki mv km mw kq mx ku my ky mq mr ms mt bi translated">验证并获取客户请求的测量类型。</li></ul><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="575b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果一切正常，下一步将是实际打开这个东西的套接字，并将接收到的数据转发回客户端。这个过程是在<code class="fe nd ne nf ng b">SocketController</code>类中完成的，这个类与thing的类<code class="fe nd ne nf ng b">SocketHandler</code>非常相似。</p><h1 id="9a6c" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">前端实时图表</h1><p id="75f1" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">最后但同样重要的是，前端将允许用户选择一个事物及其支持的测量类型之一，以显示实时图表。</p><p id="6594" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe nd ne nf ng b">RealTime</code>组件将负责调度相应的Redux动作以实现该行为。具体来说，我们将使用Redux Thunk来简化这项任务:</p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="a2e8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这一点上，你可能会想…但是我们实际上从哪里接收数据呢？我们认为这发生在引擎盖下:</p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="1464" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，请记住，在卸载组件时关闭当前的套接字连接非常重要:</p><pre class="md me mf mg gt nh ng ni nj aw nk bi"><span id="9904" class="nl la it ng b gy nm nn l no np">useEffect(() =&gt; () =&gt; store.dispatch(finishRealTimeData()), []);</span></pre><h1 id="e858" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">包扎</h1><p id="ffa8" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我们已经建立了一个完整的JavaScript解决方案，允许用户可视化关于他/她的东西的实时信息。一个很酷的特性可能是触发动作，例如，通过实现一个订阅MQTT主题的worker，并在获得的值达到阈值时使用Telegram bot发送消息。你猜怎么着？它已经完成并在<a class="ae mz" href="https://github.com/mmontes11/iot" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上可用。另一篇文章来了…大概。</p><p id="cc48" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此外，一个有趣的重组可能是用gRPC<a class="ae mz" href="https://grpc.io/" rel="noopener ugc nofollow" target="_blank">替换Socket.io，这也允许我们拥有双向数据流。你猜怎么着？不，这还没有实现…还没有。</a></p><p id="69ed" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对此有什么想法吗？</p></div><div class="ab cl nq nr hx ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="im in io ip iq"><h1 id="8947" class="kz la it bd lb lc nx le lf lg ny li lj lk nz lm ln lo oa lq lr ls ob lu lv lw bi translated">GitHub repos</h1><ul class=""><li id="1c55" class="ml mm it kd b ke lx ki ly km oc kq od ku oe ky mq mr ms mt bi translated">前端+后端:<a class="ae mz" href="https://github.com/mmontes11/iot" rel="noopener ugc nofollow" target="_blank">https://github.com/mmontes11/iot</a></li><li id="9528" class="ml mm it kd b ke mu ki mv km mw kq mx ku my ky mq mr ms mt bi translated">树莓派:<a class="ae mz" href="https://github.com/mmontes11/iot-raspi-sensors" rel="noopener ugc nofollow" target="_blank">https://github.com/mmontes11/iot-raspi-sensors</a></li></ul><h1 id="a4fb" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">资源</h1><ul class=""><li id="3e47" class="ml mm it kd b ke lx ki ly km oc kq od ku oe ky mq mr ms mt bi translated"><a class="ae mz" href="https://en.wikipedia.org/wiki/Internet_of_things" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Internet_of_things</a></li><li id="fe77" class="ml mm it kd b ke mu ki mv km mw kq mx ku my ky mq mr ms mt bi translated"><a class="ae mz" href="https://cdn-learn.adafruit.com/downloads/pdf/dht.pdf" rel="noopener ugc nofollow" target="_blank">https://cdn-learn.adafruit.com/downloads/pdf/dht.pdf </a></li><li id="54e6" class="ml mm it kd b ke mu ki mv km mw kq mx ku my ky mq mr ms mt bi translated"><a class="ae mz" href="https://datasheets.maximintegrated.com/en/ds/DS18B20.pdf" rel="noopener ugc nofollow" target="_blank">https://datasheets.maximintegrated.com/en/ds/DS18B20.pdf </a></li><li id="8a01" class="ml mm it kd b ke mu ki mv km mw kq mx ku my ky mq mr ms mt bi translated"><a class="ae mz" href="https://github.com/momenso/node-dht-sensor" rel="noopener ugc nofollow" target="_blank">https://github.com/momenso/node-dht-sensor </a></li><li id="6e50" class="ml mm it kd b ke mu ki mv km mw kq mx ku my ky mq mr ms mt bi translated"><a class="ae mz" href="https://github.com/chamerling/ds18b20" rel="noopener ugc nofollow" target="_blank">https://github.com/chamerling/ds18b20 </a></li><li id="1e5a" class="ml mm it kd b ke mu ki mv km mw kq mx ku my ky mq mr ms mt bi translated"><a class="ae mz" href="https://github.com/auth0/node-jsonwebtoken" rel="noopener ugc nofollow" target="_blank">https://github.com/auth0/node-jsonwebtoken </a></li><li id="1621" class="ml mm it kd b ke mu ki mv km mw kq mx ku my ky mq mr ms mt bi translated"><a class="ae mz" href="https://github.com/socketio/socket.io" rel="noopener ugc nofollow" target="_blank">https://github.com/socketio/socket.io</a></li><li id="5b33" class="ml mm it kd b ke mu ki mv km mw kq mx ku my ky mq mr ms mt bi translated"><a class="ae mz" href="https://grpc.io/" rel="noopener ugc nofollow" target="_blank">https://grpc.io/</a></li></ul></div></div>    
</body>
</html>