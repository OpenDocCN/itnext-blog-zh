<html>
<head>
<title>Adding AWS Amplify to an Ember.js Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向Ember.js应用程序添加AWS Amplify</h1>
<blockquote>原文：<a href="https://itnext.io/adding-aws-amplify-to-an-ember-js-application-72683167c476?source=collection_archive---------3-----------------------#2018-03-30">https://itnext.io/adding-aws-amplify-to-an-ember-js-application-72683167c476?source=collection_archive---------3-----------------------#2018-03-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="feed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">更新(2018年9月):</strong>现在包括ember-cli插件，用于引导您的Amplify应用程序和Amplify CLI，</p><p id="11d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://aws.github.io/aws-amplify" rel="noopener ugc nofollow" target="_blank"> AWS Amplify </a>跨不同类别的云操作提供了一个声明式且易于使用的接口。AWS Amplify可以很好地与任何基于JavaScript的前端工作流兼容，并为移动开发者提供本地反应。AWS放大器在GitHub 上<a class="ae kl" href="https://github.com/aws/aws-amplify" rel="noopener ugc nofollow" target="_blank">开源可用。</a></p><p id="ca55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">默认实现适用于Amazon Web Services (AWS ),但AWS Amplify被设计为开放的，可以“插入”任何定制的后端或服务。</p><p id="3837" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">默认实现允许开发人员立即集成AWS服务，如用于用户身份验证的亚马逊Cognito、用于云存储和私人用户文件的亚马逊S3。AWS Amplify还为Amazon API Gateway提供了开箱即用的支持，包括自动签名版本4请求签名以及处理GraphQL查询的能力。</p><p id="c613" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Ember.js是一个依赖注入JavaScript框架。它允许您在JavaScript应用程序中使用handlebars模板和组件以及MVC类型接口。它还具有生成组件、服务、路由以及在本地构建和服务您的应用程序的良好CLI体验。</p><p id="ebd1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通常，使用AWS JavaScript SDK，配置认证、分析和利用其他AWS服务可能会<a class="ae kl" href="https://aws.amazon.com/blogs/developer/creating-and-deploying-a-serverless-web-application-with-cloudformation-and-ember-js/" rel="noopener ugc nofollow" target="_blank">困难和复杂</a>。AWS Amplify CLI <a class="ae kl" href="https://aws.amazon.com/blogs/mobile/deploying-an-emberjs-mobile-web-application-mobile-hub/" rel="noopener ugc nofollow" target="_blank">通过使用AWS CloudFormation自动化您的AWS后端配置，并向您的客户端应用程序提供JavaScript配置文件(aws-exports.js)以供使用，来帮助编排这个</a>。</p><p id="3fbd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">AWS Amplify在使用JavaScript的云服务时极大地简化了客户端编程。它为与云服务交互提供了声明性语法和分类结构。</p><p id="fd33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">import Amplify, { Auth, Analytics } from 'aws-amplify'</code></p><p id="3579" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这在支持ECMAScript 2015和node_modules的框架中非常有效。对于不支持web组件或普通脚本标签的框架来说，包含babel或类似内容以移植到兼容的浏览器代码可能是一个挑战。在这篇文章中，我将描述如何在Ember.js应用程序中使用AWS Amplify(当包含在普通html页面的<script>标签中时，它也可以用于访问)。&lt;/root&gt;</script></p><p id="25b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">要求:</strong></p><ul class=""><li id="4b68" class="kq kr iq jp b jq jr ju jv jy ks kc kt kg ku kk kv kw kx ky bi translated"><a class="ae kl" href="https://nodejs.org" rel="noopener ugc nofollow" target="_blank"> Node.js LTS </a></li><li id="a330" class="kq kr iq jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated"><a class="ae kl" href="https://emberjs.org" rel="noopener ugc nofollow" target="_blank">ember . js</a><br/>*本帖使用3.0</li><li id="9c7d" class="kq kr iq jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated"><a class="ae kl" href="https://github.com/grimbonious/ember-cli-amplify" rel="noopener ugc nofollow" target="_blank">member-CLI-amplify</a></li><li id="b8dc" class="kq kr iq jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated">AWS Amplify CLI </li></ul><p id="fda3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装并配置上述要求，然后引导您的Ember应用程序:</p><pre class="le lf lg lh gt li kp lj lk aw ll bi"><span id="1fe7" class="lm ln iq kp b gy lo lp l lq lr">$ ember new myAwsAmplifyApp<br/>$ cd myAwsAmplifyApp<br/>$ ember s</span></pre><p id="7617" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这之后，您应该会在您的浏览器中看到默认的Ember welcome组件。该组件默认安装，渲染在<code class="fe km kn ko kp b">app/templates/application.hbs</code>中。接下来，我们将使用Amplify CLI配置我们的项目(确保您已经根据存储库中概述的说明安装并配置了它)。</p><p id="a097" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从应用程序的根目录中:</p><pre class="le lf lg lh gt li kp lj lk aw ll bi"><span id="d7f3" class="lm ln iq kp b gy lo lp l lq lr">$ amplify init</span></pre><p id="611b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更改默认选项:</p><ul class=""><li id="04e5" class="kq kr iq jp b jq jr ju jv jy ks kc kt kg ku kk kv kw kx ky bi translated"><strong class="jp ir">源代码目录:</strong> app</li><li id="6e3a" class="kq kr iq jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated"><strong class="jp ir">构建目录</strong> : dist</li><li id="c22b" class="kq kr iq jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated"><strong class="jp ir">开始命令</strong>:余烬s</li><li id="926e" class="kq kr iq jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated"><strong class="jp ir">构建命令</strong> : ember b</li></ul><p id="f6e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将创建一个<code class="fe km kn ko kp b">aws-exports.js</code>文件，将其放在您的应用程序/目录中。完成后，添加Amazon Cognito认证:</p><pre class="le lf lg lh gt li kp lj lk aw ll bi"><span id="c433" class="lm ln iq kp b gy lo lp l lq lr">$ amplify add auth<br/>$ amplify push</span></pre><p id="6892" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们可以在Ember应用程序中使用Amazon Cognito的身份验证功能，我们的配置文件也用适当的值进行了更新。</p><p id="df30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，从<code class="fe km kn ko kp b">node_modules </code>文件夹导入aws-amplify库。Ember可以很好地从<code class="fe km kn ko kp b">bower_components </code>或<code class="fe km kn ko kp b">vendor/</code>文件夹中的文件导入脚本。但是，它不容易从node_modules文件夹中导入es模块。</p><p id="b1f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装<code class="fe km kn ko kp b">ember-cli-amplify</code> <a class="ae kl" href="https://www.npmjs.com/package/ember-cli-amplify" rel="noopener ugc nofollow" target="_blank">插件</a>:</p><p id="596b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">ember install ember-cli-amplify</code></p><p id="901d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接受所有问题的默认值。您现在可以通过带有依赖注入的Ember组件访问AWS放大器类别。</p><p id="d233" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">生成余烬组件:</p><p id="9253" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">$ ember g component amplify-authenticator</code></p><p id="8f7e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编辑<code class="fe km kn ko kp b">app/components/amplify-authenticator.js</code>文件:</p><pre class="le lf lg lh gt li kp lj lk aw ll bi"><span id="96d7" class="lm ln iq kp b gy lo lp l lq lr">import Component from '<a class="ae kl" href="http://twitter.com/ember/component" rel="noopener ugc nofollow" target="_blank">@ember/component</a>';<br/>import { inject as service } from '<a class="ae kl" href="http://twitter.com/ember/service" rel="noopener ugc nofollow" target="_blank">@ember/service</a>';</span><span id="f9d2" class="lm ln iq kp b gy ls lp l lq lr">export default Component.extend({<br/>  amplify:service(),<br/>  username: null,<br/>  password: null,<br/>  message: null,<br/>  error: null,<br/>  actions: {<br/>   signIn() {<br/>      const auth   = this.get('amplify').Auth;<br/>      const username  = this.get('username');<br/>      const password  = this.get('password');<br/>      const that   = this;</span><span id="8768" class="lm ln iq kp b gy ls lp l lq lr">      auth.signIn(username, password)<br/>         .then((result) =&gt; {<br/>              that.set('error', null);<br/>              that.set('message', result);<br/>         })<br/>         .catch((error) =&gt; {<br/>              if (error.message) {<br/>                  that.set('error', error.message);<br/>              } else {<br/>                  that.set('error', error);<br/>              }<br/>         });<br/>   }<br/>  }<br/>});</span></pre><p id="1077" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，编辑<code class="fe km kn ko kp b">app/templates/components/amplify-authenticator.hbs</code>文件:</p><pre class="le lf lg lh gt li kp lj lk aw ll bi"><span id="14a6" class="lm ln iq kp b gy lo lp l lq lr">&lt;section class="amplify-authenticator"&gt;<br/> <br/> &lt;h2&gt;Amplify Ember Authenticator&lt;/h2&gt;<br/> <br/> &lt;div&gt;<br/>   {{input type="text" placeholder="Username" value=username}}<br/> &lt;/div&gt;<br/> <br/> &lt;div&gt;<br/>   {{input type="password" placeholder="Password" value=password}}<br/> &lt;/div&gt;<br/> <br/> &lt;div&gt;<br/>   &lt;button onclick={{ action "signIn" }}&gt;Sign In&lt;/button&gt;<br/> &lt;/div&gt;</span><span id="648a" class="lm ln iq kp b gy ls lp l lq lr">{{#if message}}<br/>  &lt;div class="amplify-message"&gt;<br/>   {{message}}<br/>  &lt;/div&gt;<br/> {{/if}}</span><span id="5a8c" class="lm ln iq kp b gy ls lp l lq lr">{{#if error}}<br/>  &lt;div class="amplify-error"&gt;<br/>   {{error}}<br/>  &lt;/div&gt;<br/> {{/if}}<br/> <br/> {{yield}}</span><span id="3834" class="lm ln iq kp b gy ls lp l lq lr">&lt;/section&gt;</span></pre><p id="e378" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">添加一些样式，编辑<code class="fe km kn ko kp b">app/styles/app.css</code>文件:</p><pre class="le lf lg lh gt li kp lj lk aw ll bi"><span id="54f9" class="lm ln iq kp b gy lo lp l lq lr">* {<br/> font-family: Arial;<br/> }</span><span id="5af2" class="lm ln iq kp b gy ls lp l lq lr">.amplify-authenticator {<br/> padding: 1em;<br/> }</span><span id="1a33" class="lm ln iq kp b gy ls lp l lq lr">.amplify-authenticator input {<br/> margin: 0.5em;<br/> padding: 0.5em;<br/> }</span><span id="8d33" class="lm ln iq kp b gy ls lp l lq lr">.amplify-authenticator button {<br/> margin: 0.5em;<br/> padding: 0.5em;<br/> }</span><span id="ae04" class="lm ln iq kp b gy ls lp l lq lr">.amplify-message {<br/> margin: 0.5em;<br/> padding: 0.5em;<br/> color: green;<br/> }</span><span id="ce89" class="lm ln iq kp b gy ls lp l lq lr">.amplify-error {<br/> margin: 0.5em;<br/> padding: 0.5em;<br/> color: red;<br/> }</span></pre><p id="ee3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，生成一条路线:</p><p id="a33b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">$ ember g route login</code></p><p id="18a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将生成一个/login HTTP路由和一个handlebars模板视图文件。</p><p id="eaa7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编辑<code class="fe km kn ko kp b">templates/application.hbs</code>文件并删除欢迎页面组件。该文件现在应该只包含:</p><pre class="le lf lg lh gt li kp lj lk aw ll bi"><span id="cf9a" class="lm ln iq kp b gy lo lp l lq lr">{{outlet}}</span></pre><p id="8db4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编辑<code class="fe km kn ko kp b">app/templates/login.hbs</code>文件:</p><pre class="le lf lg lh gt li kp lj lk aw ll bi"><span id="0767" class="lm ln iq kp b gy lo lp l lq lr">{{outlet}}<br/>{{amplify-authenticator}}</span></pre><p id="7587" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">提供应用程序并访问登录页面:</p><p id="63f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">$ ember s</code></p><p id="3942" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将地址栏改为指向<code class="fe km kn ko kp b">/login</code>，您应该会看到登录表单:</p><figure class="le lf lg lh gt lu gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/3644511fbf50eccb426279f953399b81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*8bg4n3y19Kkxctl1vToEeg.png"/></div></figure><p id="9e8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在浏览器中打开开发者检查器，并切换到“网络”标签。您还应该在inspector中看到从AWS检索匿名访客凭证的网络请求。您还应该看到针对您的会话向Amazon Pinpoint发送的分析请求:</p><figure class="le lf lg lh gt lu gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/90d29881f80a93ae55994e5726f67782.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*sWRwRhqQXQuCjvkArmlUCQ.png"/></div></figure><p id="078e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您尝试登录，您应该会看到来自Amazon Cognito的错误消息，例如，“用户不存在”。您可以将一个用户添加到您的Amazon Cognito用户池中，然后您应该能够从该表单中使用该用户登录。你现在也可以用同样的方式建立一个注册表单，创建用户，并在你的Ember服务中使用AWS Amplify的所有功能。您还可以从CLI启用更多AWS服务。访问<a class="ae kl" href="https://aws-amplify.github.io/amplify-js" rel="noopener ugc nofollow" target="_blank"> AWS Amplify文档</a>,了解如何利用Ember应用中的其他类别。</p><p id="999c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">后续步骤:</p><ul class=""><li id="e17f" class="kq kr iq jp b jq jr ju jv jy ks kc kt kg ku kk kv kw kx ky bi translated">使用MFA添加注册表单</li><li id="cc01" class="kq kr iq jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated">初始化初始化器中的配置</li><li id="e493" class="kq kr iq jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated">使用初始值设定项检查已登录的用户会话</li><li id="66b1" class="kq kr iq jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated">在实例初始化器中填充服务</li><li id="1d0e" class="kq kr iq jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated">使用AWS Mobile CLI构建并部署到亚马逊S3</li></ul></div></div>    
</body>
</html>