<html>
<head>
<title>Yandex.Tank: load testing tool — an overview, configuration, and examples</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Yandex。Tank:负载测试工具——概述、配置和示例</h1>
<blockquote>原文：<a href="https://itnext.io/yandex-tank-load-testing-tool-an-overview-configuration-and-examples-2b0d64295f55?source=collection_archive---------2-----------------------#2021-02-10">https://itnext.io/yandex-tank-load-testing-tool-an-overview-configuration-and-examples-2b0d64295f55?source=collection_archive---------2-----------------------#2021-02-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/c7f2f3da1c40f04b05c8c242d88fa40d.png" data-original-src="https://miro.medium.com/v2/resize:fit:384/format:webp/1*vz4GF9Ojw6oaXQbbIqoRsQ.jpeg"/></div></figure><p id="8b57" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">除了<a class="ae ks" href="https://rtfm.co.ua/apache-bench-testiruem-rabotu-veb-servera/" rel="noopener ugc nofollow" target="_blank">阿帕奇工作台</a>和<a class="ae ks" href="https://rtfm.co.ua/apache-jmeter-nagruzochnoe-testirovanie-veb-servera/" rel="noopener ugc nofollow" target="_blank"> JMeter </a>之外，还有另一个实用工具——Yandex坦克。</p><p id="31a8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">它被我们的QA团队使用，现在是时候让我仔细看看它了，来测试我们的应用程序在Kubernetes集群上运行的一个问题。</p><p id="cc5e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这篇文章中，我们将简要介绍它的功能和配置。</p><p id="ced6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对比<a class="ae ks" href="https://rtfm.co.ua/apache-bench-testiruem-rabotu-veb-servera/" rel="noopener ugc nofollow" target="_blank">阿帕奇板凳</a>，Yandex。Tank显示响应代码统计数据，并且在运行和配置JMeter时更加简单，此外，它还有一个很好的<a class="ae ks" href="https://rtfm.co.ua/?p=25456#Autostop" rel="noopener ugc nofollow" target="_blank">自动停止</a>功能，用于“<em class="kt"> Huston，我们遇到问题</em>”(с)的情况</p><h1 id="17c4" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">成分</h1><p id="ebb3" class="pw-post-body-paragraph ju jv iq jw b jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn lw kp kq kr ij bi translated">参见<a class="ae ks" href="https://yandextank.readthedocs.io/en/latest/core_and_modules.html" rel="noopener ugc nofollow" target="_blank">模块</a>。</p><p id="187d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Yandex坦克核心是用Python写的。</p><p id="95d8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对于负载测试，它有几个模块— <a class="ae ks" href="https://yandextank.readthedocs.io/en/latest/core_and_modules.html#load-generators" rel="noopener ugc nofollow" target="_blank">负载生成器</a>，默认情况下它使用在с++上编写的Phantom，所以它真的很快。</p><p id="1e85" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae ks" href="https://yandextank.readthedocs.io/en/latest/core_and_modules.html#telegraf" rel="noopener ugc nofollow" target="_blank"> Telegraf </a>工具是一个监控模块，它可以通过SSH连接到测试主机，运行自己的代理来收集有关CPU/mem/etc的指标，这些指标将显示在Yandex中。实时负载测试期间的油箱。</p><p id="4cb7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Overloader是一个将结果上传到<a class="ae ks" href="https://overload.yandex.net/" rel="noopener ugc nofollow" target="_blank"> Yandex Overloader </a>或InfluxDB的模块，但我们不会在这里使用它。不过，请看<a class="ae ks" href="https://yandextank.readthedocs.io/en/latest/core_and_modules.html#artifact-uploaders" rel="noopener ugc nofollow" target="_blank">工件上传者</a>。</p><p id="8270" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">此外，在下面的例子中，我不会涉及“弹药”主题来创建更复杂的POST等请求测试，因为对我来说，现在简单的GET请求已经足够了。但是您可以在<a class="ae ks" href="https://yandextank.readthedocs.io/en/latest/tutorial.html#preparing-requests" rel="noopener ugc nofollow" target="_blank">准备请求</a>中找到它的文档。</p><h1 id="ac96" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">运行Yandex。带码头的油罐</h1><p id="a334" class="pw-post-body-paragraph ju jv iq jw b jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn lw kp kq kr ij bi translated">为幻影创建最小配置:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="3bb9" class="mg kv iq mc b gy mh mi l mj mk">phantom:<br/>  address: rtfm.co.ua:443<br/>  header_http: "1.1"<br/>  headers:<br/>    - "[Host: rtfm.co.ua]"<br/>  uris:<br/>    - /<br/>  load_profile:<br/>    load_type: rps<br/>    schedule: const(1,30s)<br/>  ssl: true<br/>console:<br/>  enabled: true<br/>telegraf:<br/>  enabled: false</span></pre><p id="d4bb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里:</p><ul class=""><li id="ca1e" class="ml mm iq jw b jx jy kb kc kf mn kj mo kn mp kr mq mr ms mt bi translated"><code class="fe mu mv mw mc b">phantom</code>:</li><li id="394c" class="ml mm iq jw b jx mx kb my kf mz kj na kn nb kr mq mr ms mt bi translated"><code class="fe mu mv mw mc b">address</code>:目标的地址和端口</li><li id="efb4" class="ml mm iq jw b jx mx kb my kf mz kj na kn nb kr mq mr ms mt bi translated"><code class="fe mu mv mw mc b">header_http</code>:用于请求的HTTP版本，将其设置为1.1以使用持久连接(参见<a class="ae ks" href="https://en.wikipedia.org/wiki/HTTP_persistent_connection" rel="noopener ugc nofollow" target="_blank"> HTTP持久连接</a>)</li><li id="1b84" class="ml mm iq jw b jx mx kb my kf mz kj na kn nb kr mq mr ms mt bi translated"><code class="fe mu mv mw mc b">headers</code>:要传递给目标服务器的一组头</li><li id="8b8a" class="ml mm iq jw b jx mx kb my kf mz kj na kn nb kr mq mr ms mt bi translated"><code class="fe mu mv mw mc b">uris</code>:可拨打电话的URIs列表</li><li id="272a" class="ml mm iq jw b jx mx kb my kf mz kj na kn nb kr mq mr ms mt bi translated"><code class="fe mu mv mw mc b">load_profile</code>:</li><li id="9641" class="ml mm iq jw b jx mx kb my kf mz kj na kn nb kr mq mr ms mt bi translated"><code class="fe mu mv mw mc b">load_type</code>:可设置为<code class="fe mu mv mw mc b">rps</code>或<code class="fe mu mv mw mc b">instances</code>:</li><li id="2932" class="ml mm iq jw b jx mx kb my kf mz kj na kn nb kr mq mr ms mt bi translated"><code class="fe mu mv mw mc b">rps</code> : <em class="kt">每秒请求数</em>——设置发送给测试主机的每秒请求数</li><li id="af83" class="ml mm iq jw b jx mx kb my kf mz kj na kn nb kr mq mr ms mt bi translated"><code class="fe mu mv mw mc b">instances</code>:或者设置想要的活动线程数，这将执行尽可能多的RPS，参见<a class="ae ks" href="https://yandextank.readthedocs.io/en/latest/tutorial.html?highlight=load_type#dynamic-thread-limit" rel="noopener ugc nofollow" target="_blank">动态线程限制</a></li><li id="a2a1" class="ml mm iq jw b jx mx kb my kf mz kj na kn nb kr mq mr ms mt bi translated"><code class="fe mu mv mw mc b">schedule</code>:可设置为<code class="fe mu mv mw mc b">const</code>、<code class="fe mu mv mw mc b">line</code>或<code class="fe mu mv mw mc b">step</code>(或全部)——定义负载测试概要，参见<a class="ae ks" href="https://yandextank.readthedocs.io/en/latest/tutorial.html?highlight=load_type#tutorials" rel="noopener ugc nofollow" target="_blank">教程</a>:</li><li id="5374" class="ml mm iq jw b jx mx kb my kf mz kj na kn nb kr mq mr ms mt bi translated"><code class="fe mu mv mw mc b">const</code>:设置为<em class="kt"> (load，dur) </em>，分别为<em class="kt"> load </em> - RPS编号，<em class="kt"> dur </em> -负载测试持续时间，如上例Yandex。Tank将每秒运行一个请求，持续30秒</li><li id="0062" class="ml mm iq jw b jx mx kb my kf mz kj na kn nb kr mq mr ms mt bi translated"><code class="fe mu mv mw mc b">line</code>:设置为<em class="kt"> (a，b，dur) </em>，其中<em class="kt">a</em>-RPS开始数，<em class="kt"> b </em> -最终数，<em class="kt"> dur </em> -负载测试持续时间，因此RPS将从<em class="kt"> a </em>线性增加到<em class="kt"> b </em>值</li><li id="07fb" class="ml mm iq jw b jx mx kb my kf mz kj na kn nb kr mq mr ms mt bi translated"><code class="fe mu mv mw mc b">step</code>:设置为<em class="kt"> (a，b，step，dur) </em>，其中<em class="kt">a</em>-RPS的起始数，<em class="kt"> b </em> -最终数，<em class="kt"> step </em> -在<em class="kt"> dur </em>秒后每一步会增加多少请求</li><li id="3de1" class="ml mm iq jw b jx mx kb my kf mz kj na kn nb kr mq mr ms mt bi translated"><code class="fe mu mv mw mc b">ssl</code>:为HTTPS请求启用SSL支持(向<code class="fe mu mv mw mc b">address</code>添加443端口)</li><li id="eb94" class="ml mm iq jw b jx mx kb my kf mz kj na kn nb kr mq mr ms mt bi translated"><code class="fe mu mv mw mc b">console</code>:将结果显示到控制台</li><li id="f7c8" class="ml mm iq jw b jx mx kb my kf mz kj na kn nb kr mq mr ms mt bi translated"><code class="fe mu mv mw mc b">telegraf</code>:监控代理配置，将在<a class="ae ks" href="https://rtfm.co.ua/en/yandex-tank-load-testing-tool-an-overview-configuration-and-examples/#Monitoring_Telegraf" rel="noopener ugc nofollow" target="_blank">监控(Telegraf) </a>中介绍</li></ul><p id="27a4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">运行Yandex。带码头的储罐:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="fc12" class="mg kv iq mc b gy mh mi l mj mk">$ docker run — rm -v $(pwd):/var/loadtest -it direvius/yandex-tank</span></pre><p id="837f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">和结果:</p><figure class="lx ly lz ma gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/a5d1191abf387355da60d9c5bdf01b61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2VLLgTfy4u05dSI_.png"/></div></div></figure><h1 id="abd3" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">监控(Telegraf)</h1><p id="1325" class="pw-post-body-paragraph ju jv iq jw b jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn lw kp kq kr ij bi translated">使用<a class="ae ks" href="https://github.com/influxdata/telegraf" rel="noopener ugc nofollow" target="_blank"> Telegraf </a> Yandex。Tank可以通过SSH连接到测试主机来获取资源指标。</p><p id="d1f6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在<code class="fe mu mv mw mc b">load.yaml</code>文件中启用它:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="68c7" class="mg kv iq mc b gy mh mi l mj mk">...<br/>telegraf:<br/>  enabled: true<br/>  package: yandextank.plugins.Telegraf</span></pre><p id="7f4a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要收集的指标在专用文件中描述，将其创建为<code class="fe mu mv mw mc b">monitoring.xml</code>，详见<a class="ae ks" href="https://yandextank.readthedocs.io/en/latest/core_and_modules.html#configuration-file-format" rel="noopener ugc nofollow" target="_blank">配置文件格式</a>:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="82c5" class="mg kv iq mc b gy mh mi l mj mk">&lt;Monitoring&gt;<br/>  &lt;Host address="rtfm.co.ua" interval="1" username="root"&gt;<br/>    &lt;CPU /&gt;<br/>    &lt;Kernel /&gt;<br/>    &lt;Net /&gt;<br/>    &lt;System /&gt;<br/>    &lt;Memory /&gt;<br/>    &lt;Disk /&gt;<br/>    &lt;Netstat/&gt;<br/>  &lt;/Host&gt;<br/>&lt;/Monitoring&gt;</span></pre><p id="91a3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这里的<code class="fe mu mv mw mc b">address</code>中，设置测试目标以从<code class="fe mu mv mw mc b">interval</code> -获取指标的频率，<code class="fe mu mv mw mc b">username</code>-Telegraf模块在连接期间使用的SSH用户收集指标。</p><p id="0542" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">目标主机中的这个用户必须有一个SSH密钥的公共部分才能添加到<code class="fe mu mv mw mc b">~/.ssh/authorized_keys.</code></p><p id="34c2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这个密钥的私有部分将被安装到Yandex上。Tank Docker容器为<code class="fe mu mv mw mc b">/root/.ssh/id_rsa</code>，因为容器中的所有进程都在<code class="fe mu mv mw mc b">root</code>用户下运行:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="e780" class="mg kv iq mc b gy mh mi l mj mk">$ docker run — rm -v $(pwd):/var/loadtest -v /home/setevoy/.ssh/setevoy-do-nextcloud-production-d10–03–11:/root/.ssh/id_rsa -it direvius/yandex-tank</span></pre><h2 id="d754" class="mg kv iq bd kw nh ni dn la nj nk dp le kf nl nm li kj nn no lm kn np nq lq nr bi translated">Paramiko: SSHException:不是有效的RSA私钥文件</h2><p id="dafd" class="pw-post-body-paragraph ju jv iq jw b jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn lw kp kq kr ij bi translated">第一次运行时，Telegraf失败，出现Paramiko错误:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="0c28" class="mg kv iq mc b gy mh mi l mj mk">16:32:54 [ERROR] Failed to install monitoring agent to rtfm.co.ua<br/>Traceback (most recent call last):<br/>File “/usr/local/lib/python2.7/dist-packages/yandextank/plugins/Telegraf/client.py”, line 209, in install out, errors, err_code = self.ssh.execute(cmd)<br/>File “/usr/local/lib/python2.7/dist-packages/yandextank/common/util.py”, line 72, in execute<br/>with self.connect() as client:<br/>File “/usr/local/lib/python2.7/dist-packages/yandextank/common/util.py”, line 42, in connect<br/>timeout=self.timeout, )<br/>File “/usr/local/lib/python2.7/dist-packages/paramiko/client.py”, line 437, in connect<br/>passphrase,<br/>File “/usr/local/lib/python2.7/dist-packages/paramiko/client.py”, line 749, in _auth<br/>raise saved_exception<br/>SSHException: not a valid RSA private key file</span></pre><p id="ca7d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因为DigitalOcean上的RSA密钥是以PEM/OpenSSH格式发布的:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="74b2" class="mg kv iq mc b gy mh mi l mj mk">$ file /home/setevoy/.ssh/setevoy-do-nextcloud-production-d10–03–11<br/>/home/setevoy/.ssh/setevoy-do-nextcloud-production-d10–03–11: OpenSSH private key</span></pre><p id="f105" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">将其转换为RSA:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="7ad7" class="mg kv iq mc b gy mh mi l mj mk">$ ssh-keygen -p -m PEM -f /home/setevoy/.ssh/setevoy-do-nextcloud-production-d10–03–11</span></pre><p id="01e0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">并再次检查:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="056c" class="mg kv iq mc b gy mh mi l mj mk">$ file /home/setevoy/.ssh/setevoy-do-nextcloud-production-d10–03–11<br/>/home/setevoy/.ssh/setevoy-do-nextcloud-production-d10–03–11: PEM RSA private key</span></pre><p id="b58a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">再次运行测试，Telegraf将打印其配置和要使用的指标:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="0d39" class="mg kv iq mc b gy mh mi l mj mk">$ docker run — rm -v $(pwd):/var/loadtest -v /home/setevoy/.ssh/setevoy-do-nextcloud-production-d10–03–11:/root/.ssh/id_rsa -it direvius/yandex-tank<br/>…<br/>16:36:38 [INFO] Detected monitoring configuration: telegraf<br/>16:36:38 [INFO] Preparing test…<br/>16:36:38 [INFO] Telegraf Result config {‘username’: ‘root’, ‘comment’: ‘’, ‘telegraf’: ‘/usr/bin/telegraf’, ‘python’: ‘/usr/bin/env python2’, ‘host_config’: {‘Kernel’: {‘fielddrop’: ‘[“boot_time”]’, ‘name’: ‘[inputs.kernel]’}, ‘Netstat’: {‘name’: ‘[inputs.netstat]’}, ‘System’: {‘fielddrop’: ‘[“n_users”, “n_cpus”, “uptime*”]’, ‘name’: ‘[inputs.system]’}, ‘Memory’: {‘fielddrop’: ‘[“active”, “inactive”, “total”, “used_per*”, “avail*”]’, ‘name’: ‘[inputs.mem]’}, ‘Net’: {‘interfaces’: ‘[“eth0”,”eth1",”eth2",”eth3",”eth4",”eth5"]’, ‘fielddrop’: ‘[“icmp*”, “ip*”, “udplite*”, “tcp*”, “udp*”, “drop*”, “err*”]’, ‘name’: ‘[inputs.net]’}, ‘Disk’: {‘name’: ‘[inputs.diskio]’, ‘devices’: ‘[“vda0”,”sda0",”vda1",”sda1",”vda2",”sda2",”vda3",”sda3",”vda4",”sda4",”vda5",”sda5"]’}, ‘CPU’: {‘fielddrop’: ‘[“time_*”, “usage_guest_nice”]’, ‘name’: ‘[inputs.cpu]’, ‘percpu’: ‘false’}}, ‘startup’: [], ‘host’: ‘rtfm.co.ua’, ‘telegrafraw’: [], ‘shutdown’: [], ‘port’: 22, ‘interval’: ‘1’, ‘custom’: [], ‘source’: []}<br/>16:36:38 [INFO] Installing monitoring agent at root@rtfm.co.ua…<br/>16:36:38 [INFO] Creating temp dir on rtfm.co.ua<br/>16:36:38 [INFO] Execute on rtfm.co.ua: /usr/bin/env python2 -c “import tempfile; print tempfile.mkdtemp();”<br/>…</span></pre><p id="d2df" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在此之后，负载测试将会启动，在右侧您将会看到目标服务器上使用的资源:</p><figure class="lx ly lz ma gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ns"><img src="../Images/98956e75d2d2b600e79510d26449763f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NiQXNCaWNnQIH5eO.png"/></div></div></figure><p id="090e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">服务器上运行的代理:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="6381" class="mg kv iq mc b gy mh mi l mj mk">$ root@rtfm-do-production-d10:~# ps aux | grep tele<br/>root 4580 0.5 0.4 309992 9436 pts/1 Ssl+ 15:38 0:00 python2 /tmp/tmpZez6yJ/agent.py — telegraf /tmp/telegraf — host rtfm.co.ua<br/>root 4582 7.1 1.5 851256 31896 ? Ssl 15:38 0:01 /tmp/telegraf -config /tmp/tmpZez6yJ/agent.cfg</span></pre><h1 id="dbf0" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">自动停止</h1><p id="25ed" class="pw-post-body-paragraph ju jv iq jw b jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn lw kp kq kr ij bi translated">自动停止模块用于在出现问题时终止测试。</p><p id="4e3b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">例如，您可以将其配置为在5[[响应率将高于10%，或者响应时间将大于指定值时停止测试。</p><p id="08c3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">添加以下内容进行检查:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="3043" class="mg kv iq mc b gy mh mi l mj mk">...<br/>autostop:<br/>  autostop:<br/>    - http(2xx,100%,1s)</span></pre><p id="6eac" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">例如，这里测试将停止一次，将在1秒内获得2xx响应。</p><p id="2aec" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">运行测试，并:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="c9f7" class="mg kv iq mc b gy mh mi l mj mk">$ docker run — rm -v $(pwd):/var/loadtest -v /home/setevoy/.ssh/setevoy-do-nextcloud-production-d10–03–11:/root/.ssh/id_rsa -it direvius/yandex-tank<br/>…<br/>16:56:24 [INFO] Monitoring received first data.<br/>16:56:24 [WARNING] Autostop criterion requested test stop: http(2xx,100%,1s)<br/>16:56:24 [WARNING] Autostop criterion requested test stop: 2xx codes count higher than 100.0% for 1s, since 1612889780<br/>16:56:24 [INFO] Finishing test…<br/>16:56:24 [INFO] Stopping load generator and aggregator<br/>…</span></pre><p id="7cd4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">马上就被制止了。</p><p id="d142" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">更多选项参见<a class="ae ks" href="https://yandextank.readthedocs.io/en/latest/tutorial.html?highlight=autostop#autostop" rel="noopener ugc nofollow" target="_blank">文档&gt; &gt; &gt; </a>。</p><p id="a30b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">整个<code class="fe mu mv mw mc b">load.yaml</code>现在是:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="5e9e" class="mg kv iq mc b gy mh mi l mj mk">phantom:<br/>  address: rtfm.co.ua:443<br/>  header_http: "1.1"<br/>  headers:<br/>    - "[Host: rtfm.co.ua]"<br/>  uris:<br/>    - /<br/>  load_profile:<br/>    load_type: rps<br/>    schedule: const(1,30s)<br/>  ssl: true<br/>console:<br/>  enabled: true<br/>telegraf:<br/>  enabled: true<br/>  package: yandextank.plugins.Telegraf<br/>  config: monitoring.xml<br/>autostop:<br/>  autostop:<br/>    - http(2xx,100%,1s)</span></pre><h1 id="a5e3" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">有用的链接</h1><p id="adf9" class="pw-post-body-paragraph ju jv iq jw b jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn lw kp kq kr ij bi translated">很不幸，都是俄语。</p><ul class=""><li id="1321" class="ml mm iq jw b jx jy kb kc kf mn kj mo kn mp kr mq mr ms mt bi translated">автоматизациянагрузочноготестирования·помощи·яндекс.танк</li><li id="7523" class="ml mm iq jw b jx mx kb my kf mz kj na kn nb kr mq mr ms mt bi translated"><a class="ae ks" href="https://gist.github.com/sameoldmadness/9abeef4c2125bc760ba2f09ee1150330" rel="noopener ugc nofollow" target="_blank">нагрузочное。储罐压力计</a></li><li id="bff3" class="ml mm iq jw b jx mx kb my kf mz kj na kn nb kr mq mr ms mt bi translated"><a class="ae ks" href="https://medium.com/@k0st1an/%D0%BD%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BE%D1%87%D0%BD%D0%BE%D0%B5-%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-http-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0-nginx-205k-rps-6a6a5bfa20cb" rel="noopener">http服务器负载测试(nginx),205k+ RPS</a></li><li id="3de2" class="ml mm iq jw b jx mx kb my kf mz kj na kn nb kr mq mr ms mt bi translated"><a class="ae ks" href="https://habr.com/ru/company/yandex/blog/202446/" rel="noopener ugc nofollow" target="_blank">Yandex测试:建立你的月球公园(T3)</a></li><li id="6529" class="ml mm iq jw b jx mx kb my kf mz kj na kn nb kr mq mr ms mt bi translated"><a class="ae ks" href="https://serveradmin.ru/primer-nagruzochnogo-testirovaniya-sajta-s-yandex-tank/" rel="noopener ugc nofollow" target="_blank">使用Yandex的网站负载测试示例。坦克(T5)</a></li></ul></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><p id="86a6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="kt"> RTFM: Linux、DevOps 和系统管理 </em>  <em class="kt">(T13 )</em></p></div></div>    
</body>
</html>