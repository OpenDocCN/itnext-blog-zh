<html>
<head>
<title>Utilizing Docker CLI without Docker Desktop</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在没有Docker桌面的情况下使用Docker CLI</h1>
<blockquote>原文：<a href="https://itnext.io/utilizing-docker-cli-without-docker-desktop-4933f3473d5e?source=collection_archive---------1-----------------------#2021-09-21">https://itnext.io/utilizing-docker-cli-without-docker-desktop-4933f3473d5e?source=collection_archive---------1-----------------------#2021-09-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="52bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">了解如何使用Lima VM和Visual Studio代码替换Docker桌面作为您的Docker GUI</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/5fc73b1582008eaf7e4172db0a1385e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5QMwyUREaTpSo7h1Hb9bzg.png"/></div></div></figure><h1 id="da3d" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">目标</h1><p id="3043" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">这篇文章的目标是提供一个轻量级和简单的替代使用Docker桌面。本文将介绍Lima VM作为一种替代方案，以便使用Docker CLI托管容器，并使用VS代码作为Docker桌面GUI界面的替代。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="e228" class="kx ky iq bd kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ml ls lt lu bi translated">利马虚拟机</h1><p id="2736" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">Lima VM是探索的第一个选项，Lima用于在终端内部创建独立的Linux环境，然后可以用于运行Linux兼容软件，如Podman(用于<a class="ae mm" href="https://medium.com/@ko185061/removing-dependency-on-docker-94c96fcaa024" rel="noopener">消除对Docker </a>的依赖)。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="ac29" class="kx ky iq bd kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ml ls lt lu bi translated">安装和设置Lima来宾虚拟机</h1><p id="88a6" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">Lima可通过brew获得。一旦安装完毕，limactl就是用来启动ubuntu VM的CLI，它允许用户通过shell进入ubuntu VM。一旦进入虚拟机，更新软件包管理器apt，然后安装k3S</p><pre class="km kn ko kp gt mn mo mp mq aw mr bi"><span id="cd4c" class="ms ky iq mo b gy mt mu l mv mw">$ brew install lima<br/>$ limactl start ubuntu<br/>$ limactl shell ubuntu<br/>lima $ sudo apt update<br/>lima $ curl -sfL <a class="ae mm" href="https://get.k3s.io" rel="noopener ugc nofollow" target="_blank">https://get.k3s.io</a> | sh -<br/>lima $ GITHUB_URL=https://github.com/kubernetes/dashboard/releases<br/>VERSION_KUBE_DASHBOARD=$(curl -w ‘%{url_effective}’ -I -L -s -S     lima ${GITHUB_URL}/latest -o /dev/null | sed -e ‘s|.*/||’)<br/>sudo k3s kubectl create -f <a class="ae mm" href="https://raw.githubusercontent.com/kubernetes/dashboard/${VERSION_KUBE_DASHBOARD}/aio/deploy/recommended.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/kubernetes/dashboard/${VERSION_KUBE_DASHBOARD}/aio/deploy/recommended.yaml</a><br/>lima $ exit</span></pre></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="7ee3" class="kx ky iq bd kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ml ls lt lu bi translated">用于本地开发的Docker CLI的最小安装</h1><p id="90c5" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">Lima还提供了一个轻量级VM，用于从mac开发环境运行docker构建。将<em class="mx"> docker.yaml </em>文件下载到您的本地工作站(<a class="ae mm" href="https://github.com/lima-vm/lima/blob/master/examples/docker.yaml" rel="noopener ugc nofollow" target="_blank">https://github . com/Lima-VM/Lima/blob/master/examples/docker.yaml</a>)，将文件另存为docker . YAML并运行以下命令。</p><pre class="km kn ko kp gt mn mo mp mq aw mr bi"><span id="f092" class="ms ky iq mo b gy mt mu l mv mw">$ limactl start ./docker.yaml<br/>$ limactl shell docker<br/>lima $ sudo systemctl enable ssh.service</span></pre><p id="1a43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦shell可用，现在就可以设置mac主机来引用lima虚拟机上安装的docker引擎。以下示例显示了如何使用远程docker构建本地docker文件。</p><pre class="km kn ko kp gt mn mo mp mq aw mr bi"><span id="31b9" class="ms ky iq mo b gy mt mu l mv mw">$ export DOCKER_HOST=ssh://localhost:60006<br/>$ docker build -t limadockertest .<br/>Sending build context to Docker daemon 2.56kB<br/>Step 1/6 : FROM ubuntu:latest<br/> — -&gt; fb52e22af1b0<br/>Step 2/6 : LABEL maintainer=”<a class="ae mm" href="mailto:myname@somecompany.com" rel="noopener ugc nofollow" target="_blank">myname@somecompany.com</a>”<br/> — -&gt; Using cache<br/> — -&gt; c37f3494497d<br/>Step 3/6 : RUN apt-get update &amp;&amp; apt-get upgrade -y<br/> — -&gt; Using cache<br/> — -&gt; e808af724770<br/>Step 4/6 : RUN apt-get install nginx -y<br/> — -&gt; Using cache<br/> — -&gt; ed77ce72f229<br/>Step 5/6 : EXPOSE 80<br/> — -&gt; Using cache<br/> — -&gt; 04279fe5c368<br/>Step 6/6 : CMD [“nginx”, “-g”, “daemon off;”]<br/> — -&gt; Using cache<br/> — -&gt; 800d58e28779<br/>Successfully built 800d58e28779<br/>Successfully tagged limadockertest:latest</span></pre><p id="7af6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用“docker扫描”对图像运行Snyk测试，以找到漏洞并了解如何修复它们</p><pre class="km kn ko kp gt mn mo mp mq aw mr bi"><span id="90f5" class="ms ky iq mo b gy mt mu l mv mw">$ docker images<br/>REPOSITORY TAG IMAGE ID CREATED SIZE<br/>limadockertest2 latest 800d58e28779 About an hour ago 162MB<br/>limadockertest latest 800d58e28779 About an hour ago 162MB<br/>ubuntu latest fb52e22af1b0 13 days ago 72.8MB<br/>```<br/>Once this images have been verified to be in the docker repo, we can verify it is also showing the same results in the linux guest VM.<br/>```<br/>$ docker images<br/>REPOSITORY TAG IMAGE ID CREATED SIZE<br/>limadockertest2 latest 800d58e28779 About an hour ago 162MB<br/>limadockertest latest 800d58e28779 About an hour ago 162MB<br/>ubuntu latest fb52e22af1b0 13 days ago 72.8MB</span></pre><p id="5f5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦这些步骤完成，您可能希望将这些容器部署到运行在Lima-VM上的K8环境中。以上部分介绍了K3S的安装(安装和设置Lima客户虚拟机)并讨论了如何将映像导入K3S。快速回顾一下，可以完成以下步骤…</p><h2 id="fb8f" class="ms ky iq bd kz my mz dn ld na nb dp lh jy nc nd ll kc ne nf lp kg ng nh lt ni bi translated">本地mac计算机</h2><pre class="km kn ko kp gt mn mo mp mq aw mr bi"><span id="134e" class="ms ky iq mo b gy mt mu l mv mw">$ docker save — output limadockertest2.tar limadockertest2</span></pre><h2 id="748b" class="ms ky iq bd kz my mz dn ld na nb dp lh jy nc nd ll kc ne nf lp kg ng nh lt ni bi translated">来宾利马虚拟机</h2><pre class="km kn ko kp gt mn mo mp mq aw mr bi"><span id="1c85" class="ms ky iq mo b gy mt mu l mv mw">lima $ curl -sfL <a class="ae mm" href="https://get.k3s.io" rel="noopener ugc nofollow" target="_blank">https://get.k3s.io</a> | sh -<br/>lima $ sudo k3s ctr images import test/limadockertest2.tar <br/>unpacking docker.io/library/limadockertest2:latest (sha256:ec240d997ec5f7800317da08e4ae4506599ffaf25c611fa1338f08df35edfcb1)…done</span></pre></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="46e9" class="kx ky iq bd kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ml ls lt lu bi translated">VS代码集成</h1><p id="e58d" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">对于简单的交互和类似Docker桌面的图形界面，可以将Lima与VS代码集成</p><p id="459d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一步是使用左下角的ssh按钮从VS代码ssh到lima环境，并从下拉列表中选择“Connect to Host ”:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nj"><img src="../Images/91008978412f7cba2dd031d91651204d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h48PYD376dMDnR2QPlLeSQ.png"/></div></div></figure><p id="b6da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，您需要输入您的ssh位置，以便连接到lima环境:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nk"><img src="../Images/96c694d06f633e65bee6a0576c5c5562.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wP1tpI03LNkTI9b6n-dPzQ.png"/></div></div></figure><p id="7602" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">VS代码现在将打开一个新窗口并建立连接，最后在这个新环境中添加Docker扩展:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ca"><img src="../Images/f562bc5a2e8a77e7622ee36859c0844c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N8rmMTYu4dbAI2pI6fMBjA.png"/></div></div></figure><p id="7074" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，您将能够看到lima环境中的所有容器和图像，并与文件进行交互，就像它们在您的本地机器上一样。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/d65318de25055092b7a03db7e8370f49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*5Qn9n7i7lTCITy9_d4ql8w.png"/></div></figure></div></div>    
</body>
</html>