<html>
<head>
<title>I broke my Kubernetes cluster running on Raspberry Pi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我打破了我的Kubernetes集群运行在树莓派</h1>
<blockquote>原文：<a href="https://itnext.io/i-broke-my-kubernetes-cluster-running-on-raspberry-pi-355234a24d?source=collection_archive---------0-----------------------#2021-03-14">https://itnext.io/i-broke-my-kubernetes-cluster-running-on-raspberry-pi-355234a24d?source=collection_archive---------0-----------------------#2021-03-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="19b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">昨晚我在玩更新——只是比看起来的多了一点，导致了灾难——所有节点突然停止检测网络接口，并且不可能恢复。发表于圆周率日(14/03)的文章附有“吃到饱”代码(在结尾)。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/a6d1716e4318f63c76bee3a2864984ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Jbfviz0HpLITkPB2__Nmw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">我家的树莓派Kubernetes集群(归功于我的妻子忍受它)</figcaption></figure><p id="8908" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">随着我的宠物集群增长到总共6个节点(感谢我的妻子，她知道我生日的最好礼物是一个馅饼RaspberryPi)，我有了一个选择——按照我自己的文章从头开始在Raspberry Pi上设置Kubernetes集群，或者按照DevOps和SRE的方式来做——完全自动化潜在的重建和集群管理。</p><p id="eed6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这篇文章是对我的上一篇文章<a class="ae le" href="https://medium.com/swlh/building-your-home-raspberry-pi-kubernetes-cluster-14eeeb3c521e" rel="noopener">构建您的家庭覆盆子PI Kubernetes集群</a>的直接改进。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lf"><img src="../Images/455f2592145fdc713148e3cf352603b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9vg_c2xjAT1ZFK_w.jpg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">人类对机器|信用:在pixabay的comfreak</figcaption></figure><h1 id="8ed3" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">时间和精力想法</h1><p id="36d8" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">那时我有两个选择，我在睡觉的时候仔细考虑过了。这两种方法都很费时间。</p><p id="0952" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="mj">方法#1: </em> </strong> <br/>早起，手动按照我自己的文章重建东西(原文如此！)或许还能找到一些改进的空间。这种方法，正如我已经多次向自己证明的那样，很容易出现错误和失误，主要是打字错误或跳过一两步，然后试图弄清楚接下来的半个小时到底发生了什么，清除一切，并从头开始一遍又一遍。我已经这样做过几次了，但毕竟，再来一次，不要伤害任何人。</p><p id="a17b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="mj">方法二:</em> </strong> <br/>早起，从头开始编码；这次帮我的终极解决方案就是做一次，用一辈子。使整个集群的重建和生产尽可能容易重现。当然，这意味着更多的停机时间。然而，它的好处将是长期的，让我不用担心集群本身，并最终将它视为一个稳定的解决方案，我可以将我的整个家庭基础架构迁移到其中。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="8b05" class="lg lh it bd li lj mr ll lm ln ms lp lq lr mt lt lu lv mu lx ly lz mv mb mc md bi translated">自动化传奇开始</h1><p id="8d1d" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">在开始任何工作之前，我把重点放在基础的基础上，并建立了一些我在整个过程中遵循的原则。这创建了一个有点自以为是的环境，但是在代码的各个部分之间有大量的逻辑分离，所以亲爱的读者，对你来说，更改代码的任何部分或者注释掉整个文件来禁用这里或那里的一些特性应该更容易一些。</p><p id="db61" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="mj">原则#1 </em> : </strong>在树莓Pi上设置Kubernetes集群可以分为三个部分。设置存储卡、系统级的节点配置，最后是启动Kubernetes资源。</p><p id="a899" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="mj">原则#2 </em> : </strong>有一个NFS服务器运行在我的旧英特尔NUC上，连接到DROBO存储器。将它用作所有节点的永久共享存储会很好。</p><p id="7962" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"/></p><p id="edae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">想到这些，我设法坐下来，开始编写这个小科学怪人的代码。要重现结果(或使其发挥作用)，您需要:</p><ul class=""><li id="c038" class="mw mx it js b jt ju jx jy kb my kf mz kj na kn nb nc nd ne bi translated"><em class="mj"> Mac </em>(针对卡格式化部分)，以后有时间安装Linux VM的时候可能会用平台检测更新脚本。</li><li id="cfcf" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated"><em class="mj"> Ansible </em>(我在2.10.6上运行它)</li><li id="caa2" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated"><em class="mj">地形</em>(写在0.13.4中，也适用于0.14.8)</li><li id="8802" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">这将有助于所有的运行都不会篡改参数</li></ul></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="04dc" class="lg lh it bd li lj mr ll lm ln ms lp lq lr mt lt lu lv mu lx ly lz mv mb mc md bi translated">rPi集群:步骤1</h1><p id="14cf" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">Raspberry Pi使用存储卡作为其硬盘。这可能不是最优的，也肯定不会给你最快的读写速度，但是对于游戏和业余爱好项目来说应该足够了。</p><p id="3bca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第一步</strong>照顾什么？</p><ul class=""><li id="c3bb" class="mw mx it js b jt ju jx jy kb my kf mz kj na kn nb nc nd ne bi translated">格式化存储卡</li><li id="8232" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">将存储卡分为两个分区— 1GB +存储卡的其余部分</li><li id="2fcf" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">将Alpine Linux映像复制到存储卡上</li><li id="ab84" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">创建系统覆盖</li></ul><p id="17df" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">系统覆盖负责将<strong class="js iu"> eth0 </strong>设置为promisc模式(对于MetalLB是必需的),并允许SSH连接到您的Raspberry Pi主机，无需密码。</p><p id="18a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">重要:</strong>检查<code class="fe nk nl nm nn b">001-prepare-card.sh</code>的来源，确保你刚刚插入的存储卡确实是<code class="fe nk nl nm nn b">/dev/disk5</code>否则可能会丢失数据。</p><p id="e3cc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">结果</strong>:准备6张内存卡大约需要一分钟。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="924d" class="lg lh it bd li lj mr ll lm ln ms lp lq lr mt lt lu lv mu lx ly lz mv mb mc md bi translated">rPi集群:步骤2</h1><p id="6ebc" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">这才是真正有趣的开始。我想你已经将存储卡插入你的黑莓个人电脑，连接所有的电缆(网络和电源)并允许它们启动？你现在需要获得你的设备的IP地址——你可以通过连接屏幕到每个设备并执行<code class="fe nk nl nm nn b">ifconfig eth0</code>或者登录到你的路由器并在那里检查。用合适的值调整<code class="fe nk nl nm nn b">pi-hosts.txt</code>。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="3b8f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">重要提示:</strong>未来的一些事情可能需要<code class="fe nk nl nm nn b">pi0</code>主机名。</p><p id="da51" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将以下内容添加到您的<code class="fe nk nl nm nn b">~/.ssh/config</code>文件中，强制作为根连接到所有pi*主机。</p><pre class="kp kq kr ks gt nq nn nr ns aw nt bi"><span id="d9f4" class="nu lh it nn b gy nv nw l nx ny">Host pi?<br/>  User root<br/>  Hostname %h.local</span></pre><p id="1f1b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因为我们已经准备好了微型机器(是的，我是最老的那位),我们需要为可能的运行做准备。您可以使用<code class="fe nk nl nm nn b">001-prepare-ansible.sh</code>脚本轻松做到这一点，该脚本将ssh到pi-hosts文件中指定的每个服务器，为NTP配置chrony并安装Python解释器。</p><p id="0b67" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">重要提示:</strong>您可能需要检查<code class="fe nk nl nm nn b">rpi.yaml</code>文件，并根据需要调整vars部分。我肯定会的。</p><p id="469a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这一步成功后，您可以执行Ansible run <code class="fe nk nl nm nn b">ansible-playbook rpi.yaml -f 10</code>，它将按顺序处理以下内容:</p><p id="5928" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">常见:</strong></p><ul class=""><li id="cab8" class="mw mx it js b jt ju jx jy kb my kf mz kj na kn nb nc nd ne bi translated">安装必要的软件包</li><li id="83e2" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">对RPI存储卡进行分区和格式化</li><li id="2300" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">将“更大”的分区设置为系统盘</li><li id="3ae3" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">添加所有fstab条目</li><li id="fd3b" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">提交更改</li><li id="23a5" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">重启Pi从“永久”分区引导</li></ul><p id="3e5c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> KUBEMASTER: </strong></p><ul class=""><li id="36b1" class="mw mx it js b jt ju jx jy kb my kf mz kj na kn nb nc nd ne bi translated">使用kubeadm设置主节点</li><li id="ec5b" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">在本地存储您的令牌(在<code class="fe nk nl nm nn b">static/token_file</code>中)</li><li id="d5b7" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">在Pi上设置能够访问kubectl的<code class="fe nk nl nm nn b">root</code>用户</li><li id="bf90" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">本地保存Kubernetes配置(在<code class="fe nk nl nm nn b">static/kubectl.conf</code>中)</li></ul><p id="99bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> KUBEWORKER: </strong></p><ul class=""><li id="d9ca" class="mw mx it js b jt ju jx jy kb my kf mz kj na kn nb nc nd ne bi translated">将令牌复制到工作节点</li><li id="84e6" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">它让工人加入你的主人，用令牌文件</li><li id="32c8" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">将<code class="fe nk nl nm nn b">kubectl.conf</code>复制到工人<code class="fe nk nl nm nn b">root</code>用户</li></ul><p id="3b2a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">基本:</strong></p><ul class=""><li id="360e" class="mw mx it js b jt ju jx jy kb my kf mz kj na kn nb nc nd ne bi translated">从主服务器中删除污点，允许它参与工作负载</li><li id="8e82" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">在节点上安装py3-pip、PyYaml和helm</li></ul><p id="ea5f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您还在阅读——祝贺您——您刚刚完成了基本的Kubernetes集群，它什么也不做，需要一点爱。我相信，这就像执行几个脚本并等待它们完成一样简单，而且肯定比手工方法好。</p><p id="4298" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">重要提示:你可以随心所欲地运行它。一旦完成，你的记忆卡就不能重新格式化了。</p><p id="dad0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">结果</strong>:根据您的互联网连接情况，准备6个基本Kubernetes安装节点大约需要一两分钟。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="cc2f" class="lg lh it bd li lj mr ll lm ln ms lp lq lr mt lt lu lv mu lx ly lz mv mb mc md bi translated">rPi集群:步骤3</h1><p id="6c58" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">在成功执行了前面的两个步骤之后，您应该已经为第一次部署准备好了Pi集群。让它按预期工作只需要几个基本的设置步骤，但是你猜怎么着……它们也是自动的，让Terraform来处理。</p><p id="d0f5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们先来看看配置。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="045f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以看到我正在<code class="fe nk nl nm nn b">192.168.50.0/24</code>网络中运行群集，但默认情况下，MetalLB将使用地址为<code class="fe nk nl nm nn b">200-250</code>的网络地址池的“末端”。因为我有我的主torrent服务器和来自Adguard的DNS我希望它们有特定的地址——以及Traefik平衡器服务于仪表板“和其他东西”。</p><p id="88f5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">重要:</strong> <code class="fe nk nl nm nn b">nfs_*_path</code>值应与您在<strong class="js iu">步骤2 </strong>中更新的设置兼容。<br/> <strong class="js iu">重要提示(2): </strong>确保您的Kubernetes配置文件<code class="fe nk nl nm nn b">~/.kube/config</code>更新了来自<code class="fe nk nl nm nn b">static/kubernetes.conf</code>的访问细节——我使用<code class="fe nk nl nm nn b">home-k8s</code>作为上下文名称。</p><p id="7c77" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">地形改造有什么作用？</p><ol class=""><li id="ed1a" class="mw mx it js b jt ju jx jy kb my kf mz kj na kn nz nc nd ne bi translated"><strong class="js iu"> <em class="mj">联网</em> </strong> <br/>安装<em class="mj">绒布</em>连同<code class="fe nk nl nm nn b">host-gw</code>的配置补丁；<br/>安装<em class="mj"> metalLB </em>并将网络设置为<code class="fe nk nl nm nn b">var.network_subnet</code>200–250；</li><li id="a09b" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nz nc nd ne bi translated"><strong class="js iu"> <em class="mj"> Traefik </em> </strong> <br/>安装Traefik代理，并通过metalLB负载平衡器将其暴露给家庭网络。Traefik仪表板本身可以通过<code class="fe nk nl nm nn b">traefik.local</code>访问</li></ol><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oa"><img src="../Images/8f661a1698610e2a41cb964abc01fdb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hcGaSniVokHbpvaYXi7AwQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">在Pi集群上运行的Traefik仪表板</figcaption></figure><ol class=""><li id="e4a9" class="mw mx it js b jt ju jx jy kb my kf mz kj na kn nz nc nd ne bi translated"><strong class="js iu"> <em class="mj"> Adguard </em> </strong> <br/>使用NFS安装具有永久卷声明的Adguard DNS服务；<br/>通过traefik暴露dashboard，并通过家庭网络中的专用IP暴露服务本身，如<code class="fe nk nl nm nn b">adguard.local</code></li></ol><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ob"><img src="../Images/48a5cd32dde9bb87c4796fc3a230c18f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r4msHle-RqWJHzdyTGHFYQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">在Pi群集上运行的Adguard主目录</figcaption></figure><ol class=""><li id="2390" class="mw mx it js b jt ju jx jy kb my kf mz kj na kn nz nc nd ne bi translated"><strong class="js iu"><em class="mj">Prometheus<br/></em></strong>在您的所有节点上安装并部署Prometheus monitoring stack和grafana。修补Prometheus DaemonSet，移除体积挂载的必要性。它还通过traefik暴露grafana，因为<code class="fe nk nl nm nn b">grafana.local.</code>默认的grafana用户/密码组合被设置为<code class="fe nk nl nm nn b">admin:admin</code>。Grafana带来了一个预装的插件<a class="ae le" href="https://grafana.com/grafana/plugins/devopsprodigy-kubegraf-app/" rel="noopener ugc nofollow" target="_blank">devopspprodigy-kube graf-app</a>，我发现它是集群监控的最佳插件。</li></ol><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oc"><img src="../Images/a09911466774795a5eff2ea27fda0829.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-stw5hmva7s08xLy0fM7Lw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">在Pi集群上运行的Grafana仪表板</figcaption></figure><ol class=""><li id="3eb1" class="mw mx it js b jt ju jx jy kb my kf mz kj na kn nz nc nd ne bi translated"><strong class="js iu"><em class="mj">Kubernetes dashboard<br/></em></strong>安装Kubernetes dashboard，并通过traefik在<code class="fe nk nl nm nn b">k8s.local</code>上公开它</li></ol><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi od"><img src="../Images/5b922dfd585a2a3b9dc23ff57c7c2e28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MYV9TTzWeRvbK9jIDtJFVw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">在Pi集群上运行的Kubernetes仪表板</figcaption></figure><ol class=""><li id="7a61" class="mw mx it js b jt ju jx jy kb my kf mz kj na kn nz nc nd ne bi translated"><strong class="js iu"> <em class="mj"> Torrent <br/> </em> </strong>安装并部署具有Flood web界面的Torrent服务器(rTorrent)。通过<code class="fe nk nl nm nn b">torrent.local</code>暴露仪表板。它使用大量挂载来保存数据和配置。将复制设置为1是有原因的——当前锁定文件有问题，并且因为它使用共享目录，所以如果检测到锁定文件，它就不会启动。rTorrent is(在我的私有配置中)设置为监听端口<code class="fe nk nl nm nn b">23340</code>。</li><li id="8ac0" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nz nc nd ne bi translated"><strong class="js iu"> <em class="mj">备份<br/> </em> </strong>由于Raspberry Pi从一个存储卡上运行，由于不断的读写操作，存储卡可能会磨损——我决定将<strong class="js iu"> etcd </strong>的定期备份添加到NFS中。它们每天运行一次，使用terraform应用的配置，每个备份“重量”约为32兆字节。</li></ol><p id="cef7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">运行地形</strong></p><p id="16b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了使事情稍微简单一些，我创建了Makefile，它应该可以帮助您进行设置。您可能需要设置以下环境变量。</p><pre class="kp kq kr ks gt nq nn nr ns aw nt bi"><span id="48c7" class="nu lh it nn b gy nv nw l nx ny">TRAEFIK_API_KEY // Traefik API key<br/>GH_USER // Github user<br/>GH_PAT // Github Personal Access Token</span></pre><p id="39f2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">重要提示:</strong> Github凭证是<strong class="js iu"> <em class="mj">而不是现在使用的</em> </strong>，但是我打算很快添加从GHCR拉私有图片的认证。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="no np l"/></div></figure><h1 id="1fb0" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">整理笔记</h1><p id="3012" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">全部代码都可以在GitHub上获得<a class="ae le" href="https://github.com/lukaszraczylo/rpi-home-cluster-setup" rel="noopener ugc nofollow" target="_blank">lukaszraczylo/rpi-home-cluster-setup</a>，任何人都可以免费使用和修改(像往常一样，非常欢迎拉取请求)。我还发布了支持ARM64处理器的多架构定制docker图像(rTorrent和Flood)。</p><p id="48bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">自动化节省了时间，减少了紧张，并且确实完成了工作。我定期清理整个集群，并使用提到的存储库从头开始构建，以确保它按预期工作。随着新功能和新特性的出现，我将使本文和存储库都保持最新。</p></div></div>    
</body>
</html>