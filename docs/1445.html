<html>
<head>
<title>Google Sign-In for iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS版谷歌登录</h1>
<blockquote>原文：<a href="https://itnext.io/google-sign-in-using-aws-amplify-and-amazon-cognito-69cc3bf219ad?source=collection_archive---------2-----------------------#2018-10-16">https://itnext.io/google-sign-in-using-aws-amplify-and-amazon-cognito-69cc3bf219ad?source=collection_archive---------2-----------------------#2018-10-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b4f47a796fe9b53af90535d77af5c695.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1N_1dpHeshz1lSfyBGAFVQ.png"/></div></div></figure><p id="7379" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">更新(2019年4月):更新了客户端代码，以反映AWS SDK for iOS (2.8.0+)和AWS Amplify的最新auth变化。</em></p><p id="7115" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将继续使用社交登录提供商作为移动认证机制，允许您的用户在iOS云应用中进行认证。在本文中，我们将把<a class="ae kx" href="https://developers.google.com/identity/" rel="noopener ugc nofollow" target="_blank">谷歌登录</a>集成到我们的iOS应用程序中。在上一篇文章“使用AWS Amplify和Amazon Cognito 的<a class="ae kx" rel="noopener ugc nofollow" target="_blank" href="/facebook-login-using-aws-amplify-and-amazon-cognito-4acf74875a04">脸书登录”中，我们使用Amazon身份池通过脸书登录联合身份验证。在那篇文章之前，我们使用Amazon </a><a class="ae kx" rel="noopener ugc nofollow" target="_blank" href="/basic-authentication-for-ios-using-aws-amplify-and-amazon-cognito-233b943222d4"> Cognito用户池作为基本认证</a>来管理我们的应用程序用户目录，每个用户都创建了一个新帐户，并使用他们的用户名/密码进行认证，这是您的应用程序独有的。</p><p id="bbed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">借助谷歌登录集成，用户无需通过Cognito用户池创建新账户或联合脸书，只需在应用中选择<strong class="ka ir">使用谷歌</strong>按钮登录，并使用其谷歌凭据通过谷歌进行身份验证，同时保持在应用流程内。</p><p id="06f8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意:你的应用可以支持脸书、谷歌或用户名/密码的任意组合。你不局限于一个社交提供商或基本认证。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="lc ld l"/></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">桥</figcaption></figure><h1 id="fc85" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">步骤1: Google OAuth客户端id</h1><p id="cd30" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated"><strong class="ka ir">目标</strong>:这里的最终目标是获得OAuth Web客户端ID和iOS客户端ID，以便在您的应用程序中使用Google Sign-in。这些客户端id采用URL的形式。您将从Google开发者门户复制两个客户端id，并保存它们以备后用。</p><p id="60af" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">工作原理</strong>:要在你的iOS应用中实现谷歌登录，你需要一个OAuth Web &amp; iOS客户端ID。这些客户端id是您的Google开发者项目的一部分。Cognito身份池将使用Web客户端ID来管理服务器端Cognito和Google之间的OAuth流。iOS客户端ID将在您的iOS应用程序中使用，以直接向Google授权OAuth流，从而允许您的用户使用他们的Google登录凭据向Google进行身份验证。</p><p id="fb0b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">实现</strong>:有几种方法可以生成(Web和iOS)客户端id。我发现的最简单的方法是遵循谷歌开发者门户的“开始整合”部分。这允许您创建一个新项目或选择一个现有项目，在后台自动生成Web客户端ID，并创建一个iOS客户端ID供您复制。</p><p id="67ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注意</strong>:为Google Sign-In创建OAuth客户端的创建和配置步骤是不断变化的，因此请始终参考Google的官方设置说明。</p><p id="b567" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">从这里开始</strong>:</p><p id="2540" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">一个</strong>。登录<a class="ae kx" href="https://developers.google.com/identity/sign-in/ios/start-integrating" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/identity/sign-in/IOs/start-integrating</a></p><p id="e9c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> B </strong>。向下滚动到<strong class="ka ir">获取OAUTH客户端ID </strong>并选择<strong class="ka ir">创建OAuth客户端ID </strong>按钮。忽略页面上的其他内容。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/a00204942a57dabf63cb1d8b4c763438.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eNM9XmjKuJ4CbU1RO-E9oQ.png"/></div></div></figure><p id="7636" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> C </strong>。按照动画gif中概述的步骤进行您自己的项目。</p><p id="2981" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">创建新项目或选择现有项目。</em></p><p id="74ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">提供将显示给用户的产品名称。</em></p><p id="48ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">指定iOS作为OAuth客户端的具体应用环境。</em></p><p id="4951" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">提供您的iOS应用捆绑包标识符(如com.domain.appname) </em></p><blockquote class="mm mn mo"><p id="9fe2" class="jy jz kw ka b kb kc kd ke kf kg kh ki mp kk kl km mq ko kp kq mr ks kt ku kv ij bi translated"><strong class="ka ir">选择完成</strong>。</p></blockquote><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/ed50c90a11e84252de4eca3f9cc2e93a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*y0QULVMFNpaOellblpFouQ.gif"/></div></div></figure><p id="5243" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> D </strong>。现在，从你的谷歌项目证书页面<a class="ae kx" href="https://console.developers.google.com/apis/credentials" rel="noopener ugc nofollow" target="_blank">https://console.developers.google.com/apis/credentials</a>获取你的<strong class="ka ir">网络客户端ID </strong>和<strong class="ka ir"> iOS客户端ID </strong></p><p id="78a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> E </strong>。选中您的项目后，在<strong class="ka ir"> OAuth 2.0客户端ID</strong>下，复制并保存<strong class="ka ir"> Web客户端ID </strong>(与Web应用程序类型相关)和<strong class="ka ir"> iOS客户端ID </strong>(与iOS类型相关)，以备下一步使用。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/19b9513fa700c4a33be59837df887c20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ZwGHFUdGNjTtD3Cwiysmg.png"/></div></div></figure></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><h1 id="7149" class="li lj iq bd lk ll nb ln lo lp nc lr ls lt nd lv lw lx ne lz ma mb nf md me mf bi translated">步骤2:在Xcode中创建新的iOS项目</h1><p id="72b3" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated">创建新的Swift iOS单视图应用程序或使用现有的Xcode iOS swift项目。下一步，我们将使用AWS Amplify对该应用程序进行云支持。</p><h1 id="0ec9" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">步骤3:放大CLI</h1><p id="e134" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated">使用Amplify CLI初始化Google登录的云后端</p><p id="a925" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[首次安装Amplify CLI</p><p id="d177" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在初始化我们的后端之前，我们将使用AWS Amplify CLI，它是<a class="ae kx" href="https://aws-amplify.github.io/media/toolchain?utm_source=da&amp;utm_medium=blog&amp;utm_campaign=denhills&amp;utm_term=ios_native" rel="noopener ugc nofollow" target="_blank"> AWS Amplify工具链</a>的一部分。如果您之前没有安装AWS Amplify CLI，这里有一个快捷方式。<em class="kw">放大配置</em>仅当您尚未安装或配置AWS unified CLI时才需要。如果您安装了AWS CLI，Amplify CLI将利用这些凭据。</p><pre class="ky kz la lb gt ng nh ni nj aw nk bi"><span id="7ddb" class="nl lj iq nh b gy nm nn l no np">$ npm install -g @aws-amplify/cli<br/>$ amplify configure</span></pre><p id="35b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一次性安装。查看<a class="ae kx" href="https://aws-amplify.github.io/media/get_started?utm_source=da&amp;utm_medium=blog&amp;utm_campaign=denhills&amp;utm_term=iOS_native" rel="noopener ugc nofollow" target="_blank">入门教程</a>了解更多详情。</p><p id="43d6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[通过Amplify CLI将Auth添加到我们的iOS应用程序]</p><p id="fa1a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在iOS项目文件夹的根目录下启动Mac终端。现在，我们将使用下面的Amplify命令初始化我们的AWS后端项目。</p><pre class="ky kz la lb gt ng nh ni nj aw nk bi"><span id="84b4" class="nl lj iq nh b gy nm nn l no np">$ amplify init</span></pre><p id="62f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将指导您完成设置项目的过程。<strong class="ka ir">确保在适当的时候选择iOS</strong>。</p><p id="f11e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，让我们向移动项目添加经过身份验证的访问。我们将遵循AWS文档中的<a class="ae kx" href="https://docs.aws.amazon.com/aws-mobile/latest/developerguide/add-aws-mobile-user-sign-in.html" rel="noopener ugc nofollow" target="_blank">电子邮件&amp;密码</a>选项选项卡中概述的相同流程。</p><pre class="ky kz la lb gt ng nh ni nj aw nk bi"><span id="b45e" class="nl lj iq nh b gy nm nn l no np">$ amplify add auth</span></pre><p id="5de8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于我们没有选择默认设置，我在应用程序中使用的值显示在下图中。大多数是您通过输入的默认值，其他的，您有机会命名您的资源。</p><p id="ee5b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于下面的配置，我将通过用户池和谷歌登录添加基本身份验证，因为这更容易一步完成，而且为您的用户提供基本登录和社交登录选项也很好。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nq"><img src="../Images/4c744c0e15a674bbf2fd308760d76f12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KTINWC1YWwXWSYOtIG547Q.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">此处找到的OAuth客户端id:<a class="ae kx" href="https://console.developers.google.com/apis/credentials" rel="noopener ugc nofollow" target="_blank">https://console.developers.google.com/apis/credentials</a></figcaption></figure><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nr"><img src="../Images/822dfaa32ab177308c3ccefb4c0998ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lYccWjnhbWK7Ctjijy9E_g.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">AWS Amplify CLI —带基本身份验证和Google登录的身份验证</figcaption></figure><p id="9df9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将本地配置更改推送到您的AWS帐户</p><pre class="ky kz la lb gt ng nh ni nj aw nk bi"><span id="dfae" class="nl lj iq nh b gy nm nn l no np">$ amplify push</span></pre><p id="0c74" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们现在有了一个认知用户池、身份池、认证和未认证的IAM角色，以及作为认证提供者的Google。</p></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><h1 id="3844" class="li lj iq bd lk ll nb ln lo lp nc lr ls lt nd lv lw lx ne lz ma mb nf md me mf bi translated"><strong class="ak">步骤4:为iOS设置AWS Mobile SDK(cocoa pods)</strong></h1><p id="4e29" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated">在这个例子中，我将使用Cocoapods进行依赖管理，因为这是目前推荐的将AWS SDK集成到iOS项目中的方法。更多关于<a class="ae kx" href="https://cocoapods.org/" rel="noopener ugc nofollow" target="_blank">椰子的信息</a>。如果你的应用程序中还没有pod，你可以简单地运行一个<em class="kw"> $ pod init </em>，它会为你创建一个新的pod文件。有了Podfile之后，向该文件添加以下依赖项。</p><pre class="ky kz la lb gt ng nh ni nj aw nk bi"><span id="d41a" class="nl lj iq nh b gy nm nn l no np">$ pod init</span></pre><p id="1b36" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在您的<em class="kw"> Podfile </em>中，向该文件添加以下依赖项。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/11e32afb898ea21f41fa16347162589f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Hd-B3kTU22gLs95VHCZog.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated"><a class="ae kx" href="https://gist.github.com/mobilequickie/0ad088a2731616462fcd6b556363120c" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/mobile quickie/0ad 088 a 2731616462 fcd6b 556363120 c</a></figcaption></figure><p id="ae02" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将SDK库引入您的项目:</p><pre class="ky kz la lb gt ng nh ni nj aw nk bi"><span id="026c" class="nl lj iq nh b gy nm nn l no np">$ pod install --repo-update</span></pre></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><h1 id="b49c" class="li lj iq bd lk ll nb ln lo lp nc lr ls lt nd lv lw lx ne lz ma mb nf md me mf bi translated">步骤5: AWSConfiguration.json</h1><p id="6175" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated">当使用AWS Amplify CLI提供后端资源时，它会在iOS Xcode项目的根目录下生成一个名为<em class="kw"> awsconfiguration.json </em>的文件。该文件包含可通过应用程序访问的资源的描述，并在Amplify工具链添加、更新或删除资源时与项目同步。这种配置文件的自动更新是使用Amplify CLI从您的本地移动开发环境中提供AWS资源的巨大好处之一。</p><p id="a1a3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">您只需将awsconfiguration.json文件添加到Xcode项目中一次。您可以通过将它拖到Xcode项目管理器中的Finder来完成此操作。</em></p><p id="727f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果要复制文件，系统会提示您。<strong class="ka ir">取消选择复制项目框</strong>。当情况发生变化时，AWS Amplify CLI会更新该文件。如果您选中目标框，那么您的项目在被复制时可能不会收到更新。如果取消选中该框，则每当您通过Amplify CLI修改项目资源时，该文件都会更新。</p><h1 id="85e1" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">步骤6: Google登录iOS URL方案</h1><p id="a408" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated">Google登录回调流需要一个定制的URL方案添加到您的iOS项目中。该URL方案是您在<em class="kw">获取Google项目证书(OAuth客户端ID)的第3步中复制的OAuth iOS客户端ID。</em></p><p id="a808" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要添加自定义方案，我们将编辑Xcode项目Info.plist:</p><p id="ed2a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">启动Xcode，使用<strong class="ka ir">右键&gt;打开其<code class="fe nt nu nv nh b">Info.plist</code>文件作为&gt;源代码。</strong></p><p id="0d1c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您的iOS客户端ID放在Info.plist的字符串值中，但顺序相反。</p><p id="7e7d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">颠倒的客户端ID是您的iOS客户端ID(以URL的形式),点分隔字段的顺序颠倒了。例如:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/22f628462f0d4beedf2e593f7d9915f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9iQs7nZE2TpNUPeV69GYxA.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">iOS项目中的自定义URL方案</figcaption></figure><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/4e0ee27fd63f941c315a0c83e405abe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MGn3d0nEkbaMurnylZoosQ.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated"><a class="ae kx" href="https://gist.github.com/mobilequickie/133cf95d49dc36a47a2f6d75f0c9e2b0" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/mobile quickie/133 cf 95d 49 DC 36 a 47 a2 f 6d 75 f 0 c 9 e 2 b 0</a></figcaption></figure><p id="0b0a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在您已经配置了Xcode项目，您可以将<a class="ae kx" href="https://developers.google.com/identity/sign-in/ios/sign-in" rel="noopener ugc nofollow" target="_blank"> Google Sign-In </a> UI添加到由AWSMobileClient管理的iOS应用程序中，并将内置的Auth UI作为AWS Mobile SDK的一部分。</p><h1 id="1901" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><strong class="ak">步骤7:初始化AWSMobileClient </strong></h1><p id="def7" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated">在您希望用户注册或登录的根UIViewController或相关屏幕中，添加下图中引用的以下代码:</p><blockquote class="mm mn mo"><p id="226f" class="jy jz kw ka b kb kc kd ke kf kg kh ki mp kk kl km mq ko kp kq mr ks kt ku kv ij bi translated">1.添加第2行的导入</p><p id="84cf" class="jy jz kw ka b kb kc kd ke kf kg kh ki mp kk kl km mq ko kp kq mr ks kt ku kv ij bi translated">2.将<strong class="ka ir">initializeAWSMobileClient()</strong>调用添加到viewDidLoad()的底部，如<strong class="ka ir">第9行</strong>所示</p><p id="c404" class="jy jz kw ka b kb kc kd ke kf kg kh ki mp kk kl km mq ko kp kq mr ks kt ku kv ij bi translated">3.将第12–45行的新函数<strong class="ka ir">initializeAWSMobileClient()</strong>添加到视图控制器中。</p></blockquote><p id="cf1f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意:<em class="kw"> showSignIn() </em>函数还不存在。我们将在下一步中添加它。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/02ec5c83894fd3919d55857d6effb0f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oDZc-I2iOW5PsV-5rrFmjg.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated"><a class="ae kx" href="https://gist.github.com/dennisAWS/8fba1d9dc738141452ceeb9f98992f40" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/dennisAWS/8 FBA 1d 9 DC 738141452 ceeb 9 f 98992 f 40</a></figcaption></figure><h1 id="aa0e" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><strong class="ak">第八步:在UI中添加谷歌签到下拉</strong></h1><p id="cebc" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated">将<em class="kw"> showSignIn() </em>函数添加到与上面相同的视图控制器中。这是允许您的用户注册、登录和重置密码的插件式身份验证用户界面。您可以自定义背景颜色和图像，以匹配您的品牌。当用户注销或用户的刷新令牌过期时，将调用此函数。注意:脸书的刷新令牌通常在60天内有效，没有任何活动。Google登录更新令牌是“长期”的，所以不确定它何时到期。用户池(基本身份验证)刷新令牌因开发人员而异，从1天到365天不等。</p><blockquote class="mm mn mo"><p id="6c7a" class="jy jz kw ka b kb kc kd ke kf kg kh ki mp kk kl km mq ko kp kq mr ks kt ku kv ij bi translated">将第12–23行的新函数<strong class="ka ir"> showSignIn() </strong>添加到视图控制器中。</p></blockquote><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/10be938d85bf1d128f361598c411d511.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cpyY2GsqodUyOlFjh1H_rw.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated"><a class="ae kx" href="https://gist.github.com/dennisAWS/30e43e3ba8ab7df79a5fe85973d7543e" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/dennisAWS/30 e 43 e 3 ba 8 ab 7 df 79 a5 Fe 85973d 7543 e</a></figcaption></figure><p id="4cac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">警告。使用Auth UI drop in时，iOS应用程序中需要UINavigationController:Auth UI是AWS Mobile SDK的一部分，它要求您的应用程序具有UINavigationController。</p><p id="eee3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">若要将UINavigationController添加到您的应用程序(如果不存在):</p><blockquote class="mm mn mo"><p id="414d" class="jy jz kw ka b kb kc kd ke kf kg kh ki mp kk kl km mq ko kp kq mr ks kt ku kv ij bi translated">将UINavigationController添加到您的iOS应用程序:从您的Xcode项目中，选择Storyboard中的ViewController，然后选择菜单选项:</p><p id="ec88" class="jy jz kw ka b kb kc kd ke kf kg kh ki mp kk kl km mq ko kp kq mr ks kt ku kv ij bi translated"><em class="iq">编辑</em>-&gt;-<em class="iq">嵌入</em>-&gt;-<em class="iq">导航控制器。</em></p></blockquote><h1 id="6e0f" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">步骤9:构建并运行你的应用程序</h1><p id="88e5" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated">您应该看到AWS SDK为您的应用程序预建的登录UI，因为用户最初没有经过身份验证。用于iOS的AWS SDK提供了一个标准的默认UI，现在允许用户通过谷歌登录<strong class="ka ir">注册(注册)</strong>，触发<strong class="ka ir">忘记密码</strong>功能，当然还有内置的<strong class="ka ir">登录</strong>功能以及默认的用户名/电子邮件和密码字段。</p><p id="082d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">点击<strong class="ka ir">用谷歌登录</strong>按钮。然后，用户被重定向，并被要求用他们的谷歌凭证登录。一旦通过验证，UI对话框将会消失，您现在应该会看到您的视图控制器屏幕。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/afb66a81899800e30f25a7b4035a7e2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*D5gUdbecCdwRdCFUS5XaeA.png"/></div></div></figure><p id="913c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此时，应用程序用户通过Google进行了身份验证，现在的用户<strong class="ka ir">承担了经过身份验证的IAM角色</strong>，并被授予了与该角色相关的权限，但是，该角色仍然有一个空的访问策略。当用户通过Cognito用户池或脸书使用用户名/密码进行身份验证时，我们也经历了同样的过程。这一次，用户使用Google作为Cognito Identity Pool的身份提供者进行身份验证。</p></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><h2 id="2725" class="nl lj iq bd lk ob oc dn lo od oe dp ls kj of og lw kn oh oi ma kr oj ok me ol bi translated"><strong class="ak">最后的想法</strong></h2><p id="51a7" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated">Amazon Cognito是所有连接到AWS资源的移动应用的认证和未认证流的默认选择。如果您不需要登录或使用任何其他身份提供商，如脸书或谷歌，请使用cogn ITO Federated Identities(<strong class="ka ir">cogn ITO Identity Pool</strong>)。</p><p id="f4df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于通过Google进行身份验证的用户，AWS Mobile SDK会将经过身份验证的用户令牌传递(并充当身份管理器)到您的Cognito身份池，以换取该用户调用您的AWS资源的临时AWS凭据。然后，用户访问由<strong class="ka ir"> IAM认证角色</strong>定义。如果用户不进行身份验证，Cognito Identity Pool仍然授予AWS凭证，并且用户的访问由<strong class="ka ir"> IAM未验证角色</strong>定义。</p><blockquote class="mm mn mo"><p id="8564" class="jy jz kw ka b kb kc kd ke kf kg kh ki mp kk kl km mq ko kp kq mr ks kt ku kv ij bi translated">想深入了解Cognito身份池与Google登录的集成吗？如果您对AWS Mobile SDK如何与Amazon Cognito Identity Pool一起识别当前登录用户的幕后工作感兴趣，请查看Google的“<a class="ae kx" href="https://developers.google.com/identity/sign-in/ios/backend-auth" rel="noopener ugc nofollow" target="_blank">使用后端服务器</a>进行身份验证”指南。这让您更好地理解AWS Mobile SDK以及与Amazon Cognito的集成。</p></blockquote><h1 id="9395" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">资源</h1><p id="6997" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated"><a class="ae kx" href="https://developers.google.com/identity/sign-in/ios/" rel="noopener ugc nofollow" target="_blank">谷歌登录您的iOS应用</a></p><p id="d58b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kx" href="https://aws-amplify.github.io/media/toolchain?utm_source=da&amp;utm_medium=blog&amp;utm_campaign=denhills&amp;utm_term=ios_native" rel="noopener ugc nofollow" target="_blank"> AWS Amplify </a>(使用Amplify CLI将我们的应用程序云化)</p><p id="ce32" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kx" href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-identity-pools.html" rel="noopener ugc nofollow" target="_blank">亚马逊认知用户池</a>(用于基本认证)</p><p id="cf62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kx" href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-identity.html" rel="noopener ugc nofollow" target="_blank">亚马逊认知身份池</a>(用于联合基本认证和谷歌登录)</p></div></div>    
</body>
</html>