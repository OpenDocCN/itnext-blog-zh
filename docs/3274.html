<html>
<head>
<title>How to install Kafka using Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Docker安装Kafka</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-install-kafka-using-docker-a2b7c746cbdc?source=collection_archive---------0-----------------------#2019-11-11">https://itnext.io/how-to-install-kafka-using-docker-a2b7c746cbdc?source=collection_archive---------0-----------------------#2019-11-11</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="8c23" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">为测试和开发目的设置Kafka集群</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/03bb9a50712d82044242972474abe329.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K3JlvkpyY_MLtOioiMczpg.png"/></div></div></figure><p id="41a7" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在我的上一篇文章中，我试图提供一个关于卡夫卡的能力和用法的大图。如果你想开始学习Kafka并测试它的特性，第一步是安装它。Kafka是一款<a class="ae lr" href="https://en.wikipedia.org/wiki/Java_virtual_machine" rel="noopener ugc nofollow" target="_blank"> JVM </a>应用，你只需安装<a class="ae lr" href="https://sv.wikipedia.org/wiki/Java_Runtime_Environment" rel="noopener ugc nofollow" target="_blank"> JRE </a>(你可以安装<a class="ae lr" href="https://sv.wikipedia.org/wiki/Java_Development_Kit" rel="noopener ugc nofollow" target="_blank"> JDK </a>)就可以在Windows、macOS、Linux等多种操作系统上运行。但是我们需要了解卡夫卡什么才能安装它呢？</p><h1 id="22b5" class="ls lt iu bd lu lv lw lx ly lz ma mb mc ka md kb me kd mf ke mg kg mh kh mi mj bi translated">阿帕奇动物园管理员</h1><p id="d765" class="pw-post-body-paragraph kv kw iu kx b ky mk jv la lb ml jy ld le mm lg lh li mn lk ll lm mo lo lp lq in bi translated">即使你想运行一个单一的代理Kafka安装或者一个巨大的集群，你也应该安装<a class="ae lr" href="https://zookeeper.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache ZooKeeper </a>。虽然您可以使用Kafka发行版中包含的脚本运行Zookeeper服务器，而无需单独下载和安装ZooKeeper，但最好安装完整版本的ZooKeeper。出于测试目的，您可以安装一个独立的Zookeeper服务器，但是对于生产，您应该设置一个ZooKeeper集群。</p><p id="35d6" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">Kafka将关于集群和消费者的信息存储到Zookeeper中。动物园管理员在它们之间扮演协调者的角色。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj mp"><img src="../Images/cf5cb6d118c227459f07ee0e7174b039.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*q_DlMKt3utk25Mu55nuAiA.jpeg"/></div><figcaption class="mq mr gk gi gj ms mt bd b be z dk translated">动物园管理员与卡夫卡经纪人、消费者和生产者的关系——来自Bitnine.net的影像</figcaption></figure><h1 id="e1b0" class="ls lt iu bd lu lv lw lx ly lz ma mb mc ka md kb me kd mf ke mg kg mh kh mi mj bi translated">什么是Kafka broker &amp; cluster？</h1><p id="0815" class="pw-post-body-paragraph kv kw iu kx b ky mk jv la lb ml jy ld le mm lg lh li mn lk ll lm mo lo lp lq in bi translated">在Kafka术语中，单个Kafka服务器(进程)被称为代理。代理的主要职责是:从生产者那里获得消息，将它们存储在磁盘上，并响应消费者的请求。</p><p id="ae26" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">Kafka代理可以是Kafka集群的一部分。代理可以是集群控制器，也可以不是，还可以是几个分区的领导者(所有者),并保留几个其他分区的冗余副本(用于复制)。</p><h1 id="0fcc" class="ls lt iu bd lu lv lw lx ly lz ma mb mc ka md kb me kd mf ke mg kg mh kh mi mj bi translated">为什么是码头工人</h1><p id="4a82" class="pw-post-body-paragraph kv kw iu kx b ky mk jv la lb ml jy ld le mm lg lh li mn lk ll lm mo lo lp lq in bi translated">对于开发人员、测试人员和部署人员来说，Docker是一项革命性的技术。作为一名开发人员，docker帮助我拥有了一个干净的操作系统，不需要直接在上面安装任何东西。另一方面，由于安装<strong class="kx iv">的复杂性和依赖性</strong>，安装一些系统或服务器非常困难，Kafka是那些依赖ZooKeeper的系统之一，并且也有一些先决条件，我不想每次都设置它们。通过使用Docker和Docker Compose，我们可以有一个单独的文件，允许我们运行一个测试单个Kafka broker或集群。</p><h1 id="45f7" class="ls lt iu bd lu lv lw lx ly lz ma mb mc ka md kb me kd mf ke mg kg mh kh mi mj bi translated">我们开始吧</h1><p id="0b3b" class="pw-post-body-paragraph kv kw iu kx b ky mk jv la lb ml jy ld le mm lg lh li mn lk ll lm mo lo lp lq in bi translated">我使用<a class="ae lr" href="https://bitnami.com/stack/kafka" rel="noopener ugc nofollow" target="_blank"> Bitnami </a>图像为卡夫卡和<em class="mu"> </em> ZooKeeper创建容器:</p><div class="mv mw gq gs mx my"><a href="https://bitnami.com/stack/kafka" rel="noopener  ugc nofollow" target="_blank"><div class="mz ab fp"><div class="na ab nb cl cj nc"><h2 class="bd iv gz z fq nd fs ft ne fv fx it bi translated">卡夫卡</h2><div class="nf l"><h3 class="bd b gz z fq nd fs ft ne fv fx dk translated">关于Bitnami Kafka Stack Kafka是一个分布式流媒体平台，旨在构建实时管道，可以…</h3></div><div class="ng l"><p class="bd b dl z fq nd fs ft ne fv fx dk translated">bitnami.com</p></div></div><div class="nh l"><div class="ni l nj nk nl nh nm kt my"/></div></div></a></div><p id="e382" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">Kafka的Bitnami映像包含Kafka的最新错误修复和功能，并基于minideb，minideb是一个极简的基于Debian的容器映像(一个小的基本容器映像)。</p><p id="3380" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">正如我们所说，在任何情况下，如果你想安装和运行Kafka，你应该运行一个ZooKeeper服务器。在使用docker运行ZooKeep容器之前，我们为集群创建了一个docker网络:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nn no l"/></div></figure><p id="b151" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">现在我们应该从<a class="ae lr" href="https://bitnami.com/stack/zookeeper" rel="noopener ugc nofollow" target="_blank"> Bitnami ZooKeeper </a> image运行一个ZooKeeper容器:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nn no l"/></div></figure><p id="6e55" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">默认情况下，ZooKeeper运行在端口2181上，我们使用<code class="fe np nq nr ns b">-p</code> param公开该端口，以便我们可以从测试主机上的客户端应用程序访问ZooKeeper。我们将“<em class="mu">ALLOW _ ANONYMOUS _ log in”</em>配置设置为true，因为我们希望允许用户轻松连接到ZooKeeper(无需认证)，这种配置不适合生产使用。</p><p id="3d09" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">如果您想确保ZooKeeper安装正确，并且可以从测试主机上访问，您可以使用<code class="fe np nq nr ns b">telnet</code>命令，然后使用<code class="fe np nq nr ns b">srvr</code>命令来获取ZooKeeper信息(如果您使用<a class="ae lr" href="https://docs.docker.com/toolbox/" rel="noopener ugc nofollow" target="_blank"> Docker工具箱</a>，您应该使用<code class="fe np nq nr ns b">192.168.99.100</code>而不是<code class="fe np nq nr ns b">localhost</code>):</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nn no l"/></div></figure><p id="c7f6" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">对于生产应用，您应该运行一个ZooKeeper实例集群(称为集成)。</p><p id="12d1" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">现在一切都准备好了，可以运行我们的第一个代理并将其加入集群。为了向集群添加一个代理，我们需要将它引入ZooKeeper。Kafka代理通过了解Zookeeper服务器的IP地址向Zookeeper服务器(或集群)介绍自己:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nn no l"/></div></figure><p id="4548" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我们使用“<em class="mu">KAFKA _ CFG _ ZOOKEEPER _ CONNECT</em>”配置发送Zookeeper服务器地址和端口，并通过将“<em class="mu">ALLOW _ PLAINTEXT _ LISTENER</em>”配置设置为false，允许纯文本通信(例如，而不是SSL)并设置“<em class="mu">KAFKA _ CFG _ ADVERTISED _ LISTENERS</em>”配置值，以便Zookeeper可以向客户端发布该代理的公共IP地址和端口。</p><p id="9926" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">现在我们有了一个单一的代理Kafka集群，我们可以工作和测试它。</p><h1 id="e9a5" class="ls lt iu bd lu lv lw lx ly lz ma mb mc ka md kb me kd mf ke mg kg mh kh mi mj bi translated">使用Kafka桌面客户端连接到Kafka集群</h1><p id="8232" class="pw-post-body-paragraph kv kw iu kx b ky mk jv la lb ml jy ld le mm lg lh li mn lk ll lm mo lo lp lq in bi translated"><a class="ae lr" href="https://www.conduktor.io/" rel="noopener ugc nofollow" target="_blank"> Conduktor </a>是一个非常简单而强大的Kafka桌面客户端(GUI ),可以在Mac OS X、Windows和Linux上运行。为了使用Conduktor连接到Kafka集群，您需要知道至少一个代理地址和端口，并且您还可以使用Conduktor测试ZooKeeper服务器(或集群)。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nt"><img src="../Images/aedcad789ba101357d879b301e536635.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sisTXZjWzLI62rGuIL5acg.png"/></div></div></figure><p id="8c00" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">Conduktor有几个很棒的功能，例如监控Kafka集群状态，获取关于经纪人、主题和…的信息，创建生产者和消费者以及其他几个功能。对于测试和开发来说，它是一个非常好的工具。</p><p id="cb2f" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">您可以随时通过增加端口号向集群中添加更多代理:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nn no l"/></div></figure><h1 id="6d2b" class="ls lt iu bd lu lv lw lx ly lz ma mb mc ka md kb me kd mf ke mg kg mh kh mi mj bi translated">使用docker-compose代替几个docker命令</h1><p id="5a1c" class="pw-post-body-paragraph kv kw iu kx b ky mk jv la lb ml jy ld le mm lg lh li mn lk ll lm mo lo lp lq in bi translated">您可以使用docker Compose更轻松地设置您的集群，而不是运行几个Docker命令来创建网络并运行ZooKeeper和Kafka brokers的容器。由于docker-compose会自动建立一个新的网络并将所有部署的服务连接到该网络，因此您不需要显式定义<code class="fe np nq nr ns b">kafka-net</code> network:</p><pre class="kk kl km kn gu nu ns nv nw aw nx bi"><span id="7465" class="ny lt iu ns b gz nz oa l ob oc"><strong class="ns iv">version</strong>: <strong class="ns iv">'2'<br/><br/>networks</strong>:<br/>  <strong class="ns iv">kafka-net</strong>:<br/>    <strong class="ns iv">driver</strong>: bridge<br/><br/><strong class="ns iv">services</strong>:<br/>  <strong class="ns iv">zookeeper-server</strong>:<br/>    <strong class="ns iv">image</strong>: <strong class="ns iv">'bitnami/zookeeper:latest'<br/>    networks</strong>:<br/>      - kafka-net<br/>    <strong class="ns iv">ports</strong>:<br/>      - <strong class="ns iv">'2181:2181'<br/>    environment</strong>:<br/>      - ALLOW_ANONYMOUS_LOGIN=yes<br/>  <strong class="ns iv">kafka-server1</strong>:<br/>    <strong class="ns iv">image</strong>: <strong class="ns iv">'bitnami/kafka:latest'<br/>    networks</strong>:<br/>      - kafka-net    <br/>    <strong class="ns iv">ports</strong>:<br/>      - <strong class="ns iv">'9092:9092'<br/>    environment</strong>:<br/>      - KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper-server:2181<br/>      - KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://localhost:9092<br/>      - ALLOW_PLAINTEXT_LISTENER=yes<br/>    <strong class="ns iv">depends_on</strong>:<br/>      - zookeeper-server<br/>  <strong class="ns iv">kafka-server2</strong>:<br/>    <strong class="ns iv">image</strong>: <strong class="ns iv">'bitnami/kafka:latest'<br/>    networks</strong>:<br/>      - kafka-net    <br/>    <strong class="ns iv">ports</strong>:<br/>      - <strong class="ns iv">'9093:9092'<br/>    environment</strong>:<br/>      - KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper-server:2181<br/>      - KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://localhost:9093<br/>      - ALLOW_PLAINTEXT_LISTENER=yes<br/>    <strong class="ns iv">depends_on</strong>:<br/>      - zookeeper-server</span></pre><p id="b15b" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">现在，您只需执行一个命令就可以运行您的集群:<code class="fe np nq nr ns b">docker-compose up -d</code>和<strong class="kx iv">等待几分钟</strong>，然后您可以使用<a class="ae lr" href="https://www.conduktor.io/" rel="noopener ugc nofollow" target="_blank"> Conduktor </a>连接到Kafka集群。如果您想在将来向这个集群添加一个新的Kafka代理，您可以使用以前的docker run命令。</p><h1 id="fa76" class="ls lt iu bd lu lv lw lx ly lz ma mb mc ka md kb me kd mf ke mg kg mh kh mi mj bi translated">结论</h1><p id="a163" class="pw-post-body-paragraph kv kw iu kx b ky mk jv la lb ml jy ld le mm lg lh li mn lk ll lm mo lo lp lq in bi translated">一切都准备好了，可以开始测试Kafka的概念，比如主题和分区，或者在其上开发您的应用程序，但是请注意，这些设置和配置只是为了测试和开发目的，而不是为了在生产环境中部署。</p><h1 id="9c67" class="ls lt iu bd lu lv lw lx ly lz ma mb mc ka md kb me kd mf ke mg kg mh kh mi mj bi translated"><strong class="ak"> <em class="od">资源</em> </strong></h1><ul class=""><li id="97e7" class="oe of iu kx b ky mk lb ml le og li oh lm oi lq oj ok ol om bi translated"><a class="ae lr" href="https://github.com/bitnami/bitnami-docker-kafka" rel="noopener ugc nofollow" target="_blank">比特纳米码头工人卡夫卡</a></li><li id="1936" class="oe of iu kx b ky on lb oo le op li oq lm or lq oj ok ol om bi translated"><a class="ae lr" href="https://www.confluent.io/resources/kafka-the-definitive-guide/" rel="noopener ugc nofollow" target="_blank">卡夫卡:权威指南</a></li><li id="ac24" class="oe of iu kx b ky on lb oo le op li oq lm or lq oj ok ol om bi translated"><a class="ae lr" href="https://www.conduktor.io/" rel="noopener ugc nofollow" target="_blank"> Conduktor </a></li></ul></div></div>    
</body>
</html>