<html>
<head>
<title>Inactivity Auto-Logout w/ Angular and Ngrx</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不活动自动注销，带角度和Ngrx</h1>
<blockquote>原文：<a href="https://itnext.io/inactivity-auto-logout-w-angular-and-ngrx-3bcb2fd7983f?source=collection_archive---------1-----------------------#2018-03-02">https://itnext.io/inactivity-auto-logout-w-angular-and-ngrx-3bcb2fd7983f?source=collection_archive---------1-----------------------#2018-03-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/c7d0c381e781f9544068d00ccd4a3f7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*2F7vcMkhVQSvlxWsulIfCw.png"/></div></figure><p id="4f7b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae ks" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fitnext.io%2Finactivity-auto-logout-w-angular-and-ngrx-3bcb2fd7983f" rel="noopener ugc nofollow" target="_blank"> <em class="kt">点击这里在LinkedIn </em>上分享这篇文章</a></p><p id="1601" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我构建的一个应用程序有一些非常健壮的安全需求，其中之一是客户端会话过期。这是您在登录手机银行时可能已经注意到的一个功能。您登录到您的帐户，切换到另一个选项卡，几分钟后返回到该选项卡，发现您因不活动而被注销。这有助于防止敏感信息停留在空闲用户的屏幕上，并降低恶意用户访问应用程序的可能性。</p><p id="aa3e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这个用例看起来很普通。我开始在互联网上寻找使用Angular 2+和Ngrx的解决方案。唉，我努力寻找一个干净的解决方案，并继续尝试推出自己的。事实证明，实现这一点是愚蠢的简单，我想与互联网分享。</p><p id="2034" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">此解决方案使用依赖版本:</p><ul class=""><li id="418b" class="ku kv iq jw b jx jy kb kc kf kw kj kx kn ky kr kz la lb lc bi translated">角度5.2.0</li><li id="8458" class="ku kv iq jw b jx ld kb le kf lf kj lg kn lh kr kz la lb lc bi translated">Ngrx ≥ 5.0.0</li><li id="8d15" class="ku kv iq jw b jx ld kb le kf lf kj lg kn lh kr kz la lb lc bi translated">Rxjs 5.5.6</li></ul><p id="33c9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae ks" href="https://johnbfox.github.io/angular-ngrx-autologout-demo/" rel="noopener ugc nofollow" target="_blank">演示</a></p><p id="b35f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对于那些想直接跳到代码的人，你可以查看完整的<a class="ae ks" href="https://github.com/johnbfox/angular-ngrx-autologout" rel="noopener ugc nofollow" target="_blank"> Github库</a>。本演练假设您对用于状态管理的ngrx有基本的了解。那些不熟悉ngrx和构建angular应用程序的人一定要看看这里的<a class="ae ks" href="https://github.com/ngrx/platform" rel="noopener ugc nofollow" target="_blank"/>。不管怎样……回到我们定期安排的节目。</p><h1 id="8866" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">解决办法</h1><p id="a5c1" class="pw-post-body-paragraph ju jv iq jw b jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">我们的自动注销应用程序的需求非常简单。经过一段时间的不活动后，应用程序必须将用户从应用程序中注销。</p><p id="d7e4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们关注我们的状态管理文件。</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">actions.ts</figcaption></figure><p id="bd0d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">首先，我们定义我们的应用程序动作。对于这个演示，我们有三个简单的动作:登录、注销和ExtendLogoutTimer。现在让我们看看我们的减速器。</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">减速器. ts</figcaption></figure><p id="6d2a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">reducers包含我们的应用程序动作的初始状态和处理程序。我们的状态只跟踪一个变量，<em class="kt"> isLoggedIn </em>，这个值被初始化为false。LOG_OUT reducer将<em class="kt"> isLoggedIn </em>设置为假，而LOG_IN将其设置为真。我们不显式处理ExtendLogoutTimer操作类型。相反，它在效果模块中得到隐式处理。</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">effects.ts</figcaption></figure><p id="91ba" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这就是奇迹发生的地方。这里我们有一个副作用叫做<em class="kt">extendApplicationTimeout</em>。所有事件类型都会调用此效果。它创建了一个可观察的计时器，在5000毫秒(我们预定义的“超时”时间)后发出。一旦定时器到期，我们返回一个新注销类型的动作。</p><p id="8711" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">该解决方案的另一个重要部分是使用<em class="kt">开关映射</em>。当一个动作被调用时，<em class="kt"> switchMap </em>取消任何未完成的先前效果执行，并用一个新的定时器重新创建一个可观察值。这样，我们只需在每次调用动作时延长注销计时器，并防止前一个动作计时器倒计时。</p><h1 id="f2bf" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">结论</h1><p id="191b" class="pw-post-body-paragraph ju jv iq jw b jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">就是这样！用很少的代码，你就为你的Angular应用程序增加了很大的安全性。在生产应用程序中，您会希望添加注销操作副作用，通过从本地存储中删除访问令牌、删除cookies等来实现正确的注销。否则，这就是实现客户端超时所需的全部内容。</p><p id="ad47" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你有任何问题，欢迎在评论区留言。我没有在教程中浏览基于组件的代码，但是你可以在上面的介绍中找到实现的链接。我希望这有所帮助！</p></div></div>    
</body>
</html>