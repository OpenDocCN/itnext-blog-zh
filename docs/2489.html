<html>
<head>
<title>Setup Git with Multiple Configs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用多种配置设置Git</h1>
<blockquote>原文：<a href="https://itnext.io/setup-git-with-multiple-configs-9b4111d6928c?source=collection_archive---------2-----------------------#2019-06-01">https://itnext.io/setup-git-with-multiple-configs-9b4111d6928c?source=collection_archive---------2-----------------------#2019-06-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/b66a8db70046d535d724ac267e5b1246.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*Ah6F1U1QUOAW-McY5DibhA.jpeg"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk translated">图片由<a class="ae kb" href="https://pixabay.com/users/suju-165106/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2372148" rel="noopener ugc nofollow" target="_blank"> suju </a>来自<a class="ae kb" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2372148" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></figcaption></figure><p id="c85d" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">我有几个公共回购和公司回购，我每天都在工作。我需要一种方法让git根据我的git存储库的来源使用不同的配置。</p><p id="5339" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">例如，公司存储库应该使用我的公司电子邮件和公司用户名。公共GitHub库应该使用我的个人邮箱和名字。</p><p id="e167" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">您可以通过在每个存储库中设置用户名和电子邮件来做到这一点:</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="31ad" class="lj lk it lf b gy ll lm l ln lo">git config user.name "My Name"<br/>git config user.email "my@email.com"</span></pre><p id="3570" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">但是这很容易出错。首先，我已经将我的全球用户名和电子邮件设置为我的公司用户名和电子邮件，因为我的大部分工作都是在那里完成的。第二，这要求我记住每当我克隆一个repo来覆盖全局配置时，如果我需要的话。</p><p id="fb3b" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">我最终得到的是一套工具，用于在出现问题时进行特定于上下文的配置和特定于上下文的验证。</p><h1 id="1fb0" class="lp lk it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">第一步。)将GitHub克隆移动到新文件夹</h1><p id="721a" class="pw-post-body-paragraph kc kd it ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz im bi translated">以前，我将所有回购(包括公司回购和公开回购)放在一个文件夹中:</p><ul class=""><li id="2b62" class="mr ms it ke b kf kg kj kk kn mt kr mu kv mv kz mw mx my mz bi translated">~/git</li></ul><p id="89d5" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">现在我需要两个独立的文件夹。一个用于工作，一个用于娱乐。</p><p id="5cea" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">我决定:</p><ul class=""><li id="cc03" class="mr ms it ke b kf kg kj kk kn mt kr mu kv mv kz mw mx my mz bi translated">~/git:工作存储库</li><li id="c435" class="mr ms it ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated">~/github:公共github存储库</li></ul><p id="6346" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">创建新文件夹后，我需要将所有公共回购文件移动到新的github文件夹中。</p><p id="cca8" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">我创建了一个简单的shell脚本，将所有将远程源设置为github的repos移动到我的新github文件夹中。</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="300f" class="lj lk it lf b gy ll lm l ln lo">#!/usr/bin/env bash</span><span id="0332" class="lj lk it lf b gy nf lm l ln lo">for d in */; do<br/> REMOTE=$(cd $d; git config --get remote.origin.url)<br/> if [[ $REMOTE == *"github.com"* ]]<br/> then<br/>   mv $d ~/github/.<br/> fi<br/>done</span></pre><h1 id="e888" class="lp lk it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">第二步。)设置上下文特定的Git配置</h1><p id="6b96" class="pw-post-body-paragraph kc kd it ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz im bi translated">从Git 2.13开始，全球增加了一个新特性<em class="ng">。gitconfig </em>文件语法:<a class="ae kb" href="https://git-scm.com/docs/git-config" rel="noopener ugc nofollow" target="_blank"> includeIf </a></p><p id="35af" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><strong class="ke iu"> includeIf </strong>允许您进行条件配置逻辑。到目前为止，它只支持文件路径上的条件逻辑，因此需要移动存储库。</p><p id="902b" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">我创建了两个sub git配置。每个环境一个，我把它放在各自的文件夹里。然后我设置了全局<em class="ng">。gitconfig </em>有条件地包含它们:</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="6eb4" class="lj lk it lf b gy ll lm l ln lo">[includeIf "gitdir:~/git/"]<br/>  path = ~/git/.gitconfig</span><span id="d2b0" class="lj lk it lf b gy nf lm l ln lo">[includeIf "gitdir:~/github/"]<br/>  path = ~/github/.gitconfig</span></pre><p id="1ce1" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">最后，我为每个环境设置了特定的git配置:</p><h2 id="f383" class="lj lk it bd lq nh ni dn lu nj nk dp ly kn nl nm mc kr nn no mg kv np nq mk nr bi translated">公司:</h2><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="384a" class="lj lk it lf b gy ll lm l ln lo">[user]<br/> name = userid<br/> email = corporate@email.com<br/>[core]<br/> hooksPath = ~/git/.git-hooks</span></pre><h2 id="bae5" class="lj lk it bd lq nh ni dn lu nj nk dp ly kn nl nm mc kr nn no mg kv np nq mk nr bi translated">个人Github:</h2><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="1d88" class="lj lk it lf b gy ll lm l ln lo">[user]<br/> name = My Name<br/> email = personal@email.com<br/>[core]<br/> hooksPath = ~/github/.git-hooks</span></pre><p id="441b" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">您会注意到我在每个页面中设置了用户名和电子邮件。我还为每一个设置了特定的git-hooks。我们一会儿会讲到这个。</p><p id="0247" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">您仍然可以在最初的<em class="ng"> ~/中配置许多其他真正的全局配置。gitconfig </em>如编辑器、颜色、别名等。</p><h2 id="fb37" class="lj lk it bd lq nh ni dn lu nj nk dp ly kn nl nm mc kr nn no mg kv np nq mk nr bi translated">延伸阅读:</h2><ul class=""><li id="9e55" class="mr ms it ke b kf mm kj mn kn ns kr nt kv nu kz mw mx my mz bi translated"><a class="ae kb" href="https://stackoverflow.com/questions/34597186/use-a-different-user-email-and-user-name-for-git-config-based-upon-remote-clone" rel="noopener ugc nofollow" target="_blank">堆栈溢出发布</a></li><li id="473e" class="mr ms it ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated"><a class="ae kb" href="https://git-scm.com/docs/git-config" rel="noopener ugc nofollow" target="_blank"> Git文档</a></li></ul><h1 id="d5ad" class="lp lk it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">第三步。)设置特定于环境的Git挂钩</h1><p id="69de" class="pw-post-body-paragraph kc kd it ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz im bi translated">配置的好坏取决于对它的验证。因此，我觉得有必要设置一个客户端git-hook来检查正在创建的提交是否为环境正确配置。</p><p id="36fd" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">为此，我在每个环境的git-hooks文件夹中创建了一个文件:</p><h2 id="1c13" class="lj lk it bd lq nh ni dn lu nj nk dp ly kn nl nm mc kr nn no mg kv np nq mk nr bi translated">预提交</h2><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="419c" class="lj lk it lf b gy ll lm l ln lo">#!/bin/bash<br/>#<br/># An example hook script to verify what is about to be committed.<br/># Called by "git commit" with no arguments.  The hook should<br/># exit with non-zero status after issuing an appropriate message if<br/># it wants to stop the commit.<br/>#<br/># To enable this hook, rename this file to "pre-commit".</span><span id="e10f" class="lj lk it lf b gy nf lm l ln lo">if git rev-parse --verify HEAD &gt;/dev/null 2&gt;&amp;1<br/>then<br/> against=HEAD<br/>else<br/> # Initial commit: diff against an empty tree object<br/> against=4b825dc642cb6eb9a060e54bf8d69288fbee4904<br/>fi</span><span id="1a6c" class="lj lk it lf b gy nf lm l ln lo"># Redirect output to stderr.<br/>exec 1&gt;&amp;2</span><span id="d7c6" class="lj lk it lf b gy nf lm l ln lo">REMOTE=`git config --get remote.origin.url`<br/>USERNAME=`git config --get user.name`<br/>EMAIL=`git config --get user.email`</span><span id="fb96" class="lj lk it lf b gy nf lm l ln lo">checkEmailUsername() {<br/>  if [[ "$EMAIL" != "$1" ]]<br/>  then<br/>    echo "Invalid email: $EMAIL"<br/>    echo "git config user.email $1"<br/>    exit 1<br/>  fi</span><span id="b097" class="lj lk it lf b gy nf lm l ln lo">if [[ "$USERNAME" != "$2" ]]<br/>  then<br/>    echo "Invalid username: $USERNAME"<br/>    echo "git config user.name \"$2\""<br/>    exit 1<br/>  fi<br/>}</span><span id="9ebf" class="lj lk it lf b gy nf lm l ln lo">if [[ $REMOTE == *"git.corporateRepo.com"* ]]<br/>then<br/>  checkEmailUsername myCorporate@email.com corporateUsername<br/>fi</span><span id="ae1c" class="lj lk it lf b gy nf lm l ln lo">if [[ $REMOTE == *"github.com"* ]]<br/>then<br/>  checkEmailUsername <a class="ae kb" href="mailto:englundGiant@gmail.com" rel="noopener ugc nofollow" target="_blank">m</a>yPersonal@email.com "Erik Englund"<br/>fi</span></pre><p id="b5ea" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">确保文件是可执行的。</p><p id="f0e9" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">如果用户名或电子邮件对于给定的遥控器不正确，这将导致任何提交中止。这避免了以后出现问题时令人讨厌的rebases。</p><h2 id="1690" class="lj lk it bd lq nh ni dn lu nj nk dp ly kn nl nm mc kr nn no mg kv np nq mk nr bi translated">为什么两个git-hooks脚本是一样的？</h2><p id="0beb" class="pw-post-body-paragraph kc kd it ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz im bi translated">是的，你可以侥幸逃脱。但是对我来说，我的公司已经有了几个客户端git-hooks来执行提交消息和不区分大小写的文件名。因此，我需要两个独立的git-hook文件夹。然后，我可以在公司存储库上实施公司标准，并在公共存储库中做我想做的任何事情。</p><h2 id="36a7" class="lj lk it bd lq nh ni dn lu nj nk dp ly kn nl nm mc kr nn no mg kv np nq mk nr bi translated">延伸阅读:</h2><ul class=""><li id="ccf6" class="mr ms it ke b kf mm kj mn kn ns kr nt kv nu kz mw mx my mz bi translated"><a class="ae kb" href="https://www.raphael-brugier.com/blog/git-verify-email-hook/" rel="noopener ugc nofollow" target="_blank">设置验证邮件挂钩</a></li><li id="92a7" class="mr ms it ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated"><a class="ae kb" href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks" rel="noopener ugc nofollow" target="_blank">饭桶挂钩</a></li></ul><h1 id="5347" class="lp lk it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">结论</h1><p id="f58e" class="pw-post-body-paragraph kc kd it ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz im bi translated">现在我要记住做的就是在一个地方克隆我的公司库，在另一个地方克隆我的公共GitHub库。这不是完全证明，但它是非常接近的。</p></div></div>    
</body>
</html>