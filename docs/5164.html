<html>
<head>
<title>Kubernetes on Devstack part 4: Using OpenStack Magnum to create a Kubernetes cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第4部分:使用OpenStack Magnum创建Kubernetes集群</h1>
<blockquote>原文：<a href="https://itnext.io/using-openstack-magnum-to-create-a-kubernetes-cluster-af8ec3cfbda5?source=collection_archive---------0-----------------------#2020-12-30">https://itnext.io/using-openstack-magnum-to-create-a-kubernetes-cluster-af8ec3cfbda5?source=collection_archive---------0-----------------------#2020-12-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3236" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是关于在OpenStack上运行Kubernetes的系列文章的第4部分。</p><p id="c321" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本系列第一部分的<a class="ae kl" rel="noopener ugc nofollow" target="_blank" href="/a-single-server-devstack-cloud-as-a-kubernetes-platform-cd30e28e405a#ad9b">中的local.conf文件包含以下三行来设置Magnum:</a></p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="d1cc" class="kv kw iq kr b gy kx ky l kz la">enable_plugin heat <a class="ae kl" href="https://github.com/openstack/heat" rel="noopener ugc nofollow" target="_blank">https://github.com/openstack/heat</a> stable/ussuri enable_plugin magnum <a class="ae kl" href="https://github.com/openstack/magnum" rel="noopener ugc nofollow" target="_blank">https://github.com/openstack/magnum</a> stable/ussuri <br/>enable_plugin magnum-ui <a class="ae kl" href="https://github.com/openstack/magnum-ui" rel="noopener ugc nofollow" target="_blank">https://github.com/openstack/magnum-ui</a> stable/ussuri</span></pre><p id="fb01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您按照说明进行了操作，那么您已经具备了创建Kubernetes集群所需的环境。使用非管理员Keystone用户；为此我创建了一个用户和一个项目，都命名为<em class="lb"> kube </em>，但是你也可以使用用户<em class="lb"> demo </em>，项目<em class="lb"> demo </em>，它们是由Devstack的<em class="lb"> stack.sh </em>设置的。</p><p id="b3da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可以在第2部分中手工创建的集群旁边操作Magnum集群，但是您可能没有足够的资源(主要是磁盘空间和RAM)来同时操作这两个集群。在继续之前，请考虑拆除现有群集或创建新的Devstack。</p><p id="9e5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从所谓的<em class="lb">集群模板</em>开始，它描述了大多数集群属性。Magnum使用模板概念来允许设置具有相似特征的聚类。你的大部分工作都进行到这一步。</p><p id="d497" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，您将基于集群模板创建一个集群。这是一个简单的步骤，但Magnum将花费几分钟启动复杂的热栈来设置集群的资源。</p><p id="219b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第三步是安装kubectl并获得必要的<em class="lb"> kubeconfig </em>。</p><h1 id="e45d" class="lc kw iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">第一步:集群模板</h1><p id="19f8" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">Magnum集群模板定义了集群的基本属性，包括集群服务器详细信息、网络参数、卷参数，以及最后但并非最不重要的集群管理环境(除了Kubernetes集群，Magnum还可以管理Docker Swarm和Mesos集群)。</p><p id="8540" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面的命令创建了一个名为<em class="lb"> mytemplate: </em>的模板</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="632e" class="kv kw iq kr b gy kx ky l kz la">$ source /home/stack/devstack/openrc kube kube<br/>$ openstack coe cluster template create mytemplate <br/>            --image Fedora-AtomicHost-29-20190820.0.x86_64 <br/>            --master-flavor m1.small --flavor m1.small <br/>            --external-network public --dns-nameserver 192.168.1.16          <br/>            --network-driver flannel --coe kubernetes <br/>            --volume-driver cinder --docker-volume-size 5<br/>            --master-lb-enabled --keypair kubekey</span></pre><p id="1d7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们仔细看看参数。更多信息，参见<a class="ae kl" href="https://docs.openstack.org/magnum/ussuri/user/index.html#clustertemplate" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><h2 id="5580" class="kv kw iq bd ld me mf dn lh mg mh dp ll jy mi mj lp kc mk ml lt kg mm mn lx mo bi translated">服务器参数</h2><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="cb61" class="kv kw iq kr b gy kx ky l kz la">            --image Fedora-AtomicHost-29-20190820.0.x86_64 <br/>            --master-flavor m1.small --flavor m1.small</span></pre><p id="a810" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所有集群服务器都使用stack.sh自动添加到映像目录中的Fedora-AtomicHost 映像。如果你想使用不同的图像，请注意，现成图像的选择非常有限，并且有条件创建自己的图像。参见<a class="ae kl" href="https://docs.openstack.org/magnum/ussuri/user/index.html#image-management" rel="noopener ugc nofollow" target="_blank"> Magnum的文档</a>。</p><p id="bd89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">flavor参数分别定义集群控制器(“主设备”)和节点的大小。在这个例子中使用的<em class="lb">小</em>风味是运行Kubernetes的最低限度。这也是默认的——两个风味参数可以被省略。</p><p id="501a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，控制器和节点的<em class="lb">数量</em>没有在集群模板中定义。</p><h2 id="f28b" class="kv kw iq bd ld me mf dn lh mg mh dp ll jy mi mj lp kc mk ml lt kg mm mn lx mo bi translated">网络参数</h2><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="e201" class="kv kw iq kr b gy kx ky l kz la">            --external-network public --dns-nameserver 192.168.1.16          <br/>            --network-driver flannel </span></pre><p id="131e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Magnum将集群节点连接到它们自己的OpenStack网络。该网络必须连接到外部网络才能下载Kubernetes软件。这就是为什么你必须告诉Magnum一个合适的<strong class="jp ir">外部网络</strong>的名字，这里是<em class="lb">公共</em>。</p><p id="9f16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">集群节点需要DNS来访问软件存储库。默认情况下，Magnum使用8.8.8.8作为<strong class="jp ir"> DNS服务器</strong>。</p><p id="3897" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">网络驱动程序</strong>决定用于连接pod的覆盖技术。对于Kubernetes集群，可以选择<em class="lb">法兰绒</em>或<em class="lb">印花布</em>。由于<em class="lb">法兰绒</em>是默认的，该参数可以被省略。</p><h2 id="02ef" class="kv kw iq bd ld me mf dn lh mg mh dp ll jy mi mj lp kc mk ml lt kg mm mn lx mo bi translated">存储参数</h2><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="ee23" class="kv kw iq kr b gy kx ky l kz la">             --volume-driver cinder --docker-volume-size 5</span></pre><p id="e504" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于Kubernetes来说，唯一可能的体积驱动因素是煤渣。如果不考虑此参数，基于此模板的集群没有卷。</p><p id="92d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> docker音量大小</strong>参数与音量驱动无关。它确定附加到每个群集节点并包含容器映像的Cinder卷的大小。如果忽略此参数，图像将存储在节点的临时存储中。</p><h2 id="17bc" class="kv kw iq bd ld me mf dn lh mg mh dp ll jy mi mj lp kc mk ml lt kg mm mn lx mo bi translated">其他参数</h2><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="441d" class="kv kw iq kr b gy kx ky l kz la">            --master-lb-enabled --keypair kubekey<br/>            --coe kubernetes</span></pre><p id="4ab2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果部署了多个集群控制器，Magnum会设置<strong class="jp ir">负载平衡</strong>。这个例子中的参数是多余的，因为默认情况下使用Neutron的标准负载平衡器。如果您的OpenStack集群不包括中子负载平衡器，您可以设置<code class="fe mp mq mr kr b">--master-lb-enabled=false</code>，在这种情况下，Magnum会在其中一个控制器上创建一个负载平衡器。</p><p id="c92a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">密钥对</strong>提供对集群控制器和节点的SSH访问。它必须在设置模板之前存在。如果省略此参数，则在创建集群时必须提供一个密钥对。SSH用户依赖于用于供应服务器的映像；在<em class="lb"> Fedora-AtomicHost </em>的情况下，就是<em class="lb"> fedora </em>。</p><p id="867c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> COE </strong>代表<em class="lb">容器编排引擎</em>。Magnum支持Kubernetes、Docker Swarm和Mesos。</p><p id="1a40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当依赖默认值而不使用Cinder volumes时，最短的模板创建命令可能是</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="1d7f" class="kv kw iq kr b gy kx ky l kz la">$ openstack coe cluster template create mytemplate <br/>            --image Fedora-AtomicHost-29-20190820.0.x86_64 <br/>            --external-network public --coe kubernetes </span></pre><h1 id="a5ab" class="lc kw iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">第二步:集群</h1><p id="5ee7" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">一旦定义了模板，就可以启动集群，例如</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="4685" class="kv kw iq kr b gy kx ky l kz la">$ openstack coe cluster create mycluster <br/>            --master-count 2 --node-count 2 <br/>            --cluster-template mytemplate</span></pre><p id="9604" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了集群模板的名称之外，您还需要指定集群中控制器(“主节点”)和节点的数量。</p><p id="c5ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Magnum将创建集群网络，并将其路由至集群模板中指定的外部网络。然后，它将启动请求数量的控制器和节点，并根据集群模板参数为它们提供Kubernetes软件。结果是:</p><figure class="km kn ko kp gt mt gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/7c9fc8f65468315c66ae0a554e24f7fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*kFh5yi_lb2F8j1BGJsBrXw.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">Horizon网络拓扑屏幕</figcaption></figure><p id="ca9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">执行大部分工作的是OpenStack的编排服务<em class="lb"> Heat </em>。Magnum使用热模板创建和供应资源，并启动嵌套热堆栈。集群创建完成后，花点时间查看一下创建的资源。这里，为了便于阅读，我使用了YAML输出格式:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="0f29" class="kv kw iq kr b gy kx ky l kz la">$ openstack stack list --nested -f yaml</span></pre><p id="ff57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">显示了大约16个深度嵌套的堆栈。它们的名字表明了它们的用途；其中，你会发现用于创建<em class="lb">奴才</em>(集群节点的过时名称)和<em class="lb">主人</em>(控制器)，以及设置网络和负载平衡器的堆栈。</p><p id="14f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果集群创建失败，第一个故障排除步骤应该是分析具有失败完成状态的堆栈。</p><p id="5efc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要列出热堆栈资源:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="c703" class="kv kw iq kr b gy kx ky l kz la">$ openstack stack resource list $(openstack stack list -f value -c ID) -n 5 -c resource_name -c resource_type</span></pre><p id="5f30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将打印堆栈嵌套级别为5的所有资源。准备好一长串吧。</p><h1 id="e48c" class="lc kw iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">第三步:kubectl和kubeconfig</h1><p id="1671" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">如果您仍然需要安装<em class="lb"> kubectl </em>，您可以选择从其中一个Kubernetes集群服务器复制它:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="337c" class="kv kw iq kr b gy kx ky l kz la">$ openstack server list -c Name -c Networks<br/>+--------------------------+-------------------------------------+<br/>| Name                     | Networks                            |<br/>+--------------------------+-------------------------------------+<br/>| mycluster-(...)-node-0   | mycluster=10.0.0.57, 192.168.1.221  |<br/>| mycluster-(...)-node-1   | mycluster=10.0.0.24, 192.168.1.215  |<br/>| mycluster-(...)-master-1 | mycluster=10.0.0.115, 192.168.1.239 |<br/>| mycluster-(...)-master-0 | mycluster=10.0.0.193, <strong class="kr ir">192.168.1.236</strong> |<br/>+--------------------------+-------------------------------------+<br/>$ scp -i kubekey fedora@192.168.1.239:/srv/magnum/bin/kubectl .<br/>$ chmod +x kubectl<br/>$ sudo mv kubectl /usr/local/bin</span></pre><p id="72d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者直接从网上安装<a class="ae kl" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/#install-kubectl-binary-with-curl-on-linux" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="0f1c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lb"> kubectl </em>需要一个<em class="lb"> kubeconfig </em>文件来访问集群。使用以下命令生成它:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="c397" class="kv kw iq kr b gy kx ky l kz la">$ openstack coe cluster config mycluster<br/>export KUBECONFIG=/home/stack/config</span></pre><p id="4aea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lb"> kubeconfig </em>文件是<code class="fe mp mq mr kr b">/</code> home/stack/config`。在运行<em class="lb"> kubectl </em>命令之前，将上面的<em class="lb"> KUBECONFIG </em>变量添加到shell环境中。您可以一步到位:` eval $(open stack Coe cluster config my cluster)`。</p><p id="2800" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查这是否有效:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="bf22" class="kv kw iq kr b gy kx ky l kz la">$ kubectl get nodes<br/>NAME                              STATUS   ROLES    AGE   VERSION<br/>mycluster-bxwcg7fupg6y-master-0   Ready    master   17h   v1.15.7<br/>mycluster-bxwcg7fupg6y-master-1   Ready    master   17h   v1.15.7<br/>mycluster-bxwcg7fupg6y-node-0     Ready    &lt;none&gt;   16h   v1.15.7<br/>mycluster-bxwcg7fupg6y-node-1     Ready    &lt;none&gt;   16h   v1.15.7</span></pre><p id="6fb4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请看一下配置文件:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="75ab" class="kv kw iq kr b gy kx ky l kz la">apiVersion: v1<br/>clusters:<br/>- cluster:<br/>    certificate-authority-data: (...)<br/>    <strong class="kr ir">server: </strong><a class="ae kl" href="https://192.168.1.212:6443" rel="noopener ugc nofollow" target="_blank"><strong class="kr ir">https://192.168.1.212:6443</strong></a><br/>  name: mycluster<br/>contexts:<br/>- context:<br/>    cluster: mycluster<br/>    <strong class="kr ir">user: admin</strong><br/>  name: default<br/>current-context: default<br/>kind: Config<br/>preferences: {}<br/>users:<br/><strong class="kr ir">- name: admin</strong><br/>  user:<br/>    client-certificate-data: (...) <br/>    client-key-data: (...)</span></pre><p id="31ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本例中，唯一配置的用户是<em class="lb">管理员</em>。<a class="ae kl" href="https://192.168.1.212:6443" rel="noopener ugc nofollow" target="_blank"> 192.168.1.212 </a>是访问集群的IP地址。事实上，它是面向两个控制器的负载平衡器的地址。探索这个。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="0ae0" class="kv kw iq kr b gy kx ky l kz la">$ openstack floating ip show 192.168.1.212 -c port_details --fit-width<br/>+--------------+--------------------------------------------------+<br/>| Field        | Value                                            |<br/>+--------------+--------------------------------------------------+<br/>| port_details | admin_state_up='False', device_id='lb-<strong class="kr ir">f3173216-6 </strong>|<br/>|              | <strong class="kr ir">70c-4ab9-a409-870faefbe79b'</strong>,                     |<br/>|              | device_owner='Octavia',                          |<br/>|              | mac_address='fa:16:3e:2e:e7:97', name='octavia-  |<br/>|              | lb-f3173216-670c-4ab9-a409-870faefbe79b', networ |<br/>|              | k_id='b5f78071-4687-4b6d-afda-94af9b087c2b',     |<br/>|              | status='DOWN'                                    |<br/>+--------------+--------------------------------------------------+</span></pre><p id="a9df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">浮动IP属于一个端口，其详细信息显示它属于一个奥克塔维亚负载平衡器。<em class="lb"> device_id </em>包含负载平衡器的UUID。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="2b14" class="kv kw iq kr b gy kx ky l kz la">$ openstack loadbalancer show f3173216-670c-4ab9-a409-870faefbe79b --fit-width<br/>+---------------------+-------------------------------------------+<br/>| Field               | Value                                     |<br/>+---------------------+-------------------------------------------+<br/>| admin_state_up      | True                                      |<br/>| availability_zone   | None                                      |<br/>| created_at          | 2020-12-29T10:21:28                       |<br/>| description         |                                           |<br/>| flavor_id           | None                                      |<br/>| id                  | f3173216-670c-4ab9-a409-870faefbe79b      |<br/>| listeners           | 1369821a-3135-4530-a9a9-500800b2968a      |<br/>| name                | mycluster-                                |<br/>|                     | bxwcg7fupg6y-api_lb-6rnh26aei5az-         |<br/>|                     | loadbalancer-rdpliqadtpqk                 |<br/>| operating_status    | OFFLINE                                   |<br/>| pools               | ee0ec855-894a-4c1b-b649-5c5484f00554      |<br/>| project_id          | 7a099eff1fb1479b89fa721da3e1a018          |<br/>| provider            | amphora                                   |<br/>| provisioning_status | ACTIVE                                    |<br/>| updated_at          | 2020-12-29T10:22:52                       |<br/>| vip_address         | 10.0.0.189                                |<br/>| vip_network_id      | b5f78071-4687-4b6d-afda-94af9b087c2b      |<br/>| vip_port_id         | 41645143-e588-4c33-b24b-899e3af16fb7      |<br/>| vip_qos_policy_id   | None                                      |<br/>| vip_subnet_id       | 6ff8f4a6-d8c0-4ac3-bbc2-7a749b589e53      |<br/>+---------------------+-------------------------------------------+</span></pre><p id="3967" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">确认此负载平衡器面向控制器。您需要列出池，然后列出池成员，然后将池成员的地址与您的服务器进行比较:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="395b" class="kv kw iq kr b gy kx ky l kz la">$ openstack loadbalancer pool list --loadbalancer f3173216-670c-4ab9-a409-870faefbe79b -f yaml<br/>- admin_state_up: true<br/>  <strong class="kr ir">id: ee0ec855-894a-4c1b-b649-5c5484f00554</strong><br/>  lb_algorithm: ROUND_ROBIN<br/>  name: mycluster-bxwcg7fupg6y-api_lb-6rnh26aei5az-pool-it3fiw7obbhi<br/>  project_id: 7a099eff1fb1479b89fa721da3e1a018<br/>  protocol: TCP<br/>  provisioning_status: ACTIVE</span><span id="7178" class="kv kw iq kr b gy na ky l kz la">$ openstack loadbalancer member list ee0ec855-894a-4c1b-b649-5c5484f00554 -c address<br/>+------------+<br/>| address    |<br/>+------------+<br/>| 10.0.0.193 |<br/>| 10.0.0.115 |<br/>+------------+<br/>$ openstack server list -c Name -c Networks<br/>+--------------------------+-------------------------------------+<br/>| Name                     | Networks                            |--------------------------+-------------------------------------+<br/>| mycluster-(...)-node-0   | mycluster=10.0.0.57, 192.168.1.221  |<br/>| mycluster-(...)-node-1   | mycluster=10.0.0.24, 192.168.1.215  |<br/>| mycluster-(...)-master-1 | mycluster=10.0.0.115, 192.168.1.239 |<br/>| mycluster-(...)-master-0 | mycluster=10.0.0.193, 192.168.1.236 |<br/>+--------------------------+-------------------------------------+</span></pre><p id="db47" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">负载平衡器池成员地址确实对应于两个主实例。</p></div></div>    
</body>
</html>