<html>
<head>
<title>Removing Dependency on Docker CLI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">删除对Docker CLI的依赖</h1>
<blockquote>原文：<a href="https://itnext.io/removing-dependency-on-docker-cli-94c96fcaa024?source=collection_archive---------3-----------------------#2021-09-21">https://itnext.io/removing-dependency-on-docker-cli-94c96fcaa024?source=collection_archive---------3-----------------------#2021-09-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b3ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">了解如何使用Lima VM和Podman作为您首选的OCI集装箱管理器，消除对Docker产品(包括Docker CLI)的所有依赖。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/0f5557b9517cac6cab7d700f5ad4422a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_OcmKklCRY-ajltdvmzrxw.png"/></div></div></figure><h1 id="785d" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">目标</h1><p id="e228" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">对于这篇文章，我们将重点放在波德曼的建设，包装和拉开放集装箱倡议(OCI)的标准图像。<br/>我们将向希望留在linux中进行开发的开发人员展示lima-vm，他们可以在linux来宾操作系统中使用Podman来构建映像，将它们托管在lima上的本地注册表中，然后在K3S上部署它们。</p><p id="86dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们使用这些文章来完成这些步骤:</p><ol class=""><li id="7301" class="ma mb iq jp b jq jr ju jv jy mc kc md kg me kk mf mg mh mi bi translated"><a class="ae mj" href="https://medium.com/@AbhijeetKasurde/running-podman-machine-on-macos-1f3fb0dbf73d" rel="noopener">https://medium . com/@ AbhijeetKasurde/running-pod man-machine-on-MAC OS-1 F3 FB 0 DBF 73d</a></li><li id="94ce" class="ma mb iq jp b jq mk ju ml jy mm kc mn kg mo kk mf mg mh mi bi translated"><a class="ae mj" href="https://marcusnoble.co.uk/2021-09-01-migrating-from-docker-to-podman" rel="noopener ugc nofollow" target="_blank">https://Marcus noble . co . uk/2021-09-01-从码头工人迁移到搬运工</a></li><li id="b018" class="ma mb iq jp b jq mk ju ml jy mm kc mn kg mo kk mf mg mh mi bi translated"><a class="ae mj" href="https://www.techrepublic.com/article/how-to-set-up-a-local-image-repository-with-podman/" rel="noopener ugc nofollow" target="_blank">https://www . techrepublic . com/article/how-to-setup-a-local-image-repository-with-pod man/</a></li><li id="5956" class="ma mb iq jp b jq mk ju ml jy mm kc mn kg mo kk mf mg mh mi bi translated"><a class="ae mj" href="https://cwienczek.com/2020/06/import-images-to-k3s-without-docker-registry/" rel="noopener ugc nofollow" target="_blank">https://cwienczek . com/2020/06/import-images-to-k3s-without-docker-registry/</a></li></ol></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="7753" class="kx ky iq bd kz la mw lc ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu bi translated">波德曼</h1><ul class=""><li id="c86a" class="ma mb iq jp b jq lv ju lw jy nb kc nc kg nd kk ne mg mh mi bi translated">Podman是一个“无后台容器引擎”,用于构建、打包和提取OCI标准映像。</li><li id="9b1b" class="ma mb iq jp b jq mk ju ml jy mm kc mn kg mo kk ne mg mh mi bi translated">Podman提供了一个Docker兼容的命令行界面</li><li id="224c" class="ma mb iq jp b jq mk ju ml jy mm kc mn kg mo kk ne mg mh mi bi translated">Podman可以在linux机器上本地使用，也可以通过多种方式远程使用，或者通过VM使用，这将在下一节中介绍</li></ul><p id="9358" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Mac电脑上运行Podman时，我们探讨了几种选择，每种选择在相互比较时都有优点和局限性:</p><ul class=""><li id="5b0b" class="ma mb iq jp b jq jr ju jv jy mc kc md kg me kk ne mg mh mi bi translated">利马虚拟机</li><li id="ad57" class="ma mb iq jp b jq mk ju ml jy mm kc mn kg mo kk ne mg mh mi bi translated">波德曼-远程</li><li id="1f08" class="ma mb iq jp b jq mk ju ml jy mm kc mn kg mo kk ne mg mh mi bi translated">波德曼机器</li></ul></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="7a6e" class="kx ky iq bd kz la mw lc ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu bi translated">利马虚拟机</h1><p id="2736" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">Lima用于在终端内部创建一个独立的Linux环境，然后可以用来运行Linux兼容软件，如Podman。<br/>这种独立的shell提供的好处是，Podman在其首选操作系统中运行，这允许在遵循Podman文档的同时实现相对无缝的流程。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="1843" class="kx ky iq bd kz la mw lc ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu bi translated">波德曼-远程</h1><p id="8f83" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">Podman-Remote是一种与Lima VM配合使用的方法，目的是尝试将工作空间转移回Mac终端。使用Podman-Remote，用户创建一个linux VM，在这种情况下，使用Lima VM进行测试，并启动一个Podman服务器实例。然后，Podman-Remote试图从本地终端ssh到linux服务器，允许在本地使用Podman命令，同时使用VM执行实际操作。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="efc4" class="kx ky iq bd kz la mw lc ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu bi translated">波德曼机器</h1><p id="1526" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">Podman Machine与Podman-Remote非常相似，它使用虚拟机来执行其操作，但是使用Podman Machine时，Podman会启动自己的虚拟机，允许所有操作在Mac终端中进行，而无需设置单独的虚拟机终端或Lima VM等附加软件。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="eaf0" class="kx ky iq bd kz la mw lc ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu bi translated">安装和设置Lima来宾虚拟机</h1><p id="88a6" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">Lima可通过brew获得。一旦安装完毕，limactl就是用来启动ubuntu VM的CLI，它允许用户通过shell进入ubuntu VM。一旦进入VM，更新包管理器apt，然后安装最新的podman。完成后，安装k3S</p><pre class="km kn ko kp gt nf ng nh ni aw nj bi"><span id="cd4c" class="nk ky iq ng b gy nl nm l nn no">$ brew install lima<br/>$ limactl start ubuntu<br/>$ limactl shell ubuntu<br/>lima $ sudo apt update<br/>lima $ sudo apt install -y podman<br/>lima $ curl -sfL <a class="ae mj" href="https://get.k3s.io" rel="noopener ugc nofollow" target="_blank">https://get.k3s.io</a> | sh -<br/>lima $ GITHUB_URL=https://github.com/kubernetes/dashboard/releases<br/>VERSION_KUBE_DASHBOARD=$(curl -w ‘%{url_effective}’ -I -L -s -S     lima ${GITHUB_URL}/latest -o /dev/null | sed -e ‘s|.*/||’)<br/>sudo k3s kubectl create -f <a class="ae mj" href="https://raw.githubusercontent.com/kubernetes/dashboard/${VERSION_KUBE_DASHBOARD}/aio/deploy/recommended.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/kubernetes/dashboard/${VERSION_KUBE_DASHBOARD}/aio/deploy/recommended.yaml</a><br/>lima $ exit</span></pre></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="7ee3" class="kx ky iq bd kz la mw lc ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu bi translated">正在本地启动Lima虚拟机</h1><p id="467a" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">要启动lima guest虚拟机的实例，请启动shell，运行list命令(稍后需要从主机连接到guest虚拟机),然后shell进入之前设置的ubuntu虚拟机。</p><pre class="km kn ko kp gt nf ng nh ni aw nj bi"><span id="a51c" class="nk ky iq ng b gy nl nm l nn no">$ limactl shell ubuntu systemctl — user start podman.socket<br/>$ limactl ls<br/>$ limactl shell ubuntu</span></pre></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="2717" class="kx ky iq bd kz la mw lc ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu bi translated">设置本地容器注册表</h1><pre class="km kn ko kp gt nf ng nh ni aw nj bi"><span id="6bc3" class="nk ky iq ng b gy nl nm l nn no">lima$ sudo vi /etc/containers/registries.conf</span></pre><p id="9e80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">registries.conf的*updated*内容如下所示，不同之处在于不安全、拦截和位置行必须取消注释，并且位置必须更新为localhost:5000</p><pre class="km kn ko kp gt nf ng nh ni aw nj bi"><span id="2d1a" class="nk ky iq ng b gy nl nm l nn no">[[registry]]<br/># # The “prefix” field is used to choose the relevant [[registry]] TOML table;<br/># # (only) the TOML table with the longest match for the input image name<br/># # (taking into account namespace/repo/tag/digest separators) is used.<br/># #<br/># # If the prefix field is missing, it defaults to be the same as the “location” field.<br/># prefix = “example.com/foo”<br/>#<br/># # If true, unencrypted HTTP as well as TLS connections with untrusted<br/># # certificates are allowed.<br/>insecure = true<br/>#<br/># # If true, pulling images with matching names is forbidden.<br/>blocked = false<br/>#<br/># # The physical location of the “prefix”-rooted namespace.<br/># #<br/># # By default, this equal to “prefix” (in which case “prefix” can be omitted<br/># # and the [[registry]] TOML table can only specify “location”).<br/># #<br/># # Example: Given<br/># # prefix = “example.com/foo”<br/># # location = “internal-registry-for-example.net/bar”<br/># # requests for the image example.com/foo/myimage:latest will actually work with the<br/># # internal-registry-for-example.net/bar/myimage:latest image.<br/>location = “localhost:5000”</span></pre><p id="b82c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在需要重新启动Podman来应用新的配置，并且应该能够使用localhost。</p><pre class="km kn ko kp gt nf ng nh ni aw nj bi"><span id="04f7" class="nk ky iq ng b gy nl nm l nn no">lima$ sudo mkdir -p /var/lib/registry<br/>lima$ sudo podman run — privileged -d — name registry -p 5000:5000 -v /var/lib/registry:/var/lib/registry — restart=always registry:2</span><span id="9bf2" class="nk ky iq ng b gy np nm l nn no">lima$ sudo systemctl restart podman<br/>lima$ podman pull docker.io/library/hello-world<br/>lima$ podman tag docker.io/library/hello-world localhost:5000/hello-world3</span><span id="6c80" class="nk ky iq ng b gy np nm l nn no">lima$ podman push localhost:5000/hello-world3<br/>Getting image source signatures<br/>Copying blob f22b99068db9 done <br/>Copying config d1165f2212 done <br/>Writing manifest to image destination<br/>Storing signatures</span><span id="9686" class="nk ky iq ng b gy np nm l nn no">lima$ podman images<br/>REPOSITORY TAG IMAGE ID CREATED SIZE<br/>docker.io/library/hello-world latest d1165f221234 6 months ago 20.4 kB<br/>localhost:5000/hello-world latest d1165f221234 6 months ago 20.4 kB<br/>localhost:5000/hello-world2 latest d1165f221234 6 months ago 20.4 kB<br/>localhost:5000/hello-world3 latest d1165f221234 6 months ago 20.4 kB</span></pre></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="e901" class="kx ky iq bd kz la mw lc ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu bi translated">远程连接到Lima虚拟机并构建映像</h1><p id="9c92" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">为了从主机VM远程调用podman，podman需要添加到podman-remote的连接。使用从客户机VM的limactl返回的信息，设置适当的SSH地址。</p><h2 id="a3a7" class="nk ky iq bd kz nq nr dn ld ns nt dp lh jy nu nv ll kc nw nx lp kg ny nz lt oa bi translated">利马外壳内部:</h2><pre class="km kn ko kp gt nf ng nh ni aw nj bi"><span id="92a1" class="nk ky iq ng b gy nl nm l nn no">$ sudo systemctl enable ssh.service<br/>$ systemctl — user enable — now podman.socket<br/>$ podman — remote info<br/>$ ssh-keygen (press enter until keys are generated for default location)<br/>$ ls /run/user/ (take note of the number that appears here)</span></pre><h2 id="cc34" class="nk ky iq bd kz nq nr dn ld ns nt dp lh jy nu nv ll kc nw nx lp kg ny nz lt oa bi translated">主机外壳内部:</h2><pre class="km kn ko kp gt nf ng nh ni aw nj bi"><span id="e999" class="nk ky iq ng b gy nl nm l nn no">$ podman-remote system connection add myuser — default ssh://127.0.0.1/run/user/{number retrieved from above}/podman/podman.sock<br/>$ lima podman — remote images (This will confirm if connection worked)<br/>$ lima podman — remote run localhost:5000/hello-world</span></pre></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="700b" class="kx ky iq bd kz la mw lc ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu bi translated">将OCI容器发布到K3S注册表</h1><p id="ff09" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">一旦建立了映像，K3S需要将映像导入到本地K3S容器注册表中。使用先前使用podman构建的容器映像，下面将创建一个tar文件，然后可以导入到K3S中。</p><h2 id="9a26" class="nk ky iq bd kz nq nr dn ld ns nt dp lh jy nu nv ll kc nw nx lp kg ny nz lt oa bi translated">本地mac计算机</h2><pre class="km kn ko kp gt nf ng nh ni aw nj bi"><span id="c5ee" class="nk ky iq ng b gy nl nm l nn no">$ lima podman — remote images<br/>REPOSITORY TAG IMAGE ID CREATED SIZE<br/>localhost/testimage3 latest d6e5f702489e 39 hours ago 167 MB<br/>localhost/testimage2 latest d6e5f702489e 39 hours ago 167 MB<br/>localhost/testimage latest d6e5f702489e 39 hours ago 167 MB<br/>localhost/my-app-buildah latest 1d486b95d2b5 39 hours ago 167 MB<br/>docker.io/library/ubuntu latest fb52e22af1b0 12 days ago 75.2 MB</span><span id="02b0" class="nk ky iq ng b gy np nm l nn no">$ lima podman — remote save &gt; testimage.tar localhost/testimage3<br/>$ ls<br/>dashboard.admin-user-role.yml dashboard.admin-user.yml nginx-deployment.yaml testimage.tar</span></pre><h2 id="be9c" class="nk ky iq bd kz nq nr dn ld ns nt dp lh jy nu nv ll kc nw nx lp kg ny nz lt oa bi translated">来宾利马虚拟机</h2><pre class="km kn ko kp gt nf ng nh ni aw nj bi"><span id="da2b" class="nk ky iq ng b gy nl nm l nn no">lima$ sudo k3s ctr images import k3s/testimage.tar <br/>unpacking localhost/testimage3:latest (sha256:145e94b8ccfa8f79fd805df090f981d510382184e29dc4da4bb5805fe8ce4bf6)…done</span></pre></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="91f8" class="kx ky iq bd kz la mw lc ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu bi translated">将应用程序部署到K3S</h1><p id="479b" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">为了简单起见，测试中使用的应用程序是一个简单的nginx图像，这使得测试更加容易。docker文件如下所示。因为来宾Lima虚拟机是只写的，所以在主机的用户目录中创建这些文件(这些文件对Lima虚拟机是只读的)。</p><h2 id="6e6b" class="nk ky iq bd kz nq nr dn ld ns nt dp lh jy nu nv ll kc nw nx lp kg ny nz lt oa bi translated">Dockerfile文件</h2><pre class="km kn ko kp gt nf ng nh ni aw nj bi"><span id="efb8" class="nk ky iq ng b gy nl nm l nn no">FROM ubuntu:latest <br/>#<br/># Update the image to the latest packages<br/>RUN apt-get update &amp;&amp; apt-get upgrade -y <br/>#<br/># Install NGINX to test.<br/>RUN apt-get install nginx -y<br/> # Expose port 80<br/>EXPOSE 80<br/> <br/>#<br/># Last is the actual command to start up NGINX within our Container<br/>CMD [“nginx”, “-g”, “daemon off;”]</span></pre><h2 id="8d07" class="nk ky iq bd kz nq nr dn ld ns nt dp lh jy nu nv ll kc nw nx lp kg ny nz lt oa bi translated">部署</h2><pre class="km kn ko kp gt nf ng nh ni aw nj bi"><span id="1030" class="nk ky iq ng b gy nl nm l nn no">$ cat nginx-deployment.yaml <br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/> name: test-app<br/> labels:<br/> name: test-app<br/>spec:<br/> replicas: 1<br/> selector:<br/> matchLabels:<br/> name: test-app<br/> template:<br/> metadata:<br/> labels:<br/> name: test-app<br/> spec:<br/> containers:<br/> — name: test-app<br/> image: localhost/testimage3<br/> imagePullPolicy: Never<br/> ports:<br/> — name: http<br/> containerPort: 80<br/> protocol: TCP</span></pre></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="ecdc" class="kx ky iq bd kz la mw lc ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu bi translated">使用K3S附带的kubcetl CLI部署nginx</h1><p id="0f92" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">在这一步，K3S准备好利用本地主机推送版本的测试应用程序来部署应用程序。K3S包括一个kubectl客户端作为安装的一部分，这简化了事情。</p><pre class="km kn ko kp gt nf ng nh ni aw nj bi"><span id="72f2" class="nk ky iq ng b gy nl nm l nn no">lima$ sudo k3s kubectl apply -f k3s/nginx-deployment.yaml<br/>deployment.apps/test-app created</span><span id="e059" class="nk ky iq ng b gy np nm l nn no">lima$ sudo k3s kubectl describe deployments test-app<br/>Name: test-app<br/>Namespace: default<br/>CreationTimestamp: Sun, 12 Sep 2021 10:52:09 +0000<br/>Labels: name=test-app<br/>Annotations: deployment.kubernetes.io/revision: 1<br/>Selector: name=test-app<br/>Replicas: 1 desired | 1 updated | 1 total | 1 available | 0 unavailable<br/>StrategyType: RollingUpdate<br/>MinReadySeconds: 0<br/>RollingUpdateStrategy: 25% max unavailable, 25% max surge<br/>Pod Template:<br/> Labels: name=test-app<br/> Containers:<br/> test-app:<br/> Image: localhost/testimage3<br/> Port: 80/TCP<br/> Host Port: 0/TCP<br/> Environment: &lt;none&gt;<br/> Mounts: &lt;none&gt;<br/> Volumes: &lt;none&gt;<br/>Conditions:<br/> Type Status Reason<br/> — — — — — — — — <br/> Available True MinimumReplicasAvailable<br/> Progressing True NewReplicaSetAvailable<br/>OldReplicaSets: &lt;none&gt;<br/>NewReplicaSet: test-app-7d67cfd55b (1/1 replicas created)<br/>Events:<br/> Type Reason Age From Message<br/> — — — — — — — — — — — — -<br/> Normal ScalingReplicaSet 5s deployment-controller Scaled up replica set test-app-7d67cfd55b to 1</span><span id="18f6" class="nk ky iq ng b gy np nm l nn no">lima$ sudo k3s kubectl get pods<br/>NAME READY STATUS RESTARTS AGE<br/>test-app-7d67cfd55b-jz6k6 1/1 Running 0 28s</span></pre><p id="0516" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦部署成功，我们就可以通过节点端口公开部署</p><pre class="km kn ko kp gt nf ng nh ni aw nj bi"><span id="7d83" class="nk ky iq ng b gy nl nm l nn no">$sudo kubectl expose deployment test-app — type=NodePort — name=test-app2<br/>service/test-app2 exposed</span></pre><p id="8ac5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要验证服务现在是否公开，请再次调用get services CLI命令并获取NodePort，然后通过localhost进行访问。</p><pre class="km kn ko kp gt nf ng nh ni aw nj bi"><span id="9d8d" class="nk ky iq ng b gy nl nm l nn no">lima$ sudo kubectl get services<br/>NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE<br/>kubernetes ClusterIP 10.43.0.1 &lt;none&gt; 443/TCP 16h<br/>test-app LoadBalancer 10.43.192.220 &lt;pending&gt; 80:30509/TCP 153m<br/>example-service NodePort 10.43.201.53 &lt;none&gt; 8080:31689/TCP 4m23s<br/>test-app2 NodePort 10.43.48.32 &lt;none&gt; 80:30441/TCP 72s<br/> <br/>lima$ curl <a class="ae mj" href="http://localhost:30441" rel="noopener ugc nofollow" target="_blank">http://localhost:30441</a><br/>&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>&lt;head&gt;<br/>&lt;title&gt;Welcome to nginx!&lt;/title&gt;<br/>&lt;style&gt;<br/> body {<br/> width: 35em;<br/> margin: 0 auto;<br/> font-family: Tahoma, Verdana, Arial, sans-serif;<br/> }<br/>&lt;/style&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><span id="6ad7" class="nk ky iq ng b gy np nm l nn no">&lt;p&gt;If you see this page, the nginx web server is successfully installed and<br/>working. Further configuration is required.&lt;/p&gt;</span><span id="cf5a" class="nk ky iq ng b gy np nm l nn no">&lt;p&gt;For online documentation and support please refer to<br/>&lt;a href=”<a class="ae mj" href="http://nginx.org/" rel="noopener ugc nofollow" target="_blank">http://nginx.org/</a>"&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;<br/>Commercial support is available at<br/>&lt;a href=”<a class="ae mj" href="http://nginx.com/" rel="noopener ugc nofollow" target="_blank">http://nginx.com/</a>"&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><span id="fae0" class="nk ky iq ng b gy np nm l nn no">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ob"><img src="../Images/641e85b808bdc7f0bc448c1fa19cc7ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e6d6GCT5dHRCPcKDpXar1A.png"/></div></div></figure></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="0646" class="kx ky iq bd kz la mw lc ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu bi translated">使用kubectl从外部访问集群</h1><ol class=""><li id="213f" class="ma mb iq jp b jq lv ju lw jy nb kc nc kg nd kk mf mg mh mi bi translated">将/etc/rancher/k3s/k3s.yaml复制到位于集群外部的计算机上，作为~/。kube/配置。</li><li id="02b1" class="ma mb iq jp b jq mk ju ml jy mm kc mn kg mo kk mf mg mh mi bi translated">如果尝试从主机虚拟机访问K3S群集，则不需要此步骤。然后用K3s服务器的IP或名称替换“localhost”。</li><li id="13a4" class="ma mb iq jp b jq mk ju ml jy mm kc mn kg mo kk mf mg mh mi bi translated">kubectl现在可以管理您的K3s集群了。</li></ol></div></div>    
</body>
</html>