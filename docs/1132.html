<html>
<head>
<title>Do-it-yourself: Client-side State Management — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自己动手:客户端状态管理—第1部分</h1>
<blockquote>原文：<a href="https://itnext.io/do-it-yourself-client-side-state-management-part-1-31396d28177f?source=collection_archive---------5-----------------------#2018-07-26">https://itnext.io/do-it-yourself-client-side-state-management-part-1-31396d28177f?source=collection_archive---------5-----------------------#2018-07-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e3a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi kl translated">lux和Redux都有维护一个<strong class="jp ir">应用程序状态</strong>的概念，它们都使用<strong class="jp ir">动作</strong>来改变那个状态。它们需要UI和状态之间的紧密耦合。关于状态管理有不同的方法和模式，这两种模式为许多创新提供了基础。</p><p id="1c5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我看到一篇名为“Flux from Scratch”的文章(见下面的链接)时，它激励我勇往直前，自己动手:<strong class="jp ir">抓住关键概念并实施它们！看看它们是如何工作的！让他们变得更好！这篇文章描述了我所采取的第一步。</strong></p><p id="abb5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将尝试使用简单明了的代码来实现它，不使用任何外部库(除了与UI相关的jQuery特性)。在本系列中，我将研究并实现一些概念，如<strong class="jp ir"> Flux </strong>、<strong class="jp ir"> Redux、不变性</strong>、<strong class="jp ir"> Observables </strong>、<strong class="jp ir"> Stores </strong>、<strong class="jp ir"> Actions </strong>、<strong class="jp ir">dispatcher</strong>…以及其他任何看起来相关的东西。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi ku"><img src="../Images/4c2037f754c110c84077b48564b94f24.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*nnf5aaO6uXgxdj5_uQyQ7Q.jpeg"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">改编的“从零开始的流量”应用程序</figcaption></figure></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h1 id="a615" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">第一步目标</h1><p id="7682" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">该应用程序基于“从零开始的变化”文章中的示例，我想做一些更改…所以让我们…</p><ul class=""><li id="599b" class="mq mr iq jp b jq jr ju jv jy ms kc mt kg mu kk mv mw mx my bi translated">创建类似RxJS的<strong class="jp ir">可观察</strong>和<strong class="jp ir">行为主体</strong></li><li id="476f" class="mq mr iq jp b jq mz ju na jy nb kc nc kg nd kk mv mw mx my bi translated">订阅状态更改而不是特定的操作</li><li id="224b" class="mq mr iq jp b jq mz ju na jy nb kc nc kg nd kk mv mw mx my bi translated">维护状态更改的历史记录，并添加撤消状态更改的选项</li></ul><h1 id="2139" class="ln lo iq bd lp lq ne ls lt lu nf lw lx ly ng ma mb mc nh me mf mg ni mi mj mk bi translated">密码</h1><p id="ff10" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">我们将从<em class="nj">可观察的</em>类开始。该类将维护存储中的订户列表，并在值发生更改时处理通知过程。</p><p id="a7df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过调用<em class="nj">来改变数值。next() </em>方法并提供一个新值。<br/>订阅由<em class="nj">添加。subscribe() </em>方法—它们只是接受值的回调函数。</p><p id="bd3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当你简化它的时候，你会得到一个非常简单的类:</p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="3960" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你会注意到<em class="nj"> MyObservable不接受初始值，也不在任何地方保存这个值。它只是一个发送通知的管道。</em></p><p id="153b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一方面，有一个<em class="nj">行为主体</em>。该类允许您设置值和订阅更改，但它也保留当前值，并公开<em class="nj">。getValue() </em>方法。</p><p id="0bd4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是我的实现:</p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h1 id="dfe7" class="ln lo iq bd lp lq ne ls lt lu nf lw lx ly ng ma mb mc nh me mf mg ni mi mj mk bi translated">可观察与行为主体</h1><p id="f8c4" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">请注意，这些类型之间存在一些关键差异，这些差异将决定哪种类型与我们的需求相关:</p><ul class=""><li id="315e" class="mq mr iq jp b jq jr ju jv jy ms kc mt kg mu kk mv mw mx my bi translated"><em class="nj">行为主体</em>必须有一个初始值，在第一次调用<em class="nj"> next() </em>之前<em class="nj">可观察</em>可能保持未定义。</li><li id="56e8" class="mq mr iq jp b jq mz ju na jy nb kc nc kg nd kk mv mw mx my bi translated">当订阅一个<em class="nj">行为主体</em>时，它将返回最后一个值，而<em class="nj">可观察对象</em>则不会。</li><li id="7b38" class="mq mr iq jp b jq mz ju na jy nb kc nc kg nd kk mv mw mx my bi translated">您可以使用从一个<em class="nj">行为主体</em>创建一个<em class="nj">可观察对象</em>。<em class="nj"> asObservable </em>()获取只读可观察值。</li></ul></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h1 id="26af" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">捐款</h1><p id="fd42" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">我们现在可以<strong class="jp ir">订阅</strong>来存储更改。订阅可以有一个引用，然后当不再需要时可以删除它们。所以我们现在有两个新方法:<em class="nj"> subscribe() </em>和<em class="nj"> unsubscribe()。</em></p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="f595" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用示例:</p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="nk nl l"/></div></figure></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h1 id="916d" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">历史</h1><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/599f98aa4e3001fba5415004b9aa9f9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/1*nBacxL86BVH8SJFKAVuSMw.gif"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">添加撤消按钮</figcaption></figure><p id="8bc2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当更新状态对象时，我们可以维护更改的历史，并添加对<em class="nj"> undo() </em>方法的支持，该方法反过来执行<em class="nj"> MyBehaviorSubject </em>中的<em class="nj"> unto() </em>方法。</p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="nk nl l"/></div></figure></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h1 id="72af" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">额外收获:多家商店</h1><p id="42ec" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">现在我们有了不同的可以自我处理的对象，我们已经通过生成多个dispatchers和多个store为使用可以独立运行的多个store铺平了道路。</p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="nk nl l"/></div></figure><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi nn"><img src="../Images/ad1bfbbe026b2827bde5d67fdcc9c33a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*VYSEqFXYLSE7hqxwJbOdEg.gif"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">用多个调度员经营多个商店</figcaption></figure></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h1 id="927b" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">结论</h1><p id="fd66" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">通过使用Observables，我们能够将经典模式改变为反应模式——一种对状态变化而不是特定动作做出反应的模式。想象一下，当您扩展应用程序并增加越来越多的复杂性时，订阅所有操作或每个组件只订阅10–15个操作。</p><p id="81a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦存储可以“处理自己”并维护它自己的信息，我们就可以维护更改的历史，并在单个应用程序中支持多个存储(或多个“状态”)。</p><h1 id="7d23" class="ln lo iq bd lp lq ne ls lt lu nf lw lx ly ng ma mb mc nh me mf mg ni mi mj mk bi translated">下一步是什么？</h1><p id="269a" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">在下一篇文章中，我们将考虑使用<em class="nj">选择器</em>和订阅状态特定部分的选项。当然，我们将开始添加中间件来组织事情。</p></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><pre class="kv kw kx ky gt ns nt nu nv aw nw bi"><span id="49c2" class="nx lo iq nt b gy ny nz l oa ob">Reference</span><span id="ebd4" class="nx lo iq nt b gy oc nz l oa ob">"Flux from Scratch" by Ryan Funduk<br/><a class="ae od" href="https://ryanfunduk.com/articles/flux-from-scratch/" rel="noopener ugc nofollow" target="_blank">https://ryanfunduk.com/articles/flux-from-scratch/</a></span><span id="ac84" class="nx lo iq nt b gy oc nz l oa ob">Code:<br/><a class="ae od" href="https://codepen.io/rfunduk/pen/oXZzVx" rel="noopener ugc nofollow" target="_blank">https://codepen.io/rfunduk/pen/oXZzVx</a></span></pre></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><pre class="ns nt nu nv aw nw bi"><span id="0463" class="nx lo iq nt b gy oe of og oh oi nz l oa ob">GitHub repository:<br/><a class="ae od" href="https://github.com/justguy/FluxDemoRx" rel="noopener ugc nofollow" target="_blank">https://github.com/justguy/FluxDemoRx</a></span></pre></div></div>    
</body>
</html>