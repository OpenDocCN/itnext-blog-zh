<html>
<head>
<title>Build a scalable front-end with Rush monorepo and React — Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Rush monorepo和React构建可扩展的前端—第3部分</h1>
<blockquote>原文：<a href="https://itnext.io/build-a-scalable-front-end-with-rush-monorepo-and-react-part-3-b90430f15af7?source=collection_archive---------3-----------------------#2021-09-03">https://itnext.io/build-a-scalable-front-end-with-rush-monorepo-and-react-part-3-b90430f15af7?source=collection_archive---------3-----------------------#2021-09-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="e5fd" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">ESLint + Lint暂存</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/aa52b2bdc5d89dac2f8ec7d4444cfeae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AeSFhH2_cO3nMUOP.jpg"/></div></div></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="39d6" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">这是博客系列“用Rush monorepo和React构建可伸缩前端”的第3部分</p><ul class=""><li id="049f" class="mc md iq lg b lh li ll lm lp me lt mf lx mg mb mh mi mj mk bi translated"><a class="ae ml" href="https://medium.com/@alexandrubereghici/build-a-scalable-front-end-with-rush-monorepo-and-react-part-1-dd50ae38ad3e" rel="noopener">第1部分</a> : Monorepo设置，导入项目并保留git历史，<br/>添加漂亮的</li><li id="3db7" class="mc md iq lg b lh mm ll mn lp mo lt mp lx mq mb mh mi mj mk bi translated">第2部分:用Webpack和react-scripts创建构建工具包</li><li id="75ea" class="mc md iq lg b lh mm ll mn lp mo lt mp lx mq mb mh mi mj mk bi translated"><a class="ae ml" href="https://medium.com/@alexandrubereghici/build-a-scalable-front-end-with-rush-monorepo-and-react-part-3-b90430f15af7" rel="noopener">第3部分</a>:添加共享ESLint配置，并与lint-staged一起使用</li><li id="a8be" class="mc md iq lg b lh mm ll mn lp mo lt mp lx mq mb mh mi mj mk bi translated"><a class="ae ml" href="https://medium.com/@alexandrubereghici/build-a-scalable-front-end-with-rush-monorepo-and-react-part-4-d0939bfb8b8a" rel="noopener">第4部分</a>:用Github动作和Netlify设置部署工作流。</li><li id="9eb5" class="mc md iq lg b lh mm ll mn lp mo lt mp lx mq mb mh mi mj mk bi translated"><a class="ae ml" href="https://medium.com/@alexandrubereghici/build-a-scalable-front-end-with-rush-monorepo-and-react-part-5-355f5391fd27" rel="noopener">第5部分</a>:增加VSCode配置，获得更好的开发体验。</li></ul></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h2 id="2115" class="mr jo iq bd jp ms mt dn jt mu mv dp jx lp mw mx kb lt my mz kf lx na nb kj nc bi translated">TL；速度三角形定位法(dead reckoning)</h2><p id="3ece" class="pw-post-body-paragraph le lf iq lg b lh nd lj lk ll ne ln lo lp nf lr ls lt ng lv lw lx nh lz ma mb ij bi translated">如果你有兴趣只是看看代码，你可以在这里找到它:<a class="ae ml" href="https://github.com/abereghici/rush-monorepo-boilerplate" rel="noopener ugc nofollow" target="_blank">https://github.com/abereghici/rush-monorepo-boilerplate</a></p><p id="39c4" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">如果你想看看Rush在一个真实的大型项目中的应用，你可以看看由Bentley Systems开发的开源项目<a class="ae ml" href="https://github.com/imodeljs/imodeljs" rel="noopener ugc nofollow" target="_blank"> ITwin.js </a>。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="c0f3" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">ESLint是林挺打字稿和JavaScript代码的主要工具。我们将使用它和Lint Staged来实现我们在<a class="ae ml" href="https://medium.com/@alexandrubereghici/build-a-scalable-front-end-with-rush-monorepo-and-react-part-1-dd50ae38ad3e" rel="noopener">第1部分</a>中定义的目标“<em class="ni">代码质量强制规则</em>”。</p><p id="ee97" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">ESLint使用您定义的一组规则。如果您已经有了您喜欢的ESLint配置，您可以将其添加到我们的下一个设置中。我们将使用AirBnB的ESLint配置，这是JavaScript项目最常见的规则列表。截至2021年年中，它每周从NPM获得超过270万次下载。</p><h2 id="8215" class="mr jo iq bd jp ms mt dn jt mu mv dp jx lp mw mx kb lt my mz kf lx na nb kj nc bi translated">构建eslint-config包</h2><p id="6f5d" class="pw-post-body-paragraph le lf iq lg b lh nd lj lk ll ne ln lo lp nf lr ls lt ng lv lw lx nh lz ma mb ij bi translated">让我们首先在<code class="fe nj nk nl nm b">packages</code>中创建一个名为<code class="fe nj nk nl nm b">eslint-config</code>的文件夹，并创建<code class="fe nj nk nl nm b">package.json</code>文件。</p><pre class="km kn ko kp gt nn nm no np aw nq bi"><span id="138d" class="mr jo iq nm b gy nr ns l nt nu">mkdir packages/eslint-config </span><span id="6231" class="mr jo iq nm b gy nv ns l nt nu">touch packages/eslint-config/package.json</span></pre><p id="1426" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">将以下内容粘贴到<code class="fe nj nk nl nm b">packages/eslint-config/package.json</code>:</p><pre class="km kn ko kp gt nn nm no np aw nq bi"><span id="5a91" class="mr jo iq nm b gy nr ns l nt nu">{<br/>  "name": "@monorepo/eslint-config",<br/>  "version": "1.0.0",<br/>  "description": "Shared eslint rules",<br/>  "main": "index.js",<br/>  "scripts": {<br/>    "build": ""<br/>  },<br/>  "dependencies": {<br/>    "@babel/eslint-parser": "~7.14.4",<br/>    "@babel/eslint-plugin": "~7.13.16",<br/>    "@babel/preset-react": "~7.13.13",<br/>    "@typescript-eslint/eslint-plugin": "^4.26.1",<br/>    "@typescript-eslint/parser": "^4.26.1",<br/>    "babel-eslint": "~10.1.0",<br/>    "eslint-config-airbnb": "^18.2.1",<br/>    "eslint-config-prettier": "^7.1.0",<br/>    "eslint-config-react-app": "~6.0.0",<br/>    "eslint-plugin-import": "^2.23.4",<br/>    "eslint-plugin-flowtype": "^5.2.1",<br/>    "eslint-plugin-jest": "^24.1.5",<br/>    "eslint-plugin-jsx-a11y": "^6.4.1",<br/>    "eslint-plugin-prettier": "^3.3.1",<br/>    "eslint-plugin-react": "^7.24.0",<br/>    "eslint-plugin-react-hooks": "^4.2.0",<br/>    "eslint-plugin-testing-library": "^3.9.2"<br/>  },<br/>  "devDependencies": {<br/>    "read-pkg-up": "7.0.1",<br/>    "semver": "~7.3.5"<br/>  },<br/>  "peerDependencies": {<br/>    "eslint": "^7.28.0",<br/>    "typescript": "^4.3.5"<br/>  },<br/>  "peerDependenciesMeta": {<br/>    "typescript": {<br/>      "optional": true<br/>    }<br/>  }<br/>}</span></pre><p id="a5c3" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">在这里，我们添加了ESLint配置所需的所有依赖项。</p><p id="98d8" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">现在，让我们创建一个<code class="fe nj nk nl nm b">config.js</code>文件，我们将在其中定义与规则无关的ESLint配置。</p><pre class="km kn ko kp gt nn nm no np aw nq bi"><span id="74af" class="mr jo iq nm b gy nr ns l nt nu">const fs = require('fs');<br/>const path = require('path');<br/><br/>const tsConfig = fs.existsSync('tsconfig.json')<br/>  ? path.resolve('tsconfig.json')<br/>  : undefined;<br/><br/>module.exports = {<br/>  parser: '@babel/eslint-parser',<br/>  parserOptions: {<br/>    babelOptions: {<br/>      presets: ['@babel/preset-react'],<br/>    },<br/>    requireConfigFile: false,<br/>    ecmaVersion: 2021,<br/>    sourceType: 'module',<br/>    ecmaFeatures: {<br/>      jsx: true,<br/>    },<br/>  },<br/>  env: {<br/>    es6: true,<br/>    jest: true,<br/>    browser: true,<br/>  },<br/>  globals: {<br/>    globals: true,<br/>    shallow: true,<br/>    render: true,<br/>    mount: true,<br/>  },<br/>  overrides: [<br/>    {<br/>      files: ['**/*.ts?(x)'],<br/>      parser: '@typescript-eslint/parser',<br/>      parserOptions: {<br/>        ecmaVersion: 2021,<br/>        sourceType: 'module',<br/>        project: tsConfig,<br/>        ecmaFeatures: {<br/>          jsx: true,<br/>        },<br/>        warnOnUnsupportedTypeScriptVersion: true,<br/>      },<br/>    },<br/>  ],<br/>};</span></pre><p id="2bff" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们将把ESLint规则分成多个文件。在<code class="fe nj nk nl nm b">base.js</code>文件中，我们将定义适用于所有包的主要规则。在<code class="fe nj nk nl nm b">react.js</code>中将会有React特有的规则。我们可能有不使用React的包，所以我们将只使用<code class="fe nj nk nl nm b">base</code>规则。</p><p id="f03a" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">创建一个<code class="fe nj nk nl nm b">base.js</code>文件并添加:</p><pre class="km kn ko kp gt nn nm no np aw nq bi"><span id="591c" class="mr jo iq nm b gy nr ns l nt nu">module.exports = {<br/>  extends: ['airbnb', 'prettier'],<br/>  plugins: ['prettier'],<br/>  rules: {<br/>    camelcase: 'error',<br/>    semi: ['error', 'always'],<br/>    quotes: [<br/>      'error',<br/>      'single',<br/>      {<br/>        allowTemplateLiterals: true,<br/>        avoidEscape: true,<br/>      },<br/>    ],<br/>  },<br/>  overrides: [<br/>    {<br/>      files: ['**/*.ts?(x)'],<br/>      extends: [<br/>        'prettier/@typescript-eslint',<br/>        'plugin:@typescript-eslint/recommended',<br/>      ],<br/>      rules: {},<br/>    },<br/>  ],<br/>};</span></pre><p id="7c28" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">这里我们扩展了<code class="fe nj nk nl nm b">airbnb</code>和<code class="fe nj nk nl nm b">prettier</code>配置。在这里，您可以包括您想要使用的其他基本规则。</p><p id="f37d" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">在<code class="fe nj nk nl nm b">react.js</code>中添加以下内容:</p><pre class="km kn ko kp gt nn nm no np aw nq bi"><span id="47db" class="mr jo iq nm b gy nr ns l nt nu">const readPkgUp = require('read-pkg-up');<br/>const semver = require('semver');<br/><br/>let oldestSupportedReactVersion = '17.0.1';<br/><br/><em class="ni">// Get react version from package.json and used it in lint configuration</em><br/>try {<br/>  const pkg = readPkgUp.sync({ normalize: true });<br/>  const allDeps = Object.assign(<br/>    { react: '17.0.1' },<br/>    pkg.peerDependencies,<br/>    pkg.devDependencies,<br/>    pkg.dependencies<br/>  );<br/><br/>  oldestSupportedReactVersion = semver<br/>    .validRange(allDeps.react)<br/>    .replace(/[&gt;=&lt;|]/g, ' ')<br/>    .split(' ')<br/>    .filter(Boolean)<br/>    .sort(semver.compare)[0];<br/>} catch (error) {<br/>  <em class="ni">// ignore error</em><br/>}<br/><br/>module.exports = {<br/>  extends: [<br/>    'react-app',<br/>    'react-app/jest',<br/>    'prettier/react',<br/>    'plugin:testing-library/recommended',<br/>    'plugin:testing-library/react',<br/>  ],<br/>  plugins: ['react', 'react-hooks', 'testing-library', 'prettier'],<br/>  settings: {<br/>    react: {<br/>      version: oldestSupportedReactVersion,<br/>    },<br/>  },<br/>  rules: {<br/>    'react/jsx-fragments': ['error', 'element'],<br/>    'react-hooks/rules-of-hooks': 'error',<br/>  },<br/>  overrides: [<br/>    {<br/>      files: ['**/*.ts?(x)'],<br/>      rules: {<br/>        'react/jsx-filename-extension': [<br/>          1,<br/>          {<br/>            extensions: ['.js', '.jsx', '.ts', '.tsx'],<br/>          },<br/>        ],<br/>      },<br/>    },<br/>  ],<br/>};</span></pre><p id="7b80" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们必须为<code class="fe nj nk nl nm b">react-app</code>配置提供一个<code class="fe nj nk nl nm b">react</code>版本。我们将使用<code class="fe nj nk nl nm b">read-pkg-up</code>从<code class="fe nj nk nl nm b">package.json</code>获取版本，而不是硬编码。<code class="fe nj nk nl nm b">semver</code>用于帮助我们挑选合适的版本。</p><p id="9a6c" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">最后一步是定义我们配置的入口点。创建一个<code class="fe nj nk nl nm b">index.js</code>文件并添加:</p><pre class="km kn ko kp gt nn nm no np aw nq bi"><span id="b3a1" class="mr jo iq nm b gy nr ns l nt nu">module.exports = {<br/>  extends: ['./config.js', './base.js'],<br/>};</span></pre><h2 id="467e" class="mr jo iq bd jp ms mt dn jt mu mv dp jx lp mw mx kb lt my mz kf lx na nb kj nc bi translated">向react-scripts添加lint命令</h2><p id="c8a5" class="pw-post-body-paragraph le lf iq lg b lh nd lj lk ll ne ln lo lp nf lr ls lt ng lv lw lx nh lz ma mb ij bi translated">ESLint可以以多种方式使用。您可以将它安装在每个包中，或者创建一个为您运行ESLint bin的<code class="fe nj nk nl nm b">lint</code>脚本。我觉得第二种方法更合适。我们可以在一个地方控制ESLint版本，这使得升级过程更加容易。</p><p id="62b3" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">对于<code class="fe nj nk nl nm b">lint</code>脚本，我们需要一些实用函数，所以在<code class="fe nj nk nl nm b">packages/react-scripts/scripts/utils</code>中创建一个<code class="fe nj nk nl nm b">index.js</code>文件，并添加以下内容:</p><pre class="km kn ko kp gt nn nm no np aw nq bi"><span id="fb4c" class="mr jo iq nm b gy nr ns l nt nu">const fs = require('fs');<br/>const path = require('path');<br/>const which = require('which');<br/>const readPkgUp = require('read-pkg-up');<br/><br/>const { path: pkgPath } = readPkgUp.sync({<br/>  cwd: fs.realpathSync(process.cwd()),<br/>});<br/><br/>const appDirectory = path.dirname(pkgPath);<br/><br/>const fromRoot = (...p) =&gt; path.join(appDirectory, ...p);<br/><br/>function resolveBin(<br/>  modName,<br/>  { executable = modName, cwd = process.cwd() } = {}<br/>) {<br/>  let pathFromWhich;<br/>  try {<br/>    pathFromWhich = fs.realpathSync(which.sync(executable));<br/>    if (pathFromWhich &amp;&amp; pathFromWhich.includes('.CMD')) return pathFromWhich;<br/>  } catch (_error) {<br/>    <em class="ni">// ignore _error</em><br/>  }<br/>  try {<br/>    const modPkgPath = require.resolve(`${modName}/package.json`);<br/>    const modPkgDir = path.dirname(modPkgPath);<br/>    const { bin } = require(modPkgPath);<br/>    const binPath = typeof bin === 'string' ? bin : bin[executable];<br/>    const fullPathToBin = path.join(modPkgDir, binPath);<br/>    if (fullPathToBin === pathFromWhich) {<br/>      return executable;<br/>    }<br/>    return fullPathToBin.replace(cwd, '.');<br/>  } catch (error) {<br/>    if (pathFromWhich) {<br/>      return executable;<br/>    }<br/>    throw error;<br/>  }<br/>}<br/><br/>module.exports = {<br/>  resolveBin,<br/>  fromRoot,<br/>  appDirectory,<br/>};</span></pre><p id="c873" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">这里最重要的函数是<code class="fe nj nk nl nm b">resolveBin</code>，它将尝试解析给定模块的二进制代码。</p><p id="e0c4" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">在<code class="fe nj nk nl nm b">packages/react-scripts/scripts</code>中创建<code class="fe nj nk nl nm b">lint.js</code>文件，并添加以下内容:</p><pre class="km kn ko kp gt nn nm no np aw nq bi"><span id="3a12" class="mr jo iq nm b gy nr ns l nt nu">const spawn = require('react-dev-utils/crossSpawn');<br/>const yargsParser = require('yargs-parser');<br/>const { resolveBin, fromRoot, appDirectory } = require('./utils');<br/><br/>let args = process.argv.slice(2);<br/>const parsedArgs = yargsParser(args);<br/><br/>const cache = args.includes('--no-cache')<br/>  ? []<br/>  : [<br/>      '--cache',<br/>      '--cache-location',<br/>      fromRoot('node_modules/.cache/.eslintcache'),<br/>    ];<br/><br/>const files = parsedArgs._;<br/><br/>const relativeEslintNodeModules = 'node_modules/@monorepo/eslint-config';<br/>const pluginsDirectory = `${appDirectory}/${relativeEslintNodeModules}`;<br/><br/>const resolvePluginsRelativeTo = [<br/>  '--resolve-plugins-relative-to',<br/>  pluginsDirectory,<br/>];<br/><br/>const result = spawn.sync(<br/>  resolveBin('eslint'),<br/>  [<br/>    ...cache,<br/>    ...files,<br/>    ...resolvePluginsRelativeTo,<br/>    '--no-error-on-unmatched-pattern',<br/>  ],<br/>  { stdio: 'inherit' }<br/>);<br/><br/>process.exit(result.status);</span></pre><p id="8ce4" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">在<code class="fe nj nk nl nm b">packages/react-scripts/bin/react-scripts.js</code>中注册<code class="fe nj nk nl nm b">lint</code>命令:</p><pre class="km kn ko kp gt nn nm no np aw nq bi"><span id="5811" class="mr jo iq nm b gy nr ns l nt nu">. . .</span><span id="0c9d" class="mr jo iq nm b gy nv ns l nt nu"> const scriptIndex = args.findIndex(<br/>  x =&gt; x === 'build' || x === 'start' || x === 'lint' || x === 'test'<br/>);</span><span id="c993" class="mr jo iq nm b gy nv ns l nt nu">. . .<br/></span><span id="67bb" class="mr jo iq nm b gy nv ns l nt nu">if (['build', 'start', 'lint', 'test'].includes(script)) {</span><span id="5731" class="mr jo iq nm b gy nv ns l nt nu">. . .</span></pre><p id="4eba" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">现在，在<code class="fe nj nk nl nm b">packages/react-scripts/package.json</code>中添加我们的新依赖项:</p><pre class="km kn ko kp gt nn nm no np aw nq bi"><span id="2864" class="mr jo iq nm b gy nr ns l nt nu">. . .</span><span id="b571" class="mr jo iq nm b gy nv ns l nt nu">    "which": "~2.0.2",<br/>    "read-pkg-up": "7.0.1",<br/>    "yargs-parser": "~20.2.7",<br/>    "eslint": "^7.28.0"</span><span id="484c" class="mr jo iq nm b gy nv ns l nt nu">. . .</span></pre><h2 id="e9ff" class="mr jo iq bd jp ms mt dn jt mu mv dp jx lp mw mx kb lt my mz kf lx na nb kj nc bi translated">运行中的Lint脚本</h2><p id="d66a" class="pw-post-body-paragraph le lf iq lg b lh nd lj lk ll ne ln lo lp nf lr ls lt ng lv lw lx nh lz ma mb ij bi translated">我们的<code class="fe nj nk nl nm b">lint</code>脚本已经准备好了，现在让我们在<code class="fe nj nk nl nm b">react-app</code>项目中运行它。创建一个名为<code class="fe nj nk nl nm b">.eslintrc.js</code>的新文件，并添加以下内容:</p><pre class="km kn ko kp gt nn nm no np aw nq bi"><span id="b7d7" class="mr jo iq nm b gy nr ns l nt nu">module.exports = {<br/>  extends: ['@monorepo/eslint-config', '@monorepo/eslint-config/react'],<br/>};</span></pre><p id="79c1" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">在<code class="fe nj nk nl nm b">package.json</code>内添加<code class="fe nj nk nl nm b">eslint-config</code>作为依赖:</p><pre class="km kn ko kp gt nn nm no np aw nq bi"><span id="31d9" class="mr jo iq nm b gy nr ns l nt nu"><br/> "@monorepo/eslint-config": "1.0.0"<br/></span></pre><p id="62cc" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">在<code class="fe nj nk nl nm b">scripts</code>部分添加<code class="fe nj nk nl nm b">lint</code>命令:</p><pre class="km kn ko kp gt nn nm no np aw nq bi"><span id="3081" class="mr jo iq nm b gy nr ns l nt nu">"lint": "react-scripts lint src"</span></pre><p id="2232" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">由<code class="fe nj nk nl nm b">rushx lint</code>跟随运行<code class="fe nj nk nl nm b">rush update</code>。此时，您应该会看到一堆ESLint错误。作为练习，您可以尝试通过启用/禁用<code class="fe nj nk nl nm b">eslint-config</code>中的一些规则来修复它们，或者修改<code class="fe nj nk nl nm b">react-app</code>项目以使其通过林挺。</p><h2 id="894a" class="mr jo iq bd jp ms mt dn jt mu mv dp jx lp mw mx kb lt my mz kf lx na nb kj nc bi translated">向react脚本添加lint-staged命令</h2><p id="9e18" class="pw-post-body-paragraph le lf iq lg b lh nd lj lk ll ne ln lo lp nf lr ls lt ng lv lw lx nh lz ma mb ij bi translated">我们将遵循与使用<code class="fe nj nk nl nm b">lint</code>脚本相同的方法。在<code class="fe nj nk nl nm b">packages/react-scripts/scripts</code>中创建<code class="fe nj nk nl nm b">lint-staged.js</code>文件，并添加以下内容:</p><pre class="km kn ko kp gt nn nm no np aw nq bi"><span id="61a7" class="mr jo iq nm b gy nr ns l nt nu">const spawn = require('react-dev-utils/crossSpawn');<br/>const { resolveBin } = require('./utils');<br/><br/>const args = process.argv.slice(2);<br/><br/>result = spawn.sync(resolveBin('lint-staged'), [...args], {<br/>  stdio: 'inherit',<br/>});<br/><br/>process.exit(result.status);</span></pre><p id="9853" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">在<code class="fe nj nk nl nm b">package.json</code>中添加<code class="fe nj nk nl nm b">lint-staged</code>作为依赖:</p><pre class="km kn ko kp gt nn nm no np aw nq bi"><span id="d6cd" class="mr jo iq nm b gy nr ns l nt nu">...<br/> "lint-staged": "~11.0.0"<br/>...</span></pre><p id="93ec" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">打开<code class="fe nj nk nl nm b">packages/react-scripts/bin/react-scripts.js</code>并记录<code class="fe nj nk nl nm b">lint-staged</code>命令。</p><p id="a18a" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">下一步是在<code class="fe nj nk nl nm b">common/config/command-line.json</code>中注册一个<code class="fe nj nk nl nm b">lint-staged</code> rush命令，就像我们在<a class="ae ml" href="https://bereghici.dev/blog/build-a-scalable-front-end-with-rush-monorepo-and-react--repo-setup+import-projects+prettier" rel="noopener ugc nofollow" target="_blank">第1部分</a>中注册<code class="fe nj nk nl nm b">prettier</code>命令一样。</p><pre class="km kn ko kp gt nn nm no np aw nq bi"><span id="2595" class="mr jo iq nm b gy nr ns l nt nu">{<br/>  "name": "lint-staged",<br/>  "commandKind": "bulk",<br/>  "summary": "Run lint-staged on each package",<br/>  "description": "Iterates through each package in the monorepo and runs the 'lint-staged' script",<br/>  "enableParallelism": false,<br/>  "ignoreMissingScript": true,<br/>  "ignoreDependencyOrder": true,<br/>  "allowWarningsInSuccessfulBuild": true<br/>},</span></pre><p id="723d" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">现在，让我们在git <code class="fe nj nk nl nm b">pre-commit</code>钩子上运行<code class="fe nj nk nl nm b">lint-staged</code>命令。打开<code class="fe nj nk nl nm b">common/git-hooks/pre-commit</code>并将追加添加到文件末尾:</p><pre class="km kn ko kp gt nn nm no np aw nq bi"><span id="7737" class="mr jo iq nm b gy nr ns l nt nu">node common/scripts/install-run-rush.js lint-staged || exit $?</span></pre><h2 id="ea4e" class="mr jo iq bd jp ms mt dn jt mu mv dp jx lp mw mx kb lt my mz kf lx na nb kj nc bi translated">林特登台演出</h2><p id="6904" class="pw-post-body-paragraph le lf iq lg b lh nd lj lk ll ne ln lo lp nf lr ls lt ng lv lw lx nh lz ma mb ij bi translated">让我们定义我们希望<code class="fe nj nk nl nm b">lint-staged</code>为<code class="fe nj nk nl nm b">react-app</code>项目运行什么任务。打开<code class="fe nj nk nl nm b">react-app</code>中的<code class="fe nj nk nl nm b">package.json</code>，添加<code class="fe nj nk nl nm b">lint-staged</code>的配置；</p><pre class="km kn ko kp gt nn nm no np aw nq bi"><span id="638d" class="mr jo iq nm b gy nr ns l nt nu">"lint-staged": {<br/>    "src/**/*.{ts,tsx}": [<br/>      "react-scripts lint --fix --",<br/>      "react-scripts test --findRelatedTests --watchAll=false --silent"<br/>    ],<br/>  },</span></pre><p id="068c" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">同样在<code class="fe nj nk nl nm b">package.json</code>中添加新的<code class="fe nj nk nl nm b">lint-staged</code>脚本:</p><pre class="km kn ko kp gt nn nm no np aw nq bi"><span id="f2cf" class="mr jo iq nm b gy nr ns l nt nu">"lint-staged": "react-scripts lint-staged"</span></pre><p id="940c" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">现在，在每次提交时，<code class="fe nj nk nl nm b">lint-staged</code>将lint我们的文件，并将运行相关文件的测试。</p><p id="0131" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">运行<code class="fe nj nk nl nm b">rush install</code>来注册我们的命令，然后运行<code class="fe nj nk nl nm b">rush update</code>来提交我们的更改，以查看所有操作。</p><p id="e886" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">如果你在这个过程中遇到任何问题，你可以在这里看到这篇文章<a class="ae ml" href="https://github.com/abereghici/rush-monorepo-boilerplate/tree/049506a98529d4931b2a2ecb629957e0d93e8a8d" rel="noopener ugc nofollow" target="_blank">的相关代码。</a></p><p id="f71b" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">让我们转到<a class="ae ml" href="https://medium.com/@alexandrubereghici/build-a-scalable-front-end-with-rush-monorepo-and-react-part-4-d0939bfb8b8a" rel="noopener">下一部分</a>，在这里我们将看到如何使用Github Actions和Netlify来自动化我们的部署工作流。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="1e13" class="pw-post-body-paragraph le lf iq lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated"><em class="ni">原载于</em><a class="ae ml" href="https://bereghici.dev/blog/build-a-scalable-front-end-with-rush-monorepo-and-react--eslint+lint-staged" rel="noopener ugc nofollow" target="_blank"><em class="ni">https://bereghici . dev</em></a><em class="ni">。</em></p></div></div>    
</body>
</html>