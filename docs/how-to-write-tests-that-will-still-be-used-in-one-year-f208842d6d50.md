# 如何编写一年后还会用到的测试

> 原文：<https://itnext.io/how-to-write-tests-that-will-still-be-used-in-one-year-f208842d6d50?source=collection_archive---------3----------------------->

## 这个世界充斥着良好的意图和废弃的测试套件。不要增加杀戮。

![](img/8339b17cf3bd42217399a0ad2d6d4e7a.png)

[约翰·卡梅隆](https://unsplash.com/@john_cameron?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)在 [Unsplash](https://unsplash.com/s/photos/abandoned?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍照

你是否曾经在一个有单元或集成测试的项目中工作过，却被告知“是的，不要强调测试——我们知道有很多测试失败了。”在开发过程中的某个时刻，使测试与对代码库所做的更改保持同步变得太难了，在编写测试中所做的投资现在已经完全被“注销”了。

> 这种情况的主要预测因素是什么，你如何阻止这种情况在你的项目中发生？

# 测试是不可见的

不要依赖开发人员来运行测试。有时我们急于发布一个错误修正或功能，或者只是被其他优先事项分散了注意力。当然，习惯于以测试驱动的方式工作的开发人员会首先问‘我如何运行测试？’*在*之前，他们写他们的代码，因为他们渴望对他们实现的正确性的早期反馈。但是，您仍然需要让测试自动运行*。*这就是为什么你需要经常使用持续集成工具，比如 [Travis](https://tavis-ci.com) 、 [Jenkins](https://www.jenkins.io) 或 [CircleCI](https://circleci.com) 。让 CI 尽可能轻松、自动地成为您工作流程的一部分——您应该在新模块和项目中“免费”获得它。考虑将它包含在您的新模块/项目的模板或架子工中，并尝试自动化任何初始设置，以使 CI 运行测试和任何构建步骤或林挺。

# 这些测试实际上太好了

你可能想知道这怎么会是个问题。但是实际上，为一个新的用例或者已经曝光的边缘用例增加一个新的测试是足够便宜的，这是至关重要的。同样，维护一个现有的测试以保持测试与变更的需求一致需要是一个相当简单的任务。为了解决这个问题，在你深入研究之前先研究广度。以我的经验来看，拥有一套覆盖代码库的简单测试的开发人员(但这些测试实际上是可维护和可使用的)比那些不得不努力维护测试的开发人员处于更好的位置，因为测试是如此详细和高保真，以至于有许多移动的部分和问题需要考虑。我不是说不要追求高保真、真实性，甚至全面性……我只是说先追求广度，并考虑你编写的任何测试代码的持续成本。我们想要避免的情况是，维护测试的成本开始超过我们对保持测试最新的感知价值。

# 测试太糟糕了

像关心“真正的”代码一样关心测试中代码的质量。不要把他们排除在林挺之外。当您进行代码评审时，要像对待代码库的其他部分一样，花同样的精力和时间来确保测试的可维护性和可读性。使用代码覆盖工具来确保你没有留下太多的漏洞(通过确保你可以安全地重构代码，这提高了测试套件的价值)。

# 测试运行的时间太长了！

我不知道你怎么想，但是如果一个测试套件的运行时间超过 60 秒，我就会开始坐立不安。我倾向于使用某种`--watch`标志或文件系统监视器来设置测试套件，使其在每次代码更改时运行。运行需要几十分钟的测试套件肯定不会被开发人员在工作时使用——他们可能会把它们留给 CI。你越晚推迟反馈，它就越没有价值。如果测试运行时间真的很长，一些开发人员甚至会在部署之前不等待 CI 完成。运行需要几十分钟的测试最好满足以下条件:

1.  他们必须测试一个费力或高保真的过程或程序(例如，UI 测试)
2.  它们提供了相称的风险缓解水平，证明了它们的成本是合理的(在维护和对等待它们的工作流的影响方面)。

提示:有时你可以通过一些明智的存根来加速测试。这本身就是一种权衡，但值得考虑。

我希望这篇文章对你有所帮助，并且发人深省。请在评论中告诉我你的经历、反应和想法！