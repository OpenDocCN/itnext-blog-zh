<html>
<head>
<title>Testing Jakarta EE 9 Applications with Arquillian and Payara 6</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Arquillian和Payara 6测试Jakarta EE 9应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/testing-jakarta-ee-9-applications-with-arquillian-and-payara-6-52fd153d8d9?source=collection_archive---------5-----------------------#2021-07-23">https://itnext.io/testing-jakarta-ee-9-applications-with-arquillian-and-payara-6-52fd153d8d9?source=collection_archive---------5-----------------------#2021-07-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e08d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在最新稳定的Payara 5中，它加入了早期的Jakarta EE 9支持。Payara 6.2021.Alpha1默认带来了完整的Jakarta EE 9/9.1支持。随着对Payara 6问题的Arquillian支持被修复，可以在Payara服务器上测试Jakarta EE 9应用程序了。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/482708efea9c3ad4437bb106d4db389a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CEAbGIiTXGzYMRZfy4JHOA.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">照片由<a class="ae kl" href="https://unsplash.com/@ideasboom?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">蒙</a>在<a class="ae kl" href="https://unsplash.com/s/photos/china-landscape?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="b7af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Payara Arquillian项目为Payara服务器提供了几个Arquillian容器适配器。</p><ul class=""><li id="452e" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">Payara管理的容器适配器</li><li id="c935" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">Payara远程容器适配器</li><li id="c042" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">Payara嵌入式容器适配器</li><li id="4a60" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">Payara微管理容器适配器</li></ul><h1 id="a510" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">示例代码</h1><p id="80e6" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/hantsy/jakartaee9-starter-boilerplate" rel="noopener ugc nofollow" target="_blank">示例代码</a>通过我的Github共享。这4个适配器的Arquillian配置通过4个Maven配置文件提供。</p><h1 id="09fd" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">先决条件</h1><ul class=""><li id="0652" class="lc ld iq jp b jq mo ju mp jy mt kc mu kg mv kk lh li lj lk bi translated">Java 11 ( <a class="ae kl" href="https://openjdk.java.net/install/" rel="noopener ugc nofollow" target="_blank"> OpenJDK </a>或<a class="ae kl" href="https://adoptopenjdk.net/installation.html" rel="noopener ugc nofollow" target="_blank"> AdoptOpenJDK </a>)</li><li id="55a7" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">最新<a class="ae kl" href="http://maven.apache.org/download.cgi" rel="noopener ugc nofollow" target="_blank">阿帕奇Maven </a></li><li id="d615" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated"><a class="ae kl" href="https://junit.org/junit5/" rel="noopener ugc nofollow" target="_blank"> JUnit的基础知识5 </a></li><li id="49e0" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">了解<a class="ae kl" href="http://arquillian.org/guides/" rel="noopener ugc nofollow" target="_blank">剑术的基础</a></li></ul><h1 id="ab68" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">配置Payara托管容器适配器</h1><p id="51d0" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">将<code class="fe mw mx my mz b">arquillian-payara-server-managed</code>依赖项添加到您的项目中。</p><pre class="kn ko kp kq gt na mz nb nc aw nd bi"><span id="ca8c" class="ne lr iq mz b gy nf ng l nh ni">&lt;dependency&gt;<br/>    &lt;groupId&gt;fish.payara.arquillian&lt;/groupId&gt;<br/>    &lt;artifactId&gt;payara-client-ee9&lt;/artifactId&gt;<br/>    &lt;version&gt;${arquillian-payara.version}&lt;/version&gt;<br/>    &lt;scope&gt;test&lt;/scope&gt;<br/>&lt;/dependency&gt;<br/>&lt;!-- Payara Server Container adaptor --&gt;<br/>&lt;dependency&gt;<br/>    &lt;groupId&gt;fish.payara.arquillian&lt;/groupId&gt;<br/>    &lt;artifactId&gt;arquillian-payara-server-managed&lt;/artifactId&gt;<br/>    &lt;version&gt;${arquillian-payara.version}&lt;/version&gt;<br/>    &lt;scope&gt;test&lt;/scope&gt;<br/>&lt;/dependency&gt;</span></pre><p id="c7dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<em class="nj"> arquillian.xml </em>文件中创建一个容器配置。</p><pre class="kn ko kp kq gt na mz nb nc aw nd bi"><span id="3082" class="ne lr iq mz b gy nf ng l nh ni">&lt;container qualifier="payara-managed"&gt;<br/>    &lt;configuration&gt;<br/>        &lt;property name="allowConnectingToRunningServer"&gt;false&lt;/property&gt;<br/>        &lt;property name="adminHost"&gt;localhost&lt;/property&gt;<br/>        &lt;property name="adminPort"&gt;4848&lt;/property&gt;<br/>        &lt;property name="enableH2"&gt;${enableDerby:true}&lt;/property&gt;<br/>        &lt;property name="outputToConsole"&gt;true&lt;/property&gt;<br/>    &lt;/configuration&gt;<br/>&lt;/container&gt;</span></pre><p id="69b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">配置<code class="fe mw mx my mz b">maven-dependency-plugin</code>下载一份Payara发行版，并使用它来运行您的测试。这是在您的CI服务器中连续运行测试的一个很好的选择。</p><pre class="kn ko kp kq gt na mz nb nc aw nd bi"><span id="eef2" class="ne lr iq mz b gy nf ng l nh ni">&lt;plugin&gt;<br/>    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br/>    &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;<br/>    &lt;version&gt;${maven-dependency-plugin.version}&lt;/version&gt;<br/>    &lt;executions&gt;<br/>        &lt;execution&gt;<br/>            &lt;id&gt;unpack&lt;/id&gt;<br/>            &lt;phase&gt;pre-integration-test&lt;/phase&gt;<br/>            &lt;goals&gt;<br/>                &lt;goal&gt;unpack&lt;/goal&gt;<br/>            &lt;/goals&gt;<br/>            &lt;configuration&gt;<br/>                &lt;artifactItems&gt;<br/>                    &lt;artifactItem&gt;<br/>                        &lt;groupId&gt;fish.payara.distributions&lt;/groupId&gt;<br/>                        &lt;artifactId&gt;payara&lt;/artifactId&gt;<br/>                        &lt;version&gt;${payara.version}&lt;/version&gt;<br/>                        &lt;type&gt;zip&lt;/type&gt;<br/>                        &lt;overWrite&gt;false&lt;/overWrite&gt;<br/>                        &lt;outputDirectory&gt;${project.build.directory}&lt;/outputDirectory&gt;<br/>                    &lt;/artifactItem&gt;<br/>                &lt;/artifactItems&gt;<br/>            &lt;/configuration&gt;<br/>        &lt;/execution&gt;<br/>    &lt;/executions&gt;<br/>&lt;/plugin&gt;<br/>&lt;plugin&gt;<br/>    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br/>    &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;<br/>    &lt;version&gt;${maven-failsafe-plugin.version}&lt;/version&gt;<br/>    &lt;configuration&gt;<br/>        &lt;systemPropertyVariables&gt;<br/>            &lt;payara.home&gt;${project.build.directory}/payara6&lt;/payara.home&gt;<br/>            &lt;arquillian.launch&gt;payara-managed&lt;/arquillian.launch&gt;<br/>        &lt;/systemPropertyVariables&gt;<br/>    &lt;/configuration&gt;<br/>&lt;/plugin&gt;</span></pre><p id="fe4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行以下命令来运行测试。</p><pre class="kn ko kp kq gt na mz nb nc aw nd bi"><span id="73a4" class="ne lr iq mz b gy nf ng l nh ni">mvn clean verify -Parq-payara-managed</span></pre><p id="a10b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，Arquillian负责启动和停止Payara容器。</p><h1 id="48a2" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">配置Payara远程容器适配器</h1><p id="e37a" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">使用Arquillian Payara远程容器，您可以针对正在运行的Payara服务器运行测试。它运行在不同的主机上。</p><p id="3b2a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">改为添加下面的<code class="fe mw mx my mz b">arquillian-payara-server-remote</code>依赖项。</p><pre class="kn ko kp kq gt na mz nb nc aw nd bi"><span id="46bf" class="ne lr iq mz b gy nf ng l nh ni">&lt;dependency&gt;<br/>    &lt;groupId&gt;fish.payara.arquillian&lt;/groupId&gt;<br/>    &lt;artifactId&gt;payara-client-ee9&lt;/artifactId&gt;<br/>    &lt;version&gt;${arquillian-payara.version}&lt;/version&gt;<br/>    &lt;scope&gt;test&lt;/scope&gt;<br/>&lt;/dependency&gt;<br/>&lt;dependency&gt;<br/>    &lt;groupId&gt;fish.payara.arquillian&lt;/groupId&gt;<br/>    &lt;artifactId&gt;arquillian-payara-server-remote&lt;/artifactId&gt;<br/>    &lt;version&gt;${arquillian-payara.version}&lt;/version&gt;<br/>    &lt;scope&gt;test&lt;/scope&gt;<br/>&lt;/dependency&gt;</span></pre><p id="8a65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并在该远程容器的<em class="nj"> arquillian.xml </em>文件中添加一个<em class="nj">容器</em>段，如果与默认值不同，则配置<code class="fe mw mx my mz b">adminHost</code> <code class="fe mw mx my mz b">adminPort</code>、<code class="fe mw mx my mz b">adminUser</code>、<code class="fe mw mx my mz b">adminPassword</code>。</p><pre class="kn ko kp kq gt na mz nb nc aw nd bi"><span id="aff5" class="ne lr iq mz b gy nf ng l nh ni">&lt;container qualifier="payara-remote"&gt;<br/>        &lt;configuration&gt;<br/>            &lt;property name="adminHost"&gt;localhost&lt;/property&gt;<br/>            &lt;property name="adminPort"&gt;4848&lt;/property&gt;<br/>            &lt;property name="adminUser"&gt;admin&lt;/property&gt;<br/>            &lt;!-- if https is enabled via `asadmin enable-secure-admin` on a remote server --&gt;<br/>            &lt;!-- &lt;property name="adminHttps"&gt;true&lt;/property&gt;--&gt;<br/>            &lt;!-- if admin password is changed via `asadmin change-admin-password` --&gt;<br/>            &lt;!--&lt;property name="adminPassword"&gt;adminadmin&lt;/property&gt;--&gt;<br/>            &lt;!-- default is empty --&gt;<br/>            &lt;property name="adminPassword"&gt;&lt;/property&gt;<br/>        &lt;/configuration&gt;<br/>    &lt;/container&gt;</span></pre><p id="4b50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在执行测试之前，确保目标Payara服务器正在运行。</p><p id="5aac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行以下命令，对正在运行的Payara服务器运行测试。</p><pre class="kn ko kp kq gt na mz nb nc aw nd bi"><span id="526f" class="ne lr iq mz b gy nf ng l nh ni">mvn clean verfiy -Parq-payara-managed</span></pre><h1 id="1dc3" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">配置Payara嵌入式容器适配器</h1><p id="03bd" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">使用Payara嵌入式容器适配器，您可以在嵌入式Payara服务器上运行测试。</p><p id="bb23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将以下依赖项添加到项目中。</p><pre class="kn ko kp kq gt na mz nb nc aw nd bi"><span id="5771" class="ne lr iq mz b gy nf ng l nh ni">&lt;dependency&gt;<br/>     &lt;groupId&gt;fish.payara.extras&lt;/groupId&gt;<br/>     &lt;artifactId&gt;payara-embedded-all&lt;/artifactId&gt;<br/>     &lt;version&gt;${payara.version}&lt;/version&gt;<br/>     &lt;scope&gt;test&lt;/scope&gt;<br/>&lt;/dependency&gt;<br/>&lt;dependency&gt;<br/>    &lt;groupId&gt;fish.payara.arquillian&lt;/groupId&gt;<br/>    &lt;artifactId&gt;arquillian-payara-server-embedded&lt;/artifactId&gt;<br/>    &lt;version&gt;${arquillian-payara.version}&lt;/version&gt;<br/>    &lt;scope&gt;test&lt;/scope&gt;<br/>&lt;/dependency&gt;</span></pre><p id="95c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后运行以下命令来运行测试。</p><pre class="kn ko kp kq gt na mz nb nc aw nd bi"><span id="989b" class="ne lr iq mz b gy nf ng l nh ni">mvn clean verfiy -Parq-payara-embdded</span></pre><h1 id="74e9" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">配置Payara微管理容器适配器</h1><p id="1280" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">使用Payara Micro managed container适配器，您可以在Payara Micro fat JAR上运行测试。</p><p id="0e9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将以下依赖项添加到项目中。</p><pre class="kn ko kp kq gt na mz nb nc aw nd bi"><span id="ebdb" class="ne lr iq mz b gy nf ng l nh ni">&lt;dependency&gt;<br/>      &lt;groupId&gt;fish.payara.arquillian&lt;/groupId&gt;<br/>      &lt;artifactId&gt;payara-client-ee9&lt;/artifactId&gt;<br/>      &lt;version&gt;${arquillian-payara.version}&lt;/version&gt;<br/>      &lt;scope&gt;test&lt;/scope&gt;<br/>&lt;/dependency&gt;</span><span id="5508" class="ne lr iq mz b gy nk ng l nh ni">&lt;!-- Payara Micro Managed Container Adaptor --&gt;<br/>&lt;dependency&gt;<br/>    &lt;groupId&gt;fish.payara.arquillian&lt;/groupId&gt;<br/>    &lt;artifactId&gt;arquillian-payara-micro-managed&lt;/artifactId&gt;<br/>    &lt;version&gt;${arquillian-payara.version}&lt;/version&gt;<br/>    &lt;scope&gt;test&lt;/scope&gt;<br/>&lt;/dependency&gt;</span></pre><p id="f5a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过maven依赖插件下载一份Payara Micro，设置一个系统属性<code class="fe mw mx my mz b">payara.microJar</code>指向下载的Payara Micro JAR的位置。</p><pre class="kn ko kp kq gt na mz nb nc aw nd bi"><span id="d8ae" class="ne lr iq mz b gy nf ng l nh ni">&lt;plugin&gt;<br/>    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br/>    &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;<br/>    &lt;version&gt;${maven-dependency-plugin.version}&lt;/version&gt;<br/>    &lt;executions&gt;<br/>        &lt;execution&gt;<br/>            &lt;id&gt;unpack&lt;/id&gt;<br/>            &lt;phase&gt;pre-integration-test&lt;/phase&gt;<br/>            &lt;goals&gt;<br/>                &lt;goal&gt;copy&lt;/goal&gt;<br/>            &lt;/goals&gt;<br/>            &lt;configuration&gt;<br/>                &lt;artifactItems&gt;<br/>                    &lt;artifactItem&gt;<br/>                        &lt;groupId&gt;fish.payara.extras&lt;/groupId&gt;<br/>                        &lt;artifactId&gt;payara-micro&lt;/artifactId&gt;<br/>                        &lt;version&gt;${payara.version}&lt;/version&gt;<br/>                        &lt;type&gt;jar&lt;/type&gt;<br/>                        &lt;overWrite&gt;false&lt;/overWrite&gt;<br/>                        &lt;outputDirectory&gt;${project.build.directory}&lt;/outputDirectory&gt;<br/>                        &lt;destFileName&gt;payara-micro.jar&lt;/destFileName&gt;<br/>                    &lt;/artifactItem&gt;<br/>                &lt;/artifactItems&gt;<br/>            &lt;/configuration&gt;<br/>        &lt;/execution&gt;<br/>    &lt;/executions&gt;<br/>&lt;/plugin&gt;<br/>&lt;plugin&gt;<br/>    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br/>    &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;<br/>    &lt;version&gt;${maven-failsafe-plugin.version}&lt;/version&gt;<br/>    &lt;configuration&gt;<br/>        &lt;systemPropertyVariables&gt;<br/>            &lt;payara.microJar&gt;${project.build.directory}/payara-micro.jar&lt;/payara.microJar&gt;<br/>        &lt;/systemPropertyVariables&gt;<br/>    &lt;/configuration&gt;<br/>&lt;/plugin&gt;</span></pre><p id="6735" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后运行以下命令来运行测试。</p><pre class="kn ko kp kq gt na mz nb nc aw nd bi"><span id="6621" class="ne lr iq mz b gy nf ng l nh ni">mvn clean verfiy -Parq-payara-micro</span></pre><p id="7e39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从我的Github 中获取<a class="ae kl" href="https://github.com/hantsy/jakartaee9-starter-boilerplate" rel="noopener ugc nofollow" target="_blank">源代码。</a></p></div></div>    
</body>
</html>