<html>
<head>
<title>Firebase Cloud Messaging with Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Flutter的Firebase云消息传递</h1>
<blockquote>原文：<a href="https://itnext.io/firebase-cloud-messaging-with-flutter-b103435a3b2e?source=collection_archive---------1-----------------------#2022-07-28">https://itnext.io/firebase-cloud-messaging-with-flutter-b103435a3b2e?source=collection_archive---------1-----------------------#2022-07-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7083" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你好，</p><p id="e15f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我叫<a class="ae kl" href="https://www.linkedin.com/in/tugbacekirge/" rel="noopener ugc nofollow" target="_blank">图巴</a>；我在<a class="ae kl" href="https://www.linkedin.com/company/arkitek-net/" rel="noopener ugc nofollow" target="_blank"> Arkitek R &amp; D </a>担任软件开发团队负责人。在Arkitek中，我们使用诸如<a class="ae kl" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">【VueJS】</strong></a><a class="ae kl" href="https://flutter.dev/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">Flutter</strong></a><strong class="jp ir"/>和<a class="ae kl" href="https://docs.microsoft.com/en-us/dotnet/csharp/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> C# </strong> </a>等技术构建移动、桌面和网络应用。自2021年以来，我们一直在Flutter中开发我们的web/mobile项目，不用说，Flutter非常棒。两年后，我们发现了许多诀窍和一些变通方法，只要有机会，我会试着分享。</p><p id="ab2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢我的内容，可以<a class="ae kl" href="http://buymeacoffee.com/turtlepile" rel="noopener ugc nofollow" target="_blank">给我买个p </a> izza！</p><p id="760d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我将尝试解释我们的分步指南</p><h2 id="d24e" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">1-如何将FCM添加到您的Flutter移动应用程序并管理订阅。</h2><h2 id="b9dd" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">2-如何向应用程序发送消息:服务器端</h2><p id="207f" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">在我开始之前，我想提及并感谢我的小儿子，<a class="ae kl" href="https://www.linkedin.com/in/ekinberkb/" rel="noopener ugc nofollow" target="_blank"> Ekin Berk Bozkurt </a>，他为我们的flutter项目做出了惊人的工作和巨大的努力。我们爱你，伊金·❤</p><p id="deb3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还有一件事！这是我的第一个中型职位，所以原谅我，如果我犯了错误。</p><p id="50fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好，我们开始吧..:)</p><p id="d523" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的flutter项目运行在多个平台上:IOS、Android和Web。在本文中，我将简单介绍一下从<strong class="jp ir"> FCM </strong>到<strong class="jp ir"> IOS </strong>和<strong class="jp ir"> Android </strong>平台。</p><p id="21ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们将在FCM中创建和注册我们的应用程序。我会尽力不在这个过程中留下漏洞，但如果我留下了，请原谅我。</p><ol class=""><li id="8d9c" class="lk ll iq jp b jq jr ju jv jy lm kc ln kg lo kk lp lq lr ls bi translated">去https://console.firebase.google.com/创建你的项目，如果你还没有的话。</li></ol><p id="95e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.选择<strong class="jp ir"> IOS </strong> App(如果你不是在搭建IOS app，可以跳过2跳到3) <br/> <br/> <strong class="jp ir">注册一个IOS app需要遵循5个步骤:</strong> <br/> 2.1 —注册你的App。FCM要求提供一些信息(Apple ID等),您可以很容易地从<a class="ae kl" href="https://appstoreconnect.apple.com/apps" rel="noopener ugc nofollow" target="_blank"> AppStoreConnect </a> <br/> 2.2中获得这些信息——在您完成表单后，您将获得一个<strong class="jp ir">Google service-info . plist</strong>文件。下载文件- &gt;打开<strong class="jp ir"> XCode </strong> - &gt;转到Runner- &gt;将此文件添加到您的<strong class="jp ir"> Info.plist </strong>所在的同一个文件夹中。<em class="lt">(重要:需要用XCode执行这个动作，否则不起作用。不要使用VS代码或文件浏览器等..)</em></p><p id="fe9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.3 —添加Firebase SDK: <em class="lt"> **此操作发生错误，在** </em> <br/>再次打开<strong class="jp ir"> XCode </strong>后收回，参见“添加包”部分。键入<a class="ae kl" href="https://github.com/firebase/firebase-ios-sdk" rel="noopener ugc nofollow" target="_blank">https://github.com/firebase/firebase-ios-sdk</a>并回车。它会显示你可以添加的库，我只会选择分析和消息。</p><p id="1846" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.4 —从<strong class="jp ir"> XCode </strong>中打开您的<strong class="jp ir"> AppDelegate.m </strong>文件，使这些导入<br/><a class="ae kl" href="http://twitter.com/import" rel="noopener ugc nofollow" target="_blank"><em class="lt">@ import</em></a><em class="lt">FirebaseCore；<br/></em><a class="ae kl" href="http://twitter.com/import" rel="noopener ugc nofollow" target="_blank"><em class="lt">@ import</em></a><em class="lt">firebase messaging；<br/></em><a class="ae kl" href="http://twitter.com/import" rel="noopener ugc nofollow" target="_blank"><em class="lt">@导入</em></a><em class="lt">firebase analytics；</em></p><p id="e55b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lt">而这几行:<br/>(BOOL)application:(ui application *)application<br/>difinishlaunchingwithoptions:(ns dictionary *)launch options {</em></p><p id="eae5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lt">if(</em><a class="ae kl" href="http://twitter.com/available" rel="noopener ugc nofollow" target="_blank"><em class="lt">)@可用</em> </a> <em class="lt"> (iOS 10.0，*){<br/>【UNUserNotificationCenter currentNotificationCenter】。delegate =(id&lt;unusernotificationcenteredelegate&gt;)self；<br/>}<br/></em><strong class="jp ir"><em class="lt">——→&gt;&gt;&gt;【FIRApp configure】；&lt;&lt;&lt;&lt;←——<br/></em></strong><em class="lt">【GeneratedPluginRegistrant registerWithRegistry:self】；<br/> //应用启动后定制的覆盖点。<br/> return【超级应用:应用diddfinishlaunchingwithoptions:launch options】；<br/> } </em></p><p id="5b92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="http://twitter.com/end" rel="noopener ugc nofollow" target="_blank"><em class="lt">@ end</em></a><br/><br/>2.5——回到firebase控制台，选择你的IOS项目，点击“设置”图标，进入<strong class="jp ir">项目设置</strong>页面。转到“<strong class="jp ir">控制台信息</strong>”选项卡。我们需要注册我们的APNs认证密钥(Apple推送通知)，您可以通过以下步骤获得该密钥:</p><p id="390c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到-&gt;<a class="ae kl" href="https://developer.apple.com/account/resources/certificates/list" rel="noopener ugc nofollow" target="_blank">https://developer . Apple . com/account/resources/certificates/list</a><br/>2 . 5 . 1—添加新密钥<br/> 2.5.2 —随意命名您的密钥，我用了类似于<strong class="jp ir">MyAppNameAPNs</strong><br/>2 . 5 . 3—点击查看苹果推送通知服务<br/> 2.5.4 —继续- &gt;注册<br/> 2.5.5 —下载<br/> 2.5</p><p id="369b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">返回firebase控制台。点击APNs认证密钥，在步骤5上传文件，输入KeyID和你的TeamID <em class="lt">(苹果开发者账户- &gt;会员)</em></p><p id="f2b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们将FCM添加到我们的android项目中:<em class="lt">(如果您不是在开发Android项目，请跳过3，跳到第5步)</em> <br/> <br/> 3 —转到firebase控制台，添加一个Android项目。3.1-输入你的应用程序信息并继续。<br/> 3.2 —下载<strong class="jp ir">Google-service . JSON</strong><br/>3.3—打开<strong class="jp ir"> VSCode </strong>并将该文件添加到app文件夹下。<br/> 3.4 —打开<strong class="jp ir"> app/build gradle </strong>在依赖项中添加实现行并应用插件<br/> <br/> <em class="lt">依赖项{ <br/>实现平台(' com . Google . firebase:Firebase-bom:30 . 1 . 0 ')<br/>//为Google Analytics添加Firebase SDK的依赖项<br/> //使用BoM时，不要在Firebase依赖项中指定版本<br/>实现' com . Google . Firebase:Firebase-Analytics '<br/></em></p><p id="79e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.4.1 —将此行添加到依赖关系部分:</p><ul class=""><li id="5817" class="lk ll iq jp b jq jr ju jv jy lm kc ln kg lo kk lu lq lr ls bi translated"><em class="lt">class path ' com . Google . GMS:Google-Services:4 . 3 . 10 '//Google Services插件</em></li></ul><p id="12e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.4.2 —将google()添加到所有项目和构建脚本的存储库中。</p><p id="a9d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您的构建梯度应该如下所示:</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi lv"><img src="../Images/ff3369baced276a8d5a98d4509e1afb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1UTPKpNg_yInuTodPbFmQQ.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">build.gradle</figcaption></figure><p id="7cb4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4 —对于IOS -&gt;打开XCode -&gt;目标-&gt;选择您的项目-&gt;登录和功能<br/>单击+(加号)按钮并选择</p><ul class=""><li id="5a63" class="lk ll iq jp b jq jr ju jv jy lm kc ln kg lo kk lu lq lr ls bi translated">推送通知-&gt;检查</li><li id="9e7f" class="lk ll iq jp b jq ml ju mm jy mn kc mo kg mp kk lu lq lr ls bi translated">后台模式-&gt;勾选这两个:<br/> —后台抓取<br/> —远程通知</li></ul><p id="21b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lt">如果您需要更详细的解释，请阅读本文档<br/></em><a class="ae kl" href="https://firebase.flutter.dev/docs/overview" rel="noopener ugc nofollow" target="_blank"><em class="lt"/></a><em class="lt"/><br/>5—打开VS代码，进入您的终端，按顺序输入以下内容:</p><p id="2ce6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.1 —颤振发布添加<a class="ae kl" href="https://pub.dev/packages/firebase_core" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">firebase _ core</strong></a></p><p id="290f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.2 — dart pub全局激活flutterfire_cli</p><p id="1711" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.3 —导出路径="$PATH":"$HOME/。发布缓存/bin "</p><p id="3fd7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lt">如果您收到此错误- &gt;警告:Pub将可执行文件安装到$HOME/中。pub-cache/bin，它不在您的路径上。您可以通过将它添加到您的shell的配置文件中来解决这个问题。bashrc，。bash_profile等。)</em></p><p id="c680" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.4 — firebase登录</p><p id="9c66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lt">会询问凭证，您需要在firebase控制台中输入您正在使用的凭证。</em></p><p id="74b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.5 —扑火配置</p><p id="a52e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择您的项目。</p><p id="5433" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它将创建<strong class="jp ir"> firebase_options </strong>。dart文件。</p><p id="4814" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6-我们在单个dart文件中管理我们的FCM函数，因此我们可以正确地访问它。创建一个文件，命名为<strong class="jp ir"> FCMFunctions </strong>。飞镖</p><p id="8dfb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的FCMFunctions.dart类似于<a class="ae kl" href="https://gist.github.com/turtlepile/3eddc47e5a0a79ef19c4a263719b2a4a" rel="noopener ugc nofollow" target="_blank"> this </a>:</p><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="cf0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">7-打开main.dart</p><p id="d134" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">导入“包:arkitek _ app _ internal/data/FCM functions . dart”；</p><p id="6228" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并在runApp中调用您的函数</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/34ed58343fadb902ecec1e7305066b7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*tq6eB2blNwJTMIBMPsk3lg.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">主.镖</figcaption></figure><p id="de20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:在第9行，我们订阅了一个我们命名为<strong class="jp ir">“All”</strong>的频道。我们用这个向每个人发送通知。同样在登录后，我们正在调用</p><p id="0592" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lt">wait FCM functions . subscripettopics(" ACC "+response[0][' AccID ']。toString())；</em></p><p id="f8d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，每个用户默认订阅两个频道:All和自己的帐户频道。我们决定采用这种方式，因为管理基于用户的通知非常复杂且具有挑战性。</p><p id="5383" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lt"> //简而言之，如何管理用户基础通知- &gt;您需要获得一个FCM令牌，将其存储在DB中，并且如果令牌超过两个月，则归档每个令牌，因为没有方法来检查令牌是否有效。所以是的，我们不想走那条路。</em></p><p id="26f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">7—转到<strong class="jp ir"> pubspec.yaml </strong>并添加<br/>firebase _ messaging:^11.4.2<br/>firebase _ analytics:^9.1.9</p><p id="37c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lt">注意:我从依赖项中删除了firebase SDK，因为我得到了一个错误。</em></p><p id="dd67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不要忘记保存(pub get)</p><p id="213b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">免费赠品:</strong></p><p id="3870" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在项目中使用了<strong class="jp ir"> image_picker </strong>,在实现FCM的时候出现了这个错误。如果你看到这个错误，说明你的gradle已经过期，需要更新:<br/> <em class="lt">任务执行失败:app:lintVitalRelease。<br/> &gt;无法解析配置</em>'的所有工件:image _ picker _ Android:debugUnitTestRuntimeClasspath '。</p><p id="f161" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">如何修复:</strong><br/>1-&gt;pubspec . YAML-&gt;image _ picker:^0.8.5+3<br/>2-&gt;gradle-wrap pler . properties<br/>distribution URL = https \://services . gradle . org/distributions/gradle-7.4-bin . zip<br/>3-&gt;build . gradle-&gt;&gt;dependencies<br/>class path ' com . Android . tools . build:7.1</p><p id="a209" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，客户端和上面的非常相似。让我们深入到服务器端，我将尝试解释我们如何发送通知。</p><p id="8119" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在后端项目中使用C#。如果你熟悉它，这将很容易理解。</p><p id="3e65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">— — — — — <br/>服务器端<br/>——————<br/>我关注的文档:<a class="ae kl" href="https://firebase.flutter.dev/docs/messaging/server-integration" rel="noopener ugc nofollow" target="_blank">https://firebase . flutter . dev/docs/messaging/SERVER-integration</a></p><p id="aef5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1 —首先，我们需要安装<strong class="jp ir"> FirebaseAdmin </strong>，所以我们去<strong class="jp ir"> NuGet </strong>并安装这个包</p><p id="3d5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lt">安装-打包firebase admin-版本2.3.0 </em> <br/> 2 —安装FA后，打开firebase控制台- &gt;进入<strong class="jp ir">项目设置</strong> - &gt; <strong class="jp ir">云消息</strong> - &gt; <strong class="jp ir">管理服务账号</strong> - &gt;选择账号-&gt;key-&gt;add key<br/>下载JSON文件。**我们将使用此文件从google获取令牌** <br/> 3 —将此文件添加到您的解决方案中，因为我们将读取此文件以获取凭据。<em class="lt">(凭证还有其他选项，好奇的可以查一下)(重要提示:不要公开分享那个文件)</em></p><p id="3c2c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4 —我们需要一个通知类。我们的MessageMain类类似于<a class="ae kl" href="https://gist.github.com/turtlepile/79e3e894de741bfe243d559169d441be" rel="noopener ugc nofollow" target="_blank"> this </a>:</p><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">Notification.cs</figcaption></figure><p id="8cc9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5 —发送通知！</p><p id="bc38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi">5.1:</p><p id="5531" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用以下方式导入这些内容:</p><p id="e708" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用谷歌。Apis . Auth.OAuth2</strong></p><p id="b840" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用Newtonsoft。Json</strong></p><p id="17eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建一个函数</p><p id="3865" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">SendNotification(){</p><p id="f738" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi">…….</p><p id="81e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">message main<strong class="jp ir">message main</strong>= new message main()；</p><p id="9195" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Message = new Message()；</p><p id="d9e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通知Notification = new Notification()；</p><p id="6b26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Android config Android = new Android config()；</p><p id="b258" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安卓。优先级=优先级。高；//这个很重要。它允许你的通知弹出，甚至当应用程序正在运行(Android)</p><p id="feb8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">消息。安卓=安卓；</p><p id="f7d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">notification.title = "新任务:"+ dsWork。WO_WORKS[0]。描述；</p><p id="532d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">notification.body = dsWork。WO_WORKS[0]。描述细节；</p><p id="7cc9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">消息。通知=通知；</p><p id="fe91" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">message . topic = " ACC "+AA _ ACCOUNTS[0]。ID；//这个很重要。它是用户为自己的帐户订阅的频道。</strong></p><p id="c93d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">messageMain.message = message</p><p id="494c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">var access token = await<strong class="jp ir">getaccessstoken</strong>()。configurewait(false)；</p><p id="d1f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">var URL = " https://FCM . Google APIs . com/v1/projects/{ YOUR-PROJECT-NAME }/messages:send "；</p><p id="2bc6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">http client</strong>client = new http client()；</p><p id="06d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">客户。BaseAddress =新的Uri(URL)；</p><p id="1d54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">客户。DefaultRequestHeaders . accept . clear()；</p><p id="7552" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">客户。DefaultRequestHeaders . accept . add(new MediaTypeWithQualityHeaderValue(" application/JSON "))；</p><p id="25a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">客户。DefaultRequestHeaders . Authorization = new AuthenticationHeaderValue(" Bearer "，access token)；</p><p id="4c14" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">string json = <strong class="jp ir"> JsonConvert </strong>。serialize object(<strong class="jp ir">message main</strong>)；</p><p id="29da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">var content = new string content(JSON，Encoding。UTF8，" application/JSON ")；</p><p id="bf05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">var result = await客户端。PostAsync(url，内容)；</p><p id="5f70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于<strong class="jp ir">getaccessstoken-&gt;&gt;</strong></p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi mt"><img src="../Images/5daaf06dd1d145e9834b68ad0c31b532.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1S4iiDuHLWtlfyufiYBG7Q.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">GetAccessToken函数</figcaption></figure><p id="839c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了总结→我们创建了一个名为“<strong class="jp ir"> SendNotification </strong>”的方法，在我们的例子中，它获取任务细节和用户信息。我们初始化MessageMain类和其他子类，并相应地设置属性。之后，我们调用<strong class="jp ir">getaccessstoken</strong>并从google获取令牌来发送通知并通过HttpClient发布。</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/8ecb869589a930e27afb67bd8a471206.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*yavWxo7TQ5EbBzYT"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">❤</figcaption></figure><p id="c0b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是了！这就是我们如何在IOS和Android应用中实现FCM的。为了节省时间，我尽量直截了当，并提到了一些重要的轶事。</p></div></div>    
</body>
</html>