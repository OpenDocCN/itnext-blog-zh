<html>
<head>
<title>Deploy Next.js Apps using Github Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Github操作部署Next.js应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/deploy-next-js-apps-using-github-actions-6322261757bc?source=collection_archive---------0-----------------------#2020-02-07">https://itnext.io/deploy-next-js-apps-using-github-actions-6322261757bc?source=collection_archive---------0-----------------------#2020-02-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="fb2f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">推动部署。简单的方法。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/a5d5f0d1eb9856529394fc1ce057fbe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1j0fsDWsNJwdzzpjZpJ4yw.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@wocintechchat?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">克里斯蒂娜@ wocintechchat.com</a>在<a class="ae le" href="https://unsplash.com/s/photos/server?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h2 id="7fa9" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">1.先决条件—next . js | Github | PM2 | node . js | Nginx | Linux</h2><p id="5c19" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">本指南假设您在Github的私有存储库中已经有一个Next.js应用程序。这里我有使用<code class="fe md me mf mg b">npx create-next-app</code>创建的基本样板Next.js应用程序</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mh"><img src="../Images/b8ad7efec47d9ef538e6fc592ed48415.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*13ziOQo4M_8_W6bngSEfiA.png"/></div></div></figure><p id="fe4c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们假设您有一个运行Ubuntu的VPS实例。你可以从<a class="ae le" href="https://m.do.co/c/f4a5fcc71df6" rel="noopener ugc nofollow" target="_blank">数字海洋</a>得到一个。确保在您的实例中，您具有:</p><ol class=""><li id="0b38" class="mi mj it js b jt ju jx jy kb mk kf ml kj mm kn mn mo mp mq bi translated">已安装的Node.js</li><li id="ecbc" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">安装并配置Nginx作为Next.js应用程序运行端口的反向代理。我的是<code class="fe md me mf mg b">localhost:3000</code>，因为这是默认值。</li><li id="0315" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">安装了PM2来运行我们的Next.js应用程序，但是<strong class="js iu">我们将稍后再做。</strong></li></ol><p id="b66d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，<strong class="js iu">不要从Github克隆</strong>你的应用程序。</p><h2 id="b657" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">2.配置Github操作工作流</h2><p id="7512" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">在Github上导航到您的存储库，然后点击“Actions”选项卡。Github会展示一些相关的工作流程。通过单击“设置此工作流”选择Node.js工作流。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mw"><img src="../Images/63e151604670906ef1b6c9de781a2670.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZLnXtWVMkzdm0mfFO4cztQ.png"/></div></div></figure><p id="4722" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一个<code class="fe md me mf mg b">.yml</code>文件的编辑器窗口将会出现。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mx"><img src="../Images/da87d6d87352972bfd1af534b1a74422.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XQ90seCWljmAqnim-vwcTw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">之前:nodejs.yml</figcaption></figure><p id="db26" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们编辑这个文件。我想<strong class="js iu">跳过测试</strong>，并想<strong class="js iu">为我们的Next.js应用程序添加一个构建脚本</strong>。在应用程序构建完成后，我想添加一个<code class="fe md me mf mg b">pm2 reload</code>命令，这样我们的应用程序将使用新构建的版本进行更新。我还删除了<code class="fe md me mf mg b">matrix</code>中的另一个<code class="fe md me mf mg b">node-version</code>。我们还想把<code class="fe md me mf mg b">runs-on</code>改成<code class="fe md me mf mg b">self-hosted</code>。我的最终版本是这样的:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="my mz l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">之后:nodejs.yml</figcaption></figure><p id="cdb5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">保存这个文件并提交到您的存储库中。</p><h2 id="08ae" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">3.设置动作运行器</h2><p id="6703" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">转到存储库的设置选项卡，并选择“<strong class="js iu">操作</strong>”。点击<strong class="js iu">添加流道</strong></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi na"><img src="../Images/722a6fda60449abcba91067132837b58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f5eOggIsd3LJ5ls4gAc1QQ.png"/></div></div></figure><p id="b8e2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，您将看到在VPS实例上运行<strong class="js iu">所需的命令列表。</strong></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nb"><img src="../Images/d821dd3d07ed983d7ae64660735af448.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lNud5KbkAL6ICMTVKZroOg.png"/></div></div></figure><p id="f011" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在您的实例上运行所有这些命令，您可以选择所有的默认值。在最后一个命令<code class="fe md me mf mg b">./run.sh</code>中，你会在命令行中看到我们已经开始监听你的git推送。让我们通过执行<code class="fe md me mf mg b">Ctrl + C</code>来暂时<strong class="js iu">退出这个监听器</strong>。</p><h2 id="945e" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">4.开始PM2</h2><p id="cb38" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">下一步是开始你的PM2。使用Action Runner时，应用程序的目录将被放置在特定的文件夹中。注意，我们根据上面的命令创建了一个<code class="fe md me mf mg b">actions-runner</code>目录。在这个目录中，你会看到一个<code class="fe md me mf mg b">_work</code>目录。在里面，您会看到一个以您的存储库命名的目录。<code class="fe md me mf mg b">cd</code>进入其中，再<code class="fe md me mf mg b">cd</code>进入你看到的唯一目录。通常这个目录也像你的仓库一样命名。在这个目录中，您将看到您的应用程序源代码。因此，这就是我们将使用PM2启动应用程序的地方。我们使用这个简单的命令启动名为<code class="fe md me mf mg b">next-js</code>的应用程序。</p><pre class="kp kq kr ks gt nc mg nd ne aw nf bi"><span id="2ef6" class="lf lg it mg b gy ng nh l ni nj">pm2 start npm --name "next-js" -- start</span></pre><p id="a8dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们回顾一下。我们有一个使用Nginx的反向代理，为我们来自<code class="fe md me mf mg b">localhost:3000</code>的应用服务，我们已经使用PM2启动了我们的应用，并在<code class="fe md me mf mg b">localhost:3000</code>上运行。所以，这意味着我们的网站是活的。</p><h2 id="14c0" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">5.将Action Runner作为后台服务运行</h2><p id="19f5" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">现在，回到我们的<code class="fe md me mf mg b">actions-runner</code>文件夹。这里你会注意到一个<code class="fe md me mf mg b">./svc.sh</code>文件。这个文件允许我们在后台运行action runner作为服务。您需要以<code class="fe md me mf mg b">sudo</code>的身份运行这个文件。首先，让我们运行安装命令:</p><pre class="kp kq kr ks gt nc mg nd ne aw nf bi"><span id="e307" class="lf lg it mg b gy ng nh l ni nj">sudo ./svc.sh install</span></pre><p id="1c07" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后运行:</p><pre class="kp kq kr ks gt nc mg nd ne aw nf bi"><span id="cdff" class="lf lg it mg b gy ng nh l ni nj">sudo ./svc.sh start</span></pre><p id="77c7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，您的action runner正在后台监听您对git存储库的任何推送。要检查该侦听器的状态，可以使用以下命令:</p><pre class="kp kq kr ks gt nc mg nd ne aw nf bi"><span id="4ae4" class="lf lg it mg b gy ng nh l ni nj">sudo ./svc.sh status</span></pre><p id="399a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你会注意到在<strong class="js iu"> Github Repo &gt;设置&gt;动作标签</strong>中，有一个跑步者在跑:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nk"><img src="../Images/2eb27346b48263a858b78013ca8dcdae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W-8r02dPOX4_QB7v-gLDow.png"/></div></div></figure><p id="3262" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">就是这样！现在，对您的代码进行任何更改，并推送至主分支，在服务器中查看您的代码更改。没有网络挂钩，或手动部署。就是管用！✨</p><p id="8a8e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你想看关于如何设置先决条件的更详细的教程，请留下评论。🙏</p><p id="5731" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">查看我在Medium上的其他Next.js文章:</p><div class="nl nm gp gr nn no"><a href="https://medium.com/javascript-in-plain-english/next-js-where-have-you-been-all-my-life-1dedba2d2431" rel="noopener follow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd iu gy z fp nt fr fs nu fu fw is bi translated">next . js——我这辈子你都去哪了？</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">Next.js如何让我在生产中编写React。</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">medium.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc ky no"/></div></div></a></div><div class="nl nm gp gr nn no"><a rel="noopener  ugc nofollow" target="_blank" href="/one-domain-multiple-next-js-apps-5e39b0ffa1bf"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd iu gy z fp nt fr fs nu fu fw is bi translated">一个域—多个Next.js应用程序</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">关于如何使用Nginx在一个域上使用子目录服务多个Next.js应用程序的快速教程。</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">itnext.io</p></div></div><div class="nx l"><div class="od l nz oa ob nx oc ky no"/></div></div></a></div></div></div>    
</body>
</html>