<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://itnext.io/how-to-control-music-with-a-ps4-dualshock-and-javascript-54237206c104?source=collection_archive---------4-----------------------#2019-06-03">https://itnext.io/how-to-control-music-with-a-ps4-dualshock-and-javascript-54237206c104?source=collection_archive---------4-----------------------#2019-06-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/992ec9fbbf9c37a57c624595406985d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aossx7EOmZKz6JA3N85XYQ.jpeg"/></div></div></figure><p id="9823" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated"><em class="jy">(也发表在</em> <a class="ae jz" href="https://blog.segersian.com/2019/06/03/how-to-control-music-with-a-ps4-dualshock-and-javascript/" rel="noopener ugc nofollow" target="_blank"> <em class="jy">我的博客</em> </a> <em class="jy"> ) </em></p><h1 id="9331" class="ka kb jb bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">如何用PS4 DualShock和JavaScript控制音乐</h1><p id="3c60" class="pw-post-body-paragraph iz ja jb jc b jd ky jf jg jh kz jj jk jl la jn jo jp lb jr js jt lc jv jw jx ij bi translated"><em class="jy">最近我写了一篇关于</em> <a class="ae jz" rel="noopener ugc nofollow" target="_blank" href="/how-not-to-interact-with-your-web-app-with-a-ps4-controller-a3e3036a2f6e"> <em class="jy">如何(不)将你的PS4 DualShock </em> </a> <em class="jy">连接到你的网络应用的文章。在发现了Gamepad API之后，我终于可以用PS4 DualShock来控制我的音乐软件了。我使用了Web MIDI API和Web Gamepad API来实现这一点。为什么？只是因为我们可以。</em></p><p id="2c03" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated"><strong class="jc ld">如果你只想看一个工作示例，向下滚动到底部查看最终视频。</strong></p><p id="4dcc" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated"><em class="jy">如果你没有PS4 DualShock，你可以看看下面我展示工作示例的视频。如果您没有Traktor，您可以使用免费软件来监控是否发送了正确的MIDI事件，而不是使用Traktor，请进一步阅读了解更多信息。</em></p></div><div class="ab cl le lf hu lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ij ik il im in"><h1 id="38e5" class="ka kb jb bd kc kd ll kf kg kh lm kj kk kl ln kn ko kp lo kr ks kt lp kv kw kx bi translated">目标</h1><p id="caeb" class="pw-post-body-paragraph iz ja jb jc b jd ky jf jg jh kz jj jk jl la jn jo jp lb jr js jt lc jv jw jx ij bi translated">我的目标是控制我的DJ软件，作为Traktor，从浏览器控制或使用我的PS4 DualShock，但仍然使用浏览器作为主要枢纽。你可能会问，“为什么要用浏览器而不是写原生代码？”。原因是，我想发现和探索现代浏览器API。</p></div><div class="ab cl le lf hu lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ij ik il im in"><h1 id="4b03" class="ka kb jb bd kc kd ll kf kg kh lm kj kk kl ln kn ko kp lo kr ks kt lp kv kw kx bi translated">战略</h1><p id="d6be" class="pw-post-body-paragraph iz ja jb jc b jd ky jf jg jh kz jj jk jl la jn jo jp lb jr js jt lc jv jw jx ij bi translated">乐器和音乐软件(例如用于制作或DJ的软件)使用一种称为MIDI的技术，它代表“乐器数字接口”。这种通用数字接口允许乐器(如合成器)与其他乐器、控制器或软件通信。</p><p id="24f2" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">便利的是，现代浏览器(我将使用Chrome v74+)，尽管仍然是实验性的，实现了<a class="ae jz" href="https://www.w3.org/TR/webmidi/" rel="noopener ugc nofollow" target="_blank"> MIDI API </a>。也就是说，在浏览器中，我们可以充当“接收”和“发送”MIDI信息的控制器。这意味着网络应用可以与例如DJ软件通信，该DJ软件与在浏览器中运行网络应用的客户端在同一台机器上运行。</p><p id="ea4a" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">除了可以从浏览器与Traktor (DJ软件)进行通信，我们还可以使用Gamepad API与任何游戏手柄进行通信，但我将使用通过USB电缆连接的PS4 DualShock(抱歉，不支持蓝牙！).</p><p id="ac5e" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">在浏览器中运行的web应用程序将成为中心枢纽，它将读取游戏手柄上的用户操作，并将其转换为我们发送到DJ软件的MIDI通信。</p></div><div class="ab cl le lf hu lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ij ik il im in"><h1 id="f2c3" class="ka kb jb bd kc kd ll kf kg kh lm kj kk kl ln kn ko kp lo kr ks kt lp kv kw kx bi translated">关于MIDI</h1><p id="946c" class="pw-post-body-paragraph iz ja jb jc b jd ky jf jg jh kz jj jk jl la jn jo jp lb jr js jt lc jv jw jx ij bi translated">当我们想要通过MIDI进行通信时，我们需要了解协议是如何工作的。MIDI规范定义了硬件连接器，也定义了我们通过MIDI连接器发送的数据的契约。我将跳过硬件部分，因为我们不需要这些知识。</p><p id="bb1e" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">MIDI通信通过“MIDI信息”进行。Midi信息(通常)由1、2或3个字节组成。第一个字节总是“状态”字节，随后的2或3个字节称为“数据字节”。状态字节its <a class="ae jz" href="https://en.wikipedia.org/wiki/Bit_numbering#Most_significant_bit" rel="noopener ugc nofollow" target="_blank"> MSB </a>始终为“1 ”,数据字节its MSB始终为“0”。这意味着，状态字节的值将总是在128和255之间，而数据字节的值将总是在0和127之间。基于这一知识，当看到一个MIDI字节时，我们可以立即确定我们是否有一个状态或数据字节。</p><p id="b434" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">一个状态字节通常映射到一个特定的“功能”，而数据字节提供相应的数据。例如，我们得到一个状态字节，它翻译成“改变磁道”，那么随后的数据字节应该包含磁道号。你可以在<a class="ae jz" href="https://www.midi.org/specifications-old/item/table-2-expanded-messages-list-status-bytes" rel="noopener ugc nofollow" target="_blank">这里的</a>和<a class="ae jz" href="https://www.midi.org/specifications-old/item/table-3-control-change-messages-data-bytes-2" rel="noopener ugc nofollow" target="_blank">这里的</a>中找到每个状态字节的含义和相应数据字节的完整映射。</p><p id="97c2" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">不需要学习或了解所有的本质细节，但我创建了一个小的<a class="ae jz" href="http://webapistudio.com/#/midi-debugger" rel="noopener ugc nofollow" target="_blank">调试器</a>，它可以帮助你理解你可能偶然发现的任何MIDI信息。</p></div><div class="ab cl le lf hu lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ij ik il im in"><h1 id="880f" class="ka kb jb bd kc kd ll kf kg kh lm kj kk kl ln kn ko kp lo kr ks kt lp kv kw kx bi translated">范围</h1><p id="95c7" class="pw-post-body-paragraph iz ja jb jc b jd ky jf jg jh kz jj jk jl la jn jo jp lb jr js jt lc jv jw jx ij bi translated">因为我们引入了很多新的东西，比如MIDI、MIDI API、Gamepad API，所以我会把我们最终版本的范围保持得非常小。我有以下要求:</p><ul class=""><li id="f41f" class="lq lr jb jc b jd je jh ji jl ls jp lt jt lu jx lv lw lx ly bi translated">我们可以通过网络浏览器中的滑块来控制一个“甲板”的音量。</li><li id="19d5" class="lq lr jb jc b jd lz jh ma jl mb jp mc jt md jx lv lw lx ly bi translated">我们可以在网络浏览器中用一个按钮播放/暂停一个“甲板”的音乐。</li><li id="ce17" class="lq lr jb jc b jd lz jh ma jl mb jp mc jt md jx lv lw lx ly bi translated">我们可以用游戏手柄上的两个按钮来控制一副牌的音量。</li><li id="1235" class="lq lr jb jc b jd lz jh ma jl mb jp mc jt md jx lv lw lx ly bi translated">我们可以通过游戏手柄上的一个按钮来播放/暂停一副牌的音乐。</li></ul><p id="a2b1" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">在我将为此使用的DJ软件Traktor中,“deck”就像一个单通道，就像CD播放器或转盘一样，一次只能播放一首曲目。通常，你在一个音乐软件中有2个或更多的卡座，因为你可以混合多个频道/曲目。</p></div><div class="ab cl le lf hu lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ij ik il im in"><h1 id="cc4f" class="ka kb jb bd kc kd ll kf kg kh lm kj kk kl ln kn ko kp lo kr ks kt lp kv kw kx bi translated">实施</h1><p id="cb75" class="pw-post-body-paragraph iz ja jb jc b jd ky jf jg jh kz jj jk jl la jn jo jp lb jr js jt lc jv jw jx ij bi translated">我们将跳过创建一个花哨的GUI的部分，因为这将把我们从核心挑战引开，如果你想知道我是如何在VueJs中实现的，请看一下WebApiStudio.com的源代码。</p><h2 id="c20a" class="me kb jb bd kc mf mg dn kg mh mi dp kk jl mj mk ko jp ml mm ks jt mn mo kw mp bi translated">要求1:用滑块控制一个面板的音量</h2><p id="8e40" class="pw-post-body-paragraph iz ja jb jc b jd ky jf jg jh kz jj jk jl la jn jo jp lb jr js jt lc jv jw jx ij bi translated">我们从在HTML页面上创建一个简单的滑块开始。我们将最小值设置为<code class="fe mq mr ms mt b">0</code>，将最大值设置为<code class="fe mq mr ms mt b">127</code>。请记住，我们的“数据”字节的范围是0到127。因此，为了方便起见，我们希望音量滑块限制它的范围。</p><figure class="mu mv mw mx gt is"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="9635" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">我们现在正在收听滑块的<code class="fe mq mr ms mt b">input</code>事件。确保当我们从左向右滑动滑块时，我们的最小值是<code class="fe mq mr ms mt b">0</code>，最大值是<code class="fe mq mr ms mt b">127</code>。</p><p id="3963" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">现在我们想发送一个MIDI信息到一个实际的MIDI“输出”。我们用来发送MIDI信息的“输出”,我们用来接收MIDI信息的“输入”。您可以始终有多个输入和输出可用。</p><p id="8973" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated"><em class="jy">如果你没有安装</em><a class="ae jz" href="https://www.native-instruments.com/en/products/traktor/dj-software/" rel="noopener ugc nofollow" target="_blank"><em class="jy">Traktor</em></a><em class="jy">，我建议你安装一个</em><a class="ae jz" href="https://www.snoize.com/MIDIMonitor/" rel="noopener ugc nofollow" target="_blank"><em class="jy">MIDI Monitor</em></a><em class="jy">，它可以作为“假”输出来监听接收到的MIDI消息，非常适合调试使用。如果您使用MIDI监视器，请确保在启动后启用“作为其他程序的目的位置”。</em></p><p id="1fe0" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">如果您正在使用Traktor，我们需要先做一些准备工作。</p><ul class=""><li id="d8eb" class="lq lr jb jc b jd je jh ji jl ls jp lt jt lu jx lv lw lx ly bi translated">启动追踪器</li><li id="27e8" class="lq lr jb jc b jd lz jh ma jl mb jp mc jt md jx lv lw lx ly bi translated">打开<code class="fe mq mr ms mt b">settings</code> &gt; <code class="fe mq mr ms mt b">Controller Manager</code> &gt;选择<code class="fe mq mr ms mt b">Generic MIDI</code>作为装置。</li><li id="9943" class="lq lr jb jc b jd lz jh ma jl mb jp mc jt md jx lv lw lx ly bi translated">如果没有<code class="fe mq mr ms mt b">Generic MIDI</code>可用，点击<code class="fe mq mr ms mt b">add</code>按钮并选择<code class="fe mq mr ms mt b">Generic MIDI</code>。</li><li id="4af1" class="lq lr jb jc b jd lz jh ma jl mb jp mc jt md jx lv lw lx ly bi translated">为<code class="fe mq mr ms mt b">in-port</code>选择数值<code class="fe mq mr ms mt b">traktor virtual input</code></li><li id="3a30" class="lq lr jb jc b jd lz jh ma jl mb jp mc jt md jx lv lw lx ly bi translated">点击<code class="fe mq mr ms mt b">add in</code> &gt; <code class="fe mq mr ms mt b">mixer</code> &gt; <code class="fe mq mr ms mt b">volume adjust</code>。</li><li id="1e6e" class="lq lr jb jc b jd lz jh ma jl mb jp mc jt md jx lv lw lx ly bi translated">在<code class="fe mq mr ms mt b">device mapping</code>中，点击<code class="fe mq mr ms mt b">n/a</code>下拉菜单并选择<code class="fe mq mr ms mt b">ch01 — CC — 006</code>。</li><li id="a494" class="lq lr jb jc b jd lz jh ma jl mb jp mc jt md jx lv lw lx ly bi translated">在<code class="fe mq mr ms mt b">mapping details</code>中选择<code class="fe mq mr ms mt b">deck a</code>为<code class="fe mq mr ms mt b">assignment</code></li><li id="7b03" class="lq lr jb jc b jd lz jh ma jl mb jp mc jt md jx lv lw lx ly bi translated">你可以在这个<a class="ae jz" href="https://youtu.be/k0sHmLw4gzc" rel="noopener ugc nofollow" target="_blank">视频</a>里看到所有的步骤。</li></ul><p id="d0a3" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">既然Traktor已经准备好监听我们的MIDI映射，我们就可以把事情联系在一起了。</p><figure class="mu mv mw mx gt is"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="7056" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">当我们现在移动滑块时，我们将发送一个3字节的midi消息([176，6，currentSliderValue])到我们的Traktor输出(其中有一个恼人的名字“input”)。我们可以优化代码，这样我们只取一次输出，但是这些改进我现在不想关注。</p><p id="312e" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">如果我们现在运行这个页面，在适当的配置下在后台运行Traktor(或MIDI Monitor ),我们应该会得到以下结果:</p><figure class="mu mv mw mx gt is"><div class="bz fp l di"><div class="na mz l"/></div></figure><p id="5eac" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">如你所见，当我在网页中移动滑块时，我的<code class="fe mq mr ms mt b">deck a</code>的音量滑块也随之改变。遗憾的是，当我加载页面时，通过这个代码片段，我无法查询Traktor中音量滑块的“当前”状态。修复这个问题超出了我们的范围。</p><h2 id="ec03" class="me kb jb bd kc mf mg dn kg mh mi dp kk jl mj mk ko jp ml mm ks jt mn mo kw mp bi translated">要求2:添加播放/恢复按钮</h2><p id="3f08" class="pw-post-body-paragraph iz ja jb jc b jd ky jf jg jh kz jj jk jl la jn jo jp lb jr js jt lc jv jw jx ij bi translated">我们现在将添加一个简单的按钮来暂停或恢复我们在<code class="fe mq mr ms mt b">deck a</code>中加载的曲目。同样，如果您使用的是Traktor，我们需要在Traktor控制器管理器中配置一个新的MIDI映射。</p><ul class=""><li id="78ba" class="lq lr jb jc b jd je jh ji jl ls jp lt jt lu jx lv lw lx ly bi translated">打开<code class="fe mq mr ms mt b">settings</code> &gt; <code class="fe mq mr ms mt b">Controller Manager</code> &gt;选择<code class="fe mq mr ms mt b">Generic MIDI</code>作为装置。</li><li id="1072" class="lq lr jb jc b jd lz jh ma jl mb jp mc jt md jx lv lw lx ly bi translated">点击<code class="fe mq mr ms mt b">add in</code> &gt; <code class="fe mq mr ms mt b">deck common</code> &gt; <code class="fe mq mr ms mt b">play/pause</code>。</li><li id="f3f7" class="lq lr jb jc b jd lz jh ma jl mb jp mc jt md jx lv lw lx ly bi translated">在<code class="fe mq mr ms mt b">device mapping</code>中，点击<code class="fe mq mr ms mt b">n/a</code>下拉菜单并选择<code class="fe mq mr ms mt b">ch01 — CC — 007</code>。另外，将交互模式设置为<code class="fe mq mr ms mt b">toggle</code>。这样，我们基本上在<code class="fe mq mr ms mt b">play</code>和<code class="fe mq mr ms mt b">pause</code>之间切换。</li><li id="b03e" class="lq lr jb jc b jd lz jh ma jl mb jp mc jt md jx lv lw lx ly bi translated">在<code class="fe mq mr ms mt b">mapping details</code>中选择<code class="fe mq mr ms mt b">deck a</code>为<code class="fe mq mr ms mt b">assignment</code></li><li id="702b" class="lq lr jb jc b jd lz jh ma jl mb jp mc jt md jx lv lw lx ly bi translated">你可以在这个<a class="ae jz" href="https://youtu.be/_ikSrETH9tQ" rel="noopener ugc nofollow" target="_blank">视频</a>里看到所有的步骤。</li></ul><p id="73f9" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">为了避免重复，我对代码进行了一点重构，但基本上，我只是添加了一个按钮，该按钮将发送正确的MIDI消息，该消息映射到我们的播放/暂停动作。</p><figure class="mu mv mw mx gt is"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="b4bf" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">我们可以在下面的视频中看到它的作用:</p><figure class="mu mv mw mx gt is"><div class="bz fp l di"><div class="nb mz l"/></div></figure><p id="b605" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">似乎工作得很好！音量滑块仍然工作，播放按钮也正常工作。</p><p id="fc90" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated"><em class="jy">我们可以制作一个工作示例，在自定义MIDI映射的帮助下，从浏览器控制Traktor。也有可能使它在另一个方向上工作。当我在Traktor中改变音量时，我们会自动调整web浏览器中的滑块。我们可以用一个</em> <code class="fe mq mr ms mt b"><em class="jy">out</em></code> <em class="jy">映射来代替我们在Traktor中配置的</em> <code class="fe mq mr ms mt b"><em class="jy">in</em></code> <em class="jy">映射来实现这一点，两者可以并行工作。我们不会详细讨论，但值得一提。</em></p><h2 id="1df0" class="me kb jb bd kc mf mg dn kg mh mi dp kk jl mj mk ko jp ml mm ks jt mn mo kw mp bi translated">要求三:用游戏手柄控制音量。</h2><p id="6456" class="pw-post-body-paragraph iz ja jb jc b jd ky jf jg jh kz jj jk jl la jn jo jp lb jr js jt lc jv jw jx ij bi translated">正如我们现在了解如何通过MIDI控制Traktor，我们现在可以使用gamepad API来使用我们的PS4 DualShock。由于Gamepad API的工作方式，这种行为可能会有一些问题。我们需要定期“轮询”游戏手柄的状态，以检查按下了什么按钮。</p><p id="4534" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">也就是说，我们可能会记录多次按钮点击，或者根本不记录，这取决于我们按下按钮的时间以及我们的“轮询”间隔。我们可以通过使用RxJs来避免这种行为，但是我不希望我们的概念验证有太多的代码，所以我只能接受潜在的尴尬行为。</p><p id="5966" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated"><em class="jy">我们需要用USB线将PS4 DualShock连接到我们的本地机器。不需要特别的软件，如果你用mac，看看这个</em> <a class="ae jz" href="https://www.macworld.co.uk/how-to/mac/use-ps4-xbox-controller-mac-3626259/" rel="noopener ugc nofollow" target="_blank"> <em class="jy">教程</em> </a> <em class="jy">，否则谷歌就是你的朋友。虽然他们给出了如何通过蓝牙连接的建议，但还是使用USB电缆的方法。</em></p><p id="7346" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">对于这个例子，我将使用我们的PS4 DualShock的导航按钮。<strong class="jc ld">向上</strong>按钮有id/index <code class="fe mq mr ms mt b">12</code>，而<strong class="jc ld">向下</strong>按钮有id/index <code class="fe mq mr ms mt b">13</code>。完整的地图可以在这里找到<a class="ae jz" href="http://webapistudio.com/#/gamepad-debugger" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="mu mv mw mx gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nc"><img src="../Images/31d6f94eed317a1db2fb7632f85da16e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*THFNwnXDx_pgeSHE40R5eA.png"/></div></div></figure><p id="9ca9" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">代码如下:</p><figure class="mu mv mw mx gt is"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="2489" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">为了示例的清晰，我删除了HTML控件/按钮。在第<code class="fe mq mr ms mt b">12</code>行，我们开始我们的轮询间隔，称为<code class="fe mq mr ms mt b">getButtonState</code>。该功能将获取我们的<code class="fe mq mr ms mt b">up</code>和<code class="fe mq mr ms mt b">down</code>按钮的当前状态，并相应地调整音量。注意，我们必须跟踪当前的音量级别，这样我们就知道需要发送什么值(因为音量是用一个在<code class="fe mq mr ms mt b">0</code>和<code class="fe mq mr ms mt b">127</code>之间的值表示的)。</p><p id="5706" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">下面是一个展示我们代码运行的小视频:</p><figure class="mu mv mw mx gt is"><div class="bz fp l di"><div class="nb mz l"/></div></figure><p id="ff50" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">非常管用！现在让我们进入最后阶段。</p><h2 id="eb79" class="me kb jb bd kc mf mg dn kg mh mi dp kk jl mj mk ko jp ml mm ks jt mn mo kw mp bi translated">要求4:用游戏手柄控制播放/暂停。</h2><p id="7fdb" class="pw-post-body-paragraph iz ja jb jc b jd ky jf jg jh kz jj jk jl la jn jo jp lb jr js jt lc jv jw jx ij bi translated">为了方便我在展示工作示例时能够拍摄，我将使用导航按钮<code class="fe mq mr ms mt b">right</code> (id/index <code class="fe mq mr ms mt b">15</code>)作为播放/暂停按钮。我们只需要扩展<code class="fe mq mr ms mt b">getButtonState</code>函数来注册它上面的任何按钮，并发出相应的MIDI消息。</p><figure class="mu mv mw mx gt is"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="288f" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">如果你看一下代码，就会发现只做了很小的改动。在第<code class="fe mq mr ms mt b">24</code>行，我们还得到导航按钮<code class="fe mq mr ms mt b">right</code>，在第<code class="fe mq mr ms mt b">39</code>行，我们发送相应的MIDI信息。现在我们可以在最终的视频中看到这一切:</p><figure class="mu mv mw mx gt is"><div class="bz fp l di"><div class="nb mz l"/></div></figure><p id="e73d" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">您可能会注意到“播放/暂停”有时会“口吃”，所以它会暂停并立即再次恢复。这是之前提到的一个例子，这是因为我们“轮询”按钮状态的Gamepad API的性质和我的间隔太快，所以我们连续两次注册按钮按压。</p></div><div class="ab cl le lf hu lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ij ik il im in"><p id="5398" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">今天，我们设法从我们的网络浏览器，甚至通过我们的PS4 DualShock使用最新的浏览器Web APIs来控制Traktor。代码片段与理想的实现方式相去甚远，但它们给了我们一个坚实的例子，说明所有这些技术可以协同工作。我在我的网站<a class="ae jz" href="http://webapistudio.com" rel="noopener ugc nofollow" target="_blank">WebApiStudio.com</a>上创建了一个更可靠的实现，在那里你还可以找到其他有趣的“调试器”和关于本文所用技术的信息。</p></div><div class="ab cl le lf hu lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ij ik il im in"><h1 id="378e" class="ka kb jb bd kc kd ll kf kg kh lm kj kk kl ln kn ko kp lo kr ks kt lp kv kw kx bi translated">摘要</h1><p id="f771" class="pw-post-body-paragraph iz ja jb jc b jd ky jf jg jh kz jj jk jl la jn jo jp lb jr js jt lc jv jw jx ij bi translated">今天，我们了解并展示了新的浏览器web APIs提供了广泛的参与机会。从这个概念证明中，我们可以更进一步，用输入(如游戏手柄)控制我们的音乐软件，甚至是使用MIDI的实际乐器。</p><p id="4640" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">我希望你在学习新东西的时候很开心。如果您有任何问题、反馈或意见，请在下面留下评论或通过<a class="ae jz" href="https://twitter.com/SegersIan" rel="noopener ugc nofollow" target="_blank"> Twitter </a>联系我。</p><p id="acf6" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">如果你想对我的努力表示感谢👏非常感谢。</p></div><div class="ab cl le lf hu lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ij ik il im in"><p id="c253" class="pw-post-body-paragraph iz ja jb jc b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ij bi translated">您可能喜欢的其他文章:</p><div class="ip iq gp gr ir nd"><a rel="noopener  ugc nofollow" target="_blank" href="/how-not-to-interact-with-your-web-app-with-a-ps4-controller-a3e3036a2f6e"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd ld gy z fp ni fr fs nj fu fw nk bi translated">如何避免:用PS4控制器与你的网络应用程序互动。</h2><div class="nl l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">体验Web APIs。</h3></div><div class="nm l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">itnext.io</p></div></div><div class="nn l"><div class="no l np nq nr nn ns ix nd"/></div></div></a></div><div class="ip iq gp gr ir nd"><a href="https://medium.com/@segersian/serverless-edge-with-cloudflare-workers-9d9b13534e1e" rel="noopener follow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd ld gy z fp ni fr fs nj fu fw nk bi translated">Cloudflare Workers的无服务器优势</h2><div class="nl l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">对Cloudflare工作人员的初步了解</h3></div><div class="nm l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">medium.com</p></div></div><div class="nn l"><div class="nt l np nq nr nn ns ix nd"/></div></div></a></div><div class="ip iq gp gr ir nd"><a href="https://medium.com/@segersian/howto-async-generators-in-nodejs-c7f0851f9c02" rel="noopener follow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd ld gy z fp ni fr fs nj fu fw nk bi translated">how to:NodeJS中的异步生成器</h2><div class="nl l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">如何使用新的ES2018功能，如异步发生器功能和for-async-of循环。</h3></div><div class="nm l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">medium.com</p></div></div><div class="nn l"><div class="nu l np nq nr nn ns ix nd"/></div></div></a></div></div></div>    
</body>
</html>