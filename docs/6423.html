<html>
<head>
<title>Infrastructure as Code: the next big shift is here</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">作为代码的基础设施:下一个大转变就在这里</h1>
<blockquote>原文：<a href="https://itnext.io/infrastructure-as-code-the-next-big-shift-is-here-9215f0bda7ce?source=collection_archive---------0-----------------------#2021-11-14">https://itnext.io/infrastructure-as-code-the-next-big-shift-is-here-9215f0bda7ce?source=collection_archive---------0-----------------------#2021-11-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/4a26efd51d432da133103cbf102175d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QT5YQjI9LkWZpUcP7wx_2g.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">本在<a class="ae jd" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><div class=""/><h1 id="e1fb" class="kd ke jg bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">介绍</h1><p id="c2e3" class="pw-post-body-paragraph lb lc jg ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在这个博客中，我们将着眼于软件基础设施的演变；供应、交付和维护。</p><p id="4302" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">如果你对现代DevOps和SRE实践感兴趣，这篇文章是给你的。</p><p id="1616" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated"><strong class="ld jh">基础设施即代码(IaC) </strong>是一种常见的模式，其中虚拟化基础设施和辅助服务可以使用几乎任何语言表达的配置来管理，通常托管在源代码库中。</p><p id="6328" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">每隔一段时间，软件行业都会受到被称为“范式转变”的重大事件的影响。下面是几个这样的事件，它们使得代码基础设施成为今天的样子:</p><ul class=""><li id="7585" class="me mf jg ld b le lz li ma lm mg lq mh lu mi ly mj mk ml mm bi translated">虚拟化</li><li id="35d7" class="me mf jg ld b le mn li mo lm mp lq mq lu mr ly mj mk ml mm bi translated">集装箱化和集装箱编排</li><li id="0be8" class="me mf jg ld b le mn li mo lm mp lq mq lu mr ly mj mk ml mm bi translated">公共云基础架构</li><li id="a333" class="me mf jg ld b le mn li mo lm mp lq mq lu mr ly mj mk ml mm bi translated">DevOps文化</li></ul><h2 id="9cce" class="ms ke jg bd kf mt mu dn kj mv mw dp kn lm mx my kr lq mz na kv lu nb nc kz nd bi translated">基础设施供应:发展</h2><p id="1368" class="pw-post-body-paragraph lb lc jg ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">让我们来看看每一波变化是如何塑造软件景观的:</p><p id="cd98" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated"><strong class="ld jh"> #1虚拟化</strong></p><p id="2f56" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">在虚拟化的早期，开发人员会在漫长的瀑布式开发周期中开发软件，主要基于需求文档。与此同时，运营团队将安装和堆叠服务器，提供基础架构组件，安装所有的东西，进行配置等。通常两个团队会以一种不联系的方式工作，开罚单，通过长长的电子邮件链交流。那些是大时代。</p><figure class="nf ng nh ni gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ne"><img src="../Images/165e5bb12f960cba101792c0bdc5d61f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Okm6S8vFcuO3r9VR.png"/></div></div></figure><p id="6100" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated"><strong class="ld jh"> #2敏捷和DevOps的开始</strong></p><p id="2470" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">接下来是敏捷革命，随之而来的是DevOps文化的开始。现在，开发人员会将应用程序连同多页配置手册一起发送给运营团队。更多进步的团队将开始在自动化工具上合作。在基础设施的早期，像Chef或Puppet这样的自动化工具非常流行。巨大的改进，但通常是非常孤立的环境和分散的职责。</p><figure class="nf ng nh ni gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nj"><img src="../Images/f9cf4de66e597d6aa0a9f5038423ba08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*55RjveGLBumwMOZ7.png"/></div></div></figure><p id="1612" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated"><strong class="ld jh"> #3公有云&amp;容器编排</strong></p><p id="2bf7" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">随着公共云使用的增加和更强大的自动化，事情开始步入正轨。大多数运营团队选择的工具是terraform。与几年前的情况相比，这是巨大的进步。创建的基础设施数量呈指数级增长。</p><p id="c25c" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">很长一段时间，这张图几乎是完美的…几乎。那么缺少什么呢？嗯，开发人员和运营人员的经验都有所欠缺。精心创建的基础架构开始漂移，需要大量的工作和维护开销。另一方面，开发人员必须学习新的语言，努力将Ops工具集成到他们的工作流程中。社区聚集在一起，提出各种创造性的解决方案，漂移检测，更多的自动化，可观察性等。所有这些工具和项目都很棒，但不是标准化的。</p><p id="3456" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">如何改进已经很好的流程？如何再做一次飞跃，让事情变得好，变得伟大？像大多数好的答案一样，答案来自社区本身。还记得我们如何谈论范式转换吗？其中之一是容器化和容器编排，这在较小程度上实现了打包(容器映像)和运行时(Kubernetes pods)问题的标准化。现在，所有的标准和工具都唾手可得，只需最后一点努力，就能让它们无缝地协同工作。在我看来，<a class="ae jd" href="https://crossplane.io/" rel="noopener ugc nofollow" target="_blank">交叉平面</a>是基础设施中缺少的一环。</p><blockquote class="nk nl nm"><p id="14e0" class="lb lc nn ld b le lz lg lh li ma lk ll no mb lo lp np mc ls lt nq md lw lx ly ij bi translated"><em class="jg">cross plane的强大之处在于使用了云原生开放标准和最流行的工具，使开发人员(也就是应用团队)和运营人员(也就是平台团队)能够协同工作，而不互相依赖。</em></p></blockquote><figure class="nf ng nh ni gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nr"><img src="../Images/f402b0ae0009cf4881be900a11da8b99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RgfC22adem8pqRrq.png"/></div></div></figure><p id="44eb" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated"><em class="nn">在我们进入博客的下一部分之前，先声明一点。选择奶牛和企鹅分别代表开发者和ops，纯粹是基于动物的可爱程度。</em></p><h2 id="6498" class="ms ke jg bd kf mt mu dn kj mv mw dp kn lm mx my kr lq mz na kv lu nb nc kz nd bi translated">交叉平面架构</h2><p id="ee3a" class="pw-post-body-paragraph lb lc jg ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">是什么让Crossplane如此特别？首先，它建立在Kubernetes之上，并利用了这样一个事实，即Kubernetes的真正强大之处在于其强大的API模型和控制平面逻辑(控制循环)。它也从作为代码的基础设施转移到作为数据的基础设施。不同之处在于，IaC意味着编写代码来描述供应应该如何发生，而IaD意味着编写纯数据文件(在Kubernetes YAML的情况下)并将它们提交给控制组件(在Kubernetes是操作员的情况下)来封装和执行供应逻辑。</p><p id="117b" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">对我来说，Crossplane最棒的部分是它通过利用<a class="ae jd" href="https://containerjournal.com/kubeconcnc/kubernetes-true-superpower-is-its-control-plane/" rel="noopener ugc nofollow" target="_blank"> Kubernetes Control </a> Plane作为每个人相遇的汇聚点，无缝地支持应用程序团队和平台团队之间的协作。</p><h2 id="0cd5" class="ms ke jg bd kf mt mu dn kj mv mw dp kn lm mx my kr lq mz na kv lu nb nc kz nd bi translated">成分</h2><p id="5c59" class="pw-post-body-paragraph lb lc jg ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">让我们看看交叉面板组件模型是什么样子的。一个警告的话，如果你是Kubernetes的新手，这可能是压倒性的，但努力理解它是有价值的。下图显示了交叉面板组件模型及其基本交互。</p><figure class="nf ng nh ni gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ns"><img src="../Images/d3215c9456faced7ce75ae48a58a36ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eh8MsuxVljPTM-gdPdDiGQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">来源:作者基于Crossplane.io</figcaption></figure></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><h1 id="05e4" class="kd ke jg bd kf kg oa ki kj kk ob km kn ko oc kq kr ks od ku kv kw oe ky kz la bi translated">演示场景</h1><p id="c354" class="pw-post-body-paragraph lb lc jg ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">演示场景突出了Crossplane的复合功能。通过将基础设施的复杂性转移到平台团队中，使用组合有助于将基础设施的复杂性从开发人员那里抽象出来。</p><p id="4807" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">场景流程:</p><ul class=""><li id="949b" class="me mf jg ld b le lz li ma lm mg lq mh lu mi ly mj mk ml mm bi translated">部署RDS</li><li id="5467" class="me mf jg ld b le mn li mo lm mp lq mq lu mr ly mj mk ml mm bi translated">部署EKS</li><li id="d811" class="me mf jg ld b le mn li mo lm mp lq mq lu mr ly mj mk ml mm bi translated">突出创建和使用合成的主要步骤</li></ul><h2 id="ac12" class="ms ke jg bd kf mt mu dn kj mv mw dp kn lm mx my kr lq mz na kv lu nb nc kz nd bi translated">先决条件</h2><p id="216b" class="pw-post-body-paragraph lb lc jg ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">为了跟进，您需要在本地机器上配置一个AWS和CLI订阅。需要AWS的基本知识来理解正在部署的组件，并对Kubernetes资源模型有基本的了解。</p><p id="d637" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">用于访问云环境和部署基础架构的凭据将从装载的卷进行映射。</p><p id="8e5e" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">本地安装您将需要:</p><ul class=""><li id="c6ae" class="me mf jg ld b le lz li ma lm mg lq mh lu mi ly mj mk ml mm bi translated">VS代码与远程容器devcontainer插件</li><li id="cd4c" class="me mf jg ld b le mn li mo lm mp lq mq lu mr ly mj mk ml mm bi translated">使用Windows时的WSL2</li></ul><h2 id="8013" class="ms ke jg bd kf mt mu dn kj mv mw dp kn lm mx my kr lq mz na kv lu nb nc kz nd bi translated">演示设置</h2><p id="0a80" class="pw-post-body-paragraph lb lc jg ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">来自<a class="ae jd" href="https://crossplane.io/docs/v1.5/getting-started/install-configure.html#install-crossplane" rel="noopener ugc nofollow" target="_blank">交叉平面安装</a>的所有组件已经预先安装在这个项目的devcontainer中。</p><p id="fd4f" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">这些组件是:</p><ul class=""><li id="1dda" class="me mf jg ld b le lz li ma lm mg lq mh lu mi ly mj mk ml mm bi translated">Kubernetes minikube</li><li id="ccf5" class="me mf jg ld b le mn li mo lm mp lq mq lu mr ly mj mk ml mm bi translated">舵</li><li id="3cab" class="me mf jg ld b le mn li mo lm mp lq mq lu mr ly mj mk ml mm bi translated">库贝特尔</li><li id="5a30" class="me mf jg ld b le mn li mo lm mp lq mq lu mr ly mj mk ml mm bi translated">交叉平面CLI</li><li id="5588" class="me mf jg ld b le mn li mo lm mp lq mq lu mr ly mj mk ml mm bi translated">AWS CLI</li></ul><blockquote class="nk nl nm"><p id="06f6" class="lb lc nn ld b le lz lg lh li ma lk ll no mb lo lp np mc ls lt nq md lw lx ly ij bi translated"><em class="jg">交叉板应该安装在</em>交叉板-系统<em class="jg">命名空间中，如果没有请运行</em> <code class="fe of og oh oi b"><em class="jg">.devcontainer/library-scripts/setup-crossplane.sh</em></code></p></blockquote><p id="1cd7" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated"><em class="nn">这种设置有点笨拙，例如，由于从容器中读取文件，性能不是最佳的，并且整体设置不是我想要的。如果容器达到滥用的极限，这可能会变成基于流浪者的设置。</em></p><h2 id="bf88" class="ms ke jg bd kf mt mu dn kj mv mw dp kn lm mx my kr lq mz na kv lu nb nc kz nd bi translated">可观察性</h2><p id="baff" class="pw-post-body-paragraph lb lc jg ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">使用<a class="ae jd" href="https://docs.vmware.com/en/VMware-vSphere/7.0/vmware-vsphere-with-tanzu/GUID-1AEDB285-C965-473F-8C91-75724200D444.html" rel="noopener ugc nofollow" target="_blank">八分圆</a>可视化CRDsVMWare开源集群可视化工具，在浏览器中运行，因此不需要集群内安装。</p><p id="2998" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">如果你更喜欢终端工具，<a class="ae jd" href="https://k9scli.io/" rel="noopener ugc nofollow" target="_blank"> k9s </a>可以满足你。</p><h2 id="f9e1" class="ms ke jg bd kf mt mu dn kj mv mw dp kn lm mx my kr lq mz na kv lu nb nc kz nd bi translated">AWS提供商</h2><p id="2491" class="pw-post-body-paragraph lb lc jg ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">安装程序将根据从本地$HOME/挂载的默认概要文件自动生成AWS配置。aws文件夹。</p><blockquote class="nk nl nm"><p id="ce83" class="lb lc nn ld b le lz lg lh li ma lk ll no mb lo lp np mc ls lt nq md lw lx ly ij bi translated"><em class="jg"> creds.conf文件被添加到。gitignore这样你就不会不小心把它提交给回购了！</em></p></blockquote><p id="80ac" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">下一步是配置Crossplane以访问AWS并创建资源，我们将通过创建一个秘密来实现这一点:</p><p id="b27e" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated"><code class="fe of og oh oi b">kubectl create secret generic aws-creds -n crossplane-system --from-file=creds=./creds.conf</code></p><p id="a1c8" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">现在，在集群上安装AWS provider</p><p id="7dfc" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated"><code class="fe of og oh oi b">kubectl apply -f <a class="ae jd" href="https://raw.githubusercontent.com/crossplane/crossplane/release-1.5/docs/snippets/configure/aws/providerconfig.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/crossplane/crossplane/release-1.5/docs/snippets/configure/aws/providerconfig.yaml</a></code></p><p id="9d6b" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">从那里开始，你应该能够跟随来自<a class="ae jd" href="https://crossplane.io/docs/v1.5/getting-started/provision-infrastructure.html" rel="noopener ugc nofollow" target="_blank"> Crossplane的网页</a>的演示。</p><h2 id="152b" class="ms ke jg bd kf mt mu dn kj mv mw dp kn lm mx my kr lq mz na kv lu nb nc kz nd bi translated">部署RDS实例</h2><p id="d8b2" class="pw-post-body-paragraph lb lc jg ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">首先，让我们部署一个RDS实例，这是一个AWS托管资源，由AWS提供程序提供。参见<a class="ae jd" href="https://github.com/Piotr1215/crossplane-demo#crossplane-components" rel="noopener ugc nofollow" target="_blank">交叉板组件图</a>。</p><p id="120a" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated"><code class="fe of og oh oi b">kubectl create -f rds-instance.yaml</code></p><p id="3598" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">RDSInstance只是一个Kubernetes资源，如pod、service或replicaSet。您可以在Octant或命令行中查看部署进度:<code class="fe of og oh oi b">watch kubectl get RDSInstance</code></p><p id="7171" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">用<code class="fe of og oh oi b">kubectl delete -f rds-instance.yaml</code>删除实例</p><h2 id="722d" class="ms ke jg bd kf mt mu dn kj mv mw dp kn lm mx my kr lq mz na kv lu nb nc kz nd bi translated">部署EKS集群</h2><p id="1816" class="pw-post-body-paragraph lb lc jg ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">通过自动化部署EKS集群不是一项简单的任务，有许多组件需要创建，如VPC、子网、IAM角色、节点池、路由表、网关…这不是开发人员想要的体验，但这种复杂性必须存在，没有神奇的“消除复杂性”按钮！</p><p id="b897" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">正如我们在组件图中看到的，该过程从构建XRD(复合资源定义)开始，我们可以在其中指定:</p><ul class=""><li id="b37c" class="me mf jg ld b le lz li ma lm mg lq mh lu mi ly mj mk ml mm bi translated">XR(复合资源)的模式</li><li id="6601" class="me mf jg ld b le mn li mo lm mp lq mq lu mr ly mj mk ml mm bi translated">XRC的模式(复合资源声明)</li></ul><p id="bb5b" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">为了帮助理解配置的复杂程度，这里有一个表示EKS组成的图表。这种复杂性由平台团队来管理，平台团队是专门研究Kubernetes和云提供商的团队。</p><figure class="nf ng nh ni gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oj"><img src="../Images/7d39f5a67db02c8486a4f942d7ae48be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*t4btKTd8mvh19usJ.png"/></div></div></figure><p id="ea17" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">现在隐藏了这种复杂性，开发者得到了这个:</p><figure class="nf ng nh ni gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ok"><img src="../Images/d62d95d836b7b0ee46215fb27bbdea72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ialtzHaWkQs0e5pt.png"/></div></div></figure><pre class="nf ng nh ni gt ol oi om on aw oo bi"><span id="ba48" class="ms ke jg oi b gy op oq l or os">apiVersion: crossplanedemo.com/v1alpha1<br/>kind: CompositeKubernetesCluster<br/>metadata:<br/>  name: devops-team<br/>  labels:<br/>    cluster-owner: piotrzan<br/>spec:<br/>  compositionRef:<br/>    # Possible values cluster-google, cluster-azure, cluster-aws<br/>    name: cluster-aws<br/>  parameters:<br/>    # Possible values small, medium, large<br/>    nodeSize: small<br/>    # version: "1.20"<br/>    # minNodeCount: 2<br/>  writeConnectionSecretToRef:<br/>    namespace: devops-team<br/>    name: cluster</span></pre><p id="30ed" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">部署集群非常容易，只需<code class="fe of og oh oi b">kubectl create -f ./aws</code></p><p id="f3c6" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">EKS集群部署状态:</p><figure class="nf ng nh ni gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oj"><img src="../Images/d298b1767c1b24ea77bc8f8ceec5f1cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gKCrilbgY4MwOtU_.png"/></div></div></figure><h2 id="7521" class="ms ke jg bd kf mt mu dn kj mv mw dp kn lm mx my kr lq mz na kv lu nb nc kz nd bi translated">检索kubeconfig详细信息</h2><pre class="nf ng nh ni gt ol oi om on aw oo bi"><span id="d5c3" class="ms ke jg oi b gy op oq l or os">kubectl get secrets --namespace devops-team cluster \<br/>     --output jsonpath="{.data.kubeconfig}" \<br/>     | base64 --decode | tee eks-config.yaml</span><span id="2011" class="ms ke jg oi b gy ot oq l or os">export KUBECONFIG=$PWD/eks-config.yaml</span></pre><p id="ee49" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">从这里你可以像普通的EKS一样使用集群。</p><p id="edb3" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">记得使用<code class="fe of og oh oi b">unset KUBECONFIG</code>或source bash/zshrc来恢复您的旧配置。</p><h2 id="bf63" class="ms ke jg bd kf mt mu dn kj mv mw dp kn lm mx my kr lq mz na kv lu nb nc kz nd bi translated">清除</h2><p id="4707" class="pw-post-body-paragraph lb lc jg ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">删除EKS和伴随的资源<code class="fe of og oh oi b">kubectl delete -f ./aws</code>退出VS代码，这将停止容器。您可以通过<code class="fe of og oh oi b">docker system prune --all</code>进一步清理未使用的容器和图像。</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><h1 id="7bf7" class="kd ke jg bd kf kg oa ki kj kk ob km kn ko oc kq kr ks od ku kv kw oe ky kz la bi translated">结论</h1><p id="5852" class="pw-post-body-paragraph lb lc jg ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">以防有人想知道，这篇文章不是由Upbound(cross plane背后的公司)赞助的，我真诚地相信这个产品是革命性的。</p><p id="3fce" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">我们已经看到了Crossplane如何帮助简化基础设施配置和管理。以下是我想强调的几个好处。</p><ul class=""><li id="7579" class="me mf jg ld b le lz li ma lm mg lq mh lu mi ly mj mk ml mm bi translated">可组合的基础设施</li><li id="af8b" class="me mf jg ld b le mn li mo lm mp lq mq lu mr ly mj mk ml mm bi translated">自助服务</li><li id="5ceb" class="me mf jg ld b le mn li mo lm mp lq mq lu mr ly mj mk ml mm bi translated">自动化程度提高</li><li id="5277" class="me mf jg ld b le mn li mo lm mp lq mq lu mr ly mj mk ml mm bi translated">标准化协作</li><li id="216e" class="me mf jg ld b le mn li mo lm mp lq mq lu mr ly mj mk ml mm bi translated">通用语言(K8s API)</li></ul><p id="50d9" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">我最喜欢Crossplane的一点是，它通过促进应用程序团队和平台团队之间的松散耦合协作，构建时考虑了DevOps文化。资源模型、打包、配置都是经过深思熟虑的。</p><p id="72b7" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">还有一些挑战需要记住:</p><ul class=""><li id="b012" class="me mf jg ld b le lz li ma lm mg lq mh lu mi ly mj mk ml mm bi translated">复杂性，这是为它提供的灵活性所付出的代价</li><li id="931d" class="me mf jg ld b le mn li mo lm mp lq mq lu mr ly mj mk ml mm bi translated">YAML扩散，这是好是坏取决于你对YAML的立场；)</li><li id="7a79" class="me mf jg ld b le mn li mo lm mp lq mq lu mr ly mj mk ml mm bi translated">你需要很了解K8s</li></ul><p id="8a64" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">复杂性通过将它转移到专门的平台团队来解决。对YAML来说，我希望看到更多像CDK8s或其他人那样的YAML一代的融合。我认为依赖K8s是一个好处，但对于我们这些还不熟悉Kubernetes的人来说，这使得学习曲线有点陡峭。</p><p id="b60d" class="pw-post-body-paragraph lb lc jg ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">总之，Crossplane是一个伟大的产品，它出现在正确的时间，并以一种非常创新和面向未来的方式解决了几十年来的所有问题。去看看！</p></div></div>    
</body>
</html>