<html>
<head>
<title>Managing Local State with Apollo Client</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Apollo客户端管理本地状态</h1>
<blockquote>原文：<a href="https://itnext.io/managing-local-state-with-apollo-client-3be522258645?source=collection_archive---------2-----------------------#2018-05-02">https://itnext.io/managing-local-state-with-apollo-client-3be522258645?source=collection_archive---------2-----------------------#2018-05-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="82ff" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated"><strong class="ak">序幕</strong></h1><p id="ae21" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">Web开发最大的优点和缺点之一是它的模块化方法。一个关键的编程口头禅是选择一些东西(一个函数，一个包)来完成一项工作，并把它做好。这种方法的缺点可能意味着单个项目可能在几十种独立的技术和概念之间周旋，每种技术和概念都专注于特定的东西。</p><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="lo lp l"/></div></figure><p id="2b13" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">所以选择Apollo客户机来处理我的本地状态和远程数据似乎是显而易见的。既然我已经设置了Apollo/GraphQL从后端获取数据，为什么还要处理Redux的样板文件和习惯用法呢？</p><p id="fe6a" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">虽然本文将讨论如何设置Apollo来处理本地状态，但它并不是对该技术的介绍。(这个正统的<a class="ae lv" href="https://www.howtographql.com/" rel="noopener ugc nofollow" target="_blank"> howtographql </a>教程就是一个很好的例子)。</p><p id="333a" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">注:已完成的回购可以在这里找到<a class="ae lv" href="https://github.com/andrico1234/apollo-local-state-starter" rel="noopener ugc nofollow" target="_blank">。除了在你陷入困境时为你提供帮助之外，它还充当了一个与Apollo-Client一起设置的React应用程序，用于开箱即用的本地状态功能，带你上路。</a></p><h1 id="2df4" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated"><strong class="ak">文森特·维加&amp;马沙·华莱士的妻子</strong></h1><p id="04eb" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们将从这里的<a class="ae lv" href="https://github.com/andrico1234/apollo-state-blog-repo" rel="noopener ugc nofollow" target="_blank">开始克隆相应的回购协议</a>。这个repo包含一个简单的react网站，有侧边栏、标题和正文。它本质上是相当静态的，没有动态内容(..还没)。在本教程结束时，我们将让Apollo管理网站的状态。点击侧边栏中的一个项目会改变网站的状态，进而更新标题以显示新数据。</p><p id="7d82" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">如果你检查<code class="fe lw lx ly lz b">package.json</code>，你会看到我们只有基本的，加上一些关于我们的包裹设置的额外的包裹。</p><p id="c441" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">克隆repo后，运行您的标准命令</p><pre class="lj lk ll lm gt ma lz mb mc aw md bi"><span id="b491" class="me jo iq lz b gy mf mg l mh mi">&gt; yarn<br/>&gt; yarn dev</span></pre><p id="4976" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">安装所有的包并创建一个本地服务器。转到localhost:1234，你将有希望看到演示网站的辉煌。它现在是静态的，所以点击什么也做不了。</p><p id="7dd6" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">我们首先要做的是让Apollo进入我们的项目，所以安装这些包。apollo-client允许我们配置apollo的实例，react-apollo是允许我们将其集成到react应用程序中的驱动程序。由于包裹的问题(我想)，我们也需要安装graphql。</p><pre class="lj lk ll lm gt ma lz mb mc aw md bi"><span id="25d1" class="me jo iq lz b gy mf mg l mh mi">&gt; yarn add apollo-client react-apollo graphql</span></pre><p id="b07a" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">所以创建一个新目录<code class="fe lw lx ly lz b">src/apollo</code>。打开一个<code class="fe lw lx ly lz b">index.js</code>文件，添加以下内容</p><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="mj lp l"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">src/阿波罗/index.js</figcaption></figure><p id="5fe0" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">这是初始化我们的Apollo客户端，然后我们将通过在我们的<code class="fe lw lx ly lz b">src/index.js</code>文件中添加以下内容来包装我们的React应用程序。</p><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="mj lp l"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">src/index.js</figcaption></figure><p id="db28" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">现在，我们已经可以在应用程序中使用Apollo了。当我们重新启动我们的开发服务器时，一切都构建好了，但是当我们试图在浏览器中访问它时，我们得到了一个错误。控制台会告诉我们，我们需要为Apollo客户机指定链接和缓存属性，所以我们就这么做吧。</p><pre class="lj lk ll lm gt ma lz mb mc aw md bi"><span id="3646" class="me jo iq lz b gy mf mg l mh mi">&gt; yarn add apollo-link apollo-cache-inmemory apollo-link-state</span></pre><p id="8c50" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">前一行向我们的应用程序添加了新的Apollo依赖项，而下面的代码解决了我们遇到的控制台错误。因此，返回到<code class="fe lw lx ly lz b">apollo/index.js</code>并更新它，使文件看起来像这样:</p><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="mj lp l"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">src/阿波罗/index.js</figcaption></figure><p id="69e3" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">让我们创建一个缓存实例。缓存是Apollo的标准化数据存储，它将查询结果存储到一个扁平的数据结构中。(为什么这对我们有好处？).当我们进行graphql查询时，我们将从缓存中读取，当我们进行变异解析时，我们将向缓存中写入。</p><p id="7ec3" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">您可以看到我们还向我们的客户端对象添加了<code class="fe lw lx ly lz b">link</code>。<code class="fe lw lx ly lz b">ApolloLink.from()</code>方法让我们模块化地配置如何通过HTTP发送查询。我们可以用它来处理错误、授权并提供对我们后端的访问。为了本教程的缘故，我们不会做这些，但是我们将在这里设置我们的客户端状态。所以我们创建上面的<code class="fe lw lx ly lz b">const stateLink</code>，并传入我们的缓存。稍后我们将在这里添加默认状态和解析器。</p><p id="48d8" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">回到浏览器，你会看到我们可爱的静态网站显示其所有的辉煌。让我们为项目添加一些默认状态，并启动我们的第一个查询。</p><p id="e58b" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">在apollo目录中创建一个名为<code class="fe lw lx ly lz b">defaults</code>的新目录，并在其中添加一个<code class="fe lw lx ly lz b">index.js</code>。该文件将包含以下内容:</p><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="mj lp l"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">src/默认值/index.js</figcaption></figure><p id="89fc" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">我们创建一个对象作为我们站点的默认状态，apolloClientDemo是我们在查询时想要访问的数据结构的名称。<code class="fe lw lx ly lz b">__typename</code>是我们的缓存使用的强制标识符，currentPageName是我们的header将用来显示当前页面名称的特定数据项。</p><p id="1108" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">我们需要将它添加到我们的<code class="fe lw lx ly lz b">apollo/index.js</code>文件中</p><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="mj lp l"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">src/阿波罗/index.js</figcaption></figure><p id="e1a5" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">让我们澄清一下。通常<code class="fe lw lx ly lz b">import default</code>是JavaScript关键字，你可以用它从文件中导入<code class="fe lw lx ly lz b">export default</code>生成的代码，但是巧合的是，我们从<code class="fe lw lx ly lz b">./defaults</code>中导出的对象的名字叫做<code class="fe lw lx ly lz b">defaults</code>。将该导入行视为普通的ol' named import。</p><p id="e5e5" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">这样一来，我们就可以进行查询了！</p><h1 id="f672" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated"><strong class="ak">金表</strong></h1><p id="38e9" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">将以下包添加到您的项目中</p><pre class="lj lk ll lm gt ma lz mb mc aw md bi"><span id="4dc8" class="me jo iq lz b gy mf mg l mh mi">&gt; yarn add graphql-tag</span></pre><p id="81e3" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">创建一个新目录<code class="fe lw lx ly lz b">src/graphql</code>，并在其中创建两个新文件<code class="fe lw lx ly lz b">index.js</code>和<code class="fe lw lx ly lz b">getPageName.js</code>。graphql目录将容纳所有的查询和变化。我们将通过编写以下代码在<code class="fe lw lx ly lz b">getPageName.js</code>中创建我们的查询:</p><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="mj lp l"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">src/graphql/getPageName.js</figcaption></figure><p id="6968" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">所以我们导出两个变量，查询和选项。如果您以前使用过graphql，那么这个查询看起来会很熟悉。我们对apolloClientDemo数据结构进行查询，只检索currentPageName。您会注意到我们已经在查询中添加了<code class="fe lw lx ly lz b">@client</code>指令。这告诉Apollo查询我们的本地状态，而不是将请求发送到后端。</p><p id="58e7" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">下面您会看到我们正在导出一些选项。这只是定义当我们将结果映射到道具时，我们希望数据看起来是什么样子。我们正在析构graphql响应，并将其发送到我们的视图，因此它看起来像这样:</p><pre class="lj lk ll lm gt ma lz mb mc aw md bi"><span id="4170" class="me jo iq lz b gy mf mg l mh mi">props: {<br/>  currentPageName: ‘Apollo Demo’,<br/>}</span><span id="e3d4" class="me jo iq lz b gy mo mg l mh mi">// and not this</span><span id="dafa" class="me jo iq lz b gy mo mg l mh mi">props: {<br/>  data: {<br/>    apolloClientDemo: {<br/>      currentPageName: ‘Apollo Demo’,<br/>    }<br/>  }<br/>}</span></pre><p id="a4f9" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">转到<code class="fe lw lx ly lz b">graphql/index.js</code>文件并导出查询，如下所示</p><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="mj lp l"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">src/graphql/index.js</figcaption></figure><p id="197e" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">同样，虽然这对于一个小的演示/项目来说不是完全必要的，但是如果你的应用程序变大了，这个文件会很方便。将您的查询从一个集中的位置导出，可以保持一切有序和可伸缩。</p><p id="892d" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">添加到您的Header.js:</p><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="mj lp l"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">src/components/Header.js</figcaption></figure><p id="5a76" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">这将动态显示当前页面的标题。现在，它将只显示默认值，因为我们还没有添加变异。但是你可以改变默认状态，网站会反映出来。</p><p id="cf3b" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">现在剩下要做的就是通过点击侧边栏条目来改变Apollo缓存中的数据。</p><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mp"><img src="../Images/35d0214d0feb513029a8ad76276c43d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OHpQBcsRCsX5Wk_b."/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">一个令人耳目一新的形象，打破了文字。杰夫·谢尔登</figcaption></figure><h1 id="c8aa" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated"><strong class="ak">儒勒、文森特、吉米&amp;狼</strong></h1><p id="5107" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">当处理突变时，事情变得有点复杂。我们不再只是从Apollo存储中检索数据，还会更新数据。突变的架构如下:</p><p id="be4f" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">&gt;<strong class="kn ir">用户</strong>点击侧边栏项目</p><p id="5e51" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">&gt;<strong class="kn ir">将</strong>变量发送至突变</p><p id="0f7f" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">&gt;<strong class="kn ir">用变量触发</strong>突变</p><p id="3712" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">&gt;<strong class="kn ir">将</strong>发送到阿波罗的实例中</p><p id="15a8" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">&gt;<strong class="kn ir">找到</strong>对应的解析器</p><p id="4663" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">&gt;<strong class="kn ir">将</strong>逻辑应用于阿波罗商店</p><p id="7183" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">&gt;<strong class="kn ir">将</strong>数据发送回割台</p><p id="c99d" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">如果这很难记住，那就用这个用助记符生成器创造的方便的助记符:城市老年牧神庄严地摸索着不忠的阿斯兰。(简单……)</p><p id="998f" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">首先创建一个文件<code class="fe lw lx ly lz b">graphql/updatePageName.js</code>。</p><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="mj lp l"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">src/graphql/updatePageName.js</figcaption></figure><p id="48dc" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">并像我们处理查询一样导出它。</p><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="mj lp l"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">src/graphql/index.js</figcaption></figure><p id="bbef" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">你会注意到一些关于突变的不同之处。首先，我们将关键字从query改为mutation。这让graphql知道我们正在执行的动作的类型。我们还定义了查询的名称，并向传入的变量添加了类型。在这里，我们指定了我们将用来执行更改的解析器的名称。我们还传递变量并添加了<code class="fe lw lx ly lz b">@client</code>指令。</p><p id="2fef" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">与查询不同，我们不能只是将突变添加到我们的视图中，然后期望发生任何事情。我们将不得不回到我们的阿波罗目录，并添加我们的解决方案。所以继续创建一个新目录<code class="fe lw lx ly lz b">apollo/resolvers</code>，以及文件<code class="fe lw lx ly lz b">index.js</code>和<code class="fe lw lx ly lz b">updatePageName.js</code>。在<code class="fe lw lx ly lz b">updatePageName.js</code>内添加以下内容:</p><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="mj lp l"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">src/阿波罗/resolvers/updatePageName.js</figcaption></figure><p id="0c7b" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">天啊，这个文件里有很多有趣的事情。幸运的是，这一切都非常符合逻辑，并没有给我们之前所做的事情增加许多新概念。</p><p id="7605" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">默认情况下，当解析器被调用时，Apollo会传入所有变量和缓存。第一个参数是一个简单的“_”，因为我们不需要使用它。第二个参数是变量对象，最后一个参数是缓存。</p><p id="33b0" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">在对Apollo存储进行更改之前，我们需要检索它。因此，我们发出一个简单的请求，从存储中获取当前内容，并将其分配给previousState。在数据变量内部，我们创建了一个新的对象，其中包含了我们想要添加到存储中的新信息，然后我们向其中写入数据。你可以看到我们已经将之前的状态扩展到了这个对象中。因此，只有我们明确想要更改的数据才会得到更新，其他的都保持原样，这就防止了Apollo不必要地更新那些数据没有更改的组件。</p><p id="0f7c" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">注意:虽然对于这个例子来说这不是完全必要的，但是当查询和突变处理大量数据时，它非常有用，所以为了可伸缩性，我保留了它。</p><p id="6254" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">同时在<code class="fe lw lx ly lz b">resolvers/index.js</code>文件中…</p><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="mw lp l"/></div></figure><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="mj lp l"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">src/apollo/resolvers/index.js</figcaption></figure><p id="3e64" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">这是Apollo期望的对象形状，当我们在<code class="fe lw lx ly lz b">apollo/index.js</code>中将解析器传递给stateLink时:</p><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="mj lp l"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">src/阿波罗/index.js</figcaption></figure><p id="b45d" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">剩下要做的就是将变异添加到我们的侧栏组件中。</p><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="mj lp l"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">src/components/Sidebar.js</figcaption></figure><p id="3ce9" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">就像我们的解析器文件一样，这个文件中有很多内容，但没有什么是我们以前没有见过的。我们导入变异，使用compose方法将graphQL变异添加到我们的props中。然后我们在handleClick中触发它。我们通过<code class="fe lw lx ly lz b">&lt;li&gt;</code>元素传入页面的新名称，如果一切正常，您应该能够运行您的开发服务器并单击侧栏项目。</p><h1 id="89da" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated"><strong class="ak">后记</strong></h1><p id="4f58" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">万岁！希望一切顺利。如果你卡住了，然后检查回购<a class="ae lv" href="https://github.com/andrico1234/apollo-local-state-starter" rel="noopener ugc nofollow" target="_blank">在这里</a>。它包含了所有完成的代码。如果你想在下一个React应用中使用本地状态管理，那么你可以派生这个repo并从那里继续。</p><p id="6bac" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">我还想在本教程中介绍更多内容，比如异步解析器(想想Redux thunk)、类型检查/创建模式以及更多关于缓存的乐趣。</p><p id="24a2" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">我真的希望这个教程对你有用，我也想大声说出<a class="ae lv" href="https://www.youtube.com/watch?v=2RvRcnD8wHY" rel="noopener ugc nofollow" target="_blank">萨拉·维埃拉的youtube教程</a>，因为它帮助我理解了阿波罗客户端。如果我没有做好我的工作，让你挠头，那么请点击链接。最后，请随时在社交媒体上联系我，我是一个超级音乐和技术迷，所以请和我聊聊极客。</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h2 id="33b1" class="me jo iq bd jp ne nf dn jt ng nh dp jx kw ni nj kb la nk nl kf le nm nn kj no bi translated">感谢阅读！</h2><p id="9f8c" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如果你有兴趣邀请我参加会议、meetup或作为演讲嘉宾参加任何活动，那么你可以在<a class="ae lv" href="https://twitter.com/andricokaroulla?lang=en" rel="noopener ugc nofollow" target="_blank"> twitter </a>上给我发DM！</p><p id="8226" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated">我希望这篇文章教给你一些新的东西。我定期发帖子，所以如果你想了解我的最新消息，你可以关注我。记住，你按住拍手按钮的时间越长，你能发出的拍手声就越多。👏👏👏</p><h2 id="55cb" class="me jo iq bd jp ne nf dn jt ng nh dp jx kw ni nj kb la nk nl kf le nm nn kj no bi translated">你也可以看看我下面的其他文章:</h2><p id="2997" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><a class="ae lv" href="http://Add a touch of Suspense to your web app with React.lazy()" rel="noopener ugc nofollow" target="_blank"> <em class="np">用React.lazy() </em> </a>为你的web app增添一丝悬念</p><p id="39b5" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated"><a class="ae lv" href="https://medium.com/@andricokaroulla/updated-for-apollo-v2-1-managing-local-state-with-apollo-d1882f2fbb7" rel="noopener"> <em class="np">如何使用Apollo全新的查询组件管理本地状态</em> </a></p><p id="d5a5" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated"><a class="ae lv" href="https://codeburst.io/no-need-to-wait-for-the-holidays-start-decorating-now-67b9dabd60d7" rel="noopener" target="_blank"> <em class="np">不用等到节假日，现在就开始装修</em> </a></p><p id="d691" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated"><a class="ae lv" rel="noopener ugc nofollow" target="_blank" href="/managing-local-state-with-apollo-client-3be522258645"> <em class="np">用阿波罗和高阶组件管理本地状态</em> </a></p><p id="8a08" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated"><a class="ae lv" href="https://medium.com/@andricokaroulla/the-react-conference-drinking-game-7a996bfbef3" rel="noopener"><em class="np">React大会喝酒游戏</em> </a></p><p id="4127" class="pw-post-body-paragraph kl km iq kn b ko lq kq kr ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li ij bi translated"><a class="ae lv" href="https://codeburst.io/develop-and-deploy-your-own-react-monorepo-app-in-under-2-hours-using-lerna-travis-and-now-2b140d647238" rel="noopener" target="_blank"> <em class="np">使用Lerna、Travis和现在的</em> </a>，在2小时内开发和部署您自己的React monorepo应用程序</p></div></div>    
</body>
</html>