<html>
<head>
<title>Real-time IoT Data Streaming from Old Smartphone</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">来自旧智能手机的实时物联网数据流</h1>
<blockquote>原文：<a href="https://itnext.io/real-time-iot-data-streaming-from-old-smartphone-e9fbee6ecc91?source=collection_archive---------2-----------------------#2020-08-26">https://itnext.io/real-time-iot-data-streaming-from-old-smartphone-e9fbee6ecc91?source=collection_archive---------2-----------------------#2020-08-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="9bd2" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated"><em class="iq">TL；博士，如果您正在寻找一个简单的项目来开始使用物联网，但没有适合您的硬件/传感器。使用</em> <a class="ae kp" href="https://kafka.apache.org/" rel="noopener ugc nofollow" target="_blank"> <em class="iq"> Kafka </em> </a> <em class="iq">流式传输android智能手机的传感器数据，并使用</em><a class="ae kp" href="https://www.elastic.co/what-is/elk-stack" rel="noopener ugc nofollow" target="_blank"><em class="iq">ELK stack</em></a><em class="iq">将传感器数据存储/可视化在dockerized容器</em>中</p></blockquote><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/303c810343b08c22d33743c31ff07372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q65VgcGoxj_P_yUuRYs4dQ.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">实时物联网数据流架构</figcaption></figure><p id="d84e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lg kd ke kf lh kh ki kj li kl km kn ko ij bi translated">这个项目背后的想法是监测智能手机的电池温度。我用我的一部旧android智能手机作为IP网络摄像头，它容易过热，所以我想监控温度。</p><p id="1abf" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lg kd ke kf lh kh ki kj li kl km kn ko ij bi translated">主要组件包括</p><ul class=""><li id="b20c" class="lj lk iq jt b ju jv jy jz lg ll lh lm li ln ko lo lp lq lr bi translated">物联网设备——智能手机传感器</li><li id="fd9e" class="lj lk iq jt b ju ls jy lt lg lu lh lv li lw ko lo lp lq lr bi translated">流水线— <a class="ae kp" href="https://kafka.apache.org/" rel="noopener ugc nofollow" target="_blank">阿帕奇卡夫卡</a></li><li id="ccca" class="lj lk iq jt b ju ls jy lt lg lu lh lv li lw ko lo lp lq lr bi translated">聚合/处理、存储和可视化— <a class="ae kp" href="https://www.elastic.co/what-is/elk-stack" rel="noopener ugc nofollow" target="_blank"> ELK堆栈</a></li></ul><blockquote class="jn jo jp"><p id="8e72" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">使用docker-compose对流管道和ELK堆栈进行docker化并运行</p></blockquote><h2 id="2fed" class="lx ly iq bd lz ma mb dn mc md me dp mf lg mg mh mi lh mj mk ml li mm mn mo mp bi translated">要求:</h2><ul class=""><li id="1b44" class="lj lk iq jt b ju mq jy mr lg ms lh mt li mu ko lo lp lq lr bi translated"><a class="ae kp" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank"> Docker引擎</a>版本19.03或更新</li><li id="412b" class="lj lk iq jt b ju ls jy lt lg lu lh lv li lw ko lo lp lq lr bi translated"><a class="ae kp" href="https://docs.docker.com/compose/install/" rel="noopener ugc nofollow" target="_blank"> Docker Compose </a>版本1.25.5或更新</li><li id="4c73" class="lj lk iq jt b ju ls jy lt lg lu lh lv li lw ko lo lp lq lr bi translated">3 GB内存分配给docker-engine</li><li id="263b" class="lj lk iq jt b ju ls jy lt lg lu lh lv li lw ko lo lp lq lr bi translated">Android操作系统2.3.3及以上版本的智能手机</li></ul><h2 id="5cc0" class="lx ly iq bd lz ma mb dn mc md me dp mf lg mg mh mi lh mj mk ml li mm mn mo mp bi translated"><strong class="ak">从物联网设备发送数据:</strong></h2><p id="c435" class="pw-post-body-paragraph jq jr iq jt b ju mq jw jx jy mr ka kb lg mv ke kf lh mw ki kj li mx km kn ko ij bi translated">要从智能手机收集和发送传感器数据，请安装playstore的<br/><a class="ae kp" href="https://play.google.com/store/apps/details?id=de.lorenz_fenster.sensorstreamgps&amp;hl=en" rel="noopener ugc nofollow" target="_blank">Sensorstream IMU+GPS</a>应用程序。安装后打开应用程序。</p><div class="kr ks kt ku gt ab cb"><figure class="my kv mz na nb nc nd paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><img src="../Images/462d1bd71a90ccdaa3a09b6e64e92174.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/format:webp/1*jiiaRWoA0QY-8VfoM8-44w.png"/></div></figure><figure class="my kv ne na nb nc nd paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><img src="../Images/539b59133faa9bad6f70b7cdde667822.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*cIQIx5QTEH2L-XMSPALi2A.png"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk nf di ng nh translated">注意:不要更改目标端口，UDP接收器期望数据流通过端口` 5555 '</figcaption></figure></div><p id="193d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lg kd ke kf lh kh ki kj li kl km kn ko ij bi translated">1)用运行Docker的机器的本地IP地址更新<code class="fe ni nj nk nl b">Target IP Address</code>。</p><p id="8a0f" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lg kd ke kf lh kh ki kj li kl km kn ko ij bi translated">2)选择<code class="fe ni nj nk nl b">UDP Stream</code>，因为我们不想在手机上存储数据的副本。</p><p id="a8f4" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lg kd ke kf lh kh ki kj li kl km kn ko ij bi translated">3)选中<code class="fe ni nj nk nl b">Run in Background</code>选项，使应用程序在最小化的同时继续发送数据。</p><p id="e53b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lg kd ke kf lh kh ki kj li kl km kn ko ij bi translated">4)切换到<code class="fe ni nj nk nl b">Toggle Sensors</code>部分并勾选<code class="fe ni nj nk nl b">Battery Temp.</code>复选框。<br/>您可以检查任何或所有其他传感器<a class="ae kp" href="https://github.com/Dineshkarthik/real-time-IoT-data-streaming/blob/master/kafka-producer/udp_to_kafka.py" rel="noopener ugc nofollow" target="_blank"> UDP接收器/Kafka-producer </a>被配置为处理所有可用的传感器数据。</p><p id="813c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lg kd ke kf lh kh ki kj li kl km kn ko ij bi translated">5)勾选<code class="fe ni nj nk nl b">Include User-Checked Sensor data into Stream</code>复选框。</p><p id="721c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lg kd ke kf lh kh ki kj li kl km kn ko ij bi translated">6)切换回<code class="fe ni nj nk nl b">Preferences</code>段，按<code class="fe ni nj nk nl b">Switch Stream</code>按钮开始数据流。</p><h2 id="21a1" class="lx ly iq bd lz ma mb dn mc md me dp mf lg mg mh mi lh mj mk ml li mm mn mo mp bi translated">处理和存储数据流:</h2><p id="a054" class="pw-post-body-paragraph jq jr iq jt b ju mq jw jx jy mr ka kb lg mv ke kf lh mw ki kj li mx km kn ko ij bi translated">使用以下命令克隆<a class="ae kp" href="https://github.com/Dineshkarthik/real-time-IoT-data-streaming" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a></p><pre class="kr ks kt ku gt nm nl nn no aw np bi"><span id="2d9a" class="lx ly iq nl b gy nq nr l ns nt">git clone https://github.com/Dineshkarthik/real-time-IoT-data-streaming</span></pre><p id="063e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lg kd ke kf lh kh ki kj li kl km kn ko ij bi translated">一旦项目被克隆，确保您的docker引擎正在运行，然后在项目路径中执行下面的命令来构建所需的docker映像并运行容器。</p><pre class="kr ks kt ku gt nm nl nn no aw np bi"><span id="ae7f" class="lx ly iq nl b gy nq nr l ns nt">cd real-time-IoT-data-streaming <br/>docker-compose up --build</span></pre><p id="646c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lg kd ke kf lh kh ki kj li kl km kn ko ij bi translated">根据你的网速，上面的命令需要花费一些时间来获取需要的docker镜像，同时构建Kafka-producer docker镜像。一旦所有需要的图像都准备好了，docker-compose将运行所有需要的docker容器。</p><ul class=""><li id="b1d8" class="lj lk iq jt b ju jv jy jz lg ll lh lm li ln ko lo lp lq lr bi translated">卡夫卡-制片人</li><li id="3ab6" class="lj lk iq jt b ju ls jy lt lg lu lh lv li lw ko lo lp lq lr bi translated">卡夫卡</li><li id="e067" class="lj lk iq jt b ju ls jy lt lg lu lh lv li lw ko lo lp lq lr bi translated">弹性搜索</li><li id="b40d" class="lj lk iq jt b ju ls jy lt lg lu lh lv li lw ko lo lp lq lr bi translated">Logstash</li><li id="6e3f" class="lj lk iq jt b ju ls jy lt lg lu lh lv li lw ko lo lp lq lr bi translated">基巴纳</li></ul><p id="41b3" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lg kd ke kf lh kh ki kj li kl km kn ko ij bi translated">所有容器启动并运行大约需要15-20秒。所有通过UDP流发送的传感器数据都由UDP接收方/Kafka-producer python脚本使用，并馈入名为— <code class="fe ni nj nk nl b">smartphone-sensor</code>的Kafka主题。这个话题被Logstash消费、处理、摄入到Elasticsearch中。Kibana连接到Elasticsearch，我们可以查询&amp;可视化传感器数据。</p><h2 id="73a7" class="lx ly iq bd lz ma mb dn mc md me dp mf lg mg mh mi lh mj mk ml li mm mn mo mp bi translated">聚合和可视化传感器数据:</h2><p id="18f7" class="pw-post-body-paragraph jq jr iq jt b ju mq jw jx jy mr ka kb lg mv ke kf lh mw ki kj li mx km kn ko ij bi translated">可以使用URL来访问ki Bana—<a class="ae kp" href="http://localhost:5601" rel="noopener ugc nofollow" target="_blank">http://localhost:5601</a></p><ul class=""><li id="b17b" class="lj lk iq jt b ju jv jy jz lg ll lh lm li ln ko lo lp lq lr bi translated">从上面的URL打开Kibana。第一次访问时，Kibana将提示<code class="fe ni nj nk nl b">Explore Sample Data</code>或<code class="fe ni nj nk nl b">Explore on my own</code>。选择后者——自己探索。</li><li id="ca26" class="lj lk iq jt b ju ls jy lt lg lu lh lv li lw ko lo lp lq lr bi translated">现在基巴纳将带你到主页。从主页使用左侧导航栏导航至<code class="fe ni nj nk nl b">Discover</code>部分。</li><li id="c255" class="lj lk iq jt b ju ls jy lt lg lu lh lv li lw ko lo lp lq lr bi translated">这里您必须创建一个索引模式，以便Kibana可以在Elasticsearch中识别数据源并使用它。在索引模式文本区域输入<code class="fe ni nj nk nl b">logstash-*</code>，现在您可以看到一条成功消息，表明有一个索引与模式匹配。点击<code class="fe ni nj nk nl b">Next Step</code>。</li></ul><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nu"><img src="../Images/b828050ae62388320a922544c5bb0b78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dhiekJIa9gzo9vTj9W0L0w.png"/></div></div></figure><ul class=""><li id="f674" class="lj lk iq jt b ju jv jy jz lg ll lh lm li ln ko lo lp lq lr bi translated">第二步是配置设置，对于<code class="fe ni nj nk nl b">Time Filter field name</code>，从下拉框中选择<code class="fe ni nj nk nl b">@timestamp</code>。点击<code class="fe ni nj nk nl b">Create index pattern</code>。</li></ul><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nu"><img src="../Images/b3af205b6e762aee6279af66213e2323.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-DGTZevLFD-Fvm216lEGlg.png"/></div></div></figure><ul class=""><li id="8720" class="lj lk iq jt b ju jv jy jz lg ll lh lm li ln ko lo lp lq lr bi translated">上面的代码将创建一个索引，可以在discover部分查询流中的数据。</li></ul><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nu"><img src="../Images/91392e2394d1238b5698de3214ff66de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*seZs8F0gJY8mHOMwzjtxUQ.png"/></div></div></figure><ul class=""><li id="817b" class="lj lk iq jt b ju jv jy jz lg ll lh lm li ln ko lo lp lq lr bi translated">现在让我们在Kibana中创建一些可视化图表来监控电池的温度。使用左侧导航栏导航至<code class="fe ni nj nk nl b">Visualize</code>部分(发现部分下方的一个部分)。</li><li id="542d" class="lj lk iq jt b ju ls jy lt lg lu lh lv li lw ko lo lp lq lr bi translated">点击<code class="fe ni nj nk nl b">Create Visualization</code>，提示您选择可视化类型。点击<code class="fe ni nj nk nl b">Line</code>图表。</li><li id="8062" class="lj lk iq jt b ju ls jy lt lg lu lh lv li lw ko lo lp lq lr bi translated">下一步将要求您在<code class="fe ni nj nk nl b">Choose Source</code>上点击<code class="fe ni nj nk nl b">logstash-*</code>索引图案。</li><li id="c2d4" class="lj lk iq jt b ju ls jy lt lg lu lh lv li lw ko lo lp lq lr bi translated">现在，您可以配置折线图。点击右侧数据选项卡下的<code class="fe ni nj nk nl b">Metrics</code>部分。选择<code class="fe ni nj nk nl b">Aggregation</code>为<code class="fe ni nj nk nl b">Average</code>，选择<code class="fe ni nj nk nl b">Field</code>为<code class="fe ni nj nk nl b">battery_temperature</code>。</li><li id="44ff" class="lj lk iq jt b ju ls jy lt lg lu lh lv li lw ko lo lp lq lr bi translated">要可视化时间序列数据，单击指标部分下方的<code class="fe ni nj nk nl b">Buckets</code>部分下的添加，选择<code class="fe ni nj nk nl b">X-axis</code>，选择<code class="fe ni nj nk nl b">Aggregation</code>作为<code class="fe ni nj nk nl b">Date Histogram</code>，然后单击更新。</li><li id="33de" class="lj lk iq jt b ju ls jy lt lg lu lh lv li lw ko lo lp lq lr bi translated">现在可以查看折线图了。也可以使用左上角的保存按钮保存该图表，以备后用。</li></ul><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nu"><img src="../Images/c01981b8c1058217e3ebf67afa2c818b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UC7im7Ft17pdoPn9GZDAkw.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">我的智能手机电池温度在10到15分钟内从30摄氏度上升到43摄氏度。我确实打开了很多应用程序来增加手机上的工作量，以显示具有增加趋势的图表。</figcaption></figure><p id="0e3e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lg kd ke kf lh kh ki kj li kl km kn ko ij bi translated">现在，您可以探索剩余的可用传感器数据，并尝试不同的用例。</p></div></div>    
</body>
</html>