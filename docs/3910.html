<html>
<head>
<title>OWASP Vulnerability Checks With Maven</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Maven进行OWASP漏洞检查</h1>
<blockquote>原文：<a href="https://itnext.io/owasp-dependency-check-maven-vulnerabilities-java-898a9cf99f5e?source=collection_archive---------1-----------------------#2020-03-24">https://itnext.io/owasp-dependency-check-maven-vulnerabilities-java-898a9cf99f5e?source=collection_archive---------1-----------------------#2020-03-24</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="e440" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">如何在Java构建中引入自动安全扫描</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/8f6c98b766de51e3711fe733f4a44386.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qiKffJuqtwyApPuz"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">由<a class="ae kz" href="https://unsplash.com/@michelbosma?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">米歇尔·博斯马</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="4948" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">虽然我们大多数人在开发项目时采取了积极的措施来防范已知的安全漏洞，但有一系列被动的行动和检查经常被忽视。</p><p id="89bb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">开放网络应用安全项目(<a class="ae kz" href="https://owasp.org/" rel="noopener ugc nofollow" target="_blank"> OWASP </a>)是一个致力于提高软件安全性的非营利性基金会。OWASP发布并维护了几个关于如何编写安全代码的建议，并得到了众多公司的支持，如Accenture、Adobe、Dell和Salesforce，它们在世界各地都有分支机构。</p><p id="e7e4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">OWASP运行的项目之一是<em class="lw"> OWASP依赖性检查</em>。<br/>依赖关系检查是一种软件组合分析(SCA)工具，它试图检测项目依赖关系中包含的公开披露的漏洞。它通过确定给定依赖项是否有公共平台枚举(CPE)标识符来实现这一点。如果找到，它将生成一个链接到相关CVE条目的报告。</p><p id="0e45" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这篇文章中，我将向您展示如何在您的Java/Maven项目中快速集成OWASP依赖检查。</p></div><div class="ab cl lx ly hy lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="in io ip iq ir"><h1 id="e4d9" class="me mf iu bd mg mh mi mj mk ml mm mn mo ka mp kb mq kd mr ke ms kg mt kh mu mv bi translated">依赖性检查器简介</h1><p id="397f" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">Dependency-Check执行的检查可能不是您希望在开发过程中执行的每一个构建上运行的，所以我们将把插件作为Maven概要文件来介绍:</p><pre class="kk kl km kn gu nb nc nd ne aw nf bi"><span id="5cbb" class="ng mf iu nc b gz nh ni l nj nk">&lt;profiles&gt;<br/>  &lt;profile&gt;<br/>    &lt;id&gt;owasp-dependency-check&lt;/id&gt;<br/>    &lt;build&gt;<br/>      &lt;plugins&gt;<br/>        &lt;plugin&gt;<br/>          &lt;groupId&gt;org.owasp&lt;/groupId&gt;<br/>          &lt;artifactId&gt;dependency-check-maven&lt;/artifactId&gt;<br/>          &lt;version&gt;${dependency-check-maven.version}&lt;/version&gt;<br/>          &lt;executions&gt;<br/>            &lt;execution&gt;<br/>              &lt;goals&gt;<br/>                &lt;goal&gt;check&lt;/goal&gt;<br/>              &lt;/goals&gt;<br/>            &lt;/execution&gt;<br/>          &lt;/executions&gt;<br/>        &lt;/plugin&gt;<br/>      &lt;/plugins&gt;<br/>    &lt;/build&gt;<br/>  &lt;/profile&gt;<br/>&lt;/profiles&gt;</span></pre><p id="c84d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">对于上面的代码片段，您需要将插件的版本定义为Maven属性:</p><pre class="kk kl km kn gu nb nc nd ne aw nf bi"><span id="4ba2" class="ng mf iu nc b gz nh ni l nj nk">&lt;properties&gt;<br/>  &lt;dependency-check-maven.version&gt;5.3.0&lt;/dependency-check-maven.version&gt;<br/>&lt;/properties&gt;</span></pre><p id="d166" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您现在可以通过发出:<br/> <code class="fe nl nm nn nc b">mvn clean install -Powasp-dependency-check</code>来调用您的构建中的检查</p><p id="7add" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">由于这是您第一次运行依赖性检查，因此需要一些时间来获取漏洞数据库并将其存储在您的本地环境中。这可能需要5-15分钟(取决于您的互联网连接速度)，但它只会发生一次。后续的构建只会获取更新，因此速度会快很多。</p><p id="a041" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在Maven输出的末尾，您应该会看到漏洞分析的输出:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj no"><img src="../Images/0d55120ed2358e0d29c3e0dc1f49c384.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gYBEvPBVf-BVSH0oaCSwlg.png"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">空项目的分析输出(图片由作者提供)</figcaption></figure><p id="e9ee" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">显然，分析没有发现任何漏洞，因为没有外部依赖(除了<code class="fe nl nm nn nc b">owasp-dependency-check</code>本身)被引入到项目中。</p><p id="7173" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">是时候引入一些易受攻击的代码了。</p></div><div class="ab cl lx ly hy lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="in io ip iq ir"><h1 id="a2cb" class="me mf iu bd mg mh mi mj mk ml mm mn mo ka mp kb mq kd mr ke ms kg mt kh mu mv bi translated">引入易受攻击的代码</h1><p id="1ae8" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">依赖性检查的漏洞的主要来源是国家漏洞数据库(<a class="ae kz" href="https://nvd.nist.gov/" rel="noopener ugc nofollow" target="_blank"> NVD </a>)。让我们浏览一下<a class="ae kz" href="https://nvd.nist.gov/vuln/search/results?form_type=Basic&amp;results_type=overview&amp;query=spring&amp;search_type=all" rel="noopener ugc nofollow" target="_blank"> Spring相关报告</a>的公开常见漏洞和暴露(CVE)列表:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj np"><img src="../Images/aed8945ecc5a5e94a1a19f42c6ef0542.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*83WIQOnWi041u0zDuqW3eQ.png"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">匹配NVD的简历(图片由作者提供)</figcaption></figure><p id="781e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">可供选择的有很多，那就挑一个介绍到我们的<code class="fe nl nm nn nc b">pom.xml</code>里吧。我们要去的是Spring Core Maven artefact，版本5.0.1，2017年发布:</p><pre class="kk kl km kn gu nb nc nd ne aw nf bi"><span id="63e7" class="ng mf iu nc b gz nh ni l nj nk">&lt;dependencies&gt;<br/>  &lt;dependency&gt;<br/>    &lt;groupId&gt;org.springframework&lt;/groupId&gt;<br/>    &lt;artifactId&gt;spring-core&lt;/artifactId&gt;<br/>    &lt;version&gt;5.0.1.RELEASE&lt;/version&gt;<br/>  &lt;/dependency&gt;<br/>&lt;/dependencies&gt;</span></pre><p id="38a6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">用<code class="fe nl nm nn nc b">mvn clean install -Powasp-depency-check</code>重新构建我们的代码:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nq"><img src="../Images/36e13044c4ef917bdc690b127af44ae6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ba_jIF99MyMLV3ethlznLA.png"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">Maven构建期间报告的来自NVD的Spring依赖项的CVEs(图片由作者提供)</figcaption></figure><p id="fb03" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">依赖性检查插件成功地识别了我们在Maven中引入的Spring依赖性，并报告了关于它的已知漏洞。但是，项目的构建继续进行并成功结束。如果我们要求不允许构建易受攻击的代码，该怎么办？</p><p id="5830" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">接下来让我们看看如果找到CVE，如何使构建失败。</p></div><div class="ab cl lx ly hy lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="in io ip iq ir"><h1 id="95d6" class="me mf iu bd mg mh mi mj mk ml mm mn mo ka mp kb mq kd mr ke ms kg mt kh mu mv bi translated">存在漏洞时停止构建</h1><p id="2d26" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">对特定漏洞的严重性进行分类是一个复杂的过程。对于那些想知道漏洞评分是如何实现的人，维基百科上有一个有趣的页面，关于<a class="ae kz" href="https://en.wikipedia.org/wiki/Common_Vulnerability_Scoring_System" rel="noopener ugc nofollow" target="_blank">通用漏洞评分系统</a> (CVSS)。总之，CVE的分数是根据一个公式计算出来的，这个公式依赖于几个衡量漏洞利用难易程度和影响的指标。分数范围从0到10，10表示最严重的漏洞。</p><p id="6442" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可以利用依赖项检查插件中的评分系统来配置Maven，以便在发现CVE大于特定分数时使构建失败。如果您不知道什么样的确切分数适合您的项目，一个好的起点是任何大于或等于7的分数(表示高或严重的漏洞)。</p><p id="1175" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要将构建断路器引入到您的项目中，您需要在项目的<code class="fe nl nm nn nc b">pom.xml</code>中添加一个配置节来修改插件，如下所示:</p><pre class="kk kl km kn gu nb nc nd ne aw nf bi"><span id="f588" class="ng mf iu nc b gz nh ni l nj nk">&lt;configuration&gt;<br/>   &lt;failBuildOnCVSS&gt;7&lt;/failBuildOnCVSS&gt;<br/>&lt;/configuration&gt;</span></pre><p id="80cb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们尝试使用易受攻击的Spring依赖项来重新构建测试项目:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nr"><img src="../Images/8c106d86c713ce49595719fc55f62d05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3HidZnqDOFyyRg0iNvyKJw.png"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">CVSS ≥7的构建失败(图片由作者提供)</figcaption></figure><p id="e249" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这一次构建失败了。Maven还通知我们，有一个或多个依赖项没有达到CVSS &lt; 7的阈值指标。</p></div><div class="ab cl lx ly hy lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="in io ip iq ir"><h1 id="9736" class="me mf iu bd mg mh mi mj mk ml mm mn mo ka mp kb mq kd mr ke ms kg mt kh mu mv bi translated">生成HTML报告</h1><p id="0ccd" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">如果您喜欢在浏览器而不是CLI中浏览检测到的漏洞，依赖项检查会在名为<code class="fe nl nm nn nc b">dependency-check-report.html</code>的<code class="fe nl nm nn nc b">target</code>文件夹中创建一个HTML报告:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ns"><img src="../Images/f91dbc847698d917e4bd32685b3ed354.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a62gRjPDW3EvURo3tzb-3A.png"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">您的漏洞的HTML报告(图片由作者提供)</figcaption></figure><p id="58f7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">该报告包含了大量的信息，并链接到NVD以获取更多的详细信息。</p></div><div class="ab cl lx ly hy lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="in io ip iq ir"><h1 id="a7d2" class="me mf iu bd mg mh mi mj mk ml mm mn mo ka mp kb mq kd mr ke ms kg mt kh mu mv bi translated">排除误报</h1><p id="6c60" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">由于依赖性检查插件识别组件的方式和NVD中的组件命名约定，您可能偶尔会得到误报。</p><p id="0883" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要排除误报，请打开HTML报告，找到您需要的漏洞，然后单击<code class="fe nl nm nn nc b">suppress</code>链接(步骤1)。要抑制误报，您需要创建一个包含抑制列表的XML文件，并将其传递到依赖检查插件的配置选项中。如果您还没有为您的项目创建这样一个文件，首先选择<code class="fe nl nm nn nc b">Complete XML Doc option</code>(步骤2)并复制建议的XML文本(步骤3):</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nt"><img src="../Images/79584bb8e2f2e91d0c617de08bb3656b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VY3dV01gigCVhvIMfX2Sog.png"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">排除误报(图片由作者提供)</figcaption></figure><p id="9c93" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您现在需要创建一个新文件，可以随意命名，并将复制的XML内容粘贴到。接下来，通过在依赖项检查插件上添加一个配置选项，修改Maven配置以引用该文件，例如:</p><p id="9c47" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe nl nm nn nc b">&lt;excludes&gt;owasp-dc-exclude.xml&lt;/excludes&gt;</code>。</p><p id="aad1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">未来的抑制可以通过在<code class="fe nl nm nn nc b">&lt;suppressions&gt;&lt;/&lt;suppressions&gt;</code>标签之间插入新元素来添加。</p></div><div class="ab cl lx ly hy lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="in io ip iq ir"><h1 id="9aed" class="me mf iu bd mg mh mi mj mk ml mm mn mo ka mp kb mq kd mr ke ms kg mt kh mu mv bi translated">结论</h1><p id="8428" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">源代码漏洞对您的项目是一个非常现实的威胁。除非您有一个自动监控项目漏洞的系统，否则很可能在某个时候您会引入一个易受攻击的第三方依赖项。</p><p id="7d96" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">将依赖性检查插件扫描器引入到Maven项目中只需要几分钟，而且完全不会干扰到您可能正在使用的任何东西。我建议你今天多花几分钟，修改你的<code class="fe nl nm nn nc b">pom.xml</code>来包含它。我保证您会对您可能发现的许多以前未发现的漏洞印象深刻。</p><p id="5ba0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">感谢您阅读这篇文章。希望下一部能见到你。</p></div></div>    
</body>
</html>