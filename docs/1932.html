<html>
<head>
<title>Apache Solr: Because your Database is not a Search Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Apache Solr:因为你的数据库不是搜索引擎</h1>
<blockquote>原文：<a href="https://itnext.io/apache-solr-because-your-database-is-not-a-search-engine-57705352df8a?source=collection_archive---------0-----------------------#2019-02-26">https://itnext.io/apache-solr-because-your-database-is-not-a-search-engine-57705352df8a?source=collection_archive---------0-----------------------#2019-02-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="a8c6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本帖中，我们将从MongoDB等传统数据库中考察Apache Solr作为搜索引擎的独特之处。我们将通过分析一系列比较查询来探讨Solr和MongoDB之间的异同。然后，我们将深入研究Solr的一些更高级的搜索功能。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/32bf3f12324b57a0888ca121a03fe5aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I-4Z6U-khl5JGr_yuQITRA.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><em class="le">版权:</em> <a class="ae lf" href="https://www.123rf.com/profile_varijanta" rel="noopener ugc nofollow" target="_blank"> <em class="le">德扬博济奇</em></a><em class="le">(</em><a class="ae lf" href="https://www.123rf.com/" rel="noopener ugc nofollow" target="_blank"><em class="le">123 RF</em></a><em class="le">)</em></figcaption></figure><h1 id="c758" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">为什么要搜索？</h1><p id="44fe" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">搜索信息的能力是许多应用程序的基本要求。局限于传统数据库的架构师和开发人员经常试图通过创建不必要的、过于复杂的基于SQL查询的解决方案来满足搜索需求。它们迫使终端用户以不自然或高度结构化的方式进行搜索，或者提供缺乏相关性的结果。最终用户不是数据库管理员，他们不理解SQL的细微差别，他们只是希望他们的查询得到相关的响应。</p><p id="72e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在数据消费者任意搜索特定领域内的相关信息的场景中，为reads实现一个搜索优化的、基于Lucene的平台，如<a class="ae lf" href="https://www.elastic.co/products/elasticsearch" rel="noopener ugc nofollow" target="_blank"> Elasticsearch </a>或<a class="ae lf" href="https://lucene.apache.org/solr" rel="noopener ugc nofollow" target="_blank"> Apache Solr </a>，通常是一个有效的解决方案。</p><p id="515d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将数据库读取与写入分离并不罕见。我曾经参与过许多项目，这些项目的需求提出了一种架构，其中应该实现一种类型的数据存储技术来优化写操作，而应该实现不同类型的数据存储技术来优化读操作。这种情况很常见的架构包括以下几种。</p><ul class=""><li id="e71d" class="mj mk it js b jt ju jx jy kb ml kf mm kj mn kn mo mp mq mr bi translated">CQRS(命令查询责任分离)和事件源；</li><li id="6079" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">报告、数据分析和大数据；</li><li id="f946" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">ML(机器学习)和AI(人工智能)；</li><li id="1c02" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">实时和流数据(如物联网)；</li><li id="ec51" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">搜索:内容、文档、知识；</li></ul><p id="9588" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这篇文章中，我们将研究Apache Solr的搜索能力。我们将比较Solr和领先的NoSQL数据库MongoDB的搜索能力。我们将考虑查询数据和搜索信息之间的区别。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/2048afa83a5f4475b7c0d5f15b4df613.png" data-original-src="https://miro.medium.com/v2/resize:fit:458/0*rIRmoHvOnVHGEn8t"/></div></figure><h1 id="bb8e" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">阿帕奇Lucene</h1><p id="3aed" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">据Apache介绍，<a class="ae lf" href="http://lucene.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache Lucene </a>项目开发开源搜索软件，包括以下子项目:Lucene Core、Solr和PyLucene。Lucene核心子项目提供了基于Java的索引和搜索技术，以及拼写检查、点击突出显示和高级分析/标记化功能。</p><p id="ad2c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Apache Lucene 7.7.0和Apache Solr 7.7.0是<a class="ae lf" href="http://lucene.apache.org/" rel="noopener ugc nofollow" target="_blank">在2019年2月刚刚发布的</a>，并用于所有帖子的示例。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi my"><img src="../Images/14640201c51614084850553a6915b891.png" data-original-src="https://miro.medium.com/v2/resize:fit:318/0*fSKtd5S6HAptRJWb"/></div></figure><h1 id="38e4" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">阿帕奇索尔</h1><p id="1d3e" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">据Apache称，<a class="ae lf" href="https://lucene.apache.org/solr" rel="noopener ugc nofollow" target="_blank"> Apache Solr </a>是一个流行的、速度极快的、开源的企业搜索平台，构建在<a class="ae lf" href="http://lucene.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache Lucene </a>之上。Solr为许多世界上最大的互联网网站的搜索和导航功能提供了动力。</p><p id="ba2c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Apache <a class="ae lf" href="https://en.wikipedia.org/wiki/Apache_Solr" rel="noopener ugc nofollow" target="_blank"> Solr </a>包括建立Solr服务器集群的能力，该集群结合了容错和高可用性。这些功能被称为<a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/solrcloud.html" rel="noopener ugc nofollow" target="_blank"> SolrCloud </a>，由<a class="ae lf" href="https://zookeeper.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache Zookeeper </a>提供支持，提供分布式、分片和复制的索引和搜索功能。</p><p id="b964" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">根据维基百科，Solr于2004年在CNET网络公司创立，2006年捐赠给阿帕奇软件基金会，2007年从他们的孵化器毕业。Solr版本发布于2008年。2010年，<a class="ae lf" href="https://en.wikipedia.org/wiki/Lucene" rel="noopener ugc nofollow" target="_blank"> Lucene </a>和Solr项目合并；Solr成为了Lucene的子项目。随着Apache Solr 7.7.0的发布，Solr已经有了十多年的开发和企业采用经验。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/d7c521c068b2e29632e5546c3b6e5e78.png" data-original-src="https://miro.medium.com/v2/resize:fit:420/0*DM3Ny7g_fbU-kiBH"/></div></figure><h1 id="f5a4" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">MongoDB</h1><p id="1c8a" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">领先的NoSQL数据库<a class="ae lf" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>将自己描述为一个文档数据库，它具有用户需要的查询和索引所需的可伸缩性和灵活性。Mongo的特性包括即席查询、索引和实时聚合，为访问和分析数据提供了强大的方法。</p><p id="4a48" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不到一年前发布的<a class="ae lf" href="https://www.mongodb.com/collateral/mongodb-40-whats-new" rel="noopener ugc nofollow" target="_blank"> MongoDB 4.0 </a>增加了多文档ACID事务、数据类型转换、非阻塞辅助副本读取、SHA-2认证、MongoDB Compass聚合管道构建器、Kubernetes集成和MongoDB Stitch无服务器平台。MongoDB 4.0.6是<a class="ae lf" href="https://docs.mongodb.com/manual/release-notes/4.0/#feb-7-2019" rel="noopener ugc nofollow" target="_blank">在2019年2月刚刚发布的</a>，并用于所有帖子的示例。</p><h1 id="bd8f" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">比较搜索功能</h1><p id="9c3a" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">Solr和MongoDB似乎有许多与搜索相关的共同特性。</p><ul class=""><li id="30a1" class="mj mk it js b jt ju jx jy kb ml kf mm kj mn kn mo mp mq mr bi translated">Solr和MongoDB都是<strong class="js iu">基于文档的</strong>数据存储；</li><li id="9a35" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">Solr和MongoDB都使用了<strong class="js iu">非关系型</strong>数据模型；</li><li id="55cd" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">两者都具有先进的<strong class="js iu">查询和索引</strong>功能；</li><li id="4758" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">Solr实现了基于Lucene的搜索功能；MongoDB具有基于文本的搜索能力；</li><li id="9b72" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">Solr使用Lucene评分算法对搜索结果的<strong class="js iu">相关性</strong>进行评分；MongoDB能够使用$meta操作符对<strong class="js iu">文本搜索结果进行排序；</strong></li><li id="9d6c" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">Solr能够<strong class="js iu">在计算分数时有选择地提升</strong>搜索字段和字段中特定值的相对重要性；MongoDB能够提高使用文本索引的文本搜索中使用的字段的相对重要性；</li><li id="362c" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">Solr和MongoDB都能够实现<strong class="js iu">停用词</strong>、<strong class="js iu">词干</strong>和<strong class="js iu">标记化</strong>；</li></ul><h1 id="b8a6" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">源代码示例</h1><p id="bb87" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">本文中展示的所有示例都可以作为一系列Python 3脚本获得，包含在GitHub上的一个开源项目中，<a class="ae lf" href="https://github.com/garystafford/searching-solr-vs-mongodb" rel="noopener ugc nofollow" target="_blank">searching-Solr-vs-MongoDB</a>。该项目包含脚本<a class="ae lf" href="https://github.com/garystafford/searching-solr-vs-mongodb/blob/master/query_mongo.py" rel="noopener ugc nofollow" target="_blank"> query_mongo.py </a>，它使用MongoDB的Python驱动程序<a class="ae lf" href="https://pypi.org/project/pymongo/" rel="noopener ugc nofollow" target="_blank"> pymongo </a>，来执行本文中的所有MongoDB查询。该项目还包含脚本<a class="ae lf" href="https://github.com/garystafford/searching-solr-vs-mongodb/blob/master/query_solr.py" rel="noopener ugc nofollow" target="_blank"> query_solr.py </a>，它使用Apache solr的轻量级Python包装器<a class="ae lf" href="https://pypi.org/project/pysolr/3.8.1/" rel="noopener ugc nofollow" target="_blank"> pysolr </a>，来执行本文中的所有Solr搜索。这两个软件包以及辅助软件包都可以用pip安装。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="85c3" class="nf lh it nb b gy ng nh l ni nj">pip3 install pysolr pymongo bson.json_util requests</span></pre><h1 id="6e5e" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">MongoDB和Solr实例</h1><p id="a7ed" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">为了跟进，您将需要自己的MongoDB和Solr实例。使用官方的<a class="ae lf" href="https://hub.docker.com/_/mongo" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>和<a class="ae lf" href="https://hub.docker.com/_/solr" rel="noopener ugc nofollow" target="_blank"> Solr </a> Docker Hub镜像，两者都可以很容易地在Docker上实现。示例<code class="fe nk nl nm nb b">docker run</code>命令如下所示。</p><p id="f7a6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第二个命令Solr命令也创建了一个新的Solr <a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/solr-cores-and-solr-xml.html" rel="noopener ugc nofollow" target="_blank">内核</a>。该命令还将本地项目中的“conf”目录绑定到容器中。这将使我们能够修改索引的配置，并将配置存储在源代码控制中。所有数据都是短暂的，使用这些特定的命令，两个容器都不会将数据保存在容器之外。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="61e4" class="nf lh it nb b gy ng nh l ni nj">docker run --name mongo -p 27017:27017 -d mongo:latest</span><span id="1325" class="nf lh it nb b gy nn nh l ni nj">docker run --name solr -d \<br/>  -p 8983:8983 \<br/>  -v $PWD/conf:/conf \<br/>  solr:latest \<br/>  solr-create -c movies -d /conf</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi no"><img src="../Images/584d4e60377587d11cca951d66e727d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*xJYCBwMppRl4kR6D"/></div></div></figure><h1 id="9730" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">环境变量</h1><p id="67ec" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">源代码需要两个环境变量，它们包含MongoDB和Solr的连接信息。如果下面的值与Docker中使用的示例不同，您需要用自己的连接字符串替换它们。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="f22b" class="nf lh it nb b gy ng nh l ni nj">export SOLR_URL="http://localhost:8983/solr"<br/>export MONOGDB_CONN="mongodb://localhost:27017/movies"</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi no"><img src="../Images/0bdc509ecd61e9a33052b8c271ea1bf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*FnAvgkKgFJHRJY9U"/></div></div></figure><h1 id="6de6" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">将电影导入到MongoDB</h1><p id="cdaf" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">在这篇文章中，我们将使用MongoDB上公开的电影数据集。数据集的副本在项目中可用，在MongoDB的网站上也可用，<a class="ae lf" href="https://docs.mongodb.com/charts/master/tutorial/movie-details/prereqs-and-import-data/#download-the-data" rel="noopener ugc nofollow" target="_blank">设置并导入数据</a>。</p><p id="f089" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">假设您有一个可访问的MongoDB实例，并设置了上面的两个环境变量，使用下面的<code class="fe nk nl nm nb b">mongoimport</code>命令将MongoDB的特殊格式的JSON文件<a class="ae lf" href="https://github.com/garystafford/searching-solr-vs-mongodb/blob/master/data/movieDetails_mongo.json" rel="noopener ugc nofollow" target="_blank"> moviesDetails_mongo.json </a>直接导入到movie数据库的movieDetails集合中。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="d16b" class="nf lh it nb b gy ng nh l ni nj">mongoimport \<br/>  --uri $MONOGDB_CONN \<br/>  --collection "movieDetails" \<br/>  --drop --file "data/movieDetails_mongo.json"</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi no"><img src="../Images/00948e89e87fd853eca8d15ea32468a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*2yq_gXoeer57FfRb"/></div></div></figure><p id="ddca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是运行在Docker容器中的电影数据库的movieDetails集合的视图，如<a class="ae lf" href="https://www.mongodb.com/products/compass" rel="noopener ugc nofollow" target="_blank"> MongoDB Compass </a>应用程序所示。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi no"><img src="../Images/840fc8dc4406591af46da8b93e0cf007.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*yLEJE_qhDylnHD2O"/></div></div></figure><h1 id="8b2e" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">将电影索引到Solr</h1><p id="8336" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">假设您有一个可访问的Solr实例，并设置了上面的两个环境变量，通过运行Python脚本<a class="ae lf" href="https://github.com/garystafford/searching-solr-vs-mongodb/blob/master/solr_index_movies.py" rel="noopener ugc nofollow" target="_blank"> solr_index_movies.py </a>，使用以下命令导入JSON文件<a class="ae lf" href="https://github.com/garystafford/searching-solr-vs-mongodb/blob/master/data/movieDetails.json" rel="noopener ugc nofollow" target="_blank"> movieDetails.json </a>的内容。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="35f6" class="nf lh it nb b gy ng nh l ni nj">python3 ./solr_index_movies.py</span></pre><p id="49ad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该命令执行一系列对Solr公开的RESTful API的HTTP调用。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi no"><img src="../Images/41d8c879e1859075947168e33fc5032c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*V3dD2v6OFMl3TzIy"/></div></div></figure><p id="e934" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是在Docker容器中运行的<a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/overview-of-the-solr-admin-ui.html" rel="noopener ugc nofollow" target="_blank"> Solr管理用户界面</a>的视图，显示了新电影<a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/solr-cores-and-solr-xml.html" rel="noopener ugc nofollow" target="_blank">核心</a>。运行脚本后，我们应该有2，250个电影文档被索引。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi no"><img src="../Images/1640a587c55853910e3e0f1cb19bfb78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*Qx3I1zutYL2t8VC3"/></div></div></figure><p id="03ac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr Admin UI提供了许多有用的工具，用于检查索引、检查模式和<a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/field-types-included-with-solr.html#field-types-included-with-solr" rel="noopener ugc nofollow" target="_blank">字段类型</a>，以及创建、分析和调试Solr查询。下面我们看到显示查询结果的查询界面。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi no"><img src="../Images/199bfb0fea26b7a4aea7e51847164ed1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*yvU25hk1BnoeoZM2"/></div></div></figure><h1 id="b0e5" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">调整Solr指数</h1><p id="06f3" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">电影索引使用默认模式，该模式是在对电影文档进行索引时创建的。为了优化我们的查询结果，我们需要对默认的movies模式进行一些调整。首先，我们希望确保我们的Solr搜索考虑单词的复数形式。例如，当我们搜索搜索词' adventure '时，我们希望Solr也返回包含诸如Adventure、adventures、adventuring和adventurer等词的文档，但不返回misadventure。这就是所谓的<a class="ae lf" href="https://en.wikipedia.org/wiki/Stemming" rel="noopener ugc nofollow" target="_blank">词干</a>，或者将单词缩减为它们的<a class="ae lf" href="https://en.wikipedia.org/wiki/Word_stem" rel="noopener ugc nofollow" target="_blank">词干</a>。Solr分析用户界面中显示了一个例子。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi no"><img src="../Images/bfd7fc8a2a6151b9c1c359f40b5ec879.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*Q2AEuSCNfgfYmQLq"/></div></div></figure><p id="212e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们想要搜索的字段，例如标题、情节和流派，默认情况下都被索引为“text _ general”Solr字段类型。“text_general”字段类型在索引或查询时不实现词干。我们需要将标题、情节和类型字段切换到“text_en”(英文文本)字段类型。“text_en”字段类型实现了多个索引和查询过滤器，包括<a class="ae lf" href="https://wiki.apache.org/solr/LanguageAnalysis#Notes_about_solr.PorterStemFilterFactory" rel="noopener ugc nofollow" target="_blank"> PorterStemFilterFactory </a>过滤器，它从单词中删除常见的结尾。类似的过滤器包括<a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/filter-descriptions.html#english-minimal-stem-filter" rel="noopener ugc nofollow" target="_blank">英语最小词干过滤器</a>和<a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/filter-descriptions.html#english-possessive-filter" rel="noopener ugc nofollow" target="_blank">英语所有格过滤器</a>。</p><p id="9043" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，Solr中这些字段的<a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/defining-fields.html#optional-field-type-override-properties" rel="noopener ugc nofollow" target="_blank">多值</a>字段属性默认设置为<code class="fe nk nl nm nb b">true</code>。由于标题和绘图字段以及其他字段只打算保存一个文本值，而不是一个值数组，我们将把<code class="fe nk nl nm nb b">MultiValued</code>字段属性切换到<code class="fe nk nl nm nb b">false</code>。这有助于排序和过滤，以及文档的正确反序列化。</p><p id="fe8a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">solr_index_movies.py脚本会将标题、情节和流派字段从text_general '更改为text_en '并将标题和情节字段从多值更改为单值。由于我们已经更改了索引的模式，脚本将在模式更改后重新导入所有文档。</p><p id="050b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了更好地理解模式变化是什么样子，让我们看一下改变模式的等效cURL命令。这让您更好地了解我们正在进行的现场级修改。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="32b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以使用模式UI来查看结果，如下所示。请注意标题、情节和类型的新字段类型。另外，请注意“text_en”字段类型使用的索引和查询分析器，包括PorterStemFilterFactory。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi no"><img src="../Images/a6e4ef132a376ac76ba5bd90bd15c3fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*G4exb0FXBj5CB22y"/></div></div></figure><h1 id="3c6f" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">比较查询</h1><p id="50ca" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">为了展示Solr和MongoDB之间的相似之处和不同之处，我们将检查一系列比较查询，然后是一系列Solr专用搜索。同样，所有显示的查询和输出都包含在两个项目的Python脚本中。您可以在Solr查询UI中输入每个查询的参数。</p><h2 id="d580" class="nf lh it bd li nr ns dn lm nt nu dp lq kb nv nw lu kf nx ny ly kj nz oa mc ob bi translated">查询1a:所有文档</h2><p id="c66c" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">首先，我们将对MongoDB集合中的所有电影文档执行一个简单的查询，然后是Solr索引。对于MongoDB，我们使用<a class="ae lf" href="https://docs.mongodb.com/manual/reference/method/db.collection.find/index.html" rel="noopener ugc nofollow" target="_blank">查找方法</a>。对于Solr，我们将使用<a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/the-standard-query-parser.html#the-standard-query-parser" rel="noopener ugc nofollow" target="_blank">标准查询解析器</a>，通常称为'<em class="oc"> lucene </em>'查询解析器，以及<code class="fe nk nl nm nb b">q</code> (query)参数。查询的结果应该是相同的，返回所有2，250个文档。</p><p id="fd91" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">MongoDB:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="d932" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>query: {}<br/>  <br/>Results<br/>----------<br/>document count: 2250</span></pre><p id="00d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="0d3c" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>q: *:*<br/>kwargs: {}<br/>  <br/>Results<br/>----------<br/>document count: 2250</span></pre><h2 id="4ff5" class="nf lh it bd li nr ns dn lm nt nu dp lq kb nv nw lu kf nx ny ly kj nz oa mc ob bi translated">查询1b:仅计数</h2><p id="4f09" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">我们可以修改第一个查询，将我们的响应限制为MongoDB中给定查询的文档数；不退还任何文件。因为我们的查询是空的，所以我们将获得MongoDB数据库集合中所有文档的计数。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="5b49" class="nf lh it nb b gy ng nh l ni nj">db.movieDetails.count()</span></pre><p id="0fab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">类似地，在Solr中，我们可以将<code class="fe nk nl nm nb b">rows</code>参数设置为零，只返回文档数。为了简洁，我们也可以使用<code class="fe nk nl nm nb b">omitHeader</code>参数省略Solr响应头。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="a066" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>q: *:*<br/>kwargs: {'omitHeader': 'true', 'rows': '0'}</span><span id="9393" class="nf lh it nb b gy nn nh l ni nj">Results<br/>----------<br/>document count: 2250</span></pre><h2 id="e1bb" class="nf lh it bd li nr ns dn lm nt nu dp lq kb nv nw lu kf nx ny ly kj nz oa mc ob bi translated">查询2:精确搜索</h2><p id="a1a0" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">接下来，我们将在MongoDB中查询电影的确切名称“星球大战:第五集——帝国反击战”，然后是Solr。同样，查询的结果应该是相同的，返回一个与标题匹配的文档。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi no"><img src="../Images/3619cbc28ccd27b1b6a851493704ca14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*h8-N6xNkRgNojtdH"/></div></div></figure><p id="6b8d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">MongoDB:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="c1d2" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>query: {'title': 'Star Wars: Episode V - The Empire Strikes Back'}<br/>projection: {'_id': 0, 'title': 1}<br/>  <br/>Results<br/>----------<br/>document count: 1<br/>{'title': 'Star Wars: Episode V - The Empire Strikes Back'}</span></pre><p id="cedc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">标题周围的引号是Solr将查询视为单个短语而不是一系列搜索词的关键。</p><p id="9b48" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="6d1b" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>q: title:"Star Wars: Episode V - The Empire Strikes Back"<br/>kwargs: {<br/>  'defType': 'lucene', <br/>  'fl': 'title, score'<br/>}<br/>  <br/>Results<br/>----------<br/>document count: 1<br/>{'title': 'Star Wars: Episode V - The Empire Strikes Back', 'score': 29.41}</span></pre><p id="031b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意<code class="fe nk nl nm nb b">'defType': 'lucene'</code>的使用是可选的。标准的Lucene查询解析器是Solr使用的默认解析器。我展示这个参数只是为了提高读者的理解。稍后，我们将使用其他查询解析器。</p><h2 id="3636" class="nf lh it bd li nr ns dn lm nt nu dp lq kb nv nw lu kf nx ny ly kj nz oa mc ob bi translated">查询3:搜索短语</h2><p id="342f" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">接下来，我们将对短语“星球大战”进行查询。对于MongoDB，我们将使用<code class="fe nk nl nm nb b">$regex</code>和<code class="fe nk nl nm nb b">$options</code> <a class="ae lf" href="https://docs.mongodb.com/manual/reference/operator/query/regex/" rel="noopener ugc nofollow" target="_blank">评估查询操作符</a>。MongoDB和Solr查询的结果应该是相同的，返回六部星球大战电影。</p><p id="b009" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">MongoDB:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="6d0d" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>query: {<br/>  'title': {'$regex': '\\bstar wars\\b', <br/>  '$options': 'i'}<br/>}<br/>projection: {'_id': 0, 'title': 1}<br/>  <br/>Results<br/>----------<br/>document count: 6<br/>{'title': 'Star Wars: Episode I - The Phantom Menace'}<br/>{'title': 'Star Wars: Episode II - Attack of the Clones'}<br/>{'title': 'Star Wars: Episode III - Revenge of the Sith'}<br/>{'title': 'Star Wars: Episode IV - A New Hope'}<br/>{'title': 'Star Wars: Episode V - The Empire Strikes Back'}<br/>{'title': 'Star Wars: Episode VI - Return of the Jedi'}</span></pre><p id="7d90" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用Solr，将短语“star wars”括在引号中可以确保Solr将查询字符串视为一个精确的短语，而不是单个的搜索词。Solr的结果被评分，但分数几乎都是一样的，因为所有六部电影都包含完全相同的短语。</p><p id="16e4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="0d78" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>q: "star wars"<br/>kwargs: {<br/>  'defType': 'lucene', <br/>  'df': 'title', <br/>  'fl': 'title, score'<br/>}<br/>  <br/>Results<br/>----------<br/>document count: 6<br/>{'title': 'Star Wars: Episode VI - Return of the Jedi', 'score': 8.21}<br/>{'title': 'Star Wars: Episode II - Attack of the Clones', 'score': 8.21}<br/>{'title': 'Star Wars: Episode IV - A New Hope', 'score': 8.21}<br/>{'title': 'Star Wars: Episode I - The Phantom Menace', 'score': 8.21}<br/>{'title': 'Star Wars: Episode III - Revenge of the Sith', 'score': 8.21}<br/>{'title': 'Star Wars: Episode V - The Empire Strikes Back', 'score': 7.55}</span></pre><p id="3372" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是Solr将运行的实际Lucene查询(<code class="fe nk nl nm nb b">q</code>)。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="9f1c" class="nf lh it nb b gy ng nh l ni nj">title:"star war"</span></pre><h2 id="980c" class="nf lh it bd li nr ns dn lm nt nu dp lq kb nv nw lu kf nx ny ly kj nz oa mc ob bi translated">查询4:搜索词</h2><p id="d268" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">接下来，我们将对标题包含搜索词“star”或“wars”而不是短语“star wars”的所有电影执行查询。Solr web控制台有一个非常强大的分析工具。使用分析工具，我们可以检查与特定字段类型相关联的每个过滤器(在下面最左边的列中缩写)将如何影响Solr的匹配能力。要使用分析工具，请将搜索词或短语放在右侧，将索引字段值放在左侧，然后从下拉列表中选择字段或字段类型。</p><p id="f069" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面，我们将看到如果被搜索的字段是前面讨论过的字段类型“text_en”，搜索词“Star”和“Wars”(显示在右下方)将如何匹配这两个词的一系列变体(显示在左下方)。例如，对' Star '的查询将匹配'<strong class="js iu">Star[T7 '，'<strong class="js iu">Star</strong>s '，'<strong class="js iu">Star</strong>s '，'<strong class="js iu">Star</strong>ring '，'<strong class="js iu">Star</strong>red '，'<strong class="js iu">Star</strong>shaped '，但不匹配' shaped '，' superstars '，' started '。</strong></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi no"><img src="../Images/8fa97387f0a28cfc58ca2a07ad5d7d20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*AunE11t_C2mgrPwW"/></div></div></figure><p id="cbb6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面，我们看到类似的搜索结果，“战争”。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi no"><img src="../Images/c7a1157620a0eb8be264f23017246d7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*0RnIrxspBqieOZAt"/></div></div></figure><h1 id="0ad2" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">MongoDB文本搜索</h1><p id="0203" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">为了用MongoDB完成查询，我们将使用MongoDB的$text <a class="ae lf" href="https://docs.mongodb.com/manual/reference/operator/query/regex/" rel="noopener ugc nofollow" target="_blank">评估查询操作符</a>。MongoDB <code class="fe nk nl nm nb b">$text</code>操作符能够在用文本索引索引的多个字段中执行文本搜索。MongoDB的文本索引支持对字符串内容的文本搜索查询。文本索引可以包括其值为字符串或字符串元素数组的任何字段，如movieDetail集合的“流派”字段。虽然不如Solr的搜索功能强大，但MongoDB的文本搜索可以解决许多基本的搜索需求，而不需要用搜索引擎来扩充架构。</p><p id="a712" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于我们的下一个查询，我们将依赖于title字段上的文本索引。当Python脚本运行时，它在集合上创建以下三个索引，包括标题文本索引。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="0c3a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有了文本索引，查询的结果应该是相同的，返回18个文档。MongoDB和Solr结果集都被评分，但是，两者的评分是不同的，使用不同的算法。</p><p id="7652" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">MongoDB:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="60ff" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>query: {<br/>  '$text': {'$search': 'star wars', '$language': 'en', '$caseSensitive': False}, <br/>  'countries': 'USA'<br/>}<br/>projection: {'score': {'$meta': 'textScore'}, '_id': 0, 'title': 1}<br/>sort: [('score', {'$meta': 'textScore'})]<br/>  <br/>Results<br/>----------<br/>document count: 18<br/>{'title': 'Star Wars: Episode I - The Phantom Menace', 'score': 1.2}<br/>{'title': 'Star Wars: Episode IV - A New Hope', 'score': 1.17}<br/>{'title': 'Star Wars: Episode VI - Return of the Jedi', 'score': 1.17}<br/>{'title': 'Star Wars: Episode II - Attack of the Clones', 'score': 1.17}<br/>{'title': 'Star Wars: Episode III - Revenge of the Sith', 'score': 1.17}</span></pre><p id="5817" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="20c3" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>q: star wars<br/>kwargs: {<br/>  'defType': 'lucene', <br/>  'fq': 'countries: USA' <br/>  'df': 'title', <br/>  'fl': 'title, score', <br/>  'rows': '5'<br/>}<br/>  <br/>Results<br/>----------<br/>document count: 18<br/>{'title': 'Star Wars: Episode VI - Return of the Jedi', 'score': 8.21}<br/>{'title': 'Star Wars: Episode II - Attack of the Clones', 'score': 8.21}<br/>{'title': 'Star Wars: Episode IV - A New Hope', 'score': 8.21}<br/>{'title': 'Star Wars: Episode I - The Phantom Menace', 'score': 8.21}<br/>{'title': 'Star Wars: Episode III - Revenge of the Sith', 'score': 8.21}</span></pre><p id="e58d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是Solr将运行的实际Lucene查询(<code class="fe nk nl nm nb b">q</code>)。随后应用国家过滤器。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="6f6a" class="nf lh it nb b gy ng nh l ni nj">title:star title:war</span></pre><h2 id="e3c5" class="nf lh it bd li nr ns dn lm nt nu dp lq kb nv nw lu kf nx ny ly kj nz oa mc ob bi translated">查询5a:多个搜索词</h2><p id="203a" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">接下来，我们将使用电影类型字段中的搜索词“西部片”、“动作片”或“冒险片”来查询美国制作的电影。流派字段可以保存多个流派值。虽然这是一个简单的查询，但我们可以开始看到Solr的Lucene评分功能的优势，它提供了一种方法来衡量各个结果的相关性。</p><p id="aba0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">即使局限于美国电影，这个类型查询也返回大量结果，244个文档。使用MongoDB，我们不知道哪些文档比其他文档更相关。与Solr结果相比，MongoDB在匹配所有或大多数类型的基础上，在前五名结果中获得了一些，但不是最相关的。</p><p id="1bcc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">MongoDB:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="6212" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>query: {<br/>  'genres': {'$in': ['Adventure', 'Action', 'Western']}, <br/>  'countries': 'USA'<br/>}<br/>projection: {'_id': 0, 'genres': 1, 'title': 1}<br/>  <br/>Results<br/>----------<br/>document count: 244<br/>{'title': 'Wild Wild West', 'genres': ['Action', 'Western', 'Comedy']}<br/>{'title': 'A Million Ways to Die in the West', 'genres': ['Comedy', 'Western']}<br/>{'title': 'An American Tail: Fievel Goes West', 'genres': ['Animation', 'Adventure', 'Family']}<br/>{'title': 'Once Upon a Time in the West', 'genres': ['Western']}<br/>{'title': 'How the West Was Won', 'genres': ['Western']}</span></pre><p id="be6a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然而，根据Solr的评分，我们看到第一个(顶部)结果“The Wild Bunch”的得分为7.18。它的类型包括“西部片”、“动作片”和“冒险片”。最后一个(底部)结果“S.S. Doomtrooper”的得分为1.47。最相关的结果比最不相关的结果得分高近5倍(488%)。如果你在搜索一部西部动作冒险电影，很明显排名第一的《荒野大镖客》(The Wild Bunch)比排名第二的《末日终结者》(S.S. Doomtrooper)要好得多。事实上，如下图所示，所有五个得分最高的Solr结果根据它们的分数、类型和标题看起来都很有希望。</p><p id="fcf7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="70bb" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>q: adventure action western<br/>kwargs: {<br/>  'defType': 'lucene', <br/>  'fq': 'countries: USA', <br/>  'df': 'genres', <br/>  'fl': 'title, genres, score', <br/>  'rows': '5'<br/>}<br/>  <br/>Results<br/>----------<br/>document count: 244<br/>{'title': 'The Wild Bunch', 'genres': ['Action', 'Adventure', 'Western'], 'score': 7.18}<br/>{'title': 'Crossfire Trail', 'genres': ['Action', 'Western'], 'score': 6.26}<br/>{'title': 'The Big Trail', 'genres': ['Adventure', 'Western', 'Romance'], 'score': 5.46}<br/>{'title': 'Once Upon a Time in the West', 'genres': ['Western'], 'score': 5.26}<br/>{'title': 'How the West Was Won', 'genres': ['Western'], 'score': 5.26}</span></pre><p id="7ca3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是Solr将运行的实际Lucene查询(<code class="fe nk nl nm nb b">q</code>)。随后应用国家过滤器。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="641e" class="nf lh it nb b gy ng nh l ni nj">genres:adventur genres:action genres:western</span></pre><h2 id="9e11" class="nf lh it bd li nr ns dn lm nt nu dp lq kb nv nw lu kf nx ny ly kj nz oa mc ob bi translated">查询5b:必需的搜索词</h2><p id="052a" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">有几乎无穷无尽的选项可以用来影响Solr的结果。例如，我们可以执行上面相同的Solr查询，但是这一次要求单词“western”是流派字段，使用加号(<code class="fe nk nl nm nb b">+</code> ) <a class="ae lf" href="https://lucene.apache.org/solr/guide/6_6/the-standard-query-parser.html#TheStandardQueryParser-BooleanOperatorsSupportedbytheStandardQueryParser" rel="noopener ugc nofollow" target="_blank">布尔运算符</a>。前五个结果和分数是相同的，但是相关结果的总数从244个减少到仅仅24个。这意味着220个先前的结果包含“动作”和/或“冒险”，但不包含“西部”。反之亦然，使用减号(<code class="fe nk nl nm nb b">-</code>)布尔运算符将确保结果不包含特定的单词或短语。</p><p id="2392" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="f0c9" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>q: adventure action <strong class="nb iu">+western</strong><br/>kwargs: { <br/>  'defType': 'lucene', <br/>  'fq': 'countries: USA', <br/>  'df': 'genres', <br/>  'fl': 'title, genres, score', <br/>  'rows': '5'<br/>} <br/>  <br/>Results<br/>----------<br/>document count: 24<br/>{'title': 'The Wild Bunch', 'genres': ['Action', 'Adventure', 'Western'], 'score': 7.18}<br/>{'title': 'Crossfire Trail', 'genres': ['Action', 'Western'], 'score': 6.26}<br/>{'title': 'The Big Trail', 'genres': ['Adventure', 'Western', 'Romance'], 'score': 5.46}<br/>{'title': 'Once Upon a Time in the West', 'genres': ['Western'], 'score': 5.26}<br/>{'title': 'How the West Was Won', 'genres': ['Western'], 'score': 5.26}</span></pre><p id="aed4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是Solr将运行的实际Lucene查询(<code class="fe nk nl nm nb b">q</code>)。随后应用国家过滤器。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="bd07" class="nf lh it nb b gy ng nh l ni nj">(genres:adventur genres:action) +genres:western</span></pre><h2 id="d70c" class="nf lh it bd li nr ns dn lm nt nu dp lq kb nv nw lu kf nx ny ly kj nz oa mc ob bi translated">查询6a: eDisMax查询</h2><p id="c66d" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">对于我们的下一个查询，我们将比较Solr的eDisMax查询解析器和MongoDB的文本搜索功能。</p><h1 id="016a" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">Solr扩展DisMax</h1><p id="b16e" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">根据Solr的说法，<a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/the-dismax-query-parser.html#the-dismax-query-parser" rel="noopener ugc nofollow" target="_blank"> DisMax查询解析器</a>旨在处理简单的短语，并基于每个字段的重要性使用不同的权重(提升)来搜索几个字段中的单个术语。附加选项使用户能够基于特定于每个用例的规则来影响分数(独立于用户输入)。Solr的<a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/the-extended-dismax-query-parser.html" rel="noopener ugc nofollow" target="_blank">扩展DisMax (eDisMax)查询解析器</a>是DisMax查询解析器的改进版本。</p><p id="6438" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我看来，除了基于Lucene的评分之外，使用DisMax和e DisMax查询解析器轻松搜索多个字段并有选择地提升结果的能力，是在数据库中查询数据与使用搜索引擎搜索相关结果的区别所在。</p><h1 id="8c1f" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">多字段文本索引</h1><p id="9e5f" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">对于我们的下一个查询，Python脚本将删除title字段上以前的MongoDB文本索引，并创建一个新的复合文本索引，该索引将包含title、plot和流派字段。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="3df3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面，我们在MongoDB Compass应用程序的Indexes选项卡中看到了新的复合文本索引。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi no"><img src="../Images/da508b2e25319d5367f10c702f9d1d31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*xGnak_L0eKSNYfdN"/></div></div></figure><p id="7aa9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将在电影标题、情节或类型字段中使用搜索词“西部片”、“动作片”或“冒险片”来查询美国制作的电影。查询的结果应该是相同的，返回259个文档。MongoDB和Solr结果集都被评分，但是结果的评分和排序也不相同。在前十个结果中，这两个查询匹配了前十个结果中的六部电影。</p><p id="3fec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">MongoDB:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="b40a" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>query: {<br/>  '$text': {'$search': 'western action adventure', '$language': 'en', '$caseSensitive': False}, <br/>  'countries': 'USA'<br/>}<br/>projection: {'score': {'$meta': 'textScore'}, '_id': 0, 'title': 1}<br/>  <br/>Results<br/>----------<br/>document count: 259<br/>{'title': 'Zathura: A Space Adventure', 'genres': ['Action', 'Adventure', 'Comedy'], 'score': 3.3}<br/>{'title': 'The Extraordinary Adventures of Adèle Blanc-Sec', 'genres': ['Action', 'Adventure', 'Fantasy'], 'score': 3.24}<br/>{'title': 'The Wild Bunch', 'genres': ['Action', 'Adventure', 'Western'], 'score': 3.2}<br/>{'title': 'The Adventures of Tintin', 'genres': ['Animation', 'Action', 'Adventure'], 'score': 2.85}<br/>{'title': 'Adventures in Babysitting', 'genres': ['Action', 'Adventure', 'Comedy'], 'score': 2.85}</span></pre><p id="e36e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="d405" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>q: western action adventure<br/>kwargs: {<br/>  'defType': 'edismax', <br/>  'fq': 'countries: USA', <br/>  'qf': 'plot title genres', <br/>  'fl': 'title, genres, score', <br/>  'rows': '5'<br/>}<br/>  <br/>Results<br/>----------<br/>document count: 259<br/>{'title': 'The Secret Life of Walter Mitty', 'genres': ['Adventure', 'Comedy', 'Drama'], 'score': 7.67}<br/>{'title': 'Western Union', 'genres': ['History', 'Western'], 'score': 7.39}<br/>{'title': 'The Adventures of Tintin', 'genres': ['Animation', 'Action', 'Adventure'], 'score': 7.36}<br/>{'title': 'Adventures in Babysitting', 'genres': ['Action', 'Adventure', 'Comedy'], 'score': 7.36}<br/>{'title': 'The Poseidon Adventure', 'genres': ['Action', 'Adventure', 'Drama'], 'score': 7.36}</span></pre><p id="31ce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是Solr将运行的实际Lucene查询。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="ec3e" class="nf lh it nb b gy ng nh l ni nj">+(<br/>  (title:adventur | plot:adventur | genres:adventur) <br/>  (title:action | plot:action | genres:action) <br/>  (title:western | plot:western | genres:western)<br/>)</span></pre><h2 id="f685" class="nf lh it bd li nr ns dn lm nt nu dp lq kb nv nw lu kf nx ny ly kj nz oa mc ob bi translated">查询6b:提升字段</h2><p id="1c87" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">如果你真的想要一部“西部动作冒险”电影，而不是“西部”、“动作”或“冒险”电影，那么Solr或MongoDB的前五个搜索结果可能都不会让你完全满意。如果正确的字段被提升，并且正或负提升的量是适当的，则提升或加权字段通常可以提供更相关的搜索结果。</p><p id="89db" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">MongoDB的文本索引也允许<a class="ae lf" href="https://docs.mongodb.com/manual/core/index-text/#specify-weights" rel="noopener ugc nofollow" target="_blank">加权</a>单个字段。索引字段的权重表示该字段相对于其他索引字段的重要性，并直接影响文本搜索分数。加权字段相当于用Solr增强字段。下面，我们看到一个应用于我们之前的文本索引的修改，其中标题字段的权重是绘图字段的两倍(默认为1.0)，类型字段的权重是标题字段的两倍。Python脚本也会为您应用这个索引。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="a714" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">同样，Solr也能够提升DisMax和e DisMax查询解析器的字段。对于我们的下一个查询，我们将重复前面的查询，但是提升eDisMax的<code class="fe nk nl nm nb b">qf</code> ( <a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/the-dismax-query-parser.html#qf-query-fields-parameter" rel="noopener ugc nofollow" target="_blank">查询字段</a>)参数中的字段，以匹配MongoDB加权文本索引中的提升，如上所示。</p><p id="c02a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">查询的结果应该是相同的，返回259个文档。MongoDB和Solr的结果评分和排序不同。然而，与前面的未加权/提升的MongoDB和Solr查询结果相比，相对分数更高，返回的电影顺序不同，最重要的是，Solr结果似乎与原始搜索意图更相关。</p><p id="6191" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以Solr为例，以电影《沃尔特·米蒂的秘密生活》(The Secret Life of Walter Mitty)为例，这部电影之前的评分最高，为7.58分。在提升后的搜索结果中，电影《荒野大镖客》(The Wild Bunch)现在以28.71分排名第一。电影《沃尔特·米蒂的秘密生活》甚至不再排在前50名。相比之下，其他电影，如《丁丁历险记》和《保姆历险记》，即使它们的分数成比例变化，也几乎没有移动位置。</p><p id="ce16" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">MongoDB:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="37a9" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>query: {<br/>  '$text': {'$search': 'western action adventure', '$language': 'en', '$caseSensitive': False}, <br/>  'countries': 'USA'<br/>}<br/>projection: {'score': {'$meta': 'textScore'}, '_id': 0, 'title': 1}<br/>  <br/>Results<br/>----------<br/>document count: 259<br/>{'title': 'The Wild Bunch', 'genres': ['Action', 'Adventure', 'Western'], 'score': 12.8}<br/>{'title': 'Zathura: A Space Adventure', 'genres': ['Action', 'Adventure', 'Comedy'], 'score': 10.27}<br/>{'title': 'The Extraordinary Adventures of Adèle Blanc-Sec', 'genres': ['Action', 'Adventure', 'Fantasy'], 'score': 10.14}<br/>{'title': 'The Adventures of Tintin', 'genres': ['Animation', 'Action', 'Adventure'], 'score': 9.9}<br/>{'title': 'Adventures in Babysitting', 'genres': ['Action', 'Adventure', 'Comedy'], 'score': 9.9}</span></pre><p id="3c11" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="363f" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>q: western action adventure<br/>kwargs: {<br/>  'defType': 'edismax', <br/>  'fq': 'countries: USA', <br/><strong class="nb iu">  'qf': 'plot title^2.0 genres^4.0', <br/></strong>  'fl': 'title, genres, score', <br/>  'rows': '5'<br/>}<br/>  <br/>Results<br/>----------<br/>document count: 259<br/>{'title': 'The Wild Bunch', 'genres': ['Action', 'Adventure', 'Western'], 'score': 28.71}<br/>{'title': 'Crossfire Trail', 'genres': ['Action', 'Western'], 'score': 25.05}<br/>{'title': 'The Big Trail', 'genres': ['Adventure', 'Western', 'Romance'], 'score': 21.84}<br/>{'title': 'Once Upon a Time in the West', 'genres': ['Western'], 'score': 21.05}<br/>{'title': 'How the West Was Won', 'genres': ['Western'], 'score': 21.05}</span></pre><p id="efed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是Solr将运行的实际Lucene查询。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="300b" class="nf lh it nb b gy ng nh l ni nj">+(<br/>  ((title:adventur)^2.0 | plot:adventur | (genres:adventur)^4.0) <br/>  ((title:action)^2.0 | plot:action | (genres:action)^4.0) <br/>  ((title:western)^2.0 | plot:western | (genres:western)^4.0)<br/>)</span></pre><h2 id="e6a1" class="nf lh it bd li nr ns dn lm nt nu dp lq kb nv nw lu kf nx ny ly kj nz oa mc ob bi translated">查询6c: eDisMax增加了必需/禁止的术语</h2><p id="6c32" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">我们可以使用加号(<code class="fe nk nl nm nb b">+</code>)和减号(<code class="fe nk nl nm nb b">-</code>)布尔运算符来获得更相关的搜索结果。让我们重复上一个Solr增强的查询，但这一次，也要求任何结果都包含搜索词“western”，并禁止响应包含搜索词“romance”。我认为基于Solr查询的这些修改的新搜索结果比以前的结果更符合搜索的初衷。例如，电影“The Big Trail”，一部浪漫的西方冒险电影，根据其类型，不再包含在结果集中。</p><p id="587a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="567a" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>q: adventure action <strong class="nb iu">+western -romance</strong><br/>kwargs: {<br/>  'defType': 'edismax', <br/>  'fq': 'countries: USA', <br/><strong class="nb iu">  'qf': 'plot title^2.0 genres^4.0',</strong><br/>  'fl': 'title, genres, score', <br/>  'rows': '5'<br/>}</span><span id="c509" class="nf lh it nb b gy nn nh l ni nj">Results<br/>----------<br/>document count: 25<br/>{'title': 'The Wild Bunch', 'genres': ['Action', 'Adventure', 'Western'], 'score': 28.71}<br/>{'title': 'Crossfire Trail', 'genres': ['Action', 'Western'], 'score': 25.05}<br/>{'title': 'Once Upon a Time in the West', 'genres': ['Western'], 'score': 21.05}<br/>{'title': 'How the West Was Won', 'genres': ['Western'], 'score': 21.05}<br/>{'title': 'Cowboy', 'genres': ['Western'], 'score': 21.05}</span></pre><p id="31ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是Solr将运行的实际Lucene查询。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="08ef" class="nf lh it nb b gy ng nh l ni nj">+(<br/>  ((title:adventur)^2.0 | plot:adventur | (genres:adventur)^4.0) <br/>  ((title:action)^2.0 | plot:action | (genres:action)^4.0) <br/>  +((title:western)^2.0 | plot:western | (genres:western)^4.0) <br/>  -((title:romanc)^2.0 | plot:romanc | (genres:romanc)^4.0)<br/>)</span></pre><h2 id="ad44" class="nf lh it bd li nr ns dn lm nt nu dp lq kb nv nw lu kf nx ny ly kj nz oa mc ob bi translated">问题7a:电影困境</h2><p id="0759" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">通常，终端用户通过搜索框与搜索引擎(如Google)进行交互。我们在搜索框中输入一些内容，然后得到相关结果的列表。到目前为止，我们大多数人都已经学会了如何使用谷歌搜索来获得最佳结果。然而，事实是，人们可以并且愿意在搜索框中输入任何内容。</p><p id="8d43" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了尝试并改善最终用户的平均搜索结果，搜索工程师通常会尝试调整查询参数，例如提升某些搜索字段相对于其他字段的重要性，调整<a class="ae lf" href="https://lucene.apache.org/solr/guide/6_6/the-standard-query-parser.html#TheStandardQueryParser-FuzzySearches" rel="noopener ugc nofollow" target="_blank">模糊搜索</a>参数，或者通过将不相关的词添加到<a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/filter-descriptions.html#FilterDescriptions-StopFilter" rel="noopener ugc nofollow" target="_blank">停用词</a>中来忽略这些词。Solr停用词中的默认英语包括:“a”、“an”、“and”、“are”、“as”、“at”、“be”、“but”、“by”、“for”等。</p><p id="ea60" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以“电影”这个词为例。使用搜索框搜索要看的电影的人可能会输入短语“牛仔电影”。术语“A”作为停用词被忽略。这使得搜索词“牛仔”和“电影”只能在标题、情节和类型字段中搜索。正如我们在下面的十大搜索结果中看到的，大多数似乎是关于牛仔的，在标题或情节中有“牛仔”一词。然后是结果，“电视:电影”。这似乎不是一部关于牛仔的电影。单词“cowboy”不在标题、情节或类型中，但在这里它位于第三位，因为它在标题、情节和/或类型中包含单词“movie”。</p><p id="1edb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">同样，排名第一的电影结果“星际牛仔:电影”可能不会比排名第二、第三或第四的电影更相关。然而，《星际牛仔:电影》的评分甚至明显高于第二名(11.24比7.31)。这是因为电影的标题包含两个搜索词，“牛仔”和“电影”，即使“电影”一词与搜索词的原意无关。</p><p id="c6fc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="da79" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>q: A cowboys movie<br/>kwargs: {<br/>  'defType': 'edismax', <br/>  'fq': 'countries: USA', <br/>  'qf': 'plot title genres', <br/>  'fl': 'title, genres, score', <br/>  'rows': '10'<br/>}<br/>  <br/>Results<br/>----------<br/>document count: 23<br/>{'title': 'Cowboy Bebop: The Movie', 'genres': ['Animation', 'Action', 'Crime'], 'score': 11.24}<br/>{'title': 'Cowboy', 'genres': ['Western'], 'score': 7.31}<br/>{'title': 'TV: The Movie', 'genres': ['Comedy'], 'score': 6.42}<br/>{'title': 'Space Cowboys', 'genres': ['Action', 'Adventure', 'Thriller'], 'score': 6.33}<br/>{'title': 'Midnight Cowboy', 'genres': ['Drama'], 'score': 6.33}<br/>{'title': 'Drugstore Cowboy', 'genres': ['Crime', 'Drama'], 'score': 6.33}<br/>{'title': 'Urban Cowboy', 'genres': ['Drama', 'Romance', 'Western'], 'score': 6.33}<br/>{'title': 'The Cowboy Way', 'genres': ['Action', 'Comedy', 'Drama'], 'score': 6.33}<br/>{'title': 'The Cowboy and the Lady', 'genres': ['Comedy', 'Drama', 'Romance'], 'score': 6.33}<br/>{'title': 'Toy Story', 'genres': ['Animation', 'Adventure', 'Comedy'], 'score': 5.65}</span></pre><p id="c1ee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是Solr将运行的实际Lucene查询。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="f120" class="nf lh it nb b gy ng nh l ni nj">+(<br/>  (title:cowboi | plot:cowboi | genres:cowboi) <br/>  (title:movi | plot:movi | genres:movi)<br/>)</span></pre><h2 id="2aeb" class="nf lh it bd li nr ns dn lm nt nu dp lq kb nv nw lu kf nx ny ly kj nz oa mc ob bi translated">问题7b:停用词</h2><p id="0dc0" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">为了解决电影困境，我们可以考虑将单词“movie”添加到停用词中，因为单词“movie”似乎与搜索短语“A cowboys movie”或一般的电影搜索引擎无关。但是，这种选择会对其他搜索产生负面影响。有12部电影的标题包含“电影”一词。如果你在搜索“乐高电影”，忽略“电影”这个词，会对搜索结果的准确性和相关性产生负面影响。你最终只会在搜索结果中找到两部乐高电影中的一部，也就是标题中没有包含“电影”这个词的那部。注意两个乐高电影中只有一个被返回。</p><p id="a543" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="0a74" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>q: The Lego Movie<br/>kwargs: {<br/>  'defType': 'edismax', <br/>  'fq': 'countries: USA', <br/>  'qf': 'plot title genres', <br/>  'fl': 'title, genres, score', <br/>  'rows': '5'<br/>}<br/>  <br/>Results<br/>----------<br/>document count: 1<br/>{'title': 'Lego DC Comics Super Heroes: Justice League vs. Bizarro League', 'genres': ['Animation', 'Action', 'Adventure'], 'score': 3.63}</span></pre><p id="97ac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是Solr将运行的实际Lucene查询。请注意，术语“a”和“movie”都不是搜索的一部分。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="f8a0" class="nf lh it nb b gy ng nh l ni nj">+((title:lego | plot:lego | genres:lego)</span></pre><h2 id="9bcd" class="nf lh it bd li nr ns dn lm nt nu dp lq kb nv nw lu kf nx ny ly kj nz oa mc ob bi translated">查询7c:负提升</h2><p id="a04b" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">解决电影困境的第二个方法可能是当“电影”一词出现在标题字段时对其进行负面宣传，从而降低其相关性。DisMax和e DisMax查询解析器都可以对字段进行负提升，或者更准确地说，对特定的字段值进行负提升。当单词‘movie’出现在标题字段中时，我们可以通过使用参数<code class="fe nk nl nm nb b">bq</code> ( <a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/the-dismax-query-parser.html" rel="noopener ugc nofollow" target="_blank"> Boost Query </a>)对其进行负提升。根据Solr的说法，<code class="fe nk nl nm nb b">bq</code>参数指定了一个附加的、可选的查询子句，该子句将被添加到用户的主查询中以影响分数。作为开发人员，我们可以通过编程将负面提升的术语添加到查询中，而无需直接改变用户的原始搜索短语。同样，像停用词一样，提升也可能对其他搜索产生负面影响。</p><p id="7805" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">经过一些实验后，我们将尝试-2的提升值。我们仍然得到23个结果，但是，根据我们搜索短语的意图，前十个结果现在看起来更相关。电影《星际牛仔:电影》和《电视:电影》不在前十名之列；他们的得分被降低了。你可以对更多的搜索词重复这一过程，如“电影”，积极或消极地提高他们的分数，以提高结果的相关性。</p><p id="5f5b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="a288" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>q: A cowboys movie<br/>kwargs: {<br/>  'defType': 'edismax', <br/>  'fq': 'countries: USA', <br/>  'qf': 'plot title genres', <br/><strong class="nb iu">  'bq': 'title:movie^-2.0', </strong><br/>  'fl': 'title, genres, score', <br/>  'rows': '10'<br/>}<br/>  <br/>Results<br/>----------<br/>document count: 23<br/>{'title': 'Cowboy', 'genres': ['Western'], 'score': 7.31}<br/>{'title': 'Space Cowboys', 'genres': ['Action', 'Adventure', 'Thriller'], 'score': 6.33}<br/>{'title': 'Midnight Cowboy', 'genres': ['Drama'], 'score': 6.33}<br/>{'title': 'Drugstore Cowboy', 'genres': ['Crime', 'Drama'], 'score': 6.33}<br/>{'title': 'Urban Cowboy', 'genres': ['Drama', 'Romance', 'Western'], 'score': 6.33}<br/>{'title': 'The Cowboy Way', 'genres': ['Action', 'Comedy', 'Drama'], 'score': 6.33}<br/>{'title': 'The Cowboy and the Lady', 'genres': ['Comedy', 'Drama', 'Romance'], 'score': 6.33}<br/>{'title': 'Toy Story', 'genres': ['Animation', 'Adventure', 'Comedy'], 'score': 5.65}<br/>{'title': "Ride 'Em Cowboy", 'genres': ['Comedy', 'Western', 'Musical'], 'score': 5.58}<br/>{'title': "G.M. Whiting's Enemy", 'genres': ['Mystery'], 'score': 5.32}</span></pre><p id="f54a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是Solr将运行的实际Lucene查询，考虑到负面影响。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="02eb" class="nf lh it nb b gy ng nh l ni nj">+((title:cowboi | plot:cowboi | genres:cowboi) <br/>  (title:movi | plot:movi | genres:movi)) <br/><strong class="nb iu">(title:movi)^-2.0</strong></span></pre><h1 id="4eb4" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">函数查询</h1><p id="f142" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">Solr的Lucene评分是有效的，但是如果我们想使用一个额外的，主观的相关性度量来丰富我们的搜索结果呢？如果我们检查电影索引模式，我们将看到有相当多的分级相关字段提供了电影质量的感觉，由观众和组织进行判断。例如，有一个嵌套的“番茄”对象，包含许多定性数据字段，如番茄等级和番茄用户等级。番茄指的是<a class="ae lf" href="https://www.rottentomatoes.com/" rel="noopener ugc nofollow" target="_blank">烂番茄</a>。根据他们的网站，烂番茄提供世界上最值得信赖的优质娱乐推荐资源。此外，电影索引模式包括类似的“awards”和“imdb”对象以及“metacritic”评级。这是电影《布奇·卡西迪和圣丹斯小子》中的一段数据，展示了许多定性领域。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="e018" class="nf lh it nb b gy ng nh l ni nj">"imdb": {<br/>    "id": "tt0064115",<br/>    "rating": 8.1,<br/>    "votes": 142642<br/>  },<br/>  "tomato": {<br/>    "meter": 89,<br/>    "image": "certified",<br/>    "rating": 8.2,<br/>    "reviews": 46,<br/>    "fresh": 41,<br/>    "consensus": "With its iconic pairing of Paul Newman and Robert Redford, jaunty screenplay and Burt Bacharach score, Butch Cassidy and the Sundance Kid has gone down as among the defining moments in late-'60s American cinema.",<br/>    "userMeter": 93,<br/>    "userRating": 4,<br/>    "userReviews": 70088<br/>  },<br/>  "metacritic": 58,<br/>  "awards": {<br/>    "wins": 16,<br/>    "nominations": 14,<br/>    "text": "Won 4 Oscars. Another 16 wins &amp; 14 nominations."<br/>  }</span></pre><p id="68dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">根据<a class="ae lf" href="https://lucene.apache.org/core/2_9_4/scoring.html" rel="noopener ugc nofollow" target="_blank"> Apache </a>的说法，Lucene评分是信息检索的<a class="ae lf" href="http://en.wikipedia.org/wiki/Vector_Space_Model" rel="noopener ugc nofollow" target="_blank">向量空间模型(VSM)和</a><a class="ae lf" href="http://en.wikipedia.org/wiki/Standard_Boolean_model" rel="noopener ugc nofollow" target="_blank">布尔模型</a>的组合。Lucene允许通过“提升”来影响搜索结果。使用Solr的<a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/function-queries.html" rel="noopener ugc nofollow" target="_blank">函数Query </a>，我们可以应用一个文档级的乘法提升函数，这将改变查询的搜索结果的分数。</p><h2 id="580c" class="nf lh it bd li nr ns dn lm nt nu dp lq kb nv nw lu kf nx ny ly kj nz oa mc ob bi translated">查询8:升压函数</h2><p id="e466" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">如果你记得在我们之前的例子中，我们查询了“冒险行动+西部爱情片”。如果我们再次运行它，在没有提升字段的情况下，我们得到了25个文档，其中“Western Union”排名最高，得分为7.39。</p><p id="069a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="1853" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>q: adventure action <strong class="nb iu">+western -romance</strong><br/>kwargs: {<br/>  'defType': 'edismax', <br/>  'fq': 'countries: USA', <br/>  'qf': 'plot title genres', <br/>  'fl': 'title, awards.wins, score', <br/>  'rows': '5'<br/>}</span><span id="e14e" class="nf lh it nb b gy nn nh l ni nj">Results<br/>----------<br/>document count: 25<br/>{'title': 'Western Union', 'awards.wins': [0.0], 'score': 7.39}<br/>{'title': 'The Wild Bunch', 'awards.wins': [5.0], 'score': 7.18}<br/>{'title': 'Western Spaghetti', 'awards.wins': [2.0], 'score': 6.64}<br/>{'title': 'Crossfire Trail', 'awards.wins': [1.0], 'score': 6.26}<br/>{'title': 'Butch Cassidy and the Sundance Kid', 'awards.wins': [16.0], 'score': 6.23}</span></pre><p id="f57e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是Solr将运行的实际Lucene查询。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="c410" class="nf lh it nb b gy ng nh l ni nj">+(<br/>  (title:adventur | plot:adventur | genres:adventur) <br/>  (title:action | plot:action | genres:action) <br/>  +(title:western | plot:western | genres:western) <br/>  -(title:romanc | plot:romanc | genres:romanc)<br/>)</span></pre><p id="7d94" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们将应用一个增强函数。在下面的函数中，我任意取了每部电影的获奖数，并分成两半。该函数应用于eDisMax的<code class="fe nk nl nm nb b">boost</code>参数。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="be2d" class="nf lh it nb b gy ng nh l ni nj">div(field(awards.wins,min),2)</span></pre><p id="9ddb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个函数对结果集中的文档的<a class="ae lf" href="https://lucene.apache.org/core/3_5_0/scoring.html" rel="noopener ugc nofollow" target="_blank"> Lucene评分</a>有倍增效应，它按照每部电影获得的奖项数量成比例地提高评分。根据我们的搜索短语，我们现在可以得到既有相关结果又有广受好评的电影。</p><p id="2b94" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">乘法增强功能的影响在顶部结果“布奇·卡西迪和圣丹斯小子”中显而易见。这部广受好评的电影使用boost公式，从之前搜索的第五名攀升至第一名。这部名为《布奇·卡西迪和圣丹斯小子》的电影获得了令人惊叹的16个奖项，比上一部没有获得任何奖项的第一名电影《西部联盟》多16个奖项，在提升后的结果中一路下滑至第17名。《狂野西部》(Wild Wild West)是一部甚至没有进入前五名的电影，现在排名第二，获得了十个奖项。</p><p id="35fd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">提升功能的影响在分数上最为明显。之前，结果中第一位和第五位之间的分数差为1.16。第一和第二位置之间的差值平均为0.21。现在，随着boost函数的应用，得分范围以及两个差值显著增加，36.78比1.16，23.83比0.21。</p><p id="9738" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="b351" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>q: adventure action +western -romance<br/>kwargs: {<br/>  'defType': 'edismax', <br/>  'fq': 'countries: USA', <br/>  'qf': 'plot title genres', <br/>  'fl': 'title, awards.wins, score', <br/><strong class="nb iu">  'boost': 'div(field(awards.wins,min),2)', </strong><br/>  'rows': '5'<br/>}</span><span id="5cec" class="nf lh it nb b gy nn nh l ni nj">Results<br/>----------<br/>document count: 25<br/><strong class="nb iu">{'title': 'Butch Cassidy and the Sundance Kid', 'awards.wins': [16.0], 'score': 49.86}</strong><br/>{'title': 'Wild Wild West', 'awards.wins': [10.0], 'score': 26.03}<br/>{'title': 'How the West Was Won', 'awards.wins': [7.0], 'score': 18.42}<br/>{'title': 'The Wild Bunch', 'awards.wins': [5.0], 'score': 17.95}<br/>{'title': 'All Quiet on the Western Front', 'awards.wins': [5.0], 'score': 13.08}</span></pre><p id="022c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是Solr将使用boost函数运行的实际Lucene查询。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="5f9b" class="nf lh it nb b gy ng nh l ni nj">FunctionScoreQuery(+((title:adventur | plot:adventur | <br/>  genres:adventur) (title:action | plot:action | genres:action) <br/>  +(title:western | plot:western | genres:western) <br/>  -(title:romanc | plot:romanc | genres:romanc)), <br/>  <strong class="nb iu">scored by boost(div(double(awards.wins,MIN),const(2))))</strong></span></pre><p id="d9ce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr的函数查询提供了大量的<a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/function-queries.html#available-functions" rel="noopener ugc nofollow" target="_blank">数学函数</a>，可以组合成复杂的公式。例如，我们也可以计算IMDB评分<a class="ae lf" href="https://www.imdb.com/chart/top?ref_=nv_mv_250" rel="noopener ugc nofollow" target="_blank">和奖项提名数量之和的平方根。</a></p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="1bb9" class="nf lh it nb b gy ng nh l ni nj">sqrt(sum(field(imdb.rating,min),field(awards.wins,min)))</span></pre><h1 id="ae83" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">请再像这样</h1><p id="ae00" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">你找到了一部好电影，现在你想要更多像那部一样的电影。也许你想要更多由某个特定导演，或由某个演员主演，或基于同一主题的电影。Solr对此有一个解决方案，这个<a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/morelikethis.html" rel="noopener ugc nofollow" target="_blank">更像是这个查询解析器</a>。简称MLTQParser，它能够检索与给定文档相似的文档。它使用Lucene现有的<a class="ae lf" href="http://lucene.apache.org/core/7_7_0/queries/org/apache/lucene/queries/mlt/MoreLikeThis.html" rel="noopener ugc nofollow" target="_blank"> MoreLikeThis </a>逻辑。要使用解析器，您需要提供想要查找更多相似内容的文档的惟一Solr ID和用于比较的字段。例如:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="2aa5" class="nf lh it nb b gy ng nh l ni nj">q: {!mlt qf="genres"}da54520e-a013-4ea3-9698-230ed02c8cf0</span></pre><h2 id="4352" class="nf lh it bd li nr ns dn lm nt nu dp lq kb nv nw lu kf nx ny ly kj nz oa mc ob bi translated">问题9a: MLT流派</h2><p id="fafa" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">在第一个MLTQParser查询中，我们将选择电影“星球大战:第一集——幽灵的威胁”。我们将通过寻找类型领域的相似性来寻找更多在美国制作的类似于《星球大战:第一集——幽灵的威胁》的电影。MLTQParser的<code class="fe nk nl nm nb b">qf</code>字段指定用于相似性的字段。我们将要求<code class="fe nk nl nm nb b">mintf</code>(最小术语频率)为1。这是频率，低于此频率时，源文档中的搜索词将被忽略。我们还将要求<code class="fe nk nl nm nb b">mindf</code>(最小文档频率)为1。这是单词在至少这么多文档中不出现时被忽略的频率。</p><p id="616a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr搜索的结果似乎合乎逻辑，它们是其他五部星球大战电影。请注意，由于前五个结果与《幽灵的威胁》的三个类型“动作”、“冒险”和“幻想”完全匹配，因此它们的得分相同，都是6.33分。</p><p id="c682" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="fd8d" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/><strong class="nb iu">q: {!mlt qf="genres" mintf=1 mindf=1}aaf956a5-afa5-4284-91c1-69455142884f<br/></strong>kwargs: {<br/>  'defType': 'lucene', <br/>  'fq': 'countries: USA', <br/>  'fl': 'title, genres, score', <br/>  'rows': '5'<br/>}<br/>  <br/>Results<br/>----------<br/>document count: 252<br/>{'title': 'Star Wars: Episode IV - A New Hope', 'genres': ['Action', 'Adventure', 'Fantasy'], 'score': 6.33}<br/>{'title': 'Star Wars: Episode V - The Empire Strikes Back', 'genres': ['Action', 'Adventure', 'Fantasy'], 'score': 6.33}<br/>{'title': 'Star Wars: Episode VI - Return of the Jedi', 'genres': ['Action', 'Adventure', 'Fantasy'], 'score': 6.33}<br/>{'title': 'Star Wars: Episode III - Revenge of the Sith', 'genres': ['Action', 'Adventure', 'Fantasy'], 'score': 6.33}<br/>{'title': 'Star Wars: Episode II - Attack of the Clones', 'genres': ['Action', 'Adventure', 'Fantasy'], 'score': 6.33}</span></pre><p id="2b15" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是Solr将运行的实际Lucene查询。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="97da" class="nf lh it nb b gy ng nh l ni nj">+(genres:action genres:adventur genres:fantasi) <br/>-id:652adcfa-c59c-4fa0-ace5-6345fec3cfff</span></pre><h2 id="75ec" class="nf lh it bd li nr ns dn lm nt nu dp lq kb nv nw lu kf nx ny ly kj nz oa mc ob bi translated">问题9b:乔治的问题</h2><p id="021c" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">在第二个MLTQParser查询示例中，我们将再次选择电影“星球大战:第一集——幽灵的威胁”。然而，这一次将根据演员、导演和编剧领域的比较来寻找类似的电影(如下所示)。基本上，我们在寻找与《星球大战:第一集——幽灵的威胁》和其他电影相关的人之间的相似之处。</p><p id="5440" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="0ff6" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>q: id:"aaf956a5-afa5-4284-91c1-69455142884f"<br/>kwargs: {<br/>  'defType': 'lucene', <br/>  'fl': 'actors, director, writers'<br/>}<br/>  <br/>Results<br/>----------<br/>document count: 1<br/>{<br/>  'director': ['George Lucas'], <br/>  'writers': ['George Lucas'], <br/>  'actors': ['Liam Neeson', 'Ewan McGregor', 'Natalie Portman', 'Jake Lloyd']<br/>}</span></pre><p id="ed6f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从下面的MLTQParser查询结果可以看出，十个搜索结果中的前九个是有意义的。然而，第十部电影结果“新的《在南街遇见我:JC Dobbs的故事》”与“星球大战:第一集——幽灵的威胁”没有明显的相似之处。这部电影没有共同的导演、编剧或演员。</p><p id="a098" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="8e16" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/><strong class="nb iu">q: {!mlt qf="actors director writers" mintf=1 mindf=1}aaf956a5-afa5-4284-91c1-69455142884f<br/></strong>kwargs: {<br/>  'defType': 'lucene', <br/>  'fq': 'countries: USA', <br/>  'fl': 'title, actors, director, writers, score', <br/>  'rows': '10'<br/>}<br/>  <br/>Results<br/>----------<br/>document count: 55<br/>{'title': 'Star Wars: Episode III - Revenge of the Sith', 'director': ['George Lucas'], 'writers': ['George Lucas'], 'actors': ['Ewan McGregor', 'Natalie Portman', 'Hayden Christensen', 'Ian McDiarmid'], 'score': 44.84}<br/>{'title': 'Star Wars: Episode II - Attack of the Clones', 'director': ['George Lucas'], 'writers': ['George Lucas', 'Jonathan Hales', 'George Lucas'], 'actors': ['Ewan McGregor', 'Natalie Portman', 'Hayden Christensen', 'Christopher Lee'], 'score': 44.58}<br/>{'title': 'Star Wars: Episode IV - A New Hope', 'director': ['George Lucas'], 'writers': ['George Lucas'], 'actors': ['Mark Hamill', 'Harrison Ford', 'Carrie Fisher', 'Peter Cushing'], 'score': 23.51}<br/>{'title': 'Star Wars: Episode VI - Return of the Jedi', 'director': ['Richard Marquand'], 'writers': ['Lawrence Kasdan', 'George Lucas', 'George Lucas'], 'actors': ['Mark Hamill', 'Harrison Ford', 'Carrie Fisher', 'Billy Dee Williams'], 'score': 11.96}<br/>{'title': 'A Million Ways to Die in the West', 'director': ['Seth MacFarlane'], 'writers': ['Seth MacFarlane', 'Alec Sulkin', 'Wellesley Wild'], 'actors': ['Seth MacFarlane', 'Charlize Theron', 'Amanda Seyfried', 'Liam Neeson'], 'score': 11.72}<br/>{'title': 'Run All Night', 'director': ['Jaume Collet-Serra'], 'writers': ['Brad Ingelsby'], 'actors': ['Liam Neeson', 'Ed Harris', 'Joel Kinnaman', 'Boyd Holbrook'], 'score': 11.72}<br/>{'title': 'I Love You Phillip Morris', 'director': ['Glenn Ficarra, John Requa'], 'writers': ['John Requa', 'Glenn Ficarra', 'Steve McVicker'], 'actors': ['Jim Carrey', 'Ewan McGregor', 'Leslie Mann', 'Rodrigo Santoro'], 'score': 10.97}<br/>{'title': 'The Island', 'director': ['Michael Bay'], 'writers': ['Caspian Tredwell-Owen', 'Alex Kurtzman', 'Roberto Orci', 'Caspian Tredwell-Owen'], 'actors': ['Ewan McGregor', 'Scarlett Johansson', 'Djimon Hounsou', 'Sean Bean'], 'score': 10.97}<br/>{'title': 'Big Fish', 'director': ['Tim Burton'], 'writers': ['Daniel Wallace', 'John August'], 'actors': ['Ewan McGregor', 'Albert Finney', 'Billy Crudup', 'Jessica Lange'], 'score': 10.97}<br/>{'title': 'New Meet Me on South Street: The Story of JC Dobbs', 'director': ['George Manney'], 'writers': ['George Manney'], 'actors': ['Tony Bidgood', 'Peter Stone Brown', 'Stephen Caldwell', 'Tommy Conwell'], 'score': 10.5}</span></pre><p id="1561" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是实际的Lucene查询Solr运行。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="0da7" class="nf lh it nb b gy ng nh l ni nj">+(<strong class="nb iu">writers:george</strong> <strong class="nb iu">director:george</strong> actors:natalie writers:lucas <br/>  actors:jake actors:portman actors:ewan actors:mcgregor <br/>  actors:liam actors:lloyd director:lucas actors:neeson) <br/>-id:652adcfa-c59c-4fa0-ace5-6345fec3cfff</span></pre><p id="d886" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">检查查询，我们可以清楚地看到MLTQParser的问题。MLTQParser查询将演员、导演和编剧的名字和姓氏分开，然后分别搜索每个名字，而不是他们的全名。在我看来，这是MLTQParser的一个错误，因为actors、director和writers多值字段中的每个值都用双引号括起来。查询应该将每个值视为一个精确的短语，而不是单个的搜索词。</p><p id="74b9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">考虑到MLTQParser的查询逻辑，现在很清楚为什么一部看似不相关的电影，如《在南街与我相遇:JC Dobbs的故事》，会出现在搜索结果中。检查评分解释的调试输出，我们看到以下内容。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="0d7c" class="nf lh it nb b gy ng nh l ni nj">"544637e5-e96d-4f62-9b22-5174c60ee512":"<br/>10.504457 = sum of:<br/>  10.504457 = sum of:<br/>    5.5608187 = weight(<strong class="nb iu">writers:george</strong> in 649) [SchemaSimilarity], result of:<br/>      5.5608187 = score(doc=649,freq=1.0 = termFreq=1.0<br/>), product of:<br/>        4.226696 = idf, computed as log(1 + (docCount - docFreq + 0.5) / (docFreq + 0.5)) from:<br/>          26.0 = docFreq<br/>          1814.0 = docCount<br/>        1.315642 = tfNorm, computed as (freq * (k1 + 1)) / (freq + k1 * (1 - b + b * fieldLength / avgFieldLength)) from:<br/>          1.0 = termFreq=1.0<br/>          1.2 = parameter k1<br/>          0.75 = parameter b<br/>          4.836273 = avgFieldLength<br/>          2.0 = fieldLength<br/>    4.943639 = weight(<strong class="nb iu">director:george</strong> in 649) [SchemaSimilarity], result of:<br/>      4.943639 = score(doc=649,freq=1.0 = termFreq=1.0<br/>), product of:<br/>        4.6206594 = idf, computed as log(1 + (docCount - docFreq + 0.5) / (docFreq + 0.5)) from:<br/>          20.0 = docFreq<br/>          2081.0 = docCount<br/>        1.069899 = tfNorm, computed as (freq * (k1 + 1)) / (freq + k1 * (1 - b + b * fieldLength / avgFieldLength)) from:<br/>          1.0 = termFreq=1.0<br/>          1.2 = parameter k1<br/>          0.75 = parameter b<br/>          2.3801057 = avgFieldLength<br/>          2.0 = fieldLength"</span></pre><p id="985b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">乔治·曼尼是《在南街遇见我:JC·多布斯的故事》的导演和编剧。乔治·曼尼和《星球大战:第一集——幽灵的威胁》的导演兼编剧乔治·卢卡斯同名。这是两部电影中人物之间唯一的相似之处。因此，有两个匹配项，一个是导演字段的匹配项，另一个是编剧字段的匹配项。不幸的是，同名会对MLTQParser的结果产生负面影响。</p><h1 id="13cd" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">同义词</h1><p id="6ef1" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">对于最后一个例子，我们将研究同义词与Solr的用法。关于电影索引，我们可以在标题、情节和类型字段上执行以下eDisMax搜索:“恐怖”或“恐怖片”或“恐怖片”或“邪恶片”或“恐怖片”，或者更简单地“恐怖片恐怖片恐怖片恐怖片恐怖片邪恶片”。基于这个搜索，我们将得到一个真正可怕的141部电影的集合。该搜索是有效的，因为它使用多个相似的搜索词来返回相似主题的更大的电影结果集。然而，搜索依赖于每个终端用户每次输入相同的相关搜索词。</p><p id="59bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">借助Solr的同义词功能，我们可以通过定义术语之间的同义词关系，在索引中构建一些智能。在Solr中有多种方法来定义术语之间的同义关系。<a class="ae lf" href="https://lucidworks.com/" rel="noopener ugc nofollow" target="_blank"> Lucidworks </a>有一篇优秀的文章，<a class="ae lf" href="https://doc.lucidworks.com/fusion/3.0/Collections/Synonyms-Files.html" rel="noopener ugc nofollow" target="_blank">同义词文件</a>，关于不同的同义词关系。我们将研究Lucidworks描述的三种类型的关系:替换同义词、单向扩展同义词和多路扩展同义词。</p><p id="c418" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在电影索引的<a class="ae lf" href="https://github.com/garystafford/searching-solr-vs-mongodb/blob/master/conf/synonyms.txt" rel="noopener ugc nofollow" target="_blank"> synonmys.txt </a>配置文件中，我已经为三种类型的关系预定义了一些示例。创建新索引时会创建该文件。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="7a8c" class="nf lh it nb b gy ng nh l ni nj">## Custom synonym groups for movies index ##</span><span id="2e38" class="nf lh it nb b gy nn nh l ni nj"># Replacement Synonyms examples<br/>scarey =&gt; scary<br/>ciborg =&gt; cyborg</span><span id="aff6" class="nf lh it nb b gy nn nh l ni nj"># Multiway Expansion Synonyms examples<br/>scary,slasher,spooky,evil,horror</span><span id="fa1f" class="nf lh it nb b gy nn nh l ni nj"># Oneway Expansion Synonyms examples<br/>droid =&gt; droid,android,robot,cyborg</span></pre><p id="be97" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个项目中有一个文件的副本，它将被运行在Docker容器中的movies索引使用。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi no"><img src="../Images/f7bc98f06e3e29ce39ac74b28397c564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*cyK6Rz33xfg-TZeO"/></div></div></figure><h2 id="92e9" class="nf lh it bd li nr ns dn lm nt nu dp lq kb nv nw lu kf nx ny ly kj nz oa mc ob bi translated">查询10a:替换同义词</h2><p id="94f6" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">我们将从替换同义词的例子开始。我为单词“cyborg”的常见拼写错误添加了以下同义词映射。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="07f1" class="nf lh it nb b gy ng nh l ni nj">ciborg =&gt; cyborg</span></pre><p id="8b6e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我们搜索术语“ciborg ”, Solr会用术语“cyborg”来代替它。我们可以通过查看查询来确认这一点，如下面的调试片段所示。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="d945" class="nf lh it nb b gy ng nh l ni nj">+(title:cyborg | plot:cyborg | genres:cyborg)</span></pre><p id="5e7d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">执行查询会返回两个文档，包括最著名的电子人——终结者阿诺德·施瓦辛格。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="fd4a" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>q: <strong class="nb iu">ciborg</strong><br/>kwargs: {<br/>  'defType': 'edismax', <br/>  'qf': 'title plot genres', <br/>  'fl': 'title, score', <br/>  'rows': '5'<br/>}</span><span id="09ff" class="nf lh it nb b gy nn nh l ni nj">Results<br/>----------<br/>document count: 2<br/>{'title': 'Terminator 2: Judgment Day', 'score': 8.17}<br/>{'title': "I'm a <strong class="nb iu">Cyborg</strong>, But That's OK", 'score': 7.13}</span></pre><h2 id="981f" class="nf lh it bd li nr ns dn lm nt nu dp lq kb nv nw lu kf nx ny ly kj nz oa mc ob bi translated">查询10b:单向扩展同义词</h2><p id="b1fe" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">接下来，我们将演示单向扩展同义词。我为单词“droid”添加了以下同义词映射。注意，我们必须在映射右侧和左侧的扩展同义词中包含单词“droid”。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="36c1" class="nf lh it nb b gy ng nh l ni nj"><strong class="nb iu">droid</strong> =&gt; <strong class="nb iu">droid</strong>,android,robot,cyborg</span></pre><p id="5b6c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当我们搜索术语“droid”时，Solr还会搜索同义词“android”、“robot”和“cyborg”。我们可以通过查看搜索词‘droid’的查询Solr结构来确认这一点，如下面的调试器代码片段所示。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="85b1" class="nf lh it nb b gy ng nh l ni nj">+(<br/>  Synonym(title:android title:cyborg title:droid title:robot) | <br/>  Synonym(plot:android plot:cyborg plot:droid plot:robot) | <br/>  Synonym(genres:android genres:cyborg genres:droid genres:robot)<br/>)</span></pre><p id="e3da" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意，反之则不然，因为这是一种单向关系。如果我们在“cyborg”上搜索，Solr将不会在“droid”、“android”和“robot”上搜索。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="a7a3" class="nf lh it nb b gy ng nh l ni nj">+(title:cyborg | plot:cyborg | genres:cyborg)</span></pre><p id="472d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">执行“droid”edis max查询返回15个文档。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="d376" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>q: <strong class="nb iu">droid</strong><br/>kwargs: {<br/>  'defType': 'edismax', <br/>  'qf': 'title plot genres', <br/>  'fl': 'title, score', <br/>  'rows': '5'<br/>}</span><span id="def4" class="nf lh it nb b gy nn nh l ni nj">Results<br/>----------<br/>document count: 15<br/>{'title': 'Robo Jî', 'score': 7.67}<br/>{'title': "I'm a <strong class="nb iu">Cyborg</strong>, But That's OK", 'score': 7.13}<br/>{'title': 'BV-01', 'score': 6.6}<br/>{'title': '<strong class="nb iu">Robot</strong> Chicken: DC Comics Special', 'score': 6.44}<br/>{'title': 'Terminator 2: Judgment Day', 'score': 6.23}</span></pre><h2 id="d787" class="nf lh it bd li nr ns dn lm nt nu dp lq kb nv nw lu kf nx ny ly kj nz oa mc ob bi translated">查询10c:多路扩展同义词</h2><p id="5c2b" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">最后，我们将演示多路扩展同义词。我为单词“吓人”添加了以下同义词映射。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="0be5" class="nf lh it nb b gy ng nh l ni nj">scary,slasher,spooky,evil,horror</span></pre><p id="c149" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我们对“吓人”这个词进行搜索，Solr还会搜索同义词“恐怖分子”、“幽灵”、“邪恶”和“恐怖”。与前面的例子不同，反过来也是正确的，因为这是一种多向关系。如果我们搜索五个同义词中的任何一个，Solr也会搜索其他四个词并返回相同的结果。我们可以通过查看术语“吓人”的查询Solr构造来确认这一点，如下面的调试片段所示。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="9c4d" class="nf lh it nb b gy ng nh l ni nj">+(Synonym(title:evil title:horror title:scari title:slasher <br/>  title:spooki) | Synonym(plot:evil plot:horror plot:scari <br/>  plot:slasher plot:spooki) | Synonym(genres:evil genres:horror <br/>  genres:scari genres:slasher genres:spooki))</span></pre><p id="26ad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">执行“吓人的”eDisMax查询返回141个文档。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="1171" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>q: <strong class="nb iu">scary</strong><br/>kwargs: {<br/>  'defType': 'edismax', <br/>  'qf': 'title plot genres', <br/>  'fl': 'title, score', <br/>  'rows': '5'<br/>}</span><span id="9583" class="nf lh it nb b gy nn nh l ni nj">Results<br/>----------<br/>document count: 141<br/>{'title': 'See No <strong class="nb iu">Evil</strong>, Hear No Evil', 'score': 7.9}<br/>{'title': 'The Evil Dead', 'score': 7.23}<br/>{'title': 'Evil Dead', 'score': 7.23}<br/>{'title': 'Evil Ed', 'score': 7.23}<br/>{'title': 'Evil Dead II', 'score': 6.37}</span></pre><p id="dbb3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可能已经注意到了我放在索引的synonmys.txt配置文件中的另一个替换同义词映射，如下所示。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="b231" class="nf lh it nb b gy ng nh l ni nj">scarey =&gt; scary</span></pre><p id="fcab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可能想知道，如果你输入了一个常见的拼写错误“scarey”作为搜索词，Solr会将该词替换为“吓人”并搜索“吓人”一词，但还会搜索它的四个同义词，“slasher”、“幽灵”、“邪恶”和“恐怖”。答案是否定的，Solr只会在‘吓人’上搜索。但是，Solr不会在同义词映射之间创建间接或次要的关系。您必须纠正拼写并正确输入术语，以利用多路关系。</p><h1 id="8263" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">用同义词管理独特的词汇</h1><p id="fe16" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">大公司、垂直行业、政府机构和其他实体经常使用独特的词汇。他们的词汇包括不常用的术语、短语、首字母缩写词、缩略语和其他习语。这些通常代表产品和服务、组织结构和技术术语。同义词是在索引中支持特定领域词汇的一种很好的方式。我们在Solr包含在<a class="ae lf" href="https://github.com/garystafford/searching-solr-vs-mongodb/blob/master/conf/synonyms.txt" rel="noopener ugc nofollow" target="_blank"> synonmys.txt </a>配置文件中的例子中看到了这一点。下面显示的两个例子演示了如何将多个缩写和技术术语与等量的计算相关联。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="364f" class="nf lh it nb b gy ng nh l ni nj"># Some synonym groups specific to this example<br/>GB,gib,gigabyte,gigabytes<br/>MB,mib,megabyte,megabytes</span></pre><h2 id="2df7" class="nf lh it bd li nr ns dn lm nt nu dp lq kb nv nw lu kf nx ny ly kj nz oa mc ob bi translated">10d:同义短语</h2><p id="1f4b" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">同义词的一个很大程度上没有记录的特性是能够在常见的首字母缩写词、缩写词、术语和短语之间创建同义关系。下面我提供了一些如何建立这些关系的例子。唯一明显的逻辑限制是，你不能在短语中使用停用词；一个不过度使用停用词的好理由。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="a667" class="nf lh it nb b gy ng nh l ni nj">ai,artificial intelligence<br/>cia,central intelligence agency<br/>fbi,federal bureau investigation<br/>lol,laughing out loud,league legends</span></pre><p id="030e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，如果我们在带有' lol '的同义词映射中包含完整的短语'英雄联盟'，当我在' LOL '上搜索时，Solr会忽略这个短语。但是，如果我们删除停用词“of”，那么Solr将创建一个查询，该查询需要两个术语“league”和“legends”，或者两个术语“law”和“loud”，或者单个术语“lol”。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="5803" class="nf lh it nb b gy ng nh l ni nj">+(<br/>  (((+title:laugh +title:out +title:loud) (+title:leagu +title:legend) title:lol)) | <br/>  (((+plot:laugh +plot:out +plot:loud) (+plot:leagu +plot:legend) plot:lol)) | <br/>  (((+genres:laugh +genres:out +genres:loud) (+genres:leagu +genres:legend) genres:lol))<br/>)</span></pre><p id="7082" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="bd63" class="nf lh it nb b gy ng nh l ni nj">Parameters<br/>----------<br/>q: lol<br/>kwargs: {<br/>  'defType': 'edismax', <br/>  'qf': 'title plot genres', <br/>  'fl': 'title, score', <br/>  'rows': '5'<br/>}</span><span id="b1d3" class="nf lh it nb b gy nn nh l ni nj">Results<br/>----------<br/>document count: 1<br/>{'title': 'JK LOL', 'score': 9.05}</span></pre><h1 id="e6ab" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">结论</h1><p id="61a0" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">通过了解Apache Solr的功能、索引中包含的数据的特征以及最终用户的搜索模式，您将能够精心设计查询，以确保响应包含高质量的相关搜索结果。</p><p id="cb11" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文中的查询示例只展示了Solr巨大搜索能力的一小部分。这两个Python脚本中都有几个额外的查询示例，您可以取消注释并进一步研究它们的结果。</p><p id="f979" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Solr的文档非常好；要了解更多关于Solr的功能，我建议在当前的Solr 7.6版文档中查看各种解析器及其选项。</p><ul class=""><li id="dd3f" class="mj mk it js b jt ju jx jy kb ml kf mm kj mn kn mo mp mq mr bi translated"><a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/the-standard-query-parser.html#the-standard-query-parser" rel="noopener ugc nofollow" target="_blank">标准查询解析器</a></li><li id="c086" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated"><a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/the-dismax-query-parser.html#the-dismax-query-parser" rel="noopener ugc nofollow" target="_blank">DisMax查询解析器</a></li><li id="7ef5" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated"><a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/the-extended-dismax-query-parser.html#the-extended-dismax-query-parser" rel="noopener ugc nofollow" target="_blank">扩展的DisMax查询解析器</a></li><li id="63e5" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated"><a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/other-parsers.html#other-parsers" rel="noopener ugc nofollow" target="_blank">其他解析器</a></li></ul><p id="a94c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我还建议回顾一下Solr的分析器、标记器和过滤器，了解它们如何影响Solr索引文档的方式，以及Solr在执行搜索时如何解释索引的内容。</p><ul class=""><li id="d5a7" class="mj mk it js b jt ju jx jy kb ml kf mm kj mn kn mo mp mq mr bi translated"><a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/understanding-analyzers-tokenizers-and-filters.html#using-analyzers-tokenizers-and-filters" rel="noopener ugc nofollow" target="_blank">分析器、记号赋予器和过滤器</a></li><li id="942d" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated"><a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/tokenizers.html#tokenizers" rel="noopener ugc nofollow" target="_blank">记号赋予者</a></li><li id="06e4" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated"><a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/filter-descriptions.html" rel="noopener ugc nofollow" target="_blank">滤镜描述</a></li><li id="4946" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated"><a class="ae lf" href="https://lucene.apache.org/solr/guide/7_6/language-analysis.html#language-analysis" rel="noopener ugc nofollow" target="_blank">语言分析</a></li></ul><p id="38d4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文表达的所有观点都是我个人的，不一定代表我现在或过去的雇主或他们的客户的观点。</p><p id="dcda" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="oc">特写插图版权:</em> <a class="ae lf" href="https://www.123rf.com/profile_varijanta" rel="noopener ugc nofollow" target="_blank"> <em class="oc">德扬博济奇</em></a><em class="oc">(</em><a class="ae lf" href="https://www.123rf.com/" rel="noopener ugc nofollow" target="_blank"><em class="oc">123 RF</em></a><em class="oc">)</em></p></div></div>    
</body>
</html>