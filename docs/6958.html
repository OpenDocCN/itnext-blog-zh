<html>
<head>
<title>Angular — an interceptor interview question with a tricky aspect</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">棱角——拦截器面试中一个棘手的问题</h1>
<blockquote>原文：<a href="https://itnext.io/angular-an-interceptor-interview-question-with-a-tricky-aspect-5a0d1616c74b?source=collection_archive---------1-----------------------#2022-04-26">https://itnext.io/angular-an-interceptor-interview-question-with-a-tricky-aspect-5a0d1616c74b?source=collection_archive---------1-----------------------#2022-04-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/18bca07763de3ce875c4f1ea0adffb29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5S2CV1h1XqKHhPv2BYXZPA.png"/></div></div></figure><div class=""/><p id="98cf" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">假设有一个角度应用，我们有以下要求:</p><blockquote class="kw kx ky"><p id="959d" class="jy jz kz ka b kb kc kd ke kf kg kh ki la kk kl km lb ko kp kq lc ks kt ku kv ij bi translated">API的主要版本发生了变化，现在每个对我们的API的HTTP调用都应该有一个特定的头，比如X-APP。我们需要一种快速可靠的方法来尽快进行必要的更改。有什么想法吗？</p></blockquote><p id="c3e8" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">常见的答案和一个好方法是在应用程序或核心模块中使用拦截器，并在传出的请求中添加必要的头。这种实现快速且易于理解。它使用框架特性，被认为是最佳实践。</p><p id="d895" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kz">拦截器是HttpClient的可选依赖项。我们必须在提供HttpClient的同一个注射器中提供它。否则，将创建没有拦截器依赖关系的实例，拦截器将被忽略。</em></p><figure class="ld le lf lg gt is"><div class="bz fp l di"><div class="lh li l"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">拦截器将在请求中添加丢失的头。</figcaption></figure><figure class="ld le lf lg gt is"><div class="bz fp l di"><div class="lh li l"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">我们将拦截器添加到应用程序或核心模块的提供者数组中。</figcaption></figure><p id="2416" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">后续问题来了:</p><blockquote class="kw kx ky"><p id="e68d" class="jy jz kz ka b kb kc kd ke kf kg kh ki la kk kl km lb ko kp kq lc ks kt ku kv ij bi translated">这是一个很好的方法，而且确实很快。好，我们假设你在app模块中添加了拦截器，现在一切都好了吗？有没有可能出现解决方案受损的边缘情况？</p></blockquote><p id="da33" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">拦截器要和HttpClientModule <em class="kz">(多数情况下是app或者核心模块)</em>放在同一个模块里。<strong class="ka jc"> <em class="kz">因此，</em> </strong> <strong class="ka jc"> <em class="kz">我们必须确保我们的整个应用程序使用HttpClientModule的这个确切实例，它是用我们的拦截器创建的。</em>T12】</strong></p><p id="77a3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，如果有另一个HttpClient的提供者(例如，一个惰性加载的模块)，我们将面临前面提到的问题(缺少拦截器)，所以我们应该在提供HttpClient的所有模块的<code class="fe ln lo lp lq b">providers: []</code>中添加拦截器。</p><p id="4326" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们有了一个快速可靠的解决方案。</p><p id="db8b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">享受🚀🚀🚀</p></div></div>    
</body>
</html>