<html>
<head>
<title>Automating Security List Rule reviews in Oracle Cloud Infrastructure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Oracle云基础设施中自动审查安全列表规则</h1>
<blockquote>原文：<a href="https://itnext.io/automating-security-list-rule-reviews-in-oracle-cloud-infrastructure-317a31b7f76e?source=collection_archive---------1-----------------------#2022-10-29">https://itnext.io/automating-security-list-rule-reviews-in-oracle-cloud-infrastructure-317a31b7f76e?source=collection_archive---------1-----------------------#2022-10-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/2bf909b16a48c0ab67576c701282ebe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*92HE3jE-hvZnQXJk"/></div></div></figure><p id="dfe4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您在Oracle云基础设施(OCI)中运行工作负载，那么您可能会熟悉虚拟云网络(VCN)资源，如子网、路由表、网关等。这些软件定义的组件允许您在OCI构建网络，以便部署和运行您的工作负载。</p><p id="87a4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">甲骨文有<a class="ae kw" href="https://docs.oracle.com/en-us/iaas/Content/Network/Concepts/waystosecure.htm" rel="noopener ugc nofollow" target="_blank">文档</a>解释VCN访问和安全特性，包括<a class="ae kw" href="https://docs.oracle.com/en-us/iaas/Content/Network/Concepts/securityrules.htm" rel="noopener ugc nofollow" target="_blank">安全规则</a>、<a class="ae kw" href="https://docs.oracle.com/iaas/security-zone/using/security-zones.htm" rel="noopener ugc nofollow" target="_blank">安全区域</a>、本地和<a class="ae kw" href="https://docs.oracle.com/en/solutions/oci-network-firewall/index.html" rel="noopener ugc nofollow" target="_blank">网络防火墙</a>以及<a class="ae kw" href="https://docs.public.oneportal.content.oci.oraclecloud.com/en-us/iaas/Content/Identity/Concepts/commonpolicies.htm" rel="noopener ugc nofollow" target="_blank"> IAM策略</a>等。安全规则由<a class="ae kw" href="https://docs.oracle.com/en-us/iaas/Content/Network/Concepts/securitylists.htm#Security_Lists" rel="noopener ugc nofollow" target="_blank">安全列表</a>和<a class="ae kw" href="https://docs.oracle.com/en-us/iaas/Content/Network/Concepts/networksecuritygroups.htm#Network_Security_Groups" rel="noopener ugc nofollow" target="_blank">网络安全组</a> (NSG的)组成，是您创建的每个VCN和子网的基本元素。它们定义了允许哪些流量进出您的子网，以及哪些主机可以相互通信。创建子网时，会自动创建一个包含一些默认规则的安全列表:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kx"><img src="../Images/2088dd937e1e2becc5fd2d0521b2cc8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*H-2jv9uJq5BMxlwp"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated"><em class="lg">默认安全列表入口规则</em></figcaption></figure><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lh"><img src="../Images/c81aabbeb319b3c9cd51f67cae23c3c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VabghoH2NsIL0mvU"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated"><em class="lg">默认安全列表出口规则</em></figcaption></figure><p id="56e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在实施网络访问控制时，您可以使用安全列表、网络安全组或两者兼有。它们是在数据包级别控制流量的虚拟防火墙功能。我将在以后的帖子中介绍网络安全组的审查，因为我想重点介绍安全列表，特别是如何轻松审查和验证规则，以确保它们符合您的工作负载、组织、安全和合规性要求。</p><h1 id="916e" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">为什么要执行规则审查？</h1><p id="b7f0" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated">因为这是很好的安全操作。通过定期检查规则，可以发现并纠正错误配置和错误，从而降低发生安全事故的可能性。许多信息安全和合规性标准，如支付卡行业数据安全标准(PCI DSS)或国家标准与技术研究所(NIST)特别出版物800–41，要求或建议组织至少每季度或每半年审查一次防火墙规则。为了履行合规义务，您可能还需要记录并向审计员提供证据，证明定期执行了规则审查并采取了所有必要的措施。</p><h1 id="ee4c" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">简化审查过程</h1><p id="12d0" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated">如果您计划进行评审，通常需要首先充分了解以下几件事情:</p><ul class=""><li id="8e57" class="ml mm iq ka b kb kc kf kg kj mn kn mo kr mp kv mq mr ms mt bi translated">网络架构是什么样的，是否有最新的文档、图表和需求。</li><li id="96cb" class="ml mm iq ka b kb mu kf mv kj mw kn mx kr my kv mq mr ms mt bi translated">什么是批准的流量，例如云到本地、云内或进出互联网。</li><li id="a10c" class="ml mm iq ka b kb mu kf mv kj mw kn mx kr my kv mq mr ms mt bi translated">需要什么流量协议(TCP / UDP / ICMP)和端口。</li><li id="49a4" class="ml mm iq ka b kb mu kf mv kj mw kn mx kr my kv mq mr ms mt bi translated">是否存在由于服务被移动、重新设计或退役而不再需要的任何流。</li></ul><p id="94f5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有时，并不总是能够获得所有需要的信息。最近，我发现自己处于这种情况，我开始思考如何通过查看OCI现有的工作负载流量来审查安全列表规则。</p><p id="dcb9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">OCI网络服务允许您启用<a class="ae kw" href="https://docs.oracle.com/en-us/iaas/Content/Network/Concepts/vcn_flow_logs.htm" rel="noopener ugc nofollow" target="_blank"> VCN流量日志</a>，它记录了与位于您子网内的<a class="ae kw" href="https://docs.oracle.com/en-us/iaas/Content/Network/Tasks/managingVNICs.htm" rel="noopener ugc nofollow" target="_blank">VNIC</a>建立的每个流量或连接。使用VCN流量遥测和安全列表规则定义，我构建了一个在OCI运行的工具，它可以:</p><ul class=""><li id="2b1f" class="ml mm iq ka b kb kc kf kg kj mn kn mo kr mp kv mq mr ms mt bi translated">由于端口范围和IP范围重叠，识别安全列表中的冗余规则:</li></ul><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/8496b84f0c761d3a00cf060544bc5f82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Y96v92vuxo3eeLP0"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">重叠安全性列表规则的示例</figcaption></figure><ul class=""><li id="91ba" class="ml mm iq ka b kb kc kf kg kj mn kn mo kr mp kv mq mr ms mt bi translated">识别不在VCN流量日志中观察到的网络流量路径中的安全列表规则和子网:</li></ul><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/de093c41a19284216b7c52160e3048ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1hDrTVNHqgGAnP38"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">安全性列表规则评估示例</figcaption></figure><ul class=""><li id="348c" class="ml mm iq ka b kb kc kf kg kj mn kn mo kr mp kv mq mr ms mt bi translated">了解允许在VCN流量日志中观察流量所需的最低规则是什么:</li></ul><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/8910041878d5aad099ed3cf610483c9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-KaIy6OXgI3TYq4M"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">最低安全性列表规则示例</figcaption></figure><p id="2671" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用上面的示例信息，我可以轻松识别:</p><ul class=""><li id="0626" class="ml mm iq ka b kb kc kf kg kj mn kn mo kr mp kv mq mr ms mt bi translated">可能过于宽松的规则，例如允许10.0.0.0/8中所有协议和端口的入口规则，它还与10.12.15.128/27中更严格的入口规则TCP端口443重叠。</li><li id="9def" class="ml mm iq ka b kb mu kf mv kj mw kn mx kr my kv mq mr ms mt bi translated">潜在的规则方向错误，例如入口规则允许来自Oracle服务网络(OSN)的所有协议和端口，因为我知道我的工作负载连接仅出站到OSN。</li><li id="c803" class="ml mm iq ka b kb mu kf mv kj mw kn mx kr my kv mq mr ms mt bi translated">哪些规则可能不再需要，例如来自172.16.0.0/24的用于IDAM访问的入口规则，因为没有流日志匹配该规则。</li><li id="3b3c" class="ml mm iq ka b kb mu kf mv kj mw kn mx kr my kv mq mr ms mt bi translated">不应该被允许的潜在访问，例如来自10.25.15.128/27的HTTPS流量，因为我知道这个源网络是要退役的。</li><li id="9fda" class="ml mm iq ka b kb mu kf mv kj mw kn mx kr my kv mq mr ms mt bi translated">可能应该允许但当前被拒绝的流量，例如端口3389上的入站UDP RDP流量。</li></ul><p id="feec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您能够做出的断言将与我的不同，因为它们是特定于工作负载、网络和环境的。在我的案例中，我需要从报告中获取信息，并与相关团队交谈，以理解为什么规则存在以及为什么需要流程。</p><p id="862a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从这里开始，我使用工具和团队洞察力作为输入来通知需要删除、添加或修改什么规则。因为此工具依赖于VCN流量日志遥测，所以最小规则是根据实际观察到的流量作为有状态规则计算的，其范围为:</p><ul class=""><li id="e471" class="ml mm iq ka b kb kc kf kg kj mn kn mo kr mp kv mq mr ms mt bi translated">同一个VCN中另一个子网的CIDR块，或者</li><li id="5f0a" class="ml mm iq ka b kb mu kf mv kj mw kn mx kr my kv mq mr ms mt bi translated">一个/24或/16 CIDR地址块，它与同一个VCN中的任何其它CIDR子网都不匹配。</li></ul><p id="4ac6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将CIDR的范围限定到最大值/24或/16是一个有意识的决定，因为我不想让规则将CIDR的范围限定到/8或/0，对一个人来说，解释所需的较小的CIDR范围并在合适的情况下扩展到/8更有意义。因此，在进行任何更改之前，确认工作负载所需的确切源和目标CIDR、协议和端口范围非常重要。例如，我可能会确定我的本地网络10.0.0.0/8应该能够访问我在TCP端口4443上的工作负载，并因此替换10.60.3.0/24和10.80.64.0/24的规则。</p><h1 id="9ebf" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">设置和配置</h1><p id="54bf" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated">要自己运行此工具，您首先需要为您希望评估相关安全列表规则的所有OCI区域和子网启用VCN流日志。我建议为所有VCN子网启用VCN流日志。</p><p id="ec5d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于每个子网，启用流日志。启用第一个子网VCN流日志时，创建一个新的日志组。启用后续VCN流日志时，选择现有日志组:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/625030a4997d6f81a212a0d6a9e7a392.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ly5yKM_KbOb2tOEV"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated"><em class="lg">启用VCN流量日志</em></figcaption></figure><p id="63c1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们需要在启用了VCN流日志的每个区域创建对象存储桶。确保所有存储桶具有相同的名称:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/49f5c6bc2be791b253051d7519788ec1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NkSGO5ShrWyXvYOA"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated"><em class="lg">创建VCN流量日志对象存储桶</em></figcaption></figure><p id="5abb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们需要在每个OCI地区创建服务连接器，以将我们的日志从记录推到对象存储。选择您在源连接中启用的每个VCN流日志。选择您之前创建的对象存储桶作为目标。确保在创建服务连接器之前还单击了“创建默认策略”。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/e59b008c6c123c3781496fd9e38b0b47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6k6g1GIEV4EVi4z2"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated"><em class="lg">创建服务连接器</em></figcaption></figure><p id="e9c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这就是设置完成。几分钟后，您应该会在对象存储桶中看到日志:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kx"><img src="../Images/6c94b979b9f36f3d49bc4544cdcb87f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4SEAXGaam0Ts4FTX"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated"><em class="lg">对象存储桶中的流量日志</em></figcaption></figure><p id="2eaf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">继续之前，请务必留出足够的时间来观察和记录所有流量。如前所述，该工具依赖于VCN流量日志，如果没有观察到流量，它可能会将所需的规则标记为未使用，或者忽略最小所需流量的规则。在我的情况下，我等待了一周(7天)以确保所有典型的交通流量都被捕获。7天后，我的对象存储桶中大约有1，300个文件，总容量为3GB。</p><h1 id="f317" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">运行工具</h1><p id="453c" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated">要运行该工具，您需要创建一个MySQL数据库系统，并在OCI计算实例来运行<a class="ae kw" href="https://hub.docker.com/r/scottfletcher/network-advisor" rel="noopener ugc nofollow" target="_blank"> Docker容器</a>。适当地调整数据库系统和计算实例的规模对于确保该工具能够在合理的时间范围内导入和处理所有数据非常重要。</p><p id="7199" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，使用向导创建一个具有互联网连接的虚拟云网络:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/fec41006ad893ca4b4601dccf5f4c829.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tJFJtpKrKRhMbX3b"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated"><em class="lg">虚拟云网向导</em></figcaption></figure><p id="ded0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，在私有子网的安全列表中添加一个入口规则。这将允许我们的计算实例与我们将在专用子网中创建的数据库系统进行对话:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/175ae594b1f86e5a01962c409afb84c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BQ62n87EdxVTalf7"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated"><em class="lg">私有子网安全列表入口规则</em></figcaption></figure><p id="935c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于DB系统，我在私有子网中创建了一个独立的实例。我最初选择的形状是MySQL。虚拟机标准版E4.8.128GB，带200GB存储。运行该工具后，我验证了我已经导入了近8000万条记录:</p><pre class="ky kz la lb gt nd ne nf ng aw nh bi"><span id="a475" class="ni lj iq ne b gy nj nk l nl nm">mysql&gt; select count(*) from flowlogs;<br/>+----------+<br/>| count(*) |<br/>+----------+<br/>| 79291781 |<br/>+----------+<br/>1 row in set (2.61 sec)</span></pre><p id="3aff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">数据库系统使用了所分配的128GB内存的80%以上:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/f8f3b60e84ffffb12982642d621b388e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HgN_WnPl9aKYV-1x"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated"><em class="lg"> MySQL DB系统内存利用率</em></figcaption></figure><p id="718c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">查看我的磁盘利用率，我可以看到我大约使用了200GB的50%,所以我知道下次运行该工具时我可能会分配更少的磁盘存储:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/a755a40ef0cb73160b5b26fc951ca858.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TjS1K1yj1AasA83d"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated"><em class="lg"> MySQL DB系统磁盘空间利用率</em></figcaption></figure><p id="605e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根据对象存储桶中的文件数量，以及您希望脚本运行的速度，您可能希望选择更合适的形状。如果您不确定，您可以选择一个更大的形状，并在工具运行后查看度量。</p><p id="70e9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">继续在私有子网中创建一个MySQL DB系统。记下您输入的用户名和密码，因为您稍后会用到。我还禁用了备份，因为不需要备份。</p><p id="cc16" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，在公共子网中创建一个计算实例。我选了一个Ubuntu 22.04镜像，AMD。带有4个OCPU和32GB内存的E4 Flex外形。</p><p id="e4c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">更新您的SSH配置文件，并为该主机添加一个条目。我们添加了一个LocalForward，这样我们就可以查看该工具生成的报告，而不必将端口暴露给互联网，也不必从docker容器中复制文件:</p><pre class="ky kz la lb gt nd ne nf ng aw nh bi"><span id="4003" class="ni lj iq ne b gy nj nk l nl nm">Host network-analyzer<br/>    Hostname &lt;Public IP Address&gt;<br/>    User ubuntu<br/>    ServerAliveInterval 60<br/>    IdentityFile ~/.ssh/oci_ssh.key<br/>    LocalForward 8000 127.0.0.1:8000</span></pre><p id="e3ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">连接到实例并安装Docker:</p><pre class="ky kz la lb gt nd ne nf ng aw nh bi"><span id="e4b9" class="ni lj iq ne b gy nj nk l nl nm">$ ssh network-analyzer</span><span id="0f1f" class="ni lj iq ne b gy no nk l nl nm">$ sudo apt-get install -y ca-certificates curl gnupg lsb-release</span><span id="34d0" class="ni lj iq ne b gy no nk l nl nm">$ sudo mkdir -p /etc/apt/keyrings</span><span id="2c6c" class="ni lj iq ne b gy no nk l nl nm">$ curl -fsSL <a class="ae kw" href="https://download.docker.com/linux/ubuntu/gpg" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/ubuntu/gpg</a> | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg</span><span id="698a" class="ni lj iq ne b gy no nk l nl nm">$ echo   "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] <a class="ae kw" href="https://download.docker.com/linux/ubuntu" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/ubuntu</a> \<br/>$(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><span id="e21c" class="ni lj iq ne b gy no nk l nl nm">$ sudo apt-get update</span><span id="10fe" class="ni lj iq ne b gy no nk l nl nm">$ sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin</span><span id="5218" class="ni lj iq ne b gy no nk l nl nm">$ newgrp docker</span><span id="ad26" class="ni lj iq ne b gy no nk l nl nm">$ sudo usermod -aG docker $USER</span></pre><p id="84b8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们需要将我们的OCI API键和配置复制到实例中，因为我们将映射。oci文件夹添加到Docker容器，这样它就可以调用OCI来检索存储在对象存储中的VCN、子网、安全列表和流日志。为此，您可能希望创建一个唯一的只读用户。</p><pre class="ky kz la lb gt nd ne nf ng aw nh bi"><span id="6c5e" class="ni lj iq ne b gy nj nk l nl nm">$ scp -r ~/.oci network-analyzer:.</span></pre><p id="a248" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们可以运行<a class="ae kw" href="https://hub.docker.com/r/scottfletcher/network-advisor" rel="noopener ugc nofollow" target="_blank"> Docker容器</a>。在本例中，我只为ap-melbourne-1地区运行该工具。如果您想在多个地区运行它，那么您可以用逗号分隔的列表输入它们，例如“ap-melbourne-1，ap-sydney-1”。</p><pre class="ky kz la lb gt nd ne nf ng aw nh bi"><span id="43ca" class="ni lj iq ne b gy nj nk l nl nm">docker run -it --name network-analyser \<br/>--mount type=bind,source=/home/ubuntu/.oci/,target=/root/.oci/,readonly \<br/>-e OCI_REGIONS=ap-melbourne-1 \<br/>-e DB_USERNAME=&lt;username of the db system&gt; \<br/>-e DB_PASSWORD=&lt;password of the db system&gt; \<br/>-e DB_HOST=&lt;IP address of the DB System&gt; \<br/>-e DB_PORT=3306 \<br/>-e OCI_CLI_PROFILE=&lt;OCI profile name&gt; \<br/>-e FLOW_LOG_BUCKET_NAME=&lt;The bucket holding your VCN flow logs&gt; \<br/>-p 8000:8000 \<br/>scottfletcher/network-advisor</span></pre><p id="ea9e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Docker将提取最新的容器，连接到数据库系统，创建数据库模式，从对象存储中下载流日志文件，然后开始导入和分析数据:</p><pre class="ky kz la lb gt nd ne nf ng aw nh bi"><span id="382f" class="ni lj iq ne b gy nj nk l nl nm">Unable to find image 'scottfletcher/network-advisor:latest' locally<br/>latest: Pulling from scottfletcher/network-advisor<br/>eaead16dc43b: Pull complete <br/>753dfbed0c96: Pull complete <br/>7af94765911a: Pull complete <br/>7654989bc5b3: Pull complete <br/>3ef60200484e: Pull complete <br/>c10782f37fdf: Pull complete <br/>a2f0acfe530e: Pull complete <br/>e921fc787b87: Pull complete <br/>447c769910e8: Pull complete <br/>439c929a1f70: Pull complete <br/>ae5f4991b66e: Pull complete <br/>413dda94b7b9: Pull complete <br/>da662d9d7c74: Pull complete <br/>dccb605069ec: Pull complete <br/>ca50647e8508: Pull complete <br/>Digest: sha256:2298a5aa3c423b1243891919f7f23543ceee94d01bcc6e33210f3fea32f3d873<br/>Status: Downloaded newer image for scottfletcher/network-advisor:latest<br/>Downloading VCN Flow logs<br/>Downloaded item  [####################################]  100%<br/>Importing VCN Flow logs<br/>[#</span></pre><p id="fd81" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从1，300个文件和16个子网导入和分析80M流量日志大约需要3个小时。进度和阶段将显示在屏幕上。该过程完成后，您将看到:</p><pre class="ky kz la lb gt nd ne nf ng aw nh bi"><span id="41ae" class="ni lj iq ne b gy nj nk l nl nm">******************************<br/>* Report Generation Complete *<br/>* View Report <a class="ae kw" href="http://ip:8000" rel="noopener ugc nofollow" target="_blank">http://ip:8000</a> *<br/>******************************<br/>[2022-10-29 00:43:26] INFO  WEBrick 1.7.0<br/>[2022-10-29 00:43:26] INFO  ruby 2.7.0 (2019-12-25) [x86_64-linux-gnu]<br/>[2022-10-29 00:43:26] INFO  WEBrick::HTTPServer#start: pid=10 port=8000</span></pre><p id="28f5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从您的本地机器上，您将能够连接到<a class="ae kw" href="https://localhost:8000" rel="noopener ugc nofollow" target="_blank"> https://localhost:8000 </a>并查看生成的报告:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi np"><img src="../Images/11f3de0db1b0b4ab68068b39f82ad4f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Rg-FI925PUXHUP9J"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated"><em class="lg">包含HTML报告的目录</em></figcaption></figure><p id="22e4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">单击报告将在屏幕上显示它:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/72723c526a59a6d478fcab4ecc79ec4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jHtMQ_IWE03ySO6S"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated"><em class="lg">AP-Melbourne-1的示例报告</em></figcaption></figure><p id="ee28" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，您可以检查结果并进行安全性列表规则复查。</p><p id="a48c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您需要验证报告中的任何发现，您可以在<a class="ae kw" href="https://docs.oracle.com/en-us/iaas/Content/Logging/Concepts/loggingoverview.htm" rel="noopener ugc nofollow" target="_blank"> OCI日志</a>中搜索流量日志，或者使用mysql客户端直接查询DB系统。</p><p id="8f67" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要重新运行该工具，只需启动另一个Docker容器。确保在生成所需的报告时保存它们，因为这些报告在容器中是短暂的，并且容器在启动时也会删除并重新创建DB系统模式。</p><p id="c1a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安全列表规则审查不需要繁琐、耗时或重复。您可以使用此工具来帮助识别规则蔓延、错误，并验证满足您的工作负载、组织、安全性和法规遵从性要求所需的最小规则集。</p><p id="db4a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你有任何问题或意见，请随时通过LinkedIn<a class="ae kw" href="https://www.linkedin.com/in/scotti-fletcher/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/scotti-fletcher/</a>与我联系</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/041445a3a4a32722c76c96dec83ac351.png" data-original-src="https://miro.medium.com/v2/resize:fit:84/0*nID2zlX8Gu4-kwFb"/></div></figure></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><p id="844d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="ny">原载于2022年10月29日</em><a class="ae kw" href="https://redthunder.blog/2022/10/29/automating-security-list-rule-reviews-in-oracle-cloud-infrastructure/" rel="noopener ugc nofollow" target="_blank"><em class="ny">http://red thunder . blog</em></a><em class="ny">。</em></p></div></div>    
</body>
</html>