<html>
<head>
<title>How-To: Kubernetes Cluster Network Security</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何:Kubernetes集群网络安全</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-kubernetes-cluster-network-security-f19bc99161f5?source=collection_archive---------4-----------------------#2020-01-22">https://itnext.io/how-to-kubernetes-cluster-network-security-f19bc99161f5?source=collection_archive---------4-----------------------#2020-01-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b09c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如您现在可能已经意识到的,[任何] GKE集群上的POD(容器)到POD(容器)通信对所有名称空间和所有POD都可用，主要限制因素是终端容器端口配置本身。否则，如果没有任何特定于容器的标头白名单，就可以不受任何限制地远程登录到其他容器端口。</p><p id="4a60" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这在用于质量保证和故障排除的<strong class="jp ir">开发</strong>和潜在<strong class="jp ir">试运行</strong>环境中是可以接受的，但应在生产GKE集群中进一步锁定</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/bc24fb165ee42210f98e73dbfb1db52c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9JlfTyjc1yeQR2fjrHmF0g.png"/></div></div></figure><p id="7fc5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">值得注意的是，虽然GKE集群附带了集群本地网络(IP别名，在更大的谷歌云网络上持续存在，并受谷歌云平台防火墙规则的约束)，但鉴于POD IP的短暂性质，几乎没有提供粒度来管理应用程序到应用程序通信的细微差别。</p><p id="f645" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">默认选项以<a class="ae kx" href="https://kubernetes.io/docs/concepts/services-networking/network-policies/" rel="noopener ugc nofollow" target="_blank">网络策略</a>的形式在相关的GKE集群级别提供并实施。</p><h1 id="d653" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">防火墙规则和网络策略之间的一个重要区别是:</h1><p id="b278" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">pod通过选择它们的网络策略而变得孤立。一旦命名空间中的任何网络策略选择了特定的pod，该pod将拒绝任何网络策略不允许的任何连接。(命名空间中未被任何网络策略选择的其他pod将继续接受所有流量。)</p><p id="860d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">网络策略“防火墙”方向和选择器</strong></p><p id="3760" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以对两种类型的流量方向应用限制性策略，还可以使用两个选择器来选择特定的pod或命名空间</p><ul class=""><li id="e988" class="mb mc iq jp b jq jr ju jv jy md kc me kg mf kk mg mh mi mj bi translated"><strong class="jp ir">出口</strong> —用于离开指定pod(通过podSelector)或命名空间(通过namespaceSelector)的流量</li><li id="207a" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated"><strong class="jp ir">入口</strong> —用于到达指定pod(通过podSelector)或命名空间(通过namespaceSelector)的流量</li></ul><h1 id="8c46" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">基于标记的“防火墙”网络策略示例</h1><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="f9a2" class="mu kz iq mq b gy mv mw l mx my">...<br/>  ingress:<br/>  - from:<br/>    - namespaceSelector:<br/>        matchLabels:<br/>          app: api-proxy<br/>    - podSelector:<br/>        matchLabels:<br/>          app: redis<br/>  ...</span></pre><ul class=""><li id="b1e9" class="mb mc iq jp b jq jr ju jv jy md kc me kg mf kk mg mh mi mj bi translated">默认情况下，这将把从该集群内的任何其他POD(容器)对POD(容器)的任何访问列入黑名单。</li><li id="c6d4" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated">按照规定，这将把所有端口所有访问列入白名单，从名称空间:api-proxy到标签为app: redis的PODs(container ),后者可以在任何其他名称空间中。</li></ul><h1 id="4890" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">精细的网络策略控制</h1><p id="c224" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">您可以在一个NetworkPolicy定义中定义入口和出口规则，并对允许此类应用程序访问的端口进行一定程度的细化。</p><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="dcdf" class="mu kz iq mq b gy mv mw l mx my">apiVersion: networking.k8s.io/v1<br/>kind: NetworkPolicy<br/>metadata:<br/>  name: api-netpolicy<br/>spec:<br/>  podSelector:<br/>    matchLabels:<br/>      app: api<br/>  policyTypes:<br/>  - Ingress<br/>  - Egress<br/>  <br/>  ingress:<br/>  - from: [] # only accessible from the ALL on port 80<br/>    ports:<br/>     - port: 80<br/>       protocol: TCP<br/>       <br/>  egress:<br/>  - to:<br/>    - podSelector:<br/>        matchLabels:<br/>          app: redis<br/>    ports:<br/>     - port: 6973<br/>       protocol: TCP<br/>  - to:<br/>    - namespaceSelector:<br/>        matchLabels:<br/>          name: kube-system<br/>      podSelector:<br/>        matchLabels:<br/>          k8s-app: kube-dns<br/>    ports:<br/>     - port: 53<br/>       protocol: UDP</span></pre><p id="7a73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">孔蒂诺有许多激动人心的Kubernetes项目。如果您正在寻找最新最棒的基础设施堆栈或寻找挑战，请联系我们！我们正在招聘，寻找各个层次的聪明人。在Contino，我们自豪地为中型企业和大型企业提供最佳实践云转型项目。</p><p id="1a7e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kx" href="https://www.linkedin.com/in/johas/" rel="noopener ugc nofollow" target="_blank"> JP </a></p></div></div>    
</body>
</html>