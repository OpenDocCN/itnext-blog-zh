<html>
<head>
<title>Dev Joy: Making Authorization for Internal Web Apps Simple</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Dev Joy:简化内部Web应用的授权</h1>
<blockquote>原文：<a href="https://itnext.io/dev-joy-making-authorization-for-internal-web-apps-simple-e51bd1a2c04c?source=collection_archive---------2-----------------------#2022-04-10">https://itnext.io/dev-joy-making-authorization-for-internal-web-apps-simple-e51bd1a2c04c?source=collection_archive---------2-----------------------#2022-04-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="26a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我和oauth或者组装基础auth战斗了这么久，都没有让我开心过。不再有了！我们开发者可以把它留在过去。下面是我构建一个简单的小型内部web应用程序的新方法:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/e39bab0e857b5d31ff992caa55d2e168.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/format:webp/1*jSeqQr4hPkNG5pzB_-DfoA.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">祝你好运，我落后2个代理</figcaption></figure><p id="0e5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一步:为50个用户支付Cloudflare $0。说真的，你可以免费设置这个。添加一个域名“my domain . com ”, cloud flare必须对其进行DNS授权。(抱歉，你不能在他们的免费计划上添加像devs.mycompany.com这样的子域。他们必须是权威的二级域名。)现在，Cloudflare可以做的一件很酷的事情是<strong class="jp ir">代理</strong> HTTPS流量到该域。Cloudflare Zero Trust还可以强制对IDP进行身份验证，并在向您的应用程序源发送请求以及简单的JWT之前，仅授权您允许的用户。</p><p id="a63a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二步:为3亿个HTTP API请求向AWS支付1美元。(加上Lambda成本等。)不幸的是，他们内置的JWT授权器无法工作，但为此编写自己的自定义Lambda并不太困难。您需要验证JWT是由Cloudflare签署的，并且受众是您的应用程序。(app1.mycompany.com的随机受众字符串与app2.mycompany.com或app.other-company.com不同)幸运的是，您可以为所有应用程序部署一个<strong class="jp ir">单个Lambda授权器</strong>——您只需将受众配置为一个stage变量，该变量将传递给Lambda授权器。太棒了。</p><p id="0cd2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，所有未经授权的请求都不会进入您的VPC。你知道你在公开的NGINX服务器上看到的那些随机黑客请求吗？它们将被Lambda授权器拒绝，并且不能做或接触你的来源——假设你使用安全组(VPC链接)或IAM来保护它。(对于真正的偏执狂，请尝试在Cloudflare和AWS API Gateway之间启用相互TLS！)</p><p id="eb28" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">步骤3:您的应用程序可以知道是哪个用户发出了请求，只需查看HTTP头中用户的电子邮件地址。该标题应由授权者Lambda从JWT内的可信电子邮件地址设置或验证(<em class="kx">CF-Access-Authenticated-User-Email</em>)。</p><p id="59d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第四步:坐收渔利？老实说，我认为这将是一篇较长的文章。这种架构使事情变得过于简单:经理可以使用零信任web界面在组或应用程序中添加和删除用户(即使是完全没有可信IDP的承包商也可以获得一次性电子邮件代码)，开发人员只需构建应用程序并验证JWT。</p><p id="fee6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们也在考虑使用Cloudflare隧道，将我们的Jenkins服务器(叹气)置于Zero Trust之后。隧道意味着服务器上没有开放的入站端口。</p><p id="f4f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，认证和授权可能会变得更简单！我认为这显示了“关注点分离”的真正力量。是的，您信任Cloudflare来解密您的流量，但好处是它们可以解决许多令人头疼的问题。如果你有其他选择，请发表评论！</p><p id="4e76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">PS:如果你是一个已经在使用SSO的企业，有专门的管理员，这对你有好处——这篇文章是针对一个开发人员的设置。我们通常被忽视，但我们存在！</p><p id="a474" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">PPS:我的双代理图让我<a class="ae ky" href="https://knowyourmeme.com/memes/good-luck-im-behind-7-proxies" rel="noopener ugc nofollow" target="_blank">想到了这个迷因</a>；-)</p></div></div>    
</body>
</html>