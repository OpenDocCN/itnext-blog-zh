<html>
<head>
<title>Express enters Beta 1, proving the project is still alive</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Express进入Beta 1，证明项目仍然存在</h1>
<blockquote>原文：<a href="https://itnext.io/express-enters-beta-1-proving-the-project-is-still-alive-64b86a5274a7?source=collection_archive---------2-----------------------#2022-02-18">https://itnext.io/express-enters-beta-1-proving-the-project-is-still-alive-64b86a5274a7?source=collection_archive---------2-----------------------#2022-02-18</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="ba7c" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">期待已久的ExpressJS更新已经进入测试版，允许我们最终使用异步路由处理函数</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/283646f1ceb3e902cf435841c97ac8f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_X65d2mESeewV9zd.png"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">图片由作者在Canva的帮助下提供</figcaption></figure><p id="1d36" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><strong class="lb iv"> Express是Node.js最受欢迎的web应用程序框架，尽管它的开发已经停滞多年。Express存储库的工作非常缓慢，Express 5.x版本已经承诺了多年；比如<em class="lv">5α1</em>在2014年11月发布。但是，如果你看看下面，在快速子项目中有重要的工作发生。</strong></p><p id="7270" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">2022年2月14日，Express团队(主要是Doug Wilson)发布了版本5.0.0-beta-1，发布到npm/yarn资源库，标记为<em class="lv">下一个</em>版本。这个标签是为了告诉我们这些想尝试下一个最好的Express版本的人应该尝试5-beta-1版本。</p><p id="881e" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">Express v5承诺提供期待已久的对异步处理函数的支持，以及其他变化。</p><p id="4c1b" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">需要注意的是，在5.0-beta-1发布的同时，4.x分支也开始有活动了。就在今天发布了4.17.3，两个月前发布了4.17.2。考虑到之前的4.x分支版本(4.17.1)是三年前的，而之前的5.x分支版本(5.0-alpha-8)是两年前的，这些版本一起是一个不错的改变。</p><p id="afe9" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">根据其在<code class="fe lw lx ly lz b">npmjs.com</code>上的页面，Express包的下载流量持续/增长。每周下载量超过2400万次，并在稳步增长，4.17.2 (9，865，506次下载)和4.17.1 (12，526，431次下载)的活跃度最高。</p><p id="829c" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这个故事，即Express项目进展缓慢，但尽管如此仍被大量使用，证明了Express是多么坚实、可靠和有用。</p><p id="3481" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">快速浏览一下其他web框架的下载统计数据(如<code class="fe lw lx ly lz b">npmjs.com</code>所报道的),显示Express的下载量是最接近的竞争对手的5-10倍。</p><p id="82f0" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">关于状态—第5版何时完成— <a class="ae ma" href="https://github.com/expressjs/express/pull/2237" rel="noopener ugc nofollow" target="_blank">参见拉取请求(已于2014年7月开始)</a>。看起来没什么可做的了。这个拉动式发布在2022年1月下旬开始收到很多活动，看起来像是为发布做准备。如果你正在看的话，<a class="ae ma" href="https://github.com/expressjs/express/pull/2237#issuecomment-570058548" rel="noopener ugc nofollow" target="_blank">Wesley Todd</a>在2020年1月的一篇评论是对项目状态的恰当描述——项目团队很久以前就想完成Express v5，但是没有人拿工资在Express上工作，他们都很忙。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj mb"><img src="../Images/76487ee970bbb7d943771b146d64da67.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/format:webp/0*pmhr47QoLfFdzcsk.png"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated"><a class="ae ma" href="https://xkcd.com/2347/" rel="noopener ugc nofollow" target="_blank"> XKCD #2347 —(在知识共享协议下)</a></figcaption></figure><p id="7488" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这一形象是千真万确的——有数百个关键的开源项目，它们获得的资金很少，是一个或几个人热爱的劳动，大公司将其用于获取巨额利润的应用程序。</p><p id="e156" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">为了更好地理解这意味着什么，从<a class="ae ma" href="https://github.com/expressjs/express/graphs/contributors" rel="noopener ugc nofollow" target="_blank">快速知识库主分支的提交图</a>开始</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj mc"><img src="../Images/e2845d33475e04ac57b7c2758e80e82a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ySbEH64nMaLx6EF2.png"/></div></div></figure><p id="6eaf" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这表明“TJ”(TJ Holowaychuk)在10多年前开始了Express，并做了大量工作，然后在2014年，他的贡献逐渐减少，而道格·威尔逊的贡献开始增加。但是，这也表明，在过去的几年中，除了最近似乎为v5版本做准备的一阵忙乱之外，总体贡献是最小的。</p><p id="bce5" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">但是，这只是Express的表面情况。这里的图表是给<em class="lv">大师</em>分部的。例如，<a class="ae ma" href="https://github.com/expressjs/express/commits/5.0" rel="noopener ugc nofollow" target="_blank"> 5.0分支</a>正在接收持续的活动。但是，等等，这还不是全部。</p><p id="211c" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">存储库只是Express项目的一部分。还涉及其他模块，这些模块正在接收持续的活动:<code class="fe lw lx ly lz b"><a class="ae ma" href="https://github.com/expressjs/body-parser/graphs/contributors" rel="noopener ugc nofollow" target="_blank">express/body-parser</a></code>、<code class="fe lw lx ly lz b"><a class="ae ma" href="https://github.com/expressjs/session/graphs/contributors" rel="noopener ugc nofollow" target="_blank">express/session</a></code>、<code class="fe lw lx ly lz b"><a class="ae ma" href="https://github.com/expressjs/serve-static/graphs/contributors" rel="noopener ugc nofollow" target="_blank">express/serve-static</a></code>、<code class="fe lw lx ly lz b"><a class="ae ma" href="https://github.com/expressjs/multer/graphs/contributors" rel="noopener ugc nofollow" target="_blank">express/multer</a></code>、<code class="fe lw lx ly lz b"><a class="ae ma" href="https://github.com/expressjs/cors/graphs/contributors" rel="noopener ugc nofollow" target="_blank">express/cors</a></code>、<code class="fe lw lx ly lz b"><a class="ae ma" href="https://github.com/expressjs/cookie-session/graphs/contributors" rel="noopener ugc nofollow" target="_blank">express/cookie-session</a></code>、<code class="fe lw lx ly lz b"><a class="ae ma" href="https://github.com/expressjs/cookie-parser/graphs/contributors" rel="noopener ugc nofollow" target="_blank">express/cookie-parser</a></code>、<code class="fe lw lx ly lz b"><a class="ae ma" href="https://github.com/expressjs/morgan/graphs/contributors" rel="noopener ugc nofollow" target="_blank">express/morgan</a></code>、<code class="fe lw lx ly lz b"><a class="ae ma" href="https://github.com/expressjs/serve-index/graphs/contributors" rel="noopener ugc nofollow" target="_blank">express/serve-index</a></code>、<code class="fe lw lx ly lz b"><a class="ae ma" href="https://github.com/expressjs/compression/graphs/contributors" rel="noopener ugc nofollow" target="_blank">express/compression</a></code>...等等...在某些情况下，Express的某些部分源自PillarJS保护伞下的项目——参见<a class="ae ma" href="http://pillarjs.github.io/" rel="noopener ugc nofollow" target="_blank">http://pillarjs.github.io/</a>——这些项目存储库也正在接受持续的活动，其中许多由Doug Wilson维护。</p><p id="f848" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">换句话说，如果你只关注Express包的发布活动，那么Express项目看起来是停滞的。但是，这是一个更大的软件包生态系统，而不仅仅是Express项目，子项目正在受到持续的关注。</p><p id="9346" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">另一件需要注意的事情是Doug Wilson是大多数这些包的主要贡献者。如果道格·威尔逊不处理事情，快递会在哪里？鉴于其高人气，为什么没有更多的人为Express投稿？</p><h1 id="fc9c" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">快速v5入门</h1><p id="11b2" class="pw-post-body-paragraph kz la iu lb b lc mv jv le lf mw jy lh li mx lk ll lm my lo lp lq mz ls lt lu in bi translated">理论上,“Beta”标签意味着Express v5已经可以由Express团队之外的人进行测试了。产品开发中的“Alpha”或“Beta”阶段有一个传统的含义。也就是说，Alpha版本主要面向项目团队和选定的合作伙伴组织，Beta版本仍然用于测试，但是面向更广泛的人群。</p><p id="7133" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">因此，使用Express的web应用程序作者应该振作起来，用Express v5尝试他们的应用程序。</p><p id="841f" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">迁移指南中描述了如何尝试Express V5:<a class="ae ma" href="https://expressjs.com/en/guide/migrating-5.html" rel="noopener ugc nofollow" target="_blank">https://expressjs.com/en/guide/migrating-5.html</a></p><p id="24b1" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">首先，将您的Express依赖项切换为使用<code class="fe lw lx ly lz b">5.0.0-beta-1</code>，例如:</p><pre class="kk kl km kn gu na lz nb nc aw nd bi"><span id="ec03" class="ne me iu lz b gz nf ng l nh ni">$ npm install express@&gt;=5.0.0-beta.1 --save</span></pre><p id="44e9" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">然后，您运行您的测试并修复任何错误。</p><p id="c0df" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">除了迁移指南，还有API文档:<a class="ae ma" href="https://expressjs.com/en/5x/api.html" rel="noopener ugc nofollow" target="_blank">https://expressjs.com/en/5x/api.html</a></p><p id="92bd" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">粗略地看一下，该API似乎与Express v4基本相同。但是，该网站明确表示Express v5文档是一项正在进行的工作。</p><p id="181d" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">有一个很大的变化似乎不会破坏兼容性，但给了我们一个非常需要的期待已久的功能。如果仔细观察Express 5 pull请求，有一个问题(已经解决)是所有处理程序都要支持承诺。这是在</p><p id="0d6d" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><a class="ae ma" href="https://github.com/expressjs/express/issues/2259" rel="noopener ugc nofollow" target="_blank">发布2259 </a>并通过<code class="fe lw lx ly lz b"><a class="ae ma" href="https://github.com/pillarjs/router/" rel="noopener ugc nofollow" target="_blank">pillarjs/router</a></code>库发布。这证明了Express上的重要工作正在<code class="fe lw lx ly lz b">expressjs/express</code>库之外进行。</p><p id="a889" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">根据<code class="fe lw lx ly lz b">pillarjs/router</code>上的文档(针对2.0分支)，中间件功能现在可以处理Promise的:</p><blockquote class="nj nk nl"><p id="a4b7" class="kz la lv lb b lc ld jv le lf lg jy lh nm lj lk ll nn ln lo lp no lr ls lt lu in bi translated"><em class="iu">该函数可以选择返回一个Promise对象。如果从函数中返回一个promise对象，路由器将使用. then附加一个onRejected回调。如果Promise被拒绝，将使用被拒绝的值调用next，如果值为falsy，则返回一个错误。</em></p></blockquote><p id="33da" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这是一件大事，因为Express长期以来缺乏对<code class="fe lw lx ly lz b">async</code> / <code class="fe lw lx ly lz b">await</code>功能的支持。虽然我们可以使用这样的函数，但我们必须跳过额外的关卡。这种新行为消除了这些束缚。</p><p id="de92" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这似乎意味着我们现在可以做出这种改变:</p><pre class="kk kl km kn gu na lz nb nc aw nd bi"><span id="be09" class="ne me iu lz b gz nf ng l nh ni">// OLD CODE<br/>router.get('/error_route', async function (req, res, next) {<br/>    try {<br/>        // run some async code<br/>    } catch (e) {<br/>        next(e);<br/>    }<br/>});<br/><br/>// NEW CODE<br/>router.get('/error_route', async function (req, res, next) {<br/>    // run some async code<br/>});</span></pre><p id="2a32" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">作为一个<code class="fe lw lx ly lz b">async</code>函数，它返回一个触发这里描述的行为的承诺。这样，<code class="fe lw lx ly lz b">router</code>对象将<code class="fe lw lx ly lz b">.then(onRejected)</code>和<code class="fe lw lx ly lz b">.catch(errorHandler)</code>附加到承诺上，巧妙地将任一条件传递给路由系统。这意味着我们的处理函数现在可以执行异步操作，以自然的方式抛出错误，并且Express路由器将自动处理状态，无论是错误还是成功。</p><h1 id="31a6" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">关于作者</h1><p id="f09c" class="pw-post-body-paragraph kz la iu lb b lc mv jv le lf mw jy lh li mx lk ll lm my lo lp lq mz ls lt lu in bi translated"><a class="ae ma" href="https://davidherron.com" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iv"> <em class="lv">大卫·赫伦</em> </strong> </a> <em class="lv">:大卫·赫伦是一名作家和软件工程师，专注于技术的明智使用。他对太阳能、风能和电动汽车等清洁能源技术特别感兴趣。David在硅谷从事了近30年的软件工作，从电子邮件系统到视频流，再到Java编程语言，他已经出版了几本关于Node.js编程和电动汽车的书籍。</em></p></div><div class="ab cl np nq hy nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="in io ip iq ir"><p id="013f" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><em class="lv">原载于</em><a class="ae ma" href="https://techsparx.com/nodejs/news/2022/express-5.html" rel="noopener ugc nofollow" target="_blank"><em class="lv">https://techsparx.com</em></a><em class="lv">。</em></p></div></div>    
</body>
</html>