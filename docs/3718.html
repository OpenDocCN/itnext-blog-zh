<html>
<head>
<title>D3 Selections In Depth</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">D3深度选择</h1>
<blockquote>原文：<a href="https://itnext.io/d3-selections-in-depth-40b8b36ef738?source=collection_archive---------3-----------------------#2020-02-09">https://itnext.io/d3-selections-in-depth-40b8b36ef738?source=collection_archive---------3-----------------------#2020-02-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9241" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">输入→选择。到引擎盖下☕</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e65dcf2743fc2502bd713be639debe82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0N1Snx_IMCJY69F4FqWQ0Q.png"/></div></div></figure><p id="2192" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">想知道引擎盖下的工作原理吗？如果是这样的话，我假设你已经从2013年开始接触了下面的<a class="ae ln" href="https://bost.ocks.org/mike/selection/" rel="noopener ugc nofollow" target="_blank">迈克·博斯托克(d3的创造者)的帖子</a>。</p><p id="5ba8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这篇文章解释了选择的实现。在Javascript中，艰难的2013年似乎是很久以前的事了，一般概念都是一样的。这篇文章将选择结构描述为数组的一个<a class="ae ln" href="https://github.com/d3/d3/blob/master/CHANGES.md#selections-d3-selection" rel="noopener ugc nofollow" target="_blank">子类。</a>但那是过去的事了，那时版本3是最新的。</p><p id="86d7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">今天返回的<strong class="kt ir">选择</strong>结构是一个<strong class="kt ir">对象</strong>。</p><p id="a0fc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">选择成立:</p><ul class=""><li id="57ef" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated">选定元素(组)的数组。</li><li id="d414" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">根元素的数组。</li><li id="ac05" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated"><a class="ae ln" href="https://github.com/d3/d3-selection/blob/4dcb3412318a6e2ecada79196b42336758d29133/src/selection/index.js" rel="noopener ugc nofollow" target="_blank">转换方法的访问器</a>(用于更新和操作DOM)。</li></ul><h2 id="c868" class="mc md iq bd me mf mg dn mh mi mj dp mk la ml mm mn le mo mp mq li mr ms mt mu bi translated">让我们运行一些代码！</h2><p id="4fe4" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la mx lc ld le my lg lh li mz lk ll lm ij bi translated">打开运行d3项目的浏览器开发工具控制台，执行下面的基本选择:<strong class="kt ir"> d3.select('body'): </strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/be292feb67c0dd39bde7674ec28fe6fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rDDxnhA3sI_DPiwweq81WQ.png"/></div></div></figure><p id="14bd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">那么到底发生了什么？</p><p id="6db2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://github.com/d3/d3-selection/blob/4dcb3412318a6e2ecada79196b42336758d29133/src/select.js" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir">选择(</strong> ' </a> <em class="nb">选择器'</em> <a class="ae ln" href="https://github.com/d3/d3-selection/blob/4dcb3412318a6e2ecada79196b42336758d29133/src/select.js" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> ) </strong> </a>是一个工厂函数，它返回一个<strong class="kt ir">新选择</strong>实例，如下所示:</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="225c" class="mc md iq nd b gy nh ni l nj nk"><strong class="nd ir">new <em class="nb">Selection</em></strong>([[<strong class="nd ir"><em class="nb">document</em></strong>.querySelector(<em class="nb">selector</em>)]], [<strong class="nd ir"><em class="nb">document</em></strong>.<strong class="nd ir">documentElement</strong>])</span></pre><p id="b8ac" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当我们将选择器传递给select()/selectAll()函数时，d3将使用它在DOM中查询该元素。</p><p id="cdd4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">它还将把查询结果放在一个数组中，并将它传递给选择器的构造函数。</p><p id="2e6a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以看到，<strong class="kt ir">选择</strong> <a class="ae ln" href="https://github.com/d3/d3-selection/blob/master/src/selection/index.js" rel="noopener ugc nofollow" target="_blank">构造函数</a>得到了两个参数(组，父对象):</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="9802" class="mc md iq nd b gy nh ni l nj nk"><strong class="nd ir">function </strong><em class="nb">Selection</em>(groups, parents) {<br/>  <strong class="nd ir">this</strong>.<strong class="nd ir">_groups </strong>= groups;<br/>  <strong class="nd ir">this</strong>.<strong class="nd ir">_parents </strong>= parents;<br/>}</span></pre><p id="823d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">选择实例现在将保存对所选元素组的私有引用。</p><p id="bef2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">选择方法可以访问组元素并返回新的或更新的选择引用(取决于方法)。</p><p id="53dc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这种技术被称为<strong class="kt ir">“方法链接”</strong>，它通过返回选择实例(使用<strong class="kt ir">“this”</strong>)来实现。</p><p id="935b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们深入挖掘，我们会看到转换函数返回<strong class="kt ir"> selection_each </strong>，它迭代元素，执行用户回调(如果有的话)，并最终返回<strong class="kt ir"> Selection </strong>引用(<strong class="kt ir"> this </strong>)。</p><p id="ecf5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">顺便问一下，你认识d3.select()中的<strong class="kt ir">函子</strong>函数模式吗？如果是这样，你可能会喜欢这篇文章。</p><h2 id="a0a0" class="mc md iq bd me mf mg dn mh mi mj dp mk la ml mm mn le mo mp mq li mr ms mt mu bi translated">来源:</h2><p id="9e7f" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la mx lc ld le my lg lh li mz lk ll lm ij bi translated">在您的一个npm项目中安装<strong class="kt ir"> d3-selection </strong>包，并将其加载到一个简单的网页中，如下所示:</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="2ed2" class="mc md iq nd b gy nh ni l nj nk">&lt;<strong class="nd ir">html lang="en"</strong>&gt;<br/>&lt;<strong class="nd ir">head</strong>&gt;<br/>  &lt;<strong class="nd ir">meta charset="utf-8" </strong>/&gt;<br/>  &lt;<strong class="nd ir">meta name="viewport" content="width=device-width, initial-scale=1" </strong>/&gt;<br/>  &lt;<strong class="nd ir">script src="node_modules/d3-selection/dist/d3-selection.js"</strong>&gt;&lt;/<strong class="nd ir">script</strong>&gt;<br/>  &lt;<strong class="nd ir">link rel="stylesheet" href="style.css" </strong>/&gt;<br/>&lt;/<strong class="nd ir">head</strong>&gt;<br/>&lt;<strong class="nd ir">body</strong>&gt;<br/>&lt;<strong class="nd ir">div</strong>&gt; text &lt;/<strong class="nd ir">div</strong>&gt;<br/>&lt;<strong class="nd ir">script</strong>&gt;<br/>  d3.select(<strong class="nd ir">'div'</strong>)<br/>          .<strong class="nd ir">style</strong>(<strong class="nd ir">'color'</strong>, <strong class="nd ir">'tomato'</strong>);<br/>&lt;/<strong class="nd ir">script</strong>&gt;<br/>&lt;/<strong class="nd ir">body</strong>&gt;<br/>&lt;/<strong class="nd ir">html</strong>&gt;</span></pre><p id="241d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在打开源代码选项卡，找到“d3-selection.js”源代码，并将断点放在<strong class="kt ir"> select </strong>()函数上(第876行)。</p><p id="6a4d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">将以下内容粘贴到控制台中:</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="61f8" class="mc md iq nd b gy nh ni l nj nk"><strong class="nd ir">new </strong>Selection([[document.querySelector(selector)]], [document.documentElement])</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/d3e136df1a825f77fd0a61b83e86ba1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*50vJpZVLKUwL29HQ77JfHw.png"/></div></div></figure><p id="31c7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">每当我们以声明的方式获得一个选择时，我们都会获得一个<strong class="kt ir">新选择</strong>引用，我们可以将数据加入其中，并添加我们想要转换的元素组。</p><p id="7a0c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">向<strong class="kt ir"> selection_style </strong>函数添加另一个断点(style函数指向它),并在中断期间记录以下内容:</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="156c" class="mc md iq nd b gy nh ni l nj nk">this.each((value == null<br/>? styleRemove : typeof value === "function"<br/>? styleFunction<br/>: styleConstant)(name, value, priority == null ? "" : priority))</span></pre><p id="e881" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您将看到style()方法最终将返回一个对我们使用转换后的DOM进行操作的<strong class="kt ir">选择</strong>的引用。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/c4d1d0f2fc21346c529fde642d10066a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sXuRu5I-KBTViylGjj6u9A.png"/></div></div></figure><p id="927b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，由于我们大多数人使用ES6类语法，这里有一个我必须做的基本的可运行选择示例:)</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="86bb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我希望你喜欢这篇文章！</p><p id="3b71" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">干杯，</p><p id="4b3c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">利伦。</p></div></div>    
</body>
</html>