<html>
<head>
<title>How to add Google Tag Manager to an Angular application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将Google Tag Manager添加到Angular应用程序中</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-add-google-tag-manager-to-an-angular-application-fc68624386e2?source=collection_archive---------0-----------------------#2020-01-15">https://itnext.io/how-to-add-google-tag-manager-to-an-angular-application-fc68624386e2?source=collection_archive---------0-----------------------#2020-01-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5ecd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将GTM服务添加到angular应用程序的简单教程</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/24c306facd1419e008efbf2f9f98bdf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AVkEBMkzAZoOy1eI"/></div></div></figure><p id="28d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kx" href="https://www.google.com/intl/it/tagmanager/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">谷歌标签管理器</strong> </a>是谷歌的免费工具，允许你安装和<strong class="jp ir">管理标签</strong>(脚本，跟踪像素，cookie处理程序ecc..)放在你的网站上<strong class="jp ir">，而不需要修改代码</strong>。GTM是一个很好的工具，允许营销专家在不影响代码库的情况下处理站点/应用程序，并为每个营销自动化干预部署新版本的站点。</p><p id="f84a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本教程中，我们将<strong class="jp ir">解释如何通过使用专用库将GTM脚本正确地包含在您的Angular应用程序</strong>中，以及如何<strong class="jp ir">发回GTM将转发给Google Analytics </strong>的数据。</p><h1 id="b719" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">参考知识库</h1><p id="110b" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我们将使用的angular base项目的一个工作示例位于:<a class="ae kx" href="https://github.com/mzuccaroli/angular-google-tag-manager/tree/master/demo-application" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">https://github . com/mzuccaloli/angular-Google-tag-manager/tree/master/demo-application</strong></a>，这是一个简单的Angular项目，使用angular CLI和命令“<em class="mb"> ng new </em>”生成。更多信息见<a class="ae kx" href="https://angular.io/guide/quickstart" rel="noopener ugc nofollow" target="_blank">角度项目快速入门</a>。</p><p id="0582" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">主存储库是我们将在本教程中使用的库:<a class="ae kx" href="https://github.com/mzuccaroli/angular-google-tag-manager" rel="noopener ugc nofollow" target="_blank">https://github.com/mzuccaroli/angular-google-tag-manager</a>。</p><h1 id="5cad" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">入门指南</h1><p id="9289" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">在本教程中，我们将使用自己制作的一个名为<a class="ae kx" href="https://github.com/mzuccaroli/angular-google-tag-manager" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">angular-Google-tag-manager</strong></a>的<strong class="jp ir">库来简化GTM设置和自定义事件的推送。</strong></p><h1 id="a3d9" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">安装和配置</h1><p id="7cb6" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">首先安装angular-谷歌标签管理器</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="81e3" class="mh kz iq md b gy mi mj l mk ml">$ npm install --save angular-google-tag-manager</span></pre><p id="7e02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装后，您需要在'<em class="mb"> src/app.module.ts' </em>中提供您的<strong class="jp ir"> GTM id </strong></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="6ec0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将id放在环境变量中是一个好主意:你将能够将不同的环境连接到不同的GTM帐户，并且它将允许你在一个受保护的环境中测试你的所有标签。</p><p id="a33d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您不知道在哪里可以找到您的GTM id，请转到您想要跟踪的<strong class="jp ir"> Google Tag manager帐户</strong>，您可以在那里找到它:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mo"><img src="../Images/05ee2a6e2892b9f080b5efe46106b008.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OVD_HWEHz68GzgMd"/></div></div></figure><p id="e827" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以将服务注入到需要与之交互的应用程序的每个控制器中，并推送自定义事件，它是一个<strong class="jp ir">单例实例</strong>，设置(将GTM脚本和iframe添加到DOM)将在第一次使用时自动<strong class="jp ir">处理</strong>。</p><p id="120d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在你的控制器中注入<em class="mb"> gtmService </em>:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mm mn l"/></div></figure><h1 id="fd4a" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">页面事件</h1><p id="5121" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">如果您想<strong class="jp ir">跟踪页面事件并将其发送给Google Analytics </strong>，最好的方法是<strong class="jp ir">订阅路由器出口外加载的控制器中的导航事件</strong>(主应用程序或标题控制器也可以)</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="2fef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">示例中的<em class="mb"> gtmTag </em>是<strong class="jp ir">完全自定义的</strong>，您可以在该对象中发送您的分析所需的所有信息，如页面名称、页面url、用户登录状态等。</p><h1 id="e51c" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">自定义事件</h1><p id="6419" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">如果你想跟踪任何由你的应用程序触发的<strong class="jp ir">特定事件</strong>推送定制事件非常简单:注入服务，然后在你需要跟踪的每个函数调用中调用pushTag方法；</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mm mn l"/></div></figure><h1 id="c255" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">测试您的标签和数据层</h1><p id="fc1b" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">如果你想检查GTM脚本的安装和配置，你可以很容易地按照这个步骤</p><h2 id="bde2" class="mh kz iq bd la mp mq dn le mr ms dp li jy mt mu lm kc mv mw lq kg mx my lu mz bi translated">检查生成的HTML</h2><p id="62ac" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">右键单击应用程序，然后单击inspect，在呈现的HTML中，您应该能够在标题中找到一个脚本标记，在正文中找到一个iframe:</p><p id="be2f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:从lib版本1.2.4开始,“noscript”iframe不再是必需的，因此它仅对旧版本有效。</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi na"><img src="../Images/1ce840db2d7bd1ba5c321f6d0d996d76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R-2Ac5pwJv359KDM"/></div></div></figure><h2 id="338c" class="mh kz iq bd la mp mq dn le mr ms dp li jy mt mu lm kc mv mw lq kg mx my lu mz bi translated">检查数据层变量</h2><p id="ade4" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">在浏览器控制台中查看<strong class="jp ir"> dataLayer </strong>变量，它应该包含一个由我们的服务触发的事件的数组:查看变量，然后访问一些页面并执行一些应该触发事件的操作，再次查看变量，新的<strong class="jp ir">记录应该被推送到数组</strong>。这是推送到GTM的事件数组。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/01674cef82d35ef4df78cdb47da8edd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/0*8LixL-n4wgM9OfZa"/></div></figure><h2 id="0f4f" class="mh kz iq bd la mp mq dn le mr ms dp li jy mt mu lm kc mv mw lq kg mx my lu mz bi translated">检查您的网络通话</h2><p id="064b" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">如果你的GTM账户配置了一些<strong class="jp ir">自定义标签</strong>(比如分析、跟踪像素、cookie机器人等等)，你可以<strong class="jp ir">检查你的网络调用栈</strong>并找到自定义标签发出的调用。</p><h2 id="0954" class="mh kz iq bd la mp mq dn le mr ms dp li jy mt mu lm kc mv mw lq kg mx my lu mz bi translated">使用谷歌标签助手</h2><p id="9b66" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">Google提供了一个chrome扩展<a class="ae kx" href="https://chrome.google.com/webstore/detail/tag-assistant-by-google/kejbdjndbnbjgmefkgdddjlbokphdefk" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"/></a>来检查哪些标签正在你的页面上运行，以及它们的配置是否正确。安装并运行它，您将能够记录由您的导航触发的标签列表。</p><p id="0d86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有效配置的示例:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nc"><img src="../Images/9233654a64c4ed23905d946a59c96f47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8m9dBrg7XrN8uovI"/></div></div></figure><p id="9b01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无效配置的示例:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nd"><img src="../Images/96cc2fd35ffb79ef6658dc78d7c16536.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jITIjhqG7AzXzPor"/></div></div></figure><h1 id="5eae" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">Google标签管理器配置</h1><p id="a435" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">这篇文章是关于应用程序和代码的，<strong class="jp ir">谷歌标签管理器是一个非常先进的工具，需要适当的配置</strong>，这不是一件容易的工作。在许多公司中，GTM是<strong class="jp ir">在开发者和“营销人员”之间搭建桥梁的主要工具</strong>，如果你处于这种情况，这篇文章对你来说就足够了，如果你的公司中没有人具备管理GTM的技能，你将需要深入了解他的配置。官方文档相当不错，你可以<a class="ae kx" href="https://support.google.com/tagmanager/answer/6107124?hl=en" rel="noopener ugc nofollow" target="_blank">从这里开始分析配置</a>。</p><h1 id="219f" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">关于库的说明</h1><p id="6ed8" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">本文和参考示例的灵感来自于生产中运行的真实项目angular-Google-tag-manager的第一个实现是我参与的一个大型Angular项目中的一个服务，然后我决定将它转移到一个<a class="ae kx" href="https://www.npmjs.com/package/angular-google-tag-manager" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> NPM公共包</strong> </a>中，以便在其他项目中重用它，并与其他开发人员共享。</p><p id="deb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它并不完美，但<strong class="jp ir">工作良好，并有大量的页面浏览量</strong>，本文的库和代码不是一个<em class="mb"> "hello world" </em>演示，而是在生产中运行的真实代码，如果你有兴趣<strong class="jp ir">为这个项目做出贡献</strong>直接在GitHub资源库上联系我:<a class="ae kx" href="https://github.com/mzuccaroli/angular-google-tag-manager" rel="noopener ugc nofollow" target="_blank">https://github.com/mzuccaroli/angular-google-tag-manager</a>，欢迎拉请求和贡献者！如果这篇文章和NPM软件包对你有用，请在Medium上鼓掌，在GitHub上打星。</p></div></div>    
</body>
</html>