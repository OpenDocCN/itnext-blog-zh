<html>
<head>
<title>A Journey to Reason</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">理性之旅</h1>
<blockquote>原文：<a href="https://itnext.io/a-journey-to-reason-c408a87a54de?source=collection_archive---------1-----------------------#2017-09-25">https://itnext.io/a-journey-to-reason-c408a87a54de?source=collection_archive---------1-----------------------#2017-09-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b6a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们建立一个三维旋转木马</p><blockquote class="kl km kn"><p id="07f7" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">注意:这是从反应过渡到理性的“理性之旅”系列的一部分。敬请关注。还会有更多这样的事情发生！<br/> <a class="ae ks" href="https://medium.com/netscape/a-journey-to-reason-2c2c4cddc012" rel="noopener"> &lt;上一个</a> | <a class="ae ks" href="https://medium.com/netscape/a-journey-to-reason-2c2c4cddc012" rel="noopener"> &lt; &lt;从第1部分开始</a> | <a class="ae ks" href="https://medium.com/@RRafatpanah/a-reasonml-tutorial-building-an-app-shell-dd7cc617d0c5" rel="noopener">下一个&gt; </a></p></blockquote><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi kt"><img src="../Images/65c08031cee08131cebcd6a1b53de307.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KGFBvXtxtaqiEp7JJNloow.jpeg"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">照片由<a class="ae ks" href="https://www.pexels.com/u/pixabay/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>提供</figcaption></figure><p id="9d4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae ks" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fitnext.io%2Fa-journey-to-reason-c408a87a54de" rel="noopener ugc nofollow" target="_blank"> <em class="ko">点击这里在LinkedIn上分享这篇文章</em> </a></p><p id="ff98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ko">* *更新原因3语法** </em></p><p id="8e2f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本系列的第一篇文章中，我们介绍了Reason，以及为什么像我这样的前端工程师会对探索它感兴趣。</p><p id="2528" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很高兴和大家分享我的第一个Reason项目:<a class="ae ks" href="https://persianturtle.github.io/reason-3d-carousel/build/" rel="noopener ugc nofollow" target="_blank"> reason-3d-carousel </a>。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi lj"><img src="../Images/bf2e1d43faf3693faae548e19121a96d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*agXMXeKLVVN_HYMETbOAaw.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated"><a class="ae ks" href="https://persianturtle.github.io/reason-3d-carousel/build/" rel="noopener ugc nofollow" target="_blank">原因-3d-旋转木马</a></figcaption></figure></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><p id="ca17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文的目标是双重的。</p><ol class=""><li id="534c" class="lr ls iq jp b jq jr ju jv jy lt kc lu kg lv kk lw lx ly lz bi translated">为了证明这一点，使用<a class="ae ks" href="https://reasonml.github.io/" rel="noopener ugc nofollow" target="_blank">reason ml</a>/<a class="ae ks" href="https://reasonml.github.io/reason-react/" rel="noopener ugc nofollow" target="_blank">react</a>，我们可以构建web应用程序来完成一些非常酷的DOM操作和动画。在学习了基础知识之后，与使用JavaScript / ReactJS / etc相比，我不觉得<em class="ko">受到了理性的限制。</em></li><li id="ec2e" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk lw lx ly lz bi translated">为那些有JavaScript / ReactJS经验的人提供一个构建他们的第一个推理web应用程序的指南。我们将一起重现3D旋转木马，并一路解释ReasonReact概念。</li></ol></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><blockquote class="mf"><p id="63a9" class="mg mh iq bd mi mj mk ml mm mn mo kk dk translated">在继续之前，我想说一声“谢谢！”感谢<a class="ae ks" href="https://discord.gg/reasonml" rel="noopener ugc nofollow" target="_blank">不和谐频道</a>的每一个人帮助我完成这个项目。非常感谢你们创造了这样一个热情和博学的社区！</p></blockquote></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><h1 id="24ff" class="mp mq iq bd mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm bi translated">设置我们的开发人员环境</h1><p id="eef6" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">您可以通过几种不同的方式开始使用Reason构建web应用程序。每种方式都需要<a class="ae ks" href="https://bucklescript.github.io/bucklescript/Manual.html#_bucklescript_build_system_code_bsb_code" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> bsb </strong> </a>。现在让我们来看看:</p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="59a7" class="nx mq iq nt b gy ny nz l oa ob">$ <!-- -->npm install -g bs-platform</span></pre><p id="5958" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，让我们创建一个项目模板。<strong class="jp ir">出于本教程的目的，让我们使用<em class="ko">创建-反应-应用</em>选项</strong>，但是要注意其他选项。</p><h2 id="d56b" class="nx mq iq bd mr oc od dn mv oe of dp mz jy og oh nd kc oi oj nh kg ok ol nl om bi translated">选项1: <a class="ae ks" href="https://reasonml.github.io/guide/javascript/quickstart" rel="noopener ugc nofollow" target="_blank">纯理性</a></h2><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="7c4f" class="nx mq iq nt b gy ny nz l oa ob">bsb -init my-first-app -theme basic-reason</span></pre><h2 id="3dde" class="nx mq iq bd mr oc od dn mv oe of dp mz jy og oh nd kc oi oj nh kg ok ol nl om bi translated">选项2: <a class="ae ks" href="https://reasonml.github.io/reason-react/gettingStarted.html" rel="noopener ugc nofollow" target="_blank">最小原因反应</a></h2><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="3baa" class="nx mq iq nt b gy ny nz l oa ob">bsb -init my-react-app -theme react</span></pre><h2 id="c1c3" class="nx mq iq bd mr oc od dn mv oe of dp mz jy og oh nd kc oi oj nh kg ok ol nl om bi translated">选项3: <a class="ae ks" href="https://github.com/reasonml-community/reason-scripts" rel="noopener ugc nofollow" target="_blank">创建React应用</a>(为本指南选择)</h2><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="7b18" class="nx mq iq nt b gy ny nz l oa ob">yarn create react-app &lt;app-name&gt; -- --scripts-version reason-scripts</span></pre><h2 id="c3c2" class="nx mq iq bd mr oc od dn mv oe of dp mz jy og oh nd kc oi oj nh kg ok ol nl om bi translated">编辑器工具</h2><p id="6f14" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">如果你在macOS / Linux上，让我们设置你的编辑器。请遵循此处的说明<a class="ae ks" href="https://reasonml.github.io/guide/editor-tools/editors-plugins" rel="noopener ugc nofollow" target="_blank">(安装</a><a class="ae ks" href="https://reasonml.github.io/guide/editor-tools/global-installation/" rel="noopener ugc nofollow" target="_blank">原因-cli </a>后)。</p></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><p id="5bff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">刚开始时，我对静态类型的函数式语言没有多少经验。我第一次尝试纯粹理性地创建3D carousel(没有React的原因),很快就陷入了使用DOM的困境。ReasonReact的一个优点是它允许DOM从我们这里抽象出来。实际上，这意味着不用担心DOM类型，我只需使用Bucklescript提供的类型Reason/react&amp;即可。</p><h1 id="b1f9" class="mp mq iq bd mr ms on mu mv mw oo my mz na op nc nd ne oq ng nh ni or nk nl nm bi translated">探索我们的项目模板</h1><p id="a20c" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">使用选项三，我们可以立即运行:</p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="55b7" class="nx mq iq nt b gy ny nz l oa ob">$ <!-- -->npm run start</span></pre><p id="e1c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看到一个熟悉的欢迎页面。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi os"><img src="../Images/ccbd3b25fd59ef3c64bc55622b7ad8d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xnsuo_2RtDrWAHJ24JIIbw.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">熟悉的创建-反应-应用程序欢迎页面</figcaption></figure><h1 id="3217" class="mp mq iq bd mr ms on mu mv mw oo my mz na op nc nd ne oq ng nh ni or nk nl nm bi translated">让我们开始建造吧</h1><p id="3881" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">虽然我会尽量解释一些重要的概念，但我还是建议先阅读一下<a class="ae ks" href="https://reasonml.github.io/guide/language/overview" rel="noopener ugc nofollow" target="_blank">原因和</a><a class="ae ks" href="https://reasonml.github.io/reason-react/" rel="noopener ugc nofollow" target="_blank">原因和反应的文档。</a></p><p id="231a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们当前的目标:创造一个基本的3D旋转木马，它还不会旋转。我们使用Reason根据边的数量来计算每个边的CSS。</p><p id="e4fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将<code class="fe ot ou ov nt b">app.css</code>替换为:</p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="ac54" class="nx mq iq nt b gy ny nz l oa ob">#root {<br/>  height: 100vh;<br/>  width: 100vw;<br/>  overflow: hidden;<br/>  position: relative;<br/>  background: white;<br/>  perspective: 62.5vw; /* hard-coded for now */<br/>}</span><span id="cf26" class="nx mq iq nt b gy ow nz l oa ob">#carousel {<br/>  position: absolute;<br/>  transform-style: preserve-3d;<br/>  backface-visibility: visible;<br/>  display: flex;<br/>  align-items: center;<br/>  justify-content: center;<br/>  width: 50vw;<br/>  height: 60vh;<br/>  top: 0;<br/>  left: 0;<br/>  right: 0;<br/>  bottom: 0;<br/>  margin: auto;<br/>  cursor: pointer;<br/>}</span><span id="7a0a" class="nx mq iq nt b gy ow nz l oa ob">#carousel figure {<br/>  font-size: 3vw;<br/>  position: absolute;<br/>  background: rgba(220, 220, 220, 0.95);<br/>  overflow: hidden;<br/>  display: flex;<br/>  align-items: center;<br/>  justify-content: center;<br/>  box-sizing: border-box;<br/>  border: 2px solid black;<br/>  width: 100%;<br/>  height: inherit;<br/>  margin: 0;<br/>  top: 0;<br/>  left: 0;<br/>  user-select: none;<br/>}</span></pre><p id="314d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将<code class="fe ot ou ov nt b">app.re</code>替换为:</p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="689b" class="nx mq iq nt b gy ny nz l oa ob">[%bs.raw {|require('./app.css')|}];</span><span id="e74b" class="nx mq iq nt b gy ow nz l oa ob">let component = ReasonReact.statelessComponent("App");</span><span id="81f7" class="nx mq iq nt b gy ow nz l oa ob">let create_sides = (sides, radius) =&gt;<br/>  Array.init(<br/>    sides,<br/>    (index) =&gt; {<br/>      let css =<br/>        "rotate3d(0, 1, 0,"<br/>        ++ (<br/>          string_of_float(360.0 *. float_of_int(index) /. float_of_int(sides))<br/>          ++ ("0deg) translate3d(0, 0," ++ (string_of_float(radius) ++ "0vw)"))<br/>        );<br/>      &lt;figure key=(string_of_int(index)) style=(ReactDOMRe.Style.make(~transform=css, ()))&gt;<br/>        (ReasonReact.stringToElement(string_of_int(index + 1)))<br/>      &lt;/figure&gt;<br/>    }<br/>  );</span><span id="413a" class="nx mq iq nt b gy ow nz l oa ob">let make = (_children) =&gt; {<br/>  ...component,<br/>  render: (_self) =&gt; {<br/>    let sides = 8;<br/>    let radius = 25.0 /. Js.Math.tan(180.0 /. float_of_int(sides) *. (Js.Math._PI /. 180.0));<br/>    let transform =<br/>      "translate3d(0, 0, -"<br/>      ++ (string_of_float(radius) ++ ("0vw) rotateY(" ++ (string_of_float(0.0) ++ "0deg)")));<br/>    &lt;section id="carousel" style=(ReactDOMRe.Style.make(~transform, ()))&gt;<br/>      (ReasonReact.arrayToElement(create_sides(sides, radius)))<br/>    &lt;/section&gt;<br/>  }<br/>};</span></pre><blockquote class="mf"><p id="0724" class="mg mh iq bd mi mj ox oy oz pa pb kk dk translated">非常感谢<a class="pc pd ep" href="https://medium.com/u/522fd8963882?source=post_page-----c408a87a54de--------------------------------" rel="noopener" target="_blank">亚瓦尔·阿明</a>在<a class="ae ks" href="https://discord.gg/reasonml" rel="noopener ugc nofollow" target="_blank">不和谐频道</a>中帮助我使用create_sides功能。</p></blockquote><h2 id="d0a1" class="nx mq iq bd mr oc pe dn mv oe pf dp mz jy pg oh nd kc ph oj nh kg pi ol nl om bi translated"><code class="fe ot ou ov nt b">app.re</code>概述:</h2><ul class=""><li id="24d0" class="lr ls iq jp b jq nn ju no jy pj kc pk kg pl kk pm lx ly lz bi translated">需要一个CSS文件(如果该CSS文件不存在，将会抛出编译器错误)</li><li id="311d" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk pm lx ly lz bi translated">声明了一个无状态组件(传递给<code class="fe ot ou ov nt b">ReasonReact.statelessComponent</code>的字符串仅用于调试目的)</li><li id="bafe" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk pm lx ly lz bi translated">声明了一个名为<code class="fe ot ou ov nt b">create_sides</code>的函数，它使用了<code class="fe ot ou ov nt b"><a class="ae ks" href="https://reasonml.github.io/api/Array.html" rel="noopener ugc nofollow" target="_blank">Array.init</a></code>，类型为<code class="fe ot ou ov nt b">int =&gt; float =&gt; array ReasonReact.reactElement</code>，这意味着它有两个参数(<code class="fe ot ou ov nt b">int</code>和<code class="fe ot ou ov nt b">float</code>，并返回一个React元素数组</li><li id="1baf" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk pm lx ly lz bi translated">声明了一个<code class="fe ot ou ov nt b">make</code>函数，它是当<code class="fe ot ou ov nt b">index.re</code>调用<code class="fe ot ou ov nt b">&lt;App /&gt;</code>时被调用的函数(类似于ReactJS的<code class="fe ot ou ov nt b">class App extends React.Component</code>，除了它使用组合而不是继承——当你注意到下一行的<code class="fe ot ou ov nt b">…component</code>时，你可以猜到)</li><li id="6848" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk pm lx ly lz bi translated"><code class="fe ot ou ov nt b">make</code>功能有一个<code class="fe ot ou ov nt b">render</code>字段</li><li id="2562" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk pm lx ly lz bi translated">像<code class="fe ot ou ov nt b">vw</code>和<code class="fe ot ou ov nt b">deg</code>这样的CSS单元以<code class="fe ot ou ov nt b">0</code>为前缀，因为floats总是包含一个小数——<code class="fe ot ou ov nt b">10</code>变成了<code class="fe ot ou ov nt b">10.</code>—<code class="fe ot ou ov nt b">10.deg</code>不是有效的CSS</li></ul><h2 id="a21d" class="nx mq iq bd mr oc od dn mv oe of dp mz jy og oh nd kc oi oj nh kg ok ol nl om bi translated">编译器错误</h2><p id="6fad" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">保存后我们注意到的第一件事是我们得到了一个编译器错误。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi pn"><img src="../Images/f02ce07ef649220f0fb9f0620367a692.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UUn85rPn2oIbW4hT-xPF4A.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">编译器给我们发现了一个bug！</figcaption></figure><p id="b2d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里的问题是<code class="fe ot ou ov nt b">index.re</code>在App组件上包含了一个<code class="fe ot ou ov nt b">message</code>道具，但是App组件不接受一个<code class="fe ot ou ov nt b">message</code>道具。删除不用的<code class="fe ot ou ov nt b">message</code>道具修复了bug，我们的3D旋转木马渲染了！</p><p id="1747" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:在ReactJS中，未使用的属性不会导致错误或警告。</p><h2 id="23e3" class="nx mq iq bd mr oc od dn mv oe of dp mz jy og oh nd kc oi oj nh kg ok ol nl om bi translated">Reason与JavaScript的互操作性</h2><p id="4edc" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">当检查<code class="fe ot ou ov nt b">app.re</code>时，我们看到:</p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="0119" class="nx mq iq nt b gy ny nz l oa ob">[%bs.raw {|require('./app.css')|}];</span></pre><p id="9269" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用<a class="ae ks" href="https://bucklescript.github.io/bucklescript/Manual.html" rel="noopener ugc nofollow" target="_blank"> Bucklescript </a>与JavaScript进行互操作。同样在代码中，我们可以看到使用了<code class="fe ot ou ov nt b">Js.Math.tan</code>和<code class="fe ot ou ov nt b">Js.Math._PI</code>。Bucklescript有许多内置的、类型安全的JavaScript绑定，但是我们也可以编写自己的绑定——正如我们将在本文后面看到的。</p><h2 id="103e" class="nx mq iq bd mr oc od dn mv oe of dp mz jy og oh nd kc oi oj nh kg ok ol nl om bi translated">一些反应差异</h2><p id="29b3" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">我们已经看到React和react之间有很多相似之处。在这个无状态组件中，当道具改变时，组件会重新渲染。</p><p id="43fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，在这个例子中，只有一个未使用的<code class="fe ot ou ov nt b">_children</code>道具。来自<a class="ae ks" href="https://reasonml.github.io/reason-react/#reason-react-component-creation-props" rel="noopener ugc nofollow" target="_blank">文档</a>:</p><blockquote class="kl km kn"><p id="63af" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">最后的道具一定是孩子。如果你不使用它，简单地忽略它，命名为<code class="fe ot ou ov nt b">_</code>或<code class="fe ot ou ov nt b">_children</code>。以下划线开头的名字如果没有被使用，不会触发编译器警告。</p></blockquote><p id="8bbc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在撰写本文时，理性的JSX需要空格，并且只能包含“元素”——<code class="fe ot ou ov nt b">&lt;div&gt;foo&lt;/div&gt;</code>变成了<code class="fe ot ou ov nt b">&lt;div&gt; (ReasonReact.stringToElement "foo") &lt;/div&gt;</code>。</p><p id="5aed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">按理来说，<a class="ae ks" href="https://reasonml.github.io/guide/language/module#every-re-file-is-a-module" rel="noopener ugc nofollow" target="_blank">文件就是模块</a>。注意在<code class="fe ot ou ov nt b">index.re</code>中，我们不需要在渲染到DOM之前包含<code class="fe ot ou ov nt b">app.re</code>。<code class="fe ot ou ov nt b">&lt;App /&gt;</code>映射到<code class="fe ot ou ov nt b">app.re</code>。</p><p id="6718" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">设置一个<code class="fe ot ou ov nt b">style</code>属性也略有不同:</p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="f87a" class="nx mq iq nt b gy ny nz l oa ob">&lt;element style=(ReactDOMRe.Style.make(~color="red", ()))</span></pre><p id="189b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:<code class="fe ot ou ov nt b">ReactDOMre.Style.make</code>接受<code class="fe ot ou ov nt b">unit</code> —也称为<code class="fe ot ou ov nt b">()</code> —作为它的最后一个参数。来自JavaScript，一开始对我来说没什么意义。我想通过分析这个函数，我们可以学到很多关于理性的东西。</p><ol class=""><li id="9d4b" class="lr ls iq jp b jq jr ju jv jy lt kc lu kg lv kk lw lx ly lz bi translated"><a class="ae ks" href="https://reasonml.github.io/guide/language/function#no-argument" rel="noopener ugc nofollow" target="_blank">单位</a>类似于JavaScript中的“无参数”。</li><li id="efe3" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk lw lx ly lz bi translated">所有推理函数都接受单个参数。多参数函数只是<a class="ae ks" href="https://reasonml.github.io/guide/language/function#currying" rel="noopener ugc nofollow" target="_blank">迎合</a>单参数函数的语法糖。</li><li id="0481" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk lw lx ly lz bi translated">推理函数可以有<a class="ae ks" href="https://reasonml.github.io/guide/language/function#optional-labeled-arguments" rel="noopener ugc nofollow" target="_blank">可选的带标签的参数</a>。</li><li id="d240" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk lw lx ly lz bi translated"><code class="fe ot ou ov nt b"><a class="ae ks" href="https://github.com/reasonml/reason-react/blob/e508d529fb2c9bf9328498540cd92774fd57315d/src/ReactDOMRe.re#L587" rel="noopener ugc nofollow" target="_blank">color</a></code>是一个可选的带标签的参数——事实上，所有CSS属性都被实现为可选的带标签的参数。</li><li id="8478" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk lw lx ly lz bi translated">由于所有CSS属性都是可选的<code class="fe ot ou ov nt b">ReasonDOMRe.Style.make</code>标签参数，有可能它们都没有被使用。</li><li id="d06a" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk lw lx ly lz bi translated">当所有参数都是可选的时，需要将单元传递给<code class="fe ot ou ov nt b">ReasonDOMRe.Style.make</code>来调用函数。</li></ol></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><h1 id="9c78" class="mp mq iq bd mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm bi translated">让它旋转起来</h1><p id="e393" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">请祝贺你自己能走到这一步。我想这就要有回报了。</p><p id="5f59" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们当前的目标:学习有状态组件如何在ReasonReact中工作，以及如何处理DOM事件。</p><p id="4edb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要旋转转盘，我们只需更改<code class="fe ot ou ov nt b">#carousel</code>元素上的<code class="fe ot ou ov nt b">rotateY</code>数量:</p><p id="e5ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ot ou ov nt b">style="transform: translate3d(...) <strong class="jp ir">rotateY</strong>(0deg);"</code></p><h2 id="4b67" class="nx mq iq bd mr oc od dn mv oe of dp mz jy og oh nd kc oi oj nh kg ok ol nl om bi translated">家政</h2><p id="f7c4" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">与其硬编码<code class="fe ot ou ov nt b">sides</code>、<code class="fe ot ou ov nt b">radius</code> &amp; <code class="fe ot ou ov nt b">transform</code>，不如接受他们作为道具吧。</p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="5781" class="nx mq iq nt b gy ny nz l oa ob">let make = (~sides, ~radius, ~transform, _children) =&gt; {<br/>  ...component,<br/>  render: (_self) =&gt;<br/>    &lt;section id="carousel" style=(ReactDOMRe.Style.make(~transform, ()))&gt;<br/>      (ReasonReact.arrayToElement(create_sides(sides, radius)))<br/>    &lt;/section&gt;<br/>};</span></pre><p id="f29b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我们之前在<code class="fe ot ou ov nt b">app.css</code>中硬编码了<code class="fe ot ou ov nt b">perspective</code>，所以让我们删除<code class="fe ot ou ov nt b">app.css</code>中<code class="fe ot ou ov nt b">#root</code>的样式。</p><p id="3456" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们将<code class="fe ot ou ov nt b">app.re</code>重命名为<code class="fe ot ou ov nt b">carousel.re</code>(类似于<code class="fe ot ou ov nt b">app.css</code>)。我们将创建<code class="fe ot ou ov nt b">container.re</code>来管理3D转盘的状态。然后，我们将让<code class="fe ot ou ov nt b">index.re</code>渲染<code class="fe ot ou ov nt b">&lt;Container sides=... friction=... /&gt;</code>而不是<code class="fe ot ou ov nt b">&lt;App /&gt;</code>。</p></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><p id="2a5d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ot ou ov nt b">container.css</code></p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="55d3" class="nx mq iq nt b gy ny nz l oa ob">#container {<br/>  height: 100vh;<br/>  width: 100vw;<br/>  overflow: hidden;<br/>  position: relative;<br/>  background: white;<br/>}</span></pre><p id="d6a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ot ou ov nt b">container.re</code></p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="3d9e" class="nx mq iq nt b gy ny nz l oa ob">[%bs.raw {|require('./container.css')|}];</span><span id="e073" class="nx mq iq nt b gy ow nz l oa ob">type action =<br/>  | StartInteraction(int)<br/>  | MoveInteraction(int)<br/>  | EndInteraction(int)<br/>  | Spin(float);</span><span id="9707" class="nx mq iq nt b gy ow nz l oa ob">type values = {<br/>  initial: ref(float),<br/>  final: ref(float),<br/>  current: ref(float),<br/>  previous: ref(float)<br/>};</span><span id="c601" class="nx mq iq nt b gy ow nz l oa ob">type velocity = {<br/>  current: ref(float),<br/>  list: ref(list(float))<br/>};</span><span id="5c05" class="nx mq iq nt b gy ow nz l oa ob">type css = {<br/>  perspective: string,<br/>  transform: string<br/>};</span><span id="d9c6" class="nx mq iq nt b gy ow nz l oa ob">type state = {<br/>  requestAnimationFrameID: ref(int),<br/>  rotation: ref(float),<br/>  radius: float,<br/>  isMouseDown: ref(bool),<br/>  position: values,<br/>  time: values,<br/>  velocity,<br/>  css<br/>};</span><span id="5d40" class="nx mq iq nt b gy ow nz l oa ob">[<a class="ae ks" href="http://twitter.com/bs" rel="noopener ugc nofollow" target="_blank">@bs</a>.val] external requestAnimationFrame : (unit =&gt; unit) =&gt; int = "requestAnimationFrame";</span><span id="7bc2" class="nx mq iq nt b gy ow nz l oa ob">[<a class="ae ks" href="http://twitter.com/bs" rel="noopener ugc nofollow" target="_blank">@bs</a>.val] external cancelAnimationFrame : int =&gt; unit = "cancelAnimationFrame";</span><span id="ec64" class="nx mq iq nt b gy ow nz l oa ob">[<a class="ae ks" href="http://twitter.com/bs" rel="noopener ugc nofollow" target="_blank">@bs</a>.val] [<a class="ae ks" href="http://twitter.com/bs" rel="noopener ugc nofollow" target="_blank">@bs</a>.scope "performance"] external now : unit =&gt; float = "now";</span><span id="91ad" class="nx mq iq nt b gy ow nz l oa ob">[<a class="ae ks" href="http://twitter.com/bs" rel="noopener ugc nofollow" target="_blank">@bs</a>.val] [<a class="ae ks" href="http://twitter.com/bs" rel="noopener ugc nofollow" target="_blank">@bs</a>.scope "Math"] external abs : float =&gt; float = "abs";</span><span id="775f" class="nx mq iq nt b gy ow nz l oa ob">[<a class="ae ks" href="http://twitter.com/bs" rel="noopener ugc nofollow" target="_blank">@bs</a>.val] [<a class="ae ks" href="http://twitter.com/bs" rel="noopener ugc nofollow" target="_blank">@bs</a>.scope "Math"] external round : float =&gt; int = "round";</span><span id="ee77" class="nx mq iq nt b gy ow nz l oa ob">external unsafeAnyToArray : 'a =&gt; array('a) = "%identity";</span><span id="b0d8" class="nx mq iq nt b gy ow nz l oa ob">let component = ReasonReact.reducerComponent("Container");</span><span id="c7b1" class="nx mq iq nt b gy ow nz l oa ob">let findAndFilter = (~list, ~n, ~f) =&gt; {<br/>  let rec aux = (list', n', acc) =&gt;<br/>    if (n' == 0) {<br/>      acc<br/>    } else {<br/>      switch list' {<br/>      | [] =&gt; []<br/>      | [item, ...rest] =&gt;<br/>        if (f(item)) {<br/>          aux(rest, n' - 1, [item, ...acc])<br/>        } else {<br/>          aux(rest, n', acc)<br/>        }<br/>      }<br/>    };<br/>  aux(list, n, [])<br/>};</span><span id="90bf" class="nx mq iq nt b gy ow nz l oa ob">let rec sum = (list) =&gt;<br/>  switch list {<br/>  | [] =&gt; 0.0<br/>  | [item, ...rest] =&gt; item +. sum(rest)<br/>  };</span><span id="8b04" class="nx mq iq nt b gy ow nz l oa ob">let averageLatestNonzeroVelocities = (velocities, n) =&gt; {<br/>  let latestNonzeroVelocities = findAndFilter(~list=velocities, ~n, ~f=(item) =&gt; item != 0.0);<br/>  sum(latestNonzeroVelocities) /. float_of_int(n)<br/>};</span><span id="e8d1" class="nx mq iq nt b gy ow nz l oa ob">let spinWithFriction = (state, reduce, friction, sides) =&gt; {<br/>  let rec onAnimationFrame = (velocity', ()) =&gt; {<br/>    state.velocity.current := velocity';<br/>    if (state.isMouseDown^) {<br/>      Js.log("The carousel has previously been spun.")<br/>    } else if (abs(velocity') &lt; friction) {<br/>      cancelAnimationFrame(state.requestAnimationFrameID^);<br/>      let degreesPerSide = 360.0 /. float_of_int(sides);<br/>      let currentSide =<br/>        if (state.rotation^ &lt; 0.0) {<br/>          round(abs(state.rotation^) /. degreesPerSide) mod sides<br/>        } else {<br/>          (sides - round(abs(state.rotation^) /. degreesPerSide) mod sides) mod sides<br/>        };<br/>      Js.log("You've landed on side " ++ (string_of_int(currentSide + 1) ++ "."))<br/>    } else {<br/>      Js.log(velocity');<br/>      reduce((_) =&gt; Spin(velocity'), ());<br/>      state.requestAnimationFrameID :=<br/>        requestAnimationFrame(<br/>          onAnimationFrame(velocity' &gt; 0.0 ? velocity' -. friction : velocity' +. friction)<br/>        )<br/>    }<br/>  };<br/>  state.requestAnimationFrameID := requestAnimationFrame(onAnimationFrame(state.velocity.current^))<br/>};</span><span id="ba54" class="nx mq iq nt b gy ow nz l oa ob">let make = (~sides, ~friction, _children) =&gt; {<br/>  ...component,<br/>  initialState: () =&gt; {<br/>    let radius = 25.0 /. Js.Math.tan(180.0 /. float_of_int(sides) *. (Js.Math._PI /. 180.0));<br/>    {<br/>      requestAnimationFrameID: ref(0),<br/>      radius,<br/>      rotation: ref(0.0),<br/>      isMouseDown: ref(false),<br/>      position: {initial: ref(0.0), final: ref(0.0), current: ref(0.0), previous: ref(0.0)},<br/>      time: {initial: ref(0.0), final: ref(0.0), current: ref(0.0), previous: ref(0.0)},<br/>      css: {<br/>        perspective: string_of_float(500.0 /. float_of_int(sides)) ++ "0vw",<br/>        transform:<br/>          "translate3d(0, 0, -"<br/>          ++ (string_of_float(radius) ++ ("0vw) rotateY(" ++ (string_of_float(0.0) ++ "0deg)")))<br/>      },<br/>      velocity: {current: ref(0.0), list: ref([])}<br/>    }<br/>  },<br/>  reducer: (action, state) =&gt;<br/>    switch action {<br/>    | StartInteraction(clientX) =&gt;<br/>      state.isMouseDown := true;<br/>      state.position.previous := float_of_int(clientX);<br/>      state.time.initial := now();<br/>      state.time.previous := now();<br/>      state.velocity.current := 0.0;<br/>      state.velocity.list := [];<br/>      ReasonReact.NoUpdate<br/>    | MoveInteraction(clientX) =&gt;<br/>      state.isMouseDown^ ?<br/>        {<br/>          state.position.current := float_of_int(clientX);<br/>          state.time.current := now();<br/>          state.rotation :=<br/>            state.rotation^<br/>            -. (state.position.previous^ -. state.position.current^)<br/>            /. float_of_int(sides * 2);<br/>          let transform =<br/>            "translate3d(0, 0, -"<br/>            ++ (<br/>              string_of_float(state.radius)<br/>              ++ ("0vw) rotateY(" ++ (string_of_float(state.rotation^) ++ "0deg)"))<br/>            );<br/>          let dx = state.position.current^ -. state.position.previous^;<br/>          let dt = state.time.current^ -. state.time.previous^;<br/>          state.velocity.current := dx /. dt;<br/>          state.velocity.list := [state.velocity.current^, ...state.velocity.list^];<br/>          state.position.previous := state.position.current^;<br/>          state.time.previous := state.time.current^;<br/>          ReasonReact.Update({...state, css: {perspective: state.css.perspective, transform}})<br/>        } :<br/>        ReasonReact.NoUpdate<br/>    | EndInteraction(clientX) =&gt;<br/>      state.isMouseDown := false;<br/>      state.position.final := float_of_int(clientX);<br/>      state.time.final := now();<br/>      state.velocity.current := averageLatestNonzeroVelocities(state.velocity.list^, 3);<br/>      ReasonReact.SideEffects(<br/>        ((self) =&gt; spinWithFriction(self.state, self.reduce, friction, sides))<br/>      )<br/>    | Spin(velocity) =&gt;<br/>      state.rotation := state.rotation^ +. velocity;<br/>      let transform =<br/>        "translate3d(0, 0, -"<br/>        ++ (<br/>          string_of_float(state.radius)<br/>          ++ ("0vw) rotateY(" ++ (string_of_float(state.rotation^) ++ "0deg)"))<br/>        );<br/>      ReasonReact.Update({...state, css: {perspective: state.css.perspective, transform}})<br/>    },<br/>  render: (self) =&gt;<br/>    &lt;div<br/>      id="container"<br/>      onMouseDown=(self.reduce((event) =&gt; StartInteraction(ReactEventRe.Mouse.clientX(event))))<br/>      onMouseMove=(self.reduce((event) =&gt; MoveInteraction(ReactEventRe.Mouse.clientX(event))))<br/>      onMouseUp=(self.reduce((event) =&gt; EndInteraction(ReactEventRe.Mouse.clientX(event))))<br/>      onTouchStart=(<br/>        self.reduce(<br/>          (event) =&gt;<br/>            StartInteraction(<br/>              unsafeAnyToArray(ReactEventRe.Touch.changedTouches(event))[0]##clientX<br/>            )<br/>        )<br/>      )<br/>      onTouchMove=(<br/>        self.reduce(<br/>          (event) =&gt;<br/>            MoveInteraction(unsafeAnyToArray(ReactEventRe.Touch.changedTouches(event))[0]##clientX)<br/>        )<br/>      )<br/>      onTouchEnd=(<br/>        self.reduce(<br/>          (event) =&gt;<br/>            EndInteraction(unsafeAnyToArray(ReactEventRe.Touch.changedTouches(event))[0]##clientX)<br/>        )<br/>      )<br/>      style=(ReactDOMRe.Style.make(~perspective=self.state.css.perspective, ()))&gt;<br/>      &lt;Carousel sides radius=self.state.radius transform=self.state.css.transform /&gt;<br/>    &lt;/div&gt;<br/>};</span></pre><p id="0362" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ot ou ov nt b">carousel.css</code></p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="09c0" class="nx mq iq nt b gy ny nz l oa ob">#carousel {<br/>  position: absolute;<br/>  transform-style: preserve-3d;<br/>  backface-visibility: visible;<br/>  display: flex;<br/>  align-items: center;<br/>  justify-content: center;<br/>  width: 50vw;<br/>  height: 60vh;<br/>  top: 0;<br/>  left: 0;<br/>  right: 0;<br/>  bottom: 0;<br/>  margin: auto;<br/>  cursor: pointer;<br/>}<br/>#carousel figure {<br/>  font-size: 3vw;<br/>  position: absolute;<br/>  background: rgba(220, 220, 220, 0.95);<br/>  overflow: hidden;<br/>  display: flex;<br/>  align-items: center;<br/>  justify-content: center;<br/>  box-sizing: border-box;<br/>  border: 2px solid black;<br/>  width: 100%;<br/>  height: inherit;<br/>  margin: 0;<br/>  top: 0;<br/>  left: 0;<br/>  user-select: none;<br/>}</span></pre><p id="4e8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ot ou ov nt b">carousel.re</code></p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="bc6c" class="nx mq iq nt b gy ny nz l oa ob">[%bs.raw {|require('./carousel.css')|}];</span><span id="a0d2" class="nx mq iq nt b gy ow nz l oa ob">let component = ReasonReact.statelessComponent("Carousel");</span><span id="9bb0" class="nx mq iq nt b gy ow nz l oa ob">let create_sides = (sides, radius) =&gt;<br/>  Array.init(<br/>    sides,<br/>    (index) =&gt; {<br/>      let css =<br/>        "rotate3d(0, 1, 0,"<br/>        ++ (<br/>          string_of_float(360.0 *. float_of_int(index) /. float_of_int(sides))<br/>          ++ ("0deg) translate3d(0, 0," ++ (string_of_float(radius) ++ "0vw)"))<br/>        );<br/>      &lt;figure key=(string_of_int(index)) style=(ReactDOMRe.Style.make(~transform=css, ()))&gt;<br/>        (ReasonReact.stringToElement(string_of_int(index + 1)))<br/>      &lt;/figure&gt;<br/>    }<br/>  );</span><span id="c35e" class="nx mq iq nt b gy ow nz l oa ob">let make = (~sides, ~radius, ~transform, _children) =&gt; {<br/>  ...component,<br/>  render: (_self) =&gt;<br/>    &lt;section id="carousel" style=(ReactDOMRe.Style.make(~transform, ()))&gt;<br/>      (ReasonReact.arrayToElement(create_sides(sides, radius)))<br/>    &lt;/section&gt;<br/>};</span></pre><p id="afd3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ot ou ov nt b">index.re</code></p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="af06" class="nx mq iq nt b gy ny nz l oa ob">ReactDOMRe.renderToElementWithId<br/>  &lt;Container sides=8 friction=0.0175 /&gt; "root";</span></pre><p id="d135" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在浏览器中，我们可以看到我们可以旋转我们的3D旋转木马！</p><h1 id="90d1" class="mp mq iq bd mr ms on mu mv mw oo my mz na op nc nd ne oq ng nh ni or nk nl nm bi translated">逐渐地</h1><p id="920c" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">我们来分解一下有状态组件:<code class="fe ot ou ov nt b">container.re</code>。来自<a class="ae ks" href="https://reasonml.github.io/reason-react/docs/en/state-actions-reducer.html" rel="noopener ugc nofollow" target="_blank">文档</a>:</p><blockquote class="kl km kn"><p id="c291" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">React有状态组件类似于ReactJS有状态组件，只是内置了“reducer”的概念(如<a class="ae ks" href="http://redux.js.org/" rel="noopener ugc nofollow" target="_blank"> Redux </a>)。</p></blockquote><h2 id="6522" class="nx mq iq bd mr oc od dn mv oe of dp mz jy og oh nd kc oi oj nh kg ok ol nl om bi translated">行动</h2><p id="94e2" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">改变状态的唯一方法是通过下面的动作。</p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="6bde" class="nx mq iq nt b gy ny nz l oa ob">type action =<br/>  | StartInteraction(int)<br/>  | MoveInteraction(int)<br/>  | EndInteraction(int)<br/>  | Spin(float);</span></pre><h2 id="0797" class="nx mq iq bd mr oc od dn mv oe of dp mz jy og oh nd kc oi oj nh kg ok ol nl om bi translated">状态</h2><p id="3ffc" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">以下类型用于塑造<code class="fe ot ou ov nt b">container.re's</code>状态。<code class="fe ot ou ov nt b"><a class="ae ks" href="https://reasonml.github.io/guide/language/mutation" rel="noopener ugc nofollow" target="_blank">ref</a></code>意思是“可变的”</p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="c6fd" class="nx mq iq nt b gy ny nz l oa ob">type values = {<br/>  initial: ref(float),<br/>  final: ref(float),<br/>  current: ref(float),<br/>  previous: ref(float)<br/>};</span><span id="5cd1" class="nx mq iq nt b gy ow nz l oa ob">type velocity = {<br/>  current: ref(float),<br/>  list: ref(list(float))<br/>};</span><span id="e5fd" class="nx mq iq nt b gy ow nz l oa ob">type css = {<br/>  perspective: string,<br/>  transform: string<br/>};</span><span id="e5fa" class="nx mq iq nt b gy ow nz l oa ob">type state = {<br/>  requestAnimationFrameID: ref(int),<br/>  rotation: ref(float),<br/>  radius: float,<br/>  isMouseDown: ref(bool),<br/>  position: values,<br/>  time: values,<br/>  velocity,<br/>  css<br/>};</span></pre><p id="e519" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">指出ReactJS和ReasonReact之间的以下区别很重要。在ReactJS中，每次组件的状态改变时，组件都会被重新呈现。由于这个原因，在ReactJS中，我们有组件状态之外的变量。从原因反应<a class="ae ks" href="https://reasonml.github.io/reason-react/docs/en/instance-variables.html" rel="noopener ugc nofollow" target="_blank">文档</a>:</p><blockquote class="kl km kn"><p id="8741" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">实际上，这只不过是一种几乎不加掩饰的方式来改变组件的“状态”，而不会触发重新渲染。ReasonReact要求您正确地将这些实例变量放入组件的<code class="fe ot ou ov nt b"><em class="iq">state</em></code>和Reason <code class="fe ot ou ov nt b"><em class="iq">ref</em></code>中。</p></blockquote><p id="1026" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，更新<code class="fe ot ou ov nt b">state.isMouseDown</code>不会触发重新渲染。事实上，<strong class="jp ir">唯一可以触发重新渲染的字段</strong>是<code class="fe ot ou ov nt b">state.radius</code> &amp; <code class="fe ot ou ov nt b">state.css</code>。其余的都是实例变量。</p><h2 id="07a4" class="nx mq iq bd mr oc od dn mv oe of dp mz jy og oh nd kc oi oj nh kg ok ol nl om bi translated">自定义JavaScript绑定</h2><p id="b46c" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">如前所述，使用Bucklescript，我们可以创建自己的JavaScript绑定。我们将很快看到这些是如何使用的。</p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="0cc7" class="nx mq iq nt b gy ny nz l oa ob">[<a class="ae ks" href="http://twitter.com/bs" rel="noopener ugc nofollow" target="_blank">@bs</a>.val] external requestAnimationFrame : (unit =&gt; unit) =&gt; int = "requestAnimationFrame";</span><span id="1862" class="nx mq iq nt b gy ow nz l oa ob">[<a class="ae ks" href="http://twitter.com/bs" rel="noopener ugc nofollow" target="_blank">@bs</a>.val] external cancelAnimationFrame : int =&gt; unit = "cancelAnimationFrame";</span><span id="7ca9" class="nx mq iq nt b gy ow nz l oa ob">[<a class="ae ks" href="http://twitter.com/bs" rel="noopener ugc nofollow" target="_blank">@bs</a>.val] [<a class="ae ks" href="http://twitter.com/bs" rel="noopener ugc nofollow" target="_blank">@bs</a>.scope "performance"] external now : unit =&gt; float = "now";</span><span id="b1db" class="nx mq iq nt b gy ow nz l oa ob">[<a class="ae ks" href="http://twitter.com/bs" rel="noopener ugc nofollow" target="_blank">@bs</a>.val] [<a class="ae ks" href="http://twitter.com/bs" rel="noopener ugc nofollow" target="_blank">@bs</a>.scope "Math"] external abs : float =&gt; float = "abs";</span><span id="526c" class="nx mq iq nt b gy ow nz l oa ob">[<a class="ae ks" href="http://twitter.com/bs" rel="noopener ugc nofollow" target="_blank">@bs</a>.val] [<a class="ae ks" href="http://twitter.com/bs" rel="noopener ugc nofollow" target="_blank">@bs</a>.scope "Math"] external round : float =&gt; int = "round";</span><span id="15c0" class="nx mq iq nt b gy ow nz l oa ob">external unsafeAnyToArray : 'a =&gt; array('a) = "%identity";</span></pre><p id="cfe7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后一个用于将<code class="fe ot ou ov nt b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/TouchList" rel="noopener ugc nofollow" target="_blank">TouchList</a></code>转换为<code class="fe ot ou ov nt b">array</code>。我不确定是否有更安全的方法，但是如果有人知道，请分享！</p><h2 id="3827" class="nx mq iq bd mr oc od dn mv oe of dp mz jy og oh nd kc oi oj nh kg ok ol nl om bi translated">初态</h2><p id="f840" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">来自<a class="ae ks" href="https://reasonml.github.io/reason-react/#reason-react-component-creation-state-actions-reducer" rel="noopener ugc nofollow" target="_blank">文件</a>:</p><blockquote class="kl km kn"><p id="3087" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">ReactJS' <code class="fe ot ou ov nt b">getInitialState</code>在ReasonReact中被称为<code class="fe ot ou ov nt b">initialState</code>。</p></blockquote><p id="3b50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">按理说，函数的最后一条语句返回。这里，返回类型为<code class="fe ot ou ov nt b">state</code>的记录。它属于<code class="fe ot ou ov nt b">state</code>类型，因为它与上面定义的<code class="fe ot ou ov nt b">type state</code>的形状相匹配。按道理，类型是推断出来的。</p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="cf79" class="nx mq iq nt b gy ny nz l oa ob"><strong class="nt ir">initialState</strong>: () =&gt; {<br/>    let radius = 25.0 /. Js.Math.tan(180.0 /. float_of_int(sides) *. (Js.Math._PI /. 180.0));<br/>    {<br/>      requestAnimationFrameID: ref(0),<br/>      radius,<br/>      rotation: ref(0.0),<br/>      isMouseDown: ref(false),<br/>      position: {initial: ref(0.0), final: ref(0.0), current: ref(0.0), previous: ref(0.0)},<br/>      time: {initial: ref(0.0), final: ref(0.0), current: ref(0.0), previous: ref(0.0)},<br/>      css: {<br/>        perspective: string_of_float(500.0 /. float_of_int(sides)) ++ "0vw",<br/>        transform:<br/>          "translate3d(0, 0, -"<br/>          ++ (string_of_float(radius) ++ ("0vw) rotateY(" ++ (string_of_float(0.0) ++ "0deg)")))<br/>      },<br/>      velocity: {current: ref(0.0), list: ref([])}<br/>    }<br/>  },</span></pre><h2 id="6040" class="nx mq iq bd mr oc od dn mv oe of dp mz jy og oh nd kc oi oj nh kg ok ol nl om bi translated">还原剂</h2><p id="7980" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">reducer <a class="ae ks" href="https://reasonml.github.io/guide/language/pattern-matching" rel="noopener ugc nofollow" target="_blank">模式匹配所有可能的动作</a>，并定义每个动作应该如何更新状态。这里我们可以看到我们使用的一个定制JavaScript绑定，<code class="fe ot ou ov nt b">now</code>(绑定到<code class="fe ot ou ov nt b">performance.now</code>)。</p><p id="4f1c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ot ou ov nt b">:=</code>语法用于更新一个<code class="fe ot ou ov nt b">ref</code>。</p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="9a2a" class="nx mq iq nt b gy ny nz l oa ob">reducer: (action, state) =&gt;<br/>    switch action {<br/>    | StartInteraction(clientX) =&gt;<br/>      state.isMouseDown := true;<br/>      state.position.previous := float_of_int(clientX);<br/>      state.time.initial := now();<br/>      state.time.previous := now();<br/>      state.velocity.current := 0.0;<br/>      state.velocity.list := [];<br/>      <strong class="nt ir">ReasonReact.NoUpdate<br/>    ...</strong></span></pre><p id="8086" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">值得注意的是，每个动作必须返回下列值之一(来自<a class="ae ks" href="https://reasonml.github.io/reason-react/docs/en/state-actions-reducer.html" rel="noopener ugc nofollow" target="_blank">文档</a>):</p><ul class=""><li id="f3cb" class="lr ls iq jp b jq jr ju jv jy lt kc lu kg lv kk pm lx ly lz bi translated"><code class="fe ot ou ov nt b">ReasonReact.NoUpdate</code>:不做状态更新。</li><li id="e1e1" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk pm lx ly lz bi translated"><code class="fe ot ou ov nt b">ReasonReact.Update(state)</code>:更新状态。</li><li id="9dd6" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk pm lx ly lz bi translated"><code class="fe ot ou ov nt b">ReasonReact.SideEffects((self) =&gt; unit)</code>:无状态更新，但触发副作用，如<code class="fe ot ou ov nt b">ReasonReact.SideEffects((_self) =&gt; Js.log("hello!"))</code>。</li><li id="e0cc" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk pm lx ly lz bi translated"><code class="fe ot ou ov nt b">ReasonReact.UpdateWithSideEffects((state, self) =&gt; unit)</code>:更新状态，<strong class="jp ir">然后</strong>触发副作用。</li></ul><blockquote class="kl km kn"><p id="fe78" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">“副作用”大致意思是“在某处改变了某些东西”。Js.log是一个副作用，因为它向控制台写入了一些数据。将数据写入数据库也是一个副作用。甚至从数据库中读取数据也是一种副作用，因为运行从数据库中读取数据的函数可能会在多次调用时产生不同的输出。</p></blockquote><p id="d513" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以有把握地说<code class="fe ot ou ov nt b">StartInteraction</code>不会触发重新渲染。但是我们如何引发一个行动呢？</p><h2 id="7757" class="nx mq iq bd mr oc od dn mv oe of dp mz jy og oh nd kc oi oj nh kg ok ol nl om bi translated">触发一个动作</h2><p id="e846" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">向<code class="fe ot ou ov nt b">render</code>函数传递一个名为<code class="fe ot ou ov nt b">self</code>的参数。来自<a class="ae ks" href="https://reasonml.github.io/reason-react/docs/en/state-actions-reducer.html" rel="noopener ugc nofollow" target="_blank">文档</a>:</p><ul class=""><li id="563f" class="lr ls iq jp b jq jr ju jv jy lt kc lu kg lv kk pm lx ly lz bi translated">当前的<code class="fe ot ou ov nt b">state</code>值可以通过<code class="fe ot ou ov nt b">self.state</code>访问，只要<code class="fe ot ou ov nt b">self</code>作为某个函数的参数传递给你。</li><li id="23f1" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk pm lx ly lz bi translated">在<code class="fe ot ou ov nt b">render</code>中，您将使用<code class="fe ot ou ov nt b">self.reduce</code>而不是<code class="fe ot ou ov nt b">self.handle</code>(不允许状态更新)。<code class="fe ot ou ov nt b">reduce</code>接受一个回调，向它传递事件(或者<code class="fe ot ou ov nt b">onSubmit</code> / <code class="fe ot ou ov nt b">onClick</code> / <code class="fe ot ou ov nt b">onFoo</code>从<code class="fe ot ou ov nt b">MyDialog</code>给你的任何回调负载)，并请求一个动作作为返回值。</li></ul><p id="7c9c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的代码中，回调有效载荷是<code class="fe ot ou ov nt b">clientX</code>。</p><p id="1308" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">记住，<code class="fe ot ou ov nt b">StartInteraction</code>接受一个<code class="fe ot ou ov nt b">int</code>。那个<code class="fe ot ou ov nt b">int</code>就是<code class="fe ot ou ov nt b">clientX</code>。</p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="8a94" class="nx mq iq nt b gy ny nz l oa ob">render: (self) =&gt;<br/>    &lt;div<br/>      id="container"<br/>      onMouseDown=(self.reduce((event) =&gt; <strong class="nt ir">StartInteraction</strong>(ReactEventRe.Mouse.clientX(event))))<br/>      onMouseMove=(self.reduce((event) =&gt; <strong class="nt ir">MoveInteraction</strong>(ReactEventRe.Mouse.clientX(event))))<br/>      onMouseUp=(self.reduce((event) =&gt; <strong class="nt ir">EndInteraction</strong>(ReactEventRe.Mouse.clientX(event))))<br/>      ...<br/>    &lt;/div&gt;</span></pre><p id="893a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我也可以有这样的东西:</p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="557d" class="nx mq iq nt b gy ny nz l oa ob">type <strong class="nt ir">clientX</strong> = int;</span><span id="ffa7" class="nx mq iq nt b gy ow nz l oa ob">type action =<br/>  | StartInteraction(<strong class="nt ir">clientX)</strong><br/>  | MoveInteraction(<strong class="nt ir">clientX)</strong><br/>  | EndInteraction(<strong class="nt ir">clientX)</strong><br/>  | Spin(float);</span></pre><h1 id="33b0" class="mp mq iq bd mr ms on mu mv mw oo my mz na op nc nd ne oq ng nh ni or nk nl nm bi translated">自旋动作是如何触发的？</h1><p id="7965" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">您可能会注意到，上面只显示了如何触发<code class="fe ot ou ov nt b">StartInteraction</code>、<code class="fe ot ou ov nt b">MoveInteraction</code>和<code class="fe ot ou ov nt b">EndInteraction</code>。</p><p id="49df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ot ou ov nt b">Spin</code>用于根据用户拖动运动的计算速度旋转转盘。一旦用户停止与转盘(即<code class="fe ot ou ov nt b">onMouseUp</code>)的交互，就会触发<code class="fe ot ou ov nt b">Spin</code>动作。</p><p id="2326" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么，我们如何将它转化为代码呢？</p><p id="bbab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们检查一下<code class="fe ot ou ov nt b">reducer</code>中的<code class="fe ot ou ov nt b">EndInteraction</code>箱。</p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="cf81" class="nx mq iq nt b gy ny nz l oa ob">| <strong class="nt ir">EndInteraction</strong>(clientX) =&gt;<br/>  state.isMouseDown := false;<br/>  state.position.final := float_of_int(clientX);<br/>  state.time.final := now();<br/>  state.velocity.current := averageLatestNonzeroVelocities(state.velocity.list^, 3);<br/>  ReasonReact.SideEffects(<br/>    ((self) =&gt; spinWithFriction(self.state, self.reduce, friction, sides))<br/>  )</span></pre><p id="3e17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里重要的一点是:</p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="0e60" class="nx mq iq nt b gy ny nz l oa ob"><strong class="nt ir">ReasonReact.SideEffects</strong>((self) =&gt; spinWithFriction(self.state, self.reduce, friction, sides))</span></pre><p id="bcf3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ot ou ov nt b">Spin</code>是副作用的结果！一个名为<code class="fe ot ou ov nt b">spinWithFriction</code>的辅助函数接受<code class="fe ot ou ov nt b">state</code>(当前状态)和<code class="fe ot ou ov nt b">reduce</code>(一个可以触发动作的函数，与<code class="fe ot ou ov nt b">render</code>中使用的相同)。</p><p id="ed8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:<code class="fe ot ou ov nt b">ReasonReact.SideEffects</code>通过<code class="fe ot ou ov nt b">self</code>，但是<code class="fe ot ou ov nt b">ReasonReact.Update </code>没有。因为我们可以访问<code class="fe ot ou ov nt b">self</code>，所以我们可以在一个助手函数中更新状态。</p><p id="d42e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们检查一下<code class="fe ot ou ov nt b">spinWithFriction</code>助手函数。</p><p id="52fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:</p><ul class=""><li id="eb40" class="lr ls iq jp b jq jr ju jv jy lt kc lu kg lv kk pm lx ly lz bi translated">我们在这里使用了一些自定义的JavaScript绑定，比如<code class="fe ot ou ov nt b">requestAnimationFrame</code>和<code class="fe ot ou ov nt b">cancelAnimationFrame</code></li><li id="b7f7" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk pm lx ly lz bi translated"><code class="fe ot ou ov nt b">^</code>语法用于获取<code class="fe ot ou ov nt b">ref</code>的当前值</li><li id="ff29" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk pm lx ly lz bi translated"><code class="fe ot ou ov nt b"><a class="ae ks" href="https://reasonml.github.io/guide/language/function#recursive-functions" rel="noopener ugc nofollow" target="_blank">rec</a></code>用于定义递归函数</li><li id="050d" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk pm lx ly lz bi translated"><code class="fe ot ou ov nt b">velocity'</code>只是一个变量名(读作velocity prime)</li><li id="ec72" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk pm lx ly lz bi translated"><code class="fe ot ou ov nt b">reduce (() =&gt; Spin(velocity’), ());</code>用于从助手功能中触发一个动作</li></ul><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="0d36" class="nx mq iq nt b gy ny nz l oa ob">let <strong class="nt ir">spinWithFriction</strong> = (<strong class="nt ir">state</strong>, <strong class="nt ir">reduce</strong>, friction, sides) =&gt; {<br/>  let <strong class="nt ir">rec</strong> <strong class="nt ir">onAnimationFrame</strong> = (velocity', ()) =&gt; {<br/>    state.velocity.current := velocity';<br/>    if (state.isMouseDown^) {<br/>      Js.log("The carousel has previously been spun.")<br/>    } else if (abs(velocity') &lt; friction) {<br/>      cancelAnimationFrame(state.requestAnimationFrameID^);<br/>      let degreesPerSide = 360.0 /. float_of_int(sides);<br/>      let currentSide =<br/>        if (state.rotation^ &lt; 0.0) {<br/>          round(abs(state.rotation^) /. degreesPerSide) mod sides<br/>        } else {<br/>          (sides - round(abs(state.rotation^) /. degreesPerSide) mod sides) mod sides<br/>        };<br/>      Js.log("You've landed on side " ++ (string_of_int(currentSide + 1) ++ "."))<br/>    } else {<br/>      Js.log(velocity');<br/>      <strong class="nt ir">reduce</strong>((_) =&gt; <strong class="nt ir">Spin</strong>(<strong class="nt ir">velocity'</strong>), ());<br/>      state.requestAnimationFrameID :=<br/>        requestAnimationFrame(<br/>          onAnimationFrame(velocity' &gt; 0.0 ? velocity' -. friction : velocity' +. friction)<br/>        )<br/>    }<br/>  };<br/>  state.requestAnimationFrameID := requestAnimationFrame(onAnimationFrame(state.velocity.current^))<br/>};</span></pre><p id="3ef0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们检查<code class="fe ot ou ov nt b">reducer</code>中的<code class="fe ot ou ov nt b">Spin</code>箱。</p><pre class="ku kv kw kx gt ns nt nu nv aw nw bi"><span id="607e" class="nx mq iq nt b gy ny nz l oa ob">| Spin(velocity) =&gt;<br/>  state.rotation := state.rotation^ +. velocity;<br/>  let transform =<br/>    "translate3d(0, 0, -"<br/>    ++ (<br/>      string_of_float(state.radius)<br/>      ++ ("0vw) rotateY(" ++ (string_of_float(state.rotation^) ++ "0deg)"))<br/>    );<br/>  <strong class="nt ir">ReasonReact.Update({...state, css: {perspective: state.css.perspective, transform}})</strong><br/>},</span></pre><p id="9772" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们用新的CSS更新<code class="fe ot ou ov nt b">state</code>！</p><h1 id="9058" class="mp mq iq bd mr ms on mu mv mw oo my mz na op nc nd ne oq ng nh ni or nk nl nm bi translated">带保留道具</h1><p id="8f45" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">GitHub上的示例包括第三个组件，用于显示<code class="fe ot ou ov nt b">sides</code>、<code class="fe ot ou ov nt b">friction</code>和<code class="fe ot ou ov nt b">roundToNearestSide</code>的控件。这与<code class="fe ot ou ov nt b">container.re</code>目前的工作方式非常相似。只是一个<code class="fe ot ou ov nt b">ReasonReact.reducerComponent</code>。</p><p id="83de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，在带有控件的示例中，<code class="fe ot ou ov nt b">container.re</code>变成了<code class="fe ot ou ov nt b">ReasonReact.reducerComponentWithRetainedProps</code>。</p><p id="3d9b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了比较当前和下一个道具，组件可以是:</p><ul class=""><li id="6f20" class="lr ls iq jp b jq jr ju jv jy lt kc lu kg lv kk pm lx ly lz bi translated">一个<code class="fe ot ou ov nt b">ReasonReact.statelessComponentWithRetainedProps</code></li><li id="8ba3" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk pm lx ly lz bi translated">答<code class="fe ot ou ov nt b">ReasonReact.reducerComponentWithRetainedProps</code></li></ul><p id="6f7b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看看<a class="ae ks" href="https://reasonml.github.io/reason-react/docs/en/lifecycles.html#access-next-or-previous-props-retainedprops" rel="noopener ugc nofollow" target="_blank">文档</a>和<a class="ae ks" href="https://github.com/persianturtle/reason-3d-carousel/blob/master/src/container.re#L55" rel="noopener ugc nofollow" target="_blank"> GitHub示例</a>。密切注意:</p><ul class=""><li id="cec2" class="lr ls iq jp b jq jr ju jv jy lt kc lu kg lv kk pm lx ly lz bi translated"><a class="ae ks" href="https://github.com/persianturtle/reason-3d-carousel/blob/master/src/container.re#L133" rel="noopener ugc nofollow" target="_blank">保留道具</a></li><li id="05e4" class="lr ls iq jp b jq ma ju mb jy mc kc md kg me kk pm lx ly lz bi translated"><a class="ae ks" href="https://github.com/persianturtle/reason-3d-carousel/blob/master/src/container.re#L134" rel="noopener ugc nofollow" target="_blank"> willReceiveProps </a></li></ul><p id="e0ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本的想法是，如果<code class="fe ot ou ov nt b">container.re's</code>的道具发生了变化，<code class="fe ot ou ov nt b">cancelAnimationFrame</code>会重新调用<code class="fe ot ou ov nt b">spinWithFriction</code>。</p><h1 id="c588" class="mp mq iq bd mr ms on mu mv mw oo my mz na op nc nd ne oq ng nh ni or nk nl nm bi translated">摘要</h1><p id="96c1" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">我希望我已经解释了足够多的<code class="fe ot ou ov nt b">ReasonReact</code>来帮助你开始你自己的应用程序。如果还有不清楚的地方，请加入<a class="ae ks" href="https://discord.gg/reasonml" rel="noopener ugc nofollow" target="_blank">不和谐频道</a>询问专家。</p><p id="9394" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我没有涉及任何用于计算carousel各种属性的数学，但是我把它包括进来是为了在实践中介绍Reason的语法。如果有人感兴趣，请在下面评论！</p><p id="12e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">也请让我知道我是否能更好地解释一个概念，或者你是否知道做某事的更好的方法。</p><p id="5f2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您的阅读。我希望你和我一样喜欢理性！</p></div></div>    
</body>
</html>