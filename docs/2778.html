<html>
<head>
<title>How to Build a Dynamic, Controlled Form with React Hooks (2019)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用React挂钩构建动态的受控表单(2019)</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-build-a-dynamic-controlled-form-with-react-hooks-2019-b39840f75c4f?source=collection_archive---------0-----------------------#2019-07-31">https://itnext.io/how-to-build-a-dynamic-controlled-form-with-react-hooks-2019-b39840f75c4f?source=collection_archive---------0-----------------------#2019-07-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8a44" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">React挂钩有助于简化一个棘手的概念</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/354d08820be5915f6e7382a97802c80d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6MTSetXmNVAELQlbJw1v0Q.png"/></div></div></figure><p id="8d69" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://reactjs.org" rel="noopener ugc nofollow" target="_blank"> React </a>的新<a class="ae lq" href="https://reactjs.org/docs/hooks-intro.html" rel="noopener ugc nofollow" target="_blank">钩子</a>使得构建UI比以往任何时候都更容易，但是有些东西像<strong class="kw iu"> <em class="lr">动态表单</em> </strong>仍然有点难以理解。动态表单是由<em class="lr">用户</em>决定有多少输入的表单。对于这段代码，我们将有猫主人的名字和简短描述的标准输入，然后动态添加他们的猫。每只新的猫都会有一个名字和年龄，只是为了好玩。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ls"><img src="../Images/e2aa2e9a2de432522fb130b363c71c81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iVumtE19l8-Nc0c2.jpeg"/></div></div></figure><p id="f3ed" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是我们今天设计的全部。因为我们使用了新的钩子，我们不会像以前那样使用任何类。我们所有的组件都将是函数，但仍然可以访问状态！如果你不知道新的钩子是什么，我建议你先查看一下<a class="ae lq" href="https://reactjs.org/docs/hooks-intro.html" rel="noopener ugc nofollow" target="_blank">解释</a>，然后再回来。这段代码是观察<code class="fe lt lu lv lw b">useState</code>运行的一个很好的方式，但是如果你至少对它有一点熟悉的话会有所帮助。</p><h1 id="a038" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">开始制定计划</h1><p id="27c5" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">规划和反应是至关重要的。如果你在开始编码之前<em class="lr">就想好自己想要什么，这会节省你很多时间。我们知道它将会是什么样子，但是它将如何被制造出来呢？我喜欢浏览一个小小的反应清单:</em></p><ol class=""><li id="8371" class="mu mv it kw b kx ky la lb ld mw lh mx ll my lp mz na nb nc bi translated">我需要什么组件？</li><li id="f605" class="mu mv it kw b kx nd la ne ld nf lh ng ll nh lp mz na nb nc bi translated">他们中的哪一个会有状态？</li><li id="eeed" class="mu mv it kw b kx nd la ne ld nf lh ng ll nh lp mz na nb nc bi translated">有用户触发的事件吗？</li></ol><p id="c166" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这种情况下，我觉得最好有一个主<code class="fe lt lu lv lw b">Form</code>组件，然后是一个呈现动态输入的<code class="fe lt lu lv lw b">CatInputs</code>组件。至于状态，我们的<code class="fe lt lu lv lw b">Form</code>组件将需要它，因为我们将控制每个输入。但是我们的<code class="fe lt lu lv lw b">CatInputs</code>组件不需要状态，因为我们可以将所有东西作为道具传入。</p><p id="5f53" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，有2个事件:我们需要处理对每个输入的更改，我们需要处理添加新输入的按钮。对于本教程，我们不会担心提交操作，因为它是不相关的。提交动态表单与提交常规表单是一样的。</p><h1 id="d5db" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">攻击顺序</h1><p id="5a95" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">总的来说，我喜欢首先呈现我需要的任何输入，然后开始处理交互性。在这种情况下，我们将呈现静态基础<code class="fe lt lu lv lw b">Form</code>，然后找出如何呈现新的输入，然后<em class="lr">最后</em>我们将处理控制它们。我将首先在<code class="fe lt lu lv lw b">Form</code>组件中构建一切，然后一旦一切正常，我将把适当的部分重构为一个<code class="fe lt lu lv lw b">CatInputs</code>组件。</p><h1 id="031f" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">入门:渲染出来</h1><p id="967e" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">让我们首先构建表单的非交互部分(<a class="ae lq" href="https://gist.github.com/MostlyFocusedMike/a20061d465adf6140e0ce78846fea98b" rel="noopener ugc nofollow" target="_blank">要点链接</a>):</p><pre class="kj kk kl km gt ni lw nj nk aw nl bi"><span id="ca61" class="nm ly it lw b gy nn no l np nq"><em class="lr">// /src/Form.js<br/></em>import <strong class="lw iu">React</strong> from <em class="lr">'react'</em>; <br/>const <strong class="lw iu">Form</strong> = () =&gt; {    <br/>  return (        <br/>    &lt;<strong class="lw iu">form</strong>&gt;            <br/>      &lt;<strong class="lw iu">label</strong> htmlFor=<em class="lr">"owner"</em>&gt;Owner&lt;/<strong class="lw iu">label</strong>&gt;   <br/>      &lt;<strong class="lw iu">input</strong> type=<em class="lr">"text"</em> name=<em class="lr">"owner"</em> id=<em class="lr">"owner"</em> /&gt; <br/>      &lt;<strong class="lw iu">label</strong> htmlFor=<em class="lr">"description"</em>&gt;Description&lt;/<strong class="lw iu">label</strong>&gt; <br/>      &lt;<strong class="lw iu">input</strong> type=<em class="lr">"text"</em> name=<em class="lr">"description"</em> id=<em class="lr">"description"</em> /&gt;<br/>      &lt;<strong class="lw iu">input</strong> type=<em class="lr">"button"</em> value=<em class="lr">"Add New Cat"</em> /&gt;            <br/>      &lt;<strong class="lw iu">input</strong> type=<em class="lr">"submit"</em> value=<em class="lr">"Submit"</em> /&gt;        <br/>    &lt;/<strong class="lw iu">form</strong>&gt;   <br/>  );<br/>}; </span><span id="c93f" class="nm ly it lw b gy nr no l np nq">export default <strong class="lw iu">Form</strong>;</span></pre><p id="dafd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是我们做的(<a class="ae lq" href="https://gist.github.com/MostlyFocusedMike/94235edc67548361572f4baccf0f31db" rel="noopener ugc nofollow" target="_blank">这是<em class="lr">漂亮的</em>造型</a>):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/f685eba5a70bffffcfad6222c4b9913b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sOZsqJfszeOj4kBiaqE8GQ.png"/></div></div></figure><h1 id="92bf" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">将数组用于动态输入</h1><p id="dddc" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">在我们编码之前，我们应该谈谈我们将如何做这件事。基本上，我们的状态中会有一个cat对象数组。每个对象都有一个<code class="fe lt lu lv lw b">name</code>和<code class="fe lt lu lv lw b">age</code>值。我们的<code class="fe lt lu lv lw b">Form</code>将遍历这个列表，并为<code class="fe lt lu lv lw b">name</code>和<code class="fe lt lu lv lw b">age</code>创建两个新的输入。当我们单击“添加新猫”按钮时，我们将向数组中添加一个新对象。因为这将改变我们的状态，它将触发重新渲染。然后，我们的表单将迭代这个<em class="lr">新的</em>猫列表，并添加另一对输入。</p><p id="7e67" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，让我们只考虑将第一个空白的cat对象放入我们的状态。现在，新的钩子来了！记住，我们使用<a class="ae lq" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment" rel="noopener ugc nofollow" target="_blank">数组析构</a>进行赋值，第一项是我们的状态本身，第二项是我们用来更新它的函数。我们把我们的初始状态作为<code class="fe lt lu lv lw b">useState</code>的参数。另外，你可以随便叫这些，我只是把“状态”放在最后，因为我喜欢它(<a class="ae lq" href="https://gist.github.com/MostlyFocusedMike/ad5b9a1a4203b8df631b7136e6651f23" rel="noopener ugc nofollow" target="_blank">要点链接</a>):</p><pre class="kj kk kl km gt ni lw nj nk aw nl bi"><span id="d8c5" class="nm ly it lw b gy nn no l np nq">import <strong class="lw iu">React</strong>, {<strong class="lw iu"> useState </strong>} from <em class="lr">'react'</em>; <br/>const <strong class="lw iu">Form</strong> = () =&gt; {  <br/>  const [<strong class="lw iu">catState</strong>, <strong class="lw iu">setCatState</strong>] = <strong class="lw iu">useState</strong>([<br/>    { name: '', age: '' },<br/>  ]);</span><span id="92ef" class="nm ly it lw b gy nr no l np nq">  return (        <br/>    &lt;<strong class="lw iu">form</strong>&gt;            <br/>      &lt;<strong class="lw iu">label</strong> htmlFor=<em class="lr">"owner"</em>&gt;Owner&lt;/<strong class="lw iu">label</strong>&gt;   <br/>      &lt;<strong class="lw iu">input</strong> type=<em class="lr">"text"</em> name=<em class="lr">"owner"</em> id=<em class="lr">"owner"</em> /&gt; <br/>      &lt;<strong class="lw iu">label</strong> htmlFor=<em class="lr">"description"</em>&gt;Description&lt;/<strong class="lw iu">label</strong>&gt; <br/>      &lt;<strong class="lw iu">input</strong> type=<em class="lr">"text"</em> name=<em class="lr">"description"</em> id=<em class="lr">"description"</em> /&gt;<br/>      &lt;<strong class="lw iu">input</strong> type=<em class="lr">"button"</em> value=<em class="lr">"Add New Cat"</em> /&gt;      <br/>      {<br/>        <strong class="lw iu">catState</strong>.map((<em class="lr">val</em>, <strong class="lw iu">idx</strong>) =&gt; {<br/>          const <strong class="lw iu">catId</strong> = `<em class="lr">name-${</em><strong class="lw iu">idx</strong><em class="lr">}</em>`;<br/>          const <strong class="lw iu">ageId</strong> = `<em class="lr">age-${</em><strong class="lw iu">idx</strong><em class="lr">}</em>`;<br/>          return (<br/>            &lt;<strong class="lw iu">div</strong> key={`<em class="lr">cat-${</em><strong class="lw iu">idx</strong><em class="lr">}</em>`}&gt;<br/>              &lt;<strong class="lw iu">label</strong> htmlFor={<strong class="lw iu">catId</strong>}&gt;{`<em class="lr">Cat #$</em>{<strong class="lw iu">idx</strong> + 1<em class="lr">}</em>`}&lt;/<strong class="lw iu">label</strong>&gt;<br/>              &lt;<strong class="lw iu">input</strong><br/>                type=<em class="lr">"text"</em><br/>                name={<strong class="lw iu">catId</strong>}<br/>                data-idx={<strong class="lw iu">idx</strong>}<br/>                id={<strong class="lw iu">catId</strong>}<br/>                className="<em class="lr">name</em>" <br/>              /&gt;<br/>              &lt;<strong class="lw iu">label</strong> htmlFor={<strong class="lw iu">ageId</strong>}&gt;Age&lt;/<strong class="lw iu">label</strong>&gt;<br/>              &lt;<strong class="lw iu">input</strong><br/>                type="<em class="lr">text</em>"<br/>                name={<strong class="lw iu">ageId</strong>}<br/>                data-idx={<strong class="lw iu">idx</strong>}<br/>                id={<strong class="lw iu">ageId</strong>}<br/>                className="<em class="lr">age</em>"<br/>              /&gt;<br/>            &lt;/<strong class="lw iu">div</strong>&gt;<br/>          );      <br/>        })<br/>      }<br/>      &lt;<strong class="lw iu">input</strong> type=<em class="lr">"submit"</em> value=<em class="lr">"Submit"</em> /&gt;        <br/>    &lt;/<strong class="lw iu">form</strong>&gt;   <br/>  );<br/>};</span><span id="047f" class="nm ly it lw b gy nr no l np nq">export default <strong class="lw iu">Form</strong>;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/73af011dc6186d3a77a8147d5b2ed048.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZteeBWHp-v7K3ZNV.png"/></div></div></figure><p id="b6b2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是一个新的大块，但如果你分解它，它并不复杂。我正在映射来自我的<code class="fe lt lu lv lw b">catState</code>的猫的数组，并使用映射的索引值为每对输入分配惟一的id、名称、键和标签。你应该始终包括标签，以确保您的网站是可访问的和屏幕阅读器友好的。这个属性对于以后控制我们的输入是至关重要的。它将把输入与数组中相应的cat对象的索引相匹配。</p><h1 id="09e3" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">添加输入</h1><p id="ab60" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">所以我们使用了一个数组，但它还不是动态的。由于我们的表单正在创建两个新的输入，我们知道迭代方面正在工作。但是为了让它真正动态，我们必须能够让用户添加输入。我们只需要给我们的组件一个方法，向我们的数组添加一个新的空白猫。我们只需要将它添加到我们的<code class="fe lt lu lv lw b">button</code>类型输入中。类型<code class="fe lt lu lv lw b">button</code>输入(不是按钮元素)不提交表单，所以我们不需要担心停止提交(<a class="ae lq" href="https://gist.github.com/MostlyFocusedMike/9cb2fff55930ae717f7bb0a392e039e4" rel="noopener ugc nofollow" target="_blank">要点链接</a>):</p><pre class="kj kk kl km gt ni lw nj nk aw nl bi"><span id="bf3f" class="nm ly it lw b gy nn no l np nq">import <strong class="lw iu">React</strong>, {<strong class="lw iu"> useState </strong>} from <em class="lr">'react'</em>; <br/>const <strong class="lw iu">Form</strong> = () =&gt; {  <br/>  const <strong class="lw iu">blankCat</strong> = { name: '', age: '' };<br/>  const [<strong class="lw iu">catState</strong>, <strong class="lw iu">setCatState</strong>] = <strong class="lw iu">useState</strong>([<br/>    {...<strong class="lw iu">blankCat</strong>}<br/>  ]);<br/>  <br/>  const <strong class="lw iu">addCat</strong> = () =&gt; {<br/>    <strong class="lw iu">setCatState</strong>([...<strong class="lw iu">catState</strong>, {...<strong class="lw iu">blankCat</strong>}]);<br/>  };</span><span id="f80d" class="nm ly it lw b gy nr no l np nq">  return (        <br/>    &lt;<strong class="lw iu">form</strong>&gt;            <br/>      &lt;<strong class="lw iu">label</strong> htmlFor=<em class="lr">"owner"</em>&gt;Owner&lt;/<strong class="lw iu">label</strong>&gt;   <br/>      &lt;<strong class="lw iu">input</strong> type=<em class="lr">"text"</em> name=<em class="lr">"owner"</em> id=<em class="lr">"owner"</em> /&gt; <br/>      &lt;<strong class="lw iu">label</strong> htmlFor=<em class="lr">"description"</em>&gt;Description&lt;/<strong class="lw iu">label</strong>&gt; <br/>      &lt;<strong class="lw iu">input</strong> type=<em class="lr">"text"</em> name=<em class="lr">"description"</em> id=<em class="lr">"description"</em> /&gt;<br/>      &lt;<strong class="lw iu">input</strong> <br/>         type=<em class="lr">"button"</em> <br/>         value=<em class="lr">"Add New Cat"</em> <br/>         onClick={addCat}<br/>      /&gt;      <br/>      {<br/>        <strong class="lw iu">catState</strong>.map((<em class="lr">val</em>, <strong class="lw iu">idx</strong>) =&gt; {</span><span id="ea51" class="nm ly it lw b gy nr no l np nq">// rest unchanged</span></pre><p id="6f68" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所有的<code class="fe lt lu lv lw b">addCat</code>所做的就是用前一个状态的<code class="fe lt lu lv lw b">cats</code>数组的<a class="ae lq" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax" rel="noopener ugc nofollow" target="_blank">展开</a>来设置状态，并在末尾标记一个新的<code class="fe lt lu lv lw b">blankCat</code>对象。注意，我将起始的cat对象重构为一个变量。我用它作为基础来<em class="lr">克隆</em>对象，如果你不知道这样复制对象为什么重要，<a class="ae lq" rel="noopener ugc nofollow" target="_blank" href="/javascript-interview-prep-primitive-vs-reference-types-62eef165bec8">这里有一个对象引用的解释</a>。另外，注意我们不需要像<code class="fe lt lu lv lw b">prevState</code>这样简单的东西。酷吧？挂钩是<code class="fe lt lu lv lw b">FUTURE</code>。现在，每当我们点击我们的<code class="fe lt lu lv lw b">addCat</code>按钮，它将添加一只猫到我们的状态，这将触发一个重新渲染，并显示我们新的，用户添加的输入！</p><h1 id="0478" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">控制静态输入</h1><p id="a0e3" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">现在我们已经完成了输入，让我们来控制它们。首先是简单的部分，非动态输入。我们将通过添加一个单独的所有者状态(<a class="ae lq" href="https://gist.github.com/MostlyFocusedMike/1449f1a7064e5add0e5c8245819190b1" rel="noopener ugc nofollow" target="_blank">要点链接</a>)来实现这一点:</p><pre class="kj kk kl km gt ni lw nj nk aw nl bi"><span id="2e68" class="nm ly it lw b gy nn no l np nq">const <strong class="lw iu">Form</strong> = () =&gt; {<br/>  const [<strong class="lw iu">ownerState</strong>, <strong class="lw iu">setOwnerState</strong>] = <strong class="lw iu">useState</strong>({<br/>    owner: '',<br/>    description: '',<br/>  });<br/>  const <strong class="lw iu">handleOwnerChange</strong> = (<strong class="lw iu">e</strong>) =&gt; <strong class="lw iu">setOwnerState</strong>({<br/>    ...<strong class="lw iu">ownerState</strong>,<br/>    [<strong class="lw iu">e</strong>.target.name]: [<strong class="lw iu">e</strong>.target.value],<br/>  });</span><span id="2585" class="nm ly it lw b gy nr no l np nq">  const <strong class="lw iu">blankCat</strong> = { name: '', age: '' };<br/>  const [<strong class="lw iu">catState</strong>, <strong class="lw iu">setCatState</strong>] = <strong class="lw iu">useState</strong>([<br/>    { ...<strong class="lw iu">blankCat },</strong><br/>  ]);<br/>  <br/>  const <strong class="lw iu">addCat</strong> = () =&gt; {<br/>    <strong class="lw iu">setCatState</strong>([...<strong class="lw iu">catState</strong>, { ...<strong class="lw iu">blankCat </strong>}]);<br/>  };</span><span id="60e6" class="nm ly it lw b gy nr no l np nq">  return (        <br/>    &lt;<strong class="lw iu">form</strong>&gt;            <br/>      &lt;<strong class="lw iu">label</strong> htmlFor=<em class="lr">"owner"</em>&gt;Owner&lt;/<strong class="lw iu">label</strong>&gt;   <br/>      &lt;<strong class="lw iu">input</strong> <br/>        type=<em class="lr">"text"</em> <br/>        name=<em class="lr">"owner"</em> <br/>        id=<em class="lr">"owner"</em> <br/>        value={<strong class="lw iu">ownerState</strong>.owner}<br/>        onChange={<strong class="lw iu">handleOwnerChange</strong>}<br/>      /&gt; <br/>      &lt;<strong class="lw iu">label</strong> htmlFor=<em class="lr">"description"</em>&gt;Description&lt;/<strong class="lw iu">label</strong>&gt; <br/>      &lt;<strong class="lw iu">input</strong> <br/>        type=<em class="lr">"text"</em> <br/>        name=<em class="lr">"description"</em> <br/>        id=<em class="lr">"description"</em> <br/>        value={<strong class="lw iu">ownerState</strong>.owner}<br/>        onChange={<strong class="lw iu">handleOwnerChange</strong>}     <br/>      /&gt;</span><span id="83c4" class="nm ly it lw b gy nr no l np nq">// rest unchanged</span></pre><p id="0cf9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过使用另一种状态，我们也使事情更具可读性。这是新状态挂钩的好处之一，它们有助于使事情变得更容易处理。为了获得用户输入的值，我们使用了传统的<code class="fe lt lu lv lw b">e.target.value</code>。但是我们使用的是<a class="ae lq" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Object_initializer" rel="noopener ugc nofollow" target="_blank">计算属性名</a>(属性周围的<code class="fe lt lu lv lw b">[]</code>)，这样我们就可以通过使用<code class="fe lt lu lv lw b">name</code>属性来动态匹配属性。分解一下，我们的<code class="fe lt lu lv lw b">owner</code>输入有一个名字<code class="fe lt lu lv lw b">'owner'</code>，这意味着我们的状态转换为<code class="fe lt lu lv lw b">owner: "whatever-was-typed"</code>。我们还扩展了当前的所有者状态。这是至关重要的，因为新的<code class="fe lt lu lv lw b">useState</code>钩子没有合并状态，它完全取代了它。如果我们不传播，我们将失去所有其他属性。</p><h1 id="0c7e" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">控制动态输入</h1><p id="b886" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">现在是精彩的部分；处理我们的动态输入:</p><pre class="kj kk kl km gt ni lw nj nk aw nl bi"><span id="2000" class="nm ly it lw b gy nn no l np nq">const <strong class="lw iu">handleCatChange</strong> = (e) =&gt; {<br/>  const <strong class="lw iu">updatedCats</strong> = [...catState];<br/>  <strong class="lw iu">updatedCats</strong>[<strong class="lw iu">e</strong>.target.dataset.idx][<strong class="lw iu">e</strong>.target.className] = <strong class="lw iu">e</strong>.target.value;<br/>  <strong class="lw iu">setCatState</strong>(<strong class="lw iu">updatedCats</strong>);<br/>};</span></pre><p id="6cca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们做的第一件事是克隆我们的<code class="fe lt lu lv lw b">catState</code>，这样我们就能保持渲染的纯净。接下来，我们使用<code class="fe lt lu lv lw b">idx</code>数据属性来定位特定cat输入集的索引。然后，为了找出是<code class="fe lt lu lv lw b">name</code>还是<code class="fe lt lu lv lw b">age</code>发生了变化，我们使用了<code class="fe lt lu lv lw b">className</code>属性。请注意，我们必须使用<code class="fe lt lu lv lw b">className</code>，而不仅仅是<code class="fe lt lu lv lw b">name</code>。这是因为会有不止一只猫，而且因为<code class="fe lt lu lv lw b">name</code>属性必须是唯一的，所以我们不能使用它。通过使用<code class="fe lt lu lv lw b">className</code>,我们可以将其设置为与我们的卡特彼勒资产名称相匹配，然后就结束了。</p><p id="8153" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所有这些为我们提供了确切的cat和property，因此我们可以使用<code class="fe lt lu lv lw b">e.target.value</code>来实际设置值，就像之前一样。最后，我们用更新后的猫数组调用<code class="fe lt lu lv lw b">setCatState</code>。</p><p id="3fbf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将<code class="fe lt lu lv lw b">value</code>和<code class="fe lt lu lv lw b">onChange</code>属性添加到我们的cat输入中有一个小问题。虽然<code class="fe lt lu lv lw b">onChange</code>功能是相同的，但是要确保每个<code class="fe lt lu lv lw b">value</code>都获得正确的属性，无论是<code class="fe lt lu lv lw b">.name</code>还是<code class="fe lt lu lv lw b">.age</code>:</p><pre class="kj kk kl km gt ni lw nj nk aw nl bi"><span id="ed4b" class="nm ly it lw b gy nn no l np nq">{<br/>  <strong class="lw iu">catState</strong>.map((<em class="lr">val</em>, <strong class="lw iu">idx</strong>) =&gt; {<br/>    const <strong class="lw iu">catId</strong> = `<em class="lr">name-${</em><strong class="lw iu">idx</strong><em class="lr">}</em>`;<br/>    const <strong class="lw iu">ageId</strong> = `<em class="lr">age-${</em><strong class="lw iu">idx</strong><em class="lr">}</em>`;<br/>    return (<br/>      &lt;<strong class="lw iu">div</strong> key={`<em class="lr">cat-${</em><strong class="lw iu">idx</strong><em class="lr">}</em>`}&gt;<br/>        &lt;<strong class="lw iu">label</strong> htmlFor={<strong class="lw iu">catId</strong>}&gt;{`<em class="lr">Cat #$</em>{<strong class="lw iu">idx</strong> + 1<em class="lr">}</em>`}&lt;/<strong class="lw iu">label</strong>&gt;<br/>        &lt;<strong class="lw iu">input</strong><br/>          type=<em class="lr">"text"</em><br/>          name={<strong class="lw iu">catId</strong>}<br/>          data-idx={<strong class="lw iu">idx</strong>}<br/>          id={<strong class="lw iu">catId</strong>}<br/>          className="<em class="lr">name</em>" <br/>          value={<strong class="lw iu">catState</strong>[<strong class="lw iu">idx</strong>].name}<br/>          onChange={<strong class="lw iu">handleCatChange</strong>}<br/>        /&gt;<br/>        &lt;<strong class="lw iu">label</strong> htmlFor={<strong class="lw iu">ageId</strong>}&gt;Age&lt;/<strong class="lw iu">label</strong>&gt;<br/>        &lt;<strong class="lw iu">input</strong><br/>          type="<em class="lr">text</em>"<br/>          name={<strong class="lw iu">ageId</strong>}<br/>          data-idx={<strong class="lw iu">idx</strong>}<br/>          id={<strong class="lw iu">ageId</strong>}<br/>          className="<em class="lr">age</em>"<br/>          value={<strong class="lw iu">catState</strong>[<strong class="lw iu">idx</strong>].age}<br/>          onChange={handleCatChange}<br/>        /&gt;<br/>      &lt;/<strong class="lw iu">div</strong>&gt;<br/>    );      <br/>  })<br/>}</span></pre><h1 id="ad2c" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">打开卡特彼勒输入</h1><p id="5755" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">您刚刚使用React钩子创建了一个动态的、受控的表单！呜！这是整个事情在<a class="ae lq" href="https://gist.github.com/MostlyFocusedMike/89df311d03e551456836c2d897477eaf" rel="noopener ugc nofollow" target="_blank">要点</a>上的完整记录。最后一步，为什么不试着把<code class="fe lt lu lv lw b">CatInputs</code>分解成一个独立的部分？正如我们前面讨论的，让我们把它变成一个没有状态的纯功能组件，它只呈现一对输入:</p><pre class="kj kk kl km gt ni lw nj nk aw nl bi"><span id="3fbe" class="nm ly it lw b gy nn no l np nq">import <strong class="lw iu">React</strong> from <em class="lr">'react'</em>;<br/>import <strong class="lw iu">PropTypes</strong> from '<em class="lr">prop-types</em>';</span><span id="abd8" class="nm ly it lw b gy nr no l np nq">const <strong class="lw iu">CatInputs</strong> = ({ <strong class="lw iu">idx</strong>, <strong class="lw iu">catState</strong>, <strong class="lw iu">handleCatChange</strong> }) =&gt; {<br/>  const <strong class="lw iu">catId</strong> = `<em class="lr">name-$</em>{<strong class="lw iu">idx</strong>}`;<br/>  const <strong class="lw iu">ageId</strong> = `<em class="lr">age-$</em>{<strong class="lw iu">idx</strong>}`;<br/>  return (<br/>      &lt;<strong class="lw iu">div</strong> key={`<em class="lr">cat-${</em><strong class="lw iu">idx</strong><em class="lr">}</em>`}&gt;<br/>        &lt;<strong class="lw iu">label</strong> htmlFor={<strong class="lw iu">catId</strong>}&gt;{`<em class="lr">Cat #$</em>{<strong class="lw iu">idx</strong> + 1<em class="lr">}</em>`}&lt;/<strong class="lw iu">label</strong>&gt;<br/>        &lt;<strong class="lw iu">input</strong><br/>          type=<em class="lr">"text"</em><br/>          name={<strong class="lw iu">catId</strong>}<br/>          data-idx={<strong class="lw iu">idx</strong>}<br/>          id={<strong class="lw iu">catId</strong>}<br/>          className="<em class="lr">name</em>" <br/>          value={<strong class="lw iu">catState</strong>[<strong class="lw iu">idx</strong>].name}<br/>          onChange={<strong class="lw iu">handleCatChange</strong>}<br/>        /&gt;<br/>        &lt;<strong class="lw iu">label</strong> htmlFor={<strong class="lw iu">ageId</strong>}&gt;Age&lt;/<strong class="lw iu">label</strong>&gt;<br/>        &lt;<strong class="lw iu">input</strong><br/>          type="<em class="lr">text</em>"<br/>          name={<strong class="lw iu">ageId</strong>}<br/>          data-idx={<strong class="lw iu">idx</strong>}<br/>          id={<strong class="lw iu">ageId</strong>}<br/>          className="<em class="lr">age</em>"<br/>          value={<strong class="lw iu">catState</strong>[<strong class="lw iu">idx</strong>].age}<br/>          onChange={handleCatChange}<br/>        /&gt;<br/>      &lt;/<strong class="lw iu">div</strong>&gt;<br/>    );<br/>};</span><span id="c90d" class="nm ly it lw b gy nr no l np nq"><strong class="lw iu">CatInputs.propTypes</strong> = {<br/>  idx: <strong class="lw iu">PropTypes</strong>.number,<br/>  catState: <strong class="lw iu">PropTypes</strong>.array,<br/>  handleCatChange: <strong class="lw iu">PropTypes</strong>.func,<br/>};</span><span id="aea2" class="nm ly it lw b gy nr no l np nq">export default <strong class="lw iu">CatInputs</strong>;</span></pre><p id="41c2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了看到所有的东西放在一起，检查最后的<a class="ae lq" href="https://gist.github.com/MostlyFocusedMike/e3b8e38ed6d525235f5205d4cc905a5a" rel="noopener ugc nofollow" target="_blank">要点</a>(不要忘记<a class="ae lq" href="https://reactjs.org/docs/typechecking-with-proptypes.html" rel="noopener ugc nofollow" target="_blank">使用道具类型</a>)。遵循这个基本模式作为你下一个项目的起点，一旦你理解了这个过程，试着找到一些可以简化的部分。</p><p id="e510" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">大家编码快乐，</p><p id="7e3d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">麦克风</p></div></div>    
</body>
</html>