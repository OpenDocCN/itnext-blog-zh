<html>
<head>
<title>Send SMS with Node.JS, TypeScript and Twilio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用节点发送短信。JS、TypeScript和Twilio</h1>
<blockquote>原文：<a href="https://itnext.io/send-sms-with-node-js-typescript-and-twilio-32d1e631d656?source=collection_archive---------1-----------------------#2018-04-20">https://itnext.io/send-sms-with-node-js-typescript-and-twilio-32d1e631d656?source=collection_archive---------1-----------------------#2018-04-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/1b5c9b1f541a1b5808b7d86b71b792c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:818/format:webp/1*1LPENVawecMRCQO2Ojn2tw.png"/></div></figure><p id="bbc6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我正在做一个项目，根据用户的行为向他们发送短信。该项目利用了<a class="ae ks" href="https://firebase.google.com/docs/functions/" rel="noopener ugc nofollow" target="_blank"> Firebase云函数</a>、<a class="ae ks" href="https://www.twilio.com/" rel="noopener ugc nofollow" target="_blank"> Twilio </a>和<a class="ae ks" href="https://github.com/Microsoft/TypeScript" rel="noopener ugc nofollow" target="_blank"> TypeScript </a>。</p><p id="d47b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以使用Node。JS与JavaScript来完成这个项目。用TypeScript做只是我个人的喜好。</p><p id="752e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我假设你的电脑上有节点和NPM。如果你没有，你应该去Node.js网站下载。</p><p id="3fff" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在我们开始之前，你应该有一个<a class="ae ks" href="https://www.twilio.com/sms" rel="noopener ugc nofollow" target="_blank"> Twilio </a>账户。之后，您登录到仪表板以检查帐户SID和身份验证令牌。</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi kt"><img src="../Images/051c85564fea57d9d759858b7e6c08e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*huOJt5ffO-HnHMX3DpYngA.png"/></div></figure><p id="632b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">第一步:入门</strong></p><p id="dc35" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您需要创建一个NPM项目并安装一些依赖项</p><pre class="ku kv kw kx gt ky kz la lb aw lc bi"><span id="c9ec" class="ld le iq kz b gy lf lg l lh li">npm init # you know what to do</span></pre><p id="5eac" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">安装特维利奥NPM软件包</p><pre class="ku kv kw kx gt ky kz la lb aw lc bi"><span id="6092" class="ld le iq kz b gy lf lg l lh li">// My current twilio version "^3.15.0"</span><span id="2108" class="ld le iq kz b gy lj lg l lh li">npm install twilio --save</span><span id="3b34" class="ld le iq kz b gy lj lg l lh li">// ts-node package for running typescript files<br/> npm g install ts-node</span></pre><p id="4b08" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">步骤2:设置</strong></p><p id="fba0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">创建您发送短信的逻辑</p><pre class="ku kv kw kx gt ky kz la lb aw lc bi"><span id="a58f" class="ld le iq kz b gy lf lg l lh li">// twilio.ts</span><span id="6a7c" class="ld le iq kz b gy lj lg l lh li">/**<br/> * Typescript<br/> * Twilio version: ^3.15.0<br/> */<br/> <br/>import * as Twilio from 'twilio';<br/><br/>// getting ready<br/>const twilioNumber = 'your-twilio-number';<br/>const accountSid = 'AC-something';<br/>const authToken = 'something-something';<br/><br/>const client = new Twilio(accountSid, authToken);<br/><br/>// start sending message<br/><br/>function sendText(){<br/>    const phoneNumbers = [ 'phone-number-1', 'phone-number-2']    <br/><br/>    phoneNumbers.map(phoneNumber =&gt; {<br/>        console.log(phoneNumber);<br/>        <br/>        if ( !validE164(phoneNumber) ) {<br/>            throw new Error('number must be E164 format!')<br/>        }<br/>    <br/>        const textContent = {<br/>            body: `You have a new sms from Dale Nguyen :)`,<br/>            to: phoneNumber,<br/>            from: twilioNumber<br/>        }<br/>    <br/>        client.messages.create(textContent)<br/>        .then((message) =&gt; console.log(message.to))<br/>    })<br/>}<br/><br/>// Validate E164 format<br/>function validE164(num) {<br/>    return /^\+?[1-9]\d{1,14}$/.test(num)<br/>}</span></pre><p id="2865" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这段代码中，我创建了一个向多个号码发送消息的函数。电话号码分组在名为<strong class="jw ir"> phoneNumbers </strong>的数组中。它还在发送之前检查电话号码E164格式。</p><p id="3326" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">配置完成后，您可以通过运行以下命令来测试发送sms功能:</p><pre class="ku kv kw kx gt ky kz la lb aw lc bi"><span id="ead2" class="ld le iq kz b gy lf lg l lh li">ts-node twilio.ts</span></pre><p id="763e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">* <em class="lk">将在云火基功能中使用该功能的人将获得奖励。您应该将凭证存储在函数配置环境中。</em></p><pre class="ku kv kw kx gt ky kz la lb aw lc bi"><span id="a37c" class="ld le iq kz b gy lf lg l lh li">firebase functions:config:set twilio.sid = 'abc'<br/>firebase functions:config:set twilio.token = 'xyz'</span></pre><p id="797c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在您的函数内部，您可以通过调用</p><pre class="ku kv kw kx gt ky kz la lb aw lc bi"><span id="de50" class="ld le iq kz b gy lf lg l lh li">const accountSid = functions.config().twilio.sid<br/>const authToken = functions.config().twilio.token</span></pre><p id="8f34" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">更多有趣的<a class="ae ks" href="https://github.com/dalenguyen/firebase-functions-snippets" rel="noopener ugc nofollow" target="_blank">云函数sippets </a>请查看我的github库。</p><p id="610f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae ks" href="https://github.com/dalenguyen/firebase-functions-snippets" rel="noopener ugc nofollow" target="_blank">https://github.com/dalenguyen/firebase-functions-snippets</a></p></div></div>    
</body>
</html>