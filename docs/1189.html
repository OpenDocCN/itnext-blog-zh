<html>
<head>
<title>Modular Game Worlds in Phaser 3 (Tilemaps #4) — Meet Matter.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Phaser 3中的模块化游戏世界(tile maps # 4)——见Matter.js</h1>
<blockquote>原文：<a href="https://itnext.io/modular-game-worlds-in-phaser-3-tilemaps-4-meet-matter-js-abf4dfa65ca1?source=collection_archive---------0-----------------------#2018-08-08">https://itnext.io/modular-game-worlds-in-phaser-3-tilemaps-4-meet-matter-js-abf4dfa65ca1?source=collection_archive---------0-----------------------#2018-08-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="019e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一系列关于在<a class="ae kl" href="http://phaser.io/" rel="noopener ugc nofollow" target="_blank"> Phaser 3 </a>游戏引擎中使用tilemaps创建模块化世界的博文中的第四篇。在这一版中，我们将了解Matter.js，以便我们可以建立一个具有“现实”物理的世界:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/872297c63975d2fc9ae69604793f42ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*TMWo_mBNrA9StXQYj_T7FQ.gif"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated"><em class="lc">空投</em><a class="ae kl" href="https://github.com/twitter/twemoji" rel="noopener ugc nofollow" target="_blank">T5】twe mojiT7】</a></figcaption></figure><p id="66bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将为下一篇文章做好准备，在下一篇文章中，我们将放弃表情符号，并添加一个在这个世界上跳跃的玩家。</p><p id="d365" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你还没有看过这个系列的前几篇文章，这里有一些链接:</p><ol class=""><li id="b113" class="ld le iq jp b jq jr ju jv jy lf kc lg kg lh kk li lj lk ll bi translated"><a class="ae kl" href="https://medium.com/@michaelwesthadley/modular-game-worlds-in-phaser-3-tilemaps-1-958fc7e6bbd6" rel="noopener">静态磁贴地图&amp;一个神奇宝贝风格的世界</a></li><li id="d159" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk li lj lk ll bi translated"><a class="ae kl" href="https://medium.com/@michaelwesthadley/modular-game-worlds-in-phaser-3-tilemaps-2-dynamic-platformer-3d68e73d494a" rel="noopener">动态磁贴地图&amp;益智y平台</a></li><li id="9f26" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk li lj lk ll bi translated"><a class="ae kl" href="https://medium.com/@michaelwesthadley/modular-game-worlds-in-phaser-3-tilemaps-3-procedural-dungeon-3bc19b841cd" rel="noopener">动态磁贴地图&amp;程序地下城</a></li></ol><p id="f161" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们开始之前，这篇文章的所有代码都在这个库中。这些教程使用截至21年8月13日的Phaser最新版本(v3.55.2)。</p><h1 id="e84a" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">目标受众</h1><p id="00fa" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">如果你对JavaScript(类、箭头函数和模块)、Phaser和<a class="ae kl" href="https://www.mapeditor.org/" rel="noopener ugc nofollow" target="_blank">平铺</a>地图编辑器有一些经验，这篇文章将会很有意义。如果你不知道，你可能想从<a class="ae kl" href="https://medium.com/@michaelwesthadley/modular-game-worlds-in-phaser-3-tilemaps-1-958fc7e6bbd6" rel="noopener">系列</a>的开头开始，或者继续阅读并把Google、Phaser教程和Phaser <a class="ae kl" href="https://labs.phaser.io/" rel="noopener ugc nofollow" target="_blank">示例</a> &amp; <a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/index.html" rel="noopener ugc nofollow" target="_blank">文档</a>放在手边。</p><p id="43db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，让我们开始吧！</p><h1 id="515d" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">概观</h1><p id="07c7" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">当我写这篇文章的时候，我意识到有太多的新概念要在一篇文章里完成，所以我把这篇文章分成两篇。这一个将介绍物质物理引擎本身，然后我们将带来相位器，tilemaps和贴图平铺体。在第二篇文章中，我们将深入物质的碰撞逻辑，并建立一个平台。</p><p id="efd9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">快速补充:整个教程系列都是以tilemap为中心的，所以我们当然要在这里使用tile map。也就是说，游戏/艺术/工具/等等。你想创建的东西可能不需要tilemap，比如这个用Matter制作的<a class="ae kl" href="https://codepen.io/lonekorean/pen/KXLrVX" rel="noopener ugc nofollow" target="_blank">弹球游戏</a>。不要因为我们在这里使用tilemaps就觉得受其约束！在此过程中，您将学习物质的基本知识，因此，即使您不使用tilemaps，您仍然会有所收获。</p><h1 id="7a35" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">物质引论</h1><p id="fa80" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">Matter 是另一个JavaScript 2D物理引擎。Phaser中的arcade physics (AP)旨在快速简单(主要是轴对齐的边界框和圆)，Matter是一个更现实的物理模拟引擎-复杂的身体形状、质量、密度、约束等。</p><p id="c566" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你有一个可以用盒子和圆圈的游戏，AP是完美的，但是如果你想做一些像在你的世界里创造物理谜题的事情(愤怒的小鸟，蜡笔物理，等等)。)，事在人为。例如，这是来自Matter网站的slingshot演示(单击并拖动左侧的蓝色形状):</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mu mv l"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">Matter.js的创建者liabru演示</figcaption></figure><p id="3bb9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你肯定想在Matter网站上玩玩其他的演示，感受一下Matter能做什么。你也会想把<a class="ae kl" href="http://brm.io/matter-js/docs/" rel="noopener ugc nofollow" target="_blank">物质文件</a>放在手边。</p><h1 id="04a0" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">物质的第一步</h1><p id="6b7f" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">Phaser的实现是围绕底层Matter库的一个薄薄的包装器，所以如果我们想在Phaser中使用Matter，我们应该从学习Matter本身开始。我们将创建一个简单的设置，您可以将任意形状放入世界中:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mw"><img src="../Images/b95de095237f99becf76ca6a92cf043c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*khg6hhFeOxqrdmB-oLqodw.gif"/></div></div></figure><p id="79ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Matter是围绕模块构建的，这些模块包含用于创建对象的工厂函数，以及可以操作这些对象的函数。例如，<code class="fe mx my mz na b">Body</code>模块是关于创建&amp;操纵<a class="ae kl" href="https://www.quora.com/What-is-a-rigid-body" rel="noopener ugc nofollow" target="_blank">刚体</a>的，所以它有<code class="fe mx my mz na b">Body.create(...)</code>工厂，它将为我们创建一个新的身体对象，还有<code class="fe mx my mz na b">Body.applyForce(...)</code>，它将对给定的身体对象施加一个力。因此，我们要采取的第一步是给几个模块起别名:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nb mv l"/></div></figure><p id="07b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们想要创建一个引擎和一个渲染器。Matter附带了一个简单的画布渲染器，所以在开始使用Phaser之前，我们将利用它:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nb mv l"/></div></figure><p id="51ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经有了物理模拟引擎和渲染器，我们可以向世界添加一些身体:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nb mv l"/></div></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mw"><img src="../Images/983fd75eab1995947df5fab260f2aabb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*jz_mJZvRvgg26N0NHqFOsg.gif"/></div></div></figure><p id="e4dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们来分析一下。<code class="fe mx my mz na b">Bodies.rectangle(400, 0, 120, 80, { restitution: 0.25, angle: Math.PI / 4 })</code>将创建一个新的、矩形的物理实体。它使用身体的中心作为原点来定位。最后一个参数是一个对象，您可以传入它来覆盖默认的<a class="ae kl" href="http://brm.io/matter-js/docs/classes/Body.html#properties" rel="noopener ugc nofollow" target="_blank"> body属性</a>。我们通过了数学考试。PI / 4弧度(45度)，这将覆盖默认的几何体旋转0弧度。我们在这里传递一个<code class="fe mx my mz na b">restitution</code>属性，它指定了物体的弹性。默认情况下它是0(无弹性)，所以我们覆盖它来创建一个稍微有弹性的矩形。其他有用的属性包括:<code class="fe mx my mz na b">friction</code>、<code class="fe mx my mz na b">frictionAir</code>、<code class="fe mx my mz na b">frictionStatic</code>和<code class="fe mx my mz na b">density</code>。</p><p id="9fa0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不能移动或旋转<code class="fe mx my mz na b">floor</code>几何体，因为我们已经使用<code class="fe mx my mz na b">isStatic</code>将其标记为静态几何体。所以我们的矩形会在地板不动的情况下反弹。</p><p id="7cb5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以引入一些新的身体类型(多边形和圆形)来填充我们的世界:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nb mv l"/></div></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mw"><img src="../Images/303b334f2e8212c6eed2920d1c88c1f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*E-nijh7jebMvp9sEfNghUg.gif"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">因为矩形具有最高的摩擦力和最低的恢复力，所以它是所有形状中最没有弹性和滑溜的。</figcaption></figure><p id="5d78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还可以创建复合实体，即由多个部分连接在一起的实体。这些部分将作为一个物体一起移动:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nb mv l"/></div></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mw"><img src="../Images/eb29f325d056cf251f70e08520a9d9a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*bxzNlhrnuqGwaoLfG3ssgA.gif"/></div></div></figure><p id="ba4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们要添加的最后一项功能是，您可以随时在画布上单击来拖放新的多边形:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nb mv l"/></div></figure><p id="0cce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">把所有这些放在一起:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nc mv l"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated"><em class="lc">查看</em><a class="ae kl" href="https://codesandbox.io/s/mq87yklq0p?hidenavigation=1&amp;module=%2Fjs%2Findex.js" rel="noopener ugc nofollow" target="_blank"><em class="lc">code sandbox</em></a><em class="lc">，</em> <a class="ae kl" href="https://www.mikewesthad.com/phaser-3-tilemap-blog-posts/post-4/01-matter" rel="noopener ugc nofollow" target="_blank"> <em class="lc"> live示例</em> </a> <em class="lc">或者源代码</em> <a class="ae kl" href="https://github.com/mikewesthad/phaser-3-tilemap-blog-posts/blob/master/examples/post-4/01-matter" rel="noopener ugc nofollow" target="_blank"> <em class="lc">这里</em> </a> <em class="lc">。</em></figcaption></figure><p id="f368" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">既然我们已经掌握了物质的基本原理，我们可以把注意力转向一起研究物质和相位器。如果你想更深入地探究物质本身，可以看看Monty Shokeen的教程系列<a class="ae kl" href="https://code.tutsplus.com/series/getting-started-with-matterjs--cms-1186" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="4865" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">物质和相位器</h1><p id="3d7e" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">我们将创建类似于上一个例子的东西，除了我们将使用tilemap来定义世界，并且我们将删除一些表情符号(因为为什么不可以):</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mw"><img src="../Images/9d1012bddbf861140585dd51ea498aaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*bhm6OCdBX1XoWnQ732OWIg.gif"/></div></div></figure><p id="0b42" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用与本系列最后一个教程相同的结构，我们将创建一个<code class="fe mx my mz na b">index.js</code>文件来创建我们的游戏并加载一个自定义场景:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nb mv l"/></div></figure><p id="a692" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们从创建<code class="fe mx my mz na b">MainScene</code>开始，它加载tilemap并启用物理:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nb mv l"/></div></figure><p id="9840" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们仔细观察，可以发现所有的新物体都是长方形的。在下一节中，我们将开始给瓷砖定制与它们的图形相匹配的主体。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nd"><img src="../Images/2e641378007216a1029add6e331a45c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_hsPeZ-L_0kx51XVpcPWOw.png"/></div></div></figure><p id="9d65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们可以使用<code class="fe mx my mz na b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Physics.Matter.Factory.html#image__anchor" rel="noopener ugc nofollow" target="_blank">this.matter.add.image</a></code>将几个有圆形身体的表情符号放到我们的场景中。像AP一样，我们可以使用<code class="fe mx my mz na b">this.matter.add</code> <a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Physics.Matter.Factory.html" rel="noopener ugc nofollow" target="_blank">工厂方法</a>创建物理图像和<a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Physics.Matter.Factory.html#sprite__anchor" rel="noopener ugc nofollow" target="_blank">精灵</a>。工厂也有创建自然物体和约束的方法(没有任何图形)，例如<code class="fe mx my mz na b">this.matter.add.rectangle</code>。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nb mv l"/></div></figure><p id="d430" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些图像变量现在是<code class="fe mx my mz na b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Physics.Matter.Image.html" rel="noopener ugc nofollow" target="_blank">Phaser.Physics.Matter.Image</a></code>的实例。它们具有普通Phaser图像的属性和方法，但是增加了用于操纵底层物体的方法和属性。有一个<code class="fe mx my mz na b">body</code>属性，可以让你访问原生物质体，还有<code class="fe mx my mz na b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Physics.Matter.Image.html#setCircle__anchor" rel="noopener ugc nofollow" target="_blank">setCircle</a></code>、<code class="fe mx my mz na b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Physics.Matter.Image.html#setRectangle__anchor" rel="noopener ugc nofollow" target="_blank">setRectangle</a></code>、<code class="fe mx my mz na b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Physics.Matter.Image.html#setBody__anchor" rel="noopener ugc nofollow" target="_blank">setBody</a></code>、<code class="fe mx my mz na b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Physics.Matter.Image.html#setExistingBody__anchor" rel="noopener ugc nofollow" target="_blank">setExistingBody</a></code>等方法。用于替换图像的当前正文。同样的想法也适用于<code class="fe mx my mz na b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Physics.Matter.Sprite.html" rel="noopener ugc nofollow" target="_blank">Phaser.Phyiscs.Matter.Sprite</a></code>。</p><p id="74e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就像上一节的例子一样，我们可以在每次按下鼠标左键时添加一些表情符号，方法是在我们的<code class="fe mx my mz na b">create</code>方法中添加以下内容:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nb mv l"/></div></figure><p id="2566" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总的来说:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nc mv l"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated"><em class="lc">查看</em><a class="ae kl" href="https://codesandbox.io/s/mq6rr2jn5p?hidenavigation=1&amp;module=%2Fjs%2Findex.js&amp;moduleview=1" rel="noopener ugc nofollow" target="_blank"><em class="lc">code sandbox</em></a><em class="lc"/><a class="ae kl" href="https://www.mikewesthad.com/phaser-3-tilemap-blog-posts/post-4/02-matter-and-phaser" rel="noopener ugc nofollow" target="_blank"><em class="lc">live示例</em> </a> <em class="lc">或者源代码</em> <a class="ae kl" href="https://github.com/mikewesthad/phaser-3-tilemap-blog-posts/blob/master/examples/post-4/02-matter-and-phaser" rel="noopener ugc nofollow" target="_blank"> <em class="lc">这里</em> </a> <em class="lc">。</em></figcaption></figure><h1 id="3c2a" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">映射碰撞形状</h1><p id="63bb" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">我们已经把瓷砖和物质结合在一起了，但是我们有一个问题。我们的身体都是矩形的，但我们的瓷砖不都是矩形的:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mw"><img src="../Images/cc23d8ff506d9c249cb146b86e300890.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*9GkvEr-xAVIgVMOkr24tVg.gif"/></div></div></figure><p id="811e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还没有真正利用物质不同的身体形状……还没有。在平铺模式下，我们可以使用内置的<a class="ae kl" href="http://docs.mapeditor.org/en/stable/manual/editing-tilesets/" rel="noopener ugc nofollow" target="_blank">碰撞编辑器</a>来绘制碰撞形状。当我们使用<code class="fe mx my mz na b">this.matter.world.convertTilemapLayer(...)</code>时，Phaser将自动解析出圆形、矩形、多边形和复合形状。</p><p id="8a3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要绘制平铺的形状，我们需要:</p><ol class=""><li id="0076" class="ld le iq jp b jq jr ju jv jy lf kc lg kg lh kk li lj lk ll bi translated">转到tileset属性窗口并打开碰撞编辑器。</li><li id="90bc" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk li lj lk ll bi translated">点击一个瓷砖，并绘制出它的身体。对所有需要自定义几何体的图块重复上述步骤。</li><li id="05c0" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk li lj lk ll bi translated">保存tileset并重新导出tilemap。</li></ol><p id="aa04" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Tiled的用户界面可能会有点混乱，所以下面是打开碰撞编辑器的方法:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ne"><img src="../Images/40a99afa7cc002a56c082eb7c9b34706.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Z2qKsJOR7ToWQYjXLd6bug.gif"/></div></div></figure><p id="a9f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦我们选择了一个瓷砖，我们将有这个窗口来映射出瓷砖上的冲突形状:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/71d3d6ccb5f556aeb668d3603d896157.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*vCARWcO6uJ8wK7XuOLwuag.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">工具栏中从左到右依次是:选择对象、编辑多边形点、创建矩形、创建椭圆、创建多边形和创建折线。除了折线之外，我们将使用它们。</figcaption></figure><p id="5dad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们来看一下绘制几个不同的瓷砖。目标是使用最少数量的形状/顶点，同时仍然获得体面的映射点击框。</p><p id="12ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，许多瓷砖仅用一个矩形就能很好地工作，就像这个瘦平台:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ng"><img src="../Images/621c8c24390a77e3ee93dd32706e803e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*GgFCvVMBepGtvrQo3svSFA.gif"/></div></div></figure><p id="fcc4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">(工作时，您可能会发现启用或禁用捕捉设置很有用:顶部工具栏中的“视图”-&gt;“捕捉”。在这些gif中，我启用了像素对齐。)</p><p id="ec78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有时候，你只需要一个圆圈:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ng"><img src="../Images/522093af3579e084c6760a378fbb383b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*3JrH70qSpdMyNMyZzB-CnQ.gif"/></div></div></figure><p id="ee05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有一个问题——Matter不支持椭圆，因此您在Tiled中创建的任何“椭圆”都将在Phaser中转换为圆形。</p><p id="8284" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由多个物体组成的复合物体——就像我们之前的十字架——非常方便，比如这个开关:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ng"><img src="../Images/62aad7514347b509c2dec7274c8b99cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*F2DTQ0Q2hvV8t2ER25UYvg.gif"/></div></div></figure><p id="57a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们也可以绘制出多边形，就像对这个倾斜的瓷砖使用三角形一样。(绘制完最后一个顶点后，按enter键完成形状。)</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ng"><img src="../Images/17f105a7d1ac29b437db41f65b964356.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Hg8nSnBgK9_L8Tq0oGhOuQ.gif"/></div></div></figure><p id="5967" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并非所有的多边形都是相同的。凸多边形通常比凹多边形更容易处理:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/bcc3ae1f2cdf225bdfd82a18d1386483.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*ho-fMU_mCjnT3he2RAy2iQ.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated"><em class="lc">玩这个</em> <a class="ae kl" href="https://www.mathopenref.com/polygonconvex.html" rel="noopener ugc nofollow" target="_blank"> <em class="lc">工具</em> </a> <em class="lc">看看我说的“内角”是什么意思</em></figcaption></figure><p id="9607" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">凸多边形将按预期工作。任何凹多边形体都会被物质分解成两个或两个以上凸多边形的复合体(使用<a class="ae kl" href="https://github.com/schteppe/poly-decomp.js" rel="noopener ugc nofollow" target="_blank"> poly-decomp.js </a>)。如果分解失败，身体将设置为<a class="ae kl" href="https://medium.com/@harshitsikchi/convex-hulls-explained-baab662c4e94" rel="noopener">凸包</a>。更多信息见<a class="ae kl" href="http://brm.io/matter-js/docs/classes/Bodies.html#method_fromVertices" rel="noopener ugc nofollow" target="_blank">事项文档</a>。我建议坚持使用凸多边形，但出于演示目的，我们也可以绘制一个凹多边形:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ng"><img src="../Images/59de5fba189d7fe226306b48da2c6371.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*mSmbXOsIA8lteK6OvsN5gQ.gif"/></div></div></figure><p id="1a86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">保存tileset，重新导出地图，我们将有:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/d64797bc39fce034e866874e50d348a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/1*VLJAknYYFDbA3bzaYwKKZg.gif"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">这与我们之前使用的地图不同，它只是一个小演示，展示我们刚刚绘制的图块。<em class="lc">注意，复合体(标志和熔岩)的调试渲染也渲染一个凸包。我们下次会详细讨论这一点。</em></figcaption></figure><p id="8792" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在codesandbox中，我绘制出了我们正在使用的其余图块，并导出了新地图。加载这些新主体不需要修改任何代码:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nc mv l"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated"><em class="lc">查看</em><a class="ae kl" href="https://codesandbox.io/s/rw3w7ln9qn?hidenavigation=1&amp;module=%2Fjs%2Findex.js&amp;moduleview=1" rel="noopener ugc nofollow" target="_blank"><em class="lc">code sandbox</em></a><em class="lc">，</em> <a class="ae kl" href="https://www.mikewesthad.com/phaser-3-tilemap-blog-posts/post-4/03-mapping-tiles" rel="noopener ugc nofollow" target="_blank"> <em class="lc"> live示例</em> </a> <em class="lc">或者源代码</em> <a class="ae kl" href="https://github.com/mikewesthad/phaser-3-tilemap-blog-posts/blob/master/examples/post-4/03-mapping-tiles" rel="noopener ugc nofollow" target="_blank"> <em class="lc">这里</em> </a> <em class="lc">。</em></figcaption></figure><p id="0784" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们需要更多地控制赋予图块的实体(或者如果我们没有使用Tiled)，我们可以使用<code class="fe mx my mz na b">layer.forEachTile</code>循环遍历图块，并使用<code class="fe mx my mz na b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Physics.Matter.Factory.html#tileBody__anchor" rel="noopener ugc nofollow" target="_blank">this.matter.add.tileBody</a></code>向每个图块添加自定义图块实体。</p><h1 id="bcff" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">下一个</h1><p id="4ddf" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">敬请关注。接下来，我们将利用这些物质的基础知识来建造一个平台:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nj"><img src="../Images/c477fe81bf4ba0d2c0b1e4616f9222ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*46vo7NRMjPARJCGoqHzAOw.gif"/></div></div></figure><p id="60e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您的阅读，如果您想在以后的帖子中看到什么，请告诉我！</p><h1 id="caf0" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">关于我</h1><p id="78b4" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">我是一名创意开发人员和教育家。我为Phaser 3编写了Tilemap API，并创建了大量有指导的示例，但我希望将所有这些信息收集成一种更有指导、更易理解的格式，以便人们可以更容易地进入Phaser 3。你可以看到更多我的作品，在这里联系<a class="ae kl" href="https://www.mikewesthad.com/" rel="noopener ugc nofollow" target="_blank"/>。</p></div></div>    
</body>
</html>