<html>
<head>
<title>How to Make ExoPlayer Lifecycle Aware in Jetpack Compose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Jetpack Compose中实现ExoPlayer生命周期感知</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-make-exoplayer-lifecycle-aware-in-jetpack-compose-6d4084b122e3?source=collection_archive---------0-----------------------#2022-10-06">https://itnext.io/how-to-make-exoplayer-lifecycle-aware-in-jetpack-compose-6d4084b122e3?source=collection_archive---------0-----------------------#2022-10-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/61b354bc44a45cb039d20064a9f4c761.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nUaKlJfS7aFrk392"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">托马斯·威廉在Unsplash的照片</figcaption></figure><p id="05ba" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我的上一篇文章<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/implementing-video-playback-on-android-jetpack-compose-f73b437560ea">在Android Jetpack Compose上实现视频播放</a>中，我解释了如何在Android上的Jetpack Compose中使用ExoPlayer播放视频。</p><div class="le lf gp gr lg lh"><a rel="noopener  ugc nofollow" target="_blank" href="/implementing-video-playback-on-android-jetpack-compose-f73b437560ea"><div class="li ab fo"><div class="lj ab lk cl cj ll"><h2 class="bd iu gy z fp lm fr fs ln fu fw is bi translated">在Android Jetpack Compose上实现视频播放</h2><div class="lo l"><h3 class="bd b gy z fp lm fr fs ln fu fw dk translated">编辑描述</h3></div><div class="lp l"><p class="bd b dl z fp lm fr fs ln fu fw dk translated">itnext.io</p></div></div><div class="lq l"><div class="lr l ls lt lu lq lv jz lh"/></div></div></a></div><p id="4eb2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一位读者观察到以下行为:当把示例应用程序放到背景中时，它仍在播放。他问了一个问题，如何让ExoPlayer知道生命周期，以便在应用程序暂停时视频停止。</p><p id="4ae6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们回顾一下上一篇文章中的代码，它是一个在<code class="fe lw lx ly lz b">AndroidView</code>中保存<code class="fe lw lx ly lz b">ExoPlayer</code>的<code class="fe lw lx ly lz b">@Composable</code>:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="d373" class="mi mj it lz b gy mk ml l mm mn">@Composable<br/>fun VideoView(videoUri: String) {<br/>    val context = LocalContext.current<br/><br/>    val exoPlayer = ExoPlayer.Builder(LocalContext.current)<br/>        .build()<br/>        .also { exoPlayer -&gt;<br/>            val mediaItem = MediaItem.Builder()<br/>                .setUri(videoUri)<br/>                .build()<br/>            exoPlayer.setMediaItem(mediaItem)<br/>            exoPlayer.prepare()<br/>        }<br/><br/>    DisposableEffect(<br/>        AndroidView(factory = {<br/>            StyledPlayerView(context).apply {<br/>                player = exoPlayer<br/>            }<br/>        })<br/>    ) {<br/>        onDispose { exoPlayer.release() }<br/>    }<br/>}</span></pre><p id="a31f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要的是<code class="fe lw lx ly lz b">LocalLifeCycleOwner</code>的当前实例，它“告诉”我们正在发生的生命周期事件。这是完整的解决方案。之后我会一步步解释细节。</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="d4dd" class="mi mj it lz b gy mk ml l mm mn">@Composable<br/>fun VideoView(videoUri: String) {<br/>    val context = LocalContext.current<br/><br/>    val exoPlayer = ExoPlayer.Builder(LocalContext.current)<br/>        .build()<br/>        .also { exoPlayer -&gt;<br/>            val mediaItem = MediaItem.Builder()<br/>                .setUri(videoUri)<br/>                .build()<br/>            exoPlayer.setMediaItem(mediaItem)<br/>            exoPlayer.prepare()<br/>        }<br/><br/>    val lifecycleOwner = rememberUpdatedState(LocalLifecycleOwner.current)<br/><br/>    DisposableEffect(<br/>        AndroidView(factory = {<br/>            StyledPlayerView(context).apply {<br/>                player = exoPlayer<br/>            }<br/>        })<br/>    ) {<br/>        val observer = LifecycleEventObserver { owner, event -&gt;<br/>            when (event) {<br/>                Lifecycle.Event.ON_PAUSE -&gt; {<br/>                    exoPlayer.pause()<br/>                }<br/>                Lifecycle.Event.ON_RESUME -&gt; {<br/>                    exoPlayer.play()<br/>                }<br/>            }<br/>        }<br/>        val lifecycle = lifecycleOwner.value.lifecycle<br/>        lifecycle.addObserver(observer)<br/><br/>        onDispose {<br/>            exoPlayer.release()<br/>            lifecycle.removeObserver(observer)<br/>        }<br/>    }<br/>}</span></pre><p id="88c0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我来给你解释一下。</p><p id="924a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先我们得到了<code class="fe lw lx ly lz b">LifecycleOwner</code>的当前实例</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="1b00" class="mi mj it lz b gy mk ml l mm mn">val lifecycleOwner = rememberUpdatedState(LocalLifecycleOwner.current)</span></pre><p id="d9e6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe lw lx ly lz b">DisposableEffect</code>的范围内，我们首先创建一个<code class="fe lw lx ly lz b">LifecycleEventObserver</code>。</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="4058" class="mi mj it lz b gy mk ml l mm mn">val observer = LifecycleEventObserver { owner, event -&gt;<br/>    when (event) {<br/>        Lifecycle.Event.ON_PAUSE -&gt; {<br/>            exoPlayer.pause()<br/>        }<br/>        Lifecycle.Event.ON_RESUME -&gt; {<br/>            exoPlayer.play()<br/>        }<br/>    }<br/>}</span></pre><p id="a317" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当应用暂停时，当它进入后台时，播放器也暂停。当应用程序恢复时，回到前台，播放器继续播放视频。</p><p id="f95a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们将这个观察者添加到生命周期实例中。</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="c114" class="mi mj it lz b gy mk ml l mm mn">val lifecycle = lifecycleOwner.value.lifecycle<br/>lifecycle.addObserver(observer)</span></pre><p id="54ea" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要再添加一行来进行适当的清理。当应用程序被关闭时，观察者需要从生命周期中移除</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="e39a" class="mi mj it lz b gy mk ml l mm mn">lifecycle.removeObserver(observer)</span></pre><p id="adf6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">差不多就是这样！希望这将有助于你的项目！</p><p id="4512" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢您的阅读！</p><ul class=""><li id="3c27" class="mo mp it ki b kj kk kn ko kr mq kv mr kz ms ld mt mu mv mw bi translated">如果你喜欢这个，请<a class="ae kf" href="https://twissmueller.medium.com/" rel="noopener">跟我上Medium </a></li><li id="0439" class="mo mp it ki b kj mx kn my kr mz kv na kz nb ld mt mu mv mw bi translated">给我买杯咖啡让我继续前进</li><li id="dc4a" class="mo mp it ki b kj mx kn my kr mz kv na kz nb ld mt mu mv mw bi translated">支持我和其他媒体作者<a class="ae kf" href="https://twissmueller.medium.com/membership" rel="noopener">在这里注册</a></li></ul><div class="le lf gp gr lg lh"><a href="https://twissmueller.medium.com/membership" rel="noopener follow" target="_blank"><div class="li ab fo"><div class="lj ab lk cl cj ll"><h2 class="bd iu gy z fp lm fr fs ln fu fw is bi translated">通过我的推荐链接加入媒体</h2><div class="lo l"><h3 class="bd b gy z fp lm fr fs ln fu fw dk translated">阅读托拜厄斯·维斯缪勒(Tobias Wissmueller)的每一个故事(以及媒体上成千上万的其他作家)。您的会员费直接…</h3></div><div class="lp l"><p class="bd b dl z fp lm fr fs ln fu fw dk translated">twissmueller.medium.com</p></div></div><div class="lq l"><div class="nc l ls lt lu lq lv jz lh"/></div></div></a></div><h2 id="688d" class="mi mj it bd nd ne nf dn ng nh ni dp nj kr nk nl nm kv nn no np kz nq nr ns nt bi translated">资源</h2><ul class=""><li id="51b3" class="mo mp it ki b kj nu kn nv kr nw kv nx kz ny ld mt mu mv mw bi translated"><a class="ae kf" href="https://stackoverflow.com/a/66807899/1065468" rel="noopener ugc nofollow" target="_blank"><strong class="ki iu">Jetpack compose——当应用程序返回前台时我如何刷新屏幕</strong> </a></li></ul></div></div>    
</body>
</html>