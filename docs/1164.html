<html>
<head>
<title>Return custom errors with status code on GraphQL with few lines of code.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用几行代码在GraphQL上返回带有状态代码的自定义错误。</h1>
<blockquote>原文：<a href="https://itnext.io/return-custom-errors-with-status-code-on-graphql-with-few-lines-of-code-f51ebfc4a6de?source=collection_archive---------2-----------------------#2018-08-02">https://itnext.io/return-custom-errors-with-status-code-on-graphql-with-few-lines-of-code-f51ebfc4a6de?source=collection_archive---------2-----------------------#2018-08-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/a9beed70463316b5bbe5bcb4b8ab43d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*9VyBulcxDuGbfz9FfcZMbg.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated"><a class="ae jy" href="https://github.com/EasyGraphQL" rel="noopener ugc nofollow" target="_blank">https://github.com/EasyGraphQL</a></figcaption></figure><p id="dc55" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">现在您可以用几行代码在GraphQL上用<code class="fe kx ky kz la b">statusCode</code>返回自定义错误。您可以默认返回HTTP错误，也可以创建自定义错误。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="d7f6" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">怎么做！</h1><ul class=""><li id="d1f4" class="mg mh iq kb b kc mi kg mj kk mk ko ml ks mm kw mn mo mp mq bi translated">导入库<code class="fe kx ky kz la b">const FormatError = require('easygraphql-format-error)</code></li><li id="c33f" class="mg mh iq kb b kc mr kg ms kk mt ko mu ks mv kw mn mo mp mq bi translated">初始化<code class="fe kx ky kz la b">const formatError = new FormatError()</code>你可以在数组内部传递自定义错误<code class="fe kx ky kz la b">const formatError = new FormatError([{name: INVALID_EMAIL, message: 'The email is not valid', statusCode: 400 }])</code></li><li id="16d6" class="mg mh iq kb b kc mr kg ms kk mt ko mu ks mv kw mn mo mp mq bi translated">将<code class="fe kx ky kz la b">errorName</code>传递给上下文<code class="fe kx ky kz la b">const errorName = formatError.errorName</code>上的解析器</li><li id="11c8" class="mg mh iq kb b kc mr kg ms kk mt ko mu ks mv kw mn mo mp mq bi translated">如果有错误<code class="fe kx ky kz la b">throw new Error(errorName.UNAUTHORIZED)</code></li></ul></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="9fe7" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">示例:</h1><h2 id="7f73" class="mw lj iq bd lk mx my dn lo mz na dp ls kk nb nc lw ko nd ne ma ks nf ng me nh bi translated">GraphQL模式:</h2><pre class="ni nj nk nl gt nm la nn no aw np bi"><span id="8c15" class="mw lj iq la b gy nq nr l ns nt">type Query {<br/>  userInformation(isLoggedIn: Boolean!): String!<br/>  findUserByEmail(email: String!): String!<br/>}</span></pre><h2 id="aefd" class="mw lj iq bd lk mx my dn lo mz na dp ls kk nb nc lw ko nd ne ma ks nf ng me nh bi translated">App.js</h2><pre class="ni nj nk nl gt nm la nn no aw np bi"><span id="ae5b" class="mw lj iq la b gy nq nr l ns nt">'use strict' </span><span id="30f2" class="mw lj iq la b gy nu nr l ns nt">const express = require('express')<br/>const { buildSchema } = require('graphql')<br/>const graphqlHTTP = require('express-graphql')<br/>const bodyParser = require('body-parser')<br/>const FormatError = require('<!-- -->easygraphql-format-error<!-- -->') <br/>const fs = require('fs')<br/>const path = require('path') </span><span id="e54a" class="mw lj iq la b gy nu nr l ns nt">const root = require('./schema/resolvers') </span><span id="2d0d" class="mw lj iq la b gy nu nr l ns nt">const app = express() </span><span id="5d51" class="mw lj iq la b gy nu nr l ns nt">app.set('port', process.env.PORT || 7000)<br/>app.use(bodyParser.json({limit: '10mb'}))<br/>app.use(bodyParser.urlencoded({ extended: true })) </span><span id="7584" class="mw lj iq la b gy nu nr l ns nt">const formatError = new FormatError([<br/>  {  <br/>    name: 'INVALID_EMAIL',  <br/>    message: 'The email is not valid',  <br/>    statusCode: 400<br/>  }<br/>])<br/>const errorName = formatError.errorName </span><span id="e432" class="mw lj iq la b gy nu nr l ns nt">const schemaCode = fs.readFileSync(path.join(__dirname, 'schema', 'schema.gql'), 'utf8')</span><span id="8053" class="mw lj iq la b gy nu nr l ns nt">const schema = buildSchema(schemaCode) </span><span id="0355" class="mw lj iq la b gy nu nr l ns nt">app.use('/', (req, res) =&gt; {  <br/>  graphqlHTTP({    <br/>    schema,    <br/>    rootValue: root,    <br/>    graphiql: true,    <br/>    context: { errorName },    <br/>    formatError: (err) =&gt; {      <br/>      return formatError.getError(err)    <br/>    }  <br/>  })(req, res)<br/>}) </span><span id="23d2" class="mw lj iq la b gy nu nr l ns nt">const server = app.listen(app.get('port'), () =&gt; {     <br/>  console.log(`Server running -&gt; PORT ${server.address().port}`)<br/>})</span><span id="418c" class="mw lj iq la b gy nu nr l ns nt">module.exports = app</span></pre><h2 id="d4eb" class="mw lj iq bd lk mx my dn lo mz na dp ls kk nb nc lw ko nd ne ma ks nf ng me nh bi translated">分解器</h2><pre class="ni nj nk nl gt nm la nn no aw np bi"><span id="5f82" class="mw lj iq la b gy nq nr l ns nt">'use strict'</span><span id="851f" class="mw lj iq la b gy nu nr l ns nt"><em class="nv">const</em> resolvers = {<br/>  userInformation: ({ isLoggedIn }, { errorName }) <em class="nv">=&gt;</em> {<br/>    <em class="nv">if</em> (!isLoggedIn) {<br/>      <em class="nv">throw</em> new Error(errorName.UNAUTHORIZED)<br/>    }<br/>  <br/>    <em class="nv">return</em> 'My username'<br/>  },<br/> <br/>  findUserByEmail: ({ email }, { errorName }) <em class="nv">=&gt;</em> {<br/>    <em class="nv">const</em> re = /\S+@\S+\.\S+/;</span><span id="6473" class="mw lj iq la b gy nu nr l ns nt"><em class="nv">    if</em> (!re.test(email)) {<br/>      <em class="nv">throw</em> new Error(errorName.INVALID_EMAIL)<br/>    }</span><span id="51fb" class="mw lj iq la b gy nu nr l ns nt"><em class="nv">    return</em> email<br/>  }<br/>}</span><span id="3264" class="mw lj iq la b gy nu nr l ns nt">module.exports = resolvers</span></pre><h2 id="217a" class="mw lj iq bd lk mx my dn lo mz na dp ls kk nb nc lw ko nd ne ma ks nf ng me nh bi translated">结果</h2><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi nw"><img src="../Images/fbb57c5b981399d03684004a9870b28a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vVpmJHSUKPz-SIno_0Z9Pg.png"/></div></div></figure><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi ob"><img src="../Images/db4fce1609959ef586be4c495bc299f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R16zcc1Acj3HWhI7nEyZQw.png"/></div></div></figure><p id="cb8d" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><strong class="kb ir">完整演示:</strong><a class="ae jy" href="https://github.com/EasyGraphQL/easygraphql-format-error/tree/master/example" rel="noopener ugc nofollow" target="_blank">https://github . com/EasyGraphQL/EasyGraphQL-format-error/tree/master/example</a></p><p id="27d6" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><strong class="kb ir"> Npm包:</strong><a class="ae jy" href="https://www.npmjs.com/package/easygraphql-format-error" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/easygraphql-format-error</a></p></div></div>    
</body>
</html>