<html>
<head>
<title>ngRx/Store and 5 silly mistakes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ngRx/Store和5个愚蠢的错误</h1>
<blockquote>原文：<a href="https://itnext.io/ngrx-store-and-5-silly-mistakes-780ae2f961d0?source=collection_archive---------2-----------------------#2020-03-03">https://itnext.io/ngrx-store-and-5-silly-mistakes-780ae2f961d0?source=collection_archive---------2-----------------------#2020-03-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="03cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">学习如何避免它们</em></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/895350abe11860a284de784202da6815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p-m8joe-7CQY9aXyoc2K3w.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">与其花时间在调试上，不如花时间和家人在一起:-)</figcaption></figure><p id="23c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">在这篇文章中，我将告诉你如何在使用ngRx来改善你的家庭与工作平衡时避免简单的陷阱:-) </em></p><h2 id="cdcb" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">介绍</h2><p id="4efa" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">如果你和Angular一起工作，你肯定知道Angular应用最流行的状态管理系统<a class="ae ma" href="https://ngrx.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> ngRx/Store </strong> </a>。</p><p id="8e70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们回忆一下什么是在同一页上:</p><blockquote class="mb mc md"><p id="fb1b" class="jn jo kl jp b jq jr js jt ju jv jw jx me jz ka kb mf kd ke kf mg kh ki kj kk ij bi translated"><strong class="jp ir"> @ngrx/store </strong></p><p id="561a" class="jn jo kl jp b jq jr js jt ju jv jw jx me jz ka kb mf kd ke kf mg kh ki kj kk ij bi translated">…是RxJS供电的状态管理，用于角度应用，灵感来自Redux。Store是一个受控状态容器，旨在帮助在Angular上编写高性能、一致的应用程序。</p></blockquote><p id="9161" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是官方文档中描述其工作原理的流程图:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mh"><img src="../Images/6dc868861a0e05205bf7ae478f483295.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*F1zvhLBSOjf9HVRa.png"/></div></div></figure><p id="5ae6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">组件发送<strong class="jp ir">动作</strong>，这是一个具有强制属性<em class="kl">类型</em>和可选的其他属性的对象，其数据将被存储到中心对象——存储。动作由<strong class="jp ir"><em class="kl">reducer</em></strong><em class="kl"/>处理，这是一个特殊的函数，它从动作中产生数据并把它们存储(或修改存储)。其他组件可以使用<strong class="jp ir">选择器</strong>订阅存储更新(到存储的特定部分)(实际上选择器决定了您想要监控存储更新的哪一部分)。在简单的情况下，选择器接收状态对象作为参数，并返回状态对象的一些属性:</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="9354" class="lc ld iq mj b gy mn mo l mp mq">(state) =&gt; state.prop1</span></pre><p id="55cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我开始占用你的时间之前，让我们回顾一下最简单的例子。为了不重复发明自行车，我将使用<a class="ae ma" href="https://ngrx.io/guide/store" rel="noopener ugc nofollow" target="_blank">官方文件</a>中的简化示例。</p><p id="efc4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将创建一个带有计数器值的存储，以及增加该计数器值的操作/缩减器。</p><p id="25ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们创建一个操作:</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="e961" class="lc ld iq mj b gy mn mo l mp mq">// src/app/counter.actions.ts</span><span id="eef0" class="lc ld iq mj b gy mr mo l mp mq"><a class="ae ma" href="https://ngrx.io/api/store-devtools/DevToolsFeatureOptions#import" rel="noopener ugc nofollow" target="_blank">import</a> { <a class="ae ma" href="https://ngrx.io/api/store/createAction" rel="noopener ugc nofollow" target="_blank">createAction</a> } from '@ngrx/store';</span><span id="af27" class="lc ld iq mj b gy mr mo l mp mq"><a class="ae ma" href="https://ngrx.io/api/store-devtools/DevToolsFeatureOptions#export" rel="noopener ugc nofollow" target="_blank">export</a> const increment = <a class="ae ma" href="https://ngrx.io/api/store/createAction" rel="noopener ugc nofollow" target="_blank">createAction</a>('[Counter Component] Increment');</span></pre><p id="650b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">减速器:</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="cdd5" class="lc ld iq mj b gy mn mo l mp mq">//src/app/counter.reducer.ts</span><span id="b25c" class="lc ld iq mj b gy mr mo l mp mq">import { createReducer, on } from '@ngrx/store';<br/>import { increment } from './counter.actions';</span><span id="8783" class="lc ld iq mj b gy mr mo l mp mq">export const initialState = 0;<br/>const _counterReducer = createReducer(initialState,<br/>   on(increment, state =&gt; state + 1)<br/>);</span><span id="f29b" class="lc ld iq mj b gy mr mo l mp mq">export function counterReducer(state, action) {<br/>   return _counterReducer(state, action);<br/>}</span></pre><p id="97f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将StoreModule模块添加到app.module.ts</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="37a2" class="lc ld iq mj b gy mn mo l mp mq">import { BrowserModule } from '@angular/platform-browser';<br/>import { NgModule } from '@angular/core';<br/>import { AppComponent } from './app.component';</span><span id="d93c" class="lc ld iq mj b gy mr mo l mp mq">import { StoreModule } from '@ngrx/store';</span><span id="3e96" class="lc ld iq mj b gy mr mo l mp mq">import { counterReducer } from './counter.reducer';</span><span id="43b8" class="lc ld iq mj b gy mr mo l mp mq">@NgModule({<br/>  declarations: [AppComponent],<br/>  imports: [<br/>    BrowserModule,<br/>    StoreModule.forRoot({ count: counterReducer })<br/>  ],<br/>  providers: [],<br/>  bootstrap: [AppComponent],<br/>})</span><span id="a88b" class="lc ld iq mj b gy mr mo l mp mq">export class AppModule {}</span></pre><p id="0fe4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以看到，我们在这一行中指定了我们的减速器</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="11bb" class="lc ld iq mj b gy mn mo l mp mq">StoreModule.forRoot({ count: counterReducer })</span></pre><p id="637c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要读取计数值我们只需要使用<a class="ae ma" href="https://ngrx.io/api/store/select" rel="noopener ugc nofollow" target="_blank"> <em class="kl">选择</em> </a>功能中的一个组件:</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="5e4c" class="lc ld iq mj b gy mn mo l mp mq">// in some component<br/>import { Store, select } from '@ngrx/store'<br/>...</span><span id="938a" class="lc ld iq mj b gy mr mo l mp mq">constructor(private store: Store&lt;{ count: number }&gt;) {</span><span id="031b" class="lc ld iq mj b gy mr mo l mp mq">this.count$ = store.pipe(<strong class="mj ir">select</strong>('count')); <br/>// now we have observable that will emit values on each count update</span><span id="e5c9" class="lc ld iq mj b gy mr mo l mp mq">// old school approach<br/>//this.count$ = store.pipe(<strong class="mj ir">select</strong>(state =&gt; state.count));</span><span id="55e1" class="lc ld iq mj b gy mr mo l mp mq">}</span></pre><p id="32f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们不想在主应用程序模块中继续计数怎么办？我们可以把它放到一个特征模块中。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="57c1" class="lc ld iq mj b gy mn mo l mp mq">@NgModule({<br/>  declarations: [AppComponent],<br/>  imports: [<br/>    BrowserModule,<br/>    StoreModule.forRoot({}),<br/>    StoreModule.forFeature('featureName', { count: counterReducer })<br/>  ],<br/>  providers: [],<br/>  bootstrap: [AppComponent],<br/>})</span><span id="0d0a" class="lc ld iq mj b gy mr mo l mp mq">export class AppModule {}</span></pre><p id="425a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们从商店状态的特征分支获取值的选择器将是:</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="4566" class="lc ld iq mj b gy mn mo l mp mq">// count.selectors.ts<br/>export const selectFeature = createFeatureSelector&lt;FeatureState&gt;('featureName');</span><span id="3cde" class="lc ld iq mj b gy mr mo l mp mq">export const countSelector = createSelector(selectFeature, (state) =&gt; state.count);<br/></span><span id="965d" class="lc ld iq mj b gy mr mo l mp mq">// And in some component<br/>this.count$ = store.pipe(<strong class="mj ir">select</strong>(countSelector));</span></pre><p id="47bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们来看看这一切是如何工作的:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ms"><img src="../Images/1e7aeba60b229bdf9b5848e74219a98f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*m_qx6oiKiKYvBCxghwtqJg.gif"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">一个组件增加state.count，另一个组件显示状态值。</figcaption></figure><p id="79b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们所有的动作和商店状态的变化都可以通过Chrome插件观察到:<a class="ae ma" href="https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd?hl=ru" rel="noopener ugc nofollow" target="_blank"> Redux DevTools </a> : <br/> 1。在Chome <br/> 2中安装一个插件。将<a class="ae ma" href="https://ngrx.io/api/store-devtools" rel="noopener ugc nofollow" target="_blank"> @ngrx/store-devtools </a>模块安装到您的Angular app:<br/>—<strong class="jp ir">ng add @ ngrx/store-devtools</strong><br/>—或<strong class="jp ir"><em class="kl">NPM I @ ngrx/store-devtools</em></strong>(在这种情况下，您应该手动将StoreDevtoolsModule添加到AppModule中)</p><p id="ad7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.在Chrome开发工具中监控你的商店(Redux标签)</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mt"><img src="../Images/b383baccb346178c1634c886c648ba6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*HF8QV6G3oodF_PUilE4OTw.gif"/></div></div></figure><p id="e464" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简单吧？</p><p id="91a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此时，您可能会问自己，为什么我们需要一篇仅仅代表官方文档示例的文章？因为即使有了这些简单的流程，如果有些东西不能像预期的那样工作，您也可能会花费数小时进行调试。</p><p id="800e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">我在我(和我的开发伙伴)的实践中揭露了5个常见的错误。</strong></p><h2 id="9bd8" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated"><strong class="ak"> #1。Redux-DevTools不显示动作中未定义的道具</strong></h2><p id="e426" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">假设我们有一个动作，它不仅发送唯一类型的消息，还发送一些附加信息:</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="4d65" class="lc ld iq mj b gy mn mo l mp mq">{<br/> type: SOME_TYPE,<br/> value: this.someProp<br/>}</span></pre><p id="babd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为此，让我们稍微修改一下代码:</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="6e3e" class="lc ld iq mj b gy mn mo l mp mq"><strong class="mj ir">// counter.actions.ts</strong><br/>...<br/>export const increment = createAction('[Counter Component] Increment', props&lt;{value: number}&gt;());</span><span id="b163" class="lc ld iq mj b gy mr mo l mp mq"><strong class="mj ir">// counter.reducer.ts</strong><br/>const counterReducerFunc = createReducer(initialState,<br/>  on(increment, (<em class="kl">state</em>, {<em class="kl">value</em>}) =&gt; <em class="kl">state </em>+ 1 + <em class="kl">value</em>)<br/>);</span><span id="9ea6" class="lc ld iq mj b gy mr mo l mp mq"><strong class="mj ir">//app.component.ts</strong><br/>public value;<br/>...</span><span id="a387" class="lc ld iq mj b gy mr mo l mp mq">increment() {<br/>// provide additional value to actionCreator function  this.store.dispatch(increment({value: this.value})); <br/>}</span></pre><p id="fd7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们的减速器应该将状态值增加1，并添加<em class="kl">值。</em></p><p id="ded3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，有些地方出错了，您想在Redux Dev工具中调试这些操作。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mu"><img src="../Images/bffbc47c37d8e236684a56c238666ceb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*IJ4-k05xAchgK_0dfYz3rg.gif"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">调试问题</figcaption></figure><p id="f318" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，<em class="kl">算</em>得了楠值，这是不正确的。还有为什么我们在ReduxDevTools的动作标签内容中看不到<em class="kl">值</em>道具？只有<em class="kl">类型的</em>字段存在。</p><p id="915f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">答案是<strong class="jp ir"> a) </strong>我们忘记给<em class="kl"> value </em>属性赋值了，Chrome插件不能得到未定义的值 ，因为它不能被字符串化。</p><p id="85ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们将<em class="kl">值</em>赋值为0 <strong class="jp ir"> <em class="kl">。</em>T41】</strong></p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="8382" class="lc ld iq mj b gy mn mo l mp mq"><strong class="mj ir">//app.component.ts</strong><br/>public value = 0; // or other number value</span></pre><p id="d275" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们可以在ReduxDevTools中观察这个道具:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mu"><img src="../Images/e039e53bc1e3804b31c1226bec429671.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*zuMWdDe3s6tMJRy-cS2grw.gif"/></div></div></figure><p id="0a20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我花一个小时来揭示它。也许看完这个你会少浪费点时间:)</p><p id="1a0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以看一下<a class="ae ma" href="https://github.com/kievsash/ngrx-store-and5sillyMistakes/tree/pitfall_1_ReduxDevTools_Doesnt_display_undefined" rel="noopener ugc nofollow" target="_blank">这个分支中的代码文章GitHub repo </a>。或者在ng-run.com游乐场检查一下。</p><p id="516e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">要点:</strong>如果您需要指定空值，最好使用<strong class="jp ir"> null </strong>，因为null可以被字符串化并显示在ReduxDevTools中。</p><h2 id="6b50" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated"><strong class="ak"> #2。StoreDevModule可能会降低应用程序的速度</strong></h2><p id="d5d6" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">很久以前，我在一家商店里有一大堆物品。一些用户操作修改了特定动作类型的数据，并将它们放回存储器，然后组件显示这些数据。</p><p id="ba68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的测试人员观察到，从列表中的几百个项目开始，每个用户操作都会导致微小但明显的UI更新延迟。这不是渲染，而是JS问题。</p><p id="f202" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在性能标签上用ChromeDevTools检查后(你可以在这里阅读更多信息)，我得到了这张图片:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/e0eeb8f358026c3bdeb218a2d744d459.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*fO3bfV3jShQmUiRHPxc8Cg.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">7.8%的Javascript活动被stringify函数捕获</figcaption></figure><p id="d795" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你记得为什么会这样吗？是的，因为我们将数据发送到ReduxDevTools插件，以便能够监控存储操作和状态。</p><p id="46f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于我们手动将StoreDevToolsModule添加到AppModule，因此我们错过了为产品构建关闭它的选项:</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="0cd6" class="lc ld iq mj b gy mn mo l mp mq">imports: [<br/>  StoreModule.forRoot({}),<br/>  StoreModule.forFeature(featureKey, {items: itemsReducer}),<br/>  BrowserModule,<br/>  // StoreDevtoolsModule.instrument({ maxAge: 25, <strong class="mj ir">logOnly: environment.production</strong> }), <strong class="mj ir">// missed logOnly option</strong><br/>  EffectsModule.forRoot([AppEffects])<br/>],</span></pre><p id="b9a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我添加它之后— UI开始感觉好多了:-)</p><p id="8513" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">要点:</strong>当您使用StoreDevtoolsModule监控您的ngrx/Store活动时，不要忘记<strong class="jp ir"> logOnly </strong>选项。实际上，如果你用<strong class="jp ir">ng add @ ngrx/store-dev tools</strong>安装，那么这个选项会自动添加。你可以在这里阅读更多关于<em class="kl">logon only</em>T10】的内容。</p><p id="5388" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可以玩GitHub回购分支中的代码<a class="ae ma" href="https://github.com/kievsash/ngrx-store-and5sillyMistakes/tree/pitfall_2_StoreDevtoolsModule_slow_down" rel="noopener ugc nofollow" target="_blank">。或者在</a><a class="ae ma" href="https://ng-run.com/" rel="noopener ugc nofollow" target="_blank">ng-run.com</a>Angular游乐场由<a class="mw mx ep" href="https://medium.com/u/d59a9e801370?source=post_page-----780ae2f961d0--------------------------------" rel="noopener" target="_blank"> Alexey Zuev </a>开始这个分支。为此，只需复制GitHub分支链接，并添加ng-run.com/github/&lt;your link&gt;，如下所示:</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="6f01" class="lc ld iq mj b gy mn mo l mp mq"><strong class="mj ir">Branch link:</strong> <br/>https://github.com/kievsash/ngrx-store-and5sillyMistakes/tree/pitfall_2_StoreDevtoolsModule_slow_down</span><span id="8cf4" class="lc ld iq mj b gy mr mo l mp mq">Now lets start it on ng-run.com</span><span id="06da" class="lc ld iq mj b gy mr mo l mp mq"><a class="ae ma" href="https://ng-run.com/github/kievsash/ngrx-store-and5sillyMistakes/tree/pitfall_2_StoreDevtoolsModule_slow_down" rel="noopener ugc nofollow" target="_blank">https://ng-run.com/github/<strong class="mj ir">kievsash/ngrx-store-and5sillyMistakes/tree/pitfall_2_StoreDevtoolsModule_slow_down</strong></a></span></pre></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><p id="562c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">喜欢这篇文章？<a class="ae ma" href="https://buymeacoffee.com/nqypxi6" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">给我买杯咖啡</strong> </a> :-)</p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><p id="f9f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> #3。您导入了功能模块，但它不工作</strong></p><p id="935d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> a) </strong>好了，你有了漂亮的特征角度模块，你把:</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="4404" class="lc ld iq mj b gy mn mo l mp mq">// feature.module.ts</span><span id="f99e" class="lc ld iq mj b gy mr mo l mp mq">...</span><span id="90b5" class="lc ld iq mj b gy mr mo l mp mq">imports: [<br/>   StoreModule.forFeature(featureKey, {items: itemsReducer}),<br/>...</span></pre><p id="dff6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您将它添加到app.module.ts AppModule imports时，您希望它应该可以工作。但是…它没有)你打开一个ChromeDevTools控制台，看到:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nf"><img src="../Images/0534bc86cd18e770dc1f7c62bceb3127.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HHzO9DIpC3hu77-mVP1zSw.png"/></div></div></figure><p id="365d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好，那么我们转到<a class="ae ma" href="https://github.com/ngrx/platform/search?q=ReducerManager&amp;unscoped_q=ReducerManager" rel="noopener ugc nofollow" target="_blank"> ngrx/platform GitHub repo </a>并搜索'<em class="kl"> ReducerManager </em>实体。并且看到它是由StoreModule.forRoot(…)在这里调用<a class="ae ma" href="https://github.com/ngrx/platform/blob/8.6.0/modules/store/src/store_module.ts#L164" rel="noopener ugc nofollow" target="_blank"/>作为REDUCER_MANAGER_PROVIDERS提供的。答案是显而易见的:我们忘记在out AppModule中包含StoreModule.forRoot({})。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="7ed2" class="lc ld iq mj b gy mn mo l mp mq">// app.module.ts<br/>imports: [<br/>  StoreModule.forRoot({}),<br/>  StoreModule.forFeature(featureKey, {items: itemsReducer}),</span></pre><p id="d137" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在它工作得很好。</p><p id="3ef8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="kl"> b) </em> </strong> <em class="kl">我发现了一个更有趣的行为，但是使用了StoreDevtoolsModule </em></p><p id="2732" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好的，那么您将它添加到AppModule:</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="b6c1" class="lc ld iq mj b gy mn mo l mp mq">imports: [<br/>  StoreDevtoolsModule.instrument({ maxAge: 25, logOnly: environment.production }),<br/>  StoreModule.forRoot({}),<br/>  StoreModule.forFeature(featureKey, {items: itemsReducer}),</span></pre><p id="36d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是当你在ChromeDevTools中打开Redux标签时，你会看到这个:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ng"><img src="../Images/fd6e5c6197d690628212f1b45005ce78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ska_gpHACxP_7o8O4c0VLA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">找不到商店。</figcaption></figure><p id="e4e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为什么？？</p><p id="9de8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我只是把StoreDevtoolsModule放在StoreModule.forRoot之前的<em class="kl"> imports </em>数组中，所以看起来Angular试图在创建任何存储之前实例化它。只需将StoreDevtoolsModule放在app module decorator<em class="kl">imports</em>数组中StoreModule.forRoot之后即可修复问题。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="b7e1" class="lc ld iq mj b gy mn mo l mp mq">imports: [<br/>  StoreModule.forFeature(featureKey, {items: itemsReducer}),<br/>  StoreModule.forRoot({}),<br/>  StoreDevtoolsModule.instrument({ maxAge: 25, logOnly: environment.production }),</span></pre><p id="0712" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在它运行良好:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nh"><img src="../Images/6f499615cae1573fb48b41a8b2770368.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ezAkljV6o4xcjknLBzOlw.png"/></div></div></figure><p id="f0fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有趣的是，在Angular 9中，将<em class="kl"> StoreModule.forFeature </em>放在StoreModule.forRoot之前不会产生任何<a class="ae ma" href="https://github.com/ngrx/platform/issues/400" rel="noopener ugc nofollow" target="_blank">问题</a>。</p><p id="92d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在这里找到和<a class="ae ma" href="https://github.com/kievsash/ngrx-store-and5sillyMistakes/tree/pitfall_3_StoreDevtoolsModule_before_StoreModule.forRoot" rel="noopener ugc nofollow" target="_blank">一起玩的代码</a>。</p><p id="d063" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> #4。导出的缩减器函数是必要的，因为AOT编译器不支持函数调用(在Angular 8中)。</strong></p><p id="8a2e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个陷阱的名称听起来不清楚，但实际上非常简单。你有减速器:</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="7ce4" class="lc ld iq mj b gy mn mo l mp mq">export const counterReducer = createReducer(initialState,<br/>  on(increment, <em class="kl">state </em>=&gt; <em class="kl">state </em>+ 1),<br/>  on(decrement, <em class="kl">state </em>=&gt; <em class="kl">state </em>- 1),<br/>  on(reset, <em class="kl">state </em>=&gt; 0),<br/>);</span><span id="bc94" class="lc ld iq mj b gy mr mo l mp mq">@NgModule({<br/>  declarations: [],<br/>  imports: [<br/>    StoreModule.forRoot({ count: counterReducer })<br/>  ],<br/>  providers: [],<br/>})<br/>export class CounterStateModule { }</span></pre><p id="9bb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它工作得非常好…直到我们尝试构建产品代码:</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="73c0" class="lc ld iq mj b gy mn mo l mp mq">ERROR in Error during template compile of 'CounterStateModule'<br/>  Function calls are not supported in decorators but 'createReducer' was called in 'counterReducer'<br/>    'counterReducer' calls 'createReducer' at app/counter.state.ts</span></pre><p id="edcd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个众所周知的问题，你可以在这里阅读更多关于它的内容。</p><p id="6753" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">幸运的是，当我用Ivy (ngRx/Store 8.6)在Angular 9项目上测试的时候——已经解决了！你可以在本期<a class="ae ma" href="https://github.com/ngrx/platform/issues/2241" rel="noopener ugc nofollow" target="_blank">中读到更多细节。</a></p><p id="94de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在这里查看代码<a class="ae ma" href="https://github.com/kievsash/ngrx-store-and5sillyMistakes/tree/pitfall4_no_need_to_export_function_for_reducer" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="7c1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">外卖:</strong>T33】更新到Angular 9 😎</p><p id="4d2b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> #5。Action creator是一个函数，但是如果你忘记放括号，ngRx会保持沉默。</strong></p><p id="6fb8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是一个可能的陷阱重现代码:</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="c264" class="lc ld iq mj b gy mn mo l mp mq">constructor(private store: Store&lt;{ count: number }&gt;) {<br/>}<br/><br/>selectAll() {<br/>  this.store.dispatch(select);//should be select() but no type error<br/>}<br/>unselectAll() {<br/>  this.store.dispatch(unselect()); // correct<br/>}</span></pre><p id="b75c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Typescript在这里帮不了你。但幸运的是，你会在ChromeDevTools控制台中找到提示:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ni"><img src="../Images/a59d30eeb81ac8675bba605ec83e0f1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M2RdZeTXQl0fbSOR5Xmv6g.png"/></div></div></figure><p id="7025" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要点:不要把所有的鸡蛋都放在打字筐里🎓有时候可能对你没什么帮助。</p><h2 id="d9fd" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">结论</h2><p id="2a05" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">好，那么我们从这篇文章中学到了什么？</p><ol class=""><li id="1f9e" class="nj nk iq jp b jq jr ju jv jy nl kc nm kg nn kk no np nq nr bi translated">使用<strong class="jp ir"> null </strong>而不是<strong class="jp ir"> undefined </strong>作为<em class="kl"> noValue </em>以便能够在ReduxDevTools Chrome插件中观察到。</li><li id="508c" class="nj nk iq jp b jq ns ju nt jy nu kc nv kg nw kk no np nq nr bi translated">StoreDevModule可能会降低应用程序的速度。为防止这种情况发生，将<em class="kl">仅登录</em>选项设置为<em class="kl">真。</em></li><li id="7dd4" class="nj nk iq jp b jq ns ju nt jy nu kc nv kg nw kk no np nq nr bi translated">当您连接其他ngrx/Store功能模块时，不要忘记将StoreModule.forRoot({})放在AppModule中。</li><li id="1d25" class="nj nk iq jp b jq ns ju nt jy nu kc nv kg nw kk no np nq nr bi translated">在Angular 9中不需要导出减速器功能。</li><li id="53e9" class="nj nk iq jp b jq ns ju nt jy nu kc nv kg nw kk no np nq nr bi translated">不要忘记在你的调用动作创建函数中使用圆括号。</li></ol><p id="aa44" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在你可以花更多的时间和家人在一起，而不是调试sessions⛷</p><p id="948b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们在<a class="ae ma" href="https://twitter.com/El_Extremal" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">推特</strong> </a>上保持联系吧！</p><blockquote class="nx"><p id="4c25" class="ny nz iq bd oa ob oc od oe of og kk dk translated">顺便说一句。我在Youtube上开始了一个视频教程系列“<a class="ae ma" href="https://www.youtube.com/watch?v=HI5f6naJdJ8&amp;list=PLNadw4d8-KMVSOffiYBuOlzvF38sO9pdu&amp;utm_content=educational&amp;utm_campaign=2019-11-13&amp;utm_source=email-sendgrid&amp;utm_term=8565702&amp;utm_medium=2586716" rel="noopener ugc nofollow" target="_blank"> <strong class="ak">有棱角可以浪费你的时间</strong> </a>”。在那里，我将发布关于用Angular和RxJS解决棘手问题的视频。<a class="ae ma" href="https://www.youtube.com/watch?v=HI5f6naJdJ8&amp;list=PLNadw4d8-KMVSOffiYBuOlzvF38sO9pdu&amp;utm_content=educational&amp;utm_campaign=2019-11-13&amp;utm_source=email-sendgrid&amp;utm_term=8565702&amp;utm_medium=2586716" rel="noopener ugc nofollow" target="_blank"> <strong class="ak">看一看！</strong> </a></p></blockquote><figure class="oi oj ok ol om kr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/7e4179075ae6d7346e2e909726bef05b.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/0*LVFcHyxCkdrmIg-T"/></div></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi on"><img src="../Images/a127efd75f27954377d204aa15545c43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/0*_mYOWVBC882P8ClS.png"/></div></figure><p id="5f8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">干杯！</p></div></div>    
</body>
</html>