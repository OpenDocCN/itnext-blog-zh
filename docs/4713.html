<html>
<head>
<title>Swift Local Notification All-In-One</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift本地通知一体化</h1>
<blockquote>原文：<a href="https://itnext.io/swift-local-notification-all-in-one-ee6027ea6e3?source=collection_archive---------0-----------------------#2020-08-30">https://itnext.io/swift-local-notification-all-in-one-ee6027ea6e3?source=collection_archive---------0-----------------------#2020-08-30</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><figure class="gm go js jt ju jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj jr"><img src="../Images/3835fdf056308626957e116d5bfb1027.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sxpUtS3ZiZebxL1qumPt5g.png"/></div></div></figure><p id="0624" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi la translated">通知是一个非常优雅的工具，用来通知用户新的信息和警告。iOS通知有两种类型—本地通知和远程通知。由于日历事件、秒表或位置更新，本地通知由应用程序独立触发。另一方面，远程通知由服务器触发并从APNs传递。</p><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div class="gi gj lj"><img src="../Images/1d2c636e3dd331df03df68c247110683.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/0*eKdPw8oQt09U2dlq.gif"/></div><figcaption class="lo lp gk gi gj lq lr bd b be z dk translated">iOS中通知的图示</figcaption></figure><p id="e7a7" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">除了触发器之外，本地通知与远程通知有许多共同的属性。在设置和处理用户交互方面有一些有趣的部分和技巧。在本文中，它包括以下几个部分:</p><ol class=""><li id="9d8a" class="ls lt iu ke b kf kg kj kk kn lu kr lv kv lw kz lx ly lz ma bi translated">背景信息—通知样式</li><li id="65e1" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated">基本代码和总体流程图</li><li id="fdc3" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated">未通知操作和未通知类别的声明</li><li id="fb03" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated">请求通知授权</li><li id="df79" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated">通知内容的设置</li><li id="dc21" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated">通知触发器的设置</li><li id="50d7" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated">在应用程序前台显示通知</li><li id="c9ac" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated">处理用户对取消通知操作的选择</li><li id="bbf4" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated">删除待定或已发送的通知</li></ol><p id="6fdc" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">希望这篇文章对理解本地通知的细节有所帮助。我们开始吧！</p></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="db0b" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">背景信息—通知样式</h1><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj nl"><img src="../Images/f350ab8bf471c7493ca6b511b6f30cc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cD4km0A-SVsuzs7R6LgkCA.png"/></div></div></figure><p id="d5c0" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">iOS中总共有3种通知方式。它们是:</p><ol class=""><li id="bd41" class="ls lt iu ke b kf kg kj kk kn lu kr lv kv lw kz lx ly lz ma bi translated"><strong class="ke iv">锁屏</strong> —用户解锁设备前隐藏正文消息</li><li id="bc31" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated"><strong class="ke iv">通知中心</strong> —解锁设备后，用户可以在通知中心管理通知</li><li id="ae41" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated"><strong class="ke iv">横幅-解锁</strong> —屏幕上方弹出新通知。</li></ol><p id="6ee6" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">用户可以在系统设置中切换不同类型的通知:</p><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj nm"><img src="../Images/c8c8b66c5d7deb2745e99b236ec5b3de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8UvLwBrro3EqhumnIlQKpA.png"/></div></div></figure></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="76b1" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">基本代码和总体流程图</h1><p id="5a90" class="pw-post-body-paragraph kc kd iu ke b kf nn kh ki kj no kl km kn np kp kq kr nq kt ku kv nr kx ky kz in bi translated">这篇文章比较长，可以归纳为这两组代码。<code class="fe ns nt nu nv b">AppDelegate.swift</code>是app的入口点，也是设置<code class="fe ns nt nu nv b">UNUserNotificationDelegate</code>和<code class="fe ns nt nu nv b">UNNotificationCategory</code>属性的地方。<code class="fe ns nt nu nv b">NotificationViewController.swift</code>用于设置通知内容及其触发。</p><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ny"><img src="../Images/ce350c5e294ec6fe38b6e533d6777de7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gOHhVwJ1TS-geb5weS8vHg.png"/></div></div><figcaption class="lo lp gk gi gj lq lr bd b be z dk translated">总体流程图</figcaption></figure></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="62d3" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">未通知操作&amp;未通知类别</h1><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div class="gi gj nz"><img src="../Images/d2bd9cb233fcbbd868acdfbea8557b1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/0*R68QVJcNjc2h3SSg.gif"/></div></figure><p id="049d" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">根据官方文件，所有通知中心的设置应该在应用程序已经启动之前完成，即在<code class="fe ns nt nu nv b">application:didFinishLaunchingWithOptions:</code>。</p><p id="4062" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">iOS提供了两种类型的notification action—<strong class="ke iv">un notification action</strong>和<strong class="ke iv">UNTextInputNotificationAction</strong>。UNNotificationAction只是一个带有简单点击动作的按钮，见左边gift的前3个按钮。UNTextInputNotificationAction是一个按钮，它可以显示一个带有submit按钮的UITextField，供用户输入消息，请参见左边gif中的最后一个按钮。</p><h2 id="aa64" class="oa mo iu bd mp ob oc dn mt od oe dp mx kn of og nb kr oh oi nf kv oj ok nj ol bi translated">3种不通知行为</h2><ol class=""><li id="fba3" class="ls lt iu ke b kf nn kj no kn om kr on kv oo kz lx ly lz ma bi translated"><a class="ae op" href="https://developer.apple.com/documentation/usernotifications/unnotificationactionoptions/1648196-authenticationrequired" rel="noopener ugc nofollow" target="_blank">需要认证</a></li></ol><p id="fe11" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">当敏感或加密信息用于执行此操作时，将使用此选项。只有在设备解锁后，才能通知应用程序用户的选择。</p><p id="f942" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">2.<a class="ae op" href="https://developer.apple.com/documentation/usernotifications/unnotificationactionoptions/1648199-destructive" rel="noopener ugc nofollow" target="_blank">破坏性</a></p><p id="8de6" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这种类型的标题在亮暗模式下都显示为红色。红色代表警报。通常会触发不可撤销的动作。</p><p id="3eb1" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">3.<a class="ae op" href="https://developer.apple.com/documentation/usernotifications/unnotificationactionoptions/1648192-foreground" rel="noopener ugc nofollow" target="_blank">前景</a></p><p id="9d34" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这种类型的操作按钮将用户带回应用程序。</p><h2 id="b522" class="oa mo iu bd mp ob oc dn mt od oe dp mx kn of og nb kr oh oi nf kv oj ok nj ol bi translated">处理未通知操作的操作</h2><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><p id="c50d" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">开发人员必须实现<a class="ae op" href="https://developer.apple.com/documentation/usernotifications/unusernotificationcenterdelegate/1649501-usernotificationcenter" rel="noopener ugc nofollow" target="_blank">userNotificationCenter(_:did receive:with completionhandler:)</a>来处理用户对通知的操作。用户可以执行4种可能的操作:</p><ol class=""><li id="a868" class="ls lt iu ke b kf kg kj kk kn lu kr lv kv lw kz lx ly lz ma bi translated">驳回通知</li><li id="fffb" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated">只需点击通知即可打开通知</li><li id="44f4" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated">点击一个简单的<code class="fe ns nt nu nv b">UNNotificationAction</code></li><li id="71ac" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated">通过输入一个字符串触发一个<code class="fe ns nt nu nv b">UNTextFieldNotificationAction</code></li></ol><p id="4959" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">通过在应用程序开始时定义的标识符，可以区分不同类型的无通知操作。一旦它处理完动作，就必须调用<code class="fe ns nt nu nv b">completionHandler</code>。</p><p id="98f1" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">为了检测用户取消通知，即第11行的<code class="fe ns nt nu nv b">UNNotificationDismissActionIdentifier</code>，必须将<code class="fe ns nt nu nv b">customDismissAction</code>设置为<code class="fe ns nt nu nv b">UNNotificationCategory</code>的<code class="fe ns nt nu nv b">options</code>。</p><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="9ab4" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">请求通知权限</h1><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div class="gi gj nz"><img src="../Images/52547cea020f6c39492a6280dd67e8bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*XJgMYoE6wFkkeAvwCaTDEg.png"/></div></figure><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><p id="6e7c" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">应用程序可以通过不同的选项请求显示通知的权限，包括以下常见选项:</p><ol class=""><li id="9393" class="ls lt iu ke b kf kg kj kk kn lu kr lv kv lw kz lx ly lz ma bi translated"><a class="ae op" href="https://developer.apple.com/documentation/usernotifications/unauthorizationoptions/1649499-alert" rel="noopener ugc nofollow" target="_blank">提醒</a> —使应用程序能够在屏幕顶部弹出通知，并在通知中心显示，请参见上一节“通知样式”了解更多信息。</li><li id="49da" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated"><a class="ae op" href="https://developer.apple.com/documentation/usernotifications/unauthorizationoptions/1649505-sound" rel="noopener ugc nofollow" target="_blank">声音</a> —可以是默认或自定义声音，不超过30秒。</li></ol><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="oq nx l"/></div></figure><p id="4094" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">3.<a class="ae op" href="https://developer.apple.com/documentation/usernotifications/unauthorizationoptions/1649526-badge" rel="noopener ugc nofollow" target="_blank">徽章</a></p><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div class="gi gj or"><img src="../Images/c96699928e10574f9fad0e560f9aa82b.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*otIWPf58lNddzVepEYSzYw.png"/></div></figure><h2 id="c14e" class="oa mo iu bd mp ob oc dn mt od oe dp mx kn of og nb kr oh oi nf kv oj ok nj ol bi translated">其他不常见的选项有:</h2><ol class=""><li id="5396" class="ls lt iu ke b kf nn kj no kn om kr on kv oo kz lx ly lz ma bi translated"><a class="ae op" href="https://developer.apple.com/documentation/usernotifications/unauthorizationoptions/2963120-criticalalert" rel="noopener ugc nofollow" target="_blank">紧急警报</a></li></ol><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div class="gi gj or"><img src="../Images/4fa8d03b04a2000db8ccd623c741b529.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*QknNm3YbWhFcRZ0E37b2QQ.png"/></div><figcaption class="lo lp gk gi gj lq lr bd b be z dk translated">关键警报可以绕过“请勿打扰”功能</figcaption></figure><p id="8190" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">需要苹果公司颁发的<a class="ae op" href="https://developer.apple.com/contact/request/notifications-critical-alerts-entitlement/" rel="noopener ugc nofollow" target="_blank">特别授权</a>，以便在设备<strong class="ke iv">静音</strong>或<strong class="ke iv">启用“请勿打扰”模式</strong>时显示声音提示！申请权利可以持续大约两个月。</p><p id="0e4e" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">2.<a class="ae op" href="https://developer.apple.com/documentation/usernotifications/unauthorizationoptions/2990405-providesappnotificationsettings" rel="noopener ugc nofollow" target="_blank">提供通知设置</a></p><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div class="gi gj os"><img src="../Images/79c808b11d4ba76cb85fcba0ef6201f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*5eidD4sDx_ultyx7KVslDg.png"/></div></figure><p id="0f9b" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在应用内通知设置页面添加一个按钮，用于将用户重定向到应用页面。开发人员必须处理回调，并向用户显示相关信息。回调是<a class="ae op" href="https://developer.apple.com/documentation/usernotifications/unusernotificationcenterdelegate" rel="noopener ugc nofollow" target="_blank">unusernotificationcenteredelegate</a>的<a class="ae op" href="https://developer.apple.com/documentation/usernotifications/unusernotificationcenterdelegate/2981869-usernotificationcenter" rel="noopener ugc nofollow" target="_blank">userNotificationCenter(_:openSettingsFor:)</a></p><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><p id="0390" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">3.<a class="ae op" href="https://developer.apple.com/documentation/usernotifications/unauthorizationoptions/1649525-carplay" rel="noopener ugc nofollow" target="_blank"> carPlay </a></p><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ot"><img src="../Images/2dc50a07d32ea412102eb0278604408c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DXyIJ4Uu5aj46x2JP5I29Q.png"/></div></div></figure><p id="f8fe" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">4.<a class="ae op" href="https://developer.apple.com/documentation/usernotifications/unauthorizationoptions/2993019-provisional" rel="noopener ugc nofollow" target="_blank">临时</a> <br/>向通知中心临时发布不中断通知的能力。</p><p id="4b0c" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">5.<a class="ae op" href="https://developer.apple.com/documentation/usernotifications/unauthorizationoptions/3240649-announcement" rel="noopener ugc nofollow" target="_blank">公告</a><br/>Siri通过AirPods自动读出消息的能力。</p></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="792a" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">未通知内容</h1><h2 id="3b41" class="oa mo iu bd mp ob oc dn mt od oe dp mx kn of og nb kr oh oi nf kv oj ok nj ol bi translated">1.标记</h2><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><p id="4f5e" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">Badge通常用来表示一个app的未读通知数量。例如，WhatsApp中未读消息的数量。</p><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div class="gi gj or"><img src="../Images/c96699928e10574f9fad0e560f9aa82b.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*otIWPf58lNddzVepEYSzYw.png"/></div></figure><h2 id="d612" class="oa mo iu bd mp ob oc dn mt od oe dp mx kn of og nb kr oh oi nf kv oj ok nj ol bi translated">2.标题、副标题和正文</h2><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div class="gi gj ou"><img src="../Images/e99c6dea8caa472e58388dd6f8f3826e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*qg9XNdSrC-PFxu8P8EP-NQ.png"/></div></figure><h2 id="6619" class="oa mo iu bd mp ob oc dn mt od oe dp mx kn of og nb kr oh oi nf kv oj ok nj ol bi translated">3.附件</h2><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ov"><img src="../Images/4fe164f18ba41d534858e9498f02802c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ysEWTMtUvcGsN6Gl0O5gUA.png"/></div></div></figure><p id="e7e6" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">iOS支持不同种类的媒体附件，包括图像、音频和视频。通过<a class="ae op" href="https://developer.apple.com/documentation/usernotifications/unnotificationserviceextension" rel="noopener ugc nofollow" target="_blank">，通知服务应用程序扩展</a>必须被实现以下载用于远程通知的资源。</p><h2 id="5091" class="oa mo iu bd mp ob oc dn mt od oe dp mx kn of og nb kr oh oi nf kv oj ok nj ol bi translated">4.类别标识符</h2><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ow"><img src="../Images/dc12913fe91d263ef43bdc67ca24dc43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1xOnYbl9FwEoigBdWSApXg.png"/></div></div></figure><p id="58fe" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe ns nt nu nv b">CategoryIdentifier</code>用一定的<code class="fe ns nt nu nv b">UNNotificationActions</code>定义类别。</p><h2 id="cd1f" class="oa mo iu bd mp ob oc dn mt od oe dp mx kn of og nb kr oh oi nf kv oj ok nj ol bi translated">5.launchImageName</h2><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><p id="e4b6" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">应用程序启动以响应通知时显示的启动图像或故事板的名称</p><h2 id="b0ac" class="oa mo iu bd mp ob oc dn mt od oe dp mx kn of og nb kr oh oi nf kv oj ok nj ol bi translated">6.声音</h2><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="oq nx l"/></div></figure><p id="57c9" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe ns nt nu nv b">defaultCritical</code>只有当应用程序通过苹果认证并获得苹果授予的特殊权利时，才能使用声音。否则，用<code class="fe ns nt nu nv b">default</code>音代替。</p><p id="f9ea" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">要使用自定义声音，请确保将声音文件作为引用添加到项目中，而不是简单地添加到项目文件夹中。</p><h2 id="67b6" class="oa mo iu bd mp ob oc dn mt od oe dp mx kn of og nb kr oh oi nf kv oj ok nj ol bi translated">7.线程标识符</h2><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div class="gi gj ox"><img src="../Images/3b8fa831520d483b27c03e9876d9e51a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*i6_sLIpq8IF41awdvLawcw.png"/></div></figure><p id="9f71" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">用于将相关通知分组在一起的标识符。以WhatsApp为例，每个联系人和每个聊天室都有自己的<code class="fe ns nt nu nv b">threadIdentifier</code>，以便将相关的消息通知分组在一起。</p><h2 id="413c" class="oa mo iu bd mp ob oc dn mt od oe dp mx kn of og nb kr oh oi nf kv oj ok nj ol bi translated">8.用户信息</h2><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><p id="c918" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe ns nt nu nv b">userInfo</code>是一个字典，可以包含一些键值对格式的信息。当用户打开通知并触发<a class="ae op" href="https://developer.apple.com/documentation/usernotifications/unusernotificationcenterdelegate/1649501-usernotificationcenter" rel="noopener ugc nofollow" target="_blank">userNotificationCenter(_:did receive:with completionhandler:)</a>函数时，可以检索到这些信息。</p><h2 id="a136" class="oa mo iu bd mp ob oc dn mt od oe dp mx kn of og nb kr oh oi nf kv oj ok nj ol bi translated">9 . summaryargument &amp; summaryArgumentCount</h2><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj oy"><img src="../Images/971356571a5aba8954fd1d64962ec950.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XcFNso22xHSs7UX_2Gtmmw.png"/></div></div></figure><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><p id="0e78" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe ns nt nu nv b">summaryArgument</code>是分组通知集的显示字符串。<code class="fe ns nt nu nv b">summaryArgumentCount</code>是每个通知所代表的“通知”数量。</p><p id="72ef" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">从上图中可以看出，即使只有2个通知被归入一个组，也会显示“来自summaryArgument的3个以上的通知”。这是因为每个隐藏通知都会导致“3”个参数计数。</p><h2 id="88d5" class="oa mo iu bd mp ob oc dn mt od oe dp mx kn of og nb kr oh oi nf kv oj ok nj ol bi translated">10.targetContentIdentifier</h2><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><p id="1e7c" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">应用程序用来标识通知内容的值。</p></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="4171" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">扳机</h1><p id="88ae" class="pw-post-body-paragraph kc kd iu ke b kf nn kh ki kj no kl km kn np kp kq kr nq kt ku kv nr kx ky kz in bi translated">苹果公司向开发者提供三种本地通知触发器:</p><h2 id="eb18" class="oa mo iu bd mp ob oc dn mt od oe dp mx kn of og nb kr oh oi nf kv oj ok nj ol bi translated">1.<a class="ae op" href="https://developer.apple.com/documentation/usernotifications/uncalendarnotificationtrigger" rel="noopener ugc nofollow" target="_blank">未通知触发</a></h2><p id="e04f" class="pw-post-body-paragraph kc kd iu ke b kf nn kh ki kj no kl km kn np kp kq kr nq kt ku kv nr kx ky kz in bi translated">在特定的日期和时间弹出本地通知。在不同的文化/地区，一周的开始是不同的。必须先仔细检查一下。</p><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><h2 id="6662" class="oa mo iu bd mp ob oc dn mt od oe dp mx kn of og nb kr oh oi nf kv oj ok nj ol bi translated">2.UNTimeIntervalNotificationTrigger</h2><p id="d34c" class="pw-post-body-paragraph kc kd iu ke b kf nn kh ki kj no kl km kn np kp kq kr nq kt ku kv nr kx ky kz in bi translated">通知会在特定时间过后立即显示。</p><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><blockquote class="oz pa pb"><p id="41e8" class="kc kd pc ke b kf kg kh ki kj kk kl km pd ko kp kq pe ks kt ku pf kw kx ky kz in bi translated">不重复通知的<code class="fe ns nt nu nv b"><em class="iu">timeInterval</em></code>必须大于0，重复一个的<strong class="ke iv">必须大于60，否则将抛出运行时异常。</strong></p></blockquote><h2 id="ad0b" class="oa mo iu bd mp ob oc dn mt od oe dp mx kn of og nb kr oh oi nf kv oj ok nj ol bi translated">3.UNLocationNotificationTrigger</h2><p id="27c4" class="pw-post-body-paragraph kc kd iu ke b kf nn kh ki kj no kl km kn np kp kq kr nq kt ku kv nr kx ky kz in bi translated">当用户进入或退出由其坐标和半径(以米为单位)定义的特定地理区域时，会触发通知。</p><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div class="gi gj pg"><img src="../Images/c45cb065e2165df8bf843a7a2b73f2e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*YAOSs5byPYdQ7ZelXcNQMw.png"/></div></figure><p id="82d3" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">请记住，为了监控位置变化，必须授予“使用时”位置许可。有关CoreLocation框架的更多详细信息，请参考以下文章:</p><div class="ph pi gq gs pj pk"><a rel="noopener  ugc nofollow" target="_blank" href="/swift-ios-cllocationmanager-all-in-one-b786ffd37e4a"><div class="pl ab fp"><div class="pm ab pn cl cj po"><h2 class="bd iv gz z fq pp fs ft pq fv fx it bi translated">Swift iOS CLLocationManager一体化</h2><div class="pr l"><h3 class="bd b gz z fq pp fs ft pq fv fx dk translated">如何在iOS中获取用户位置？CoreLocation为您提供了多少配置？让我们点击阅读更多！</h3></div><div class="ps l"><p class="bd b dl z fq pp fs ft pq fv fx dk translated">itnext.io</p></div></div><div class="pt l"><div class="pu l pv pw px pt py ka pk"/></div></div></a></div><p id="b1dd" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">为了消除任何虚假触发，iOS有自己的方法来确定用户是否真的进入/退出了某个区域。根据<a class="ae op" href="https://developer.apple.com/documentation/corelocation/monitoring_the_user_s_proximity_to_geographic_regions" rel="noopener ugc nofollow" target="_blank">官方文件</a>，用户必须越过边界一段最小距离，并在边界的同一侧停留至少20秒。</p></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="1ee2" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">处理待定请求和已发送的通知</h1><p id="62b2" class="pw-post-body-paragraph kc kd iu ke b kf nn kh ki kj no kl km kn np kp kq kr nq kt ku kv nr kx ky kz in bi translated">添加通知触发请求后，app可以通过以下方式取消请求:</p><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure><p id="b779" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">触发通知触发器并将通知发送到通知中心后，应用程序可以通过以下方式删除它:</p><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="6306" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">在前台显示横幅通知</h1><p id="6e24" class="pw-post-body-paragraph kc kd iu ke b kf nn kh ki kj no kl km kn np kp kq kr nq kt ku kv nr kx ky kz in bi translated">默认情况下，只有当app在<strong class="ke iv">后台</strong>或<strong class="ke iv">被用户或系统</strong>终止时，才会自动显示横幅通知。然而，有时有必要显示横幅通知，即使应用程序在前台。例如，非消息页面的消息应用和报警应用。</p><p id="9715" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">为了在前台显示横幅通知，必须实现<a class="ae op" href="https://developer.apple.com/documentation/usernotifications/unusernotificationcenterdelegate" rel="noopener ugc nofollow" target="_blank">unusernotificationcenteredelegate</a>的函数<a class="ae op" href="https://developer.apple.com/documentation/usernotifications/unusernotificationcenterdelegate/1649518-usernotificationcenter" rel="noopener ugc nofollow" target="_blank">userNotificationCenter(_:will present:with completion handler:)</a>。用合适的<code class="fe ns nt nu nv b">UNNotificationPresentationOptions</code>调用<code class="fe ns nt nu nv b">completionHandler</code>弹出通知。</p><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="nw nx l"/></div></figure></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="1168" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">摘要</h1><ol class=""><li id="1be1" class="ls lt iu ke b kf nn kj no kn om kr on kv oo kz lx ly lz ma bi translated">本地通知需要推送通知授权。即使用户授予了权限，他/她仍然可以禁用/启用不同样式的通知，例如横幅</li><li id="7a74" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated">提醒、声音和徽章是app请求的常用<code class="fe ns nt nu nv b">UNAuthorizationOptions</code></li><li id="a9eb" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated"><code class="fe ns nt nu nv b">UNUserNotification</code>委托和注册<code class="fe ns nt nu nv b">UNNotificationCategory</code>的设置应在<code class="fe ns nt nu nv b">application:didFinishLaunchingWithOptions:</code>完成。</li><li id="c763" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated">前台通知默认是隐藏的，应该在<a class="ae op" href="https://developer.apple.com/documentation/usernotifications/unusernotificationcenterdelegate/1649518-usernotificationcenter" rel="noopener ugc nofollow" target="_blank">用户通知中心(_:will present:with completion handler:)</a>调用带有合适<code class="fe ns nt nu nv b">UNNotificationPresentationOptions</code>的<code class="fe ns nt nu nv b">completionHandler</code></li><li id="99c6" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated">通知内容包括标题、副标题、正文、徽章、线程标识符和类别标识符等。</li><li id="f75a" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated">通知操作是长按通知时显示的按钮。他们必须在<code class="fe ns nt nu nv b">application:didFinishLaunchingWithOptions:</code>登记。</li><li id="3cbf" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated">3 <code class="fe ns nt nu nv b">UNNotificationTrigger</code>是<code class="fe ns nt nu nv b">UNCalendarNotificationTrigger</code>、<code class="fe ns nt nu nv b">UNTimeIntervalNotificationTrigger</code>和<code class="fe ns nt nu nv b">UNLocationNotificationTrigger</code></li><li id="770e" class="ls lt iu ke b kf mb kj mc kn md kr me kv mf kz lx ly lz ma bi translated">开发者可以在<a class="ae op" href="https://developer.apple.com/documentation/usernotifications/unusernotificationcenterdelegate/1649501-usernotificationcenter" rel="noopener ugc nofollow" target="_blank">用户通知中心(_:did receive:with completion handler:)</a>处理用户选择的按钮</li></ol></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="90d8" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">阅读和参考</h1><h2 id="790f" class="oa mo iu bd mp ob oc dn mt od oe dp mx kn of og nb kr oh oi nf kv oj ok nj ol bi translated">1.从您的应用程序本地安排通知</h2><div class="ph pi gq gs pj pk"><a href="https://developer.apple.com/documentation/usernotifications/scheduling_a_notification_locally_from_your_app" rel="noopener  ugc nofollow" target="_blank"><div class="pl ab fp"><div class="pm ab pn cl cj po"><h2 class="bd iv gz z fq pp fs ft pq fv fx it bi translated">Apple开发者文档</h2><div class="pr l"><h3 class="bd b gz z fq pp fs ft pq fv fx dk translated">编辑描述</h3></div><div class="ps l"><p class="bd b dl z fq pp fs ft pq fv fx dk translated">developer.apple.com</p></div></div></div></a></div><h2 id="4b34" class="oa mo iu bd mp ob oc dn mt od oe dp mx kn of og nb kr oh oi nf kv oj ok nj ol bi translated">2.声明可操作的通知类型</h2><div class="ph pi gq gs pj pk"><a href="https://developer.apple.com/documentation/usernotifications/declaring_your_actionable_notification_types" rel="noopener  ugc nofollow" target="_blank"><div class="pl ab fp"><div class="pm ab pn cl cj po"><h2 class="bd iv gz z fq pp fs ft pq fv fx it bi translated">Apple开发者文档—通知类型</h2><div class="pr l"><h3 class="bd b gz z fq pp fs ft pq fv fx dk translated">编辑描述</h3></div><div class="ps l"><p class="bd b dl z fq pp fs ft pq fv fx dk translated">developer.apple.com</p></div></div></div></a></div><h2 id="3a96" class="oa mo iu bd mp ob oc dn mt od oe dp mx kn of og nb kr oh oi nf kv oj ok nj ol bi translated">3.处理通知和与通知相关的操作</h2><div class="ph pi gq gs pj pk"><a href="https://developer.apple.com/documentation/usernotifications/handling_notifications_and_notification-related_actions" rel="noopener  ugc nofollow" target="_blank"><div class="pl ab fp"><div class="pm ab pn cl cj po"><h2 class="bd iv gz z fq pp fs ft pq fv fx it bi translated">Apple开发者文档</h2><div class="pr l"><h3 class="bd b gz z fq pp fs ft pq fv fx dk translated">编辑描述</h3></div><div class="ps l"><p class="bd b dl z fq pp fs ft pq fv fx dk translated">developer.apple.com</p></div></div></div></a></div></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div class="gi gj pz"><img src="../Images/fb648b5d8525399dccc3c1dcb5e7338c.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/0*LdV-CIH7VpUfS_YA.png"/></div></figure><p id="d261" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">欢迎您在<a class="ae op" href="https://twitter.com/myrick_chow" rel="noopener ugc nofollow" target="_blank">Twitter @ my rik _ chow</a>关注我，了解更多信息和文章。感谢您阅读这篇文章。祝您愉快！😄</p></div></div>    
</body>
</html>