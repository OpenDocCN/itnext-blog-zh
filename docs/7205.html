<html>
<head>
<title>Trino Gateway</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Trino Gateway</h1>
<blockquote>原文：<a href="https://itnext.io/trino-gateway-8e654366df5e?source=collection_archive---------1-----------------------#2022-07-14">https://itnext.io/trino-gateway-8e654366df5e?source=collection_archive---------1-----------------------#2022-07-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d80000046b08dce18ba4c97be17ab6f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*E2l_ls4_0p6mYVpn"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">谢尔盖·温在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="7f6f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">之前，我在本文的<a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/route-trino-queries-dynamically-using-trino-gateway-9772d62b1630">中提到过如何构建trino网关来将查询动态地路由到下游trino集群。</a></p><p id="84ff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我将展示改进的trino gateway架构，使用<a class="ae kc" href="https://github.com/cloudcheflabs/dataroaster/tree/master/trino-ecosystem/trino-controller" rel="noopener ugc nofollow" target="_blank"> DataRoaster trino控制器</a>控制所有Trino生态系统组件，轻松创建一个漂亮的trino gateway。</p><h1 id="4401" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Trino网关架构</h1><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/36eafcc633b00f552f1fe12e59601f07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OWavvgZaepZ5pPVFUuWKIA.jpeg"/></div></div></figure><ul class=""><li id="eef9" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated"><code class="fe mn mo mp mq b">Admin</code>向<code class="fe mn mo mp mq b">Trino Controller</code>发送创建和删除trino集群的请求，然后<code class="fe mn mo mp mq b">Trino Controller</code>会让<a class="ae kc" href="https://github.com/cloudcheflabs/dataroaster/tree/master/operators/trino" rel="noopener ugc nofollow" target="_blank">数据烘烤器trino操作员</a>创建和删除Trino集群。</li><li id="1570" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated">创建trino集群时，trino协调器和工作器中嵌入的prometheus jmx导出器的地址将作为作业添加到<code class="fe mn mo mp mq b">Prometheus</code>中的prometheus configmap，以收集trino协调器和工作器公开的jmx指标。</li><li id="cf8f" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated"><code class="fe mn mo mp mq b">Admin</code>将向<code class="fe mn mo mp mq b">Trino Controller</code>发送请求以注册trino集群，并向<code class="fe mn mo mp mq b">Trino Gateway</code>发送用户请求以将trino查询路由到已注册的trino集群。</li><li id="42e7" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated"><code class="fe mn mo mp mq b">Admin</code>可以向<code class="fe mn mo mp mq b">Trino Controller</code>发送请求，以停用查询不会被路由到的trino集群。</li><li id="b8e0" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated">当客户端发送查询时，<code class="fe mn mo mp mq b">Trino Gateway</code>首先将对用户进行身份验证，并找到用户所属的集群组，查询将被路由到随机选择的属于该集群组的下游trino集群。</li></ul><p id="3e82" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">与<a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/route-trino-queries-dynamically-using-trino-gateway-9772d62b1630">之前的trino gateway架构</a>相比，很多复杂的工作已经从<code class="fe mn mo mp mq b">Admin</code>需要做的工作中移除，取而代之的是<code class="fe mn mo mp mq b">Trino Controller</code>将会做这些复杂的工作，因此<code class="fe mn mo mp mq b">Admin</code>只需访问<code class="fe mn mo mp mq b">Trino Controller</code>提供的<a class="ae kc" href="https://github.com/cloudcheflabs/dataroaster/tree/master/trino-ecosystem/trino-controller#trino-controller-rest-api" rel="noopener ugc nofollow" target="_blank"> REST API </a>就具有以下能力:</p><ul class=""><li id="8c50" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated">轻松创建trino集群。</li><li id="0bec" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated">轻松扩展trino工作人员。</li><li id="c7e4" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated">轻松添加trino目录属性。</li><li id="9833" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated">轻松更新trino配置。</li><li id="4475" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated">在trino worker HPA中轻松设置最小/最大副本数。</li><li id="ecc3" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated">方便地在trino gateway上注册/注销trino集群。</li><li id="b5e6" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated">轻松激活/停用trino gateway中的trino集群。</li><li id="aa29" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated">通过prometheus和grafana轻松收集嵌入在trino coordinator和workers中的prometheus jmx exporter公开的jmx指标，监控trino集群。</li></ul><p id="6c41" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您还会看到trino gateway的安装比以前更加简单。</p><h1 id="3fd3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安装DataRoaster Trino控制器</h1><p id="25bc" class="pw-post-body-paragraph kd ke iq kf b kg mw ki kj kk mx km kn ko my kq kr ks mz ku kv kw na ky kz la ij bi translated">让我们使用<a class="ae kc" href="https://github.com/cloudcheflabs/dataroaster/tree/master/trino-ecosystem/trino-controller" rel="noopener ugc nofollow" target="_blank">数据烘烤器trino控制器</a>安装trino gateway，该控制器将与其他几个Trino生态系统组件一起创建。</p><h2 id="573b" class="nb lc iq bd ld nc nd dn lh ne nf dp ll ko ng nh lp ks ni nj lt kw nk nl lx nm bi translated">安装Trino控制器</h2><p id="bce7" class="pw-post-body-paragraph kd ke iq kf b kg mw ki kj kk mx km kn ko my kq kr ks mz ku kv kw na ky kz la ij bi translated">运行以下舵图安装trino控制器。</p><pre class="ma mb mc md gt nn mq no np aw nq bi"><span id="9bfd" class="nb lc iq mq b gy nr ns l nt nu">helm repo add dataroaster-trino-controller https://cloudcheflabs.github.io/trino-controller-helm-repo/<br/>helm repo update</span><span id="bd62" class="nb lc iq mq b gy nv ns l nt nu">helm install \<br/>trino-controller \<br/>--create-namespace \<br/>--namespace trino-controller \<br/>--version v1.3.0 \<br/>--set trino.gateway.publicEndpoint="https://trino-gateway-proxy-test.cloudchef-labs.com" \<br/>--set trino.gateway.proxyHostName=trino-gateway-proxy-test.cloudchef-labs.com \<br/>--set trino.gateway.restHostName=trino-gateway-rest-test.cloudchef-labs.com \<br/>--set trino.gateway.storageClass=oci \<br/>dataroaster-trino-controller/dataroaster-trino-controller;</span></pre><ul class=""><li id="b61f" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated"><code class="fe mn mo mp mq b">trino.gateway.publicEndpoint</code>:公共端点，trino客户端将通过https连接到该端点以运行查询。</li><li id="2246" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated"><code class="fe mn mo mp mq b">trino.gateway.proxyHostName</code>:trino网关代理入口主机名。</li><li id="17db" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated"><code class="fe mn mo mp mq b">trino.gateway.restHostName</code>:rest的trino网关入口主机名。</li><li id="6961" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated"><code class="fe mn mo mp mq b">trino.gateway.storageClass</code>:trino gateway MySQL的存储类。</li></ul><p id="a3f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mn mo mp mq b">trino.gateway.proxyHostName</code>和<code class="fe mn mo mp mq b">trino.gateway.restHostName</code>需要随您的域名更改，并在以后注册到DNS服务器。</p><p id="f1ff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mn mo mp mq b">trino.gateway.storageClass</code>也需要更换为您的kubernetes储物类。</p><p id="b5c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个舵图将创建<code class="fe mn mo mp mq b">Trino Controller</code>以及几个这样的组件。</p><ul class=""><li id="b943" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated">nginx入口控制器</li><li id="9cc1" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated">证书管理器</li><li id="6440" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated"><a class="ae kc" href="https://github.com/cloudcheflabs/dataroaster/tree/master/trino-ecosystem/trino-gateway" rel="noopener ugc nofollow" target="_blank">数据烘烤器Trino网关</a></li><li id="1799" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated"><a class="ae kc" href="https://github.com/cloudcheflabs/dataroaster/tree/master/operators/trino" rel="noopener ugc nofollow" target="_blank">数据烘焙师Trino操作员</a></li><li id="33aa" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated"><a class="ae kc" href="https://github.com/cloudcheflabs/dataroaster/tree/master/operators/helm" rel="noopener ugc nofollow" target="_blank">数据焙烧炉舵操作员</a></li></ul><h2 id="3b3e" class="nb lc iq bd ld nc nd dn lh ne nf dp ll ko ng nh lp ks ni nj lt kw nk nl lx nm bi translated">将DNS记录添加到DNS服务器</h2><p id="2ff7" class="pw-post-body-paragraph kd ke iq kf b kg mw ki kj kk mx km kn ko my kq kr ks mz ku kv kw na ky kz la ij bi translated">要公开访问trino gateway，我们需要将trino gateway的入口主机名注册到dns服务器。</p><p id="b0df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像这样把<code class="fe mn mo mp mq b">trino.gateway.proxyHostName</code>和<code class="fe mn mo mp mq b">trino.gateway.restHostName</code>的dns记录添加到DNS服务器。</p><pre class="ma mb mc md gt nn mq no np aw nq bi"><span id="c465" class="nb lc iq mq b gy nr ns l nt nu">trino-gateway-proxy-test.cloudchef-labs.com ---&gt; 146.56.150.205<br/>trino-gateway-rest-test.cloudchef-labs.com  ---&gt; 146.56.150.205</span></pre><p id="a981" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">，其中<code class="fe mn mo mp mq b">146.56.150.205</code>是nginx服务的外部ip。</p><h2 id="672a" class="nb lc iq bd ld nc nd dn lh ne nf dp ll ko ng nh lp ks ni nj lt kw nk nl lx nm bi translated">为入口续订Trino网关证书</h2><p id="be31" class="pw-post-body-paragraph kd ke iq kf b kg mw ki kj kk mx km kn ko my kq kr ks mz ku kv kw na ky kz la ij bi translated">您必须续订trino网关证书才能从“让我们加密”获取有效证书。</p><p id="83b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如下图所示，目前在trino gateway中创建的所有证书都是无效的。</p><pre class="ma mb mc md gt nn mq no np aw nq bi"><span id="ac8b" class="nb lc iq mq b gy nr ns l nt nu">kubectl get cert -n trino-gateway;<br/>NAME                                              READY   SECRET                                            AGE<br/>trino-gateway-proxy-test.cloudchef-labs.com-tls   False   trino-gateway-proxy-test.cloudchef-labs.com-tls   18m<br/>trino-gateway-rest-test.cloudchef-labs.com-tls    False   trino-gateway-rest-test.cloudchef-labs.com-tls    18m</span></pre><p id="1504" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装证书管理器ctl以续订证书。</p><pre class="ma mb mc md gt nn mq no np aw nq bi"><span id="2c0f" class="nb lc iq mq b gy nr ns l nt nu">sudo yum install go -y;</span><span id="db39" class="nb lc iq mq b gy nv ns l nt nu">OS=$(go env GOOS); ARCH=$(go env GOARCH); curl -sSL -o cmctl.tar.gz https://github.com/cert-manager/cert-manager/releases/download/v1.7.2/cmctl-$OS-$ARCH.tar.gz<br/>tar xzf cmctl.tar.gz<br/>sudo mv cmctl /usr/local/bin;</span></pre><p id="b4b4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">续订trino gateway命名空间中所有入口的证书。</p><pre class="ma mb mc md gt nn mq no np aw nq bi"><span id="f287" class="nb lc iq mq b gy nr ns l nt nu">cmctl renew --all -n trino-gateway;</span></pre><p id="ca61" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">显示证书的状态。</p><pre class="ma mb mc md gt nn mq no np aw nq bi"><span id="69cb" class="nb lc iq mq b gy nr ns l nt nu">cmctl status certificate trino-gateway-proxy-test.cloudchef-labs.com-tls -n trino-gateway;</span></pre><p id="aed8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，您已经安装了trino gateway和几个trino生态系统组件。</p><h1 id="2ebd" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">示范</h1><p id="06ba" class="pw-post-body-paragraph kd ke iq kf b kg mw ki kj kk mx km kn ko my kq kr ks mz ku kv kw na ky kz la ij bi translated">为了演示trino gateway，首先是端口转发trino控制器服务。</p><pre class="ma mb mc md gt nn mq no np aw nq bi"><span id="f5c4" class="nb lc iq mq b gy nr ns l nt nu">kubectl port-forward svc/trino-controller-service 8093 -n trino-controller;</span></pre><h2 id="790c" class="nb lc iq bd ld nc nd dn lh ne nf dp ll ko ng nh lp ks ni nj lt kw nk nl lx nm bi translated">创建trino集群</h2><p id="d421" class="pw-post-body-paragraph kd ke iq kf b kg mw ki kj kk mx km kn ko my kq kr ks mz ku kv kw na ky kz la ij bi translated">按照下面的请求，在名称空间<code class="fe mn mo mp mq b">trino-etl-1</code>、<code class="fe mn mo mp mq b">trino-etl-2</code>、<code class="fe mn mo mp mq b">trino-etl-3</code>中创建三个trino集群。</p><pre class="ma mb mc md gt nn mq no np aw nq bi"><span id="7577" class="nb lc iq mq b gy nr ns l nt nu"># create trino cluster 1.<br/>curl -XPOST \<br/>http://localhost:8093/v1/trino/create \<br/>-d  "name=etl-1" \<br/>-d  "namespace=trino-etl-1" \<br/>-d  "max_heap_size=8G" \<br/>-d  "replicas=3" \<br/>-d  "min_replicas=3" \<br/>-d  "max_replicas=5" \<br/>-d  "storage_class=oci" \<br/>;<br/></span><span id="0679" class="nb lc iq mq b gy nv ns l nt nu"># create trino cluster 2.<br/>curl -XPOST \<br/>http://localhost:8093/v1/trino/create \<br/>-d  "name=etl-2" \<br/>-d  "namespace=trino-etl-2" \<br/>-d  "max_heap_size=8G" \<br/>-d  "replicas=3" \<br/>-d  "min_replicas=3" \<br/>-d  "max_replicas=5" \<br/>-d  "storage_class=oci" \<br/>;<br/></span><span id="2cd6" class="nb lc iq mq b gy nv ns l nt nu"># create trino cluster 3.<br/>curl -XPOST \<br/>http://localhost:8093/v1/trino/create \<br/>-d  "name=etl-3" \<br/>-d  "namespace=trino-etl-3" \<br/>-d  "max_heap_size=8G" \<br/>-d  "replicas=3" \<br/>-d  "min_replicas=3" \<br/>-d  "max_replicas=5" \<br/>-d  "storage_class=oci" \<br/>;</span></pre><p id="245f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mn mo mp mq b">storage_class</code>需要进行更改以适应您的kubernetes集群存储类别。</p><h2 id="a9ed" class="nb lc iq bd ld nc nd dn lh ne nf dp ll ko ng nh lp ks ni nj lt kw nk nl lx nm bi translated">向trino网关注册trino集群</h2><p id="0658" class="pw-post-body-paragraph kd ke iq kf b kg mw ki kj kk mx km kn ko my kq kr ks mz ku kv kw na ky kz la ij bi translated">创建集群组。</p><pre class="ma mb mc md gt nn mq no np aw nq bi"><span id="fa7e" class="nb lc iq mq b gy nr ns l nt nu">curl -XPOST \<br/>http://localhost:8093/v1/cluster_group/create \<br/>-d  "group_name=etl_group";</span></pre><p id="8aea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注册trino客户端将访问trino gateway以运行查询的用户。</p><pre class="ma mb mc md gt nn mq no np aw nq bi"><span id="f063" class="nb lc iq mq b gy nr ns l nt nu">curl -XPOST \<br/>http://localhost:8093/v1/users/create \<br/>-d  "user=trino" \<br/>-d  "password=trino123" \<br/>-d  "group_name=etl_group";</span></pre><p id="3ae9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要注册三个trino协调员服务，这是以前创建的。</p><pre class="ma mb mc md gt nn mq no np aw nq bi"><span id="0c05" class="nb lc iq mq b gy nr ns l nt nu"># register cluster 1.<br/>curl -XPOST \<br/>http://localhost:8093/v1/cluster/create \<br/>-d  "cluster_name=etl-1" \<br/>-d  "cluster_type=etl" \<br/>-d  "url=http://trino-coordinator-service.trino-etl-1.svc:8080" \<br/>-d  "activated=true" \<br/>-d  "group_name=etl_group";</span><span id="7c97" class="nb lc iq mq b gy nv ns l nt nu"># register cluster 2.<br/>curl -XPOST \<br/>http://localhost:8093/v1/cluster/create \<br/>-d  "cluster_name=etl-2" \<br/>-d  "cluster_type=etl" \<br/>-d  "url=http://trino-coordinator-service.trino-etl-2.svc:8080" \<br/>-d  "activated=true" \<br/>-d  "group_name=etl_group";<br/></span><span id="4b8c" class="nb lc iq mq b gy nv ns l nt nu"># register cluster 3.<br/>curl -XPOST \<br/>http://localhost:8093/v1/cluster/create \<br/>-d  "cluster_name=etl-3" \<br/>-d  "cluster_type=etl" \<br/>-d  "url=http://trino-coordinator-service.trino-etl-3.svc:8080" \<br/>-d  "activated=true" \<br/>-d  "group_name=etl_group";</span></pre><p id="f848" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">看看<code class="fe mn mo mp mq b">url</code>的值，有这样的<code class="fe mn mo mp mq b"><a class="ae kc" href="http://trino-coordinator-service" rel="noopener ugc nofollow" target="_blank">http://trino-coordinator-service</a>.&lt;cluster-namespace&gt;.svc:8080 .</code>约定</p><h2 id="bc24" class="nb lc iq bd ld nc nd dn lh ne nf dp ll ko ng nh lp ks ni nj lt kw nk nl lx nm bi translated">使用客户端运行查询</h2><p id="1147" class="pw-post-body-paragraph kd ke iq kf b kg mw ki kj kk mx km kn ko my kq kr ks mz ku kv kw na ky kz la ij bi translated">Trino客户端将用于运行对trino网关的查询。</p><p id="91ad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装trino客户端。</p><pre class="ma mb mc md gt nn mq no np aw nq bi"><span id="fe11" class="nb lc iq mq b gy nr ns l nt nu">mkdir -p ~/trino-cli;<br/>cd ~/trino-cli;</span><span id="5333" class="nb lc iq mq b gy nv ns l nt nu">curl -L -O https://repo1.maven.org/maven2/io/trino/trino-cli/384/trino-cli-384-executable.jar;<br/>mv trino-cli-384-executable.jar trino<br/>chmod +x trino</span><span id="cd9d" class="nb lc iq mq b gy nv ns l nt nu">./trino --version;</span></pre><p id="0241" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">连接到trino网关。</p><pre class="ma mb mc md gt nn mq no np aw nq bi"><span id="cbea" class="nb lc iq mq b gy nr ns l nt nu"># user/password: trino/trino123<br/>./trino --server https://trino-gateway-proxy-test.cloudchef-labs.com \<br/>--user trino \<br/>--password;</span></pre><p id="2776" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">看一下<code class="fe mn mo mp mq b"><a class="ae kc" href="https://trino-gateway-proxy-test.cloudchef-labs.com" rel="noopener ugc nofollow" target="_blank">https://trino-gateway-proxy-test.cloudchef-labs.com</a></code>的服务器url，其主机名为trino gateway的入口主机名，之前已经注册到dns服务器。</p><p id="f30e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，运行查询。</p><pre class="ma mb mc md gt nn mq no np aw nq bi"><span id="0eb1" class="nb lc iq mq b gy nr ns l nt nu">...<br/>trino&gt; show catalogs;<br/> Catalog<br/>---------<br/> jmx<br/> memory<br/> system<br/> tpcds<br/> tpch<br/>(5 rows)</span><span id="ef48" class="nb lc iq mq b gy nv ns l nt nu">Query 20220714_084321_00001_98khq, FINISHED, 3 nodes<br/>Splits: 8 total, 8 done (100.00%)<br/>1.34 [0 rows, 0B] [0 rows/s, 0B/s]</span><span id="6ae7" class="nb lc iq mq b gy nv ns l nt nu">trino&gt; SELECT count(*) FROM tpch.tiny.nation;<br/> _col0<br/>-------<br/>    25<br/>(1 row)</span><span id="4ad7" class="nb lc iq mq b gy nv ns l nt nu">Query 20220714_084340_00002_98khq, FINISHED, 3 nodes<br/>Splits: 14 total, 14 done (100.00%)<br/>3.73 [25 rows, 0B] [6 rows/s, 0B/s]<br/>...</span></pre></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><p id="d707" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就是这样。</p></div></div>    
</body>
</html>