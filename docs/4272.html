<html>
<head>
<title>The Path Towards Enterprise Level AWS Infrastructure — Load Balancing and Application Deployment</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通向企业级AWS基础设施的道路—负载平衡和应用程序部署</h1>
<blockquote>原文：<a href="https://itnext.io/the-path-towards-enterprise-level-aws-infrastructure-load-balancing-and-application-deployment-47c48e4c343d?source=collection_archive---------2-----------------------#2020-05-27">https://itnext.io/the-path-towards-enterprise-level-aws-infrastructure-load-balancing-and-application-deployment-47c48e4c343d?source=collection_archive---------2-----------------------#2020-05-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1dbe9e8460744becb465146b98cced65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I0UyYZZWU4B3hahRJB5IBA.jpeg"/></div></div></figure><blockquote class="jy"><p id="c5e0" class="jz ka iq bd kb kc kd ke kf kg kh ki dk translated">让我们完成构建我们的AWS基础架构的过程，并了解我们的高可用性、安全性和容错云系统所需的AWS云的最后关键元素。</p></blockquote><p id="d603" class="pw-post-body-paragraph kj kk iq kl b km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ki ij bi lg translated">本文是这个小型系列的第三篇也是最后一篇，它将带您了解创建企业级AWS基础设施的过程，并解释Amazon Web Services平台的概念和组件。在前面的部分中，我们创建了VPC、子网、NAT网关，配置了网络路由，设置了所需的EC2实例、bastions主机和RDS数据库。如果您错过了前面的任何部分，我们强烈建议您查看一下。</p><p id="9c8b" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">在本文中，我们将通过设置负载平衡器、目标组和在我们的平台上部署我们的应用程序来完成基础设施。</p><p id="3cf2" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">整个系列包括:</p><ol class=""><li id="799d" class="lu lv iq kl b km lp kq lq ku lw ky lx lc ly ki lz ma mb mc bi translated"><a class="ae md" rel="noopener ugc nofollow" target="_blank" href="/the-path-towards-enterprise-level-aws-infrastructure-architecture-scaffolding-d244d0c80364">第1部分—架构搭建(VPC、子网、弹性IP、NAT) </a></li><li id="81f7" class="lu lv iq kl b km me kq mf ku mg ky mh lc mi ki lz ma mb mc bi translated"><a class="ae md" rel="noopener ugc nofollow" target="_blank" href="/the-path-towards-enterprise-level-aws-infrastructure-part-2-ec2-ami-bastion-host-rds-3109c73dc913">第2部分— EC2和数据库配置(EC2、AMI、Bastion主机、RDS) </a></li><li id="c1a3" class="lu lv iq kl b km me kq mf ku mg ky mh lc mi ki lz ma mb mc bi translated">第3部分—负载平衡和应用程序部署(弹性负载平衡器)</li></ol><p id="0d36" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated"><strong class="kl ir"> <em class="mj">目录:</em> </strong></p><ol class=""><li id="c54a" class="lu lv iq kl b km lp kq lq ku lw ky lx lc ly ki lz ma mb mc bi translated">基础设施概述</li><li id="f5a0" class="lu lv iq kl b km me kq mf ku mg ky mh lc mi ki lz ma mb mc bi translated">AWS理论</li></ol><p id="1696" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">2.1弹性负载平衡器(ELB) +目标群体</p><p id="2489" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">3.实践</p><p id="0174" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">3.1目标群体</p><p id="aff0" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">3.2负载平衡器</p><p id="3630" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">3.3应用程序部署</p><p id="b712" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">4.摘要</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="d2ac" class="mr ms iq bd mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no bi translated">基础设施概述</h1><p id="d344" class="pw-post-body-paragraph kj kk iq kl b km np ko kp kq nq ks kt ku nr kw kx ky ns la lb lc nt le lf ki ij bi translated">让我们提醒自己在这个系列中我们正在构建什么。目标是创建一个真实的企业级AWS基础设施，它将托管一个用户管理系统，该系统由一个React.js web应用程序、Java Spring Boot服务器和一个关系数据库组成。在前几篇文章中，我们已经构建了架构的主要部分。因此，我们已经有了一个VPC，它有四个子网(2个公共子网和2个私有子网)，分布在两个不同的可用性区域。</p><figure class="nv nw nx ny gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nu"><img src="../Images/c63616267b23fa33c89f2448e5bdc0fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BW0dWzzaGS7c0qbG"/></div></div><figcaption class="nz oa gj gh gi ob oc bd b be z dk translated">图1</figcaption></figure><p id="ad24" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">在公共子网中，我们为客户端应用程序、NAT网关和堡垒主机准备好了EC2实例。同时，我们的私有子网包含后端服务器和RDS数据库的EC2实例。唯一缺少的元素是负载平衡器。因此，在系列的这一部分，我们将设置它。最终，我们将拥有一个运行后端服务器和前端应用程序的现成平台。</p><p id="cf26" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">下面您可以找到AWS上托管的用户管理web应用系统的视图。</p><figure class="nv nw nx ny gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/c2e232dc1a3af84b5972508b9b6ee29a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qo9uDfqZgcUugitW"/></div></div><figcaption class="nz oa gj gh gi ob oc bd b be z dk translated">图2</figcaption></figure><p id="d7d8" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">这些应用程序可以在github上找到。</p><p id="feae" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">客户端应用:<a class="ae md" href="https://github.com/mkapiczy/react-user-manager" rel="noopener ugc nofollow" target="_blank">https://github.com/mkapiczy/react-user-manager</a></p><p id="c383" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">服务器:【https://github.com/mkapiczy/user-manager-service T2】</p><p id="3b04" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">现在，让我们深入一些理论！</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="fd0d" class="mr ms iq bd mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no bi translated">AWS理论</h1><ol class=""><li id="dd9d" class="lu lv iq kl b km np kq nq ku oe ky of lc og ki lz ma mb mc bi translated"><strong class="kl ir"> <em class="mj">【弹性负载平衡器(ELB) </em> </strong></li></ol><p id="f080" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated"><strong class="kl ir">负载平衡</strong>是在所有请求目标(服务器、应用程序实例、数据库等)之间高效分配传入流量的过程。).一个<strong class="kl ir">负载平衡器</strong>被放置在您的基础设施的前面，并在能够处理这些请求的所有组件之间路由传入的客户端请求。这最大限度地减少了延迟，并确保没有目标过载，从而提高了系统的整体性能。</p><figure class="nv nw nx ny gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/51266cbf22052449dce0016d2d689c24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*K8z_ugeYd7NMI9XM"/></div></div><figcaption class="nz oa gj gh gi ob oc bd b be z dk translated">图3</figcaption></figure><p id="3675" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated"><strong class="kl ir">弹性负载均衡器</strong>自动将传入的请求分布在多个目标上，如EC2实例、容器、IP地址和lambda函数，这些都在<strong class="kl ir">目标组</strong>中定义。目标组允许您定义一组处理相同类型流量的目标。每个ELB都有一组<strong class="kl ir">监听器规则</strong>，这些规则由请求条件和满足这些条件的请求应该被路由到的目标组组成。您可以为不同类型的请求创建不同的目标组，例如，一个目标组用于客户端应用程序请求，另一个用于后端服务器请求。</p><p id="9dfa" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">此外，目标组允许您动态添加或删除目标，并定义运行状况检查设置，负载平衡器随后使用这些设置来持续监视目标组中注册的目标的状态。如果任何目标关闭，负载平衡器会将流量重定向到正常运行的实例，当新的正常运行的实例启动时，负载平衡器会自动将其添加到流量分配中。通过这种方式，ELB确保了容错，并且在<strong class="kl ir">自动扩展组的帮助下，</strong>提供了现代系统所需的可扩展性。</p><p id="d8b6" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">ELB还通过与CloudWatch和X-Ray AWS服务以及中央证书管理的集成，促进了对您系统的操作监控。</p><p id="8152" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">ELB有三种类型:</p><ul class=""><li id="6168" class="lu lv iq kl b km lp kq lq ku lw ky lx lc ly ki oh ma mb mc bi translated"><em class="mj">应用负载均衡器</em> —运行在应用层，最适合HTTP/HTTPS请求的负载均衡。</li><li id="3bab" class="lu lv iq kl b km me kq mf ku mg ky mh lc mi ki oh ma mb mc bi translated"><em class="mj">网络负载平衡器</em> —在传输层上运行，最适合需要高性能的TCP、UDP和TLS流量。</li><li id="3283" class="lu lv iq kl b km me kq mf ku mg ky mh lc mi ki oh ma mb mc bi translated"><em class="mj">经典负载平衡器</em> —它是EC2-classic网络中构建的应用程序的传统类型。</li></ul><p id="3ca7" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">那么，ELB提供什么样的好处呢？</p><ul class=""><li id="efc2" class="lu lv iq kl b km lp kq lq ku lw ky lx lc ly ki oh ma mb mc bi translated">高可用性，</li><li id="25db" class="lu lv iq kl b km me kq mf ku mg ky mh lc mi ki oh ma mb mc bi translated">容错能力，</li><li id="6680" class="lu lv iq kl b km me kq mf ku mg ky mh lc mi ki oh ma mb mc bi translated">可量测性</li><li id="c635" class="lu lv iq kl b km me kq mf ku mg ky mh lc mi ki oh ma mb mc bi translated">安全功能，</li><li id="1485" class="lu lv iq kl b km me kq mf ku mg ky mh lc mi ki oh ma mb mc bi translated">SSL/TLS证书管理，</li><li id="d08b" class="lu lv iq kl b km me kq mf ku mg ky mh lc mi ki oh ma mb mc bi translated">操作监控，</li></ul><h1 id="52a4" class="mr ms iq bd mt mu oi mw mx my oj na nb nc ok ne nf ng ol ni nj nk om nm nn no bi translated">实践</h1><ol class=""><li id="9030" class="lu lv iq kl b km np kq nq ku oe ky of lc og ki lz ma mb mc bi translated"><strong class="kl ir"> <em class="mj">目标群体</em> </strong></li></ol><p id="0168" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">让我们通过设置所需的目标组来开始负载平衡器的配置。进入EC2服务仪表板，在左侧菜单栏中找到<em class="mj">负载平衡</em>子菜单。进入<em class="mj">目标组</em>部分，单击<em class="mj">创建目标</em> <em class="mj">组</em>，设置目标组名称，选择目标类型为实例，并将端口设置为5000(这是我们的客户端应用程序将监听的端口)。将目标群体与我们的用户经理vpc联系起来。</p><figure class="nv nw nx ny gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/8fd0b4588e54671e3b0675df1f754330.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Mc31LkHiYMp75F6j"/></div></div><figcaption class="nz oa gj gh gi ob oc bd b be z dk translated">图4</figcaption></figure><p id="b13d" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">创建后，转到目标选项卡，然后单击编辑。添加<em class="mj"> client-a </em>和<em class="mj"> client-b </em> EC2s作为目标实例并保存。</p><figure class="nv nw nx ny gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/4b7acb9887d13358a97a4920383451d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cGnLVGfnNvs6VYTW"/></div></div><figcaption class="nz oa gj gh gi ob oc bd b be z dk translated">图5</figcaption></figure><p id="ecc2" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">接下来，为我们的服务器实例创建另一个目标组，并添加<em class="mj"> server-a </em>和<em class="mj"> server-b </em> EC2s作为其目标。将健康检查路径更改为/users(我们的服务器不公开/ endpoint)。</p><figure class="nv nw nx ny gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/d1c67737229db173569e4200471204eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rxBneH93bjlqTH0M"/></div></div><figcaption class="nz oa gj gh gi ob oc bd b be z dk translated">图6</figcaption></figure><p id="5810" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated"><strong class="kl ir"> <em class="mj"> 2。弹性负载平衡器</em> </strong></p><p id="3d9d" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">最后，进入负载平衡器菜单，点击<em class="mj">创建负载平衡器，</em>并选择<em class="mj">应用负载平衡器</em>。在负载平衡器的配置表单中，添加两个HTTP侦听器，一个在端口8080上，另一个在端口5000上。选择用户-管理器-vpc，以及我们的两个公共子网。</p><figure class="nv nw nx ny gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/4f818d651a7c9d157168f9afcdd8f131.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cJkJS3WAjXi9gOdb"/></div></div><figcaption class="nz oa gj gh gi ob oc bd b be z dk translated">图7</figcaption></figure><p id="4500" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">配置负载平衡器的安全组，以便允许来自我们的应用程序将要运行的端口上的任何地方的传入流量。</p><figure class="nv nw nx ny gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/a4ae420353f7726cd4c0136732bcbb93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6hhHiE1E5EzV5h7y"/></div></div><figcaption class="nz oa gj gh gi ob oc bd b be z dk translated">图8</figcaption></figure><p id="5666" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">在路由配置中，选择已有的<em class="mj"> server-tg </em>目标组。我们将在创建ELB后添加<em class="mj"> client-tg </em>目标群体。</p><figure class="nv nw nx ny gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi on"><img src="../Images/0d69b8938bf01d64b4e86c5d48af9622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NaKwtK8T07bqbXPW"/></div></div><figcaption class="nz oa gj gh gi ob oc bd b be z dk translated">图9</figcaption></figure><p id="3499" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">创建负载平衡器后，转到<em class="mj">监听器</em>选项卡，选择HTTP端口5000监听器并编辑与其相关的更改操作，以将端口5000上的所有流量转发到<em class="mj">客户端-tg </em>而不是<em class="mj">服务器-tg </em>。也就是说，负载平衡器准备就绪，您应该能够在<em class="mj">描述</em>选项卡中看到它的DNS名称。最后一步是修改服务器和客户机安全组，以允许来自负载平衡器安全组的适当端口上的传入连接。</p><p id="301f" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated"><strong class="kl ir"> <em class="mj"> 3。应用部署</em> </strong></p><p id="904a" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">为了方便我们应用程序的部署，我准备了部署脚本，可以自动将我们的应用程序部署到平台上。您可以在<em class="mj"> deploy.sh </em>文件中项目的基本目录下的GitHub存储库中找到它们。我相信这些脚本是不言自明的，所以我们不会详细介绍它们。</p><p id="f953" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">您总共需要运行4次脚本执行:2次用于服务器实例，2次用于客户端应用程序实例。</p><p id="38db" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated"><strong class="kl ir"> <em class="mj"> 3.1服务器部署</em> </strong></p><p id="c6bb" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">脚本的示例性执行:</p><pre class="nv nw nx ny gt oo op oq or aw os bi"><span id="2de0" class="ot ms iq op b gy ou ov l ow ox">sh deploy.sh 3.235.167.88 10.0.3.121 ~/Documents/keys/user-manager-key.pem jdbc:mysql://user-manager-db.cfitmuokdhyi.us-east-1.rds.amazonaws.com/usermanagerdb password</span></pre><p id="d278" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">脚本:</p><pre class="nv nw nx ny gt oo op oq or aw os bi"><span id="8d17" class="ot ms iq op b gy ou ov l ow ox"><strong class="op ir">#!/bin/bash -e<br/><br/></strong>if [ -z "$1" ] || [ -z "$2" ] || [ -z "$3" ] || [ -z "$4" ] || [ -z "$5" ]; then<br/>  printf "Usage $0 bastion_public_ip instance_private_ip private_key db_address db_password \n"<br/>  exit 1<br/>fi<br/><br/>bastion_address=$1<br/>instance_address=$2<br/>private_key=$3<br/>db_address=$4<br/>db_password=$5<br/><br/>export PROJECT_VERSION=$(mvn help:evaluate -Dexpression=project.version -q -DforceStdout)<br/>printf "\nProject version: %s\n" "$PROJECT_VERSION"<br/><br/>mvn clean install -DskipTests=true<br/><br/>printf "\n"<br/>printf "Adding key to keychain\n"<br/>ssh-add -k "${private_key}"<br/><br/>printf "Creating working directory on Bastion Host\n"<br/>ssh -A ec2-user@"${bastion_address}" "mkdir -p ~/workdir/usermanagerservice"<br/><br/>printf "Copying jar to Bastion Host\n"<br/>scp ./target/usermanagerservice-"${PROJECT_VERSION}".jar ec2-user@"${bastion_address}":~/workdir/usermanagerservice/<br/><br/>printf "Creating working directory on private instance\n"<br/>ssh -A ec2-user@"${bastion_address}" "ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null ec2-user@${instance_address} 'mkdir -p ~/workdir/usermanagerservice'"<br/><br/>printf "Copying jar to private instance\n"<br/>ssh -A ec2-user@"${bastion_address}" "scp -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null ~/workdir/usermanagerservice/usermanagerservice-""${PROJECT_VERSION}"".jar ec2-user@${instance_address}:~/workdir/usermanagerservice/"<br/><br/>printf "Stopping process running on port 8080 if exists\n"<br/>ssh -A ec2-user@"${bastion_address}" "ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null ec2-user@${instance_address} 'sudo fuser -k 8080/tcp'"<br/><br/>printf "Running the application\n"<br/>ssh -A ec2-user@"${bastion_address}" "ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null ec2-user@${instance_address} 'export SPRING_PROFILES_ACTIVE=dev &amp;&amp; export SPRING_DATASOURCE_URL=${db_address} &amp;&amp; export SPRING_DATASOURCE_PASSWORD=${db_password} &amp;&amp; java -jar ~/workdir/usermanagerservice/usermanagerservice-${PROJECT_VERSION}.jar'"<br/><br/>printf "Exit"</span></pre><p id="23d1" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated"><strong class="kl ir"> <em class="mj"> 3.2客户端应用部署</em> </strong></p><p id="bba8" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">脚本的示例性执行:</p><pre class="nv nw nx ny gt oo op oq or aw os bi"><span id="75e4" class="ot ms iq op b gy ou ov l ow ox">sh deploy.sh 3.84.51.190 10.0.0.241 ~/Documents/keys/user-manager-key.pem http://user-manager-lb-1600627179.us-east-1.elb.amazonaws.com:8080</span></pre><p id="17b7" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated">脚本:</p><pre class="nv nw nx ny gt oo op oq or aw os bi"><span id="58f9" class="ot ms iq op b gy ou ov l ow ox"><strong class="op ir">#!/bin/bash -e<br/><br/></strong>if [ -z "$1" ] || [ -z "$2" ] || [ -z "$3" ] || [ -z "$4" ]; then<br/>  printf "Usage $0 bastion_address instance_address private_key server_url\n"<br/>  exit 1<br/>fi<br/><br/>bastion_address=$1<br/>instance_address=$2<br/>private_key=$3<br/>server_url=$4<br/><br/>export REACT_APP_API_URL=${server_url}<br/>npm run build<br/><br/>printf "\n"<br/>printf "Adding key to keychain\n"<br/>ssh-add -k "${private_key}"<br/><br/>printf "Creating working directory on Bastion Host\n"<br/>ssh -A ec2-user@"${bastion_address}" "mkdir -p ~/workdir/usermanager"<br/><br/>printf "Copying project files to Bastion Host\n"<br/>rsync -av -e ssh --exclude='node_modules' ./ ec2-user@"${bastion_address}":~/workdir/usermanager<br/><br/>printf "Creating working directory on private instance\n"<br/>ssh -A ec2-user@"${bastion_address}" "ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null ec2-user@${instance_address} 'mkdir -p ~/workdir/usermanager'"<br/><br/>printf "Copying project files to private instance\n"<br/>ssh -A ec2-user@"${bastion_address}" "scp -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -r ~/workdir/usermanager/ ec2-user@${instance_address}:~/workdir"<br/><br/>printf "Stopping process running on port 5000 if exists\n"<br/>ssh -A ec2-user@"${bastion_address}" "ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null ec2-user@${instance_address} 'sudo fuser -k 5000/tcp'"<br/><br/>printf "Running the application\n"<br/>ssh -A ec2-user@"${bastion_address}" "ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null ec2-user@${instance_address} 'cd ~/workdir/usermanager &amp;&amp; npx serve -s -n build'"<br/><br/>printf "Exit"</span></pre><h1 id="b2e9" class="mr ms iq bd mt mu oi mw mx my oj na nb nc ok ne nf ng ol ni nj nk om nm nn no bi translated">摘要</h1><p id="3471" class="pw-post-body-paragraph kj kk iq kl b km np ko kp kq nq ks kt ku nr kw kx ky ns la lb lc nt le lf ki ij bi translated">向你致敬！在这个系列中，我们从头开始在AWS上创建了一个高度可用、安全和容错的云系统。我们的基础架构现已就绪，我们的应用程序也已启动并运行。此外，我们已经涵盖了大量的理论，尽管AWS当然不止这些，但我们希望本系列为您更深入地了解云计算和Amazon Web Services平台提供了坚实的基础。</p><figure class="nv nw nx ny gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/05998ac96559af32d434e167dfe9d892.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-kgn-qyCk07vxLTe"/></div></div><figcaption class="nz oa gj gh gi ob oc bd b be z dk translated">图10</figcaption></figure><p id="61df" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated"><strong class="kl ir">来源:</strong></p><p id="a554" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated"><a class="ae md" href="https://aws.amazon.com/elasticloadbalancing/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/elasticloadbalancing/</a></p><p id="82b9" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated"><a class="ae md" href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-target-groups.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/elastic load balancing/latest/application/load-balancer-target-groups . html</a></p><p id="0825" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated"><a class="ae md" href="https://medium.com/containers-on-aws/using-aws-application-load-balancer-and-network-load-balancer-with-ec2-container-service-d0cb0b1d5ae5" rel="noopener">https://medium . com/containers-on-AWS/using-AWS-application-load-balancer-and-network-load-balancer-with-ec2-container-service-d 0 CB 0 B1 D5 AE 5</a></p><p id="7bb8" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated"><a class="ae md" href="https://app.pluralsight.com/library/courses/aws-developer-getting-started/table-of-contents" rel="noopener ugc nofollow" target="_blank">https://app . plural sight . com/library/courses/AWS-developer-getting-started/目录</a></p><p id="fdfb" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated"><a class="ae md" href="https://app.pluralsight.com/library/courses/aws-developer-designing-developing/table-of-contents" rel="noopener ugc nofollow" target="_blank">https://app . plural sight . com/library/courses/AWS-developer-design-developing/目录</a></p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><p id="31dc" class="pw-post-body-paragraph kj kk iq kl b km lp ko kp kq lq ks kt ku lr kw kx ky ls la lb lc lt le lf ki ij bi translated"><em class="mj">原载于2020年5月27日https://grapeup.com</em><em class="mj">的</em> <a class="ae md" href="https://grapeup.com/blog/read/the-path-towards-enterprise-level-aws-infrastructure-architecture-scaffolding-77" rel="noopener ugc nofollow" target="_blank"> <em class="mj">。</em></a></p></div></div>    
</body>
</html>