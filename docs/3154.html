<html>
<head>
<title>Build FFmpeg WebAssembly version (= ffmpeg.wasm): Part.1 Preparation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建FFmpeg WebAssembly版本(= ffmpeg.wasm):第1部分准备</h1>
<blockquote>原文：<a href="https://itnext.io/build-ffmpeg-webassembly-version-ffmpeg-js-part-1-preparation-ed12bf4c8fac?source=collection_archive---------4-----------------------#2019-10-13">https://itnext.io/build-ffmpeg-webassembly-version-ffmpeg-js-part-1-preparation-ed12bf4c8fac?source=collection_archive---------4-----------------------#2019-10-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/8c0c378d4f8e771bf56ebf20e4685f63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*bJYwDAe6Hj59mpHZr46olQ.png"/></div></figure><blockquote class="jx jy jz"><p id="cf3f" class="ka kb kc kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2020年8月更新:修改故事，使其在MacOS中工作。</p></blockquote><p id="8e49" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">在这一部分，您将学习:</p><ol class=""><li id="97a6" class="lc ld it kd b ke kf ki kj kz le la lf lb lg ky lh li lj lk bi translated">这个系列的背景</li><li id="c4b8" class="lc ld it kd b ke ll ki lm kz ln la lo lb lp ky lh li lj lk bi translated">如何用docker(以及在MacOS中不用Docker)构建原生FFmpeg</li></ol></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="a962" class="lx ly it bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">这个系列的背景</h1><p id="f208" class="pw-post-body-paragraph ka kb it kd b ke mv kg kh ki mw kk kl kz mx ko kp la my ks kt lb mz kw kx ky im bi translated">这一系列故事旨在达到以下目的:</p><ol class=""><li id="343e" class="lc ld it kd b ke kf ki kj kz le la lf lb lg ky lh li lj lk bi translated">对于想学习如何使用Emscripten将C/C++库编译成JavaScript的人来说，这是一本指南(希望是目前为止最有用和详细的)</li><li id="8f33" class="lc ld it kd b ke ll ki lm kz ln la lo lb lp ky lh li lj lk bi translated">个人笔记</li></ol><h1 id="3104" class="lx ly it bd lz ma na mc md me nb mg mh mi nc mk ml mm nd mo mp mq ne ms mt mu bi translated">为什么是FFmpeg？</h1><p id="1dae" class="pw-post-body-paragraph ka kb it kd b ke mv kg kh ki mw kk kl kz mx ko kp la my ks kt lb mz kw kx ky im bi translated">FFmpeg是一个免费的开源项目，由一个庞大的软件套件库和程序组成，用于处理视频、音频和其他多媒体文件和流。(来自维基百科)</p><p id="b08a" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">这是一个非常有用的库，没有一个JavaScript库具有完全相同的功能。如果你在谷歌上搜索“ffmpeg.js ”,你会发现很少有现存的库和我们将要构建的完全一样:</p><ul class=""><li id="f350" class="lc ld it kd b ke kf ki kj kz le la lf lb lg ky nf li lj lk bi translated">ffmpeg . js:<a class="ae ng" href="https://github.com/Kagami/ffmpeg.js/" rel="noopener ugc nofollow" target="_blank">https://github.com/Kagami/ffmpeg.js</a></li><li id="3e03" class="lc ld it kd b ke ll ki lm kz ln la lo lb lp ky nf li lj lk bi translated">https://github.com/bgrins/videoconverter.js</li></ul><p id="ac7f" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">在大多数情况下，这些库都很棒，随时可用，但是它们存在以下问题:</p><ol class=""><li id="4f03" class="lc ld it kd b ke kf ki kj kz le la lf lb lg ky lh li lj lk bi translated">FFmpeg和Emscripten的版本都已过时。</li><li id="5adb" class="lc ld it kd b ke ll ki lm kz ln la lo lb lp ky lh li lj lk bi translated">多年未进行有效维护。<em class="kc">(Kagami/ffmpeg . js 2020年4月继续开发)</em></li></ol><p id="b0b7" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">我曾考虑接管其中一个库，但由于这些年来发生了太多的变化，我决定从头开始，同时编写了这一系列教程来帮助人们学习如何在真实的C/C++库中使用Emscripten。</p><h1 id="5ef8" class="lx ly it bd lz ma na mc md me nb mg mh mi nc mk ml mm nd mo mp mq ne ms mt mu bi translated">如何用Docker构建原生FFmpeg</h1><p id="8def" class="pw-post-body-paragraph ka kb it kd b ke mv kg kh ki mw kk kl kz mx ko kp la my ks kt lb mz kw kx ky im bi translated">首先，我们需要从它的存储库中克隆FFmpeg源代码，因为<code class="fe nh ni nj nk b">master</code>分支正在开发中，我们最好选择一个特定的版本来编译。</p><p id="fe2c" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">在我写这个故事的时候，FFmpeg的最新稳定版本是n4.3.1，所以我们将在整个故事中使用这个版本。</p><figure class="nl nm nn no gt ju"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="d102" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">在完成了存储库的克隆之后，是时候用GCC构建以确保它能够工作了。</p><p id="7f42" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">实际上，如果你很急的话，可以跳过这一部分，但是根据我自己的经验，最好是先熟悉一下库的构建系统。</p><p id="07d4" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">构建和安装FFmpeg的指令可以在资源库的根目录下的<a class="ae ng" href="https://github.com/FFmpeg/FFmpeg/blob/n4.3.1/INSTALL.md" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> INSTALL.md </strong> </a>中找到:</p><pre class="nl nm nn no gt nr nk ns nt aw nu bi"><span id="67ce" class="nv ly it nk b gy nw nx l ny nz">Installing FFmpeg:</span><span id="2077" class="nv ly it nk b gy oa nx l ny nz">1. Type `./configure` to create the configuration. A list of configure options is printed by running `configure -help`.</span><span id="fe42" class="nv ly it nk b gy oa nx l ny nz">`configure` can be launched from a directory different from the FFmpeg sources to build the objects out of tree. To do this, use an absolute path when launching `configure`, e.g. `/ffmpegdir/ffmpeg/configure`.</span><span id="bc9d" class="nv ly it nk b gy oa nx l ny nz">2. Then type `make` to build FFmpeg. GNU Make 3.81 or later is required.</span><span id="b095" class="nv ly it nk b gy oa nx l ny nz">3. Type `make install` to install all binaries and libraries you built.</span><span id="7be2" class="nv ly it nk b gy oa nx l ny nz">NOTICE<br/> - - -</span><span id="6e2c" class="nv ly it nk b gy oa nx l ny nz">- Non system dependencies (e.g. libx264, libvpx) are disabled by default.</span></pre><p id="47a5" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">因为我们不需要实际安装FFmpeg，所以只需要第1步和第2步。</p><p id="cdd3" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">有两种构建方式，一种是原生方式，需要你安装软件包(例如emsdk，Node.js)。大多数时候它是有效的，但是有时你可能会面临由于软件包版本和操作系统的变化而难以解决的错误。另一种方法是使用<a class="ae ng" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker </a>，它提供了一个稳定和静态的构建环境。强烈推荐使用Docker，因为它可以节省您安装(和删除)软件包的时间。</p><p id="8d63" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">我不会在这里介绍如何安装包，但是我把脚本分成了<code class="fe nh ni nj nk b">build.sh</code>和<code class="fe nh ni nj nk b">build-with-docker.sh</code>，你可以自己安装所有的包并运行<code class="fe nh ni nj nk b">build.sh</code>。</p><blockquote class="jx jy jz"><p id="a40b" class="ka kb kc kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了确保本教程能够最大限度地覆盖环境，我使用Github动作来测试它是否能在Linux和MacOS上工作。对于Linux用户，我会使用Docker way / <code class="fe nh ni nj nk b">build-with-docker.sh</code>来构建。对于MacOS用户，由于Github Actions不支持Docker，所以我会使用native way / <code class="fe nh ni nj nk b">build.sh</code>来构建。</p></blockquote><p id="4399" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">现在，让我们用下面的内容创建一个名为<code class="fe nh ni nj nk b">build.sh</code>的文件。</p><figure class="nl nm nn no gt ju"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="72ab" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">要以本机方式构建，只需运行命令:</p><pre class="nl nm nn no gt nr nk ns nt aw nu bi"><span id="817d" class="nv ly it nk b gy nw nx l ny nz">$ bash build.sh</span></pre><p id="86a6" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">要使用Docker构建，创建一个名为<code class="fe nh ni nj nk b">build-with-docker.sh</code>的文件，包含以下内容:</p><figure class="nl nm nn no gt ju"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="fa6e" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">和运行命令:</p><pre class="nl nm nn no gt nr nk ns nt aw nu bi"><span id="7a71" class="nv ly it nk b gy nw nx l ny nz">$ bash build-with-docker.sh</span></pre><blockquote class="jx jy jz"><p id="5f10" class="ka kb kc kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe nh ni nj nk b">--disable-x86asm</code>是禁用x86汇编特性所必需的，因为我们不打算使用它。</p><p id="429d" class="ka kb kc kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">根据你的网速和电脑的硬件规格，完成编译可能需要10~30分钟。</p><p id="fbee" class="ka kb kc kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当gcc 9引入更多的约束时，你在编译过程中看到大量的警告是正常的。</p></blockquote><p id="435d" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">编译原生FFmpeg应该需要一些时间。如果一切正常，您应该可以使用以下命令运行<code class="fe nh ni nj nk b">ffmpeg</code>:</p><pre class="nl nm nn no gt nr nk ns nt aw nu bi"><span id="e42c" class="nv ly it nk b gy nw nx l ny nz">$ ./ffmpeg</span></pre><p id="fdd7" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">您应该会看到类似这样的内容:</p><blockquote class="jx jy jz"><p id="9410" class="ka kb kc kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ffmpeg版本n4.3.1版权所有2000–2019 FFmpeg开发者<br/>用gcc 8 (GCC) <br/>构建的配置:—disable-x86 ASM<br/>libavutil 56。22.100 / 56.22.100 <br/> libavcodec 58。35.100 / 58.35.100 <br/> libavformat 58。20.100 / 58.20.100 <br/> libavdevice 58。5.100 / 58.5.100 <br/> libavfilter 7。40.101 / 7.40.101 <br/> libswscale 5。3.100 / 5.3.100 <br/> libswresample 3。3.100 / 3.3.100 <br/>超快速音视频编码器<br/>用法:ffmpeg[options][[infile options]-I infile]…{[outfile options]outfile }…</p><p id="85dc" class="ka kb kc kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用-h获得完整的帮助，或者更好的是，运行' man ffmpeg '</p></blockquote><p id="0b3a" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">你可以访问这里的知识库，看看它是如何详细工作的:<a class="ae ng" href="https://github.com/ffmpegwasm/FFmpeg/tree/n4.3.1-p1" rel="noopener ugc nofollow" target="_blank">https://github.com/ffmpegwasm/FFmpeg/tree/n4.3.1-p1</a></p><p id="509e" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">并且可以在这里随意下载建造神器:<a class="ae ng" href="https://github.com/ffmpegwasm/FFmpeg/releases/tag/n4.3.1-p1" rel="noopener ugc nofollow" target="_blank">https://github.com/ffmpegwasm/FFmpeg/releases/tag/n4.3.1-p1</a></p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="3337" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">现在我们已经完成了准备，下面我们继续进入<a class="ae ng" href="https://medium.com/@jeromewus/build-ffmpeg-webassembly-version-ffmpeg-js-part-2-compile-with-emscripten-4c581e8c9a16" rel="noopener">构建FFmpeg WebAssembly版本(= ffmpeg.wasm): Part.2用Emscripten编译</a>开始用Emscripten编译FFmpeg。😃</p></div></div>    
</body>
</html>