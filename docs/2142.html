<html>
<head>
<title>Create a free private npm registry with Verdaccio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Verdaccio创建一个免费的私有npm注册表</h1>
<blockquote>原文：<a href="https://itnext.io/creating-a-free-private-npm-registry-with-verdaccio-e1becdc542b?source=collection_archive---------2-----------------------#2019-04-06">https://itnext.io/creating-a-free-private-npm-registry-with-verdaccio-e1becdc542b?source=collection_archive---------2-----------------------#2019-04-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/dbc4ad451b8f48db5fee8e4ad9fc7264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*he2KcGD3HnSn1bwcRFGJ3Q.png"/></div></div></figure><h1 id="c74e" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">问题是</h1><p id="c3aa" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">有时你想在你的项目或组织中共享代码、库或组件，但不希望你的npm包是公开的。</p><p id="7a28" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">使用npm注册表，您可以发布自己的npm包，这些包有自己的发布周期，因此任何有权访问注册表的人都可以在自己的项目中安装和使用。这有助于实现模块化、代码重用和代码库中关注点的分离。</p><p id="8762" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated"><a class="ae lz" href="https://www.npmjs.com/products/enterprise" rel="noopener ugc nofollow" target="_blank"> npm企业</a>已经提供了，但不是免费的。是一个轻量级的私有npm代理注册表，允许你免费拥有自己的npm注册表。在接下来的部分中，我将带您了解如何设置和配置您自己的私有npm注册表。</p><h1 id="0ab8" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">配置Verdaccio</h1><ol class=""><li id="0878" class="ma mb iq ky b kz la ld le lh mc ll md lp me lt mf mg mh mi bi translated">您可以在这里克隆一个示例库<a class="ae lz" href="https://github.com/verdaccio/docker-examples" rel="noopener ugc nofollow" target="_blank">来开始。在我的例子中，我将使用“docker-local-storage-volume”来通过一个挂载的docker卷在我的服务器上本地存储发布的包。</a></li><li id="59c5" class="ma mb iq ky b kz mj ld mk lh ml ll mm lp mn lt mf mg mh mi bi translated">您可以从<code class="fe mo mp mq mr b">conf/config.yaml</code>文件中更改配置以满足您的需求，其中<a class="ae lz" href="https://verdaccio.org/docs/en/configuration" rel="noopener ugc nofollow" target="_blank">文档</a>包含了所有关于可能的配置选项的必要信息。</li><li id="0065" class="ma mb iq ky b kz mj ld mk lh ml ll mm lp mn lt mf mg mh mi bi translated">在我的例子中，出于安全原因，我希望只有经过认证的用户能够看到和发布包，毕竟它应该是私有的，对吗？所以我将遵循<a class="ae lz" href="https://verdaccio.org/docs/en/packages" rel="noopener ugc nofollow" target="_blank">这个</a>来使它只允许用户发布在他们的包名中有<em class="ms"> @myscope </em>作用域前缀的包，如<code class="fe mo mp mq mr b">package.json</code>中所定义的。如果你不熟悉npm作用域<a class="ae lz" href="https://docs.npmjs.com/about-scopes" rel="noopener ugc nofollow" target="_blank">，你可以在这里</a>阅读更多。这基本上是一种按用户/组织分组的方式。这就是我的配置看起来的样子</li></ol><pre class="mt mu mv mw gt mx mr my mz aw na bi"><span id="ce78" class="nb jz iq mr b gy nc nd l ne nf">'@myscope/*':<br/>    # scoped packages<br/>    # you can specify usernames/groupnames (depending on your auth plugin)<br/>    # and three keywords: "$all", "$anonymous", "$authenticated"<br/>    access: "$authenticated"<br/>    publish: "$authenticated"<br/>    # if package is not available locally, proxy requests to 'npmjs' registry<br/>    proxy: npmjs</span></pre><p id="d316" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">最后一行让我们的注册表充当公共npm注册表的代理，以防用户试图访问私有注册表中不存在的软件包，在这种情况下，请求将被重定向，软件包将从默认的公共npm注册表安装。Verdaccio还将缓存安装在服务器上的包。</p><p id="3cbd" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">4.我想关闭用户注册，只允许特定用户访问注册表，否则任何访问该URL的外部用户都可以注册新帐户，并能够访问或发布软件包，幸运的是，Verdaccio附带了一个htpasswd插件用于验证，设置验证的文档可以在这里找到<a class="ae lz" href="https://verdaccio.org/docs/en/authentification" rel="noopener ugc nofollow" target="_blank"/>。这是我的设置的样子</p><pre class="mt mu mv mw gt mx mr my mz aw na bi"><span id="7889" class="nb jz iq mr b gy nc nd l ne nf">auth:<br/>  htpasswd:<br/>    file: /verdaccio/conf/htpasswd<br/>    # Maximum amount of users allowed to register, defaults to "+inf".<br/>    # You can set this to -1 to disable registration.<br/>    max_users: -1</span></pre><p id="819b" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">就这样，现在只有在/verdaccio/conf/htpasswd文件中配置的用户才能访问注册表，并且注册被禁用。在下一节中，我将向您展示如何创建新用户。</p><p id="bb96" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">5.就这样，将docker映像部署到您最喜欢的云提供商的服务器上，但是确保在部署的实例中运行以下命令，以允许将包写入和存储到目录中。</p><pre class="mt mu mv mw gt mx mr my mz aw na bi"><span id="31bd" class="nb jz iq mr b gy nc nd l ne nf">chmod -R 777 storage/<br/>chmod -R 777 conf/</span></pre><h1 id="bce8" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">认证和创建新用户</h1><p id="6a2e" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">要让一个新用户访问注册表，只需在htpasswd文件中添加另一个htpasswd条目。</p><ol class=""><li id="2427" class="ma mb iq ky b kz lu ld lv lh ng ll nh lp ni lt mf mg mh mi bi translated">前往<a class="ae lz" href="http://www.htaccesstools.com/htpasswd-generator/" rel="noopener ugc nofollow" target="_blank">http://www.htaccesstools.com/htpasswd-generator/</a></li><li id="574c" class="ma mb iq ky b kz mj ld mk lh ml ll mm lp mn lt mf mg mh mi bi translated">创建您的用户名和密码。</li><li id="ed5c" class="ma mb iq ky b kz mj ld mk lh ml ll mm lp mn lt mf mg mh mi bi translated">发送生成的htpasswd行，并将其复制到服务器上的verdaccio/conf/htpasswd文件中。</li><li id="1b0e" class="ma mb iq ky b kz mj ld mk lh ml ll mm lp mn lt mf mg mh mi bi translated">现在，您应该能够从web界面或通过npm使用该用户名和密码登录..(不需要重启服务器)</li></ol><h1 id="5207" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">发布和安装私有npm模块</h1><p id="98aa" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">既然我们已经部署并保护了我们的私有npm注册表，我们只需要配置npm来使用它。</p><p id="971b" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">记住我们将使用作用域包作为最佳实践，查看这些链接可以更好地理解<a class="ae lz" href="https://docs.npmjs.com/misc/scope" rel="noopener ugc nofollow" target="_blank"> npm作用域</a>和<a class="ae lz" href="https://docs.npmjs.com/private-modules/intro" rel="noopener ugc nofollow" target="_blank">私有模块</a>。</p><ol class=""><li id="e15e" class="ma mb iq ky b kz lu ld lv lh ng ll nh lp ni lt mf mg mh mi bi translated">您可以将默认npm范围设置为@myscope。当您执行npm init <code class="fe mo mp mq mr b">npm config set scope @myscope</code>时，确保您的包名称以<em class="ms"> @myscope </em>开头</li><li id="1de1" class="ma mb iq ky b kz mj ld mk lh ml ll mm lp mn lt mf mg mh mi bi translated">将您的本地npm注册表设置为指向新的注册表，而不是默认的公共npm注册表，否则您将不得不通过您使用的每个npm命令的<code class="fe mo mp mq mr b">— -registry</code>标志来指定注册表。<code class="fe mo mp mq mr b">npm set registry &lt;PRIVATE_REGISTRY_URL&gt;</code></li><li id="30fd" class="ma mb iq ky b kz mj ld mk lh ml ll mm lp mn lt mf mg mh mi bi translated">要使用您在上一节中创建的用户名注册/登录，以便您可以发布自己的软件包，请运行<code class="fe mo mp mq mr b">npm adduser</code></li><li id="17f4" class="ma mb iq ky b kz mj ld mk lh ml ll mm lp mn lt mf mg mh mi bi translated">一旦登录，您现在可以通过运行<code class="fe mo mp mq mr b">npm publish</code>将您自己的npm模块发布到注册表。</li><li id="e41d" class="ma mb iq ky b kz mj ld mk lh ml ll mm lp mn lt mf mg mh mi bi translated">您可以通过运行:<code class="fe mo mp mq mr b">npm install @myscope/my-first-published-package</code>将新发布的包安装到该注册表上</li></ol><p id="49b0" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">就是这样，您现在可以安全地发布和安装私有包，并与您的同事或跨多个项目共享模块，而不必像从npm安装任何其他包一样担心它们。Verdaccio还为您的注册表提供了一个很好的web界面，类似于您的npm。您可以通过端口4783从浏览器访问它。</p></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><p id="dc90" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">如果你喜欢我的内容，愿意支持我，你可以<a class="ae lz" href="https://www.buymeacoffee.com/khaledosman" rel="noopener ugc nofollow" target="_blank">请我喝啤酒</a></p></div></div>    
</body>
</html>