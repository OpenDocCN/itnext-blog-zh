# 避免丑陋的 If/else 块&用策略使你的代码模块化

> 原文：<https://itnext.io/avoid-ugly-if-else-blocks-make-your-code-modular-with-strategy-1c3364b2f920?source=collection_archive---------1----------------------->

![](img/25a096b93535bdbf39e23fe09b92b4ee.png)

新的 ES6 语法旨在使我们的代码更加简洁明了。它成功地完成了这个目标:像析构、字符串文字、扩展操作符等等。都是提高代码可读性的好工具。

## 丑陋的 if/else

一个不太可能改变的特殊语法是 if/else 和 switch 语句。我不知道你怎么想，但我总是发现它们是我代码中最丑陋的部分。然而，这是一种无法避免的极其必要的邪恶。

在业务应用程序中，我们几乎总是面临这样的情况:我们必须实现某种路由方法，根据条件执行特定动作的变化。这些方法通常以冗长难看的 if/else 或 switch 语句告终。*(支付选项、电子邮件路由、多个认证提供商等。)*

在这篇文章中，我想和你分享一个我最近学到的模式，我认为它可以帮助你避免这些情况。

# 战略

我所说的模式叫做策略。这种模式是由 GoF ( [四人帮](https://en.wikipedia.org/wiki/Design_Patterns))推广的，它是向应用程序逻辑的某些部分添加可变的、可互换的部分的伟大工具。

那么它是如何工作的呢？策略通过一个商定的接口实现功能的可变部分，该接口用于我们称之为“上下文”的通用对象。基于客户端的调用，上下文使用不同的策略来执行特定的任务。

把策略集想象成一个工具箱，把环境想象成一个工匠。工匠根据不同的工作使用不同的工具。但是在这种情况下，所有的工具都有相同类型的使用说明。

下面的图表进一步阐述了这一观点:

![](img/5ea9fd3da257d1a0ffabb433b22b1fed.png)

## 护照。射流研究…

[护照。JS](http://www.passportjs.org/) 是使用策略模式的完美例子。护照。JS 是一个用于在节点中轻松集成认证系统的库。JS 应用。它有多个不同的界面，可以根据你想使用的提供商来设置认证(脸书、*谷歌、推特等等*)。您需要做的就是将您需要的接口插入到您的身份验证逻辑中。此外，所有这些接口都是可以互换的，你可以很容易地把一个换成另一个。

## 收据发送者

我相信现在你至少对战略模式有了一个基本的了解，所以理论已经足够了！让我们尝试构建一个简单的系统，根据用户下订单时使用的客户端向用户发送收据。

## 定义策略

让我们从充实我们的策略开始吧。首先让我们定义我们的电子邮件策略:

我们使用 [mailgun](https://www.npmjs.com/package/mailgun-js) 模块发送电子邮件。策略对象有一个方法`send`，它接受`receiptHtml`和`userEmail`作为参数。

现在让我们继续我们的松弛策略:

我们使用 [slack 的](https://www.npmjs.com/package/slack) npm 库通过我们想象的 slack 机器人发送收据。这里需要注意一件重要的事情:

*   Strategy 的`send`方法签名与其电子邮件签名相同

## 收据经理

现在我们已经定义了我们的策略，让我们定义我们的收据管理器类，它将为收据生成 html，并使用我们的策略将收据发送给用户:

我省略了`_generateReceiptHtml`方法的实现，因为它与我们的例子无关。有趣的部分是`sendReceipt`方法:

*   我们使用`_generateReceiptHtml`为收据生成 html
*   我们使用作为参数传递给我们的策略来发送回执

因为我们的两个策略有相同的方法签名，所以我们可以互换使用它们，而`ReceiptManager`不会意识到它们的区别。

现在，让我们看看如果我们不定义我们的战略，`sendReceipt`会是什么样子:

注意`switch`语句是如何降低我们代码的可读性的。这种方法现在看起来可能还不错，但是以后，如果我们决定增加更多的交付收据的渠道，这种方法就会变得很难看。

# 客户

现在是最后一部分，让我们看看与我们的收据管理器一起使用我们的策略有多简单:

简单不是吗？我们需要做的就是根据我们想要使用的渠道实例化适当的策略，并将其传递给我们的收据管理器。

这个帖子到此为止！小免责声明:**策略模式可能并不适用于每一种情况，有时可能有些矫枉过正**。因为归根结底，这种模式只是一种工具，就像任何工具一样，你需要确保它适合你的工作。

然而，策略可以是一个很好的方法来加强关注点的分离，并使代码的各个部分更加模块化和可互换。

感谢您的阅读！

*原载于 2019 年 4 月 21 日*[*https://isamatov.com*](https://isamatov.com/avoid-ugly-if-else-blocks-with-strategy/)*。*