<html>
<head>
<title>How I got tickets to a quickly sold out Brandon Sanderson lecture with 40 lines of Python code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我是如何拿到一张门票的，这是一场布兰登·桑德森的讲座，门票很快就卖光了，里面有40行Python代码</h1>
<blockquote>原文：<a href="https://itnext.io/how-i-got-tickets-to-a-quickly-sold-out-brandon-sanderson-lecture-with-40-lines-of-python-code-64c672f6e000?source=collection_archive---------1-----------------------#2019-10-18">https://itnext.io/how-i-got-tickets-to-a-quickly-sold-out-brandon-sanderson-lecture-with-40-lines-of-python-code-64c672f6e000?source=collection_archive---------1-----------------------#2019-10-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7754" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简而言之——当有票的时候，我的手机收到了这个通知:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/6170c51126f348afba7179f423b474e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*VgQss2lnCgi5-MHrv-AK2Q.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">我手机截图</figcaption></figure><h1 id="e10f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">背景故事</h1><p id="427b" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">几个月前，当地的幻想和科幻组织邀请布兰登·桑德森，他是我一直以来最喜欢的幻想作家，作为一年一度的“图标”节(一个幻想和科幻节)的嘉宾</p><p id="e39f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我一听到这个消息，就知道我必须去听他的一个讲座。我几乎读过他写的每一本书，他的世界给了我无尽的灵感。事实上，我在几个月内读完了他所有的主要书籍。一周前，他们终于公布了音乐节的官方日程，其中包括桑德森的讲座。但是，令我惊讶的是，他们还没有发售门票。取而代之的是，日程表上有了一个<strong class="jp ir"> <em class="me">“停止发售，门票将在几天后发售”</em> </strong>的大标题。由于我对早年的常规演讲厅很熟悉，我知道它们都很小，如果我想得到一张他演讲的门票，我必须很快。随着这个消息在社交媒体上传播开来，关于科幻和奇幻团体的讨论愈演愈烈，我觉得拿到一张票的机会正在一分一秒地减少。我不能错过这个机会。</p><p id="0586" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我和一个朋友分享了我的恐惧，他给了我一个很酷的主意(我甚至不确定他是不是100%认真的)<br/>他说——“嘿，你为什么不写点东西来帮你呢？你只需要看看什么时候有票，然后通知自己。不会那么难的。”</p><p id="f16e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">他是对的。这并不难。</p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="b5dd" class="lb lc iq bd ld le mm lg lh li mn lk ll lm mo lo lp lq mp ls lt lu mq lw lx ly bi translated">设计</h1><p id="b41e" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">所以我坐下来写了一个python脚本，它会在有票的时候通知我。基本思想是这样的:<strong class="jp ir">一旦脚本发现售票站点有变化，它需要直接向我的手机发送推送通知。这是我知道我能及时看到票的唯一方法，因为我的手机一直带在身边，所以我得到通知的几率很高。我还决定每10分钟检查一次就足够了，我心想——票不会很快售完(剧透:我只说对了一半，其中一个工作室在两分钟内就卖光了)</strong></p><p id="d2ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代码本身非常简单，但我想我应该分享一下，以防有其他程序员不知道做这样的事情有多容易，让他们的生活变得轻松一点。</p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="5db9" class="lb lc iq bd ld le mm lg lh li mn lk ll lm mo lo lp lq mp ls lt lu mq lw lx ly bi translated">准备</h1><p id="63a5" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">编程语言:Python <br/>需求:只有PyPI的一个包— <strong class="jp ir">“通知-运行”</strong> <br/>很棒的Python包，你可以在这里找到它的Github页面<a class="ae mr" href="https://github.com/notify-run/notify.run" rel="noopener ugc nofollow" target="_blank">。<br/>您可以进入您的python环境(我假设您使用的是virtual-env)并运行:</a></p><p id="9ef9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ms mt mu mv b">pip install notify-run</code></p><p id="b67b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完成后，您需要注册一个频道。此通道将允许您的代码通过手机的web浏览器直接向您的手机发送通知。因此，在安装notify-run之后，您需要运行:</p><pre class="km kn ko kp gt mw mv mx my aw mz bi"><span id="0b41" class="na lc iq mv b gy nb nc l nd ne">notify-run register</span></pre><p id="35a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="me"> Windows用户:如果你使用了一个虚拟环境来安装notify-run，你可以在venv“Scripts”文件夹(venv\Scripts)中找到你的notify-run可执行文件，还有‘pip’、‘python’和‘easy _ install’。</em></p><p id="3418" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个很酷的包为你创造了一个渠道。运行该命令后，您将获得一个二维码和一个链接，将您的手机连接到新创建的频道</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/967fffd76281def62aa5fb3c946eda2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*x0VtNzPweNdIQgwV5ik7Rw.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">通知-运行产生的QR码</figcaption></figure><p id="8b2e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您的本地环境已经就绪。现在你只需要写代码。</p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="baa6" class="lb lc iq bd ld le mm lg lh li mn lk ll lm mo lo lp lq mp ls lt lu mq lw lx ly bi translated">代码</h1><p id="0910" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">如我所说，代码本身非常简单。我不太担心性能，因为我决定它应该每10分钟运行一次。站点本身是静态的，在请求发出后没有代码生成，所以这使得它更加容易。我唯一真正的挑战是让自己得到通知，其余的很容易。我先给出代码，然后再解释。</p><pre class="km kn ko kp gt mw mv mx my aw mz bi"><span id="d726" class="na lc iq mv b gy nb nc l nd ne">from urllib.request import urlopen<br/>from notify_run import Notify<br/>import re<br/>from time import sleep</span><span id="8a96" class="na lc iq mv b gy ng nc l nd ne">def notify_me(url):<br/>    # The notify-run object<br/>    notify = Notify()<br/>    data = (urlopen(url)).readlines()<br/><br/>    # A simple counter, to notify every 2 hours it's still alive<br/>    count = 0<br/>    # A first message, to check for the health of the channel.<br/>    notify.send('Starting notification process')<br/>    found = False<br/>    # try/finally so I would get notified if the script stopped<br/>    # for any reason.<br/>    try:<br/>        # A simple while, with a 2 hour health check.<br/>        while not found:<br/>            found = True<br/>            for line in data:<br/>                x = re.search('Closed sale', str(line))<br/>                if x:<br/>                    found = False<br/>                    break<br/>            sleep(600)<br/>            count += 600<br/>            if count &gt;= 7200:<br/>                # Notify me that the code is still running<br/>                notify.send('Alive, waiting for a change in the site.')<br/>                count = 0<br/>            data = (urlopen(url)).readlines()<br/>    finally:<br/>        # If we got here,I should buy the tickets,<br/>        # or something went wrong. Either way, I should check<br/>        notify.send('The site has changed! check it!')</span></pre><p id="70b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该功能有两个部分—第一部分是准备部分，第二部分是主循环，每2小时通知一次其健康状态。<br/>第一行很简单——定义通知对象。这个对象允许我们与之前注册的通知运行通道进行通信。<br/>然后，我们用<code class="fe ms mt mu mv b">urllib.requests</code>包打开页面，得到它。然后我们读取该对象的行，并将它们插入到数据中。<br/>第一个有趣的呼叫是<code class="fe ms mt mu mv b">notify.send('Starting')</code>呼叫。这里，我们向通道发送第一个通知。</p><p id="04de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这一部分，你的手机应该是这样的:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/42d99950ede6a0a996fb26bc326be2e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*4AQR8uDSvx2uLYsSNYd88w.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">第一个通知的屏幕截图</figcaption></figure><p id="0273" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一部分是一个简单的while循环。每隔10分钟(600秒)，下载网站，使用正则表达式包(re)遍历它，并检查确切的单词“Closed sale”。如果你找到他们，这意味着网站还没有改变，所以没有票。<br/>因此，每隔2小时，您就会看到以下通知:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/f9928b2944abf69155e4a576c547c559.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*vFDZjPXF925088O4H3gOqA.png"/></div></figure><p id="a1b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，如果“re”不能匹配这些单词，这意味着站点已经更改，while循环应该会中断，您会在手机上看到以下通知:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/6170c51126f348afba7179f423b474e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*VgQss2lnCgi5-MHrv-AK2Q.png"/></div></div></figure></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><p id="7063" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样！你已经做到了。现在，您可以创建自己的脚本来帮助自动购买您想要的演出和电影的门票。</p><p id="85a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果有任何问题，随时给我发消息！</p></div></div>    
</body>
</html>