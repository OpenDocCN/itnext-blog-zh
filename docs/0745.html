<html>
<head>
<title>How to mutate Arrays of Objects with vue-apollo</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用vue-apollo改变对象数组</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-mutate-arrays-of-objects-with-vue-apollo-26a3ed80ba76?source=collection_archive---------4-----------------------#2018-05-20">https://itnext.io/how-to-mutate-arrays-of-objects-with-vue-apollo-26a3ed80ba76?source=collection_archive---------4-----------------------#2018-05-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4a94f5fc3246aced57c75a68a110ab0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u476kHK476FEud2dLd9sbg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">你可以用<a class="ae kc" href="http://quasar-framework.org/" rel="noopener ugc nofollow" target="_blank"> Quasar框架</a> btw创建这样的界面。</figcaption></figure><p id="ede2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时候一个标题不足以解释一篇文章的上下文。这篇文章的一个更好的例子应该是“如何在Laravel GraphQL中用vue-apollo学习对象数组的变化”,但是解释一点代码太复杂了。</p><p id="2a50" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我试着写一些关于开发我的这个项目时出现的问题及其解决方案的文章。这一次，是数组的突变。</p><p id="9866" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在我的项目中使用Laravel，因为它的版本是4左右。所以这么久了，很难打破我们的联系。Vue.js允许我将视图从Laravel中分离出来，但它对API仍然很强大。另外，像我这样的开发人员很难在学习客户端技术的同时学习另一种后端技术。</p><p id="2e77" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是在我看来，学习GraphQL并不像学习一门新的编程语言那么难。有很好的资源，如GraphQL的<a class="ae kc" href="https://webonyx.github.io/graphql-php" rel="noopener ugc nofollow" target="_blank"> Webonyx </a> PHP实现和Laravel的<a class="ae kc" href="https://github.com/Folkloreatelier/laravel-graphql" rel="noopener ugc nofollow" target="_blank">民俗的</a>。我假设你已经很熟悉这些了，因为你已经耐心地读到这里了。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="8055" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我更喜欢使用<a class="ae kc" href="https://github.com/rebing/graphql-laravel" rel="noopener ugc nofollow" target="_blank"> rebing/graphql-laravel </a>，因为它比民俗的代码多了一些额外的东西。我想跳过安装、配置等部分。并且直接去编码；</p><p id="9bfc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是<strong class="kf ir"> config/graphql.php </strong>中的<em class="li">模式</em>键的例子，它有一个查询和变异定义；</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="83d7" class="ls lt iq lo b gy lu lv l lw lx"><strong class="lo ir">'system/translationManager'</strong> =&gt; [<br/>    <strong class="lo ir">'query'</strong> =&gt; [<br/>        <strong class="lo ir">'projects'</strong> =&gt; \App\GraphQL\Queries\System\TranslationManager\ProjectsQuery::class,<br/>    ],<br/>    <strong class="lo ir">'mutation'</strong> =&gt; [<br/>        <strong class="lo ir">'updateProject'</strong> =&gt; \App\GraphQL\Mutations\System\TranslationManager\Projects\UpdateProjectMutation::class<strong class="lo ir"><br/>    </strong>],<br/>    <strong class="lo ir">'middleware'</strong> =&gt; ['throttle']<br/>],</span></pre><p id="eb68" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从示例中可以看出，我的Laravel API有多个GraphQL端点。为了<em class="li">查询</em>或<em class="li">变异</em> <strong class="kf ir">项目</strong>在这个API中，当使用apollo方法时，<em class="li">/system/translation manager</em>后缀应该被添加到<em class="li"> /graphql </em> url。</p><p id="abf2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">项目查询只是服务于翻译项目数据，包括从数据透视表中收集的<strong class="kf ir"> id </strong>、<strong class="kf ir">名称</strong>、<strong class="kf ir">状态</strong>和<strong class="kf ir">地区列表</strong>。</p><p id="f7cb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在编辑项目Vue组件中，有一个包含在项目中的<strong class="kf ir">区域设置列表</strong>，用户可以添加/删除<strong class="kf ir">区域设置</strong>。下面是一个带有列表<strong class="kf ir">区域设置</strong>的项目数据示例；</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="fd69" class="ls lt iq lo b gy lu lv l lw lx"><strong class="lo ir">data</strong> () {<br/>  <strong class="lo ir">return</strong> {<br/>    <strong class="lo ir">id:</strong> 6,<br/>    <strong class="lo ir">name:</strong> 'My First Translation Project',<br/><strong class="lo ir">    status:</strong> 'active',<br/><strong class="lo ir">    locales:</strong> [<br/>      {<br/>       <strong class="lo ir">id:</strong> 2,<br/>       <strong class="lo ir">identifier:</strong> 'tr-TR',<br/>       <strong class="lo ir">description:</strong> 'Turkish (Turkey)'<br/>      }, {<br/><strong class="lo ir">       id:</strong> 3,<br/><strong class="lo ir">       identifier:</strong> 'en-GB',<br/><strong class="lo ir">       description:</strong> 'English (United Kingdom)'<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="7816" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设用户已经修改了数据，是时候更新模型了。第一件事是在Laravel中创建InputObject类型。但是为了给出更好的解释，我将首先给出查询和类型定义。</p><p id="3e63" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可能认为我已经有了在向客户端提供区域设置数据时已经使用的区域设置类型。那我们为什么需要另一种类型呢？但实际上，这种类型的语言环境只能提供数据。假设它是一个带有自定义getter/setter函数的Vue.js组件的计算数据。Laravel GraphQL中的查询类型是数组数据的getters，InputObject类型是数组数据的setters。</p><p id="3600" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里是Locales类型(getter)；</p><figure class="lj lk ll lm gt jr"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="bca8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是项目类型；</p><figure class="lj lk ll lm gt jr"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="e402" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在Projects Query中使用这两种类型，就在<em class="li"> config/graphql.php </em>中定义它们之后；</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="b2f3" class="ls lt iq lo b gy lu lv l lw lx">'types' =&gt; [<br/>    <strong class="lo ir">'locales_type'</strong> =&gt; \App\GraphQL\Types\System\Localization\LocalesType::class,<br/><br/>    <strong class="lo ir">'projects_type'</strong> =&gt; \App\GraphQL\Types\System\TranslationManager\ProjectsType::class<br/>],</span></pre><figure class="lj lk ll lm gt jr"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="cb2f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们准备定义InputObject类型的Locales(setter)；</p><figure class="lj lk ll lm gt jr"><div class="bz fp l di"><div class="ly lz l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">诀窍是$inputObject = true</figcaption></figure><p id="e268" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们应该把这个也添加到<em class="li"> config/graphql.php </em>中；</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="0cf5" class="ls lt iq lo b gy lu lv l lw lx">'types' =&gt; [<br/>    'locales_type' =&gt; \App\GraphQL\Types\System\Localization\LocalesType::class,</span><span id="0c74" class="ls lt iq lo b gy ma lv l lw lx"><strong class="lo ir">    'locales_input_object_type' =&gt; \App\GraphQL\Types\InputObjects\LocaleInputObjectType::class,</strong></span><span id="c11b" class="ls lt iq lo b gy ma lv l lw lx">    'projects_type' =&gt; \App\GraphQL\Types\System\TranslationManager\ProjectsType::class<br/>],</span></pre><p id="0eeb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在在UpdateProject变异中使用一切；</p><figure class="lj lk ll lm gt jr"><div class="bz fp l di"><div class="ly lz l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">不要忘记在<em class="mb"> config/graphql.php </em>中添加突变</figcaption></figure><p id="7335" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后一步是从我们的应用程序发送突变；</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="8ca2" class="ls lt iq lo b gy lu lv l lw lx"><strong class="lo ir">this</strong>.$apollo.mutate({<br/>  mutation: gql`mutation ($id:Int!, $name:String!, $status:String!, $locales:<strong class="lo ir">[LocaleInputObjectType]</strong>) {<br/>    updateProject (id:$id, name:$name, status:$status, locales:$locales) {<br/>      id<br/>      name,<br/>      status<br/>    }<br/>  }`,<br/>  variables: {<br/>    id: id,<br/>    name: name,<br/>    status: status,<br/>    <strong class="lo ir">locales: locales</strong><br/>  },<br/>  context: {<br/>    <strong class="lo ir">uri: process.env.API_URL + '/graphql/system/translationManager'</strong><br/>  }<br/>}).then((data) =&gt; {<br/>  console.log(data)<br/>}).catch((error) =&gt; {<br/>  console.error(error)<br/>})</span></pre></div></div>    
</body>
</html>