<html>
<head>
<title>“Magic Trick” of Galaxy App Booster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Galaxy App Booster的“魔术”</h1>
<blockquote>原文：<a href="https://itnext.io/magic-trick-of-galaxy-app-booster-684e1984576e?source=collection_archive---------1-----------------------#2020-11-25">https://itnext.io/magic-trick-of-galaxy-app-booster-684e1984576e?source=collection_archive---------1-----------------------#2020-11-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="822d" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated"><a class="ae kp" href="https://hubo.dev/2020-11-25-magic-tricks-of-samsung-app-booster-revealed/" rel="noopener ugc nofollow" target="_blank">之镜hubo.dev </a></p></blockquote><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi kq"><img src="../Images/428616245190a885babe66986acbcb99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*h4h6kN80OW81NCoNDNZxHQ.jpeg"/></div></figure><p id="99c7" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb ky kd ke kf kz kh ki kj la kl km kn ko ij bi translated">我碰巧尝试了一款名为<a class="ae kp" href="https://galaxystore.samsung.com/prepost/000004665772?appId=com.samsung.android.appbooster" rel="noopener ugc nofollow" target="_blank"> Galaxy App Booster </a>的应用，它是三星发布的<a class="ae kp" href="https://galaxystore.samsung.com/prepost/000004665763?appId=com.android.samsung.utilityapp" rel="noopener ugc nofollow" target="_blank"> Galaxy Labs </a>的一部分。它声称可以优化设备上的所有应用程序，并将整体性能提升5%至15%。它很有吸引力，许多用户也在非三星手机上使用它。</p><p id="045f" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb ky kd ke kf kz kh ki kj la kl km kn ko ij bi translated">它使用什么样的优化，如何估计改进？它只是做了一个虚假的工作，欺骗我们的思想吗？我决定研究一下里面的魔术。</p><h1 id="7a72" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">TLDR</h1><p id="4d8e" class="pw-post-body-paragraph jq jr iq jt b ju lz jw jx jy ma ka kb ky mb ke kf kz mc ki kj la md km kn ko ij bi translated">App Booster立即在所有应用上运行配置文件引导的编译。这可能会使一些应用程序在空闲维护模式下被操作系统优化之前运行得更快，这意味着可能需要几天时间。</p><h1 id="1004" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">得出源码</h1><p id="40d4" class="pw-post-body-paragraph jq jr iq jt b ju lz jw jx jy ma ka kb ky mb ke kf kz mc ki kj la md km kn ko ij bi translated">我从apkmirror获取了一个<a class="ae kp" href="https://www.apkmirror.com/apk/samsung-electronics-co-ltd/app-booster/" rel="noopener ugc nofollow" target="_blank"> apk文件</a>，然后使用<a class="ae kp" href="https://github.com/skylot/jadx" rel="noopener ugc nofollow" target="_blank"> jadx </a>对其进行反编译:</p><pre class="kr ks kt ku gt me mf mg mh aw mi bi"><span id="f9d1" class="mj lc iq mf b gy mk ml l mm mn">jadx -e -d booster app-booster.apk</span></pre><p id="de6c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb ky kd ke kf kz kh ki kj la kl km kn ko ij bi translated">虽然很混乱，但我可以在Android Studio中加载代码，并手动重命名主逻辑的类和方法。就变得容易理解了。</p><h1 id="6df1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">优化应用</h1><p id="8e95" class="pw-post-body-paragraph jq jr iq jt b ju lz jw jx jy ma ka kb ky mb ke kf kz mc ki kj la md km kn ko ij bi translated">当点击“立即优化”时，它会调用<code class="fe mo mp mq mf b">startCompileServices</code>:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="c56a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb ky kd ke kf kz kh ki kj la kl km kn ko ij bi translated"><code class="fe mo mp mq mf b">startCompileServices</code>启动编译服务:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="32ee" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb ky kd ke kf kz kh ki kj la kl km kn ko ij bi translated"><code class="fe mo mp mq mf b">OptimizeService</code>调用每个包上的<code class="fe mo mp mq mf b">cmd package compile -m speed-profile</code>:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="cc74" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb ky kd ke kf kz kh ki kj la kl km kn ko ij bi translated">对改善的估计很简单。如果之前没有完成完整的优化，则设置为15%。否则就是5%。</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mr ms l"/></div></figure><h1 id="b36f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">更多解释</h1><p id="7a58" class="pw-post-body-paragraph jq jr iq jt b ju lz jw jx jy ma ka kb ky mb ke kf kz mc ki kj la md km kn ko ij bi translated">从Android 7.0开始，Android运行时(ART)使用超前(AOT)编译、实时(JIT)编译和配置文件引导编译的混合组合。该组合是可配置的，典型模式使用以下流程，如<a class="ae kp" href="https://source.android.com/devices/tech/dalvik/configure#how_art_works" rel="noopener ugc nofollow" target="_blank">官方文件</a>中所述:</p><ol class=""><li id="3cb0" class="mt mu iq jt b ju jv jy jz ky mv kz mw la mx ko my mz na nb bi translated">应用程序最初安装时没有任何AOT编译。应用程序最初几次运行时，它将被解释，频繁执行的方法将被JIT编译。</li><li id="d27c" class="mt mu iq jt b ju nc jy nd ky ne kz nf la ng ko my mz na nb bi translated">当设备空闲和充电时，编译守护程序会运行，根据第一次运行时生成的配置文件对常用代码进行AOT编译。</li><li id="05f4" class="mt mu iq jt b ju nc jy nd ky ne kz nf la ng ko my mz na nb bi translated">应用程序的下一次重启将使用概要文件引导的代码，并避免在运行时对已经编译过的方法进行JIT编译。在新的运行过程中被JIT编译的方法将被添加到概要文件中，然后由编译守护进程获取。</li></ol><p id="a0c8" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb ky kd ke kf kz kh ki kj la kl km kn ko ij bi translated">App Booster使用的命令<code class="fe mo mp mq mf b">cmd package compile -m speed-profile</code>告诉编译器工具<code class="fe mo mp mq mf b">dex2oat</code>立即验证和AOT编译一个应用的概要文件中列出的方法，这与步骤2的工作相同。如果第二步没有被触发，速度差异是显而易见的，正如我在YouTube上找到的一个视频所示:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="nh ms l"/></div></figure><p id="bb2c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb ky kd ke kf kz kh ki kj la kl km kn ko ij bi translated">概要引导编译是一项强大的技术。Google Play甚至在去年推出了<a class="ae kp" href="https://android-developers.googleblog.com/2019/04/improving-app-performance-with-art.html" rel="noopener ugc nofollow" target="_blank">“Play Cloud中的艺术优化配置文件”</a>，它通过收集应用程序首次推出时的配置文件，在安装或更新时运行编译。如果应用程序是从Google Play下载的，那么App Booster的优势就不那么显著了。</p></div></div>    
</body>
</html>