<html>
<head>
<title>.NET Apps on DC/OS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">。DC操作系统上的网络应用</h1>
<blockquote>原文：<a href="https://itnext.io/net-apps-on-dc-os-137166c22335?source=collection_archive---------6-----------------------#2018-07-09">https://itnext.io/net-apps-on-dc-os-137166c22335?source=collection_archive---------6-----------------------#2018-07-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/cd21292b20e30ad7173fb6ba1554d6b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nm95Fc-cmb_gxCU13qIwtg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">资料来源:news.microsoft.com</figcaption></figure><p id="ffc6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">以一个重要的免责声明开始这篇文章。</p><blockquote class="la lb lc"><p id="d5ba" class="kc kd ld ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">免责声明:我绝不是. NET开发人员，也没有任何运行经验。我也不提倡你运行。网络应用。但我也不是说你不应该跑。网络应用。</p></blockquote><p id="0762" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我不认为自己是微软的粉丝，但我真的很喜欢微软在过去几年里做出的一些决定，更多地参与<a class="ae lh" href="https://opensource.microsoft.com" rel="noopener ugc nofollow" target="_blank">开源社区</a>(尽管我不得不承认，像许多其他人一样，我对Github的收购有点紧张)。我确实在我的一台个人电脑上使用了Windows 10，并且完全爱上了VSCode。几个月前，微软宣布你现在可以运行<a class="ae lh" href="https://docs.microsoft.com/en-us/dotnet/core/docker/intro-net-docker" rel="noopener ugc nofollow" target="_blank">。Docker </a>中的网络应用。</p><blockquote class="la lb lc"><p id="a5be" class="kc kd ld ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">“大多数映像存储库都提供了广泛的标记，以帮助您选择特定的框架版本和操作系统(Linux发行版或Windows版本)。”</p></blockquote><p id="160c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">厉害！既然我们能跑。NET应用程序，并使用Linux发行版，那么在我们最喜欢的容器编制器上运行这些程序怎么样，比如DC/操作系统？在这篇简短的帖子中，我将演示开箱即用是多么简单，并为您提供代码，让您跟随并亲自尝试。</p><div class="li lj gp gr lk ll"><a href="https://github.com/geekbass/dotnet-dcos" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab fo"><div class="ln ab lo cl cj lp"><h2 class="bd ir gy z fp lq fr fs lr fu fw ip bi translated">geekbass/dotnet-dcos</h2><div class="ls l"><h3 class="bd b gy z fp lq fr fs lr fu fw dk translated">dotnet-dcos -正在运行。DC操作系统上的网络应用</h3></div><div class="lt l"><p class="bd b dl z fp lq fr fs lr fu fw dk translated">github.com</p></div></div><div class="lu l"><div class="lv l lw lx ly lu lz jw ll"/></div></div></a></div></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><p id="46b0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">再说一遍，我并不是要提倡或者不提倡跑步。NET应用程序，或者在docker中，或者在容器编排平台上。这是关于能够在你喜欢的平台上为你的用户提供更多的服务和灵活性。</p><p id="8a8c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一天下午，我的一个朋友走过来对我说:“你知道你现在可以跑步了吗？Docker中的网络应用？我们应该看看能否在DC操作系统上运行它。”</p><p id="cf1b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当时，我不知道他是否真的是认真的。据我当时的理解，任何基于Windows容器的东西都需要Windows操作系统。所以我开始阅读他发给我的文章，我意识到你也可以在基于Nix的操作系统上运行它。干得好，女士团队！</p><p id="a680" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">开始阅读Docker Hub文档。NET Core 并在Mac上开发了方便的dandy Docker。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="d080" class="mq mr iq mm b gy ms mt l mu mv">docker run -it --rm -p 8000:80 --name aspnetcore_sample microsoft/dotnet-samples:aspnetapp<br/>Unable to find image 'microsoft/dotnet-samples:aspnetapp' locally<br/>aspnetapp: Pulling from microsoft/dotnet-samples<br/>683abbb4ea60: Pull complete<br/>a7e581c00d24: Pull complete<br/>5e5679988195: Pull complete<br/>799abad6ce99: Pull complete<br/>384fcf967d83: Pull complete<br/>dc6d19da5f5f: Pull complete<br/>Digest: sha256:14d97a040222d434a31e6db5706c9117ba2c006fb427e1e561e4d3650bf066d3<br/>Status: Downloaded newer image for microsoft/dotnet-samples:aspnetapp<br/>warn: Microsoft.AspNetCore.DataProtection.KeyManagement.XmlKeyManager[35]<br/>      No XML encryptor configured. Key {adfb2c92-2470-4fdc-964f-a42444bcf844} may be persisted to storage in unencrypted form.<br/>Hosting environment: Production<br/>Content root path: /app<br/>Now listening on: <a class="ae lh" href="http://[::]:80" rel="noopener ugc nofollow" target="_blank">http://[::]:80</a><br/>Application started. Press Ctrl+C to shut down.</span></pre><p id="738e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">打开我的浏览器到<a class="ae lh" href="http://0.0.0.0:8000" rel="noopener ugc nofollow" target="_blank">http://0 . 0 . 0:8000</a>就有了！</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/9fbd7ce981395a37943035d3cd041486.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KtEaTjxZxYGezWmmxU5Pkg.png"/></div></div></figure><p id="9a39" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我真的很震惊，它竟然这么容易就成功了。如果这真的能在我的Mac上运行，那么我看不出有什么理由不能在DC操作系统上运行。这实际上是Docker引擎的全部魔力。这才是真正需要的。</p><p id="f928" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在继续之前，我觉得我需要再次展示这个。</p><blockquote class="la lb lc"><p id="a1c0" class="kc kd ld ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">免责声明:我绝不是. NET开发人员，也没有任何运行经验。我也不提倡你运行。网络应用。但我也不是说你不应该跑。网络应用。</p></blockquote><p id="e1fd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我走到绘图板前，精心制作了以下马拉松式JSON来测试“真实世界”类型场景的真实部署:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="08b2" class="mq mr iq mm b gy ms mt l mu mv">{<br/>  "labels": {<br/>    "HAPROXY_GROUP": "external"<br/>  },<br/>  "id": "/dotnet",<br/>  "backoffFactor": 1.15,<br/>  "backoffSeconds": 1,<br/>  "container": {<br/>    "portMappings": [<br/>      {<br/>        "containerPort": 80,<br/>        "hostPort": 0,<br/>        "labels": {<br/>          "VIP_0": "/dotnet:8000"<br/>        },<br/>        "protocol": "tcp",<br/>        "servicePort": 10101,<br/>        "name": "dotnet"<br/>      },<br/>      {<br/>        "containerPort": 0,<br/>        "hostPort": 0,<br/>        "protocol": "tcp",<br/>        "servicePort": 10104<br/>      }<br/>    ],<br/>    "type": "DOCKER",<br/>    "volumes": [],<br/>    "docker": {<br/>      "image": "microsoft/dotnet-samples:aspnetapp",<br/>      "forcePullImage": false,<br/>      "privileged": false,<br/>      "parameters": []<br/>    }<br/>  },<br/>  "cpus": 0.5,<br/>  "disk": 0,<br/>  "healthChecks": [<br/>    {<br/>      "gracePeriodSeconds": 300,<br/>      "intervalSeconds": 60,<br/>      "maxConsecutiveFailures": 3,<br/>      "portIndex": 0,<br/>      "timeoutSeconds": 20,<br/>      "delaySeconds": 15,<br/>      "protocol": "MESOS_HTTP",<br/>      "path": "/",<br/>      "ipProtocol": "IPv4"<br/>    }<br/>  ],<br/>  "instances": 1,<br/>  "maxLaunchDelaySeconds": 3600,<br/>  "mem": 128,<br/>  "gpus": 0,<br/>  "networks": [<br/>    {<br/>      "mode": "container/bridge"<br/>    }<br/>  ],<br/>  "requirePorts": false,<br/>  "upgradeStrategy": {<br/>    "maximumOverCapacity": 1,<br/>    "minimumHealthCapacity": 1<br/>  },<br/>  "killSelection": "YOUNGEST_FIRST",<br/>  "unreachableStrategy": {<br/>    "inactiveAfterSeconds": 0,<br/>    "expungeAfterSeconds": 0<br/>  },<br/>  "fetch": [],<br/>  "constraints": []<br/>}</span></pre><p id="71f3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">以下JSON定义包括如下内容:</p><ul class=""><li id="163e" class="mx my iq ke b kf kg kj kk kn mz kr na kv nb kz nc nd ne nf bi translated">用于<a class="ae lh" href="https://docs.mesosphere.com/services/marathon-lb/" rel="noopener ugc nofollow" target="_blank">马拉松LB</a>(“ha proxy _ GROUP”:“external”和“service port”:10101)的标签和服务端口，因此用户可以从集群外部静态地访问它。</li><li id="325b" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nc nd ne nf bi translated">一个<a class="ae lh" href="https://docs.mesosphere.com/1.11/networking/load-balancing-vips/virtual-ip-addresses/" rel="noopener ugc nofollow" target="_blank"> VIP地址</a>，以便其他服务能够以静态方式与该服务交互(“端口映射”)。</li><li id="f523" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nc nd ne nf bi translated">健康检查这样，如果服务变得不健康，马拉松可以成功地编排服务。请参见JSON中的“健康检查”键。</li></ul><p id="3387" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们使用<a class="ae lh" href="https://docs.mesosphere.com/1.11/cli/" rel="noopener ugc nofollow" target="_blank">DC/操作系统CLI </a>来部署它吧！</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="e2c8" class="mq mr iq mm b gy ms mt l mu mv">dcos marathon app add dotnet.json</span></pre><p id="a82e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我现在可以通过我的公共代理运行我的马拉松LB应用程序来访问该应用程序！</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/3b074a8f4fd98cec7d804e448f9135fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RlHS1GcFY7LKH3HmYGcIQQ.png"/></div></div></figure><p id="bf71" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">缩放怎么样？没错。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="d82f" class="mq mr iq mm b gy ms mt l mu mv">dcos marathon app update dotnet instances=5</span></pre><p id="ffa1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我又一次可以击中。NET默认UI！而且，我总共只花了15分钟就到了这一步。酷！</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><p id="9d69" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">尽管这不是一个真正的应用程序，也没有实际运行的真正计划。在我们的环境中，你可以看到这个现实变得多么简单。在很短的时间内，我就能够得到一个功能齐全、可扩展的。运行在DC操作系统上的. NET应用程序。这可能会把我们引向这样一个场景:如果我们愿意，我们可以为用户提供这种能力。再次…</p><blockquote class="la lb lc"><p id="60e6" class="kc kd ld ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated"><strong class="ke ir">免责声明:我绝不是. NET开发人员，也没有任何运行经验。我也不提倡你运行。网络应用。但我也不是说你不应该跑。网络应用。</strong></p></blockquote><p id="31a5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">…并不是说你应该或不应该这样做。我保持开放的心态，支持在每一个独特的场景中都有意义的技术。我只是提供并展示了为用户提供更多服务的更大灵活性的能力(填写空白的“即服务”)。这就是我的全部。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><p id="1132" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我有几个人对此感兴趣，所以我写了这篇短文。我最初是为马拉松写的，但如果对在Kubernetes上跑步的例子有更多兴趣，请参见<a class="ae lh" href="https://github.com/geekbass/dotnet-dcos" rel="noopener ugc nofollow" target="_blank"> Github链接</a>(这也是DC/OS上支持的orchestrator)。</p></div></div>    
</body>
</html>