<html>
<head>
<title>Reduce the cost of your Kubernetes IaC infrastructure with these few steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过以下几个步骤降低Kubernetes IaC基础设施的成本</h1>
<blockquote>原文：<a href="https://itnext.io/reduce-the-cost-of-your-kubernetes-iac-infrastructure-with-these-few-steps-b4719940c491?source=collection_archive---------1-----------------------#2020-11-05">https://itnext.io/reduce-the-cost-of-your-kubernetes-iac-infrastructure-with-these-few-steps-b4719940c491?source=collection_archive---------1-----------------------#2020-11-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/4e89af6b9c45ae32b082388e431e1c32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vBvuPiZK9Ll2Rq2P4uiiDw.png"/></div></div></figure><p id="9387" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我清楚地记得在Loveholidays工作的激动人心的时刻，我自己的Kubernetes成本优化练习。我们热衷于一个精简的、吝啬的Kubernetes基础设施即代码(<strong class="kd iu"> DevOps </strong> ) <strong class="kd iu"> GitOps </strong>操作机器。</p><p id="0422" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">不在其中。</p><p id="d8f7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">(早在2018/19年)由于最近才从本地迁移到<strong class="kd iu">谷歌云平台</strong>以及云原生迁移，我们实际上接受了Kubernetes。现在迁移已经完成，是时候审查不断增长的Kubernetes基础设施成本，并制定一个良好的流程来控制如此重要的细节了。</p><h1 id="0c45" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">优化您的工作量</h1><p id="93ed" class="pw-post-body-paragraph kb kc it kd b ke mb kg kh ki mc kk kl km md ko kp kq me ks kt ku mf kw kx ky im bi translated">起初，降低成本的工作是有条不紊的。</p><p id="0746" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这绝不是成本优化的详尽列表，但它是开始的地方，以确保您的基础架构支出走了很长的路。</p><p id="888a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这些是我推荐的Kubernetes活动的上下文列表:</p><ul class=""><li id="8611" class="mg mh it kd b ke kf ki kj km mi kq mj ku mk ky ml mm mn mo bi translated"><strong class="kd iu">评估</strong><strong class="kd iu"/><strong class="kd iu">应用</strong>的工作负载和服务。这更像是对docker映像构建和应用程序堆栈的实际操作，但是基础架构团队和应用程序开发团队需要联合起来验证假设，并确定应用程序运行时需求。<br/>即哪些应用需要审查，哪些应用流程可以优化以修复任何mem漏洞。</li><li id="fef6" class="mg mh it kd b ke mp ki mq km mr kq ms ku mt ky ml mm mn mo bi translated">确保应用程序可以在docker基础映像占用空间最小的情况下运行。另一个最佳实践，值得重复。因此，您的安全状况应该会有所改善。但是它将有助于降低这种应用程序容器的总成本。</li><li id="7a28" class="mg mh it kd b ke mp ki mq km mr kq ms ku mt ky ml mm mn mo bi translated">这种工作负载评估和应用程序运行时的负载需求应该有助于<strong class="kd iu">定义</strong>Kubernetes部署<strong class="kd iu"> Pod </strong> <strong class="kd iu">内存</strong>和<strong class="kd iu"> CPU </strong> <code class="fe kz la lb lc b"><strong class="kd iu">quotas</strong></code>和<code class="fe kz la lb lc b"><strong class="kd iu">limits</strong></code>。这是为了防止虚假的资源流失，在这种情况下，现有的未检查的pod将耗尽它们运行的节点上的内存<em class="mu">(如果没有内存限制)</em>或抑制节点CPU <em class="mu">(如果没有CPU限制)</em>。<br/>这不仅仅影响了一个资源利用率未经检查的应用程序，还影响了在那个不幸的节点上运行的其他容器化服务。这会影响该节点上运行的其他服务，这可能会降低正常运行时间和相关的SLA。</li><li id="1eb6" class="mg mh it kd b ke mp ki mq km mr kq ms ku mt ky ml mm mn mo bi translated"><code class="fe kz la lb lc b">Taint</code>节点和<code class="fe kz la lb lc b">tolerate</code>那些有工作负载<code class="fe kz la lb lc b">tolerations.</code>的<code class="fe kz la lb lc b">taints</code>确保正确的工作负载在正确的机器类型上运行。我最近在这里写了这个。出色的图形突出了原因和方法。</li><li id="3e50" class="mg mh it kd b ke mp ki mq km mr kq ms ku mt ky ml mm mn mo bi translated">节点过度利用的影响可能会导致集群节点<strong class="kd iu">自动缩放器</strong>功能启动。此类活动将启动另一个完整的节点来调度您的工作负载，从而进一步增加您的集群成本。您可能希望再次依靠这些<code class="fe kz la lb lc b">taints</code>和<code class="fe kz la lb lc b">tolerations</code>来帮助减少上述几点的综合影响，不仅要在正确的CPU和内存匹配节点(<code class="fe kz la lb lc b">nodepool</code>)上调度工作负载，还要为<code class="fe kz la lb lc b">nodepool</code> <strong class="kd iu">大小设置</strong><strong class="kd iu">最小值</strong>、<strong class="kd iu">最大值</strong>。</li></ul><h1 id="4487" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">监控成本</h1><p id="cd62" class="pw-post-body-paragraph kb kc it kd b ke mb kg kh ki mc kk kl km md ko kp kq me ks kt ku mf kw kx ky im bi translated">面对共享、多租户集群操作环境的挑战，很难有效评估工作负载/命名空间的成本。公平地说，这种成本监控工作不是“我的例行任务”,也不是平台团队的责任。这是<a class="ae mv" href="https://www.finops.org/what-is-finops/" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> FinOps </strong> </a>的一个有趣领域，云基础设施成本的共同责任模型。</p><h2 id="b068" class="mw le it bd lf mx my dn lj mz na dp ln km nb nc lr kq nd ne lv ku nf ng lz nh bi translated">入门指南</h2><p id="05ed" class="pw-post-body-paragraph kb kc it kd b ke mb kg kh ki mc kk kl km md ko kp kq me ks kt ku mf kw kx ky im bi translated">这不需要太令人生畏，但你需要准备好所有的Kubernetes要素，至少要有Prometheus metrics aggregator和Grafana dashboard UI。</p><p id="70d6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我清楚地记得Grafana集群成本仪表板的伟大基础<a class="ae mv" href="https://grafana.com/grafana/dashboards/6873" rel="noopener ugc nofollow" target="_blank">这里</a>和<a class="ae mv" href="https://grafana.com/grafana/dashboards/8670" rel="noopener ugc nofollow" target="_blank">这里</a>非常有用。</p><p id="3a35" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你可以下载两者，它们当然是免费的，你可以调整<strong class="kd iu">网络</strong>、<strong class="kd iu"> CPU </strong>、<strong class="kd iu">存储</strong>和<strong class="kd iu">内存</strong>的费用以及延长使用的折扣。</p><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/9442784120f9668a55de6814675306da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K5HU08WN5vNM7WdAekC2XQ.png"/></div></div><figcaption class="nn no gj gh gi np nq bd b be z dk translated">每个云都有自己的成本指标，根据需要更新这些指标</figcaption></figure><p id="b418" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是一个反复出现的主题，我认为它是微服务Kubernetes环境中客户端业务需求的一部分。最近，我非常惊讶地发现<a class="ae mv" href="https://kubecost.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> Kubecost </strong> </a> <strong class="kd iu"> </strong>是<strong class="kd iu"> </strong>我过去使用的此类仪表板的提供商，他们的商业产品具有更多功能和多云端Kubernetes监控功能。Kubecost进一步扩展了这种Kubernetes工作量评估，以提供对成本分摊的更多了解。一个共享的名称空间<code class="fe kz la lb lc b">kube-system</code>就是这样一个例子，有许多部门利用该名称空间的服务。其成本可以归属于/分摊给消费团队。</p><p id="ad56" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">另一个奇妙的特性是<strong class="kd iu">预测</strong>功能，它可以显示基于<strong class="kd iu">月</strong>、<strong class="kd iu">日</strong>和<strong class="kd iu">小时</strong>消耗率<strong class="kd iu">、</strong>当前Kubernetes运行时间的预测，为新兴服务提供可预测的支出。</p><p id="03ce" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">到目前为止，这还不是所有特性的列表，但是其他值得注意的特性包括</p><ul class=""><li id="636d" class="mg mh it kd b ke kf ki kj km mi kq mj ku mk ky ml mm mn mo bi translated">关于预算支出通知的预警</li><li id="dec5" class="mg mh it kd b ke mp ki mq km mr kq ms ku mt ky ml mm mn mo bi translated">基础设施洞察</li><li id="f5a7" class="mg mh it kd b ke mp ki mq km mr kq ms ku mt ky ml mm mn mo bi translated">成本分配</li><li id="2ef5" class="mg mh it kd b ke mp ki mq km mr kq ms ku mt ky ml mm mn mo bi translated">基础设施可靠性得分</li></ul><p id="5b8d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当在Kubernetes地产上运行生产工作负载时，成本会快速上升。但这些都是我发现的方便的功能，可以让你重新控制支出，并具有很好的洞察力和可预测性。</p><p id="07c3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">那里。我发现你觉得它很有帮助。</p><p id="b015" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">祝您的集群成本优化之旅好运！</strong> <br/>喜欢，把知识分享转发给同事。</p><p id="039e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae mv" href="https://www.linkedin.com/in/johas/" rel="noopener ugc nofollow" target="_blank">在LinkedIn上连接</a> <br/>直到下次，</p><p id="22cf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">J</p></div></div>    
</body>
</html>