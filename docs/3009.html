<html>
<head>
<title>Adding a rain simulation to your iOS app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将雨模拟添加到您的iOS应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/add-a-rain-simulation-to-your-ios-app-eb596d41bf32?source=collection_archive---------8-----------------------#2019-09-14">https://itnext.io/add-a-rain-simulation-to-your-ios-app-eb596d41bf32?source=collection_archive---------8-----------------------#2019-09-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/d46360481f2db244965b82b42cf14259.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QLv1KTyzEQcBbRXXN_BhpA.jpeg"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://unsplash.com/photos/1vYkQVDWXl0" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/1vYkQVDWXl0</a></figcaption></figure><div class=""/><p id="3eaf" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过这篇文章，你将学习如何在你的iOS应用程序中添加一个<strong class="ki jk">真实的雨模拟</strong>。你将使用<strong class="ki jk"> SpriteKit </strong>:每个苹果操作系统中都包含的强大的2D游戏引擎。</p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div class="gh gi le"><img src="../Images/5c9961b22eb45c6fd6754f6e8470ee1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*ceg5-WQbNobr6VB5TN1HJw.gif"/></div></figure><p id="692e" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">好消息是，这是100%的本地代码，不需要第三方库。因此，您将能够将此效果添加到您的Swift原生应用程序中！</p><h1 id="ba15" class="lj lk jj bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">让我们造雨吧</h1><p id="23a6" class="pw-post-body-paragraph kg kh jj ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">用Xcode创建一个新的空白项目。</p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mm"><img src="../Images/aae1d99731cd7af7c927f4bfd21b207a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tZa6kqiAOBowV7DgUCV74Q.png"/></div></div></figure><p id="8fb0" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦项目被创建，在Xcode中选择<strong class="ki jk">文件</strong> &gt; <strong class="ki jk">新建</strong> &gt; <strong class="ki jk">文件</strong> &gt; <strong class="ki jk"> SpriteKit粒子文件</strong>。</p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mn"><img src="../Images/7d22484cf5e07a615bcb06e0bf793dae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TG0UV4AwzWdrykQX1ATc3A.png"/></div></div></figure><p id="ea30" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来选择<strong class="ki jk">雨</strong>。</p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mo"><img src="../Images/77b7fe2ecfff70fc384c3abed94f85cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zLN3qpMBLnI-Sblym_cz2Q.png"/></div></div></figure><p id="be11" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后按下<strong class="ki jk">下一步</strong>，给文件分配名称<strong class="ki jk"> Rain </strong>并保存到您的项目中。</p><h1 id="fc0a" class="lj lk jj bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">Xcode粒子发射器编辑器</h1><p id="36fa" class="pw-post-body-paragraph kg kh jj ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">Xcode提供了一个神奇的编辑器来自定粒子发射器。让我们看一看。选择<strong class="ki jk"> Rain.sks </strong>文件打开<em class="mp">粒子发射器编辑器</em>。</p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mq"><img src="../Images/e46e90c06e6bdb97ec76aec77a42c647.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fr4OZiBCQPP3b_G73BrRcw.png"/></div></div></figure><p id="b2f9" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后选择右边的<strong class="ki jk">属性检查器</strong>面板。</p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mq"><img src="../Images/a2183f641377c2ffe3a42f6d2b476fb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cdprHzFsjUd14bDijCaaYA.png"/></div></div></figure><p id="f1c8" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如你所看到的，粒子效果的预览显示在中央面板。你可以用右边的参数来玩，看看结果如何变化。</p><h1 id="1408" class="lj lk jj bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">自定义雨效果</h1><p id="a255" class="pw-post-body-paragraph kg kh jj ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">有一个变化，我们想应用到我们的雨效果。我们希望雨垂直落下，所以让我们把角度设置为270度。</p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mq"><img src="../Images/90bcec5ef0554f0cc1c8d5b2ab0104ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mlS8_oXj-_p-BB3D_ZzVhg.png"/></div></div></figure><p id="ff0a" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你再看一遍预览，你应该会看到雨垂直落在✅.的地面上</p><h1 id="2e71" class="lj lk jj bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">让我们编码</h1><p id="bdef" class="pw-post-body-paragraph kg kh jj ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">现在打开文件<strong class="ki jk"> ViewController.swift </strong>，用下面的代码替换它的内容。</p><pre class="lf lg lh li gt mr ms mt mu aw mv bi"><span id="6aaf" class="mw lk jj ms b gy mx my l mz na">import UIKit<br/>import SpriteKit</span><span id="4281" class="mw lk jj ms b gy nb my l mz na">class ViewController: UIViewController {<br/>    <br/>    let emitterNode = SKEmitterNode(fileNamed: "Rain.sks")!<br/>    <br/>    override func viewDidLoad() {<br/>        super.viewDidLoad()<br/>        addRain()<br/>    }<br/>    <br/>    private func addRain() {<br/>        let skView = SKView(frame: view.frame)<br/>        skView.backgroundColor = .clear<br/>        let scene = SKScene(size: view.frame.size)<br/>        scene.backgroundColor = .clear<br/>        skView.presentScene(scene)<br/>        skView.isUserInteractionEnabled = false<br/>        scene.anchorPoint = CGPoint(x: 0.5, y: 0.5)<br/>        scene.addChild(emitterNode)<br/>        emitterNode.position.y = scene.frame.maxY<br/>        emitterNode.particlePositionRange.dx = scene.frame.width<br/>        view.addSubview(skView)<br/>    }</span><span id="8fdd" class="mw lk jj ms b gy nb my l mz na">}</span></pre><p id="ecc8" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后将您的项目运行到模拟器中以检查结果。</p><p id="f01f" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你应该能看到下雨了👇</p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/1d4b45d67669d7aaacd2195bdb7882ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*lsRxu6Ri5Jgrgc1J0GrT4g.png"/></div></figure><h1 id="a467" class="lj lk jj bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">它是如何工作的？</h1><p id="c9cd" class="pw-post-body-paragraph kg kh jj ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">让我们分解一下我们添加到<strong class="ki jk"> ViewController.swift </strong>中的代码。</p><h2 id="a82f" class="mw lk jj bd ll nd ne dn lp nf ng dp lt kr nh ni lx kv nj nk mb kz nl nm mf nn bi translated">第一步</h2><p id="4b60" class="pw-post-body-paragraph kg kh jj ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">我们导入了SpriteKit框架来使用<strong class="ki jk"> SKEmitterNode </strong>类和其他一些很酷的工具。</p><pre class="lf lg lh li gt mr ms mt mu aw mv bi"><span id="68d0" class="mw lk jj ms b gy mx my l mz na">import SpriteKit</span></pre><h2 id="2c26" class="mw lk jj bd ll nd ne dn lp nf ng dp lt kr nh ni lx kv nj nk mb kz nl nm mf nn bi translated">第二步</h2><p id="b9a0" class="pw-post-body-paragraph kg kh jj ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">然后我们使用<strong class="ki jk"> Rain.sks </strong>文件创建了一个<strong class="ki jk"> SKEmitterNode </strong>。</p><pre class="lf lg lh li gt mr ms mt mu aw mv bi"><span id="1ea1" class="mw lk jj ms b gy mx my l mz na">let emitterNode = SKEmitterNode(fileNamed: "Rain.sks")!</span></pre><h2 id="bd4b" class="mw lk jj bd ll nd ne dn lp nf ng dp lt kr nh ni lx kv nj nk mb kz nl nm mf nn bi translated">第三步</h2><p id="15cd" class="pw-post-body-paragraph kg kh jj ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">最后，我们来看看<strong class="ki jk"> addRain() </strong>函数。我将代码分成4大块，以便更准确地描述这里发生的事情。</p><pre class="lf lg lh li gt mr ms mt mu aw mv bi"><span id="3133" class="mw lk jj ms b gy mx my l mz na">private func addRain() {</span><span id="b14a" class="mw lk jj ms b gy nb my l mz na">    // 1<br/>    let skView = SKView(frame: view.frame)<br/>    skView.backgroundColor = .clear<br/>    view.addSubview(skView)<br/>        <br/>    // 2<br/>    let scene = SKScene(size: view.frame.size)<br/>    scene.backgroundColor = .clear<br/>    scene.anchorPoint = CGPoint(x: 0.5, y: 0.5)<br/>    scene.addChild(emitterNode)<br/>        <br/>    // 3<br/>    skView.presentScene(scene)<br/>    skView.isUserInteractionEnabled = false</span><span id="cc85" class="mw lk jj ms b gy nb my l mz na">    // 4<br/>    emitterNode.position.y = scene.frame.maxY<br/>    emitterNode.particlePositionRange.dx = scene.frame.width</span><span id="0f64" class="mw lk jj ms b gy nb my l mz na">}</span></pre><ol class=""><li id="bca8" class="no np jj ki b kj kk kn ko kr nq kv nr kz ns ld nt nu nv nw bi translated">我们创建一个<strong class="ki jk"> SKView，</strong>一个由SpriteKit提供的<strong class="ki jk"> UIView </strong>的特殊子类。<br/>然后我们使背景透明，我们将视图添加到<strong class="ki jk"> UIViewController </strong>的主视图中。</li><li id="d291" class="no np jj ki b kj nx kn ny kr nz kv oa kz ob ld nt nu nv nw bi translated">这里我们创建一个场景，设置其背景为透明，设置锚点为(0.5，0.5)，最后添加EmitterNode(雨！)到现场。</li><li id="814c" class="no np jj ki b kj nx kn ny kr nz kv oa kz ob ld nt nu nv nw bi translated">这里，我们将场景呈现到SKView中(其用户交互被禁用)。</li><li id="0f66" class="no np jj ki b kj nx kn ny kr nz kv oa kz ob ld nt nu nv nw bi translated">最后，我们将粒子效果的发射器放置在屏幕的顶部，并使其与当前屏幕一样大。</li></ol><p id="c922" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就是这样。</p><h1 id="bb84" class="lj lk jj bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">最后润色</h1><p id="634a" class="pw-post-body-paragraph kg kh jj ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">如果您想更进一步，您可以使用storyboard向ViewController添加一个<strong class="ki jk"> UIButton </strong>和一个<strong class="ki jk"> UISlider </strong>。</p><p id="2309" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后将这两个方法添加到<strong class="ki jk"> ViewController.swift </strong>中</p><pre class="lf lg lh li gt mr ms mt mu aw mv bi"><span id="a769" class="mw lk jj ms b gy mx my l mz na">class ViewController: UIViewController {<br/>    ....</span><span id="28d4" class="mw lk jj ms b gy nb my l mz na">    @IBAction func didTapToggleRain(_ sender: UIButton) {<br/>        emitterNode.isHidden.toggle()<br/>    }<br/>    <br/>    @IBAction func didChangeSlider(_ slider: UISlider) {<br/>        emitterNode.particleSpeed = CGFloat(slider.value)<br/>    }</span><span id="1317" class="mw lk jj ms b gy nb my l mz na">}</span></pre><p id="f8f4" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，使用Storyboard将按钮的动作内的<strong class="ki jk"> Touch Up连接到第一个方法，并将UISlider的<strong class="ki jk">值已更改的</strong>动作连接到第二个方法。</strong></p><p id="7971" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在重新运行应用程序:</p><ul class=""><li id="c1f3" class="no np jj ki b kj kk kn ko kr nq kv nr kz ns ld oc nu nv nw bi translated">轻按按钮以显示/隐藏雨；</li><li id="901e" class="no np jj ki b kj nx kn ny kr nz kv oa kz ob ld oc nu nv nw bi translated">移动滑块以更改模拟的速度。</li></ul><h1 id="b6cf" class="lj lk jj bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">结论</h1><p id="f7ef" class="pw-post-body-paragraph kg kh jj ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">SpriteKit包含在Apple平台的以下版本中。</p><ul class=""><li id="4907" class="no np jj ki b kj kk kn ko kr nq kv nr kz ns ld oc nu nv nw bi translated">iOS 7.0以上</li><li id="1044" class="no np jj ki b kj nx kn ny kr nz kv oa kz ob ld oc nu nv nw bi translated">macOS 10.9以上</li><li id="b00b" class="no np jj ki b kj nx kn ny kr nz kv oa kz ob ld oc nu nv nw bi translated">Mac Catalyst 13.0+Beta</li><li id="9a26" class="no np jj ki b kj nx kn ny kr nz kv oa kz ob ld oc nu nv nw bi translated">tvOS 9.0以上</li><li id="ace4" class="no np jj ki b kj nx kn ny kr nz kv oa kz ob ld oc nu nv nw bi translated">watchOS 3.0+版</li></ul><p id="21fb" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在SpriteKit中有更多可用的粒子效果，你可以按照这里描述的步骤来创建火、雪和许多其他模拟，所以请随意尝试。</p></div></div>    
</body>
</html>