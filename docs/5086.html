<html>
<head>
<title>Theming your App in Flutter using BLoc, Save &amp; Reload</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Flutter中使用BLoc，Save &amp; Reload对你的应用程序进行主题化</h1>
<blockquote>原文：<a href="https://itnext.io/theming-your-app-in-flutter-using-bloc-save-reload-62048a330584?source=collection_archive---------3-----------------------#2020-12-07">https://itnext.io/theming-your-app-in-flutter-using-bloc-save-reload-62048a330584?source=collection_archive---------3-----------------------#2020-12-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="9bfb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们将看到如何使用BLoc在Flutter中为你的应用程序设置主题。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/6279bf75433139c889300f0475a79395.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ScLomog2mI_F4fWJ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">在Flutter中使用BLoC进行应用程序主题化</figcaption></figure><p id="3407" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要用一个真实世界的例子来理解BLoC，你可以参考我以前在BLoC上的帖子<a class="ae lb" href="https://medium.com/@vipinvijayan23/bloc-pattern-in-flutter-explained-with-real-example-f1af2568d32d" rel="noopener">这里</a>。</p><h1 id="b84c" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">第一部分</h1><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ma mb l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">颤动阻塞</figcaption></figure><h1 id="a553" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">第二部分</h1><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="aa9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于这个演示，我们还需要以下插件</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="e153" class="mh ld iq md b gy mi mj l mk ml">flutter_bloc: ^6.0.4<br/>equatable: ^1.2.4</span></pre><p id="b5d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你遵循我以前的教程，你也会很容易理解这篇文章。挺像的。</p><p id="9db9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们为我们的应用程序创建主题。</p><p id="0c05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mm">我们这里有两个主题……</em></p><ol class=""><li id="b613" class="mn mo iq jp b jq jr ju jv jy mp kc mq kg mr kk ms mt mu mv bi translated"><em class="mm">黑暗主题</em></li><li id="23c5" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated"><em class="mm">灯光主题</em></li></ol><p id="6f30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们创建一个名为“app_themes.dart”的新类，并声明我们的主题。</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="592f" class="mh ld iq md b gy mi mj l mk ml">import 'package:flutter/material.dart';class AppThemes {<br/>  static final appThemeData = {<br/>    AppTheme.lightTheme: ThemeData(<br/>      scaffoldBackgroundColor: Colors.white,<br/>      primarySwatch: Colors.blue,<br/>      backgroundColor: Colors.white,<br/>      textTheme: TextTheme(<br/>        bodyText1: TextStyle(<br/>          color: Colors.black,<br/>        ),<br/>      ),<br/>    ),<br/>    AppTheme.darkTheme: ThemeData(<br/>      scaffoldBackgroundColor: Colors.black,<br/>      primarySwatch: Colors.teal,<br/>      backgroundColor: Colors.black,<br/>      textTheme: TextTheme(<br/>        bodyText1: TextStyle(<br/>          color: Colors.white,<br/>        ),<br/>      ),<br/>    )<br/>  };<br/>}enum AppTheme {<br/>  lightTheme,<br/>  darkTheme,<br/>}</span></pre><p id="528b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以看到每个主题的不同属性有不同的颜色。</p><p id="4ddf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我们需要三样东西</p><ol class=""><li id="d04a" class="mn mo iq jp b jq jr ju jv jy mp kc mq kg mr kk ms mt mu mv bi translated"><em class="mm">阻塞</em></li><li id="779e" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated"><em class="mm">事件</em></li><li id="051f" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated"><em class="mm">状态</em></li></ol><p id="5ad5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该块将接受事件和状态，并输出新状态。</p><p id="269d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，我们将更新应用程序的主题，所以我们将添加一个主题更改事件，带有当前状态，我们将获得一个新的状态，这是一个新的主题。这就是整个想法。</p><p id="f39b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，让我们首先创建事件</p><p id="7889" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们这里只有一个活动</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="4691" class="mh ld iq md b gy mi mj l mk ml">class ThemeEvent {<br/>  final AppTheme appTheme;<br/>  ThemeEvent({this.appTheme});<br/>}</span></pre><p id="9af1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在国家，</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="8548" class="mh ld iq md b gy mi mj l mk ml">class ThemeState {<br/>  final ThemeData themeData;<br/>  ThemeState({this.themeData});<br/>}</span></pre><p id="2c3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后是集团</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="58fc" class="mh ld iq md b gy mi mj l mk ml">class ThemeBloc extends Bloc&lt;ThemeEvent, ThemeState&gt; {<br/>  //<br/>  ThemeBloc()<br/>      : super(<br/>          ThemeState(<br/>            themeData: AppThemes.appThemeData[AppTheme.lightTheme],<br/>          ),<br/>        );<a class="ae lb" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>  Stream&lt;ThemeState&gt; mapEventToState(ThemeEvent event) async* {<br/>    if (event is ThemeEvent) {<br/>      yield ThemeState(<br/>        themeData: AppThemes.appThemeData[event.appTheme],<br/>      );<br/>    }<br/>  }<br/>}</span></pre><p id="6bfd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里你可以看到我们正在发送一个<strong class="jp ir"> <em class="mm">初始状态</em> </strong>给</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="dce9" class="mh ld iq md b gy mi mj l mk ml">ThemeState(themeData: AppThemes.appThemeData[AppTheme.lightTheme])</span></pre><p id="fd91" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">而在<em class="mm"> mapEventToState </em>中，当用户触发了一个<strong class="jp ir"> <em class="mm"> ThemeEvent </em> </strong>时，我们会返回一个新的<strong class="jp ir"> <em class="mm"> ThemeState </em> </strong>。让我们看看我们能做些什么。</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="1208" class="mh ld iq md b gy mi mj l mk ml">AppTheme selectedTheme =<br/>        darkTheme ? AppTheme.lightTheme : AppTheme.darkTheme;<br/>context.bloc&lt;ThemeBloc&gt;().add(ThemeEvent(appTheme: selectedTheme));</span></pre><p id="902f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重要的部分来了…</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="e674" class="mh ld iq md b gy mi mj l mk ml">BlocProvider(<br/>      create: (context) =&gt; ThemeBloc(),<br/>      child: BlocBuilder&lt;ThemeBloc, ThemeState&gt;(<br/>        builder: (BuildContext context, ThemeState themeState) {<br/>          return MaterialApp(<br/>            title: 'Flutter Bloc Demo',<br/>            debugShowCheckedModeBanner: false,<br/>            theme: themeState.themeData,<br/>            home: AlbumsScreen(),<br/>          );<br/>        },<br/>      ),<br/>    );</span></pre><p id="6829" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你必须包装你的屏幕或你想要应用主题的部件。在这里，它将是我们的根小部件。在上面的代码中,‘albumscreen’是主屏幕，我们的根部件是材料部件。</p><p id="d53c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="5033" class="mh ld iq md b gy mi mj l mk ml">theme: themeState.themeData,</span></pre><p id="30f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是用户触发亮或暗主题时的新主题。</p><p id="1492" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，当我们通过调用下面的代码来更新主题时，上面的小部件就会被触发。</p><p id="dfce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在应用程序的其余部分，我们可以像这样使用这些。</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="5aad" class="mh ld iq md b gy mi mj l mk ml">backgroundColor: Theme.of(context).backgroundColor,</span></pre><p id="80cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">举个例子，</p><p id="3fe1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想创建一个应用了主题的文本小部件，它应该是这样的</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="9b35" class="mh ld iq md b gy mi mj l mk ml">import 'package:flutter/material.dart';class Txt extends StatelessWidget {<br/>  final String text;<br/>  Txt({<br/>    this.text = '',<br/>  });<br/>  <a class="ae lb" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>  Widget build(BuildContext context) {<br/>    return Container(<br/>      child: Text(<br/>        text,<br/>        style: TextStyle(<br/>          fontSize: 20,<br/>          color: Theme.of(context).textTheme.bodyText1.color,<br/>        ),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="8a24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无论你在哪里使用上面的小工具，都会应用合适的主题。</p><p id="70ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="mm">完整源代码</em> </strong></p><div class="nb nc gp gr nd ne"><a href="https://bitbucket.org/vipinvijayan1987/tutorialprojects/src/BlocSimple/" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">比特桶</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">编辑描述</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">bitbucket.org</p></div></div></div></a></div></div></div>    
</body>
</html>