<html>
<head>
<title>Stream data from Postgres to web using Go backend</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Go后端将数据从Postgres传输到web</h1>
<blockquote>原文：<a href="https://itnext.io/stream-data-from-postgres-to-web-using-go-backend-bd7d7527fe27?source=collection_archive---------1-----------------------#2021-01-20">https://itnext.io/stream-data-from-postgres-to-web-using-go-backend-bd7d7527fe27?source=collection_archive---------1-----------------------#2021-01-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b9e5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用服务器发送的事件(SSE)</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/40f14bb2e7240269f3e766b527670954.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XZSWQFDVYfqW1NU20SJo-w.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由Renee French创建的原始地鼠图像，使用由Maria Letta创建的地鼠图像</figcaption></figure><p id="6dfd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">撰写本文的目的只有一个:<strong class="la iu">向您展示如何将数据从数据库流式传输到web，</strong>一旦它们被插入到表中。</p><p id="991c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">这是一个完整的教程。</strong>我们将运行数据库并创建一个web服务器服务。该服务将创建一个新的数据库，直接从代码表。</p><p id="606d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这项服务有两个主要功能。第一个是将伪随机数据插入到已经创建的表中。第二个将等待这些新数据，然后将它们发送到浏览器。</p><p id="cab0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">这是一个充满具体例子的教程。</strong>你将学习如何在docker中运行数据库，如何从代码中创建数据库和表格。您还将学习如何设置Postgres以从中输出数据流。最后，您将学习如何接收数据并将它们发送到浏览器。</p><p id="e37c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们用Docker运行Postgres数据库，Go作为主要语言。也用了一点HTML和Javascript。Goland被用作首选IDE。</p><p id="fea0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个教程是基于其他人的工作，并且使用了已经写好的教程中的原则——链接如下。</p><div class="lu lv gp gr lw lx"><a href="https://medium.com/swlh/create-go-service-the-easy-way-de827d7f07cf" rel="noopener follow" target="_blank"><div class="ly ab fo"><div class="lz ab ma cl cj mb"><h2 class="bd iu gy z fp mc fr fs md fu fw is bi translated">以简单的方式创建Go服务</h2><div class="me l"><h3 class="bd b gy z fp mc fr fs md fu fw dk translated">适用于Windows、Linux、MacOS和Docker</h3></div><div class="mf l"><p class="bd b dl z fp mc fr fs md fu fw dk translated">medium.com</p></div></div><div class="mg l"><div class="mh l mi mj mk mg ml ks lx"/></div></div></a></div><p id="c579" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Github知识库的链接在文章的最后。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="c680" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">运行数据库</h1><p id="fd25" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">从在Docker中运行数据库开始，使用一个命令。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="f957" class="nv mu it nr b gy nw nx l ny nz">docker run --name postgres -e POSTGRES_PASSWORD=password -p 5433:5432 -v postgres_data:/var/lib/postgresql/data -d postgres:alpine</span></pre><p id="88dc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用<code class="fe oa ob oc nr b">docker stats</code>检查正在运行的数据库。如果有问题，将外部端口从<code class="fe oa ob oc nr b">5433</code>更改为另一个空闲端口。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="ed50" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">准备项目</h1><p id="8a2d" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">在Goland创建新项目，使用模块，并将项目命名为<strong class="la iu"> medium_streaming </strong>。</p><p id="73c5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">创建目录和文件，就像你在截图上看到的那样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ccff050c640b4b909b87ef3fd66c4b1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WQ4MafQ0CzgzUGGkWgjlBg.png"/></div></div></figure></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h2 id="4745" class="nv mu it bd mv od oe dn mz of og dp nd lh oh oi nf ll oj ok nh lp ol om nj on bi translated">更新homepage.html</h2><p id="1a9d" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">切换到<strong class="la iu">homepage.html</strong>，用下面的代码更新文件。这里没有什么特别的，我们将只使用<code class="fe oa ob oc nr b">&lt;div id=”content”&gt;&lt;/div&gt;</code>元素。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><h2 id="c931" class="nv mu it bd mv od oe dn mz of og dp nd lh oh oi nf ll oj ok nh lp ol om nj on bi translated">更新main.go</h2><p id="178e" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">切换到<strong class="la iu"> main.go </strong>并用下面的代码更新它。如果想要完整的解释，请使用文章开头的链接。</p><p id="5c79" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有三个<em class="oq">项目特定的</em>功能:</p><ul class=""><li id="4349" class="or os it la b lb lc le lf lh ot ll ou lp ov lt ow ox oy oz bi translated"><code class="fe oa ob oc nr b">checkDatabase()</code>:创建数据库和表格</li><li id="add2" class="or os it la b lb pa le pb lh pc ll pd lp pe lt ow ox oy oz bi translated"><code class="fe oa ob oc nr b">insertRandomDataToDatabase()</code>:将随机数据插入数据库</li><li id="000b" class="or os it la b lb pa le pb lh pc ll pd lp pe lt ow ox oy oz bi translated"><code class="fe oa ob oc nr b">streamDataToWebPage()</code>:将数据传输到浏览器</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="e1b8" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">实现正确的功能</h1><p id="0457" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">在<strong class="la iu"> main.go </strong>文件中有许多必须实现的函数。我们将在适当的文件中实现它们。</p><h2 id="33d6" class="nv mu it bd mv od oe dn mz of og dp nd lh oh oi nf ll oj ok nh lp ol om nj on bi translated">更新主页. go</h2><p id="d74a" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">这里我们实现了<code class="fe oa ob oc nr b">homepage()</code>函数，在这里我们简单地将<strong class="la iu">homepage.html</strong>文件提供给浏览器。仅此而已。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><h2 id="d3d6" class="nv mu it bd mv od oe dn mz of og dp nd lh oh oi nf ll oj ok nh lp ol om nj on bi translated">正在更新数据库。go</h2><p id="6daa" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">在这段代码中，我们实现了<code class="fe oa ob oc nr b">checkDatabase()</code>函数。这个函数创建名为<code class="fe oa ob oc nr b">medium</code>的数据库，然后创建表<code class="fe oa ob oc nr b">data</code>。该表的结构在<code class="fe oa ob oc nr b">type Data struct{}</code>中描述。</p><p id="f24b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个函数试图创建数据库和表。如果出现问题，该函数将等待一秒钟，然后再试一次。</p><p id="55eb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">创建数据库和表格后，有两个<code class="fe oa ob oc nr b">productionDatabase.Exec()</code>命令。这些命令是Postgres特有的。</p><p id="6479" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第一个创建了一个Postgres过程，其中您在<code class="fe oa ob oc nr b">data json; notification json;</code>中指定了通知的类型，在<code class="fe oa ob oc nr b">notification = json_build_object(‘data’, data);<br/>PERFORM pg_notify(‘events’, notification::text);</code>中指定了从Postgres发送的内容。</p><p id="06cb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第二个命令创建一个触发器:当表发生变化时，这个过程被触发。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="8629" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">数据流</h1><p id="0418" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">我们几乎完成了适当的后端功能。我们需要实现最后两个功能。</p><p id="ce47" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">切换到<strong class="la iu">流。转到</strong>并在下面插入代码。你可以看到，剩下的两个函数在这里实现。</p><p id="bffe" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe oa ob oc nr b">insertRandomDataToDatabase()</code>正如其名。该函数每秒钟用伪随机数据创建新记录。</p><p id="0d3d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第二个函数<code class="fe oa ob oc nr b">streamDataToWebPage()</code>做你所期望的。它正在等待Postgres通知，然后使用SSE将接收到的数据传输到浏览器。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="67fd" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">在浏览器中捕捉数据</h1><p id="60f8" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated"><em class="oq">大结局</em>来了。切换到<strong class="la iu"> homepage.js </strong>，插入下面的代码。这段代码等待来自<code class="fe oa ob oc nr b">sseStreamer.SendString(“data”, “data”, n.Extra)</code>的事件，然后用收到的内容更新<code class="fe oa ob oc nr b">&lt;div id=”content”&gt;&lt;/div&gt;</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="2276" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当您运行代码时——不要忘记在包模式下运行它——并在<a class="ae pf" href="http://localhost" rel="noopener ugc nofollow" target="_blank"> http://localhost </a>打开浏览器，您应该会看到结果。</p><p id="04fe" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">新记录保存到表中后，会立即从数据库通过Go后端传输到您的浏览器页面。</p><p id="6263" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在就看你了，用你喜欢的方式处理浏览器中的数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/81c2712a94f47dfa3bef85c9e959912b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*MV50Ldus6rU_XameCPIUyg.gif"/></div></div></figure></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="3697" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">摘要</h1><p id="8950" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">如果你全部阅读，全部编码，全部运行，你知道如何…</p><ul class=""><li id="d33c" class="or os it la b lb lc le lf lh ot ll ou lp ov lt ow ox oy oz bi translated">在Docker中运行Postgres数据库</li><li id="4022" class="or os it la b lb pa le pb lh pc ll pd lp pe lt ow ox oy oz bi translated">将此数据库设置为在更改时传输数据</li><li id="ba64" class="or os it la b lb pa le pb lh pc ll pd lp pe lt ow ox oy oz bi translated">在Go后端接收数据</li><li id="bd58" class="or os it la b lb pa le pb lh pc ll pd lp pe lt ow ox oy oz bi translated">将数据从Go后端发送到Javascript前端</li></ul><p id="b94e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">奖金:</strong>你知道，如何直接从代码创建数据库和表格。</p><div class="lu lv gp gr lw lx"><a href="https://github.com/petrjahoda/medium_streaming" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab fo"><div class="lz ab ma cl cj mb"><h2 class="bd iu gy z fp mc fr fs md fu fw is bi translated">petrjahoda/媒体流</h2><div class="me l"><h3 class="bd b gy z fp mc fr fs md fu fw dk translated">Permalink无法加载最新的提交信息。从Postgres到web的流数据，在后端使用Go…</h3></div><div class="mf l"><p class="bd b dl z fp mc fr fs md fu fw dk translated">github.com</p></div></div><div class="mg l"><div class="ph l mi mj mk mg ml ks lx"/></div></div></a></div></div></div>    
</body>
</html>