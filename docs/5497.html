<html>
<head>
<title>OutSystems Date &amp; Time handling</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">外部系统日期和时间处理</h1>
<blockquote>原文：<a href="https://itnext.io/outsystems-date-time-handling-a2d6e57eff8d?source=collection_archive---------6-----------------------#2021-03-17">https://itnext.io/outsystems-date-time-handling-a2d6e57eff8d?source=collection_archive---------6-----------------------#2021-03-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/283ed0f72b0c38748358e869785c35ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MMd-lfDX86DT6HsOV4Paqg.png"/></div></div></figure><p id="f6a6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">随着Mobile和后来的Reactive Web OutSystems的发布，他们改变了对客户端日期时间值的实现的看法。</p><p id="3954" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在过去，当只有(传统的)网络时，你必须<a class="ae kw" href="https://www.outsystems.com/forge/component-overview/500/time-zone" rel="noopener ugc nofollow" target="_blank">为运行在多个时区的应用程序实现你自己的功能</a>。随着Mobile(以及后来的Reactive Web)的发布，系统会为您处理多个时区，这对于开发人员来说应该是一个无忧的问题。</p><p id="e2ee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于OutSystems处理日期-时间值的不同方式之间存在差异，这意味着作为开发人员，您应该知道在每种类型的交互中日期-时间是如何处理的。</p><p id="5d03" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我已经执行了几次测试，以找出日期时间处理的不同之处。</p><p id="9a7a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，您可以看到我所执行的不同测试，如果您有急事的话，还可以在最后看到一个总结。</p><h2 id="1651" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">首先澄清一下我是如何执行不同的测试的</h2><p id="fa02" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">我的所有测试都将运行两个预定义的日期时间，与客户端选择的时区无关。一个测试默认行为(冬季时间)，另一个测试夏令时开启时的行为(夏季时间)。</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/bc75d55688200b48711a128edc42b569.png" data-original-src="https://miro.medium.com/v2/resize:fit:390/format:webp/1*vd6N5K0BSOPxpTbVNrXFXg.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">每个测试都使用默认测试集。</figcaption></figure><p id="2a16" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">服务器目前运行在CET时区(欧洲中部时间)，即UTC+01:00(阿姆斯特丹)，因为现在还是冬天。</p><p id="3baf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在夏季，服务器将改为夏令时(与冬季相差一小时)。在夏季，服务器更改为UTC+02:00，这与CEST(中欧夏令时)相关</p><blockquote class="me mf mg"><p id="1bc8" class="jy jz mh ka b kb kc kd ke kf kg kh ki mi kk kl km mj ko kp kq mk ks kt ku kv ij bi translated">如果<!-- -->你有能力自由决定在哪个时区运行你的服务器，保持在UTC，因为这是标准化的世界默认设置。</p></blockquote><p id="45c7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我在OutSystems数据库中创建了一个实体，它存储了我以不同方式保存的所有日期，以查看这些日期在不同应用程序类型和不同时区中的表现。</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/5d8d9bed159e2de20d563b8b7b0159fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*XRmWB2oHpgFjfqoq6coypw.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">几次测试后的数据</figcaption></figure><h2 id="1ae7" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">1:传统网络</h2><p id="d1dc" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">我从浏览器中创建了一个新记录，它在UTC+01:00运行。</p><p id="6d52" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">保存值后，数据库显示与输入值相同的日期。</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/86bb6ac2f488ab2293774798080f0851.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*-euSsEF1PALS88OS_sLOSA.png"/></div></figure><p id="84fd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过Microsoft Windows时区设置将客户端时区从UTC+01:00(阿姆斯特丹)更改为UTC+04:30(喀布尔),不会改变任何功能。结果与上面相同。这意味着系统只知道服务器端的时区。</p><h2 id="d472" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">2:反应式网络和移动(工作方式相同)</h2><p id="2f3f" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">我从浏览器中创建了一个新记录，它在UTC+01:00运行。</p><p id="2b89" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">保存值后，数据库显示与输入值相同的日期，因为客户端和服务器位于同一时区。</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/b91dcaf3b964cda9d422e848426b4a8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*X7fxWz-67Ny7r6E0KUf9Bw.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">保存后在数据库中的表示。</figcaption></figure><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mo"><img src="../Images/dd0df157b1b6f4010ab9b1b0847312f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ST_jeV6pJgmSkq46zZjMg.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">上面创建的记录的反应式Web应用程序表示。</figcaption></figure><p id="5f70" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我将时区更改为UTC+04:30(喀布尔)时，您可以直接看到客户端表示的变化。</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/b3fa368ace4ed1f5fba1a51a7d744808.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7Yz7mWjvm7MybFYXBRrv0g.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">更改为不同时区后的反应式Web应用程序表示。</figcaption></figure><p id="7e74" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">乍一看，很奇怪，当我把时区从UTC+1:00改为UTC+4:30时，CEST只相差2:30小时。这是因为阿姆斯特丹实行夏令时，而喀布尔没有。这意味着在夏季，UTC+2:00(夏令时校正)和UTC+4:30之间只有2:30小时的差异。</p><h2 id="0181" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated"><strong class="ak"> 3:休息终点</strong></h2><p id="c216" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">REST端点对日期时间字段使用<a class="ae kw" href="https://www.iso.org/iso-8601-date-and-time-format.html" rel="noopener ugc nofollow" target="_blank"> ISO 8601日期&amp;时间</a>格式。</p><p id="98e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我创建了一个将数据发送到外部系统的POST方法和一个从外部系统读取数据的GET方法。</p><p id="014a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了发送数据，我必须将日期时间格式化为ISO 8601格式。有两种方法可以做到这一点:不添加时区的UTC和添加本地时区的Date time。</p><p id="8378" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于第一个测试，我以UTC默认格式发送数据:</p><ul class=""><li id="543e" class="mq mr iq ka b kb kc kf kg kj ms kn mt kr mu kv mv mw mx my bi translated">2020–08–01t 14:00:00Z(等于2020–08–01t 14:00:00+00:00)</li></ul><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/e12a9d7df0d765f96c0c526e6094838f.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*e4_MKp3h8Fs1U74A2sW4Ig.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">协调世界时ISO 8601的结果</figcaption></figure><p id="ceeb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如您在图像中看到的，日期和时间字段从UTC转换为本地时区(1或2小时加到该值上)。这是意料之中的，因为服务器在这个时区运行。</p><p id="da94" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于第二个测试，我以实际的服务器时区格式发送数据:</p><ul class=""><li id="17c6" class="mq mr iq ka b kb kc kf kg kj ms kn mt kr mu kv mv mw mx my bi translated">2020–08–01t 14:00:00+02:00(夏季)</li><li id="02b2" class="mq mr iq ka b kb na kf nb kj nc kn nd kr ne kv mv mw mx my bi translated">2020–12–01t 14:00:00+01:00(冬季)</li></ul><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/3c4334df6dc082e15f1fdb48163872e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*zyNFHAQ5-4wQNKC6BOKJYQ.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">本地时区中ISO 8601的结果</figcaption></figure><p id="e94e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如您所见，这些日期也被外部系统成功接受。</p><p id="fc7d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于REST端点的最后一个测试，我通过一个REST方法从数据库中读取数据，这个REST方法是我之前通过REST发送的。</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/073f701c3239f29efec73ca56826552f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*1Lv_g22wKoHK4Xbu1P99Zw.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">通过REST的所有输出都转换为ISO 8601 UTC符号。</figcaption></figure><p id="f906" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这些结果中，您还可以从第一个响应中看到DateTime值被转换回UTC。第二个响应需要多一点理解，因为它的输出方式与输入方式不同。时间以Z而不是+0100结束，这是UTC表示法而不是时区表示法。</p><p id="26ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当存储在数据库中时，不保存符号(+0100或Z)的上下文，并且当DateTime字段稍后通过REST输出时，您需要一个统一的符号，而不是基于它如何被发送到数据库的符号。由于这两种符号只是在视觉上不同，而不是在技术上不同，所以对于从REST方法中读取或写入日期的系统来说，这应该不是问题。</p><h2 id="33be" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">摘要</h2><p id="b5c1" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">传统的Web只有一个事实，那就是服务器上配置的日期和时间。你做的一切都是在那个时区。</p><p id="b30d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当数据在客户端和服务器端之间传输时，Reactive Web和Mobile会自动转换日期和时间。客户端遵循客户端设备(pc、笔记本电脑、平板电脑或手机)上配置的日期、时间和时区。客户端一收到数据，日期就被转换为本地时区。请记住，计时器&amp;进程确实在服务器上运行，并且是根据服务器时区设置运行的。</p><p id="18b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">REST方法有一个关于DateTime字段的独立转换。这里所有的日期时间都转换为UTC，与客户端或服务器端的时区配置无关。这是传出数据的默认值。对于传入的数据，系统可以处理每个日期时间值，只要它是ISO8601格式的</p><h2 id="d42e" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">最后的忠告</h2><p id="a7fd" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">当在一个在不同时区有办公室或客户的国际组织中处理日期和时间时，我强烈建议从一个反应式Web模板启动您的应用程序。日期和时间功能的易用性以及系统从您手中接过的任务比传统的Web模板所能提供的功能要好。</p></div></div>    
</body>
</html>