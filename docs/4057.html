<html>
<head>
<title>Stitching Kubernetes, Jenkins, SonarQube, and GitHub using KubeSphere</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用KubeSphere拼接Kubernetes、Jenkins、SonarQube和GitHub</h1>
<blockquote>原文：<a href="https://itnext.io/stitching-kubernetes-jenkins-sonarqube-and-github-using-kubesphere-567ee413f8dd?source=collection_archive---------2-----------------------#2020-04-18">https://itnext.io/stitching-kubernetes-jenkins-sonarqube-and-github-using-kubesphere-567ee413f8dd?source=collection_archive---------2-----------------------#2020-04-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a8035cebac13236ab2767e35d25f9387.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SM9eso5vp_9kxwezuYAYWQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">KubeSphere DevOps工作流程</figcaption></figure><p id="a10c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在本教程中，我们将向您展示如何从GitHub存储库中基于Jenkinsfile创建CI/CD管道。我们使用<a class="ae la" href="https://github.com/kubesphere/kubesphere" rel="noopener ugc nofollow" target="_blank"> KubeSphere Contain平台</a>来实现这个工作流。使用管道，我们将把SpringBoot应用程序分别部署到开发环境和生产环境中。</p><p id="5f0a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">同时，我们将演示一个用于测试依赖缓存能力的分支。在这个演示中，第一次完成管道需要相对较长的时间。但是，从那以后它跑得非常快。它证明了缓存工作良好，因为这个分支最初从互联网拉了很多依赖。</p><blockquote class="lb lc ld"><p id="0c5c" class="kc kd le ke b kf kg kh ki kj kk kl km lf ko kp kq lg ks kt ku lh kw kx ky kz ij bi translated"><em class="iq">注:</em></p><p id="8bdb" class="kc kd le ke b kf kg kh ki kj kk kl km lf ko kp kq lg ks kt ku lh kw kx ky kz ij bi translated"><em class="iq"> KubeSphere支持两种管道，即本文介绍的SCM中的Jenkinsfile和SCM外的</em><a class="ae la" href="https://kubesphere.io/docs/quick-start/jenkinsfile-out-of-scm" rel="noopener ugc nofollow" target="_blank"><strong class="ke ir"><em class="iq">Jenkins file</em></strong></a><em class="iq">。SCM中的Jenkinsfile需要源代码管理(SCM)中的内部Jenkinsfile。换句话说，Jenkfinsfile是SCM的一部分。KubeSphere DevOps系统将根据代码库现有的Jenkinsfile自动构建CI/CD管道。您可以定义工作流，如管道中的阶段、步骤和作业。</em></p></blockquote><h1 id="7840" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">先决条件</h1><ul class=""><li id="91c6" class="mg mh iq ke b kf mi kj mj kn mk kr ml kv mm kz mn mo mp mq bi translated">您需要<a class="ae la" href="https://kubesphere.io/docs/installation/install-devops" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir">启用KubeSphere DevOps系统</strong> </a>。</li><li id="d9d9" class="mg mh iq ke b kf mr kj ms kn mt kr mu kv mv kz mn mo mp mq bi translated">您需要有一个DokcerHub帐户和一个GitHub帐户。</li><li id="08da" class="mg mh iq ke b kf mr kj ms kn mt kr mu kv mv kz mn mo mp mq bi translated">您需要创建一个工作区、一个DevOps项目和一个项目常规用户帐户，并且需要邀请该帐户加入DevOps项目，请参见<a class="ae la" href="https://kubesphere.io/docs/quick-start/admin-quick-start" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir">多租户管理入门</strong> </a>。</li><li id="0792" class="mg mh iq ke b kf mr kj ms kn mt kr mu kv mv kz mn mo mp mq bi translated">为构建管道设置CI专用节点，请参见<a class="ae la" href="https://kubesphere.io/docs/devops/devops-ci-node" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir">为依赖缓存设置CI节点</strong> </a>。</li></ul><h1 id="9c38" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">管道概述</h1><p id="66db" class="pw-post-body-paragraph kc kd iq ke b kf mi kh ki kj mj kl km kn mw kp kq kr mx kt ku kv my kx ky kz ij bi translated">在将要演示的管道中有八个阶段，如下所示。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/75465a0d6f5919fa40dcd46ec97d74db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9EfGyrRxJezaKeRIRejAHw.png"/></div></div></figure><blockquote class="lb lc ld"><p id="ed22" class="kc kd le ke b kf kg kh ki kj kk kl km lf ko kp kq lg ks kt ku lh kw kx ky kz ij bi translated"><em class="iq">注:</em></p></blockquote><ul class=""><li id="09df" class="mg mh iq ke b kf kg kj kk kn ne kr nf kv ng kz mn mo mp mq bi translated">第一阶段。签出SCM:从GitHub库签出源代码。</li><li id="60d7" class="mg mh iq ke b kf mr kj ms kn mt kr mu kv mv kz mn mo mp mq bi translated">第二阶段。单元测试:单元测试通过后，继续执行下一阶段。</li><li id="84ae" class="mg mh iq ke b kf mr kj ms kn mt kr mu kv mv kz mn mo mp mq bi translated">第三阶段。sonar cube分析:处理sonar cube代码质量分析。</li><li id="2bae" class="mg mh iq ke b kf mr kj ms kn mt kr mu kv mv kz mn mo mp mq bi translated">第四阶段。构建和推送快照映像:基于行为策略中选择的分支构建映像。将<code class="fe nh ni nj nk b">SNAPSHOT-$BRANCH_NAME-$BUILD_NUMBER</code>标签推送到DockerHub，其中<code class="fe nh ni nj nk b">$BUILD_NUMBER</code>是流水线活动列表中的操作序列号。</li><li id="e687" class="mg mh iq ke b kf mr kj ms kn mt kr mu kv mv kz mn mo mp mq bi translated">第五阶段。推送最新图像:将主分支标记为最新，并将其推送到DockerHub。</li><li id="d593" class="mg mh iq ke b kf mr kj ms kn mt kr mu kv mv kz mn mo mp mq bi translated">第六阶段。部署到开发环境:将主分支部署到开发环境。这个阶段需要验证。</li><li id="693d" class="mg mh iq ke b kf mr kj ms kn mt kr mu kv mv kz mn mo mp mq bi translated">第七阶段。带标签的推送:生成标签并发布到GitHub。然后将标签推送到DockerHub。</li><li id="a0e5" class="mg mh iq ke b kf mr kj ms kn mt kr mu kv mv kz mn mo mp mq bi translated">第八阶段。部署到生产环境:将发布的标签部署到生产环境中。</li></ul><h1 id="c94a" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">动手实验</h1><h1 id="f9d0" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">步骤1:创建凭据</h1><blockquote class="lb lc ld"><p id="abc5" class="kc kd le ke b kf kg kh ki kj kk kl km lf ko kp kq lg ks kt ku lh kw kx ky kz ij bi translated"><em class="iq">注意:如果您的账户或密码中有特殊字符，请使用</em><a class="ae la" href="https://www.urlencoder.org/" rel="noopener ugc nofollow" target="_blank"><strong class="ke ir"><em class="iq">【https://www.urlencoder.org/】</em></strong></a><em class="iq">进行编码，然后将编码结果粘贴到下面的凭证中。</em></p></blockquote><p id="ed6b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">1.1.使用<code class="fe nh ni nj nk b">project-regular</code>账号登录KubeSphere，进入已创建的DevOps项目，在项目管理→凭证下创建以下三个凭证:</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/f3359ff650747411b413457b87b2a4ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*laWQuFLLaQCrpuSfO3_Xag.png"/></div></div></figure><p id="fe8a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">1.2.我们需要为sonar cube令牌创建一个额外的凭证<code class="fe nh ni nj nk b">sonar-token</code>，它在上面提到的阶段3(sonar cube分析)中使用。参考<a class="ae la" href="https://kubesphere.io/docs/installation/install-sonarqube" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir">访问SonarQube控制台并创建令牌</strong> </a>复制令牌并粘贴到此处。然后按确定按钮。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/3e71b841d95ad73ef200d159010111fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JkJ7sPB3k38-7T8E.png"/></div></div></figure><p id="36cf" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这一步中，我们总共创建了四个凭证。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/fa532823c447853fbce1aac7d2f666cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EbC3njMwDZYA9YlM.png"/></div></div></figure><h1 id="47b4" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">步骤2:修改存储库中的Jenkinsfile</h1><h2 id="57a3" class="no lj iq bd lk np nq dn lo nr ns dp ls kn nt nu lw kr nv nw ma kv nx ny me nz bi translated">分叉项目</h2><p id="5d08" class="pw-post-body-paragraph kc kd iq ke b kf mi kh ki kj mj kl km kn mw kp kq kr mx kt ku kv my kx ky kz ij bi translated">登录GitHub。将GitHub资源库中的<a class="ae la" href="https://github.com/kubesphere/devops-java-sample" rel="noopener ugc nofollow" target="_blank"><strong class="ke ir">devo PS-Java-sample</strong></a>分支到您自己的GitHub中。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/a0d276ceceb464fc32599c537caa291b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VKHGilHGJAvMrVIu"/></div></div></figure><h2 id="b3fb" class="no lj iq bd lk np nq dn lo nr ns dp ls kn nt nu lw kr nv nw ma kv nx ny me nz bi translated">编辑Jenkinsfile</h2><p id="f5b0" class="pw-post-body-paragraph kc kd iq ke b kf mi kh ki kj mj kl km kn mw kp kq kr mx kt ku kv my kx ky kz ij bi translated">2.1.将存储库分叉到您自己的GitHub之后，打开根目录下的文件Jenkinsfile-online。</p><p id="d3b6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">2.2.在GitHub UI中点击编辑图标，编辑环境变量的值。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ob"><img src="../Images/ec1d2718eabbe0782ac7d4135107f9db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*roG9bWa1IMbbXSkJy2OIWw.png"/></div></div></figure><blockquote class="lb lc ld"><p id="e409" class="kc kd le ke b kf kg kh ki kj kk kl km lf ko kp kq lg ks kt ku lh kw kx ky kz ij bi translated">注意:Jenkinsfile的<code class="fe nh ni nj nk b">mvn</code>命令参数<code class="fe nh ni nj nk b">-o</code>表示离线模式开启。本教程下载了相关的依赖项，以节省时间并适应特定环境下的网络干扰。默认情况下，脱机模式是打开的。</p></blockquote><p id="1ce1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">2.3.编辑完环境变量后，单击GitHub页面顶部的Commit changes，然后将更新提交到主分支。</p><h1 id="852d" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">步骤3:创建项目</h1><p id="0eb5" class="pw-post-body-paragraph kc kd iq ke b kf mi kh ki kj mj kl km kn mw kp kq kr mx kt ku kv my kx ky kz ij bi translated">在这一步中，我们将创建两个项目，即<code class="fe nh ni nj nk b">kubesphere-sample-dev</code>和<code class="fe nh ni nj nk b">kubesphere-sample-prod</code>，分别是开发环境和生产环境。</p><h2 id="e205" class="no lj iq bd lk np nq dn lo nr ns dp ls kn nt nu lw kr nv nw ma kv nx ny me nz bi translated">创建第一个项目</h2><blockquote class="lb lc ld"><p id="28a3" class="kc kd le ke b kf kg kh ki kj kk kl km lf ko kp kq lg ks kt ku lh kw kx ky kz ij bi translated"><em class="iq">提示:账户</em> <code class="fe nh ni nj nk b"><em class="iq">project-admin</em></code> <em class="iq">应提前创建，因为它被用作CI/CD管道的审核人。</em></p></blockquote><p id="7d00" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">3.1.使用账号<code class="fe nh ni nj nk b">project-admin</code>登录KubeSphere。单击“创建”按钮，然后选择“创建资源项目”。填写项目的基本信息。完成后单击下一步。</p><ul class=""><li id="9223" class="mg mh iq ke b kf kg kj kk kn ne kr nf kv ng kz mn mo mp mq bi translated">姓名:<code class="fe nh ni nj nk b">kubesphere-sample-dev</code>。</li><li id="95ec" class="mg mh iq ke b kf mr kj ms kn mt kr mu kv mv kz mn mo mp mq bi translated">别名:<code class="fe nh ni nj nk b">development environment</code>。</li></ul><p id="acdb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">3.2.保留高级设置的默认值。单击创建。</p><p id="a33f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">3.3.现在邀请<code class="fe nh ni nj nk b">project-regular</code>用户加入<code class="fe nh ni nj nk b">kubesphere-sample-dev</code>。选择项目设置→项目成员。点击邀请成员以邀请<code class="fe nh ni nj nk b">project-regular</code>，并授予该帐户<code class="fe nh ni nj nk b">operator</code>的角色。</p><h2 id="26a8" class="no lj iq bd lk np nq dn lo nr ns dp ls kn nt nu lw kr nv nw ma kv nx ny me nz bi translated">创建第二个项目</h2><p id="9217" class="pw-post-body-paragraph kc kd iq ke b kf mi kh ki kj mj kl km kn mw kp kq kr mx kt ku kv my kx ky kz ij bi translated">类似地，按照上面的步骤创建一个名为<code class="fe nh ni nj nk b">kubesphere-sample-prod</code>的项目。这个项目是生产环境。然后邀请<code class="fe nh ni nj nk b">project-regular</code>加入<code class="fe nh ni nj nk b">kubesphere-sample-prod</code>的项目，并授予其<code class="fe nh ni nj nk b">operator</code>的角色。</p><blockquote class="lb lc ld"><p id="f148" class="kc kd le ke b kf kg kh ki kj kk kl km lf ko kp kq lg ks kt ku lh kw kx ky kz ij bi translated"><em class="iq">注:CI/CD管道成功时。您将看到演示应用程序的部署和服务已经分别部署到</em> <code class="fe nh ni nj nk b"><em class="iq">kubesphere-sample-dev</em></code> <em class="iq">和</em> <code class="fe nh ni nj nk b"><em class="iq">kubesphere-sample-prod.</em></code> <em class="iq">中。</em></p></blockquote><h1 id="c91d" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">步骤4:创建管道</h1><h2 id="fb3c" class="no lj iq bd lk np nq dn lo nr ns dp ls kn nt nu lw kr nv nw ma kv nx ny me nz bi translated">填写基本信息</h2><p id="8fe9" class="pw-post-body-paragraph kc kd iq ke b kf mi kh ki kj mj kl km kn mw kp kq kr mx kt ku kv my kx ky kz ij bi translated">4.1.将登录用户切换到<code class="fe nh ni nj nk b">project-regular</code>。进入DevOps项目<code class="fe nh ni nj nk b">demo-devops</code>。按一下「建立」( Create)来建立新的管线。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/3cf2d804bcc808fb34e8585ca3b43e4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EvrK5PX_cry0QhXy.png"/></div></div></figure><p id="f539" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">4.2.在弹出窗口中填写管道的基本信息，命名为<code class="fe nh ni nj nk b">jenkinsfile-in-scm</code>，点击代码库。</p><h2 id="4606" class="no lj iq bd lk np nq dn lo nr ns dp ls kn nt nu lw kr nv nw ma kv nx ny me nz bi translated">添加存储库</h2><p id="6220" class="pw-post-body-paragraph kc kd iq ke b kf mi kh ki kj mj kl km kn mw kp kq kr mx kt ku kv my kx ky kz ij bi translated">4.3.如果您没有GitHub令牌，请单击“获取令牌”来生成新的GitHub令牌。然后将令牌粘贴到编辑框中。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/dd0b142483aec3be8351defdebda3aa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ih7hqsr5QQazpLHI.png"/></div></div></figure><p id="2bb4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">4.4.点击确认，选择你的账户。与该令牌相关的所有代码库将在右侧列出。选择devops-java-sample并单击选择此存储库，然后单击下一步。</p><h2 id="54ac" class="no lj iq bd lk np nq dn lo nr ns dp ls kn nt nu lw kr nv nw ma kv nx ny me nz bi translated">高级设置</h2><p id="7e46" class="pw-post-body-paragraph kc kd iq ke b kf mi kh ki kj mj kl km kn mw kp kq kr mx kt ku kv my kx ky kz ij bi translated">现在我们在高级设置页面。</p><p id="3dc7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">4.5.在行为策略上，KubeSphere pipeline默认设置了三种策略。由于本演示没有应用从Forks发现PR的策略，因此可以删除该策略。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/83b26a087b8b63b82ef9723c37ec59c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bX7KyanH68Dxggu7.png"/></div></div></figure><p id="b1ec" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">4.6.默认情况下，路径是Jenkinsfile。请将其更改为<code class="fe nh ni nj nk b">Jenkinsfile-online</code>，这是位于根目录的存储库中的Jenkinsfile的文件名。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oe"><img src="../Images/0011f15f6ade140bfe36f4af0a72db8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ntm3b5SEHu0v4m-QwfOLFQ.png"/></div></div></figure><blockquote class="lb lc ld"><p id="fac4" class="kc kd le ke b kf kg kh ki kj kk kl km lf ko kp kq lg ks kt ku lh kw kx ky kz ij bi translated"><em class="iq">注意:脚本路径是代码库中的Jenkinsfile路径。它表示存储库的根目录。如果文件位置改变，脚本路径也应该改变。</em></p></blockquote><p id="eaeb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">4.7.可以根据团队的开发偏好定制扫描回购触发器。我们将其设置为<code class="fe nh ni nj nk b">5 minutes</code>。完成高级设置后，单击创建。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/460eed2de7191f8232b6cbc99162c751.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YQ2psnm5uNzGp8nV.png"/></div></div></figure><h2 id="5863" class="no lj iq bd lk np nq dn lo nr ns dp ls kn nt nu lw kr nv nw ma kv nx ny me nz bi translated">运行管道</h2><p id="8675" class="pw-post-body-paragraph kc kd iq ke b kf mi kh ki kj mj kl km kn mw kp kq kr mx kt ku kv my kx ky kz ij bi translated">手动刷新浏览器或者你可能需要点击<code class="fe nh ni nj nk b">Scan Repository</code>，然后你可以找到两个被触发的活动。或者您可能希望按照以下说明手动触发它们。</p><p id="9125" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">4.8.单击右侧的运行。根据行为策略，它将加载具有Jenkinsfile的分支。只保留默认分支<code class="fe nh ni nj nk b">master</code>。因为在Jenkinsfile文件中没有默认值，所以在TAG_NAME中放入一个标记号，比如<code class="fe nh ni nj nk b">v0.0.1</code>。单击确定触发新的活动。</p><blockquote class="lb lc ld"><p id="d882" class="kc kd le ke b kf kg kh ki kj kk kl km lf ko kp kq lg ks kt ku lh kw kx ky kz ij bi translated"><em class="iq">注意:TAG_NAME用于在GitHub和DockerHub中生成带有TAG的release和images。请注意</em> <code class="fe nh ni nj nk b"><em class="iq">TAG_NAME</em></code> <em class="iq">不要重复代码库中已有的</em> <code class="fe nh ni nj nk b"><em class="iq">tag</em></code> <em class="iq">名称。否则管道不能运行。</em></p></blockquote><p id="c1a6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">此时，主分支的管道正在运行。</p><blockquote class="lb lc ld"><p id="52cc" class="kc kd le ke b kf kg kh ki kj kk kl km lf ko kp kq lg ks kt ku lh kw kx ky kz ij bi translated"><em class="iq">注:点击分支切换到分支列表，查看哪些分支正在运行。这里的分支是由行为策略决定的。</em></p></blockquote><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi of"><img src="../Images/673c23057b2bc24bf6b1477c984d3f80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*puSZUwTu0QV82-2OoasSRA.png"/></div></div></figure><h2 id="7db0" class="no lj iq bd lk np nq dn lo nr ns dp ls kn nt nu lw kr nv nw ma kv nx ny me nz bi translated">审核渠道</h2><p id="fd49" class="pw-post-body-paragraph kc kd iq ke b kf mi kh ki kj mj kl km kn mw kp kq kr mx kt ku kv my kx ky kz ij bi translated">当流水线运行到<code class="fe nh ni nj nk b">input</code>步时，它将暂停。您需要手动点按“继续”。请注意，在Jenkinsfile-online中定义了三个阶段。因此，在<code class="fe nh ni nj nk b">deploy to dev, push with tag, deploy to production</code>的三个阶段中，将对管道进行三次审查。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/5921bcbd67838e3ff59df05bf90f7d63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H3nKDXSvgjjg35FtPTjKrw.png"/></div></div></figure><pre class="na nb nc nd gt oh nk oi oj aw ok bi"><span id="ef2b" class="no lj iq nk b gy ol om l on oo">···<br/>input(id: 'release-image-with-tag', message: 'release image with tag?', submitter: 'project-admin,project-admin1')<br/>···</span></pre><h1 id="be06" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">步骤5:检查管道状态</h1><p id="f8de" class="pw-post-body-paragraph kc kd iq ke b kf mi kh ki kj mj kl km kn mw kp kq kr mx kt ku kv my kx ky kz ij bi translated">5.1.点击进入活动→主→任务状态，可以看到流水线运行状态。请注意，当创建刚刚完成时，管道将持续初始化几分钟。样本管道中有八个阶段，它们已在<a class="ae la" href="https://github.com/kubesphere/devops-java-sample/blob/master/Jenkinsfile-online" rel="noopener ugc nofollow" target="_blank"><strong class="ke ir">Jenkins file-online</strong></a>中分别定义。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi op"><img src="../Images/3c72c8d5af7c2b02d582e851e1b04fd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f8RAGFX-UThUa69Pt-ScxA.png"/></div></div></figure><p id="aef8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">5.2.通过单击右上角的显示日志来检查管道运行日志。该页面显示动态日志输出、运行状态和时间等。</p><p id="0fb2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">对于每个步骤，单击左侧的特定阶段以检查日志。可以将日志下载到本地以供进一步分析。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oq"><img src="../Images/dcf4f5cfdbf4de506d20f38ee20f08d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*w2p-kiHJ2OQmzkEV.png"/></div></div></figure><h1 id="69e9" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">步骤6:验证管道运行结果</h1><p id="bf6c" class="pw-post-body-paragraph kc kd iq ke b kf mi kh ki kj mj kl km kn mw kp kq kr mx kt ku kv my kx ky kz ij bi translated">6.1.成功执行管道后，点击<code class="fe nh ni nj nk b">Code Quality</code>通过SonarQube检查结果如下(仅供参考)。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/8831aee7908b75137c6d0ee87bde68d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JtCFu01TVGBVok5A.png"/></div></div></figure><p id="70b6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">6.2.由于我们在Jenkinsfile-online中定义了<code class="fe nh ni nj nk b">push to DockerHub</code> stage，管道构建的Docker映像已经成功推送到DockerHub。在DockerHub中，您会发现我们在运行管道之前配置的标签为v0.0.1的图像，您还会发现标签为<code class="fe nh ni nj nk b">SNAPSHOT-master-6</code>(快照-分支-序列号)和<code class="fe nh ni nj nk b">latest</code>的图像已被推送到DockerHub。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi or"><img src="../Images/5cba5dc5c6f6deb258eaafae10b2c432.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dg81N7UdHJdV1eN7_hb9rQ.png"/></div></div></figure><p id="1b99" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">与此同时，GitHub中已经生成了一个新标签和一个新版本。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi os"><img src="../Images/1e4bdc83b2f8bd3951b65b410a6767b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VFhfc9MtJgqPbDdr.png"/></div></div></figure><p id="8406" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">示例应用程序将作为部署和服务部署到<code class="fe nh ni nj nk b">kubesphere-sample-dev</code>和<code class="fe nh ni nj nk b">kubesphere-sample-prod</code>。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ot"><img src="../Images/84e1ee3d449223d4243178f4246762b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C56j34IOObhvkur2rp_D3A.png"/></div></div></figure><p id="f9d9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">6.3.进入这两个项目，你会发现应用程序的资源已经成功地部署到Kubernetes。例如，让我们验证项目<code class="fe nh ni nj nk b">kubesphere-sample-dev</code>下的部署和服务:</p><h2 id="6256" class="no lj iq bd lk np nq dn lo nr ns dp ls kn nt nu lw kr nv nw ma kv nx ny me nz bi translated">部署</h2><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ou"><img src="../Images/1ad2074414e02b86d56852d897a5d077.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RoMkeEiryLE5LQ_r3omsxg.png"/></div></div></figure><h2 id="704a" class="no lj iq bd lk np nq dn lo nr ns dp ls kn nt nu lw kr nv nw ma kv nx ny me nz bi translated">服务</h2><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi of"><img src="../Images/3d179ccf58cd6e2967a3d927f5a77d72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D9lUWHj-Y_e0jFIlCQHduA.png"/></div></div></figure><h1 id="3346" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">步骤7:访问示例服务</h1><p id="cbb9" class="pw-post-body-paragraph kc kd iq ke b kf mi kh ki kj mj kl km kn mw kp kq kr mx kt ku kv my kx ky kz ij bi translated">7.1.可以切换使用<code class="fe nh ni nj nk b">admin</code>账号从工具箱打开web kubectl。进入项目<code class="fe nh ni nj nk b">kubesphere-sample-dev</code>，选择应用工作负载→服务，点击进入<code class="fe nh ni nj nk b">ks-sample-dev</code>服务。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ov"><img src="../Images/7840ba38beb8191685116c402239e6de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0YxszMiLlWJWx8GX4h0aBA.png"/></div></div></figure><p id="8522" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">7.2.从工具箱中打开web kubectl，尝试以如下方式访问:</p><blockquote class="lb lc ld"><p id="95e0" class="kc kd le ke b kf kg kh ki kj kk kl km lf ko kp kq lg ks kt ku lh kw kx ky kz ij bi translated"><em class="iq">注意:您可以请求端点或{ $虚拟IP }:{ $端口}或{ $节点IP }:{ $节点端口} </em></p></blockquote><pre class="na nb nc nd gt oh nk oi oj aw ok bi"><span id="f305" class="no lj iq nk b gy ol om l on oo">$ curl 10.233.90.9:8080<br/>Really appreciate your star, that's the power of our life.</span></pre><p id="15e2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">7.3.类似地，您可以在项目<code class="fe nh ni nj nk b">kubesphere-sample-pro</code>中测试服务</p><blockquote class="lb lc ld"><p id="e640" class="kc kd le ke b kf kg kh ki kj kk kl km lf ko kp kq lg ks kt ku lh kw kx ky kz ij bi translated"><em class="iq">注:curl端点或{ $虚拟IP }:{ $端口}或{ $节点IP }:{ $节点端口} </em></p></blockquote><pre class="na nb nc nd gt oh nk oi oj aw ok bi"><span id="5819" class="no lj iq nk b gy ol om l on oo">$ curl 10.233.90.17:8080<br/>Really appreciate your star, that's the power of our life.</span></pre><p id="fa39" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">配置！您已经熟悉KubeSphere DevOps pipeline，您可以在下一个教程中继续学习如何使用图形面板构建CI/CD pipeline并可视化您的工作流。</p></div></div>    
</body>
</html>