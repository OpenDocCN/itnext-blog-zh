<html>
<head>
<title>An easy way to switch between dark and light theme in Flutter.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Flutter中切换明暗主题的简单方法。</h1>
<blockquote>原文：<a href="https://itnext.io/an-easy-way-to-switch-between-dark-and-light-theme-in-flutter-fb971155eefe?source=collection_archive---------0-----------------------#2020-05-03">https://itnext.io/an-easy-way-to-switch-between-dark-and-light-theme-in-flutter-fb971155eefe?source=collection_archive---------0-----------------------#2020-05-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="4fd7" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">C <!-- -->在运行时挂起主题并持久化它总是令人头疼… <br/>但现在不需要了，不需要Bloc也不需要Provider逻辑，这是最简单的方法...</p></blockquote><h2 id="092c" class="kp kq iq bd kr ks kt dn ku kv kw dp kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">我们开始吧</h2><p id="e16b" class="pw-post-body-paragraph jq jr iq jt b ju ll jw jx jy lm ka kb ky ln ke kf lc lo ki kj lg lp km kn ko ij bi translated">我们通常以此为切入点来运行我们的应用程序，一个主要的无状态小部件app返回MaterialApp，当然还有一个home小部件(在我们的例子中是HomePage())返回一个带有floatingActionButton的脚手架…</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/b064071989c983118315f9cf170cbdaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*sDkPqWXrgjmUVoes_AW4EQ.png"/></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk translated">主.镖</figcaption></figure><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/15721ba37500998676fa3ca3ddf96cc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*CZKbgN-bHMcFgc7cBdiIzw.png"/></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk translated">主页. dart</figcaption></figure><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi md"><img src="../Images/d3148625ee13cd7772adfceaacfb5a45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ezc9WI3V-chg6nPk03UC9w.png"/></div></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk translated">PS:我在Linux上运行的是flutter。</figcaption></figure><p id="2ffc" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb ky kd ke kf lc kh ki kj lg kl km kn ko ij bi translated">在运行时改变主题需要更新主题数据，使用Bloc可能会简化它，但是你需要先学习Bloc是如何工作的，你应该把这个逻辑安装到你的大脑中，然后……然后...</p><blockquote class="jn jo jp"><p id="55b2" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">没有人:<br/>我:</p></blockquote><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/ba1eda36529a01e7975d681b938ebbdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*izJ0MzWUhF4M00huy9lu6g.png"/></div></figure><p id="65df" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb ky kd ke kf lc kh ki kj lg kl km kn ko ij bi translated">呃！我没说过我懒得做这种事吗？我只是一个直爽的人，我看到简单，我就喊“是”。所以我们的当务之急是找到我们小小的大脑可以支持的东西，我们应该找到一种不需要任何外部库就能打开后门的方法…</p><p id="7880" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb ky kd ke kf lc kh ki kj lg kl km kn ko ij bi translated">所以boiz，让我们认真一点，dart有一个叫做<a class="ae mj" href="https://api.flutter.dev/flutter/foundation/ChangeNotifier/notifyListeners.html" rel="noopener ugc nofollow" target="_blank"> NotifyListeners </a>的东西，这个巫毒的东西会在对象上注册监听器，并在对象改变时通知每个人，这实际上是很有趣的东西……我们必须在我们的情况下使用它。</p><p id="818a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb ky kd ke kf lc kh ki kj lg kl km kn ko ij bi translated">让我们创建一个名为“MyTheme”的新类，并添加这个巫毒</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/79d79f8b0097af80b4d01131f7b6e77d.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*UzDDeGILmnQJ2kSrLoXBMA.png"/></div></figure><p id="b5cf" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb ky kd ke kf lc kh ki kj lg kl km kn ko ij bi translated">让我们添加一个名为isDark的变量并将其设置为false，然后添加两个函数，一个用于检索ThemeMode，另一个用于切换isDark并通知侦听器。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/aefc149243085a4b933eaf58c2f22109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*gE0mLerI6_KlMfNT0PFqBA.png"/></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk translated">主题.镖</figcaption></figure><p id="b5e6" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb ky kd ke kf lc kh ki kj lg kl km kn ko ij bi translated">我们现在只需要创建一个实例，并让它在我们的应用程序中随处可见。因此，让我们创建一个新的dart文件，将其命名为config.dart，然后添加以下几行。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/ddec7761e256d25361d2950069c51c2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*LW4lOXU7jLH7m7O2RppsjA.png"/></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk translated">config.dart</figcaption></figure><p id="1c50" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb ky kd ke kf lc kh ki kj lg kl km kn ko ij bi translated">好了，我们可以通过导入config.dart在任何地方访问该变量，让我们返回main.dart并做一些更改… <br/>我将把应用程序小部件从无状态更改为有状态，添加一个带有侦听器的initState、一个浅色主题、一个深色主题和主题模式，如下所示。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/0144398a89e134d7be5bd0a88ec733b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*K9yXmJJ3K9XaoKwQX0BY0Q.png"/></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk translated">主.镖</figcaption></figure><p id="f9fe" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb ky kd ke kf lc kh ki kj lg kl km kn ko ij bi translated">这就是我们的技巧，我们将注册一个侦听器，它将在当前主题更改时发出通知，我们将添加一个setState来更新应用程序的状态，以使更改生效，我们将使用方法currentTheme()从我们的对象中获取我们的themeMode。设置完成后，我们应该从home_page.dart编辑我们的floatingActionButton，并在那里添加“currentTheme.switchTheme()”。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/6e6ac16e32a5eb8c8703459e6f09b11f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*HxnDEs9TqUIrkEbwxxMpZw.png"/></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk translated">在从home_page.dart压缩的上浮动ActionButton</figcaption></figure><p id="04be" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb ky kd ke kf lc kh ki kj lg kl km kn ko ij bi translated">现在一切都很好，我们应该能够取得这样的结果</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/7814cb3b05c6a820481574ea401dfa64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*qT_aCUVKfO8cKvMFrDsJ7g.gif"/></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk translated">结果呢</figcaption></figure><p id="b497" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb ky kd ke kf lc kh ki kj lg kl km kn ko ij bi translated">关于持久化选中的主题，我们可以使用<a class="ae mj" href="https://pub.dev/packages/shared_preferences" rel="noopener ugc nofollow" target="_blank"> shared_preferences </a>或<a class="ae mj" href="https://pub.dev/packages/hive" rel="noopener ugc nofollow" target="_blank"> hive </a>或任何其他可以持久化内容的工具……我将坚持使用hive。<br/>我们将在config.dart中添加一个新的全局变量，将该变量导入main，在第一次启动时初始化并编辑theme.dart…</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/d511840ca6a20bc0a1d92c429f4cbd7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*ppJhUNJ4fWOqQLT6Fga2QQ.png"/></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk translated">config.dart</figcaption></figure><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/8ef0d8f63418504fe347851c39f1bdbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*vW1LqJTR6OuySpz5CJ3XFg.png"/></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk translated">主.镖</figcaption></figure><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/fe97f3b669a3a4aa8c9d6deca510e00b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/format:webp/1*809yIlpYmKYZx4uH0EzYgw.png"/></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk translated">主题.镖</figcaption></figure><p id="79b2" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb ky kd ke kf lc kh ki kj lg kl km kn ko ij bi translated">就这样，我们现在都设置好了，你应该有一个持久的主题和一个黑暗和光明模式的切换器:)</p></div></div>    
</body>
</html>