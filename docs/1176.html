<html>
<head>
<title>Home Volume Control: Go+VueJS = R&amp;R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">家庭音量控制:Go+VueJS = R&amp;R</h1>
<blockquote>原文：<a href="https://itnext.io/home-volume-control-go-vuejs-r-r-151ff030ffa8?source=collection_archive---------2-----------------------#2018-08-05">https://itnext.io/home-volume-control-go-vuejs-r-r-151ff030ffa8?source=collection_archive---------2-----------------------#2018-08-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="1857" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Golang &amp; Vue中的一个自我发现的无配置家庭音量控制系统。射流研究…</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/ef8b7bafecd28a2653ae78435e5012a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8aM9MDF7uHppmcHnr8_q2w.jpeg"/></div></div></figure><p id="2aad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如今，在大多数家庭中，我们都有一些供孩子使用的家用电脑、一些笔记本电脑和几部平板电脑/手机。现在，当你想休息的时候，试着让他们都按下音量降低按钮……一个自我发现的分布式服务来控制房间的音量怎么样？…我是否听到有人说:“给我们一些时髦的用户界面来遥控我们的孩子”？你的愿望就是我的命令。</p><p id="2d15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">时不时地，我会渴望编写一个代码项目，它将作为新技术的试验场，并让我接触到我不会探索的问题和想法。我真的很喜欢Golang呈现小型自包含服务的能力，它在一个小的exe文件中包含了REST后端和Web服务器(以及html/js的公共目录)，我也很喜欢VueJS同样的简单性，它没有任何问题，只需要一个html文件就可以完成所有事情。我想通过构建一个小型的家庭项目来测试这个想法，我还探索了网络服务发现，只是为了增加趣味。我以后可能会把这个实验应用到手机或渐进式网络应用中。</p><p id="1f72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个项目的完整源代码可以在<a class="ae kx" href="https://github.com/amitbet/kid-control" rel="noopener ugc nofollow" target="_blank">我的github </a>页面找到。</p><h2 id="58ba" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">服务发现选项:</h2><ul class=""><li id="747a" class="lr ls iq jp b jq lt ju lu jy lv kc lw kg lx kk ly lz ma mb bi translated">SSDP: <a class="ae kx" href="https://en.wikipedia.org/wiki/Simple_Service_Discovery_Protocol" rel="noopener ugc nofollow" target="_blank">简单服务发现协议</a> ( <a class="ae kx" href="https://github.com/koron/go-ssdp" rel="noopener ugc nofollow" target="_blank"> go-ssdp </a>)</li><li id="880f" class="lr ls iq jp b jq mc ju md jy me kc mf kg mg kk ly lz ma mb bi translated">Zeroconf:使用<a class="ae kx" href="https://en.wikipedia.org/wiki/Multicast_DNS" rel="noopener ugc nofollow" target="_blank">多播DNS</a>(golang<a class="ae kx" href="https://github.com/grandcat/zeroconf" rel="noopener ugc nofollow" target="_blank">zeroconf</a>)</li></ul><p id="3c55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> SSDP </strong>:与互联网一起发明的原始“简单”协议之一，基于UDP组播，非常容易实现并整合到upnp中，但使用过度，可能会被家庭路由器配置阻止。go实现只有15颗星，嗯..</p><p id="0fa9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> ZeroConf </strong> : zconf使用多播DNS，<a class="ae kx" href="https://github.com/grandcat/zeroconf" rel="noopener ugc nofollow" target="_blank">go实现</a>有140颗星，<a class="ae kx" href="https://github.com/hashicorp/mdns" rel="noopener ugc nofollow" target="_blank"> go-mdns </a> (hashicorp)有450颗星，这在我听起来更像是主流代码。mDNS也基于UDP组播(这次是双向的)，据说它对常见的家庭网络错误配置更有弹性。两者都同样不安全，但我们谈论的是家庭网络...</p><p id="1555" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我本来会用zeroconf，但是在玩了它之后(<a class="ae kx" href="https://sosedoff.com/2017/09/07/zeroconf.html" rel="noopener ugc nofollow" target="_blank"> guide </a>)，它似乎需要<a class="ae kx" href="https://stackoverflow.com/questions/23624525/standard-mdns-service-on-windows" rel="noopener ugc nofollow" target="_blank">安装一个Bonjour客户端</a>，或者应用一些reg hack来禁用一个监听mDNS默认端口的服务。我天真地认为zeroconf的整个想法是零配置。所以我最终选择了一些<strong class="jp ir">SSDP</strong>T6】简约。</p><pre class="km kn ko kp gt mh mi mj mk aw ml bi"><span id="683d" class="ky kz iq mi b gy mm mn l mo mp">import (<br/>    ssdp "github.com/koron/go-ssdp"<br/>)</span><span id="5aeb" class="ky kz iq mi b gy mq mn l mo mp">hname, err := os.Hostname()</span><span id="1f25" class="ky kz iq mi b gy mq mn l mo mp">//advertizing the service<br/>ad, err := ssdp.Advertise(<br/>  "urn:schemas-upnp-org:service:KidControl:1", // send as "ST"<br/>  "id:"+hname,                                 // send as "USN"<br/>  "http://"+myIp+":7777/",                     // send as "LOCATION"<br/>  "ssdp for KidControl",                       // send as "SERVER"<br/>  3600) // send as "maxAge" in "CACHE-CONTROL"<br/> if err != nil {<br/>  logger.Error("Error advertising ssdp: ", err)<br/> }</span><span id="694d" class="ky kz iq mi b gy mq mn l mo mp">//searching for instances on the network<br/>svcList,err := ssdp.Search("urn:schemas-upnp-org:service:KidControl:1", 5, "")</span></pre><p id="8e9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">解决了这个争论之后，让我们继续编写实际的服务。我们将使用go-volume来控制跨操作系统的卷，在windows上，我们应该确保我们不在远程会话中(这不起作用)。为get/set vol REST API编写一些样板服务器代码，并提供一个公共web根目录:</p><pre class="km kn ko kp gt mh mi mj mk aw ml bi"><span id="a509" class="ky kz iq mi b gy mm mn l mo mp">import (<br/>    gmux "github.com/gorilla/mux"<br/>)<br/><br/>mux := gmux.NewRouter()</span><span id="0486" class="ky kz iq mi b gy mq mn l mo mp"><strong class="mi ir">//restfull API:</strong><br/>mux.HandleFunc("/set-volume", setVolumeOnMachine).Queries("machine", "{machine}")<br/>mux.HandleFunc("/set-volume", setVolume)<br/>mux.HandleFunc("/get-volume", getVolumeOnMachine).Queries("machine", "{machine}")<br/>mux.HandleFunc("/get-volume", getVolume)<br/>mux.HandleFunc("/configuration", sendConfig)</span><span id="7a77" class="ky kz iq mi b gy mq mn l mo mp"><strong class="mi ir">//web server:</strong><br/>mux.PathPrefix("/").Handler(http.FileServer(http.Dir("./public")))</span><span id="78c2" class="ky kz iq mi b gy mq mn l mo mp"><strong class="mi ir">//run the Http listener:</strong><br/>err := http.ListenAndServe(":8080", mux)<br/>if err != nil {<br/>    fmt.Print("lisgtening error: ", err)<br/>}</span></pre><p id="9791" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在来看看JS方面的一个漂亮的web UI。因为我不是一个网页设计师，也没有成为一个网页设计师的愿望，我只是选择了一些不错的css套件(例如:bootstrap)来为我处理响应表和圆形按钮。</p><pre class="km kn ko kp gt mh mi mj mk aw ml bi"><span id="6572" class="ky kz iq mi b gy mm mn l mo mp">&lt;link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" &gt;</span></pre><h2 id="e728" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">古老的Vue / Angular / React辩论:</h2><p id="7b72" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">由于我们将有一个动态重复部分，用于控制每台发现的机器中的音量，我们需要一些框架来生成动态HTML标签，并将它们绑定到我们从服务器获得的数据。</p><p id="b0f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是VueJS发挥作用的地方，现在你会说:“它可以是任何其他的JS框架，为什么选择vue呢？为什么不是Angular v1.5/v6、ReactJS等……”嗯，这些其他框架通常需要大量的安装，以及一些UI构建过程和一些花费在学习它们不太直观的操作细节上的时间。在网络上寻找最小角度/反应演示时，我确实找到了一些，但它们要么是旧的，要么是粗糙的，不推荐用于生产。Vue非常容易集成，就像bootstrap一样，你将一个" s<em class="mu">script src "</em>链接放到项目中，你就可以开始用Vue编码，而不需要构建链(没有webpack、预编译步骤、插件等)。)而且这是官方的，在他们的<a class="ae kx" href="https://vuejs.org/v2/guide/index.html" rel="noopener ugc nofollow" target="_blank">主页面</a>上推荐。“那好吧，这个Vue听起来很有趣。给我报名！”</p><p id="6a95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">让有Vue: </strong></p><pre class="km kn ko kp gt mh mi mj mk aw ml bi"><span id="681c" class="ky kz iq mi b gy mm mn l mo mp">&lt;script src="https://unpkg.com/vue"&gt;&lt;/script&gt;</span><span id="e613" class="ky kz iq mi b gy mq mn l mo mp">&lt;div class="form-group m-3" id="vueApp"&gt;<br/>&lt;h3&gt;Change Volume&lt;/h3&gt;</span><span id="3981" class="ky kz iq mi b gy mq mn l mo mp"><strong class="mi ir">&lt;!--we start using vue, and attach it to the 'vueApp' ID later--&gt;</strong><br/>&lt;div <strong class="mi ir">v-for="m in machines"</strong> class="row"&gt;<br/>&lt;div class="col-md-1"&gt;<br/>    &lt;b&gt;<strong class="mi ir">{{m.name}}</strong>&lt;/b&gt;<br/>&lt;/div&gt;<br/>&lt;div class="col-md-2"&gt;<br/>    &lt;input type="range" <strong class="mi ir">v-on:change</strong>="changeVolume(m.volume,m.name)" min="0" max="100" <strong class="mi ir">v-model</strong>="m.volume" id="volumeSlider"&gt;&lt;/input&gt;<br/>&lt;/div&gt;<br/>&lt;div class="col-md-1"&gt;<br/>    &lt;input type="text" <strong class="mi ir">v-on:change</strong>="changeVolume(m.volume,m.name)" id="volumeText" <strong class="mi ir">v-model</strong>="m.volume"&gt;&lt;/input&gt;<br/>&lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="e066" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一些JQuery ajax函数将VueJS连接到我们的REST API:</p><pre class="km kn ko kp gt mh mi mj mk aw ml bi"><span id="8d9b" class="ky kz iq mi b gy mm mn l mo mp">&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"&gt;&lt;/script&gt;</span><span id="436b" class="ky kz iq mi b gy mq mn l mo mp">&lt;script&gt;<br/>        <strong class="mi ir">//the JS part of vue, this is where we attach to the tags</strong><br/>        var appData = new Vue({<br/>            el: <strong class="mi ir">'#vueApp'</strong>,<br/>            data: {<br/>                machines: [{<br/>                        name: "localhost",<br/>                        volume: 100<br/>                    },<br/>                ]<br/>            },<br/>            mounted: function () {<br/>               <strong class="mi ir">//the "on document ready" function</strong><br/>                var self = this;<br/>                $.get("http://" + window.location.host + "/configuration", function (data) {<br/>                    let d = JSON.parse(data)<br/>                    self.machines = d.machines;<br/>                });<br/>            },<br/>            methods: {<br/>                <strong class="mi ir">changeVolume</strong>: function (slideValue, machine) {<br/>                    let url = "http://" + window.location.host + "/set-volume?machine=" + machine</span><span id="1731" class="ky kz iq mi b gy mq mn l mo mp">$.ajax({<br/>                        url: url,<br/>                        data: JSON.stringify({<br/>                            "volume": slideValue,<br/>                        }),<br/>                        dataType: 'json',<br/>                        type: 'POST',<br/>                        contentType: 'application/json',<br/>                        success: response =&gt; console.log(response),<br/>                        error: e =&gt; console.log(e)<br/>                    });<br/>                }<br/>            }<br/>        })</span><span id="4a4d" class="ky kz iq mi b gy mq mn l mo mp">&lt;/script&gt;</span></pre><p id="2580" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转眼间。在家里的多台计算机上运行它(Win/Linux/Mac)，然后连接到其中任何一台计算机，都会显示如下内容:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mv"><img src="../Images/b5b6472ec917a64586755ec98030693e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5CEq9LU4hUF3LggSXT-lEw.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">在房子周围摆弄音量从来没有这么容易过！！</figcaption></figure><p id="eccc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在有了一个闪亮的新网络应用程序，可以让孩子的youtube视频安静下来。编写应用程序也是一件非常有趣的事情……我喜欢代码的简单性，我想大多数程序员都是这样，这也是Node、JSON和JS如此成功的原因之一。从简单开始有一种神奇的感觉，只有在被要求时才会变得复杂，这让它看起来像一个儿童建筑游戏。在我看来，具有陡峭的学习曲线的框架很少是合理的，这种对简单性的驱动就是为什么开发人员不断从头开始重建应用程序和框架，总是想:“必须有更简单的方法来完成任务”。</p></div></div>    
</body>
</html>