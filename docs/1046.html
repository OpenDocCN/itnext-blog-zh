<html>
<head>
<title>How to get resources from paginated REST API using recursion and JavaScript Promises</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用递归和JavaScript承诺从分页REST API获取资源</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-get-resources-from-paginated-rest-api-d7c20fe2bb0b?source=collection_archive---------1-----------------------#2018-07-11">https://itnext.io/how-to-get-resources-from-paginated-rest-api-d7c20fe2bb0b?source=collection_archive---------1-----------------------#2018-07-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="e614" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最近，我用星球大战API(<a class="ae ko" href="https://swapi.co/" rel="noopener ugc nofollow" target="_blank">https://swapi.co/</a>)做了一个兼职项目。该项目的要求之一是在一页上列出所有的行星。然而，你不能在一个API调用中得到所有的行星。相反，您需要使用正确的分页信息进行多次API调用来获取所有行星。在这篇文章中，我将谈谈我是如何做到这一点的。</p></div><div class="ab cl kp kq hx kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="im in io ip iq"><p id="7b3f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们来看看调用以下API端点时返回的JSON数据:【https://swapi.co/api/planets】<strong class="js iu"><em class="kw"/></strong></p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="7193" class="lg lh it lc b gy li lj l lk ll">{</span><span id="a9c4" class="lg lh it lc b gy lm lj l lk ll">    "count": 61,</span><span id="d5d4" class="lg lh it lc b gy lm lj l lk ll">    "next": "https://swapi.co/api/planets/?page=2",</span><span id="3640" class="lg lh it lc b gy lm lj l lk ll">    "previous": null,</span><span id="4265" class="lg lh it lc b gy lm lj l lk ll">    "results": [</span><span id="2e08" class="lg lh it lc b gy lm lj l lk ll">        {</span><span id="04ae" class="lg lh it lc b gy lm lj l lk ll">            "name": "Alderaan",</span><span id="5023" class="lg lh it lc b gy lm lj l lk ll">            "rotation_period": "24",</span><span id="a4ac" class="lg lh it lc b gy lm lj l lk ll">            "orbital_period": "364",</span><span id="baf1" class="lg lh it lc b gy lm lj l lk ll">            "diameter": "12500",</span><span id="f941" class="lg lh it lc b gy lm lj l lk ll">            "climate": "temperate",</span><span id="4563" class="lg lh it lc b gy lm lj l lk ll">            "gravity": "1 standard",</span><span id="b340" class="lg lh it lc b gy lm lj l lk ll">            "terrain": "grasslands, mountains",</span><span id="c4a3" class="lg lh it lc b gy lm lj l lk ll">            "surface_water": "40",</span><span id="fa8d" class="lg lh it lc b gy lm lj l lk ll">            "population": "2000000000",</span><span id="e607" class="lg lh it lc b gy lm lj l lk ll">            "residents": [</span><span id="198a" class="lg lh it lc b gy lm lj l lk ll">                "https://swapi.co/api/people/5/",</span><span id="e8f2" class="lg lh it lc b gy lm lj l lk ll">                "https://swapi.co/api/people/68/",</span><span id="ba05" class="lg lh it lc b gy lm lj l lk ll">                "https://swapi.co/api/people/81/"</span><span id="e0e7" class="lg lh it lc b gy lm lj l lk ll">            ],</span><span id="36cd" class="lg lh it lc b gy lm lj l lk ll">            "films": [</span><span id="4e2d" class="lg lh it lc b gy lm lj l lk ll">                "https://swapi.co/api/films/6/",</span><span id="e65d" class="lg lh it lc b gy lm lj l lk ll">                "https://swapi.co/api/films/1/"</span><span id="c544" class="lg lh it lc b gy lm lj l lk ll">            ],</span><span id="3496" class="lg lh it lc b gy lm lj l lk ll">            "created": "2014-12-10T11:35:48.479000Z",</span><span id="0bd5" class="lg lh it lc b gy lm lj l lk ll">            "edited": "2014-12-20T20:58:18.420000Z",</span><span id="3442" class="lg lh it lc b gy lm lj l lk ll">            "url": "https://swapi.co/api/planets/2/"</span><span id="a195" class="lg lh it lc b gy lm lj l lk ll">        },<br/>        ... // 9 more planets here <br/>    ]<br/>}</span></pre><p id="e2a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如您所见，单个API调用只能返回总共61个行星中的10个。如果您想要获得接下来的10颗行星，您需要使用从JSON数据中的' next '键获得的端点URL进行另一次API调用，因此为了获得总共61颗行星，我们需要进行7次API调用。</p><p id="8e29" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我的第一个想法是，端点URL是可预测的，因为我知道行星的总数和URL的结构，我可以很容易地找出第2、3、…、7页的URL是什么。然后，我可以使用for循环和循环中的一些条件检查，对所有这些硬编码的端点进行API调用，以获得所有的行星。这应该可以，但是，它一点也不灵活。</p><p id="555f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，我想出了一个使用递归和JavaScript承诺的解决方案:</p><figure class="kx ky kz la gt ln"><div class="bz fp l di"><div class="lo lp l"/></div></figure></div><div class="ab cl kp kq hx kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="im in io ip iq"><p id="51dd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你觉得这篇文章有帮助，请访问<a class="ae ko" href="https://www.youtube.com/channel/UCoQ7C3JajfBOIjp7yWDj8Yg" rel="noopener ugc nofollow" target="_blank">我的YouTube频道</a>，在那里你也可以找到一些有用的编程技巧。</p></div></div>    
</body>
</html>