<html>
<head>
<title>Designing Restful APIs using an API-First Approach</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用API优先的方法设计Restful APIs</h1>
<blockquote>原文：<a href="https://itnext.io/restful-using-api-first-cd305e59305d?source=collection_archive---------5-----------------------#2020-08-05">https://itnext.io/restful-using-api-first-cd305e59305d?source=collection_archive---------5-----------------------#2020-08-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="6036" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我从事RESTFul APIs已经有一段时间了，我喜欢做的一件事就是谈论API。</p><p id="6e39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，今天我将向您展示如何使用API优先的方法构建API，并使用OpenApi规范进行设计优先。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/568dee2378e34d33b456f650450e6a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xkoWmHVZCNfno3pI_iknDQ.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><a class="ae lb" href="https://unsplash.com/@d_mccullough?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">丹尼尔·麦卡洛</a>在<a class="ae lb" href="https://unsplash.com/s/photos/drafting?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="1376" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，如果你不知道API优先的方法是什么意思，最好停止阅读这篇文章，看看我写给Farfetchs博客的<a class="ae lb" href="https://www.farfetchtechblog.com/en/blog/post/why-can-api-first-improve-an-api/" rel="noopener ugc nofollow" target="_blank">博文</a>，在那里我解释了使用API优先启动API所需要知道的一切。</p><h1 id="3728" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">📋—准备场地</h1><p id="1a46" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">在您动手之前，让我们先做好准备，了解将要开发的用例。</p><h2 id="2cf3" class="mf ld iq bd le mg mh dn li mi mj dp lm jy mk ml lq kc mm mn lu kg mo mp ly mq bi translated">工具</h2><p id="9470" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">如果你想复制这里将要展示的例子，你需要下面的一些物品。</p><ul class=""><li id="7a9f" class="mr ms iq jp b jq jr ju jv jy mt kc mu kg mv kk mw mx my mz bi translated">NodeJS</li><li id="f03d" class="mr ms iq jp b jq na ju nb jy nc kc nd kg ne kk mw mx my mz bi translated">OpenAPI规范</li><li id="32de" class="mr ms iq jp b jq na ju nb jy nc kc nd kg ne kk mw mx my mz bi translated">文本编辑器(我将使用VSCode)</li><li id="c810" class="mr ms iq jp b jq na ju nb jy nc kc nd kg ne kk mw mx my mz bi translated">命令行</li></ul><h2 id="d071" class="mf ld iq bd le mg mh dn li mi mj dp lm jy mk ml lq kc mm mn lu kg mo mp ly mq bi translated">用例</h2><p id="c266" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">为了保持简单易懂，让我们使用Todo List应用程序，这是一个超越软件开发社区的非常常见的概念。</p><h2 id="9f3a" class="mf ld iq bd le mg mh dn li mi mj dp lm jy mk ml lq kc mm mn lu kg mo mp ly mq bi translated">放弃</h2><p id="518d" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">我将隐藏一些信息，以便从gist文件中轻松阅读，但在这篇文章的结尾，我将共享Github资源库链接，这样您就可以访问完整的内容。</p><h1 id="0c5c" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">🙌—弄脏你的手</h1><p id="e04a" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">现在，您已经拥有了具有所需依赖项的环境，让我们享受一下乐趣，并开始观察事情的进展。</p><p id="a6f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一步是为OpenAPI规范创建入口点文件，并向该文件添加一些内容。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">恢复OpenAPI文档</figcaption></figure><p id="0235" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的文件是一个OpenAPI文档的非常简单的表示，只是为了向您介绍这个概念。</p><p id="5660" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">OpenAPI是一种不言自明的符号，但是如果你还不知道它是如何工作的，我推荐使用官方文档<a class="ae lb" href="https://swagger.io/specification/" rel="noopener ugc nofollow" target="_blank">在规范设计过程中为你提供支持。</a></p><h2 id="4dee" class="mf ld iq bd le mg mh dn li mi mj dp lm jy mk ml lq kc mm mn lu kg mo mp ly mq bi translated">写入路径对象</h2><p id="3828" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">Path对象保存每个端点的相对路径及其操作，让我们添加一个名为<code class="fe nh ni nj nk b">tasks.yaml</code>的文件，看起来应该是这样。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="054f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面你可以看到增加了两个操作，这两个操作将使Todo List API创建一个任务并获得一个任务分页列表。</p><p id="9498" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们可以添加操作，使API能够删除一个任务，找到一个特定的任务，并更新一个任务，为此我们必须创建一个名为<code class="fe nh ni nj nk b">tasks-with-id.yaml</code>的新文件，并添加以下内容。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="58f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或许你能理解上面文件中描述的几乎所有东西，但是我相信<code class="fe nh ni nj nk b">$ref</code>符号值得一些解释。</p><h2 id="f1c9" class="mf ld iq bd le mg mh dn li mi mj dp lm jy mk ml lq kc mm mn lu kg mo mp ly mq bi translated">使用引用</h2><p id="42ca" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">在软件开发中共享代码是很常见的，同样的事情也发生在我们设计API的时候。牢记OpenAPI规范使我们能够跨OpenAPI文档重用公共对象。</p><p id="73f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用符号<code class="fe nh ni nj nk b">$ref</code>,您可以向API添加本地或远程引用，正如您在上面的例子中看到的。</p><p id="ac31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想更好地了解如何使用参考资料以及在哪里可以使用它，请查看一下<a class="ae lb" href="https://swagger.io/docs/specification/using-ref/" rel="noopener ugc nofollow" target="_blank">官方文档</a>。</p><h2 id="e540" class="mf ld iq bd le mg mh dn li mi mj dp lm jy mk ml lq kc mm mn lu kg mo mp ly mq bi translated">编写架构对象</h2><p id="5762" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">我们使用一个名为Task的模式组件，该模式在API中用于表示资源任务，该模式如下例所示。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="f7b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有了上面的代码，我们可以在所有API中重用任务模式，避免代码重复。</p><h2 id="d3af" class="mf ld iq bd le mg mh dn li mi mj dp lm jy mk ml lq kc mm mn lu kg mo mp ly mq bi translated">写入参数对象</h2><p id="1695" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">就像模式一样，我们可以对参数做同样的事情，如果有跨API共享的参数，我们可以引用本地或远程文件，这里我们将创建两个参数来表示关于页面及其大小的信息，必须像下面的示例一样。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h2 id="c262" class="mf ld iq bd le mg mh dn li mi mj dp lm jy mk ml lq kc mm mn lu kg mo mp ly mq bi translated">最终的API入口点</h2><p id="3b2b" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">在很多分开的文件例子之后，让我们看看所有的东西放在一起是什么样子。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="9239" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一切看起来都很好，我们已经设计了一个Todo List API，下面是一个很好的设计，现在如果你像我一样使用Visual Studio代码，你可以安装一个名为<a class="ae lb" href="https://marketplace.visualstudio.com/items?itemName=Arjun.swagger-viewer" rel="noopener ugc nofollow" target="_blank"> Swagger View </a>的扩展，这样你就可以呈现如下示例的规范。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nl"><img src="../Images/7e07d3a0d7cd01eaefdcb6def9544a9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DO5qQA4NVrjJRt4Qrn7YPg.png"/></div></div></figure><p id="b4f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如您所看到的，swagger视图看起来很棒，每个客户都可以通过Swagger-UI探索您的API。</p><h1 id="c46e" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">📦捆绑OpenAPI文档</h1><p id="5617" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">在开始与lint的OpenAPI文档交互之前，为我们的客户端创建模拟服务器和SDK，我们必须捆绑API以支持机器读取并与之交互。</p><p id="7d07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将OpenAPI文档分割成许多文件并在以后引用这些文件的概念是一种在设计过程中帮助您避免重复并增强代码重用的方法。</p><p id="a8cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是它不是一个有效的OpenAPI文档，现在，我们将看到如何使用<a class="ae lb" href="https://github.com/APIDevTools/swagger-cli" rel="noopener ugc nofollow" target="_blank"> swagger-cli </a>将许多文档捆绑成一个文档。</p><p id="818d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装<code class="fe nh ni nj nk b">swagger-cli</code>非常简单，只要运行上面的命令就可以了。</p><pre class="km kn ko kp gt nm nk nn no aw np bi"><span id="8721" class="mf ld iq nk b gy nq nr l ns nt">// using npm<br/>npm install swagger-cli</span><span id="624b" class="mf ld iq nk b gy nu nr l ns nt">// using yarn<br/>yarn add swagger-cli</span></pre><p id="61ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后，您只需要运行下面的bundle命令。</p><pre class="km kn ko kp gt nm nk nn no aw np bi"><span id="3eaf" class="mf ld iq nk b gy nq nr l ns nt">swagger-cli bundle api.yaml -o ./bin/api.yaml -t yaml</span></pre><p id="6c5f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完成后，您已经将API捆绑到了一个文件中，现在您可以lint这个文件，以确保每个准则都被使用。</p><h1 id="c265" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">📐- RESTFul指南</h1><p id="e60e" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">当我们设计API时，必须做的一件非常重要的事情是定义指导方针。</p><p id="63ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">软件社区提供了许多设计RESTFul APIs的指南，但是在很多情况下，这些指南并不能满足您的业务需求，您需要创建自己的指南。</p><p id="98f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">比定义指导方针更重要的是确保您的API遵循这些指导方针，例如，确保每个请求都有一个200响应。</p><p id="81e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是我们知道，如果没有工具的帮助，我们很难完成这项工作，所以记住这一点，让我给你介绍一个好朋友，在这项工作中支持你。</p><h2 id="8fbe" class="mf ld iq bd le mg mh dn li mi mj dp lm jy mk ml lq kc mm mn lu kg mo mp ly mq bi translated">使用spectral验证OpenAPI文档</h2><p id="0bcd" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">检查你的API是否是按照你的公司提出的指导方针设计的，这可能是一项很难手工完成的工作。</p><p id="1f31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我们可以要求一个像<a class="ae lb" href="https://stoplight.io/p/docs/gh/stoplightio/spectral" rel="noopener ugc nofollow" target="_blank"> Spectral </a>这样的工具来帮助我们，并创建一个自主的过程来完成这项工作。</p><p id="50e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Spectral是一个开源项目，它的工作方式类似于OpenAPI文档的linter，并且有许多规则来确保在软件行业开发RESTFul APIs时有非常通用的指导原则。</p><p id="4a09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用spectral非常简单，您只需要使用下面的命令安装节点包。</p><pre class="km kn ko kp gt nm nk nn no aw np bi"><span id="a0aa" class="mf ld iq nk b gy nq nr l ns nt">// using npm<br/>npm install <a class="ae lb" href="http://twitter.com/stoplight/spectral" rel="noopener ugc nofollow" target="_blank">@stoplight/spectral</a></span><span id="3f96" class="mf ld iq nk b gy nu nr l ns nt">// using yarn<br/>yarn add <a class="ae lb" href="http://twitter.com/stoplight/spectral" rel="noopener ugc nofollow" target="_blank">@stoplight/spectral</a></span></pre><p id="6938" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在执行lint命令并检查API是否符合指南之前，您需要像前面提到的那样捆绑API，之后只需运行下面的命令。</p><pre class="km kn ko kp gt nm nk nn no aw np bi"><span id="01c6" class="mf ld iq nk b gy nq nr l ns nt">spectral lint ./bin/api.yaml --ignore-unknown-format</span></pre><p id="52da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后，您可以看到通知是否有错误的输出，如下图所示。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nv"><img src="../Images/3280723c6926c7b2690d65fd1b45dc55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*stk-wbZ6127oD8SSNeLD9Q.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">光谱成功输出</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nw"><img src="../Images/9bccc9ccdb58acad3b9eea93bf0085be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*apggjNjRXAusZaO7"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">光谱误差输出</figcaption></figure><p id="26c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想了解spectral是如何工作的，lint有哪些选项，以及如何创建自己的规则或忽略现有的规则，我真的建议你访问<a class="ae lb" href="https://stoplight.io/p/docs/gh/stoplightio/spectral" rel="noopener ugc nofollow" target="_blank">官方文档</a>，他们有关于如何做的很棒的例子。</p><p id="1bcd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了spectral给我们带来的主要好处之外，我们还可以在持续集成的过程中或者甚至通过git hook来利用和添加这一点，从而确保我们将始终验证OpenAPI文档并符合指南。</p><h1 id="6a36" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">🏁结论</h1><p id="f33b" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">让我们在这篇文章中就此打住，我真的想多谈谈API-First和OpenAPI，但是对于第一篇文章来说，有很多信息必须消化。</p><p id="159c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章背后的想法只是展示如何用API优先的方法和OpenAPI规范开始设计一个API。在下一篇文章中，我们将讨论模拟服务器和SDK，以及我们如何利用OpenAPI来帮助改进开发过程。</p><p id="f0db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望你喜欢这些内容，如果你有任何疑问或建议，请让我知道，写下评论，或在twitter或其他地方打我。</p><p id="3952" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lb" href="https://github.com/nicolastakashi/todoapp-openapidocuments" rel="noopener ugc nofollow" target="_blank"> Github库</a>带示例</p></div></div>    
</body>
</html>