<html>
<head>
<title>Build a production ready PWA with Angular and Firebase</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Angular和Firebase构建生产就绪PWA</h1>
<blockquote>原文：<a href="https://itnext.io/build-a-production-ready-pwa-with-angular-and-firebase-8f2a69824fcc?source=collection_archive---------0-----------------------#2019-01-30">https://itnext.io/build-a-production-ready-pwa-with-angular-and-firebase-8f2a69824fcc?source=collection_archive---------0-----------------------#2019-01-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="52fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Angular为开发人员提供了一套很棒的工具，可以帮助他们轻松地开始开发应用程序。在引入schematics之后，Angular团队将他们的游戏进行得更深入。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/846ad7200a66368d0a91f62c011ee00c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*znPSfbmNe_F1WBSFZx4nGA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">安诺尔·查菲克在<a class="ae lb" href="https://unsplash.com/@anoirchafik?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="8cb0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为一名进步的网络应用布道者，我最喜欢的ng图表之一是<a class="ae lb" href="https://www.npmjs.com/package/@angular/pwa" rel="noopener ugc nofollow" target="_blank"> @angular/pwa </a>，这并不奇怪。该示意图为您的PWA开发之旅提供了一个良好的开端。然而，你需要在你的应用上做更多的工作，以便在多个移动平台上为你的用户创造最佳体验。</p><p id="febe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本教程将介绍如何构建、优化和托管您的PWA，以便在生产环境中提供类似本机的应用体验。它为最佳实践和平台优化提供了指南。除此之外，你的PWA也会得分💯在遵循了本文中描述的指南和提示之后，在<a class="ae lb" href="https://developers.google.com/web/tools/lighthouse/" rel="noopener ugc nofollow" target="_blank"> Lighthouse </a> PWA上进行审计。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h2 id="1528" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">在继续之前，请记住这是一个教程，您可能想要跟踪您的进展。我主持的国际研讨会的内容与本文几乎相同。这就是为什么我在<a class="ae lb" href="https://github.com/onderceylan/pwa-workshop-angular-firebase" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上为车间材料创建了一个repo。如果你愿意的话，你可以自己远程参加研讨会👇</h2><div class="mc md gp gr me mf"><a href="https://github.com/onderceylan/pwa-workshop-angular-firebase" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab fo"><div class="mh ab mi cl cj mj"><h2 class="bd ir gy z fp mk fr fs ml fu fw ip bi translated">onderceylan/pwa-workshop-angular-firebase</h2><div class="mm l"><h3 class="bd b gy z fp mk fr fs ml fu fw dk translated">欢迎来到基于Angular、Ionic和Firebase构建生产就绪的渐进式Web应用的研讨会。这个…</h3></div><div class="mn l"><p class="bd b dl z fp mk fr fs ml fu fw dk translated">github.com</p></div></div><div class="mo l"><div class="mp l mq mr ms mo mt kv mf"/></div></div></a></div><p id="8487" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢工作坊，我很欣赏你在<a class="ae lb" href="https://github.com/onderceylan/pwa-workshop-angular-firebase" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上的星。开始了。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="c513" class="mu lk iq bd ll mv mw mx lo my mz na lr nb nc nd lu ne nf ng lx nh ni nj ma nk bi translated">1.将@angular/pwa原理图添加到角度应用程序</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nl"><img src="../Images/37abd68a3abdfb13e5442d9b0a9ffb86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dqTuDfb-sp8xKwkqTzaBdg.png"/></div></div></figure><p id="9b72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你需要做的第一件事——在你全新或现有的Angular应用上构建一个渐进式Web应用——是将<em class="nm"> @angular/pwa </em>原理图添加到你的应用中。</p><p id="3932" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您只需在Angular CLI上运行<em class="nm"> add </em>命令即可。</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="491b" class="lj lk iq no b gy ns nt l nu nv">ng add @angular/pwa</span></pre><blockquote class="nw"><p id="70ce" class="nx ny iq bd nz oa ob oc od oe of kk dk translated">💡提示— <a class="ae lb" href="https://blog.npmjs.org/post/162869356040/introducing-npx-an-npm-package-runner" rel="noopener ugc nofollow" target="_blank">在您的Angular项目中使用“npx ng”命令</a>，而无需在您的系统上安装global @angular/cli软件包。</p></blockquote><p id="0033" class="pw-post-body-paragraph jn jo iq jp b jq og js jt ju oh jw jx jy oi ka kb kc oj ke kf kg ok ki kj kk ij bi translated">添加<em class="nm"> @angular/pwa </em> schematic将在您的项目上创建以下文件，我们稍后将深入研究这些文件。</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="11bf" class="lj lk iq no b gy ns nt l nu nv">ngsw-config.json<br/>src/assets/icons/icon-128x128.png<br/>src/assets/icons/icon-144x144.png<br/>src/assets/icons/icon-152x152.png<br/>src/assets/icons/icon-192x192.png<br/>src/assets/icons/icon-384x384.png<br/>src/assets/icons/icon-512x512.png<br/>src/assets/icons/icon-72x72.png<br/>src/assets/icons/icon-96x96.png<br/>src/manifest.json</span></pre><p id="6c35" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它还会相应地调整您的<code class="fe ol om on no b">angular.json</code>、<code class="fe ol om on no b">index.html</code>和<code class="fe ol om on no b">app.module.ts</code>文件。</p><h1 id="9fc5" class="mu lk iq bd ll mv oo mx lo my op na lr nb oq nd lu ne or ng lx nh os nj ma nk bi translated">2.更改Web应用程序清单文件— manifest.json</h1><blockquote class="ot ou ov"><p id="8c1a" class="jn jo nm jp b jq jr js jt ju jv jw jx ow jz ka kb ox kd ke kf oy kh ki kj kk ij bi translated"><a class="ae lb" href="http://web app manifest" rel="noopener ugc nofollow" target="_blank"> web应用程序清单</a>是一个简单的JSON文件，它告诉浏览器关于您的web应用程序，以及当它“安装”在用户的移动设备或桌面上时应该如何运行。Chrome需要一个清单来显示<a class="ae lb" href="https://developers.google.com/web/fundamentals/app-install-banners/" rel="noopener ugc nofollow" target="_blank">添加到主屏幕提示</a>。</p><p id="e1ab" class="jn jo nm jp b jq jr js jt ju jv jw jx ow jz ka kb ox kd ke kf oy kh ki kj kk ij bi translated">一个典型的清单文件包括关于应用程序的信息<code class="fe ol om on no b">name</code>、它应该使用的<code class="fe ol om on no b">icons</code>、它启动时应该开始的<code class="fe ol om on no b">start_url</code>等等。</p><p id="6288" class="jn jo nm jp b jq jr js jt ju jv jw jx ow jz ka kb ox kd ke kf oy kh ki kj kk ij bi translated">— <a class="ae lb" href="https://developers.google.com/web/fundamentals/web-app-manifest/" rel="noopener ugc nofollow" target="_blank">谷歌开发者门户网站上的Web应用清单</a></p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oz"><img src="../Images/af5845cee4b102fcc53fafbd72b02417.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dIV138dovj7g3s98d8ckyA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">使用Chrome DevTools的应用程序标签来检查你的应用程序的manifest.json文件</figcaption></figure><h2 id="3b43" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">2.1添加描述</h2><p id="e358" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">我在由<em class="nm"> @angular/pwa </em>原理图生成的manifest.json文件上看到的改进点之一是增加了<em class="nm">描述</em>字段。描述字段在<a class="ae lb" href="https://www.w3.org/TR/appmanifest/" rel="noopener ugc nofollow" target="_blank"> W3C Web App清单规范</a>和<a class="ae lb" href="https://developer.mozilla.org/en-US/docs/Web/Manifest" rel="noopener ugc nofollow" target="_blank"> MDN </a>上都有记录。</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="51ce" class="lj lk iq no b gy ns nt l nu nv">{<br/>  "description": "My Fancy PWA is a dummy Angular app which demonstrates a PWA's behaviour on different platforms."<br/>}</span></pre><h2 id="f3ef" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">2.2跟踪起始url</h2><p id="c9ce" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">在manifest.json文件的<em class="nm"> start_url </em>字段的末尾添加一个查询字符串也是一个很好的做法，可以跟踪你安装的应用程序从用户主屏幕启动的频率。</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="07c5" class="lj lk iq no b gy ns nt l nu nv">{<br/>  "start_url": <!-- -->"/?utm_source=a2hs"<br/>}</span></pre></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><blockquote class="nw"><p id="880f" class="nx ny iq bd nz oa pf pg ph pi pj kk dk translated">💡提示——提供名称、描述和至少512 x 512像素的应用程序图标将有助于您的应用程序在微软商店上被<a class="ae lb" href="https://docs.microsoft.com/en-us/microsoft-edge/progressive-web-apps/microsoft-store#automatic-pwa-importing-with-bing" rel="noopener ugc nofollow" target="_blank">自动索引和打包。</a></p></blockquote></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="pk pl l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">我在其中一个pwa上使用的完整manifest.json文件的示例</figcaption></figure><h1 id="5b29" class="mu lk iq bd ll mv oo mx lo my op na lr nb oq nd lu ne or ng lx nh os nj ma nk bi translated">3.显示A2HS指南</h1><p id="180a" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">谷歌Chrome自动检测Android系统上的PWA，如果该网站满足<a class="ae lb" href="https://developers.google.com/web/fundamentals/app-install-banners/#criteria" rel="noopener ugc nofollow" target="_blank">添加到主屏幕标准</a>，它会向用户显示<a class="ae lb" href="https://developers.google.com/web/updates/2018/06/a2hs-updates" rel="noopener ugc nofollow" target="_blank">安装横幅或迷你信息栏</a>，允许他们将其添加到主屏幕。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pm"><img src="../Images/2a68613ee3e33262ef062370701677d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*i0LfXaT1VuddsPB8.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Android上的添加到主屏幕对话框</figcaption></figure><blockquote class="nw"><p id="5db1" class="nx ny iq bd nz oa ob oc od oe of kk dk translated">💡提示— <strong class="ak">当你的manifest.json中的short_name </strong>字段被添加到主屏幕时，它将代表你的PWA的名称。另外，<strong class="ak">名称</strong>字段将用于Android上<a class="ae lb" href="https://developers.google.com/web/fundamentals/app-install-banners/" rel="noopener ugc nofollow" target="_blank"> <em class="pn">添加到主屏幕</em>提示</a>！</p></blockquote><p id="72aa" class="pw-post-body-paragraph jn jo iq jp b jq og js jt ju oh jw jx jy oi ka kb kc oj ke kf kg ok ki kj kk ij bi translated">iOS上没有这样的功能。但是，幸运的是，我们可以构建自己的UX来引导用户点击所需的<em class="nm">按钮</em>来帮助他们将你的应用添加到他们的主屏幕上。</p><p id="8a55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它可以是一个很好的旧弹出窗口；</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi po"><img src="../Images/7f4179727d9a23459c742dbe3c070ae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/0*pBu3Ifs-mVUdIiou.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">一个引导用户的弹出窗口—来源:<a class="ae lb" href="https://dockyard.com/blog/2017/09/27/encouraging-pwa-installation-on-ios" rel="noopener ugc nofollow" target="_blank">https://dock yard . com/blog/2017/09/27/inspiring-pwa-installation-on-IOs</a></figcaption></figure><p id="886e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者，甚至更好；一个迷你信息栏，模仿Chrome在Android平台上的行为，创建跨平台的统一体验。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/35d7be37d071ff5f0a0d2e302e6fe8a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*XMMa7gwBkG7auHi5.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">类似指南的迷你信息栏—来源:<a class="ae lb" href="https://www.netguru.com/codestories/few-tips-that-will-make-your-pwa-on-ios-feel-like-native" rel="noopener ugc nofollow" target="_blank">https://www . net guru . com/code stories/little-tips-that-will-make-your-pwa-on-IOs-feel-like-native</a></figcaption></figure><p id="ada9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，我在我的一个pwa上使用了一些代码来介绍这种行为。</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="e33a" class="lj lk iq no b gy ns nt l nu nv"><strong class="no ir">import </strong>{ get, set } <strong class="no ir">from </strong>'idb-keyval';<br/><strong class="no ir">import </strong>{ ToastController } <strong class="no ir">from </strong>'@ionic/angular';</span><span id="43d4" class="lj lk iq no b gy pq nt l nu nv"><strong class="no ir">async </strong>showIosInstallBanner() {<br/>  // Detects if device is on iOS<br/>  <strong class="no ir">const </strong>isIos = () =&gt; {<br/>    <strong class="no ir">const </strong>userAgent = window.navigator.userAgent.toLowerCase();<br/>    <strong class="no ir">return </strong>/iphone|ipad|ipod/.test(userAgent);<br/>  };</span><span id="72a1" class="lj lk iq no b gy pq nt l nu nv">  // Detects if device is in standalone mode<br/>  <strong class="no ir">const </strong>isInStandaloneMode = () =&gt; ('standalone' <strong class="no ir">in </strong>window.navigator) &amp;&amp; window.navigator.standalone;<br/><br/>  // Show the banner once<br/>  <strong class="no ir">const </strong>isBannerShown = <strong class="no ir">await </strong>get('isBannerShown');<br/><br/>  // Checks if it should display install popup notification<br/>  <strong class="no ir">if </strong>(isIos() &amp;&amp; !isInStandaloneMode() &amp;&amp; isBannerShown === <strong class="no ir">undefined</strong>) {<br/>    <strong class="no ir">const </strong>toast = <strong class="no ir">await this</strong>.toastController.create({<br/>      showCloseButton: <strong class="no ir">true</strong>,<br/>      closeButtonText: 'OK',<br/>      cssClass: 'custom-toast',<br/>      position: 'bottom',<br/>      message: `To install the app, tap "Share" icon below and select "Add to Home Screen".`,<br/>    });<br/>    toast.present();<br/>    set('isBannerShown', <strong class="no ir">true</strong>);<br/>  }<br/>}</span></pre><h1 id="4018" class="mu lk iq bd ll mv oo mx lo my op na lr nb oq nd lu ne or ng lx nh os nj ma nk bi translated">4.为平台优化添加元标签</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pr"><img src="../Images/686efa3f88c76f1215be25bf3384966f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*wpA6MWrsP4xonyw8.jpg"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">WebKit是Safari、Mail、App Store以及macOS、iOS和Linux上的许多其他应用程序使用的<a class="ae lb" href="https://webkit.org/project" rel="noopener ugc nofollow" target="_blank">网络浏览器引擎</a>—<a class="ae lb" href="https://webkit.org/" rel="noopener ugc nofollow" target="_blank">https://webkit.org/</a></figcaption></figure><p id="a0dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尽管许多浏览器采用了<a class="ae lb" href="https://w3c.github.io/manifest/" rel="noopener ugc nofollow" target="_blank"> Web应用清单规范</a>，但是WebKit(特别是iOS上的Mobile Safari)目前使用定制的非标准跟踪元标签实现。</p><p id="9b69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正因为如此，苹果的iOS不会像谷歌的Android那样基于应用程序的清单文件自动为PWA创建闪屏或应用程序图标。这阻止了您的PWA提供类似本机应用程序的体验。</p><blockquote class="nw"><p id="012b" class="nx ny iq bd nz oa pf pg ph pi pj kk dk translated">💡提示——关注WebKit特性状态，以跟踪web标准的实现进度。比如说；一旦Web应用清单规范在WebKit上实现，您将不再需要使用定制的meta标签。在这里跟踪进度:【https://webkit.org/status/#?search=manifest】T2</p></blockquote><p id="49a0" class="pw-post-body-paragraph jn jo iq jp b jq og js jt ju oh jw jx jy oi ka kb kc oj ke kf kg ok ki kj kk ij bi translated">幸运的是，有一个解决方法可以在iOS平台上配置你的PWA的应用程序图标、闪屏和状态栏。解决方法是在应用程序的index.html文件中添加自定义元标签！</p><h2 id="0c11" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">4.1为iOS上的应用图标添加元标签</h2><p id="583b" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">如上所述，iOS无法识别您放在清单文件中的应用程序图标。这就是为什么你需要在你的index.html文件中添加元标签来优化你的iOS应用程序及其图标。</p><p id="a675" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下示例演示了如何为最常见的iOS设备指定各种大小:</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="8a2a" class="lj lk iq no b gy ns nt l nu nv">&lt;link rel="apple-touch-icon" href="touch-icon-iphone.png"&gt;</span><span id="07f2" class="lj lk iq no b gy pq nt l nu nv">&lt;link rel="apple-touch-icon" sizes="152x152" href="touch-icon-ipad.png"&gt;</span><span id="c2d2" class="lj lk iq no b gy pq nt l nu nv">&lt;link rel="apple-touch-icon" sizes="180x180" href="touch-icon-iphone-retina.png"&gt;</span><span id="6c07" class="lj lk iq no b gy pq nt l nu nv">&lt;link rel="apple-touch-icon" sizes="167x167" href="touch-icon-ipad-retina.png"&gt;</span></pre><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ps pl l"/></div></figure><p id="a1d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在苹果的<a class="ae lb" href="https://developer.apple.com/library/archive/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html" rel="noopener ugc nofollow" target="_blank"> Safari网页内容指南</a>上阅读更多关于这个话题的内容。</p><h2 id="3bf6" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">4.2为iOS上的闪屏添加meta标签</h2><p id="8142" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">为了将闪屏添加到iOS上的PWA中，您必须添加一个meta标签，指出特定分辨率的图像。如果meta标签中图像的大小与设备的分辨率匹配，iOS会将图像显示为闪屏。</p><p id="2133" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">苹果使用一个名为<code class="fe ol om on no b">apple-touch-startup-image</code>的rel自定义链接来支持添加到iOS主屏幕的应用程序的闪屏，正如你在这里看到的<a class="ae lb" href="https://developer.apple.com/library/archive/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html" rel="noopener ugc nofollow" target="_blank"/>。你还需要设置<code class="fe ol om on no b">apple-mobile-web-app-capable</code> meta来支持闪屏。</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="e462" class="lj lk iq no b gy ns nt l nu nv">&lt;meta name="apple-mobile-web-app-capable" content="yes"&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/launch.png"&gt;</span></pre><p id="e3bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您需要为不同的设备创建不同大小的静态图像。以下是设备及其分辨率的列表:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pt"><img src="../Images/5412f6d2dc50f64096c3b6705297dea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hKRjSlhCNrFMo0ut_O9RBg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">静态启动屏幕图像— <a class="ae lb" href="https://developer.apple.com/design/human-interface-guidelines/ios/icons-and-images/launch-screen/" rel="noopener ugc nofollow" target="_blank">苹果人机界面指南</a></figcaption></figure><p id="c912" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我在PWAs index.html文件中的一些元标签的示例:</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="e5ea" class="lj lk iq no b gy ns nt l nu nv">&lt;link href="/assets/splash/iphone5_splash.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"&gt;</span><span id="81c7" class="lj lk iq no b gy pq nt l nu nv">&lt;link href="/assets/splash/iphone6_splash.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"&gt;</span><span id="7134" class="lj lk iq no b gy pq nt l nu nv">&lt;link href="/assets/splash/iphonex_splash.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image"&gt;</span></pre><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ps pl l"/></div></figure><blockquote class="nw"><p id="15df" class="nx ny iq bd nz oa ob oc od oe of kk dk translated">💡提示——使用自动化工具来生成图像及其相应的html代码。这里有一个开源库，我就是为此而建的:<a class="ae lb" href="https://github.com/onderceylan/pwa-asset-generator" rel="noopener ugc nofollow" target="_blank">https://github.com/onderceylan/pwa-asset-generator</a></p></blockquote><pre class="pu pv pw px py nn no np nq aw nr bi"><span id="95e8" class="lj lk iq no b gy ns nt l nu nv">npx <!-- -->pwa-asset-generator https://github.com/onderceylan/pwa-asset-generator/blob/master/static/logo.png -b "linear-gradient(to right, #fa709a 0%, #fee140 100%)"</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pz"><img src="../Images/f5fbf9778851453525748f53d138d87f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*O_lKXAOU_Iw7e1NEUX3ecQ.gif"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">通过<strong class="bd ll"> pwa-asset-generator </strong>自动生成闪屏和图标图像以及相应的HTML标签</figcaption></figure><h2 id="7d8b" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">4.3为iOS上的状态栏添加元标签</h2><p id="79b6" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">您可以通过在index.html文件中使用<code class="fe ol om on no b">apple-mobile-web-app-status-bar-style</code> meta标签来定制您的PWA的iOS状态栏。除非您为PWA指定全屏模式(也称为独立模式),否则这个meta标记没有任何作用。</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="00d1" class="lj lk iq no b gy ns nt l nu nv">&lt;meta name="apple-mobile-web-app-status-bar-style" content="white"&gt;</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi qa"><img src="../Images/0e61980d4e8be1702b39ad2c14e279f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DmaoahB1qXMpZgt2X2gq9Q.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><em class="pn">状态栏的视图；</em> <strong class="bd ll"> <em class="pn">黑色半透明</em> </strong> <em class="pn">，</em> <strong class="bd ll"> <em class="pn">白色</em> </strong> <em class="pn">，</em> <strong class="bd ll"> <em class="pn">黑色</em> </strong></figcaption></figure><p id="7b26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">苹果只支持meta标签的<code class="fe ol om on no b">content</code>属性的3个选项，没有进一步定制的可能性。选项包括:</p><ul class=""><li id="4d4d" class="qb qc iq jp b jq jr ju jv jy qd kc qe kg qf kk qg qh qi qj bi translated"><code class="fe ol om on no b">white</code> —显示带有黑色文本和符号的白色状态栏。<code class="fe ol om on no b">default</code>值和<code class="fe ol om on no b">white</code>有同样的效果，但是我<em class="nm">更喜欢白色。</em>因为<code class="fe ol om on no b">default</code>是非默认行为，所以不会那么混乱！🤯</li><li id="c2ea" class="qb qc iq jp b jq qk ju ql jy qm kc qn kg qo kk qg qh qi qj bi translated"><code class="fe ol om on no b">black</code> —显示黑色状态栏和白色文本及符号。当meta标签不存在时，这是iOS上PWA的默认行为。</li><li id="6974" class="qb qc iq jp b jq qk ju ql jy qm kc qn kg qo kk qg qh qi qj bi translated"><code class="fe ol om on no b">black-translucent</code> —显示白色文本和符号，状态栏使用与应用程序主体元素相同的背景色。</li></ul><h2 id="b09d" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">4.4社交分享的元标签</h2><p id="9de8" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">渐进式网络应用程序本质上是可以通过网络访问的。这意味着您可以在社交媒体或即时消息服务上分享您的PWA链接。</p><p id="5a17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了方便那些在网络上分享你的应用的用户，我建议通过在你的PWA中添加<a class="ae lb" href="http://ogp.me/" rel="noopener ugc nofollow" target="_blank">Open Graph Protocol meta tags</a>来创建一个不错的应用预览。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi qp"><img src="../Images/37dad525b1a1e37f2dff67001ba7df1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CheoeEaFRaRgVuyEn_OcOQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">您的应用程序在Twitter上的链接预览，带有提供的Open Graph元标签</figcaption></figure><p id="189f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是提供良好用户体验所需的元标签的示例:</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="9185" class="lj lk iq no b gy ns nt l nu nv">&lt;meta property="og:title" content="ITNEXT Summit 2018 PWA"&gt;<br/>&lt;meta property="og:description" content="Check out the PWA of ITNEXT Summit 2018. It rocks!"&gt;<br/>&lt;meta property="og:image" content="https://itnext-summit-2018.firebaseapp.com/assets/img/social-share.png"&gt;<br/>&lt;meta property="og:url" content="https://itnext-summit-2018.firebaseapp.com"&gt;<br/>&lt;meta name="twitter:card" content="summary_large_image"&gt;</span></pre></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="f164" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，您可以对PWA进行更多的优化，以定制iOS上的用户体验。</p><p id="1a7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请访问Safari HTML reference获取Apple特定元标签的完整列表:<a class="ae lb" href="https://developer.apple.com/library/archive/documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html" rel="noopener ugc nofollow" target="_blank">https://developer . Apple . com/library/archive/documentation/Apple applications/Reference/Safari HTML ref/Articles/meta tags . HTML</a></p><p id="a9a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了使用meta标签，一些额外的优化可以通过简单的CSS调整来完成。如；</p><ul class=""><li id="90f1" class="qb qc iq jp b jq jr ju jv jy qd kc qe kg qf kk qg qh qi qj bi translated">禁用选择</li><li id="5490" class="qb qc iq jp b jq qk ju ql jy qm kc qn kg qo kk qg qh qi qj bi translated">禁用高亮显示</li><li id="196e" class="qb qc iq jp b jq qk ju ql jy qm kc qn kg qo kk qg qh qi qj bi translated">禁用标注</li><li id="0c58" class="qb qc iq jp b jq qk ju ql jy qm kc qn kg qo kk qg qh qi qj bi translated">启用标签效果</li></ul><p id="87ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击此处了解更多信息:</p><div class="mc md gp gr me mf"><a href="https://dev.to/oskarlarsson/designing-native-like-progressive-web-apps-for-ios-510o" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab fo"><div class="mh ab mi cl cj mj"><h2 class="bd ir gy z fp mk fr fs ml fu fw ip bi translated">为iOS设计类似原生的渐进式网络应用</h2><div class="mm l"><h3 class="bd b gy z fp mk fr fs ml fu fw dk translated">渐进式Web应用程序(PWA)的主要特征之一是应用程序相似性。虽然你的应用程序技术上运行在…</h3></div><div class="mn l"><p class="bd b dl z fp mk fr fs ml fu fw dk translated">开发到</p></div></div><div class="mo l"><div class="qq l mq mr ms mo mt kv mf"/></div></div></a></div><h1 id="e4d7" class="mu lk iq bd ll mv oo mx lo my op na lr nb oq nd lu ne or ng lx nh os nj ma nk bi translated">5.配置ngsw-config . JSON-Angular维修工人</h1><p id="8b69" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">当您添加@angular/pwa原理图时，angular的ServiceWorkerModule被注入到您的<code class="fe ol om on no b">app.module.ts</code>文件中。该模块注册您自动生成的服务工作者文件— ngsw-worker.js，该文件是在生产构建期间由ng cli构建的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi qr"><img src="../Images/6d5104a975a5326a2a90bfc81d7c4a10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/0*NWNPijZiGSY1Mktr.png"/></div></figure><p id="95c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以参考<a class="ae lb" href="https://angular.io/guide/service-worker-config" rel="noopener ugc nofollow" target="_blank">维修工人配置的角度文档</a>来了解您的配置的设计和可能选项。</p><h2 id="16b7" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">5.1数据组</h2><blockquote class="ot ou ov"><p id="bc0f" class="jn jo nm jp b jq jr js jt ju jv jw jx ow jz ka kb ox kd ke kf oy kh ki kj kk ij bi translated">与资产资源不同，数据请求不随应用程序一起版本化。它们根据手动配置的策略进行缓存，这些策略对于API请求和其他数据依赖等情况更有用。</p></blockquote><p id="ccb5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我想强调的是数据资源的缓存策略。Angular service worker的设计考虑到了简洁性，因此它提供了两种缓存策略。</p><h2 id="0449" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">缓存策略:性能</h2><blockquote class="nw"><p id="26b8" class="nx ny iq bd nz oa pf pg ph pi pj kk dk translated">适合不经常变动的资源；例如，用户头像图像。— <a class="ae lb" href="https://angular.io/guide/service-worker-config#strategy" rel="noopener ugc nofollow" target="_blank">角度文件</a></p></blockquote><figure class="pu pv pw px py kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi qs"><img src="../Images/d9f8c63e7e1eeb6cecae8ca4360ddae9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tQBcZt0HlpnrbHz9KxAFEg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">性能是高速缓存优先的战略</figcaption></figure><blockquote class="ot ou ov"><p id="1277" class="jn jo nm jp b jq jr js jt ju jv jw jx ow jz ka kb ox kd ke kf oy kh ki kj kk ij bi translated">默认设置为<code class="fe ol om on no b">performance</code>，优化响应速度。如果资源存在于缓存中，则使用缓存的版本。根据<code class="fe ol om on no b">maxAge</code>，这允许一些陈旧，以换取更好的性能。这适用于不经常变化的资源；例如，用户头像图像。</p></blockquote><h2 id="c612" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">缓存策略:新鲜度</h2><blockquote class="nw"><p id="1def" class="nx ny iq bd nz oa pf pg ph pi pj kk dk translated">对经常变化的资源有用；例如，帐户余额。— <a class="ae lb" href="https://angular.io/guide/service-worker-config#strategy" rel="noopener ugc nofollow" target="_blank">角度文件</a></p></blockquote><figure class="pu pv pw px py kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi qt"><img src="../Images/25a1a2fd5f2eb0fd973c2fca7bcaaedd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I6rc4R5HBixBdZbRpwZBCw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">新鲜是网络第一的战略</figcaption></figure><blockquote class="ot ou ov"><p id="9eca" class="jn jo nm jp b jq jr js jt ju jv jw jx ow jz ka kb ox kd ke kf oy kh ki kj kk ij bi translated"><code class="fe ol om on no b">freshness</code>优化数据流通，优先从网络获取请求的数据。根据<code class="fe ol om on no b">timeout</code>的说法，只有当网络超时时，请求才会回到缓存中。</p></blockquote><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="0192" class="lj lk iq no b gy ns nt l nu nv">"dataGroups": [<br/>    {<br/>      "name": "from-api",<br/>      "version": 2,<br/>      "urls": ["/data/data.json"], // or ["/dashboard", "/user"]<br/>      "cacheConfig": {<br/>        "strategy": "performance",<br/>        "maxSize": 10,<br/>        "maxAge": "1h",<br/>        "timeout": "3s"<br/>      }<br/>    }<br/>  ]</span></pre><p id="b067" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的示例中，来自API的数据或接收到的静态json文件将使用刷新策略进行缓存，最多10次响应，最大缓存时间为1小时，超时时间为3秒，之后结果将退回到缓存中。<em class="nm">新鲜度</em>是一种<strong class="jp ir">网络优先策略</strong>，或者，您可以使用<em class="nm">性能</em>作为<strong class="jp ir">缓存优先策略</strong>的策略。</p><blockquote class="nw"><p id="e4f3" class="nx ny iq bd nz oa pf pg ph pi pj kk dk translated">💡提示—当您的数据源以向后不兼容的方式更新时，增加数据组中的版本字段以使您的数据资源缓存无效。新版本的应用程序可能与旧的数据格式不兼容。</p></blockquote><h2 id="cd07" class="lj lk iq bd ll lm qu dn lo lp qv dp lr jy qw lt lu kc qx lw lx kg qy lz ma mb bi translated">5.2资产组</h2><blockquote class="ot ou ov"><p id="4eb3" class="jn jo nm jp b jq jr js jt ju jv jw jx ow jz ka kb ox kd ke kf oy kh ki kj kk ij bi translated">资产是属于应用程序版本的资源，会随应用程序一起更新。它们可以包括从页面来源加载的资源，以及从cdn和其他外部URL加载的第三方资源。</p></blockquote><p id="d818" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据缓存它们的策略，您可以在每个资产组上引入<code class="fe ol om on no b">lazy</code>或<code class="fe ol om on no b">prefetch</code>策略。服务工作者配置上的资源接受与许多文件匹配的<a class="ae lb" href="https://angular.io/guide/service-worker-config#glob-patterns" rel="noopener ugc nofollow" target="_blank">类glob模式</a>，比如；</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="df9b" class="lj lk iq no b gy ns nt l nu nv">"assetGroups": [<br/>    {<br/>      "name": "shell",<br/>      "installMode": "prefetch",<br/>      "updateMode": "prefetch",<br/>      "resources": {<br/>        "files": [<br/>          "/favicon.ico",<br/>          "/index.html",<br/>          "/*.css",<br/>          "/vendor.*.js",<br/>          "/main.*.js",<br/>          "/polyfills.*.js",<br/>          "/runtime.*.js",<br/>          "/*.js",<br/>          "!/*-sw.js"<br/>        ]<br/>      }<br/>    },<br/>    {<br/>      "name": "assets",<br/>      "installMode": "lazy",<br/>      "updateMode": "prefetch",<br/>      "resources": {<br/>        "files": [<br/>          "/assets/**",<br/>          "/svg/**"<br/>        ],<br/>        "urls": [<br/>          "<a class="ae lb" href="https://fonts.googleapis.com/**" rel="noopener ugc nofollow" target="_blank">https://fonts.googleapis.com/**</a>"<br/>        ]<br/>      }<br/>    }<br/>  ]</span></pre><p id="b019" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于已经在缓存中的资源，当发现新版本的应用程序时，<code class="fe ol om on no b">updateMode</code>决定缓存行为。根据<code class="fe ol om on no b">updateMode</code>更新组中自上一版本以来发生变化的任何资源。当您的应用程序有新的服务人员版本时，Angular service worker将自动处理您的资产更新。</p><blockquote class="nw"><p id="1490" class="nx ny iq bd nz oa pf pg ph pi pj kk dk translated">💡提示——当你使用缓存策略时，你必须排除那些你想保持新鲜的资源。例如您的应用程序可能使用的附加服务工作者文件。</p></blockquote></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="5513" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下完整的ngsw-config.json文件示例演示了资产组、数据组、应用程序数据和用于排除其他服务人员的glob:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="pk pl l"/></div></figure><h1 id="0e95" class="mu lk iq bd ll mv oo mx lo my op na lr nb oq nd lu ne or ng lx nh os nj ma nk bi translated">6.为静态资产配置angular.json</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi qz"><img src="../Images/16a802d1d5a9567987cd553dfb5d2480.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pZEdkzoS5sHugfuK.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Angular控制台徽标，Angular CLI的GUI—<a class="ae lb" href="https://angularconsole.com/" rel="noopener ugc nofollow" target="_blank">https://angularconsole.com</a></figcaption></figure><p id="ad34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用Angular构建PWA时，需要注意的最重要的一点是静态资产的配置。您需要了解您的构建配置及其在生产构建中的输出，以便正确地缓存和服务您的静态资源。</p><p id="2905" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将@angular/pwa原理图添加到您的angular应用程序会自动将<code class="fe ol om on no b">manifest.json</code>文件注册到您在<code class="fe ol om on no b">angular.json</code>配置上的静态资源配置中。但是如果您在根上使用额外的文件，比如<code class="fe ol om on no b">robots.txt</code>、<code class="fe ol om on no b">browserconfig.xml</code>，或者一个定制的图标集，那么您需要将这些文件添加到您的构建配置中。</p><p id="c85e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">添加@angular/pwa原理图后，这是您的<code class="fe ol om on no b">angular.json</code>文件上的默认资产配置:</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="b6e6" class="lj lk iq no b gy ns nt l nu nv">"assets": [<br/>  "src/favicon.ico",<br/>  "src/assets",<br/>  "src/manifest.json"<br/>]</span></pre><p id="5a37" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当你添加静态文件到你的根目录，或者引入一个外部插件时，你可能想要扩展这个配置。在我们的例子中，更有趣的是，您可能想在自动生成的<code class="fe ol om on no b">ngsw-worker.js</code>的基础上向您的应用程序引入一个额外的服务人员。</p><p id="69ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我的一个pwa在<code class="fe ol om on no b">angular.json</code>上的资产配置示例:</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="358c" class="lj lk iq no b gy ns nt l nu nv">"assets": [<br/>  "src/manifest.json",<br/>  "src/robots.txt",<br/>  "src/browserconfig.xml",<br/>  "src/favicon.ico",<br/>  {<br/>    "glob": "**/*",<br/>    "input": "src/assets",<br/>    "output": "assets"<br/>  },<br/>  {<br/>    "glob": "**/*.svg",<br/>    "input": "node_modules/@ionic/angular/dist/ionic/svg",<br/>    "output": "./svg"<br/>  },<br/>  {<br/>    "glob": "**/*-sw.js",<br/>    "input": "src/app/sw",<br/>    "output": "/"<br/>  },<br/>  {<br/>    "glob": "**/idb-keyval-iife.min.js",<br/>    "input": "node_modules/idb-keyval/dist/",<br/>    "output": "/"<br/>  }<br/>]</span></pre><h1 id="c9b7" class="mu lk iq bd ll mv oo mx lo my op na lr nb oq nd lu ne or ng lx nh os nj ma nk bi translated">7.延伸角形服务工作者</h1><p id="1708" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">截至2019年2月，Angular service worker-aka ngsw不支持另一个服务工作者的组成。这意味着你不能扩展棱角分明的服务人员的默认行为，并为其添加你的特色。</p><p id="0637" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以尝试并编辑自动生成的<code class="fe ol om on no b">ngsw-worker.js</code>服务人员文件，但是每次您为生产构建应用程序时，Angular都会根据您在<code class="fe ol om on no b">ngsw-config.json</code>上的配置覆盖该文件。</p><p id="8985" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你计划做的比Angular service worker提供给你的更多，这个架构可能会引入一个问题。不过不用担心，有一个很好的解决方法可以解决这个问题。</p><h2 id="5c1d" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">介绍您自己的服务人员文件</h2><p id="6c5d" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">你可以引入一个新的服务人员文件，比如说将<code class="fe ol om on no b">main-sw.js</code>导入到你的Angular应用中，并将自动生成的ngsw <em class="nm">导入到你的新服务人员</em>中。</p><p id="c0c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设您将sw文件配置为复制到apps根文件夹，请参考“为静态资产配置angular.json”一章中的<code class="fe ol om on no b">"**/*-sw.js"</code> glob，您的worker上的以下<a class="ae lb" href="https://developer.mozilla.org/en-US/docs/Web/API/WorkerGlobalScope/importScripts" rel="noopener ugc nofollow" target="_blank"> importScripts </a>导入应该可以解决。</p><p id="ef95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在src/app/sw文件夹中创建一个新的<code class="fe ol om on no b">main-sw.js</code>文件，内容如下:</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="06dc" class="lj lk iq no b gy ns nt l nu nv">importScripts('ngsw-worker.js'); // automatically generated ngsw<br/>importScripts('messaging-sw.js'); // custom service worker #1<br/>importScripts('notifications-sw.js'); // custom service worker #2</span></pre><p id="102d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在引入您自己的服务工作者包装器之后，您必须更改您的<code class="fe ol om on no b">app.module.ts</code>文件上的服务工作者引用。</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="29c7" class="lj lk iq no b gy ns nt l nu nv">ServiceWorkerModule.register('<strong class="no ir">/main-sw.js</strong>', { enabled: environment.production })</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ra"><img src="../Images/b2857c5f3303103087905fe1baf0214d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EYbzQxZJVKVffCXVCg5Hrg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">使用Chrome DevTools的应用程序选项卡来检查应用程序的服务人员。ITNEXT 2018大会PWA扩展服务工作者演示—<a class="ae lb" href="https://itnext-summit-2018.firebaseapp.com" rel="noopener ugc nofollow" target="_blank">https://itnext-summit-2018.firebaseapp.com</a></figcaption></figure><blockquote class="nw"><p id="db52" class="nx ny iq bd nz oa ob oc od oe of kk dk translated">💡提示—默认情况下，为生产环境启用服务人员。Angular推荐<a class="ae lb" href="https://angular.io/guide/service-worker-getting-started" rel="noopener ugc nofollow" target="_blank">为生产而构建，并运行http-server </a>来测试你的应用的服务人员。</p></blockquote><h1 id="a091" class="mu lk iq bd ll mv oo mx lo my op na lr nb rb nd lu ne rc ng lx nh rd nj ma nk bi translated">8.更新您的PWA</h1><p id="0030" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">服务人员是渐进式Web应用程序的骨干。而且，更新PWA总是从其服务人员开始。浏览器定期检查客户端应用程序的附加服务工作器的字节差异，并且一旦服务工作器文件被更新，浏览器自动初始化更新过程。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi re"><img src="../Images/8567b4aaadb194a90d4282a04763dd60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FHyvYRffIAix_60T.jpg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">来源:<a class="ae lb" href="https://deanhume.com/displaying-a-new-version-available-progressive-web-app/" rel="noopener ugc nofollow" target="_blank">https://dean Hume . com/displaying-a-new-version-available-progressive-we b-app/</a></figcaption></figure><h2 id="1cea" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">8.1应用程序版本和更新检查</h2><blockquote class="ot ou ov"><p id="e2df" class="jn jo nm jp b jq jr js jt ju jv jw jx ow jz ka kb ox kd ke kf oy kh ki kj kk ij bi translated">在Angular服务人员的上下文中，“版本”是代表Angular应用程序的特定构建的资源的集合。每当部署应用程序的新版本时，服务人员都会将该版本视为应用程序的新版本。即使只更新了一个文件，也是如此。在任何给定时间，服务人员的缓存中可能有多个版本的应用程序，并且服务人员可能会同时为它们提供服务。</p><p id="3cda" class="jn jo nm jp b jq jr js jt ju jv jw jx ow jz ka kb ox kd ke kf oy kh ki kj kk ij bi translated">每次用户打开或刷新应用程序时，Angular service worker都会通过查找对<code class="fe ol om on no b">ngsw.json</code>清单的更新来检查应用程序的更新。该清单文件代表Angular构建的“版本”,以及与ngsw-config文件相关联的所有文件。如果发现更新，它会自动下载并缓存，并在下次加载应用程序时提供。</p><p id="2783" class="jn jo nm jp b jq jr js jt ju jv jw jx ow jz ka kb ox kd ke kf oy kh ki kj kk ij bi translated">— <a class="ae lb" href="https://angular.io/guide/service-worker-devops" rel="noopener ugc nofollow" target="_blank">角度文件</a></p></blockquote><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="pk pl l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">ngsw.json清单文件，表示Angular PWA的构建版本</figcaption></figure><p id="f5b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">阅读更多关于ngsw应用程序更新的信息:<a class="ae lb" href="https://angular.io/guide/service-worker-devops" rel="noopener ugc nofollow" target="_blank">https://angular.io/guide/service-worker-devops</a></p><h2 id="c508" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">8.2 ngsw-config . JSON上的AppData</h2><p id="c862" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">ngsw-config.json文件中的<code class="fe ol om on no b">appData</code>字段使您能够传递描述该应用程序特定版本的任何数据(您想要的)。<code class="fe ol om on no b"><a class="ae lb" href="https://angular.io/api/service-worker/SwUpdate" rel="noopener ugc nofollow" target="_blank">SwUpdate</a></code>服务将该数据包含在更新通知中。许多应用程序利用这个字段来提供一些额外的信息，以显示任何弹出窗口，通知用户有可用的更新。</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="be89" class="lj lk iq no b gy ns nt l nu nv">"index": "/index.html",<br/>"<strong class="no ir">appData</strong>": {<br/>  "version": "1.1.0",<br/>  "changelog": "Added better resource caching"<br/>}</span></pre><h2 id="e082" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">8.3软件更新服务</h2><p id="6d64" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">Angular通过自己的名为<code class="fe ol om on no b"><a class="ae lb" href="https://angular.io/api/service-worker/SwUpdate" rel="noopener ugc nofollow" target="_blank">SwUpdate</a></code>的服务从<em class="nm">@ angular/service-worker</em>模块处理其服务工作者更新。您可以订阅此服务上的<em class="nm"> UpdateAvailableEvent </em>和<em class="nm"> UpdateActivatedEvent </em>事件，以获得服务人员更新的通知。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi rf"><img src="../Images/f108a83f64c2cc2c9f64a58071ad1640.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qQ3s7dr4BtfR0T5FC6nCLA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">ITNEXT 2018大会PWA，app更新演示—参见https://github.com/LINKIT-Group/itnext-summit-app<a class="ae lb" href="https://github.com/LINKIT-Group/itnext-summit-app" rel="noopener ugc nofollow" target="_blank">上的源代码</a></figcaption></figure><p id="bb6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下示例演示了一个用户提示，当新的服务工作程序版本可用时，将显示该提示。通过这样做，我们为用户提供了一个立即应用更新的选项。</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="ae52" class="lj lk iq no b gy ns nt l nu nv"><strong class="no ir">import </strong>{ SwUpdate } <strong class="no ir">from </strong>'@angular/service-worker';<br/>@Component({<br/>  selector: 'app-root',<br/>  templateUrl: './app.component.html',<br/>})<br/><strong class="no ir">export class </strong>AppComponent <strong class="no ir">implements </strong>OnInit {</span><span id="e8c0" class="lj lk iq no b gy pq nt l nu nv">ngOnInit() {<br/>  <strong class="no ir">if </strong>(<strong class="no ir">this</strong>.swUpdate.isEnabled) {<br/>    <strong class="no ir">this</strong>.swUpdate.available.subscribe(<strong class="no ir">async </strong>() =&gt; {<br/>      <strong class="no ir">const </strong>alert = <strong class="no ir">await this</strong>.alertController.create({<br/>        header: `App update!`,<br/>        message: `Newer version of the app is available. It's a quick refresh away!`,<br/>        buttons: [<br/>          {<br/>            text: 'Cancel',<br/>            role: 'cancel',<br/>            cssClass: 'secondary',<br/>          }, {<br/>            text: 'Refresh',<br/>            handler: () =&gt; {<br/>              window.location.reload();<br/>            },<br/>          },<br/>        ],<br/>      });<br/><br/>      <strong class="no ir">await </strong>alert.present();<br/>    });<br/>  }<br/>}</span></pre><p id="d71c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，您不必提供这种手动更新功能。当所有客户端或附属页面断开时，浏览器会自动更新服务人员。但是，为了方便您的用户，我建议您提供这种即时更新选项。</p><blockquote class="nw"><p id="177e" class="nx ny iq bd nz oa pf pg ph pi pj kk dk translated">💡提示—浏览器会自动检查附加的主服务工作器文件的字节差异，如果您扩展了ngsw，该文件将是main-sw.js。您应该确保您可能导入到主要服务人员的其他sw文件没有被缓存。这将在下一章的Firebase主机配置中详细解释。</p></blockquote><h1 id="2d8b" class="mu lk iq bd ll mv oo mx lo my op na lr nb rb nd lu ne rc ng lx nh rd nj ma nk bi translated">9.在Firebase上托管您的应用</h1><p id="eb7d" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">Firebase是围绕简单性构建的。为您的应用程序设置主机和配置部署非常容易。</p><p id="6c33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦你登录到<a class="ae lb" href="https://console.firebase.google.com" rel="noopener ugc nofollow" target="_blank"> Firebase控制台</a>，你就可以点击<em class="nm">添加项目</em>按钮，并根据你的喜好<em class="nm">填写下面的表格。</em></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi rg"><img src="../Images/99097e4882b27ea0a4b4df7b5ae4d0c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qh-SDA2No4fQl--m31zQTg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">在Firebase上为您的应用程序创建新项目</figcaption></figure><p id="32e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用Firebase服务最简单的方法是通过控制台使用Firebase CLI。要在命令行上访问Firebase CLI，请运行以下命令之一:</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="bfd9" class="lj lk iq no b gy ns nt l nu nv">npm i -g firebase-tools <br/>npx firebase // or use npx to avoid global installation</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi rh"><img src="../Images/945f06179c6fe27dff5d4a88cbd21115.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ncc-9H9yvbsiuwUab45vTQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">在Firebase上设置主机</figcaption></figure><p id="59b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建项目后，导航到开发类别下的<em class="nm">托管</em>选项卡。单击“完成”以使您的项目在CLI上可用。</p><h2 id="268a" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">正在初始化Firebase配置</h2><p id="e3f6" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">您可以通过Firebase CLI简单地执行3个命令，将您的PWA部署到Firebase；<em class="nm">登录</em>、<em class="nm">初始化</em>和<em class="nm">部署</em>。我们现在只使用Firebase的托管服务。为了做到这一点，你应该在你的项目根上执行<code class="fe ol om on no b">firebase init</code>，然后用<em class="nm">空格键</em>检查并按下<em class="nm">回车</em>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ri"><img src="../Images/24a0b44c092cedc293bdf6086170e197.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WpxdhNU_HQ2y9yp6RoRNig.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">在项目中初始化Firebase的选项</figcaption></figure><p id="85bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下一步，它将显示您现有的项目给你设置一个主机。选择<em class="nm">【创建新项目】</em>选项，为您的应用程序创建一个默认项目。之后，像下面这样回答步骤；</p><ul class=""><li id="e6fd" class="qb qc iq jp b jq jr ju jv jy qd kc qe kg qf kk qg qh qi qj bi translated">您想将什么用作您的公共目录？ <code class="fe ol om on no b">dist/my-pwa</code> —这是在<em class="nm">输出路径</em>下的angular.json文件中配置的生产构建的路径。</li><li id="fa65" class="qb qc iq jp b jq qk ju ql jy qm kc qn kg qo kk qg qh qi qj bi translated"><em class="nm">配置为单页app(将所有网址改写为/index.html) </em>？<code class="fe ol om on no b">y</code></li><li id="6bcf" class="qb qc iq jp b jq qk ju ql jy qm kc qn kg qo kk qg qh qi qj bi translated"><em class="nm">文件dist/my-pwa/index.html已经存在。覆盖？</em>T1】</li></ul><p id="1f2c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为这个设置的输出，Firebase CLI在您的项目根目录下创建两个文件:<code class="fe ol om on no b">firebase.json</code>和<code class="fe ol om on no b">.firebaserc</code></p><h1 id="8804" class="mu lk iq bd ll mv oo mx lo my op na lr nb oq nd lu ne or ng lx nh os nj ma nk bi translated">10.为您的PWA配置Firebase主机</h1><p id="e5f3" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">可以通过项目中的<code class="fe ol om on no b">firebase.json</code>文件在Firebase上配置你的主机。您可以在下面看到Firebase CLI为您的项目创建的默认配置；</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="245a" class="lj lk iq no b gy ns nt l nu nv">{<br/>  "hosting": {<br/>    "public": "dist/my-pwa",<br/>    "ignore": [<br/>      "firebase.json",<br/>      "**/.*",<br/>      "**/node_modules/**"<br/>    ],<br/>    "rewrites": [<br/>      {<br/>        "source": "**",<br/>        "destination": "/index.html"<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="960a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">了解这种配置的几个要点很重要。</p><ul class=""><li id="accd" class="qb qc iq jp b jq jr ju jv jy qd kc qe kg qf kk qg qh qi qj bi translated">因为Angular是一个SPA(单页应用程序)，你必须像上面一样配置rewrite来将所有的源代码指向你的index.html文件。</li><li id="5473" class="qb qc iq jp b jq qk ju ql jy qm kc qn kg qo kk qg qh qi qj bi translated">在任何情况下都不要部署任何保存您的凭证<strong class="jp ir">的文件</strong>。密钥、机密以及依赖于您指出的公共文件夹的配置文件中的此类机密信息可能会立即暴露给外界。确保忽略公共文件夹中的任何配置文件，否则。</li></ul><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ps pl l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">关注我们环境中的一个重大安全问题</figcaption></figure><h2 id="565b" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">10.1为缓存添加自定义HTTP头</h2><p id="afc1" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">Firebase主机配置允许你为你的项目添加定制的HTTP头。</p><p id="fc6f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这种配置对于您的PWA尤其重要，因为您可能希望缓存静态资产并对其进行gzip压缩，以提高应用程序的加载性能。较长缓存生存期可以加快对页面的重复访问。</p><blockquote class="ot ou ov"><p id="0a69" class="jn jo nm jp b jq jr js jt ju jv jw jx ow jz ka kb ox kd ke kf oy kh ki kj kk ij bi translated">当浏览器请求资源时，提供资源的服务器可以告诉浏览器它应该临时存储或<strong class="jp ir">缓存</strong>资源多长时间。对于对该资源的任何后续请求，浏览器使用其本地副本，而不是去网络获取它。— <a class="ae lb" href="https://developers.google.com/web/tools/lighthouse/audits/cache-policy" rel="noopener ugc nofollow" target="_blank">谷歌开发者门户的缓存政策</a></p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi rj"><img src="../Images/d3929ed3e0274f450127695c9d29cfcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ejKN_MNjBX8L7TUH.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">验证Chrome DevTools中的缓存响应—<a class="ae lb" href="https://developers.google.com/web/tools/lighthouse/audits/cache-policy" rel="noopener ugc nofollow" target="_blank">Google开发者门户上的缓存策略</a></figcaption></figure><p id="23a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于Angular在文件名中使用哈希后缀来创建静态资源，所以您可以通过添加<em class="nm">Cache-Control</em>HTTP header<em class="nm">来为这些资源引入长缓存生存期。</em>当你这么做的时候，你也应该考虑<a class="ae lb" href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching#invalidating_and_updating_cached_responses" rel="noopener ugc nofollow" target="_blank">让你的缓存</a> <em class="nm">失效。</em>然而<em class="nm">，Angular应用</em>并不需要使静态资源的缓存无效，因为Angular的构建系统会在资源文件名更新时自动改变其后缀哈希。</p><p id="971d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，Firebase自动用gzip压缩静态资源，并返回一个带有<em class="nm">内容编码</em> gzip头的响应。但是我还是想放一个显式的标题，让它的意图清晰可见。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi rk"><img src="../Images/782d8e9d336ff12f2f2e160c872255c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r3zP0x-NGWkLX1mK3YzW9A.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">启用供应商区块的Angular的生产构建输出。也演示了文件名中的散列。</figcaption></figure><blockquote class="nw"><p id="6694" class="nx ny iq bd nz oa ob oc od oe of kk dk translated">💡提示—将vendorChunk引入到Angular应用的生产构建配置中—请参见angular.json中的vendor chunk选项。这将有助于您的PWA缓存策略，因为您很可能不会过于频繁地更新供应商库。</p></blockquote><p id="bbbd" class="pw-post-body-paragraph jn jo iq jp b jq og js jt ju oh jw jx jy oi ka kb kc oj ke kf kg ok ki kj kk ij bi translated">下面的示例演示了添加长缓存生存期和提供压缩的静态资源；</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="7380" class="lj lk iq no b gy ns nt l nu nv">{<br/>  "headers": [<br/>  {<br/>    "source": "**/*.@(js|css)",<br/>    "headers": [<br/>      {<br/>        "key": "Cache-Control",<br/>        "value": "max-age=31536000"<br/>      },<br/>      {<br/>        "key": "Content-Encoding",<br/>        "value": "gzip"<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="49fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可能已经注意到，Firebase配置接受源文件的<a class="ae lb" href="https://firebase.google.com/docs/hosting/full-config#glob_pattern_matching" rel="noopener ugc nofollow" target="_blank">类glob模式</a>。</p><h2 id="cd0f" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">10.2保持额外服务人员文件的新鲜</h2><p id="92a0" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">如果您对所有的js和css文件使用上面的这种缓存配置，那么您必须为您的附加服务工作者文件创建一个例外规则。这里有一个<em class="nm">无缓存</em>异常的例子；</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="2384" class="lj lk iq no b gy ns nt l nu nv">{<br/>  "headers": [<br/>  {<br/>    "source": "**/*-sw.js",<br/>    "headers": [<br/>      {<br/>        "key": "Cache-Control",<br/>        "value": "no-cache"<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="128e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这条规则将确保我们所有与文件名模式<em class="nm"> **/*-sw.js </em>匹配的服务人员文件保持新鲜。</p><h2 id="07c1" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">10.3添加带有链接头的HTTP/2服务器推送</h2><p id="cc16" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">HTTP/2目前支持所有的<code class="fe ol om on no b">*.firebaseapp.com</code>流量，要在Firebase主机上使用HTTP/2，您不需要做任何事情！如果用户的浏览器支持，它将自动提供服务。点击此处了解更多信息:</p><div class="mc md gp gr me mf"><a href="https://firebase.googleblog.com/2016/09/http2-comes-to-firebase-hosting.html" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab fo"><div class="mh ab mi cl cj mj"><h2 class="bd ir gy z fp mk fr fs ml fu fw ip bi translated">HTTP/2来到Firebase托管</h2><div class="mm l"><h3 class="bd b gy z fp mk fr fs ml fu fw dk translated">谷歌移动开发平台Firebase的官方博客</h3></div><div class="mn l"><p class="bd b dl z fp mk fr fs ml fu fw dk translated">firebase.googleblog.com</p></div></div><div class="mo l"><div class="rl l mq mr ms mo mt kv mf"/></div></div></a></div><p id="9406" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，您可能希望手动将HTTP/2服务器推送引入到您的应用程序中。通过使用<a class="ae lb" href="https://w3c.github.io/preload/#server-push-http-2" rel="noopener ugc nofollow" target="_blank">链接头</a>，Firebase hosting引入了对HTTP/2服务器推送的实验性支持。服务器推送允许服务器在发出初始请求时自动发送附加资源的内容。服务器推送的一个常见用途是在加载页面时发送相关的静态资源，比如JavaScript和CSS文件。</p><p id="daac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您需要将链接头添加到您的<code class="fe ol om on no b">firebase.json</code>配置文件中，并指出您的静态资源的路径，以便在Firebase主机上配置服务器推送。这里有一个例子:</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="60f4" class="lj lk iq no b gy ns nt l nu nv">{<br/>  "headers": [<br/>    {<br/>      "source": "/",<br/>      "headers": [{"key": "Link", "value": "&lt;/js/app.js&gt;;rel=preload;as=script,&lt;/css/app.css&gt;;rel=preload;as=style"}]<br/>    },<br/>    {<br/>      "source": "/users/*",<br/>      "headers": [{"key": "Link", "value": "&lt;/js/app.js&gt;;rel=preload;as=script,&lt;/css/app.css&gt;;rel=preload;as=style;nopush,&lt;/css/users.css&gt;;rel=preload;as=style"}]<br/>    }<br/>  ]<br/>}</span></pre><h2 id="d28a" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">10.4基本主机配置示例</h2><p id="c4f6" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">以下示例展示了我的一个pwa的配置示例。我推荐你阅读Firebase 上托管配置的<a class="ae lb" href="https://firebase.google.com/docs/hosting/full-config" rel="noopener ugc nofollow" target="_blank">文档，让你了解所有可能的配置选项。</a></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="pk pl l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">我在其中一个pwa上使用的完整firebase.json配置文件示例</figcaption></figure><h1 id="9613" class="mu lk iq bd ll mv oo mx lo my op na lr nb oq nd lu ne or ng lx nh os nj ma nk bi translated">11.将你的PWA部署到Firebase</h1><p id="fc8f" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">将应用部署到Firebase非常简单。只需通过Firebase CLI在您的项目根目录中执行<code class="fe ol om on no b">firebase deploy</code>，您就可以开始了！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi rm"><img src="../Images/89f32adc4c9263a2d1cd043ee9783871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BvDqoLEk9l1N27qs5qnCCg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">如果您还没有完成，您可能需要添加一个项目</figcaption></figure><h1 id="b4f1" class="mu lk iq bd ll mv oo mx lo my op na lr nb oq nd lu ne or ng lx nh os nj ma nk bi translated">12.使用Lighthouse审核您的PWA</h1><p id="5a45" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">Lighthouse是一款<a class="ae lb" href="https://github.com/GoogleChrome/lighthouse" rel="noopener ugc nofollow" target="_blank">开源</a>，用于提高网页质量的自动化工具。你可以在任何网页上运行它，无论是公开的还是需要认证的。它对性能、可访问性、渐进式网络应用等进行审计。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi rn"><img src="../Images/9d443c804dce4370a94859de79e6f644.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eTzXTxSAGitP3w4d6AocJw.png"/></div></div></figure><p id="7452" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">审计PWA可以在在线审计运行器、Chrome DevTools和通过<a class="ae lb" href="https://developers.google.com/web/tools/lighthouse/#cli" rel="noopener ugc nofollow" target="_blank"> Lighthouse CLI </a>完成。</p><h2 id="5a67" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">12.1使用在线审计运行程序</h2><p id="9ef1" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">您可以运行Lighthouse审计，方法是导航到下面的链接，并输入您想要运行审计的应用程序的URL。</p><div class="mc md gp gr me mf"><a href="https://developers.google.com/web/tools/lighthouse/run" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab fo"><div class="mh ab mi cl cj mj"><h2 class="bd ir gy z fp mk fr fs ml fu fw ip bi translated">试试Lighthouse |开发者工具| Google开发者</h2><div class="mm l"><h3 class="bd b gy z fp mk fr fs ml fu fw dk translated">对任何地点运行灯塔。</h3></div><div class="mn l"><p class="bd b dl z fp mk fr fs ml fu fw dk translated">developers.google.com</p></div></div><div class="mo l"><div class="ro l mq mr ms mo mt kv mf"/></div></div></a></div><h2 id="23d6" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">12.2使用Chrome开发工具</h2><p id="0078" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">一旦您按照本文的提示配置了PWA，并使用推荐的配置将您的应用程序部署到firebase，您的应用程序就可以接受审计了。你可以<a class="ae lb" href="https://developers.google.com/web/tools/lighthouse/#devtools" rel="noopener ugc nofollow" target="_blank">在Chrome DevTools </a>上运行一个审计，看到Progressive Web App审计的分数是100。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi rp"><img src="../Images/80ea5872eb9c5c4be615ae2e19b05fc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JaHN24e5Pgs3bqYMhAg4sA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">💯Lighthouse PWA审计得分— Chrome DevTools审计</figcaption></figure><h2 id="a8d3" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">12.3使用Lighthouse CLI</h2><p id="7da8" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">Lighthouse的审计可以通过Lighthouse CLI在您的持续集成环境中自动进行。这将确保您的任何更改都不会影响您设置的任何审核的分数<a class="ae lb" href="https://github.com/GoogleChrome/lighthouse#cli-options" rel="noopener ugc nofollow" target="_blank">—参见Lighthouse回归中的CLI选项</a>。</p><blockquote class="nw"><p id="0441" class="nx ny iq bd nz oa pf pg ph pi pj kk dk translated">💡提示-您可以比较当前和以前审计的Lighthouse报告，以确保您的更改不会对您的应用程序产生影响。</p></blockquote><p id="063a" class="pw-post-body-paragraph jn jo iq jp b jq og js jt ju oh jw jx jy oi ka kb kc oj ke kf kg ok ki kj kk ij bi translated">下面的命令将执行一个headless Chrome并根据url运行审计，然后显示一个报告。</p><pre class="km kn ko kp gt nn no np nq aw nr bi"><span id="5928" class="lj lk iq no b gy ns nt l nu nv">npx lighthouse <a class="ae lb" href="https://my-fancy-pwa.firebaseapp.com" rel="noopener ugc nofollow" target="_blank">https://my-fancy-pwa.firebaseapp.com</a> --chrome-flags="--headless" --view</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi rq"><img src="../Images/bdf4f328163737a50aeb170d79624839.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OM7qyc0I5OQokY7l6psAmg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Lighthouse CLI报告，以html格式查看</figcaption></figure><blockquote class="nw"><p id="746d" class="nx ny iq bd nz oa ob oc od oe of kk dk translated">💡提示—在您的生产应用程序上执行夜间回归，以根据更新的PWA审核来监控它，这将有助于您与未来的PWA最佳实践保持一致，因为审核列表会及时更新。</p></blockquote></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="4749" class="mu lk iq bd ll mv mw mx lo my mz na lr nb nc nd lu ne nf ng lx nh ni nj ma nk bi translated">你的PWA还有什么？</h1><p id="2757" class="pw-post-body-paragraph jn jo iq jp b jq pa js jt ju pb jw jx jy pc ka kb kc pd ke kf kg pe ki kj kk ij bi translated">随着网络不断增长的力量，你可以向网络应用程序中引入的任何东西都是你的PWA的一个选项。请务必查看iOS的<a class="ae lb" href="https://webkit.org/status" rel="noopener ugc nofollow" target="_blank"> WebKit功能状态</a>和Android平台兼容性的<a class="ae lb" href="https://www.chromestatus.com" rel="noopener ugc nofollow" target="_blank"> Chrome平台状态</a>，以了解您想要调整的功能和Web APIs。</p><p id="c49e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在iOS 11.3首个测试版发布一年后，苹果近日发布了iOS 12.2首个测试版。这是引入PWA支持以来的第一个版本，其中有相当好的改进——将PWA的最大问题集中在iOS上。点击此处了解更多信息:</p><div class="mc md gp gr me mf"><a href="https://medium.com/@firt/pwas-on-ios-12-2-beta-the-good-the-bad-and-the-not-sure-yet-if-good-a37b6fa6afbf" rel="noopener follow" target="_blank"><div class="mg ab fo"><div class="mh ab mi cl cj mj"><h2 class="bd ir gy z fp mk fr fs ml fu fw ip bi translated">iOS 12.2 beta上的PWAs:好的、坏的和“还不确定是否好”</h2><div class="mm l"><h3 class="bd b gy z fp mk fr fs ml fu fw dk translated">一年前，2018年1月，苹果公司以其对渐进式Web应用技术的早期支持让所有人感到惊讶…</h3></div><div class="mn l"><p class="bd b dl z fp mk fr fs ml fu fw dk translated">medium.com</p></div></div><div class="mo l"><div class="rr l mq mr ms mo mt kv mf"/></div></div></a></div><p id="6528" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，只需在手机或桌面浏览器上浏览<a class="ae lb" href="https://whatwebcando.today" rel="noopener ugc nofollow" target="_blank">https://whatwebcando . today</a>和<a class="ae lb" href="https://tomayac.github.io/pwa-feature-detector/" rel="noopener ugc nofollow" target="_blank">https://tomayac.github.io/pwa-feature-detector/</a>，就能从浏览器的功能中获得灵感。</p><p id="96ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想给你的PWA添加推送通知功能，你可以遵循我的同事<a class="rs rt ep" href="https://medium.com/u/b4ee91751c76?source=post_page-----8f2a69824fcc--------------------------------" rel="noopener" target="_blank"> Ural </a>下面的指南。</p><div class="mc md gp gr me mf"><a rel="noopener  ugc nofollow" target="_blank" href="/push-notification-with-angular-net-core-a2280d18eda1"><div class="mg ab fo"><div class="mh ab mi cl cj mj"><h2 class="bd ir gy z fp mk fr fs ml fu fw ip bi translated">用角度&amp;推送通知。网络核心</h2><div class="mm l"><h3 class="bd b gy z fp mk fr fs ml fu fw dk translated">所以，你想随时戳用户(如果他们接受)从你的web应用。在这里，我想解释一下…</h3></div><div class="mn l"><p class="bd b dl z fp mk fr fs ml fu fw dk translated">itnext.io</p></div></div><div class="mo l"><div class="ru l mq mr ms mo mt kv mf"/></div></div></a></div></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="7299" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关注我的<a class="ae lb" href="https://twitter.com/onderceylan" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Twitter </strong> </a>以获得更多类似本文的提示。</p><p id="7a32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你觉得这篇文章有用，请不要忘记<strong class="jp ir">鼓掌</strong>和<strong class="jp ir">关注</strong>。此外，请随意撰写关于您的PWA发展历程的评论。我很想听听这一切！</p></div></div>    
</body>
</html>