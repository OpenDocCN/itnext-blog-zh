<html>
<head>
<title>Adding Docker to an ASP.NET Core Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向ASP.NET核心应用程序添加Docker</h1>
<blockquote>原文：<a href="https://itnext.io/adding-docker-to-an-asp-net-core-application-61850327b3c9?source=collection_archive---------3-----------------------#2018-08-12">https://itnext.io/adding-docker-to-an-asp-net-core-application-61850327b3c9?source=collection_archive---------3-----------------------#2018-08-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="cd16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我有一系列关于将ASP.NET核心应用部署到不同云提供商的帖子，这些云提供商提供支持ASP.NET核心的服务。如果你感兴趣的话，以下是这方面的所有帖子。</p><p id="d767" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://elanderson.net/2018/06/deploying-an-asp-net-core-application-to-google-cloud-platform/" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a> <br/> <a class="ae kl" href="https://elanderson.net/2018/06/deploying-an-asp-net-core-application-to-amazon-web-services/" rel="noopener ugc nofollow" target="_blank">亚马逊网络服务</a> <br/> <a class="ae kl" href="https://elanderson.net/2018/07/deploying-an-asp-net-core-application-to-microsoft-azure/" rel="noopener ugc nofollow" target="_blank">微软Azure </a></p><p id="6421" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有人问我是否要写一篇关于部署到数字海洋的文章。虽然不在我最初的计划中，但这是个好主意。事实是，DigitalOcean没有支持ASP.NET核心的服务，但他们支持Docker，所以这篇文章将介绍如何在一个示例ASP.NET核心应用程序中添加Docker支持。寻找关于如何部署到数字海洋的未来帖子。</p><h2 id="d050" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">码头工人</h2><p id="a4e3" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">Docker是什么？引用维基百科<a class="ae kl" href="https://en.wikipedia.org/wiki/Docker_(software)" rel="noopener ugc nofollow" target="_blank">的话</a>:</p><blockquote class="lk ll lm"><p id="e52f" class="jn jo ln jp b jq jr js jt ju jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj kk ij bi translated"><strong class="jp ir"> Docker </strong>是一个<a class="ae kl" href="https://en.wikipedia.org/wiki/Computer_program" rel="noopener ugc nofollow" target="_blank">计算机程序</a>，它执行<a class="ae kl" href="https://en.wikipedia.org/wiki/Operating-system-level_virtualization" rel="noopener ugc nofollow" target="_blank">操作系统级虚拟化</a>，也称为<a class="ae kl" href="https://en.wikipedia.org/wiki/Operating-system-level_virtualization" rel="noopener ugc nofollow" target="_blank">容器化</a>。它于2013年首次发布，由<a class="ae kl" href="https://en.wikipedia.org/wiki/Docker,_Inc." rel="noopener ugc nofollow" target="_blank"> Docker公司</a>开发</p><p id="0c55" class="jn jo ln jp b jq jr js jt ju jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj kk ij bi translated">Docker用于运行被称为“容器”的软件包。在一个典型的示例用例中，一个容器运行web服务器和web应用程序，而另一个容器运行web应用程序使用的数据库服务器。容器相互隔离，使用自己的一套工具和<a class="ae kl" href="https://en.wikipedia.org/wiki/Library_(computing)" rel="noopener ugc nofollow" target="_blank">库</a>；他们可以通过明确的渠道进行交流。所有容器都使用相同的<a class="ae kl" href="https://en.wikipedia.org/wiki/Kernel_(operating_system)" rel="noopener ugc nofollow" target="_blank">内核</a>，因此比<a class="ae kl" href="https://en.wikipedia.org/wiki/Virtual_machine" rel="noopener ugc nofollow" target="_blank">虚拟机</a>更加轻量级。容器是由“图像”创建的，这些图像指定了它们的精确内容。通常通过组合和修改从存储库下载的标准图像来创建图像。</p></blockquote><p id="ccc0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装Docker</p><p id="4419" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到<a class="ae kl" href="https://store.docker.com/editions/community/docker-ce-desktop-windows" rel="noopener ugc nofollow" target="_blank">这个</a>链接，点击Get Docker链接下载安装程序。安装完成后，您必须注销并重新登录。当我重新登录时，我收到一条关于Hyper-V未启用的消息。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/73521ebb5d355474d1ce0fb6a1d6ddd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/0*sFFK08d4vspPRnIo.png"/></div></figure><p id="c4a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重新登录后，我收到以下关于硬件辅助虚拟化未启用的消息。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/fef9ed10984020cf1a3c0ef5d222f1df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/0*6CCBsaVGGP2g09lh.png"/></div></figure><p id="bd58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在调整了我的BIOS设置并重新登录后，Docker的欢迎界面向我打来了招呼。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/68a84f65f974fe14befa27078e2abd5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/0*VEVZYqT7FaoXTQGb.png"/></div></figure><p id="cbb4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开命令提示符并运行以下命令。</p><pre class="ls lt lu lv gt ma mb mc md aw me bi"><span id="1c7a" class="km kn iq mb b gy mf mg l mh mi">docker run hello-world</span></pre><p id="eaa7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您的安装正在运行，您应该输出以下面开头的内容。</p><blockquote class="lk ll lm"><p id="6939" class="jn jo ln jp b jq jr js jt ju jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj kk ij bi translated">Docker的你好！<br/>此消息显示您的安装似乎工作正常。</p></blockquote><h2 id="df9d" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">示例应用程序</h2><p id="2550" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">这与云系列中的相同，但我把它包括在内，以防你错过了那篇文章。我们将要部署的示例应用程序是使用。NET CLI。以下命令是我用来创建应用程序、创建解决方案以及将项目添加到解决方案中的命令。我在CloudSample目录中运行了所有这些命令。</p><pre class="ls lt lu lv gt ma mb mc md aw me bi"><span id="2f11" class="km kn iq mb b gy mf mg l mh mi">dotnet new razor --no-https<br/>dotnet new sln<br/>dotnet sln add CloudSample.csproj</span></pre><h2 id="1801" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">添加Docker支持</h2><p id="b644" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">在Visual Studio中打开上面创建的解决方案，右键单击项目并选择<strong class="jp ir"> Add &gt; Docker Support </strong>。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mj"><img src="../Images/fb23855c0b873057c04e88596b26a19c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*j2kWSsSI3dV-z4Ka.png"/></div></div></figure><p id="2002" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，您将让选择您想要定位的操作系统。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/fc620a9bb8ff3ed2ef64b3475d701237.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/0*xj1QKm-iDQrCODBV.png"/></div></figure><p id="7f7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将把以下四个文件添加到您的项目中。</p><pre class="ls lt lu lv gt ma mb mc md aw me bi"><span id="f217" class="km kn iq mb b gy mf mg l mh mi">docker-compose.dcproj<br/>docker-compose.override.yml<br/>docker-compose.yml<br/>Dockerfile</span></pre><p id="0a23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您在Visual Studio中点击run from时，该过程还会将您的项目更改为在Docker中启动。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/75b39b62de3a01fcfac4078820f9f998.png" data-original-src="https://miro.medium.com/v2/resize:fit:538/format:webp/0*frNTzJ5WmlfsMXw_.png"/></div></figure><h2 id="2179" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">出版</h2><p id="1784" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">为了发布，我们需要一个我们想发布到的注册帐户。有多种选择，但我将使用<a class="ae kl" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker Hub </a>。去Docker Hub注册一个账户。在您登录到您的<strong class="jp ir">存储库</strong>选项卡后，点击<strong class="jp ir">创建存储库</strong>。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mq"><img src="../Images/c3ee59d41c4ad52a4addd3ecee9347d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*V5PEi39Og4u6fvbH.png"/></div></div></figure><p id="f6aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下一页中，输入存储库的名称，选择是私有还是公共，然后单击<strong class="jp ir"> Create </strong>。我使用名称TestRepository并使其成为私有的。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mr"><img src="../Images/a77508ec8611a150fb2b1b8b4cf132c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*g8_ikeHCigLEZAJU.png"/></div></div></figure><p id="5c02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有了一个Docker Hub帐户，希望回到Visual Studio，右键单击您的项目并选择<strong class="jp ir"> Publish </strong>。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/3e263aaeb1994ecf09caab471bd2b468.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/0*byaj-ZLjj35XXuT6.png"/></div></figure><p id="9d5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在接下来的对话框中，选择<strong class="jp ir">集装箱登记</strong>选项，然后选择<strong class="jp ir">对接机中枢</strong>。然后点击<strong class="jp ir">发布</strong>按钮。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mt"><img src="../Images/9e10519f6f5d9b76a074ca4bed448815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5lSdJTU3wpGdYXkD.png"/></div></div></figure><p id="60c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下一个对话框中，输入Docker Hub的用户名和密码，然后点击<strong class="jp ir">保存</strong>。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/81535ae423370a0bc1bffd61636101e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/0*jSbChx43Zk5He-e6.png"/></div></figure><p id="c005" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">保存后，Visual Studio将构建应用程序并将其发布到Docker Hub。</p><p id="bd5f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">问题</p><p id="186d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你运气好的话，上述方法会对你有用。我碰到了几个问题，使得上面的失败。下面是我得到的第一个错误。</p><blockquote class="lk ll lm"><p id="c716" class="jn jo ln jp b jq jr js jt ju jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj kk ij bi translated">错误:无法构建服务“cloudsample ”:命令“/bin/sh-c dot net restore/cloud sample . csproj”返回了非零代码:1</p></blockquote><p id="9227" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">经过一番挖掘，我发现了这个GitHub的问题。修复的要点是更改<strong class="jp ir">docker文件</strong>中的以下内容。</p><pre class="ls lt lu lv gt ma mb mc md aw me bi"><span id="b8d4" class="km kn iq mb b gy mf mg l mh mi">Before:<br/>RUN dotnet restore /CloudSample.csproj<br/><br/>After:<br/>RUN dotnet restore -nowarn:msb3202,nu1503 -p:RestoreUseSkipNonexistentTargets=false</span></pre><p id="f775" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以上修复了发布模式下的构建，但是当工具试图标记图像时，发布仍然失败，并出现以下错误。</p><blockquote class="lk ll lm"><p id="3560" class="jn jo ln jp b jq jr js jt ju jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj kk ij bi translated">系统。异常:运行docker.exe标记命令失败。在微软。visual studio . web . azure . publish . containerregistryprofilevision . docker tag(ProcessStartInfo startInfo，String serverUrlString) <br/>位于Microsoft . visual studio . web . azure . publish . containerregistyprofilevisive .&lt;postpublish async&gt;d _ _ 24。MoveNext()<br/>--从抛出异常的前一个位置开始的堆栈跟踪的结尾--系统中的<br/>。runtime . compiler services . taskawaiter . throwfornonsuccess(Task Task)<br/>at System。位于Microsoft . visual studio . application capabilities . publish . viewmodel . profileselectorviewmodel .&lt;runpublishtask async&gt;d _ _ 116。MoveNext()</p></blockquote><p id="d166" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还没有找到解决这个问题的方法。我最终使用Docker CLI来推送我的图像。这需要几个步骤。首先，使用以下命令登录。</p><pre class="ls lt lu lv gt ma mb mc md aw me bi"><span id="c297" class="km kn iq mb b gy mf mg l mh mi">docker login</span></pre><p id="d997" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，使用docker images命令找到您尝试推送的图像。在我的例子中，它是ID为f83e5adab340的图像。当ID确定后，我们现在可以使用下面的命令来标记图像。</p><pre class="ls lt lu lv gt ma mb mc md aw me bi"><span id="4844" class="km kn iq mb b gy mf mg l mh mi">docker tag f83e5adab340 elanderson/testrepository</span></pre><p id="5d66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很重要的一点是，图像被标记上它将被推送到的存储库的名称。最后，运行下面的命令将带有指定标记的图像推送到存储库中。</p><pre class="ls lt lu lv gt ma mb mc md aw me bi"><span id="026b" class="km kn iq mb b gy mf mg l mh mi">docker push elanderson/testrepository</span></pre><h2 id="efcb" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">包扎</h2><p id="7d00" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">微软的团队已经使向现有项目添加Docker支持变得非常简单。Docker是我已经有一段时间的表面意识，我期待着尝试一个实际的部署，看看它如何与DigitalOcean一起工作。</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="259a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ln">原载于</em><a class="ae kl" href="https://elanderson.net/2018/08/adding-docker-to-an-asp-net-core-application/" rel="noopener ugc nofollow" target="_blank"><em class="ln"/></a><em class="ln">。</em></p></div></div>    
</body>
</html>