<html>
<head>
<title>Entity Framework Core: Show Parameter Values in Logging</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实体框架核心:在日志中显示参数值</h1>
<blockquote>原文：<a href="https://itnext.io/entity-framework-core-show-parameter-values-in-logging-5ac58b6a4929?source=collection_archive---------1-----------------------#2019-03-10">https://itnext.io/entity-framework-core-show-parameter-values-in-logging-5ac58b6a4929?source=collection_archive---------1-----------------------#2019-03-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b8cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">早在10月，我发表了一篇关于<a class="ae kl" href="https://elanderson.net/2018/10/entity-framework-core-logging/" rel="noopener ugc nofollow" target="_blank">实体框架核心:日志记录</a>的文章，其中涵盖了为实体框架核心启用日志记录。这篇文章将对上一篇文章进行扩展，向您展示除了正在使用的SQL语句之外，如何获取查询中使用的参数值。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/f1157a16bc9d550aec1db62888ea13c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xaZo9mj0NisRqBehfeDG0Q.png"/></div></div></figure><h1 id="a281" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">回顾</h1><p id="1ad5" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">这篇文章不会涉及如何设置一个记录器，详情请见<a class="ae kl" href="https://elanderson.net/2018/10/entity-framework-core-logging/" rel="noopener ugc nofollow" target="_blank">这篇</a>前一篇文章。以下是基于前一篇文章在日志中获得的信息。</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="cd15" class="mg kz iq mc b gy mh mi l mj mk">Microsoft.EntityFrameworkCore.Database.Command[20101] Executed DbCommand (41ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30'] SELECT TOP(2) [m].[Id], [m].[Address], [m].[City], [m].[Email], [m].[Name], [m].[Phone], [m].[PostalCode], [m].[State] FROM [Contact] AS [m] WHERE [m].[Id] = @__id_0</span></pre><p id="482a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您需要验证实体框架产生的查询时，这是很有帮助的，但是如果您试图跟踪一个与数据相关的问题，不知道使用了什么参数值可能会很痛苦。</p><h1 id="2385" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">启用日志记录中的参数值</h1><p id="66ea" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">实体框架核心提供了一个选项<a class="ae kl" href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.entityframeworkcore.dbcontextoptionsbuilder.enablesensitivedatalogging" rel="noopener ugc nofollow" target="_blank">启用敏感数据记录</a>。要启用此选项，请打开<strong class="jp ir"> Startup </strong>类，并在<strong class="jp ir"> ConfigureServices </strong>函数中，对您想要打开选项的<strong class="jp ir"> DbContext </strong>的<strong class="jp ir"> AddDbContext </strong>调用进行以下更改。</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="1091" class="mg kz iq mc b gy mh mi l mj mk">Before: services .AddDbContext&lt;ContactsContext&gt;(options =&gt; options.UseSqlServer(Configuration["Data:ContactsContext:ConnectionString"])); After: services .AddDbContext&lt;ContactsContext&gt;(options =&gt; { options.UseSqlServer(Configuration["Data:ContactsContext:ConnectionString"]); options.EnableSensitiveDataLogging(); });</span></pre><p id="1396" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在运行与上面相同的查询，您将看到下面的输出。</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="36c6" class="mg kz iq mc b gy mh mi l mj mk">Microsoft.EntityFrameworkCore.Database.Command[20100] Executing DbCommand [Parameters=[@__id_0='1' (Nullable = true)], CommandType='Text', CommandTimeout='30'] SELECT TOP(2) [m].[Id], [m].[Address], [m].[City], [m].[Email], [m].[Name], [m].[Phone], [m].[PostalCode], [m].[State] FROM [Contact] AS [m] WHERE [m].[Id] = @__id_0</span></pre><p id="a3ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所见，使用启用敏感数据记录，我们获得了ID参数的值，而不是一个问号。</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="3140" class="mg kz iq mc b gy mh mi l mj mk">Before: [Parameters=[@__id_0='?' (DbType = Int32)] After: [Parameters=[@__id_0='1' (DbType = Int32)]</span></pre><h1 id="b6d2" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">包扎</h1><p id="01f5" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">当你需要时，这是一个方便的选择。请小心使用它，因为它可能会暴露应该保密的数据。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><p id="9b7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ms">原载于2019年3月10日</em><a class="ae kl" href="https://elanderson.net/2019/03/entity-framework-core-show-parameter-values-in-logging/" rel="noopener ugc nofollow" target="_blank"><em class="ms">elanderson.net</em></a><em class="ms">。</em></p></div></div>    
</body>
</html>