<html>
<head>
<title>MicroK8s on MacOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MacOS上的MicroK8s</h1>
<blockquote>原文：<a href="https://itnext.io/microk8s-on-macos-98f1de3aa63e?source=collection_archive---------0-----------------------#2018-12-07">https://itnext.io/microk8s-on-macos-98f1de3aa63e?source=collection_archive---------0-----------------------#2018-12-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/1576e7ae24c66655f3b6522f52a574c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*lHqWdP-sHJy4cCTpagt_3A.png"/></div></figure><p id="113c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae ks" href="https://microk8s.io/" rel="noopener ugc nofollow" target="_blank"> MicroK8s </a>是Kubernetes的本地部署。让我们跳过所有的技术细节，只接受Kubernetes不能在MacOS或Windows上运行。你可能会想“我见过Kubernetes在MacOS笔记本电脑上运行，那是什么样的魔法？”很简单，Kubernetes运行在一个虚拟机中。您可能看不到虚拟机，或者它甚至可能不是一个成熟的虚拟系统，但某种程度的虚拟化是存在的。这正是我们将在这里展示的。我们将设置一个虚拟机，并在其中安装MicroK8s。安装完成后，我们将讨论如何使用in-VM-Kubernetes。</p><h1 id="7063" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">MacOS上的多路虚拟机</h1><p id="f449" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">可以说，在MacOS上获得Ubuntu VM最简单的方法是multipass。前往<a class="ae ks" href="https://github.com/CanonicalLtd/multipass/releases" rel="noopener ugc nofollow" target="_blank">发布页面</a>获取最新包。安装它就像双击。pkg文件。</p><p id="ce4e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要使用MicroK8s启动虚拟机，我们需要:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="b83f" class="mf ku iq mb b gy mg mh l mi mj">multipass launch --name microk8s-vm --mem 4G --disk 40G<br/>multipass exec microk8s-vm -- sudo snap install microk8s --classic<br/>multipass exec microk8s-vm -- sudo iptables -P FORWARD ACCEPT</span></pre><p id="0c83" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">请确保您预留了足够的资源来承载您的部署；上面我们得到了RAM的<code class="fe mk ml mm mb b">4GB</code>和硬盘的<code class="fe mk ml mm mb b">40GB</code>。我们还确保去往/来自pod网络接口的数据包可以被转发到/来自默认接口。</p><p id="e21b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们的虚拟机有一个IP地址，您可以使用它进行检查:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="b36e" class="mf ku iq mb b gy mg mh l mi mj">&gt; multipass list<br/>Name                    State             IPv4             Release<br/>microk8s-vm             Running           10.141.241.164   Ubuntu 18.04 LTS</span></pre><p id="4ba0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">请记下此IP，因为我们的服务将在那里提供。</p><p id="d105" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可能会发现其他方便的多通道命令:</p><ul class=""><li id="b8dd" class="mn mo iq jw b jx jy kb kc kf mp kj mq kn mr kr ms mt mu mv bi translated">在虚拟机内部获得一个shell:</li></ul><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="6052" class="mf ku iq mb b gy mg mh l mi mj">multipass shell microk8s-vm</span></pre><ul class=""><li id="a686" class="mn mo iq jw b jx jy kb kc kf mp kj mq kn mr kr ms mt mu mv bi translated">关闭虚拟机:</li></ul><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="9785" class="mf ku iq mb b gy mg mh l mi mj">multipass stop microk8s-vm</span></pre><ul class=""><li id="4063" class="mn mo iq jw b jx jy kb kc kf mp kj mq kn mr kr ms mt mu mv bi translated">删除并清理虚拟机:</li></ul><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="676b" class="mf ku iq mb b gy mg mh l mi mj">multipass delete microk8s-vm <br/>multipass purge</span></pre><h1 id="6c1c" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">使用MicroK8s</h1><p id="66f8" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">要在虚拟机中运行一个命令，我们可以使用以下命令获得一个多通道shell:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="19c7" class="mf ku iq mb b gy mg mh l mi mj">multipass shell microk8s-vm</span></pre><p id="6e64" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要执行命令而不获取shell，我们可以像这样使用<code class="fe mk ml mm mb b">multipass exec</code>:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="2f39" class="mf ku iq mb b gy mg mh l mi mj">multipass exec microk8s-vm -- sudo /snap/bin/microk8s.status</span></pre><p id="b0c7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">与MicroK8s交互的第三种方式是通过Kubernetes API服务器监听VM的端口16443。我们可以使用microk8s' <code class="fe mk ml mm mb b">kubeconfig</code>文件和本地<a class="ae ks" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" rel="noopener ugc nofollow" target="_blank">安装的kubectl </a>来访问in-VM-kubernetes。以下是方法:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="0b3e" class="mf ku iq mb b gy mg mh l mi mj">multipass exec microk8s-vm -- sudo /snap/bin/microk8s.config &gt; kubeconfig</span></pre><p id="e306" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在主机上安装kubectl，然后使用<code class="fe mk ml mm mb b">kubeconfig</code>:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="2dc7" class="mf ku iq mb b gy mg mh l mi mj">kubectl --kubeconfig=kubeconfig get all --all-namespaces</span></pre><h2 id="6c52" class="mf ku iq bd kv mw mx dn kz my mz dp ld kf na nb lh kj nc nd ll kn ne nf lp ng bi translated">访问虚拟机内服务—启用附加组件</h2><p id="7286" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">让我们首先启用dns和仪表板。在本博客的其余部分，我们将展示访问Grafana的不同方法:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="f6b2" class="mf ku iq mb b gy mg mh l mi mj">multipass exec microk8s-vm -- sudo /snap/bin/microk8s.enable dns dashboard</span></pre><p id="e457" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们通过以下方式检查部署进度:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="1c1b" class="mf ku iq mb b gy mg mh l mi mj">&gt; multipass exec microk8s-vm -- sudo /snap/bin/microk8s.kubectl get all --all-namespaces</span></pre><p id="e32d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">所有服务运行后，我们可以继续查看如何访问控制面板。</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/309a802eeebfe3f2c8879f52426ef525.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fhRz3GcN0Pkp5Oppe9U4pw.png"/></div></div><figcaption class="nm nn gj gh gi no np bd b be z dk translated">我们仪表板上的涂鸦</figcaption></figure><h2 id="a4e4" class="mf ku iq bd kv mw mx dn kz my mz dp ld kf na nb lh kj nc nd ll kn ne nf lp ng bi translated">访问虚拟机内服务—使用Kubernetes API代理</h2><p id="9d70" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">API服务器位于我们虚拟机的端口16443上。让我们看看代理路径是什么样子的:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="4d6b" class="mf ku iq mb b gy mg mh l mi mj">&gt; multipass exec microk8s-vm -- sudo /snap/bin/microk8s.kubectl cluster-info<br/>...</span><span id="aab7" class="mf ku iq mb b gy nq mh l mi mj">Grafana is running at <a class="ae ks" href="https://127.0.0.1:16443/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy" rel="noopener ugc nofollow" target="_blank">https://127.0.0.1:16443/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy</a></span><span id="e9a7" class="mf ku iq mb b gy nq mh l mi mj">...</span></pre><p id="931a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">通过将<code class="fe mk ml mm mb b">127.0.0.1</code>替换为虚拟机的IP，在本例中为<code class="fe mk ml mm mb b">10.141.241.164</code>，我们可以在:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="4ccd" class="mf ku iq mb b gy mg mh l mi mj"><a class="ae ks" href="http://10.141.241.164:8080/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy" rel="noopener ugc nofollow" target="_blank">http://</a><a class="ae ks" href="http://10.141.241.164:8080/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy" rel="noopener ugc nofollow" target="_blank">10.141.241.164</a><a class="ae ks" href="http://10.141.241.164:8080/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy" rel="noopener ugc nofollow" target="_blank">:16443/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy</a></span></pre><p id="1499" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您将被要求输入显示在底部的用户名和密码:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="a624" class="mf ku iq mb b gy mg mh l mi mj">&gt; multipass exec microk8s-vm -- sudo /snap/bin/microk8s.config</span></pre><h2 id="593d" class="mf ku iq bd kv mw mx dn kz my mz dp ld kf na nb lh kj nc nd ll kn ne nf lp ng bi translated">访问虚拟机内服务—设置代理</h2><p id="d903" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">与我们上面所做的非常相似，我们可以要求Kubernetes为我们创建一个代理。</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="e83f" class="mf ku iq mb b gy mg mh l mi mj">&gt; kubectl --kubeconfig=kubeconfig proxy<br/>Starting to serve on 127.0.0.1:8001</span></pre><p id="f033" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让代理打开终端。</p><p id="e2f9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在第二个终端上，使用以下命令获取正在运行的服务的代理端点:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="7042" class="mf ku iq mb b gy mg mh l mi mj">&gt; kubectl --kubeconfig=kubeconfig cluster-info</span></pre><p id="3fe0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们通过用<code class="fe mk ml mm mb b">127.0.0.1</code>替换虚拟机的IP和从<code class="fe mk ml mm mb b">https</code>到<code class="fe mk ml mm mb b">http</code>的协议来实现代理。仪表板位于:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="5122" class="mf ku iq mb b gy mg mh l mi mj"><a class="ae ks" href="http://127.0.0.1:8001/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy/?orgId=1" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8001/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy/?orgId=1</a></span></pre><p id="1cd1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你可以在<a class="ae ks" href="https://kubernetes.io/docs/tasks/access-application-cluster/access-cluster/#manually-constructing-apiserver-proxy-urls" rel="noopener ugc nofollow" target="_blank">官方文档中读到更多关于构造代理路径</a>的内容。</p><h2 id="8c4e" class="mf ku iq bd kv mw mx dn kz my mz dp ld kf na nb lh kj nc nd ll kn ne nf lp ng bi translated">访问虚拟机内服务—使用节点端口服务</h2><p id="c5f7" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">我们可以在虚拟机的一个端口中公开我们的服务，并从那里访问它。这种方法使用节点端口服务类型。我们首先确定我们想要公开的部署:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="1e64" class="mf ku iq mb b gy mg mh l mi mj">&gt; multipass exec microk8s-vm -- sudo /snap/bin/microk8s.kubectl get deployment -n kube-system  | grep grafana<br/>monitoring-influxdb-grafana-v4   1         1         1            1           22h</span></pre><p id="be47" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后，我们创建节点端口服务:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="1117" class="mf ku iq mb b gy mg mh l mi mj">multipass exec microk8s-vm -- sudo /snap/bin/microk8s.kubectl expose deployment.apps/monitoring-influxdb-grafana-v4 -n kube-system --type=NodePort</span></pre><p id="03ee" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们现在有一个用于Grafana服务的端口:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="dbb5" class="mf ku iq mb b gy mg mh l mi mj">&gt; multipass exec microk8s-vm -- sudo /snap/bin/microk8s.kubectl get services -n kube-system  | grep NodePort<br/>monitoring-influxdb-grafana-v4   NodePort    10.152.183.84   &lt;none&gt;        8083:32580/TCP,8086:32152/TCP,3000:32720/TCP   13m</span></pre><p id="4e96" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">格拉夫纳在这里映射到<code class="fe mk ml mm mb b">32720</code>的<code class="fe mk ml mm mb b">3000</code>端口上。此端口是随机选择的，因此可能会因您而异。在我们的例子中，服务在<code class="fe mk ml mm mb b">10.141.241.164:32720</code>上可用，即multipass microk8s-vm IP和映射到port grafana的<code class="fe mk ml mm mb b">3000</code>端口的随机端口。</p><h1 id="84ee" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">结论</h1><p id="39d9" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">MacOS(或Windows)上的MicroK8s将需要一个VM来运行。这与任何其他当地的Kubernetes解决方案没有什么不同，它有一些很好的好处。虚拟机为您提供了额外的隔离层。你可以完全控制其他人可以看到什么，而不是使用你的主机并可能向外界公开Kubernetes服务。当然，这种隔离会带来一些额外的管理开销，这可能不适用于开发环境。试一试，然后<a class="ae ks" href="https://microk8s.io/" rel="noopener ugc nofollow" target="_blank">告诉我们</a>你的想法！</p><h1 id="d61e" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">链接</h1><ul class=""><li id="caf4" class="mn mo iq jw b jx lr kb ls kf nr kj ns kn nt kr ms mt mu mv bi translated">微k8s:<a class="ae ks" href="https://microk8s.io/" rel="noopener ugc nofollow" target="_blank">https://microk8s.io/</a></li><li id="4145" class="mn mo iq jw b jx nu kb nv kf nw kj nx kn ny kr ms mt mu mv bi translated">安装库贝克特尔:<a class="ae ks" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" rel="noopener ugc nofollow" target="_blank">https://kubernetes.io/docs/tasks/tools/install-kubectl/</a></li><li id="5a5c" class="mn mo iq jw b jx nu kb nv kf nw kj nx kn ny kr ms mt mu mv bi translated">MacOS上的multipass:<a class="ae ks" href="https://discourse.ubuntu.com/t/multipass-now-available-for-macos/6824" rel="noopener ugc nofollow" target="_blank">https://discourse . Ubuntu . com/t/multipass-now-available-for-MAC OS/6824</a></li><li id="bdc1" class="mn mo iq jw b jx nu kb nv kf nw kj nx kn ny kr ms mt mu mv bi translated">Kubernetes上的服务访问选项:<a class="ae ks" href="https://kubernetes.io/docs/tasks/access-application-cluster/access-cluster/#manually-constructing-apiserver-proxy-urls" rel="noopener ugc nofollow" target="_blank">https://Kubernetes . io/docs/tasks/access-application-cluster/access-cluster/# manually-constructing-API server-proxy-URLs</a></li></ul><div class="nz oa gp gr ob oc"><a href="https://github.com/CanonicalLtd/multipass/releases" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">标准TD/多遍</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">多路编排虚拟Ubuntu实例。通过创建一个…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">github.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq js oc"/></div></div></a></div></div></div>    
</body>
</html>