<html>
<head>
<title>Helm 3.8.0 — OCI Registry Support</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Helm 3.8.0 — OCI注册中心支持</h1>
<blockquote>原文：<a href="https://itnext.io/helm-3-8-0-oci-registry-support-b050ff218911?source=collection_archive---------0-----------------------#2022-02-22">https://itnext.io/helm-3-8-0-oci-registry-support-b050ff218911?source=collection_archive---------0-----------------------#2022-02-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/dcce0f105d958bdfb5e0ed191a9979c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/0*rYlWCct03KkRvRnZ.png"/></div></figure><p id="de4d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">一个令人兴奋的新更新已经进入了最新版本的头盔；即<a class="ae ks" href="https://github.com/helm/helm/releases/tag/v3.8.0" rel="noopener ugc nofollow" target="_blank">舵3.8.0 </a> — OCI注册表支持。公平地说，这个特性作为一个实验性的特性已经存在了几个版本，但是它最终脱离了测试版，进入了正式发布阶段。</p><h1 id="00cb" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">什么是“OCI注册管理机构支持”？</h1><p id="66d1" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">在Docker的早期，容器映像是构建过程中产生的主要工件，也是人们真正关心的唯一工件。您的代码被存储在其他地方，在其他地方被加工，然后被烘焙成映像。然后，您的容器被推到容器注册中心，从那里，您的容器平台可以获取并运行它。因此，容器注册中心只支持作为工件的容器图像——生活是美好的。</p><p id="5fcc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">随着Docker相关技术的成熟，我们开始看到OpenShift和Kubernetes等平台的出现，Helm和Kubernetes等工具也出现了。这些工具中的每一个都会产生自己的工件；在舵的情况下，这些当然是舵图。这些文物从来没有在当时的集装箱景观中得到满足，因此如果你选择的登记处碰巧支持一个<em class="lw">“海图博物馆”</em>，它们总是被随意存放。</p><p id="9394" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">进入OCI或<a class="ae ks" href="https://opencontainers.org/" rel="noopener ugc nofollow" target="_blank">开集装箱倡议</a>。OCI的作用是为所有与集装箱相关的事情提供一个通用标准。直接引用他们的话:</p><blockquote class="lx ly lz"><p id="24f6" class="ju jv lw jw b jx jy jz ka kb kc kd ke ma kg kh ki mb kk kl km mc ko kp kq kr ij bi translated"><strong class="jw ir">开放容器倡议</strong>是一个开放的治理结构，其明确目的是围绕容器格式和运行时创建开放的行业标准。</p></blockquote><p id="2291" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">实际上，OCI所做的是扩展集装箱清单的定义，将其他二进制工件也包括进来，比如舵图。这允许我们像Docker映像一样从Docker注册表中推送和提取图表，从而以与Docker映像相同的方式管理和版本化我们的图表。</p><h1 id="ef96" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">这在Helm 3.8.0中是什么意思？</h1><h2 id="3791" class="md ku iq bd kv me mf dn kz mg mh dp ld kf mi mj lh kj mk ml ll kn mm mn lp mo bi translated">海图博物馆</h2><p id="7cd8" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">对于Helm的日常使用——如果您愿意，图表博物馆的概念以及图表的推拉方式保持不变。Helm 3.8.0支持向后兼容，所以如果你愿意，你可以继续使用图表博物馆机制。</p><p id="9d40" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">图表博物馆的方法也有缺点。部署你的舵图的管道或脚本需要使用第三方舵插件，如<a class="ae ks" href="https://github.com/chartmuseum/helm-push" rel="noopener ugc nofollow" target="_blank">舵推插件</a>来实现这一功能。没有人想安装额外的插件——它们很容易坏，不能保证当新版本出现时它们还能继续工作。在我看来，这个机制总感觉有点笨重。</p><h2 id="e1eb" class="md ku iq bd kv me mf dn kz mg mh dp ld kf mi mj lh kj mk ml ll kn mm mn lp mo bi translated">搬到OCI</h2><p id="3294" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">要在Helm 3.8.0中迁移到OCI，需要进行一些重构。前面提到的插件不再需要，注册中心的认证方式将会改变。下面突出显示了基本命令:</p><p id="0ea0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">登录存储库:</strong></p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="8b0a" class="md ku iq mu b gy my mz l na nb">helm registry login -u &lt;user&gt; &lt;registry&gt;</span></pre><p id="50a1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">将一个工件推送到仓库:</strong></p><p id="8c19" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里的先决条件是首先使用Helm的package命令打包您的图表。</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="18a5" class="md ku iq mu b gy my mz l na nb">helm push &lt;artifact&gt;.tgz oci://&lt;registry&gt;/&lt;repository&gt;</span></pre><p id="8bc9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">从储存库中取回神器:</strong></p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="c32d" class="md ku iq mu b gy my mz l na nb">helm pull oci://&lt;registry&gt;/&lt;repository&gt;/&lt;artifact&gt; --version &lt;version&gt;</span></pre><h1 id="58a2" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">警告</h1><p id="bcda" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">在我的项目上做迁移到OCI图表时，我遇到了OCI注册表的一个缺点——搜索。您必须确切地知道您想要安装哪个工件，以及在您的注册中心的哪个存储库中可以找到它。因此Helm中没有内置注册表范围的搜索功能——根据我的调查,<a class="ae ks" href="https://github.com/helm/helm/issues/9983" rel="noopener ugc nofollow" target="_blank">OCI不支持这一功能。</a></p><p id="9e56" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">例如，假设你有一个注册表，你把10张舵轮图放到各自的存储库中。在这种情况下，无法使用Helm命令请求所有存储库的列表(读取图表)。对于我们的项目，这是一个问题，我们不得不求助于注册表实现的本地API来检索这个列表——在我们的例子中，我们使用<a class="ae ks" href="https://goharbor.io/" rel="noopener ugc nofollow" target="_blank"> Harbor </a>。一旦使用API检索到列表，我们就可以退回到Helm命令来提取图表和/或列出它们的版本。</p><p id="63a9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这对你来说可能不是问题，但在开始之前值得注意。</p></div></div>    
</body>
</html>