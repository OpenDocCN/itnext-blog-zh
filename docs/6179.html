<html>
<head>
<title>Debugging your code in Python — pdb vs. rpdb</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">调试Python中的代码— pdb与rpdb</h1>
<blockquote>原文：<a href="https://itnext.io/debugging-your-code-in-python-pdb-vs-rpdb-e7bb918a8ac3?source=collection_archive---------2-----------------------#2021-09-08">https://itnext.io/debugging-your-code-in-python-pdb-vs-rpdb-e7bb918a8ac3?source=collection_archive---------2-----------------------#2021-09-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2904" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">调试是解决编程问题的重要部分。尽管这是一个有争议的话题，但有很多工具比打印报表好得多。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/40b6cd9d0012621ba84211a3cd1ed407.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Q-QjQHEaGZahyMSJ"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">由<a class="ae kl" href="https://unsplash.com/@yoal_des?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">约尔·德苏尔蒙特</a>在<a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="7c91" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Python附带了一个内置的交互式调试器，称为<strong class="jp ir"> pdb </strong>。</p><p id="440e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Pdb允许您在源代码行级别设置断点和单步执行，检查堆栈帧，列出源代码，并在任何堆栈帧的上下文中评估任意Python代码。事后调试也可以在程序控制下执行。</p><p id="7ce4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后是<strong class="jp ir"> rpdb </strong>，一个基于pdb的远程调试器。它将<em class="lc"> stdin </em>和<em class="lc"> stdout </em>重新路由到一个套接字处理程序，以便您可以调试服务器进程。</p><h1 id="ff18" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">我什么时候在rpdb上使用pdb？</h1><p id="67dc" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">Pdb应该在本地应用程序中使用，而rpdb远程运行，可以用来调试Flask这样的web框架。安装rpdb后，您可以远程启动服务器并运行服务器代码。</p><p id="33b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面我将向您展示在一些简单的应用程序中运行的pdb和rpdb，一个作为脚本运行，另一个启动Flask服务器。确保在Python Repo 中克隆<a class="ae kl" href="https://github.com/diazjf/learn-pydebug" rel="noopener ugc nofollow" target="_blank">调试，以运行本教程中的示例。</a></p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="ad10" class="ml le iq mh b gy mm mn l mo mp">$ git clone <a class="ae kl" href="https://github.com/diazjf/learn-pydebug" rel="noopener ugc nofollow" target="_blank">https://github.com/diazjf/learn-pydebug</a></span><span id="bd6b" class="ml le iq mh b gy mq mn l mo mp">Cloning into 'learn-pydebug'...<br/>remote: Enumerating objects: 18, done.<br/>remote: Counting objects: 100% (18/18), done.<br/>remote: Compressing objects: 100% (14/14), done.<br/>remote: Total 18 (delta 0), reused 15 (delta 0), pack-reused 0<br/>Receiving objects: 100% (18/18), 103.60 KiB | 573.00 KiB/s, done.</span><span id="003e" class="ml le iq mh b gy mq mn l mo mp">$ cd learn-pydebug</span></pre><p id="e231" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:</strong>Python Repo中的<a class="ae kl" href="https://github.com/diazjf/learn-pydebug" rel="noopener ugc nofollow" target="_blank">调试有关于安装和运行应用程序的信息，包括并展示pdb和rpdb。代码中有关于问题所在以及调试如何帮助的注释。</a></p><h1 id="c9e7" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">使用pdb</h1><p id="bde0" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">我们将下面的代码添加到应用程序中希望启动pdb的位置。<a class="ae kl" href="https://github.com/diazjf/learn-pydebug/blob/main/pdb/main.py#L20" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="lc">pdb/main . py</em></strong></a><strong class="jp ir"><em class="lc"/></strong>中的代码包含下面一行:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="b028" class="ml le iq mh b gy mm mn l mo mp"><strong class="mh ir">import</strong> <strong class="mh ir">pdb</strong>; pdb.set_trace()</span></pre><p id="ade0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行python应用程序时，当那个<strong class="jp ir"><em class="lc">pdb . set _ trace()</em></strong>被命中时，pdb会自动启动。</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="a7d2" class="ml le iq mh b gy mm mn l mo mp">$ python pdb/main.py<br/>Enter some words: I am a cat</span><span id="ca0e" class="ml le iq mh b gy mq mn l mo mp">&gt; /Users/fernandodiaz/Desktop/debugging/pdb/main.py(23)&lt;module&gt;()<br/>-&gt; num_chars = count(input)<br/>(Pdb)</span></pre><p id="289d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您将看到pdb已启动。Pdb包含以下<a class="ae kl" href="https://docs.python.org/3/library/pdb.html" rel="noopener ugc nofollow" target="_blank">基本功能</a>，可以在提示符下运行。以下是一些命令运行后的pdb输出示例。</p><ul class=""><li id="0963" class="mr ms iq jp b jq jr ju jv jy mt kc mu kg mv kk mw mx my mz bi translated"><strong class="jp ir"> l(ist):列出当前行周围的行</strong></li></ul><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="7294" class="ml le iq mh b gy mm mn l mo mp">(Pdb) l</span><span id="067b" class="ml le iq mh b gy mq mn l mo mp">18       input = input("Enter some words: ")<br/>19<br/>20       import pdb; pdb.set_trace()<br/>21<br/>22       # count the number if characters<br/><strong class="mh ir">23  -&gt;     num_chars = count(input)</strong><br/>24       print("Number of Characters: %s" % num_chars)</span></pre><ul class=""><li id="b31a" class="mr ms iq jp b jq jr ju jv jy mt kc mu kg mv kk mw mx my mz bi translated"><strong class="jp ir"> w(这里):显示我们当前所在的文件和行号</strong></li></ul><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="33c8" class="ml le iq mh b gy mm mn l mo mp">(Pdb) w</span><span id="1417" class="ml le iq mh b gy mq mn l mo mp">&gt; /Users/fernandodiaz/Desktop/learn-pydebug/pdb/main.py(23)&lt;module&gt;()<br/><strong class="mh ir">-&gt; num_chars = count(input)</strong></span></pre><ul class=""><li id="68c8" class="mr ms iq jp b jq jr ju jv jy mt kc mu kg mv kk mw mx my mz bi translated"><strong class="jp ir"> s(步进):进入当前行的功能</strong></li></ul><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="973e" class="ml le iq mh b gy mm mn l mo mp">(Pdb) s</span><span id="d814" class="ml le iq mh b gy mq mn l mo mp">--Call--<br/>&gt; /Users/fernandodiaz/Desktop/learn-pydebug/pdb/main.py(3)count()<br/><strong class="mh ir">-&gt; def count(message=""):</strong></span></pre><ul class=""><li id="b635" class="mr ms iq jp b jq jr ju jv jy mt kc mu kg mv kk mw mx my mz bi translated"><strong class="jp ir"> n(ext):执行当前行</strong></li></ul><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="f0ce" class="ml le iq mh b gy mm mn l mo mp">(Pdb) n</span><span id="c0ac" class="ml le iq mh b gy mq mn l mo mp">&gt; /Users/fernandodiaz/Desktop/learn-pydebug/pdb/main.py(4)count()<strong class="mh ir"><br/>-&gt; msg = message.split()</strong></span></pre><ul class=""><li id="d14f" class="mr ms iq jp b jq jr ju jv jy mt kc mu kg mv kk mw mx my mz bi translated"><strong class="jp ir"> a(rgs):打印当前函数的参数列表</strong></li></ul><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="0979" class="ml le iq mh b gy mm mn l mo mp">(Pdb) a</span><span id="f158" class="ml le iq mh b gy mq mn l mo mp"><strong class="mh ir">message = 'I am a cat'</strong></span></pre><ul class=""><li id="c6f1" class="mr ms iq jp b jq jr ju jv jy mt kc mu kg mv kk mw mx my mz bi translated"><strong class="jp ir"> p(rint) &lt;名称&gt;:打印&lt;名称&gt; </strong>的值</li></ul><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="7e12" class="ml le iq mh b gy mm mn l mo mp">(Pdb) n</span><span id="050c" class="ml le iq mh b gy mq mn l mo mp">&gt; /Users/fernandodiaz/Desktop/learn-pydebug/pdb/main.py(9)count()<br/><strong class="mh ir">-&gt; if len(msg) &gt; 3:</strong></span><span id="8b5f" class="ml le iq mh b gy mq mn l mo mp">(Pdb) p msg</span><span id="a576" class="ml le iq mh b gy mq mn l mo mp"><strong class="mh ir">['I', 'am', 'a', 'cat']</strong></span></pre><p id="ead5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:</strong>我在pdb测试应用程序上按顺序运行了所有这些命令。</p><p id="d9d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过运行这些命令，我们可以继续进入<strong class="jp ir"> <em class="lc"> count </em> </strong>函数中的下一行，直到我们发现错误。在这个例子中，我们可以看到</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="b0ab" class="ml le iq mh b gy mm mn l mo mp">if len(msg) &gt; 3: <strong class="mh ir"><br/>  </strong>return “TOO MANY WORDS, TRY AGAIN”</span></pre><p id="9ac2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这表明，我们要么需要向消息中添加更多的细节，让用户知道什么是可接受的，要么我们可以将字数调整为字符数。无论我们如何解决它，我们现在可以知道问题在哪里。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi na"><img src="../Images/6cba5821e643135a16950f2e7876c243.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4HWZbqfIiHNE8mb9"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">照片由<a class="ae kl" href="https://unsplash.com/@sigmund?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">西格蒙德</a>在<a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="ed0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然在这里可能看起来不那么令人印象深刻，但pdb在有很多事情要做的大型代码库中确实很有用。</p><h1 id="d0d6" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">使用rpdb</h1><p id="ea13" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">我们将以下内容添加到应用程序中要启动rpdb的位置:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="2544" class="ml le iq mh b gy mm mn l mo mp"><strong class="mh ir">import rpdb;</strong> rpdb.set_trace()</span></pre><p id="18c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:</strong>要识别该命令，必须安装rpdb。它安装在<a class="ae kl" href="https://github.com/diazjf/learn-pydebug#prerequisites" rel="noopener ugc nofollow" target="_blank">先决条件</a>中。</p><p id="5c15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你看一下<a class="ae kl" href="https://github.com/diazjf/learn-pydebug/blob/main/rpdb/remote/routes.py#L13" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="lc">rpdp/remote/routes . py</em></strong></a>，可以看到调试器被添加到了<strong class="jp ir"> <em class="lc"> /count </em> </strong>路由中。我们可以通过安装<a class="ae kl" href="https://github.com/diazjf/learn-pydebug#prerequisites" rel="noopener ugc nofollow" target="_blank">先决条件</a>来运行Flask web服务器，然后运行:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="ee5d" class="ml le iq mh b gy mm mn l mo mp">$ python rpdb/run.py</span><span id="39be" class="ml le iq mh b gy mq mn l mo mp">* Serving Flask app 'remote' (lazy loading)<br/> * Environment: production<br/>   WARNING: This is a development server. Do not use it in a production deployment.<br/>   Use a production WSGI server instead.<br/> * Debug mode: on<br/> * Running on all addresses.<br/>   WARNING: This is a development server. Do not use it in a production deployment.<br/> * Running on <a class="ae kl" href="http://192.168.1.147:5000/" rel="noopener ugc nofollow" target="_blank"><strong class="mh ir">http://192.168.1.147:5000/</strong></a> (Press CTRL+C to quit)<br/> * Restarting with stat<br/> * Debugger is active!<br/> * Debugger PIN: 926-264-267</span></pre><p id="3e57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在单独的终端中，我们可以向运行应用程序的端点发送请求。</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="cccb" class="ml le iq mh b gy mm mn l mo mp">$ curl -X POST<strong class="mh ir"> </strong><a class="ae kl" href="http://192.168.1.147:5000/count" rel="noopener ugc nofollow" target="_blank"><strong class="mh ir">http://192.168.1.147:5000/count</strong></a> -d '{"message": "This is a message"}'<br/></span></pre><p id="08b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我们发送一条消息，这条消息最初导致服务器抛出一个400。在调试器存在的情况下，这个请求导致应用程序挂起，并允许我们检查调试器，看看发生了什么。为此，我们可以在单独的终端中运行以下命令:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="eaa5" class="ml le iq mh b gy mm mn l mo mp">$ nc 127.0.0.1 4444</span><span id="9255" class="ml le iq mh b gy mq mn l mo mp">&gt; /Users/fernandodiaz/Desktop/debugging/rpdb/remote/routes.py(15)add_note()<br/>-&gt; if not msg:<br/>(Pdb)</span></pre><p id="6226" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们可以像使用pdb一样运行命令，以确定为什么我们的消息会出现400。</p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><p id="ed0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本教程提供了基础知识。还有其他使用这些调试器的方法，以及更多的命令，可以在<a class="ae kl" href="https://docs.python.org/3/library/pdb.html" rel="noopener ugc nofollow" target="_blank"> pdb </a>和<a class="ae kl" href="https://pypi.org/project/rpdb/" rel="noopener ugc nofollow" target="_blank"> rpdb </a>文档中看到。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ni"><img src="../Images/5f66ea0881ed209fe4530afa85e89f20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*To7KRnZFq_BwzNjM"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">照片由<a class="ae kl" href="https://unsplash.com/@jstrippa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">詹姆斯·哈里森</a>在<a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="64cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读，我希望你喜欢！要了解更多内容，并跟上我写的内容，请在twitter上关注我🐦</p></div></div>    
</body>
</html>