<html>
<head>
<title>OAuth 2 with React Native keeping Expo</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OAuth 2与React本地保护博览会</h1>
<blockquote>原文：<a href="https://itnext.io/oauth-2-with-react-native-keeping-expo-18e8bfbb71c1?source=collection_archive---------3-----------------------#2018-10-16">https://itnext.io/oauth-2-with-react-native-keeping-expo-18e8bfbb71c1?source=collection_archive---------3-----------------------#2018-10-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9e12bcbc3b2fce1e6c12cf2ffdbcb52a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JbrRVknEg6VP1sZvIUq1UQ.jpeg"/></div></div></figure><p id="a702" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我是一个无摩擦的人，开发人员，主要是因为<strong class="ka ir">我喜欢创建新应用</strong>的过程，我喜欢使用它们并享受这个过程，试图<strong class="ka ir">尽可能避免花费在手动部署配置过程上的时间</strong>。基本上，<strong class="ka ir">比起解决配置问题，我更喜欢花时间去做这些事情</strong>。</p><p id="dfe5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://facebook.github.io/react-native/" rel="noopener ugc nofollow" target="_blank"> React Native </a> (RN)是移动开发领域的一项改变游戏规则的技术，为了将React代码透明地转换为本机代码，在后台发生了许多神奇的事情。</p><p id="dd67" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是在没有Expo的情况下使用RN会让你不得不处理Xcode、Android Studio来生成包并将你的应用部署到Play和App Store，这意味着不得不处理更多依赖于两个完全不同的平台的配置<a class="ae kw" href="https://cocoapods.org/" rel="noopener ugc nofollow" target="_blank"> cocoapods </a>和<a class="ae kw" href="https://developer.apple.com/swift/" rel="noopener ugc nofollow" target="_blank"> swift </a>用于iOS，以及<a class="ae kw" href="https://gradle.org/" rel="noopener ugc nofollow" target="_blank"> gradle </a>和<a class="ae kw" href="https://java.com/en/" rel="noopener ugc nofollow" target="_blank"> Java </a>用于Android。</p><p id="1617" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这就是为什么<a class="ae kw" href="https://expo.io/" rel="noopener ugc nofollow" target="_blank"> Expo </a>的存在是有意义的。</p><h1 id="6288" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">为什么与RN合作时如此需要Expo</h1><p id="5bfa" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我不得不说,<code class="fe ma mb mc md b"><a class="ae kw" href="https://github.com/react-community/create-react-native-app" rel="noopener ugc nofollow" target="_blank">create-react-native-app</a></code>的默认输出产生了一个React Native + Expo项目，所以我们不需要做任何特殊的事情来启动和运行Expo。</p><p id="b13f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对我来说，在expo上设置项目是有意义的，原因如下:</p><ul class=""><li id="a213" class="me mf iq ka b kb kc kf kg kj mg kn mh kr mi kv mj mk ml mm bi translated">解决测试脚手架问题。</li><li id="bd0c" class="me mf iq ka b kb mn kf mo kj mp kn mq kr mr kv mj mk ml mm bi translated">允许您在真实设备上执行和使用应用程序，而无需将您的设备设置为开发设备</li><li id="9b85" class="me mf iq ka b kb mn kf mo kj mp kn mq kr mr kv mj mk ml mm bi translated">生成<code class="fe ma mb mc md b"><a class="ae kw" href="https://en.wikipedia.org/wiki/.ipa" rel="noopener ugc nofollow" target="_blank">.ipa</a></code> (iOS应用商店包)和<code class="fe ma mb mc md b"><a class="ae kw" href="https://en.wikipedia.org/wiki/Android_application_package" rel="noopener ugc nofollow" target="_blank">.apk</a></code> (Android包)，通过他们的服务器部署到应用商店，而不必处理XCode(这使得必须拥有Mac电脑)和JDK。</li><li id="a540" class="me mf iq ka b kb mn kf mo kj mp kn mq kr mr kv mj mk ml mm bi translated">附加功能，如隧道部署(允许网络外的设备在开发期间尝试您的应用)。</li><li id="cbc2" class="me mf iq ka b kb mn kf mo kj mp kn mq kr mr kv mj mk ml mm bi translated">一个工具，只需点击一下，就可以通过CLI或浏览器打开仿真器。</li><li id="1ec4" class="me mf iq ka b kb mn kf mo kj mp kn mq kr mr kv mj mk ml mm bi translated">并提供他们自己的<a class="ae kw" href="https://docs.expo.io/versions/latest/sdk" rel="noopener ugc nofollow" target="_blank"> SDK </a>以透明的方式处理特定设备的可能性。</li></ul><p id="26e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如我之前所说的，最好的一点是，<strong class="ka ir">配置是通过</strong> <code class="fe ma mb mc md b"><strong class="ka ir">create-react-native-app</strong></code>解决的</p><h1 id="e951" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">我们的第一个身份认证解决方案</h1><p id="ea94" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在<a class="ae kw" href="https://www.precursive.com/" rel="noopener ugc nofollow" target="_blank">前期</a>，当我们开始在React原生应用程序中使用<a class="ae kw" href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_rest_intro.htm" rel="noopener ugc nofollow" target="_blank"> Apex Rest API </a>时，我们还需要以不同于我们在Salesforce开发中使用的任何其他应用程序的方式来解决身份验证问题。</p><p id="385b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我试着遵循官方文档，在Salesforce的案例中，使用了<a class="ae kw" href="https://developer.salesforce.com/developer-centers/mobile" rel="noopener ugc nofollow" target="_blank"> Salesforce Mobile SDK </a>和<code class="fe ma mb mc md b">forcereact create</code>，正如他们的<code class="fe ma mb mc md b"><a class="ae kw" href="https://trailhead.salesforce.com/en/modules/mobile_sdk_react_native/units/mobilesdk_reactnative_create_app" rel="noopener ugc nofollow" target="_blank">trailhead</a></code>中所描述的</p><p id="26c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个<code class="fe ma mb mc md b">react-native-force</code>模块提供了4个带有有用的Salesforce实用程序<code class="fe ma mb mc md b">'import {oauth, network, smartstore, smartsync} from 'react-native-force';</code>的包，我们可以使用<code class="fe ma mb mc md b">oauth.authenticate</code>登录到Salesforce，但是这个项目没有使用expo。</p><blockquote class="ms mt mu"><p id="6b45" class="jy jz mv ka b kb kc kd ke kf kg kh ki mw kk kl km mx ko kp kq my ks kt ku kv ij bi translated"><em class="iq">总之；</em> <strong class="ka ir"> <em class="iq">好而无摩擦的</em> </strong> <em class="iq">方案但是因为它生成的项目用的是</em><code class="fe ma mb mc md b"><em class="iq">react-native-force</em></code><em class="iq"/><strong class="ka ir"><em class="iq">它没有用expo </em> </strong> <em class="iq">。它使用</em> <code class="fe ma mb mc md b"><em class="iq">forceios</em></code> <em class="iq">和</em> <code class="fe ma mb mc md b"><em class="iq">forceandroid</em></code> <em class="iq">原生模块生成依赖的iOS和Android代码。</em></p></blockquote><h1 id="e4d6" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">带RN的其他O Auth2</h1><p id="b406" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Salesforce为<a class="ae kw" href="https://help.salesforce.com/articleView?id=remoteaccess_authenticate.htm" rel="noopener ugc nofollow" target="_blank">应用提供OAuth </a>认证，因此OAuth看起来像用于认证的标准。</p><p id="4ec6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以我检查了不同的RN库来解决这个问题。</p><ul class=""><li id="ea1a" class="me mf iq ka b kb kc kf kg kj mg kn mh kr mi kv mj mk ml mm bi translated"><a class="ae kw" href="https://github.com/adamjmcgrath/react-native-simple-auth" rel="noopener ugc nofollow" target="_blank"> OAuth登录React Native </a>。这个工具为社交网络(谷歌、脸书、推特和Tumblr)提供了简单的设置。</li><li id="2c6c" class="me mf iq ka b kb mn kf mo kj mp kn mq kr mr kv mj mk ml mm bi translated"><a class="ae kw" href="https://github.com/fullstackreact/react-native-oauth" rel="noopener ugc nofollow" target="_blank"> react-native-oauth </a>为OAuth 1.0和OAuth 2.0提供接口，支持react原生应用的以下提供者(Twitter、脸书、Google、Github和Slack)</li><li id="2321" class="me mf iq ka b kb mn kf mo kj mp kn mq kr mr kv mj mk ml mm bi translated"><a class="ae kw" href="https://github.com/FormidableLabs/react-native-app-auth" rel="noopener ugc nofollow" target="_blank">React Native App Auth</a>React Native bridge for App Auth——一个用于与OAuth2提供者通信的SDK，<strong class="ka ir">这是我认为看起来更标准的一个，</strong>。</li></ul><p id="dea6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">但是它们都使用本地模块，expo目前不支持它们</strong>，这意味着我们需要<a class="ae kw" href="https://docs.expo.io/versions/latest/expokit/eject" rel="noopener ugc nofollow" target="_blank">弹出</a>应用程序来安装这些库，这意味着项目中没有Expo😢。</p><h1 id="1c03" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">我们的“不要离开世博会”解决方案</h1><p id="c96e" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">因此，在接受OAuth库与Expo不兼容的事实之前，我检查了Expo SDK，发现了一些可以用来解决我们的问题的东西。</p><p id="3c4d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个包已经包含在Expo中，所以基本上，我们只需要用它来登录。</p><p id="6f66" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里有一个简单快捷的<code class="fe ma mb mc md b">SignInScreen</code>组件，显示如何使用Expo Auth-session登录到Salesforce(当然，我们还需要按照<a class="ae kw" href="https://developer.salesforce.com/page/Connected_Apps" rel="noopener ugc nofollow" target="_blank"> SF说明</a>正确设置连接的应用程序)。</p><pre class="mz na nb nc gt nd md ne nf aw ng bi"><span id="8894" class="nh ky iq md b gy ni nj l nk nl">import React, { Component } from 'react';<br/>import { SF_OAUTH_URL, REMOTE_ACCESS_CONSUMER_KEY } from 'react-native-dotenv';<br/>import { AsyncStorage, Button, View, Text } from 'react-native';<br/>import { AuthSession } from 'expo';<br/>import { globalStyles } from '../constants/Styles';<br/>import ScreenKeys from '../constants/ScreenKeys';</span><span id="233a" class="nh ky iq md b gy nm nj l nk nl">export default class SignInScreen extends Component {<br/>  static navigationOptions = {<br/>    title: 'Please sign in',<br/>  };</span><span id="0222" class="nh ky iq md b gy nm nj l nk nl">state = {<br/>    errorCode: null,<br/>  };</span><span id="3d28" class="nh ky iq md b gy nm nj l nk nl">_signInAsync = async () =&gt; {<br/>    const { navigation } = this.props;<br/>    const redirectUrl = AuthSession.getRedirectUrl();<br/>    const result = await AuthSession.startAsync({<br/>      authUrl:<br/>        `${SF_OAUTH_URL}` +<br/>        `?response_type=token` +<br/>        `&amp;client_id=${REMOTE_ACCESS_CONSUMER_KEY}` +<br/>        `&amp;prompt=login` +<br/>        `&amp;redirect_uri=${encodeURIComponent(redirectUrl)}`,<br/>    });<br/>    console.log(result);<br/>    const { type, errorCode = 'You cancel or dismissed the login' } = result;<br/>    if (type === 'success') {<br/>      // Just simple way to store the token in this examples<br/>      await AsyncStorage.setItem('userToken', JSON.stringify(result));<br/>      navigation.navigate(ScreenKeys.main);<br/>    } else {<br/>      /**<br/>       * Result types can be: cancel, dismissed or error (with errorCode)<br/>       */<br/>      this.setState({ errorCode });<br/>    }<br/>  };</span><span id="0207" class="nh ky iq md b gy nm nj l nk nl">render() {<br/>    const { errorCode } = this.state;<br/>    return (<br/>      &lt;View style={globalStyles.container}&gt;<br/>        &lt;Button title="Sign in!" onPress={this._signInAsync} /&gt;<br/>        {errorCode ? &lt;Text&gt;{errorCode}&lt;/Text&gt; : null}<br/>      &lt;/View&gt;<br/>    );<br/>  }<br/>}</span></pre><blockquote class="ms mt mu"><p id="c25b" class="jy jz mv ka b kb kc kd ke kf kg kh ki mw kk kl km mx ko kp kq my ks kt ku kv ij bi translated"><em class="iq">通过这些步骤，</em> <strong class="ka ir"> <em class="iq">我们可以通过RN应用程序登录到Salesforce组织，然后使用</em> </strong> <code class="fe ma mb mc md b"><strong class="ka ir"><em class="iq">Apex Rest API</em></strong></code> <em class="iq">并像任何其他标准Rest服务器一样使用Salesforce服务器，使我们的开发工作成为</em> <strong class="ka ir"> <em class="iq">标准和无摩擦的</em> </strong> <em class="iq">尽可能保持Expo🚀。</em></p></blockquote></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><p id="b49b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mv">原载于</em><a class="ae kw" href="https://robertovg.com/blog/o-auth-2-with-react-native-keeping-expo" rel="noopener ugc nofollow" target="_blank"><em class="mv">robertovg.com</em></a><em class="mv">。</em></p></div></div>    
</body>
</html>