<html>
<head>
<title>Healing a high-throughput legacy API — Azure migration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">修复高吞吐量遗留API — Azure迁移</h1>
<blockquote>原文：<a href="https://itnext.io/healing-a-high-throughput-legacy-api-azure-migration-df0cc65d07d4?source=collection_archive---------2-----------------------#2020-06-03">https://itnext.io/healing-a-high-throughput-legacy-api-azure-migration-df0cc65d07d4?source=collection_archive---------2-----------------------#2020-06-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="7a10" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在伦敦的第一个月，我加入了一家为其他电子商务提供服务的公司，通过从用户的浏览器接收信息，然后提供:</p><ul class=""><li id="d28b" class="ko kp it js b jt ju jx jy kb kq kf kr kj ks kn kt ku kv kw bi translated">丢失的转换产品(如通过电子邮件发送未购买的购物篮)</li><li id="d29a" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">分析，转化漏斗</li></ul><p id="fb1b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这篇文章中，我们将讨论接收所有流量、处理以及我们如何发展架构的技术挑战。这有助于您理解决策和改进，以便从中学习。</p><p id="3038" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是系统的架构:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/61db7de1e2f3e946bd15e7a5fbd1f302.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1_Ela-uICSmc0SpnWkVMcw.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">架构图—绘制于<a class="ae ls" href="https://draw.io" rel="noopener ugc nofollow" target="_blank"> draw.io </a></figcaption></figure><p id="73c2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们正在讨论的API称为DataReceiver，它接收一个请求并将其添加到Microsoft消息队列中，然后一个Windows服务插入到数据库中。该API具有巨大的吞吐量，在正常情况下超过10，000个请求/秒。</p><h2 id="60a7" class="lt lu it bd lv lw lx dn ly lz ma dp mb kb mc md me kf mf mg mh kj mi mj mk ml bi translated">一切都着火了！</h2><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/d85198838ad2a50ac5b67870834ba053.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*7atv2QaX4HXiu9Sp"/></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">这很好，米姆由KC绿色</figcaption></figure><p id="1cdf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我参与了这个项目，因为黄盒子正在开发中，任何时候他们试图发布这个新的拷贝流，都会使整个应用程序离线。一旦创建了这个队列，远程API就无法无延迟地接收10，000个请求/秒，导致队列在大约126，000条消息时被填满。一旦队列变满，游戏就结束了。</p><p id="3974" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这种情况下，你会建议或做什么？</p><p id="ee31" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我的第一个难题是，如果我们有10，000条消息/秒，我们只能将126，000条消息排队，一个缓慢的消息消费者(windows服务)只需要13秒就可以让整个事情崩溃。</p><p id="b44f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当向队列发送消息时，需要序列化消息体中的内容。此应用程序正在以二进制序列化程序格式发送消息。您可能认为二进制是高效的，但是。net framework能让你大吃一惊。</p><p id="efb0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">“上快速搜索。net连载比较”让我看到了这篇<a class="ae ls" href="https://maxondev.com/serialization-performance-comparison-c-net-formats-frameworks-xmldatacontractserializer-xmlserializer-binaryformatter-json-newtonsoft-servicestack-text/" rel="noopener ugc nofollow" target="_blank">的博文</a>。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/55532cd8ddf3d0e8f7c6f43c1e9596bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*_24Zwt-0TVRUEbXkzWYDCQ.png"/></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">序列化比较图表</figcaption></figure><p id="12d0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们发现二进制文件在大小和序列化时间上都比它的同类文件，甚至是JSON和XML要大得多。由于这是一个高吞吐量的API，我决定使用MsgPack，它将我们的消息大小减少了90%。我们可以对更多的消息进行排队，比如100万条消息，但是100万条消息低于每秒10，000个请求，不需要很长时间就可以填满队列。</p><h2 id="df15" class="lt lu it bd lv lw lx dn ly lz ma dp mb kb mc md me kf mf mg mh kj mi mj mk ml bi translated">还在燃烧</h2><p id="4f9a" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">让我们回到架构:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/61db7de1e2f3e946bd15e7a5fbd1f302.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1_Ela-uICSmc0SpnWkVMcw.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">建筑图—在<a class="ae ls" href="https://draw.io" rel="noopener ugc nofollow" target="_blank"> draw.io </a>绘制</figcaption></figure><p id="919c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你在这里还能发现什么问题？</p><p id="1023" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">两个主要的是:</p><ul class=""><li id="73b6" class="ko kp it js b jt ju jx jy kb kq kf kr kj ks kn kt ku kv kw bi translated">消息队列没有冗余。如果虚拟机关闭时有消息在里面会怎样？</li><li id="5d85" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">如果要通过复制消息的方式向多个消费者广播一条消息，这正常吗？</li></ul><p id="d5e3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我想解决的第一件事是消息的无冗余性，我的目标是用API在虚拟机之外的某个地方聚集一个队列。那时我为RabitMQ、Kafka和Azure Service Bus做POC。</p><p id="2c75" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了方便和。net SDK支持，Azure Service Bus是明显的赢家。使用Azure服务的唯一挑战是我们仍然在本地，因此延迟可能是一个问题。</p><p id="6401" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当处理如此高的流量时，记得为你的场景优化SDK，例如，这些<a class="ae ls" href="https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-performance-improvements?tabs=net-standard-sdk" rel="noopener ugc nofollow" target="_blank">微软推荐</a>。一旦证明优化的延迟非常低，我们就开始在服务总线中使用主题。</p><p id="f13c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这让我们有了这个架构:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi ms"><img src="../Images/7ff52e1604c91e2ee7ceb696da7d0477.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ykufcwOEdKwEuHzV8sR9-A.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">建筑图—在<a class="ae ls" href="https://draw.io" rel="noopener ugc nofollow" target="_blank"> draw.io </a>绘制</figcaption></figure><p id="4432" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好处是:</p><ul class=""><li id="3f66" class="ko kp it js b jt ju jx jy kb kq kf kr kj ks kn kt ku kv kw bi translated">我们现在有了一个很大的消息集群，Azure Service Bus支持在一个主题下排队的高达80GB的数据。这给了我们更大的犯错空间。</li><li id="3007" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">Azure服务总线实现了一个发布者/订阅者模式，因此我们可以发布一次消息，并拥有多个侦听器。</li></ul><h2 id="166d" class="lt lu it bd lv lw lx dn ly lz ma dp mb kb mc md me kf mf mg mh kj mi mj mk ml bi translated">序列化不兼容</h2><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi mt"><img src="../Images/e299b3ebe91c4006a23d6fa4f1e7e644.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0jH9fulYBR7bzpwJWgHkrw.jpeg"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">弗雷德里克·图比尔蒙特在<a class="ae ls" href="https://unsplash.com/s/photos/plug?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="3cae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的听众向我们提出，MsgPack对他们使用的语言没有很好的支持，比如Java/Python。回到POC模式，我查看了协议缓冲区、Avro和Thrift。</p><p id="7db8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">节俭在这种情况下是赢家，因为它允许我定义一个消费者可以从中产生客户的契约。</p><h2 id="6090" class="lt lu it bd lv lw lx dn ly lz ma dp mb kb mc md me kf mf mg mh kj mi mj mk ml bi translated">手动部署</h2><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi mu"><img src="../Images/e4c96966b05e501ac4e31d93ead33b42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8INM0qpXymhlH4kiVSvqQg.jpeg"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">约翰·穆切特在<a class="ae ls" href="https://unsplash.com/s/photos/manual-work?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="53fc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如图中所提到的，在我们的主要生产环境中，我们有12个该API的生产实例。每当我们进行部署时，必须有人登录到每台虚拟机，进行部署并希望一切顺利。</p><p id="80b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">手动部署的缺点，尤其是在这种情况下:</p><ul class=""><li id="b616" class="ko kp it js b jt ju jx jy kb kq kf kr kj ks kn kt ku kv kw bi translated">它们是不可审计的</li><li id="6ec1" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">部署是有风险的</li><li id="4207" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">痛苦的是，他们花了几个小时的体力劳动。你知道什么是最好的吗？当我们不得不回滚时，部署人员可能想杀了我们。</li></ul><p id="13e8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当时，该公司决定通过Octopus Deploy实现部署自动化。我帮助实现了测试环境的自动化，并参与了凌晨2点的第一次部署。</p><h2 id="0ffc" class="lt lu it bd lv lw lx dn ly lz ma dp mb kb mc md me kf mf mg mh kj mi mj mk ml bi translated">风险很高，所以我们在这里进行了第一次部署:</h2><p id="8097" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">Octopus上的部署正如您所预期的那样顺利。但是后来我们意识到我们的API通过URL关闭了。然后，我们打电话给我们的主办公司，请求infra团队的帮助，但我们仍然在努力。经过4个小时的折磨，有人发现我们的部署缺少一个HTML文件，负载平衡器用它来进行健康检查。</p><p id="de44" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">教训是:</p><blockquote class="mv"><p id="b68a" class="mw mx it bd my mz na nb nc nd ne kn dk translated">当部署是手动的时，可能会有任何地方都没有记录的手动步骤。</p></blockquote><h2 id="d047" class="lt lu it bd lv lw nf dn ly lz ng dp mb kb nh md me kf ni mg mh kj nj mj mk ml bi translated">没有能见度</h2><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nk"><img src="../Images/4d52e8778a2b5313b8038394fae94a8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NSuOVlinIbIaA_ZC"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">马库斯·斯皮斯克在<a class="ae ls" href="https://unsplash.com/s/photos/foggy?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="13cb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以前，我们的系统通过屏幕上的仪表板和文本日志文件进行某种监控。老实说，就我目前的标准而言，我们对应用程序中发生的事情缺乏了解。</p><p id="49bd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我团队中的一个同事在Azure App Insights中做了一个概念验证，这是一个多么大的改变。我们现在可以看到:</p><ul class=""><li id="40ff" class="ko kp it js b jt ju jx jy kb kq kf kr kj ks kn kt ku kv kw bi translated">我们收到了多少请求。</li><li id="85e3" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">多少人成功了/失败了。</li><li id="0882" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">可以绘制成图表的异常日志。</li></ul><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nl"><img src="../Images/9799e3fc5fe8b100bc6c6bbaddea51f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Fi1G6lLsRjlHkDbK.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">应用洞察仪表板示例</figcaption></figure><p id="5157" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这样，我们发现大约10%的请求失败了，管理层认为这是我们的一个高优先级，因为我们可能会损失10%的收入，他们只能看到这一点，因为我们最终可以看到这个API中发生了什么。</p><p id="4b08" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> Azure虚拟机迁移</strong></p><p id="e266" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的基础设施团队在Azure迁移方面做得非常出色，他们将这些本地虚拟机迁移到Azure中的IaaS，这为我们带来了更好的结果:</p><ul class=""><li id="7876" class="ko kp it js b jt ju jx jy kb kq kf kr kj ks kn kt ku kv kw bi translated">自动化供应</li><li id="1435" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">易于扩展</li></ul><h1 id="4f61" class="nm lu it bd lv nn no np ly nq nr ns mb nt nu nv me nw nx ny mh nz oa ob mk oc bi translated">下一阶段</h1><p id="ae1a" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">在所有这些改进之后，系统的稳定性得到了很好的排序，我们有了快速/安全的部署，对正在发生的事情的可见性，以及对慢消息消费者的余量。</p><p id="22cd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">两件事开始浮现出来:</p><ul class=""><li id="3808" class="ko kp it js b jt ju jx jy kb kq kf kr kj ks kn kt ku kv kw bi translated">这些消息被完全处理的速度有时比我们的功能所承诺的要慢。</li><li id="f7e5" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">在azure中，处理我们的消息的SQL数据库花费了一大笔钱。</li></ul><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi ms"><img src="../Images/ae2dcbe32a5b3787dc865e9a33f634e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6aQ4tcqY3eblA6jnZ2WVFg.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">架构图—在<a class="ae ls" href="https://draw.io" rel="noopener ugc nofollow" target="_blank"> draw.io </a>绘制</figcaption></figure><p id="ecc3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些消息在SQL Server中以大数据规模进行处理，然后存储在最终的数据库中。这是我们处理速度的瓶颈。</p><p id="f2dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这种情况下你会怎么做？SQL是为了处理数百万个事件，然后编译成可理解的记录而构建的吗？</p><p id="5934" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以像以前一样用SQL实现这一点，但这并不理想，所以我开始寻找替代方案。我在找大数据处理工具，偶然发现了Apache Spark和Apache Storm。</p><p id="393b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当时的微软正在推出一项名为HD Insights的服务，这是Apache Storm的PaaS，它可以运行C# bingo！我花了几天时间创建SQL处理内部的图表，直到我们对它在做什么有了基本的了解。</p><h2 id="ebf7" class="lt lu it bd lv lw lx dn ly lz ma dp mb kb mc md me kf mf mg mh kj mi mj mk ml bi translated">推出新系统</h2><p id="f24e" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">使用服务总线的一个优点是，我们可以监听另一个订阅中的消息，处理消息并与现有的数据库进行比较。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi od"><img src="../Images/db7731cb2a384871bd7538d57060a20a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D1cSM_iLI-eeEsvPW6z2xw.png"/></div></div></figure><p id="7f14" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们达到了99.99%的匹配，所以我们很高兴推出。我们推出了两个生产环境，进展非常顺利，但一旦我们尝试推出我们的最高吞吐量环境，Azure HD Insights就会崩溃，而且不会告诉我们原因。</p><p id="b632" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该团队在与微软进行了无数次对话后，决定部署他们自己的Apache Storm，并用Java重写消息处理器。所以我的教训是:</p><blockquote class="mv"><p id="3e23" class="mw mx it bd my mz na nb nc nd ne kn dk translated">小心基于语言偏好的框架选择。</p></blockquote><p id="b769" class="pw-post-body-paragraph jq jr it js b jt oe jv jw jx of jz ka kb og kd ke kf oh kh ki kj oi kl km kn im bi translated">如果最初的东西是用Java构建的，即使有一个学习曲线，也可能是一个更好的选择。我有过同样的场景，我们在。net，不用说，我们必须迁移到Java，这样我们才能导入Jar文件。</p><h1 id="cdd4" class="nm lu it bd lv nn no np ly nq nr ns mb nt nu nv me nw nx ny mh nz oa ob mk oc bi translated">结论</h1><p id="c841" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">这是一个巨大的项目，在不到一年的时间里取得了令人难以置信的进展。这是一个真正的团队努力，所以我要感谢所有同事的帮助。</p><p id="587f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">主要学习内容:</p><ul class=""><li id="6810" class="ko kp it js b jt ju jx jy kb kq kf kr kj ks kn kt ku kv kw bi translated">如果一条消息需要多个侦听器，请使用发布者/订阅者。</li><li id="b8f2" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">确保您的消息队列有冗余。</li><li id="ca08" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">部署应该是自动化的。</li><li id="d1e3" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">你需要了解你的应用。</li><li id="8e1b" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">虽然你可以在数据库中进行处理，但要怀疑它是否是这项工作的最佳工具。</li></ul></div></div>    
</body>
</html>