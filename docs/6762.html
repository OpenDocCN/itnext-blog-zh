<html>
<head>
<title>Setting up a NodeJS API with TypeScript: Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用TypeScript设置NodeJS API:第1部分</h1>
<blockquote>原文：<a href="https://itnext.io/setting-up-a-nodejs-api-with-typescript-part-1-9f7c152b2af6?source=collection_archive---------3-----------------------#2022-02-20">https://itnext.io/setting-up-a-nodejs-api-with-typescript-part-1-9f7c152b2af6?source=collection_archive---------3-----------------------#2022-02-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ade3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">实践介绍</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8df46f597f2d1d05d320453caf3340e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5GuaR5wzdmOWJa0FyuGegw.jpeg"/></div></div></figure><h1 id="77bd" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">介绍</h1><p id="5a2f" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">使用TypeScript开发API时，有许多风格可供选择。像NestJS、LoopBack和其他一些框架要么建立在TypeScript之上，要么提供对它的支持。但是，如果您想设置一个快速的服务器，并且不使用包含电池的框架，那么该怎么办呢？本文的目的是帮助您快速获得一个简约而完整的服务器并运行。</p><p id="85e0" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">本文面向至少对NodeJS开发有点熟悉的开发人员，它不会详细解释使用的每个概念。这里可以看到完整的代码<a class="ae mn" href="https://github.com/TudorIoanMarin/nodejs-ts-v1" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="aace" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">先决条件</h1><ul class=""><li id="91cc" class="mo mp it lo b lp lq ls lt lv mq lz mr md ms mh mt mu mv mw bi translated">NodeJS ≥ v14.15.0</li><li id="3f9c" class="mo mp it lo b lp mx ls my lv mz lz na md nb mh mt mu mv mw bi translated">你选择的编辑</li><li id="88af" class="mo mp it lo b lp mx ls my lv mz lz na md nb mh mt mu mv mw bi translated"><a class="ae mn" href="https://github.com/nvm-sh/nvm" rel="noopener ugc nofollow" target="_blank"> nvm </a>(可选)</li></ul><p id="dee4" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">在撰写本文时，我选择使用Node的LTS版本:v16.13.1</p><h1 id="efff" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">入门指南</h1><p id="a311" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我们将从创建一个新项目并初始化我们选择的包管理器开始，我将使用npm。这将提示您一系列的选择，现在使用默认的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk translated">创建初始文件夹结构的命令</figcaption></figure><p id="b01e" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">创建app.ts和server.ts文件使我们能够将API声明与网络问题分离开来。这将有助于测试，因为我们现在可以模拟HTTP调用。</p><p id="b389" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">首先，我们需要安装更多的依赖项。为了便于开发，我们将使用Express来处理路线。Express是一个用于NodeJS的极简web框架。它不支持TypeScript，但是我们可以找到Node和Express的声明文件。这将允许我们访问类、接口、类型和基本上大多数的TypeScript好东西。然而，请记住这些文件只是类型声明，它们是<strong class="lo iu">而不是实际的源代码</strong>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="8c95" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">目前，我们将创建一个简单的“Hello，World！”在app.ts文件中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="80f5" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">然后我们将它导入server.ts文件，并使用它来创建一个HTTP服务器:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h1 id="5b96" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">添加类型脚本支持和林挺</h1><p id="289d" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">运行以下命令会将TypeScript作为开发依赖项安装，并创建一个tsconfig.json文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="ca6d" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">在删除了所有带注释的样板文件后，它看起来会像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="a964" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">为了设置构建过程的输出目录并获得一个sourcemap，我们将向其中添加以下代码行。sourcemap将允许我们查看映射到原始代码的对我们构建的任何引用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="f2f3" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">要生成tslint.json文件，请运行以下命令:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="daf5" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">配置文件将扩展推荐的tslint规则，但是您可以根据自己的喜好进行混合和匹配。例如，如果您希望跳过林挺错误，直到我们稍后添加日志程序，您可以将无控制台规则的严重性更改为如下警告:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h1 id="754b" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">发出命令</h1><p id="cc0a" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">现在我们有几个命令可以运行来与我们的项目进行交互，我们将会非常频繁地使用这些命令。我们将添加一个<strong class="lo iu"> Makefile </strong>，而不是仅仅依赖于<strong class="lo iu"> package.json </strong>脚本。这将导致更短的命令和未来的证明，我们可以编写外壳代码，并在它变得复杂时仍然保持可读。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/d47a9c72ef58ba7eb5263c44757cace7.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*lvTBnjr2WzNVf3cyZi4drw.gif"/></div></figure><p id="35e7" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">但是首先，我们需要安装更多的依赖项:<strong class="lo iu"> nodemon </strong>和<strong class="lo iu"> ts-node </strong>。Nodemon 主要是一个开发工具，它会在检测到源代码中的变化时重启服务器，这是开发的理想选择。<strong class="lo iu"> ts-node </strong>使我们能够执行类型脚本代码，而不需要构建步骤。同样，这将简化开发过程。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="ef63" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">在我们的<strong class="lo iu"> package.json </strong>中，我们将定义四个命令:<strong class="lo iu"> lint、build、start </strong>和<strong class="lo iu"> start:dev。</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="807a" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lo iu"> lint </strong>命令执行它所说的:lint在src文件夹下找到的代码并输出任何错误和警告。构建命令将生成我们的应用程序的JavaScript构建和dist文件夹中的源地图。<strong class="lo iu"> start </strong>和<strong class="lo iu"> start:dev </strong>的区别在于，dev命令将直接执行类型脚本代码，而start命令将运行已经编译好的代码。</p><p id="d257" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">在我们的makefile中，我们将在上述脚本的基础上构建一个更全面的服务器生命周期命令集。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="df8b" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">现在我们只需为每个进程调用<strong class="lo iu"> make &lt; command &gt; </strong>。</p><h1 id="e76b" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">环境变量设置</h1><p id="6ba1" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">服务器将在不同的环境中运行，所以让我们轻松地配置可能会改变的属性。例如，我们可能希望服务器在本地3000端口上运行，但是当它部署到云上时，它在8080端口上运行。</p><p id="85d1" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">在当地。被git忽略的env文件将允许我们轻松地配置这些值，这样就不需要修改代码就能以不同的方式运行我们的代码。将API键之类的敏感信息保存在。因为它不会被推送到git。让我们看看我们是如何做到这一点的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="cf19" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">Dotenv提供了自己的类型定义，所以我们不需要为它安装额外的类型定义。接下来，我们需要在应用程序的根目录下创建一个. env文件，并将以下几行添加到该文件中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="ed5e" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我们需要在server.ts文件中对其进行配置:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="f0b4" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">服务器启动后，该端口已用于记录消息。换一个。启动服务器时，env将导致日志发生变化。NODE_ENV属性用于表示服务器是以开发模式还是生产模式运行。这可以在很多情况下帮助我们，其中一个我们将在接下来讨论日志时看到。</p><h1 id="140e" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">记录</h1><p id="109f" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">调试和监控不再在您的机器上本地运行的服务器带来了挑战。然而，访问它的日志以及适当的错误处理应该是一个好的起点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/2a78c925ab7fdde805c31695688af711.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*O2JWSa5EGmkKrX4Vmoa3Xw.gif"/></div></figure><p id="7d4a" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我们将使用一个名为Winston的库来处理日志部分。Winston是一个流行的日志库，它将自己定义为一个几乎所有事情的日志记录器。这些日志可以由不同的第三方服务获取，以便于访问。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="4a4d" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我们将为记录器做一个基本配置，创建3个传输。一个只将错误记录到一个文件中，一个将所有内容记录到一个文件中，一个控制台传输也将记录到控制台中。最后一个将依赖于我们的环境，因为我们只在开发时需要它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="725a" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">colorize方法为控制台日志添加了一些颜色，以提高可读性。现在，我们可以根据严重性导入记录器和日志，而不是使用console.log。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h1 id="1c79" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">结论</h1><p id="424e" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">结果是一个在幕后使用TypeScript的服务器，有一组现成的命令，可以在开发和生产中运行。它还被设置为使用环境变量，并且有一个日志记录器。这足够开始了吗？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/2d64a9691c1a17c343656525ebb4998f.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*FQ6gBgIdHck36ENNFasONA.gif"/></div></figure><p id="3890" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">算是吧。我们有一个很好的起点，但我们错过了一些东西。本系列的第2部分完成了服务器样板文件，并探讨了测试、安全性和容器化等主题。一定要去看看！</p><p id="64a0" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">本文中介绍的所有主题都可以深入兔子洞，所以如果您对更深入的后续内容感兴趣，请告诉我。</p><p id="725b" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">如果你觉得这篇文章有帮助，鼓掌并分享它，这样它会帮助更多的人。有问题吗？在<a class="ae mn" href="https://www.linkedin.com/in/tudor-ioan-marin-89870848/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上给我留言。</p></div></div>    
</body>
</html>