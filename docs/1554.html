<html>
<head>
<title>How TDD Can Prevent Over-Engineering</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TDD如何防止过度工程化</h1>
<blockquote>原文：<a href="https://itnext.io/how-tdd-can-prevent-over-engineering-1265a02f8863?source=collection_archive---------2-----------------------#2018-11-22">https://itnext.io/how-tdd-can-prevent-over-engineering-1265a02f8863?source=collection_archive---------2-----------------------#2018-11-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5522" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一个可以强迫你只写你需要的代码的纪律</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/6307ca0a5a1e56fab372484f8c04f68d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hrqVZSit6lBy98F0ySpHxA.jpeg"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">一个留着短胡须的秃顶男人的照片。他在桌子上用电脑，面带微笑。这是<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/the-missing-practical-step-by-step-test-driven-development-a7140ca4b71">第一帖</a>中照片上的同一个光头男子，只是现在他周围没有了阴影。</figcaption></figure><p id="495a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">重构至关重要。它允许您用最少的努力修改代码的结构。在关于<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/the-missing-practical-step-by-step-test-driven-development-a7140ca4b71">“放债人杰克”</a>的故事的最后一章中，你将看到TDD作为一种<a class="ae kf" href="https://hackernoon.com/how-to-fix-the-software-industry-c2b627ec3d9d" rel="noopener ugc nofollow" target="_blank">纪律</a>如何防止你落入<a class="ae kf" href="https://hackernoon.com/how-to-accept-over-engineering-for-what-it-really-is-6fca9a919263" rel="noopener ugc nofollow" target="_blank">过度工程</a>的陷阱。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="e0b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/the-missing-practical-step-by-step-test-driven-development-a7140ca4b71">的第一篇文章</a>中，我以杰克的故事开始，一个放债人寻找更好的方法来计算他的贷款利息。</p><p id="6880" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">事情是这样的:</p><blockquote class="lz ma mb"><p id="bdab" class="kw kx mc ky b kz la jr lb lc ld ju le md lg lh li me lk ll lm mf lo lp lq lr ij bi translated">嗨，我是杰克。我的业务是发放贷款。我可以给你一笔小额贷款，但是如果你这么做了，我会对超过一定限额的每一美元收取利息。</p><p id="b018" class="kw kx mc ky b kz la jr lb lc ld ju le md lg lh li me lk ll lm mf lo lp lq lr ij bi translated">你能为我做一些计算吗？</p><p id="23e5" class="kw kx mc ky b kz la jr lb lc ld ju le md lg lh li me lk ll lm mf lo lp lq lr ij bi translated">0美元到2000美元=无利息</p><p id="6d1d" class="kw kx mc ky b kz la jr lb lc ld ju le md lg lh li me lk ll lm mf lo lp lq lr ij bi translated">从2001美元到5000美元=每美元9美分</p><p id="c1c0" class="kw kx mc ky b kz la jr lb lc ld ju le md lg lh li me lk ll lm mf lo lp lq lr ij bi translated">5001美元到10000美元=每美元14美分</p><p id="b0e5" class="kw kx mc ky b kz la jr lb lc ld ju le md lg lh li me lk ll lm mf lo lp lq lr ij bi translated">10001美元+ =每美元21美分</p></blockquote><p id="231b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第一篇文章<a class="ae kf" href="https://medium.com/p/a7140ca4b71" rel="noopener">之后，Jack最终开发出了一个产品，可以计算2000美元以上的每一美元的0.09美元的利息，直到无穷大。这是问题的第一个边界。在第二篇文章</a>之后，Jack最终开发出了一个产品，它可以为超过5000美元的每一美元计算0.14美元的利息。</p><p id="1a1b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在是时候为下一个边界开发代码，并重构代码以消除重复。这一次，代码需要为10000美元以上的每一美元计算0.21美元的利息。</p><p id="0bb1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像以前一样，有一个<a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/commits/v3" rel="noopener ugc nofollow" target="_blank">存储库</a>，在这里您可以看到每次测试运行的一次提交。该存储库显示了单独提交中的红/绿/重构步骤。</p><ul class=""><li id="0bea" class="mg mh iq ky b kz la lc ld lf mi lj mj ln mk lr ml mm mn mo bi translated">提交有一个🔴当它代表<strong class="ky ir">红色</strong>步骤时。</li><li id="0843" class="mg mh iq ky b kz mp lc mq lf mr lj ms ln mt lr ml mm mn mo bi translated">当提交代表绿色的<strong class="ky ir">步骤时，它有一个绿色的✅。</strong></li><li id="d559" class="mg mh iq ky b kz mp lc mq lf mr lj ms ln mt lr ml mm mn mo bi translated">提交有一个🔨当它代表<strong class="ky ir">重构</strong>步骤时。</li></ul><p id="fdc3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们开始吧。</p><blockquote class="mu"><p id="d7e4" class="mv mw iq bd mx my mz na nb nc nd lr dk translated">杰克对目前的结果很满意。没有比这更好的了…是吗？</p></blockquote><p id="117d" class="pw-post-body-paragraph kw kx iq ky b kz ne jr lb lc nf ju le lf ng lh li lj nh ll lm ln ni lp lq lr ij bi translated">在<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/this-is-the-one-thing-nobody-told-you-about-tdd-7f549254cd74">的最后一篇文章</a>中，您学习了如何编写代码来计算5000美元以上贷款金额的0.14美元利息。您可以按照相同的模式为10000美元以上的贷款金额创建利息代码。</p><p id="4736" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一步是为低于下一个范围的一美元创建一个通过测试。为此创建测试的原因是，您可以回顾现有算法的工作原理:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/commit/70cd0b164eacb6db11cdd0a1405f54d286df7c8a" rel="noopener ugc nofollow" target="_blank"> ✅加考贷款金额为10000.00美元</a></figcaption></figure><p id="f610" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，您可以为下一个范围内的第一美元创建一个测试。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/commit/c4e334baf216e25fa2ebf267c58733b5d54ee581" rel="noopener ugc nofollow" target="_blank">🔴添加10001.00美元贷款金额的测试</a></figcaption></figure><p id="fb4b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你预计现有的每1美元兑换0.14美元的算法仍然有效。因此，测试失败时会显示一条有意义的消息。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nl"><img src="../Images/f80ad86d468737be5030eb6b27faa775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dAquOqW_yA7g3glSpUEkOw.png"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">10001美元贷款金额测试失败的屏幕截图。它预计值970.21美元。相反，它得到970.14美元。</figcaption></figure><p id="723c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在按照<a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/compare/a9c2ee4085d8e82a9256909239b2585f788d301d...ea640a56f0df1141f6103edd63d90019462a804f" rel="noopener ugc nofollow" target="_blank">与<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/this-is-the-one-thing-nobody-told-you-about-tdd-7f549254cd74">上一篇文章</a>相同的步骤</a>。隔离前一个条件中大于$5000的贷款金额的范围，并在新条件中开发大于$10000的贷款金额的利息:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/commit/153e370bf66c9dc81033b341b8750a8a1593fcfa" rel="noopener ugc nofollow" target="_blank">🔴使用之前的代码作为10001.00美元贷款金额的参考</a></figcaption></figure><p id="d59f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果是一个有很多重复代码的新条件。此外，测试失败是因为您忽略了计算2000美元以上0.09美元和5000美元以上0.14美元利息的规则:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nm"><img src="../Images/00d3544afaa8137181083ae1e711a14b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XvSCJ5ayp-5cCYNjZGAFKA.png"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">隔离前面的范围并创建用于计算超过$10000的贷款金额的代码后，测试失败的屏幕截图。它预计值970.21美元。相反，它得到0.07美元。</figcaption></figure><p id="267a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦您复制了超过$5000的贷款金额的计算，错误消息会发生变化:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/commit/b06c220303037d227c7278620100edda9d4a5424" rel="noopener ugc nofollow" target="_blank">🔴复制大于5000.00美元</a>的贷款金额的逻辑</figcaption></figure><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nn"><img src="../Images/0907d96f74b3fe8841ca85e7eaa93f4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P8MYcGLnRYEIU2WvU8MILQ.png"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">当您复制超过$5000的贷款金额的计算时，测试失败的屏幕截图。它预计值970.21美元。相反，它得到250.12美元。</figcaption></figure><p id="8109" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦您复制了2000美元以上贷款金额的计算，测试就通过了:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/commit/8d0fc82d315d02c5af90ae4aab26a51b65a3383e" rel="noopener ugc nofollow" target="_blank"> ✅复制贷款金额大于2000.00美元的逻辑</a></figcaption></figure><p id="b1dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是删除所有幻数后代码的样子:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://gist.github.com/FagnerMartinsBrack/620790572bdd7875d6fb4284eff95411" rel="noopener ugc nofollow" target="_blank">代码</a>显示了应用<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/this-is-the-one-thing-nobody-told-you-about-tdd-7f549254cd74">上一篇</a>相同步骤后的结果，包括所有的复制。</figcaption></figure><p id="5c57" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在这看起来很混乱。代码有很多重复，到处都是硬编码的值。然而，这种混乱的代码是由测试驱动的。因此，它包含了许多可以带来深刻发现的模式。</p><p id="92e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了揭示这些模式，你需要<a class="ae kf" href="https://medium.com/@fagnerbrack/how-to-refactor-a-public-interface-317ed18d38a3" rel="noopener">重构</a>。您需要在不改变代码行为的情况下对代码进行小的修改。当你应用一个模块/类/函数的改变时，比如保存，程序的行为不会改变。</p><p id="1e72" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是为什么从<a class="ae kf" href="https://medium.com/@fagnerbrack/code-review-and-test-driven-development-4c19b69b5761" rel="noopener">测试开始至关重要的原因——首先是</a>。如果你不写测试——首先，很难确保你测试的是正确的东西，并且当你重构时系统的行为不会改变。同样的，如果没有实践Test- <strong class="ky ir"> Driven </strong>，很难理解你是根据<a class="ae kf" href="http://blog.cleancoder.com/uncle-bob/2013/05/27/TheTransformationPriorityPremise.html" rel="noopener ugc nofollow" target="_blank">转换优先级前提</a>来提高还是降低转换的级别。</p><blockquote class="mu"><p id="f4e7" class="mv mw iq bd mx my mz na nb nc nd lr dk translated">当你改变代码时，你知道你在重构，下面的情况仍然成立:代码的<a class="ae kf" href="http://blog.cleancoder.com/uncle-bob/2013/05/27/TheTransformationPriorityPremise.html" rel="noopener ugc nofollow" target="_blank">转换层次</a>没有降低，测试保持绿色，并且遵循相同模式的未来测试也将保持绿色。</p></blockquote><p id="f0cb" class="pw-post-body-paragraph kw kx iq ky b kz ne jr lb lc nf ju le lf ng lh li lj nh ll lm ln ni lp lq lr ij bi translated">此时，代码对每个条件都有重复。消除重复的一个有效方法是创建一个函数，这个函数的参数是变化的值。</p><p id="73bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，事先很难知道新功能应该是什么样子。如果你想增加测试一直保持绿色的机会，并保持较小的变化，你可以从<a class="ae kf" href="https://medium.com/javascript-scene/master-the-javascript-interview-what-is-a-pure-function-d1c076bec976" rel="noopener">纯函数</a>开始，这些函数<strong class="ky ir">对它们的目的非常具体</strong>。您可以在以后修改它们，使其更加通用。</p><p id="8e38" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也就是说，当贷款金额高于$2000时，创建一个新的利率计算函数。将函数放在离提取的代码更近的地方是一个好主意，这样可以看到参数应该在哪个位置。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/commit/0dae8d7dca69ba228f2eee7399087ccb3603bbcb" rel="noopener ugc nofollow" target="_blank">🔨创建一个函数来计算大于$2000.00的利息</a></figcaption></figure><p id="c946" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之后，将计算利息的函数提升到主函数“利息支付”之外的范围是一个好主意。虽然这违反了<a class="ae kf" href="https://medium.com/@fagnerbrack/the-strictness-principle-9997e483cafb" rel="noopener">严格性原则</a>，该原则规定您应该只将变量保存在使用它们的范围内，但是这也允许您验证函数没有访问任何外部变量，即“副作用”如果你创建的函数可以访问外部变量，就很难改变它。如果测试在移动后没有中断，这意味着函数没有副作用。</p><p id="4e51" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在确保测试通过之后，将函数提升到作用域之外，并在其他地方替换逻辑。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/commit/408a2cd4b046672ed462c393f37253cb0cf4cfff" rel="noopener ugc nofollow" target="_blank">🔨提升函数以计算大于2000.00美元的利息</a></figcaption></figure><blockquote class="mu"><p id="3e44" class="mv mw iq bd mx my no np nq nr ns lr dk translated">当您将代码重构为一个新函数时，请验证它是否没有副作用。</p></blockquote><p id="f964" class="pw-post-body-paragraph kw kx iq ky b kz ne jr lb lc nf ju le lf ng lh li lj nh ll lm ln ni lp lq lr ij bi translated">如果您对其他每一个计算都做同样的事情，您最终会得到如下所示的代码:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/blob/7751e6903d56c3ece05652bc3940bcdd6d3f664e/index.html#L38-L75" rel="noopener ugc nofollow" target="_blank">为每个计算创建一个函数后的条件代码</a>。</figcaption></figure><p id="4bed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你还是有重复的，但是看起来比以前好多了。有一个函数处理2000美元，一个函数处理5000美元，另一个函数处理10000美元。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/blob/7751e6903d56c3ece05652bc3940bcdd6d3f664e/index.html#L10-L26" rel="noopener ugc nofollow" target="_blank">代码</a>显示了计算每个范围的函数的实现。</figcaption></figure><p id="6156" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当你重构的时候，如果有重复，保持函数尽可能的相似是很重要的。作为人类，我们是模式识别生物。如果你有看起来一样的代码，理解问题和发现有意义的模式就容易多了。</p><p id="4e9c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，计算超过$2000的贷款金额的第一个函数缺少一个参数，与其他函数的参数数量相同。你可以修好它。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/commit/6fa4b940f35d088f14bc3079dab4c0a237cd33e1" rel="noopener ugc nofollow" target="_blank">🔨添加函数的最后一个参数，以计算超过$2000.00的贷款</a></figcaption></figure><p id="b618" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，所有函数的内部变量和参数都有不同的名称。让我们把它们变得一样。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/commit/9c1093bdc3e2088d756d034eb73d9b7e7520cedc" rel="noopener ugc nofollow" target="_blank">🔨将函数内部重命名为通用名称</a></figcaption></figure><p id="c737" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您现在可以看到，所有的函数都接受相同的东西:</p><ul class=""><li id="f9c3" class="mg mh iq ky b kz la lc ld lf mi lj mj ln mk lr ml mm mn mo bi translated">贷款金额。</li><li id="6388" class="mg mh iq ky b kz mp lc mq lf mr lj ms ln mt lr ml mm mn mo bi translated">表示“范围结束”的数量</li><li id="0eba" class="mg mh iq ky b kz mp lc mq lf mr lj ms ln mt lr ml mm mn mo bi translated">表示“每美元的利息”的金额</li><li id="4dba" class="mg mh iq ky b kz mp lc mq lf mr lj ms ln mt lr ml mm mn mo bi translated">表示“以前每美元的利息”的金额</li></ul><p id="cf41" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“贷款金额”是一个固定值。只有在主要功能“支付利息”的上下文中，输入才会发生变化“贷款金额”的值在每次计算的执行过程中不会改变。</p><p id="b079" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其他的论点是不同的:</p><ol class=""><li id="3d07" class="mg mh iq ky b kz la lc ld lf mi lj mj ln mk lr nt mm mn mo bi translated">根据正在运行的计算，代码使用不同的参数值“范围结束”、“每美元利息”和“每美元以前利息”来调用函数。</li><li id="a209" class="mg mh iq ky b kz mp lc mq lf mr lj ms ln mt lr nt mm mn mo bi translated">计算每个范围利息的函数使用位置的<a class="ae kf" href="http://connascence.io/position.html" rel="noopener ugc nofollow" target="_blank">从属关系作为其参数，而不是名称</a>的<a class="ae kf" href="http://connascence.io/name.html" rel="noopener ugc nofollow" target="_blank">从属关系。那是一个</a><a class="ae kf" href="https://medium.com/@fagnerbrack/code-smell-92ebb99a62d0" rel="noopener">不好的代码气味</a>。</li></ol><p id="3892" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要解决不好的代码味道，并发现为什么代码用不同的参数调用函数，您可以应用<a class="ae kf" href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" rel="noopener ugc nofollow" target="_blank"> DRY </a>方法。创建一个表示变化参数的对象文字，然后<a class="ae kf" href="https://medium.com/@fagnerbrack/how-to-solve-the-challenge-of-reusability-ac4edce069c9" rel="noopener">重用</a>它们。您可以从2000美元以上的贷款额的计算范围开始:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/commit/70f37b57de09b248056596293fd19dbba45f78c3" rel="noopener ugc nofollow" target="_blank">🔨将大于2000.00美元的贷款范围存储在对象文字中</a></figcaption></figure><p id="0b86" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，作为第二步，在函数之外提升对象文本。假设这是一个<a class="ae kf" href="https://medium.com/@fagnerbrack/how-to-refactor-a-public-interface-317ed18d38a3" rel="noopener">接口中断变更</a>，您需要更新其他条件中的所有外部函数调用，以使测试保持绿色。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/commit/07f8e7a20c076428134054ba86efb7e884b5f3de" rel="noopener ugc nofollow" target="_blank">🔨提高2000.00美元以上贷款金额的范围</a></figcaption></figure><p id="d1c8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您对其他范围做同样的事情，并完全删除重复的内容，您将得到一段代码，它揭示了一种新的模式:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/blob/d886524c857c48a572d37aa3f98044a3efc00374/index.html#L16-L49" rel="noopener ugc nofollow" target="_blank">删除所有计算利息的函数并用一个通用函数替换后的代码</a>。</figcaption></figure><p id="c3eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以看到导致该结果的<a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/compare/9c1093bdc3e2088d756d034eb73d9b7e7520cedc...d886524c857c48a572d37aa3f98044a3efc00374" rel="noopener ugc nofollow" target="_blank">提交</a>。</p><p id="1c8a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在您重构了代码，您可以看到只有一个返回，即“利息金额”，但是代码在每个条件中都复制了它。</p><p id="ee0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们消除重复:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/commit/649a980a165fd3d45b8a3f4188216c7bfb060704" rel="noopener ugc nofollow" target="_blank">🔨仅使用一个“利息金额”变量返回</a></figcaption></figure><p id="ebfb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在仔细看看代码:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/blob/649a980a165fd3d45b8a3f4188216c7bfb060704/index.html#L21-L30" rel="noopener ugc nofollow" target="_blank">显示前两个条件的代码</a>。第3行和第6行有重复。</figcaption></figure><p id="f4d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以看到贷款额大于$5000的条件重复了贷款额大于$2000的计算。它重复的原因是第一个条件仅在贷款金额小于$5001时运行。</p><p id="bcac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以转储第一个条件的右侧条件。如果这样做，您可以修复重复:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/commit/a38331bfdea55191a98930c97d23c67ef78fe229" rel="noopener ugc nofollow" target="_blank">🔨删除大于2000.00美元</a>的贷款金额的重复项</figcaption></figure><p id="e420" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以对其余的代码做同样的事情:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/commit/b426e865f1f5486d828753ce3699c772e53fdaff" rel="noopener ugc nofollow" target="_blank">🔨删除大于5000.00美元的贷款金额的重复项</a></figcaption></figure><p id="66a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果如下:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/blob/b426e865f1f5486d828753ce3699c772e53fdaff/index.html#L16-L35" rel="noopener ugc nofollow" target="_blank">显示每个条件处理一个计算的代码</a>。</figcaption></figure><p id="b759" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的代码清楚地显示了如果“贷款金额”大于2000美元、5000美元或10000美元，算法如何计算利息。</p><p id="e6bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在是令人兴奋的时刻:</p><p id="b194" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当你重构代码，使每个组件彼此相似，并去除<a class="ae kf" href="https://medium.com/@fagnerbrack/code-smell-92ebb99a62d0" rel="noopener">不好的代码味道</a>时，不仅代码变得易于维护，而且你还会更好地理解你试图解决的<a class="ae kf" href="https://levelup.gitconnected.com/the-problem-you-solve-is-more-important-than-the-code-you-write-d0e5493132c6" rel="noopener ugc nofollow" target="_blank">问题的模式</a>。这样，你知道你是在朝着正确的方向进行概括，而不是猜测或过度设计。</p><blockquote class="mu"><p id="860e" class="mv mw iq bd mx my mz na nb nc nd lr dk translated">在测试驱动开发中，你只需要写你需要的代码。没别的了。</p></blockquote><p id="b8ea" class="pw-post-body-paragraph kw kx iq ky b kz ne jr lb lc nf ju le lf ng lh li lj nh ll lm ln ni lp lq lr ij bi translated">您可以看到的另一件有趣的事情是，在范围和对它们运行计算的代码之间存在解耦。您可以将范围提取到一个JSON配置文件中。如果这样做，Jack可以通过修改配置文件来修改代码的行为。他不需要每次想要修改遵循相同模式的行为时都向开发人员付费。</p><p id="87f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您不想将范围提取到配置文件中，您仍然可以重构代码以强调解耦。当您强调解耦时，您也有助于提高代码的可读性，不管您是否将数据移动到配置文件中。</p><blockquote class="mu"><p id="9cfd" class="mv mw iq bd mx my mz na nb nc nd lr dk translated">测试驱动开发可以让你理解问题，创造更多的价值。</p></blockquote><figure class="nu nv nw nx ny kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/commit/3b1f5229ae3ac651ad144d91ae35896924af8651" rel="noopener ugc nofollow" target="_blank">🔨将每个范围移动到范围数组中</a></figcaption></figure><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/commit/43198498c83f4f9d6abd32f6115c7ebf4c869b96" rel="noopener ugc nofollow" target="_blank">🔨用动态索引替换循环中的常量索引访问</a></figcaption></figure><p id="079d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样！下面是最终的代码:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kf" href="https://github.com/FagnerMartinsBrack/jack-the-moneylender/blob/57933066a5bc460bed699968c3f3f556f85f7cdc/index.html#L16-L34" rel="noopener ugc nofollow" target="_blank">应用了这篇文章中的所有重构后的最终代码</a>。</figcaption></figure><p id="f9fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于“<a class="ae kf" href="https://en.wikipedia.org/wiki/Cynefin_framework" rel="noopener ugc nofollow" target="_blank">显而易见的</a>”领域内的问题，你不会感受到TDD的大部分好处。在“显而易见”的领域中，原因和结果是非常清楚的，并且情况是稳定的。</p><p id="e617" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于那些被<a class="ae kf" href="https://en.wikipedia.org/wiki/Cynefin_framework" rel="noopener ugc nofollow" target="_blank"> Cynefin框架</a>描述为“复杂”的问题，你会感受到TDD的大部分好处在“复杂”的领域中，因果关系并不明显，需要更多的分析。测试驱动开发是帮助你进行分析的一个很好的工具，因为它允许你问正确的问题。</p><p id="b5f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“显而易见的”域的一个例子是向一个网站发送一个HTTP POST请求，该请求包含一些简单的数据，并且没有身份验证。您可以在命令行中使用curl和run。</p><p id="1076" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“复杂”领域的一个例子是创建内容管理系统。在CMS 中，你需要在每一步问正确的问题，以获得关于领域如何工作的知识。</p><blockquote class="mu"><p id="22b7" class="mv mw iq bd mx my mz na nb nc nd lr dk translated">当你处理“复杂的”问题而不是“明显的”问题时，你会感受到TDD的大部分好处。</p></blockquote><p id="bb0c" class="pw-post-body-paragraph kw kx iq ky b kz ne jr lb lc nf ju le lf ng lh li lj nh ll lm ln ni lp lq lr ij bi translated">如果你在<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/the-missing-practical-step-by-step-test-driven-development-a7140ca4b71">第一篇文章</a>之后一直在读这篇文章，现在你应该能够理解“放债人杰克”问题的每一个细节。这意味着您可以继续尽可能多地重构代码，并且确信您不会无意中引入错误。</p><p id="5893" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">测试驱动的开发和重构听起来可能是一个乏味的过程。然而，和任何技能一样，随着时间的推移，你会变得更好。通过练习，你的速度会增加。下次您遇到类似的问题时，您可能会更早地发现这些模式，并在很短的时间内完成所有这些工作。</p><p id="5bab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">杰克不仅仅选择任何人来解决他的问题。</p><p id="6550" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">他选择了职业程序员。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="d826" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">又见</strong> <a class="ae kf" href="https://medium.com/@fagnerbrack/you-dont-know-tdd-691efe670094" rel="noopener">你不知道的TDD </a>。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="6d80" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读。如果你有一些反馈，请通过<a class="ae kf" href="https://twitter.com/FagnerBrack" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae kf" href="https://www.facebook.com/fagner.brack" rel="noopener ugc nofollow" target="_blank">脸书</a>或<a class="ae kf" href="http://github.com/FagnerMartinsBrack" rel="noopener ugc nofollow" target="_blank"> Github </a>联系我。</p><p id="6094" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢<a class="ae kf" href="http://jay.bazuzi.com/" rel="noopener ugc nofollow" target="_blank"> Jay Bazuzi </a>、<a class="nz oa ep" href="https://medium.com/u/c4ccb3ab8d17?source=post_page-----1265a02f8863--------------------------------" rel="noopener" target="_blank"> Ian Tinsley </a>和<strong class="ky ir"> Kali </strong>对这篇文章的深刻见解。</p></div></div>    
</body>
</html>