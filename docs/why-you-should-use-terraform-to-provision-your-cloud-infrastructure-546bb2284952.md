# 为什么您应该使用 Terraform 来配置您的云基础架构

> 原文：<https://itnext.io/why-you-should-use-terraform-to-provision-your-cloud-infrastructure-546bb2284952?source=collection_archive---------3----------------------->

![](img/9b7f67f6ea6046e179eeaa0cbc8cb1bd.png)

我以前写过关于开发人员参与他们构建的应用程序的部署和基础设施的价值。在我的文章[使用云计算将开发与运营相结合](https://medium.com/helpful-human/blending-dev-with-ops-using-cloud-computing-d966197ab3d1)中，我提到了运营的历史，以及开发人员如何长期以来一直将他们的代码扔给 IT/基础架构团队，而不关注它是如何部署的。

这一切都很好，但我在那篇文章中没有给出很多可以帮助开始融合开发和运营的具体方法。今天我想看看我们可以用来做这件事的工具之一，即 Terraform。

# 部署第一

当我与一心向市场交付产品的产品团队交谈时，我发现最有趣的事情之一是他们很少考虑部署它。他们花了这么多时间来考虑他们的应用程序将如何在市场上击败它的所有细节，他们需要的所有功能，以及需要多长时间才能获得 MVP。但最终，他们就像一只追逐汽车的狗，一旦他们得到了它，他们不知道该怎么办。

事实证明，要想用你的市场碾压它，你必须让产品能够进入市场。

我在同时扮演开发人员和 DevOps 人员的角色中学到的一件事是，考虑如何部署和考虑要部署什么一样重要。

是什么样的建筑？我们希望它使用什么域？它需要什么类型的可用性？它是面向所有人还是只面向您的内部团队？数据在哪里？我们需要一个数据库吗？

问题层出不穷。有时他们明显与 DevOps 有关，有时他们模糊了界限。这就解释了为什么这件事会一直拖到最后。当你还在试图确定主要产品并弄清楚它在野外会是什么时，这些问题很难回答。

我可以告诉你的是，一旦你有了一个可用的 MVP，如果你还在问这种问题，你已经落后了，需要一些时间来赶上基础设施。

所有这些都是这篇文章的重点，但首先从部署开始很重要的一点是，在 Terraform 这样的工具出现之前，这并不是一个很好的话题。

当部署只是将代码下载到服务器机架中的一个盒子上并运行启动脚本的脚本时，没有理由首先讨论部署。Ops 只会处理刚才说的“给我代码和如何运行它的指令，我会让它运行起来”。当你只是使用 AWS、GCP 或 Azure 控制台来手动设置网络和负载平衡器以及你的应用程序需要在云中运行的所有东西时，情况也是如此。

然后出现了像 Terraform 这样的代码基础设施(IaC ),突然间你可以在开发的同时构思部署。您可以设置管道，通过代码推送自动部署和测试早期版本的应用程序。随着您的成长，您可以开始对基础架构进行版本控制的调整，并了解应用程序在现实世界中是如何工作的。

现在我知道，并非所有这些事情都是 Terraform 特有的，但在使用 Terraform 大约 5 年后，我总结了 10 个理由，说明为什么你应该在每个项目开始时就设置它。

唯一的例外*可能是*如果您计划部署到现成的提供商，如 Heroku 或其他基于简单配置文件进行实际供应的提供商，但即使这样，Terraform 也可以做到这一点，您可能会更好地利用它。

所以事不宜迟，这就是为什么你应该在你的下一个项目中使用 Terraform！

# 今天就开始使用 Terraform 的 10 个理由

## 1.它提供了对实际基础设施的深入了解

当我们讨论如何确保将开发人员引入部署领域时，最好的方法就是将基础设施的配置放在代码旁边。

很明显，我明白这可能是不明智的。有时你不希望游荡的开发者开始改变你的服务器，增加你的 AWS 账单或者搞乱你的网络。你当然需要有良好的代码审查实践来做这样的事情，但是 Terraform 的美妙之处在于，你可以隔离你的基础设施的某些方面，这些方面可能有更重要的影响。

对我来说，我喜欢保留所有主要基础设施的回购，如网络、DNS 等。即使知道自己在做什么的人也不太可能意外更改。

将基础架构代码与应用程序代码放在一起是推动团队开始融合并确保每个人都知道他们的行为会影响应用程序代码和基础架构的最佳方式之一。

## 2.它提供了版本控制的安全性

这是一个很大的问题，也是一个非常明显但严肃的问题，能够将基础架构文件放在回购中，并控制它们的版本，以便您可以看到哪些地方被篡改了，以及您需要在哪里回滚，这是非常重要的。

作为在 Elastic Beanstalk 上开始我的 DevOps 职业生涯的人，我可以告诉你，有很多次我希望我在某个地方有一个 repo，告诉我我做了什么才能让它工作。或者见鬼，甚至当我几个月后去寻找它来改变或修复某些东西时，我的基础设施在哪里。

## 3.它允许多个团队成员轻松管理基础架构

同样，这可能是你不希望太容易发生的事情，这就是为什么良好的代码审查和受保护的分支是至关重要的。我还没有遇到有人无意或以破坏性的方式更改 Terraform 代码的问题。

相反，我发现团队成员经常可以做一些小的编辑，比如添加一个新的环境变量，或者为一个新的功能复制一个模块配置，否则他们会被阻止，直到有人为他们做了这些。

## 4.它使得调配多个环境变得非常简单

我认为这无疑是 Terraform 的最佳特性之一。使用 Terraform workspaces，您只需几个简单的命令就可以轻松创建多个环境(例如测试、开发、生产)。您可以暂时旋转它们，也可以保持它们。它们都有自己的隔离状态，可以相同也可以不同，当你不想再有一个时，你只需运行 destroy 命令。

在您的基础架构中自动调配和取消调配多个环境从未如此简单。

## 5.它保留了基础设施状态的完整备份

开箱即用的 Terraform 将这种状态存储在您的本地机器上，这对于入门来说是非常好的，但是当您将它连接到远程后端时，真正的力量才显现出来。像 S3 这样的东西让您能够将状态保存在一个集中的地方，无论您从哪里部署(本地机器或 CI/CD 工具)。

添加 S3 版本控制意味着如果出现任何问题，您可以随时将状态回滚到以前的版本。现在，我不会养成这样做的习惯，但我确实有一个 Terraform 版本更新出错，需要用一点手动调整来回滚状态，伙计，这真是救命稻草。

## 6.它有如此多的助手功能

Terraform 不仅是一个非常棒的工具，可以配置和提供基础设施，而且它还提供了许多内置的帮助工具，可以创建常见的可重用变量，加载一系列不同的文件类型，创建条件代码和动态字符串插值。它是一种真正的编程语言，有自己的一套实用程序。

最棒的是，你不仅可以配置你的资源，还可以让它们变得超级动态和可重用，并根据任意数量的操作应用不同的资源。

## 7.它允许您在一个或多个云提供商中进行调配

我不能说这是我个人使用过的，我也不想开始管理跨多个云提供商的基础设施，但有了 Terraform，你可以配置尽可能多的提供商，所以如果你想在 Azure 中运行数据库，在 AWS 中运行后端，在 GCP 运行前端，那么 Terraform 会支持你。

这对于拥有遗留基础设施，但可能正在尝试迁移或需要与跨提供商的资源集成的系统来说是巨大的，例如从一个提供商获取数据源并提供给另一个提供商。

## 8.它允许您创建可重用的基础设施模块

除了我上面提到的整个多环境的事情，我想这是我下一个最喜欢的 Terraform 的功能。Terraform 拥有所谓的模块，这些模块的行为本质上就像是它们自己孤立的基础设施块，可以在同一个项目中或跨多个项目重用。这是巨大的！不必重写所有相同的配置或手动记住您在控制台中单击了哪些按钮，您只需复制一个模块实例并传入更新的变量。

当我在一个应用程序的许多不同部分使用 AWS Lambdas 时，这对我来说意义重大。每次我需要一个新的 Lambda 时，我只是为一个模块复制相同的配置，添加更新的变量并应用更改。我从来不需要考虑所有的小部分或者记住每次需要配置什么。

## 9.它可以防止您调配冲突的基础架构

再加上像 Dynamo DB 这样的锁表，Terraform 通过远程后端为我上面提到的内容增加了更多功能。现在，您可以让工作区上的 Terraform 运行锁定同一工作区上的任何其他运行。这意味着你永远不会偶然有两个 Terraform 运行争夺谁先到那里(提供你的资源名称正确)。

## 10.它允许您引用已经部署的资源

还记得上面我提到在另一个 repo 中保留一些 Terraform 配置，以防止有人编辑一些超级有影响力的东西或在多个应用程序(如网络)之间共享资源吗？

Terraform 的另一个很酷的地方是它能够从你的云提供商那里获取数据。这太棒了，因为不必硬编码一个 VPC id 或其他值，您可以简单地通过名称获取它并访问所有相同的属性，就好像它实际存在于您的配置中一样。我在我的提供者中多次使用这个来引用非 terraform 或全局资源。

## 11.它增长了你对潜在资源的理解

好吧，我知道我说了 10 个，但我作弊了，还加上了一个奖金的理由，所以不客气！

刚接触 Terraform 的人看到配置文件时可能会想，“哇！？这种让人摸不着头脑的东西怎么会更容易理解！”。的确，Terraform 需要一些时间来适应，就像任何编程语言一样。但是在 Terraform 中工作让我学到了比使用控制台学到的更多的东西。

是的，控制台非常容易点击和添加资源，但控制台中不清楚的是在引擎盖下发生了多少你无法洞察的事情。像自动创建的 IAM 角色或附加的策略都是您必须直接使用 Terraform 完成的事情。

起初，这是一个巨大的痛苦，因为你就像“为什么 AWS 不能为我做这些！?"。但人类做到了这一点，让我更好地理解了做某些事情需要哪些资源，以及我对每种资源有哪些配置选项。

# **一些免责声明**

我想澄清一些事情，因为我对一些术语和解释做了一些改动。

## 地形与…

我认为值得注意的是，我提到的 Terraform 的一些成功之处并不完全是 Terraform 独有的，甚至有一点是 terra form 独有的。我的观点并不是说 Terraform 一定是唯一能做 X、Y 或 z 的工具。只是说它是我所提倡的，虽然其他人可以执行相同或类似的功能，但我每次都会选择 Terraform。我也没有使用过其他工具，比如 CloudFormation、Ansible 或其他工具，没有深入地比较它们。

## 供应与部署

在某种程度上，我在整篇文章中交替使用了这些词，我想澄清它们不是一回事。

需要澄清的是，**供应**严格来说是指在一个或多个提供商中创建基础设施的行为。这不同于**将**代码部署到那些被提供的资源上的行为。

Terraform 主要是一个配置工具，尽管你可以用它做一些类似部署的事情。当我意识到这一点并停止尝试使用 Terraform 来部署我的代码时，生活变得简单多了。

对于所有经验丰富的 IT/DevOps 人员来说，您可能会说“啊，当然这只是供应”，但这是 Terraform 的一个很酷的地方。它模糊了两者之间的界限，它既令人敬畏，也是你必须思考的东西。

# 包扎

我希望这篇文章能给你一些动力，让你深入了解更多关于 Terraform 及其工作原理的知识。这是我多年来学到的工具之一，我现在在每个项目上都使用它，并且没有后悔。以上几点只是它成为 DevOps 工具带中不可替代的工具以及开始在开发和部署之间共享洞察力的最佳方式之一的几个原因。

如果你现在没有为你的工作流使用基础设施即代码工具，你应该这样做，如果你试图找出应该使用哪一个，我认为你应该选择 Terraform。

*原载于 2022 年 8 月 15 日*[*【https://www.programming-is-hard.com】*](https://www.programming-is-hard.com/post/why-you-should-use-terraform-to-provision-your-cloud-infrastructure)*。*