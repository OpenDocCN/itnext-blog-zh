<html>
<head>
<title>Write your first Web Scraper in Dart</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Dart编写您的第一个Web Scraper</h1>
<blockquote>原文：<a href="https://itnext.io/write-your-first-web-scraper-in-dart-243c7bb4d05?source=collection_archive---------2-----------------------#2018-12-17">https://itnext.io/write-your-first-web-scraper-in-dart-243c7bb4d05?source=collection_archive---------2-----------------------#2018-12-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5e0b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何使用现有工具从网站中提取数据</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d68555a95fcbf19c43b02fcf5ba1b219.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XiQ8rv-Jgu7livDZlkZ5Sw.png"/></div></div></figure><p id="ecaf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本教程中，我们将编写一个web scraper来查询Hacker News主页上的最新文章列表及其URL。我们将生成一个JSON字符串，其中包含基于抓取数据的结果。我们还将通过一些单元测试来介绍这一点！</p><p id="c946" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这将是很好的后续行动，尤其是你一直想深入研究Dart语言和工具。</p><p id="ef62" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">→ <a class="ae ln" href="https://creativebracket.com/write-your-first-web-scraper/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir">继续阅读我的博客</strong> </a></p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="e390" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">什么是Web Scraper？</h1><p id="4d69" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">网页抓取器指的是执行从网站提取数据的任务的脚本。这通常是通过对网页执行GET请求，然后解析HTML响应以检索所需内容来实现的。</p><h1 id="2b21" class="lv lw iq bd lx ly ms ma mb mc mt me mf jw mu jx mh jz mv ka mj kc mw kd ml mm bi translated">1.生成控制台项目</h1><p id="1756" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">为您的项目创建目录</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="a852" class="nc lw iq my b gy nd ne l nf ng">$ <strong class="my ir">mkdir hacker_news_scraper &amp;&amp; cd hacker_news_scraper</strong></span></pre><p id="69b2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用stagehand包生成控制台应用程序:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="6fa9" class="nc lw iq my b gy nd ne l nf ng">$ <strong class="my ir">pub global activate stagehand</strong> # If it's not installed<br/>$ <strong class="my ir">stagehand console-full</strong></span></pre><p id="75b5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe nh ni nj my b">pubspec.yaml</code>文件中添加<strong class="kt ir"> http </strong>和<strong class="kt ir"> html </strong>依赖关系:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="8837" class="nc lw iq my b gy nd ne l nf ng"><strong class="my ir">dependencies</strong>:<br/>  <strong class="my ir">html</strong>: ^0.13.3+3<br/>  <strong class="my ir">http</strong>: ^0.12.0</span></pre><p id="f18b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">http包为请求提供了一个基于未来的API。<strong class="kt ir"> html </strong>包包含使用受DOM启发的API解析HTML5字符串的助手。<em class="nk">是来自Python的</em><strong class="kt ir"><em class="nk">html 5 lib</em></strong><em class="nk">的一个端口。</em></p><p id="57f9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">并安装添加的依赖项:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="5e01" class="nc lw iq my b gy nd ne l nf ng">$ <strong class="my ir">pub get</strong></span></pre><p id="5af2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">正确遵循这些说明应该会给您提供下面的文件/文件夹结构:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/b7c6b797b53ae55a75cb2f70d1dd9d01.png" data-original-src="https://miro.medium.com/v2/resize:fit:590/format:webp/1*s7IeGtIR69oRyckrF8z2iA.png"/></div><figcaption class="nm nn gj gh gi no np bd b be z dk translated">控制台应用程序的项目结构</figcaption></figure><h1 id="2bdf" class="lv lw iq bd lx ly ms ma mb mc mt me mf jw mu jx mh jz mv ka mj kc mw kd ml mm bi translated">2.实现脚本</h1><p id="cec0" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">清空<code class="fe nh ni nj my b">lib/hacker_news_scraper.dart</code>的内容，因为我们将从scratch☝️️出发</p><p id="c583" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">导入我们安装的依赖项:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="6bd9" class="nc lw iq my b gy nd ne l nf ng"><strong class="my ir">import 'dart:convert';</strong> // Contains the JSON encoder<br/><br/><strong class="my ir">import 'package:http/http.dart';</strong> // Contains a client for making API calls<br/><strong class="my ir">import 'package:html/parser.dart';</strong> // Contains HTML parsers to generate a Document object<br/><strong class="my ir">import 'package:html/dom.dart';</strong> // Contains DOM related classes for extracting data from elements</span></pre><p id="6686" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在导入后创建一个函数来包含我们的逻辑:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="39e9" class="nc lw iq my b gy nd ne l nf ng"><strong class="my ir">initiate</strong>() <strong class="my ir">async</strong> {}</span></pre><p id="daaa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">http 包包含一个用于进行http调用的<code class="fe nh ni nj my b">Client</code>类。创建一个实例，并对黑客新闻主页执行一个<code class="fe nh ni nj my b">GET</code>请求:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="89ee" class="nc lw iq my b gy nd ne l nf ng">Future initiate() <strong class="my ir">async</strong> {<br/>  var <strong class="my ir">client</strong> = <strong class="my ir">Client()</strong>;<br/>  Response response = <strong class="my ir">await client.get</strong>(<br/>    'https://news.ycombinator.com'<br/>  );<br/><br/>  print(response.body);<br/>}</span></pre><p id="acd4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了测试这一点，转到<code class="fe nh ni nj my b">bin/main.dart</code>并调用<code class="fe nh ni nj my b">initiate</code>方法:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="7fe0" class="nc lw iq my b gy nd ne l nf ng">import 'package:hacker_news_scraper/hacker_news_scraper.dart' <strong class="my ir">as</strong> <strong class="my ir">hacker_news_scraper</strong>;<br/><br/>void main(List&lt;String&gt; arguments) async {<br/>  print(await <strong class="my ir">hacker_news_scraper.initiate</strong>());<br/>}</span></pre><p id="5160" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">运行该文件:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="7ca1" class="nc lw iq my b gy nd ne l nf ng">$ <strong class="my ir">dart bin/main.dart</strong></span></pre><p id="4848" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以下是回应的摘要:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="cb91" class="nc lw iq my b gy nd ne l nf ng">&lt;html op="news"&gt;&lt;head&gt;&lt;meta name="referrer" content="origin"&gt;&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt; <br/>...<br/>...<br/>&lt;table border="0" cellpadding="0" cellspacing="0" class="itemlist"&gt;<br/>              &lt;tr class='athing' id='18678314'&gt;<br/>      &lt;td align="right" valign="top" class="title"&gt;&lt;span class="rank"&gt;1.&lt;/span&gt;&lt;/td&gt;      &lt;td valign="top" class="votelinks"&gt;&lt;center&gt;&lt;a id='up_18678314' href='vote?id=18678314&amp;amp;how=up&amp;amp;goto=news'&gt;&lt;div class='votearrow' title='upvote'&gt;&lt;/div&gt;&lt;/a&gt;&lt;/center&gt;&lt;/td&gt;&lt;td class="title"&gt;&lt;a href="http://vmls-book.stanford.edu/" class="storylink"&gt;Introduction to Applied Linear Algebra: Vectors, Matrices, and Least Squares&lt;/a&gt;&lt;span class="sitebit comhead"&gt; (&lt;a href="from?site=stanford.edu"&gt;&lt;span class="sitestr"&gt;stanford.edu&lt;/span&gt;&lt;/a&gt;)&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td colspan="2"&gt;&lt;/td&gt;&lt;td class="subtext"&gt;<br/>        &lt;span class="score" id="score_18678314"&gt;381 points&lt;/span&gt; by &lt;a href="user?id=yarapavan" class="hnuser"&gt;yarapavan&lt;/a&gt; &lt;span class="age"&gt;&lt;a href="item?id=18678314"&gt;8 hours ago&lt;/a&gt;&lt;/span&gt; &lt;span id="unv_18678314"&gt;&lt;/span&gt; | &lt;a href="hide?id=18678314&amp;amp;goto=news"&gt;hide&lt;/a&gt; | &lt;a href="item?id=18678314"&gt;37&amp;nbsp;comments&lt;/a&gt;              &lt;/td&gt;&lt;/tr&gt;<br/>...<br/>...</span></pre><p id="29e0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了知道要查找什么，我们需要知道如何选择页面上的链接:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/f49c75d689a03f6a4874b4b8cab44919.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GYldVxILTHTeeszwoFb0jQ.png"/></div></div></figure><p id="6527" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">似乎每个链接都在一个表格单元格中，并且具有类“storylink”。这意味着我们可以使用这个CSS选择器来遍历这些:<code class="fe nh ni nj my b">td.title &gt; a.storylink</code></p><p id="2477" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe nh ni nj my b">lib/hacker_news_scraper.dart</code>中，我们不在initiate函数中打印响应体，而是使用<strong class="kt ir"> html </strong>包中的助手来解析响应体并选择元素。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="dbf7" class="nc lw iq my b gy nd ne l nf ng">Future initiate() async {<br/>  var client = Client();<br/>  Response response = await client.get(<br/>    'https://news.ycombinator.com'<br/>  );<br/><br/>  // Use html parser and query selector<br/>  var <strong class="my ir">document</strong> = <strong class="my ir">parse</strong>(response.body);<br/>  List&lt;<strong class="my ir">Element</strong>&gt; links = document<strong class="my ir">.querySelectorAll</strong>('td.title &gt; a.storylink');<br/>}</span></pre><p id="c761" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此时，我们有了一个<code class="fe nh ni nj my b">Element</code>列表，其中每个元素都是一个<code class="fe nh ni nj my b">a.storylink</code>项目。<code class="fe nh ni nj my b">Element</code>类型<a class="ae ln" href="https://pub.dartlang.org/documentation/html/latest/dom/Element-class.html" rel="noopener ugc nofollow" target="_blank">提供了一个类似于DOM的API </a>。</p><p id="8b2c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通过一个<code class="fe nh ni nj my b">for in</code>循环，我们可以遍历集合:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="a00d" class="nc lw iq my b gy nd ne l nf ng">List&lt;Map&lt;String, dynamic&gt;&gt; <strong class="my ir">linkMap</strong> = [];<br/><br/>for (var <strong class="my ir">link</strong> in links) {<br/>  linkMap.add({<br/>    '<strong class="my ir">title</strong>': <strong class="my ir">link.text</strong>,<br/>    '<strong class="my ir">href</strong>': <strong class="my ir">link.attributes[</strong>'href'<strong class="my ir">]</strong>,<br/>  });<br/>}</span></pre><p id="06c2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">并返回JSON编码的输出:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="d883" class="nc lw iq my b gy nd ne l nf ng">import 'dart:convert'; // Import this library at the top of the file<br/><br/>Future initiate() <strong class="my ir">async</strong> {<br/>  ...<br/>  ...<br/>  return <strong class="my ir">json.encode(</strong>linkMap<strong class="my ir">)</strong>;<br/>}</span></pre><p id="181d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以下是目前为止的完整脚本:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="6f96" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">运行该命令应该会返回如下所示的JSON输出:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="52e3" class="nc lw iq my b gy nd ne l nf ng">[<br/>  {<br/>    "title":"Introduction to Applied Linear Algebra: Vectors, Matrices, and Least Squares",<br/>    "href":"http://vmls-book.stanford.edu/"<br/>  },<br/>  {<br/>    "title":"Write Your Own Virtual Machine",<br/>    "href":"https://justinmeiners.github.io/lc3-vm/"<br/>  },<br/>  ...<br/>  ...<br/>]</span></pre><h1 id="1759" class="lv lw iq bd lx ly ms ma mb mc mt me mf jw mu jx mh jz mv ka mj kc mw kd ml mm bi translated">3.编写单元测试</h1><p id="e363" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">我们的测试将在<code class="fe nh ni nj my b">test/hacker_news_scraper_test.dart</code>进行。将其内容替换为以下内容:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="c590" class="nc lw iq my b gy nd ne l nf ng">import 'dart:convert';<br/><br/>import 'package:test/test.dart';<br/>import 'package:http/http.dart';<br/>import 'package:http/testing.dart';<br/>import 'package:hacker_news_scraper/hacker_news_scraper.dart' as hacker_news_scraper;<br/><br/>void main() {<br/>  // Our tests will go here<br/>}</span></pre><p id="8e91" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是我们第一次测试的样子:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="2d4e" class="nc lw iq my b gy nd ne l nf ng">void main() {<br/>  <strong class="my ir">test</strong>('calling initiate() returns a list of storylinks', <strong class="my ir">() async {</strong><br/>    var response = await hacker_news_scraper.initiate();<br/>    <strong class="my ir">expect</strong>(response, equals('/* JSON string to match against */'));<br/>  <strong class="my ir">}</strong>);<br/>}</span></pre><p id="7759" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们需要为我们的测试稍微重构我们的解决方案。这是因为编写测试将是古怪的，因为<strong class="kt ir">我们将实际调用</strong>黑客新闻网站。</p><p id="9cf7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果黑客新闻不可用，或者我们没有互联网连接，或者故事列表发生变化(它们会发生变化)，我们的测试就会失败。</p><p id="6cbe" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们重构我们的<code class="fe nh ni nj my b">initiate()</code>方法calll，期待一个<code class="fe nh ni nj my b">client</code>参数，并删除<code class="fe nh ni nj my b">var client = Client();</code>声明:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="8f18" class="nc lw iq my b gy nd ne l nf ng">// lib/hacker_news_scraper.dart<br/>initiate(<strong class="my ir">BaseClient client</strong>) {<br/>  // var client = Client(); // &lt;- <strong class="my ir">Remove this line</strong><br/>  ...<br/>}</span></pre><p id="8a75" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> http </strong>包为其http客户端扩展了一个<code class="fe nh ni nj my b">BaseClient</code>类型。这也很有用，因为同一个包提供了另一个子类<code class="fe nh ni nj my b">MockClient</code>，用于模拟HTTP调用，这对我们的单元测试很有用！</p><p id="34d9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">返回<code class="fe nh ni nj my b">bin/main.dart</code>并确保<code class="fe nh ni nj my b">Client</code>被传入:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="b9c8" class="nc lw iq my b gy nd ne l nf ng"><strong class="my ir">import 'package:http/http.dart';</strong> // Import the package first!<br/>import 'package:hacker_news_scraper/hacker_news_scraper.dart' as hacker_news_scraper;<br/><br/>void main(List&lt;String&gt; arguments) async {<br/>  print(await hacker_news_scraper.initiate(<strong class="my ir">Client()</strong>));<br/>}</span></pre><p id="93c7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">好，回到我们的单元测试。</p><p id="ea97" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是第一个使用我们的<code class="fe nh ni nj my b">MockClient</code>的测试:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="41ee" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nh ni nj my b">MockClient</code>实例将闭包作为第一个参数。这个闭包提供了一个请求对象，如果需要，我们可以操纵它。期望从这个闭包返回一个<code class="fe nh ni nj my b">Future</code>对象，这就是这里所发生的。当在我们的<code class="fe nh ni nj my b">await client.get(...)</code>方法中进行调用时，我们返回一个HTML字符串。</p><p id="d088" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nh ni nj my b">MockClient</code>实例还接受第二个参数，一个表示响应状态代码的整数。本例中是一个<code class="fe nh ni nj my b">200 OK</code>。</p><p id="11d9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们继续进行我们的<code class="fe nh ni nj my b">initiate()</code>调用，传入被模仿的客户端。这意味着我们的测试现在是可预测的，并且可以自信地对响应执行断言。</p><p id="0fd1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nh ni nj my b">expect</code>和<code class="fe nh ni nj my b">equals</code>顶级函数是Dart团队的<strong class="kt ir">测试</strong>包的一部分。我们之前安装了它，它列在我们的<code class="fe nh ni nj my b">pubspec.yaml</code>文件中的<code class="fe nh ni nj my b">dev_dependencies:</code>下。</p><p id="d0d3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们使用<code class="fe nh ni nj my b">json.encode()</code>方法作为我们期望从操作中得到的编码JSON字符串。</p><p id="248f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以通过执行以下操作来运行该测试:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="a99d" class="nc lw iq my b gy nd ne l nf ng">$ <strong class="my ir">pub run test</strong></span></pre><p id="71d6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面是针对失败场景的第二个测试:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="dcb9" class="nc lw iq my b gy nd ne l nf ng">void main() {<br/>  ...<br/>  ...</span><span id="5ead" class="nc lw iq my b gy nt ne l nf ng">  <strong class="my ir">test</strong>('calling initiate(client) should silently fail', () async {<br/>    // Arrange<br/>    <strong class="my ir">client</strong> = MockClient((req) =&gt; Future(() =&gt; <strong class="my ir">Response('Failed', 400)</strong>));<br/><br/>    // Act<br/>    var response = <strong class="my ir">await hacker_news_scraper.initiate(client)</strong>;<br/><br/>    // Assert<br/>    expect(<strong class="my ir">response</strong>, <strong class="my ir">equals</strong>('<strong class="my ir">Failed</strong>'));<br/>  });<br/>}</span></pre><p id="4fe0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">再次执行<code class="fe nh ni nj my b">pub run test</code>。这将失败。</p><p id="4173" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们度过这一关。在我们的<code class="fe nh ni nj my b">initiate()</code>方法中，让我们在GET调用下面添加这个条件:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="ea55" class="nc lw iq my b gy nd ne l nf ng">if (response.statusCode != 200) return response.body;</span></pre><p id="42b3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">再次运行测试。都应该过去！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/62083ea5ccdbcb4d5ad0fa4fb8127b62.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*K7RUPzSnHvrnd0ewY8YFFQ.png"/></div><figcaption class="nm nn gj gh gi no np bd b be z dk translated">通过测试。由Dart扩展为VS代码生成的输出</figcaption></figure><h1 id="e1e5" class="lv lw iq bd lx ly ms ma mb mc mt me mf jw mu jx mh jz mv ka mj kc mw kd ml mm bi translated">结论</h1><p id="9c47" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">总而言之，我们使用Dart团队提供的<strong class="kt ir"> http </strong>和<strong class="kt ir"> html </strong>包构建了一个抓取工具，从黑客新闻网站获取最新的提要。然后，我们通过编写一些单元测试来保护自己。</p><p id="b2af" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">实际上，使用黑客新闻API可能会更好😄。也就是说，对于没有官方API来遍历内容的网站，您仍然需要这种方法。</p><p id="aa41" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我希望这是有见地的，尤其是在用Dart编写测试的领域。</p><p id="fa90" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">→ <a class="ae ln" href="https://github.com/graphicbeacon/hacker_news_scraper" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir">获取源代码</strong> </a></p><p id="f810" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我还经营一个YouTube频道，教用户用Dart开发全栈应用程序。<a class="ae ln" href="http://bit.ly/fullstackdart" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir">成为订阅者</strong> </a>接收新视频发布时的更新。</p><p id="b868" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，我几乎完成了Egghead.io上的免费飞镖课程。这将在新年发布🎉，所以请密切注意👁️</p><p id="5fe5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">喜欢，分享</strong> <a class="ae ln" href="https://twitter.com/creativ_bracket" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir">跟我来</strong> </a>😍有关Dart的更多内容。谢谢！</p><h1 id="2152" class="lv lw iq bd lx ly ms ma mb mc mt me mf jw mu jx mh jz mv ka mj kc mw kd ml mm bi translated">进一步阅读</h1><ol class=""><li id="c91f" class="nv nw iq kt b ku mn kx mo la nx le ny li nz lm oa ob oc od bi translated"><a class="ae ln" href="https://pub.dartlang.org/packages/http" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> http </strong>:一个可组合的、基于未来的库，用于发出http请求</a></li><li id="d0c2" class="nv nw iq kt b ku oe kx of la og le oh li oi lm oa ob oc od bi translated"><a class="ae ln" href="https://pub.dartlang.org/packages/html" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir">html</strong>:Dart中的HTML5解析器</a></li><li id="d9c4" class="nv nw iq kt b ku oe kx of la og le oh li oi lm oa ob oc od bi translated"><a class="ae ln" href="https://egghead.io/instructors/jermaine-oppong" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir">免费飞镖截屏在Egghead.io </strong> </a></li></ol></div></div>    
</body>
</html>