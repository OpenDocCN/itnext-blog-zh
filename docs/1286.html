<html>
<head>
<title>An alternate way to Angular migration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角度偏移的另一种方法</h1>
<blockquote>原文：<a href="https://itnext.io/an-alternate-way-to-angular-migration-c7932cf05a1b?source=collection_archive---------0-----------------------#2018-08-29">https://itnext.io/an-alternate-way-to-angular-migration-c7932cf05a1b?source=collection_archive---------0-----------------------#2018-08-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/f4a3b1b7e168c8640dbefc313af053ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XJRtWZat9FQs48d38CxjOw.jpeg"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">是时候升级你的AngularJS应用程序了</figcaption></figure><p id="28a6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇博文是我在第一次<a class="ae kw" href="https://www.meetup.com/Angular-Athens/" rel="noopener ugc nofollow" target="_blank">角度雅典聚会</a>上的演讲的一部分，题目是<strong class="ka ir">从大口到角度CLI和超越</strong>。它描述了使用专注于工具和开发工作流程的方法将<strong class="ka ir"> AngularJS </strong>应用程序迁移到<strong class="ka ir"> Angular </strong>的过程。它主要针对那些使用<strong class="ka ir">gupp</strong>作为开发和构建工具，并希望用<strong class="ka ir"> Angular CLI </strong>来替代它的项目。</p><blockquote class="kx ky kz"><p id="1740" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">本文并不试图详细解释升级过程，而是如何解决迁移问题，以便您和您的团队可以直接完成升级过程。它提示您如何迁移到新的Angular，同时在升级期间运行和部署您的应用程序。</p></blockquote><p id="620d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在这里<a class="ae kw" href="https://github.com/angularathens/1st-meetup-from-gulp-to-angularcli/blob/master/From%20Gulp%20to%20Angular%20CLI%20and%20beyond.pdf" rel="noopener ugc nofollow" target="_blank">找到演示的幻灯片</a>和在<a class="ae kw" href="https://github.com/bampakoa/angular-athens-demo" rel="noopener ugc nofollow" target="_blank">这个</a> GitHub仓库中找到完整的源代码。代码被组织在分支中，每个分支代表迁移过程中的一个步骤，这样您就可以跟随了。<code class="fe le lf lg lh b"><a class="ae kw" href="https://github.com/bampakoa/angular-athens-demo/tree/master" rel="noopener ugc nofollow" target="_blank">master</a></code>分支是起点，<code class="fe le lf lg lh b"><a class="ae kw" href="https://github.com/bampakoa/angular-athens-demo/tree/final" rel="noopener ugc nofollow" target="_blank">final</a></code>分支包含升级完成后的代码。</p><h1 id="6145" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">故事</h1><p id="c52d" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated">我目前正在做的<a class="ae kw" href="https://www.plexearth.com/" rel="noopener ugc nofollow" target="_blank"> Plexscape </a>的主要产品之一是一个授权web应用程序，其代码库大约为3000 LOC，是用AngularJS构建的。在我演讲的时候，应用程序正在使用最新版本的框架，<strong class="ka ir"> 1.6.10 </strong>。在Angular发布版本<strong class="ka ir"> 2.0 </strong>之后，我们决定是时候升级我们的应用程序了。</p><p id="0e63" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们开始用官方Angular文档的<a class="ae kw" href="https://angular.io/guide/upgrade" rel="noopener ugc nofollow" target="_blank">升级指南</a>进行实验，它使用的是<strong class="ka ir"> SystemJS </strong>。这个过程并不简单，需要我们进行大量的编码来设置它(没有足够的样板文件)。与此同时，Angular CLI已经开始发布其第一个<strong class="ka ir"> beta </strong>版本。我们决定推迟升级过程，等待Angular CLI的首次发布，因为我们的目的是向Angular生态系统靠拢。</p><p id="962e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了简单起见，下面在一个演示AngularJS应用程序的上下文中描述我们升级应用程序的步骤。</p><h1 id="985a" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">应用程序</h1><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi ml"><img src="../Images/5a978dc57c08995bad2b16ca491d567a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o3NclPor2HvocXMs1nEC9w.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">棱角分明的英雄</figcaption></figure><p id="0d7e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该应用程序名为<a class="ae kw" href="https://angular-superheroes.firebaseapp.com/" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">Angular Heroes</strong></a><strong class="ka ir"/>，使用<a class="ae kw" href="https://developer.marvel.com/" rel="noopener ugc nofollow" target="_blank">漫威API </a>提供漫威人物数据库的基本搜索功能。由<a class="ae kw" href="https://angularjs.org/" rel="noopener ugc nofollow" target="_blank">角铁</a> 1.6.9和<a class="ae kw" href="https://material.angularjs.org" rel="noopener ugc nofollow" target="_blank">角铁材料</a> 1.1.7制成。</p><p id="cf90" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它使用<a class="ae kw" href="https://gulpjs.com/" rel="noopener ugc nofollow" target="_blank">大口</a>进行建造、缩小和捆扎。所有第三方库都是通过<a class="ae kw" href="https://bower.io/" rel="noopener ugc nofollow" target="_blank">凉亭</a>安装的。项目的结构在很大程度上受到了以下存储库的启发:</p><ul class=""><li id="2077" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated"><a class="ae kw" href="https://github.com/johnpapa/angular-styleguide/blob/master/a1/README.md" rel="noopener ugc nofollow" target="_blank">斜角样式指南</a></li><li id="3fd4" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated"><a class="ae kw" href="https://github.com/johnpapa/ng-demos/tree/master/modular" rel="noopener ugc nofollow" target="_blank">模块化(ng-demos) </a></li><li id="e5b1" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated"><a class="ae kw" href="https://github.com/johnpapa/gulp-patterns" rel="noopener ugc nofollow" target="_blank">吞咽模式</a></li></ul><p id="38a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在开发过程中，Lite-server 被用作首选Web服务器。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/b127af5332bfe32587a3ef23df84dfcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*7jDCUaWRfGSp5pURLLDkJQ.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">项目结构</figcaption></figure><p id="9b1d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">项目的根文件夹由用于测试、服务和构建应用程序的各种配置文件以及包含所有应用程序资产(JS、CSS、images)的<code class="fe le lf lg lh b">src</code>文件夹组成。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/9cd56eeb559a48ae4dbf2fd6c921ed66.png" data-original-src="https://miro.medium.com/v2/resize:fit:384/format:webp/1*KtCdISJ662DxpT5y9jC09w.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">src文件夹的内容</figcaption></figure><p id="c888" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe le lf lg lh b">src</code>文件夹进一步细分为两个子文件夹:一个名为<code class="fe le lf lg lh b">app</code>,包含被分成模块的Javascript文件，另一个名为<code class="fe le lf lg lh b">content</code>,用于CSS文件和图像。</p><h1 id="82a8" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><a class="ae kw" href="https://github.com/bampakoa/angular-athens-demo/tree/step-1" rel="noopener ugc nofollow" target="_blank">步骤1 </a>:移动到角度</h1><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/79222767dee68b6f4af8fdaac825904e.png" data-original-src="https://miro.medium.com/v2/resize:fit:372/format:webp/1*cAtEQUV1QRvRE3dK0Xb4mg.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">角度CLI</figcaption></figure><p id="589d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的第一个目标是在流程的早期改变工具链，并通过集成Angular CLI向Angular生态系统靠拢。我们需要首先使用npm安装它。打开一个终端，执行以下命令进行全局安装:</p><pre class="mm mn mo mp gt nl lh nm nn aw no bi"><span id="5523" class="np lj iq lh b gy nq nr l ns nt">$ npm install -g @angular/cli@1.7.4</span></pre><p id="9eda" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装后，使用CLI创建一个新的空白应用程序:</p><p id="610e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe le lf lg lh b">$ ng new my-app</code></p><p id="ed21" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以通过两种方式将我们的代码带入新的Angular环境:将我们的文件复制到新创建项目的<code class="fe le lf lg lh b">app</code>目录中，或者将新创建项目中的所有文件复制到我们当前的项目中。任何一种方式都是有效的。</p><p id="f114" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我们可以删除<code class="fe le lf lg lh b">lite-server</code>配置和大多数gulp任务，因为从现在开始，我们将使用Angular CLI进行服务、构建和捆绑。</p><blockquote class="kx ky kz"><p id="1991" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">我们还不打算删除<code class="fe le lf lg lh b"><a class="ae kw" href="https://github.com/bampakoa/angular-athens-demo/blob/step-1/gulpfile.js#L8" rel="noopener ugc nofollow" target="_blank"><em class="iq">templateCache</em></a></code>任务，因为我们仍然需要一种方法在升级期间处理AngularJS代码中的模板。请注意，我们可能有副本，因为角度组件的模板将包含在CLI的最终包和模板缓存中。</p></blockquote><p id="a562" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">任何静态资产，比如图像，都被移动到新项目的<code class="fe le lf lg lh b">assets</code>文件夹中，全局CSS样式被复制到<code class="fe le lf lg lh b">styles.css</code>文件中。</p><p id="b548" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">应用程序和第三方库资产路径从<code class="fe le lf lg lh b">index.html</code>文件中移除，并在<code class="fe le lf lg lh b">.angular-cli.json</code>文件的适当部分中定义。最后，我们将Angular CLI配置文件的<code class="fe le lf lg lh b">main</code>属性设置为<code class="fe le lf lg lh b">app.js</code>来定义应用程序的起点。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/e3b69be318e1180f086755d950a9ba4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*q6-wt6bnMulYOgv1PaNKrA.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">Angular CLI配置摘录</figcaption></figure><h1 id="3816" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><a class="ae kw" href="https://github.com/bampakoa/angular-athens-demo/tree/step-2" rel="noopener ugc nofollow" target="_blank">第二步</a>:进入打字稿</h1><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nv"><img src="../Images/ab5862316e98d33e8eb94a3e1c958e37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aTCN2ctKNoZupUCMP0hQuw.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">以打字打的文件</figcaption></figure><p id="26c9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这一步中，我们将使用Typescript替换Javascript，这一过程将帮助我们在开发的早期发现bug。</p><p id="bfe4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">集成Typescript的最简单方法是重命名所有Javascript文件(*。js)转换为Typescript (*。ts)。这也是为AngularJS和第三方库安装<strong class="ka ir">类型</strong>并开始在我们的代码中使用ES6语句的最佳时机，例如<code class="fe le lf lg lh b">let</code>、<code class="fe le lf lg lh b">const</code>和<strong class="ka ir">箭头函数</strong>。我们需要在<code class="fe le lf lg lh b">tsconfig.app.json</code>文件的<code class="fe le lf lg lh b">compilerOptions</code>中设置<code class="fe le lf lg lh b">typeRoots</code>属性，以便Typescript编译器可以识别安装的类型。</p><pre class="mm mn mo mp gt nl lh nm nn aw no bi"><span id="9518" class="np lj iq lh b gy nq nr l ns nt">"typeRoots": [<br/>  "../node_modules/@types"<br/>]</span></pre><blockquote class="kx ky kz"><p id="e4df" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">使用类型后，您可能会遇到来自<code class="fe le lf lg lh b"><em class="iq">tslint</em></code>的错误。如果您愿意，可以在继续之前尝试纠正这些错误。请注意，如果不这样做，项目仍然会成功构建。</p></blockquote><p id="a2ac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此时，我们可以对AngularJS代码进行适当的修改，以便从类型安装中受益。</p><p id="7b01" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将所有AngularJS组件和服务转换为ES6类并导出。</p><blockquote class="kx ky kz"><p id="d076" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">如果您使用<code class="fe le lf lg lh b">vm</code>符号来声明AngularJS控制器，您可以用<code class="fe le lf lg lh b">$ctrl</code>来替换它，这是AngularJS 1.5.0和更高版本的内置特性。</p></blockquote><p id="5e1f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在任何使用变量<code class="fe le lf lg lh b">angular</code>的地方声明它，让<code class="fe le lf lg lh b">tslint</code>编译器高兴。</p><pre class="mm mn mo mp gt nl lh nm nn aw no bi"><span id="dd9c" class="np lj iq lh b gy nq nr l ns nt">declare var angular: angular.IAngularStatic;</span></pre><p id="2b67" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">向服务和组件添加类型。</p><blockquote class="kx ky kz"><p id="66eb" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">一个好的做法是在任何地方添加类型，即使你没有类型。您可以将它声明为<code class="fe le lf lg lh b">any</code>,这将作为一个提醒，以便稍后填充缺少的类型(只需搜索<code class="fe le lf lg lh b">any</code>关键字😃).</p></blockquote><p id="5b2d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为实现某些接口方法(如<code class="fe le lf lg lh b">$onInit</code>)的组件或服务添加<code class="fe le lf lg lh b">implements</code>关键字。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/e6ca7b3c4737926e617eba2cc25fc2c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*YYP7nE655v6EEXM8NCrXWw.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">ComicList组件实现$onChanges方法</figcaption></figure><p id="db19" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们现在可以移除<code class="fe le lf lg lh b">bower</code>并从<code class="fe le lf lg lh b">npm</code>安装包依赖项。然后，我们将能够使用来自<code class="fe le lf lg lh b">app.ts</code>文件的<strong class="ka ir"> RequireJS </strong>来加载库和应用程序源。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/ce01d35098fb1d2b106b268827bb038d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*hvUtUusTxkU8dnQhZ3WY9Q.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">app.ts文件摘录</figcaption></figure><blockquote class="kx ky kz"><p id="9743" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">当使用RequireJS导入路径时，记得从Angular CLI配置文件的<code class="fe le lf lg lh b">scripts</code>部分删除路径。</p></blockquote><h1 id="db63" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><a class="ae kw" href="https://github.com/bampakoa/angular-athens-demo/tree/step-3" rel="noopener ugc nofollow" target="_blank">步骤3 </a>:作为混合应用的引导</h1><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi ny"><img src="../Images/b98d7cd355b8cf54be15233ec3696182.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vjjm8s_wndGgM6Qavyp2dg.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">角度/角度混合模式</figcaption></figure><p id="5516" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们这一步的目标是让两个框架(AngularJS和Angular)以混合模式一起运行。然后，我们将能够在不中断应用程序功能的情况下逐渐移除AngularJS。</p><p id="514f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了将我们的应用程序引导为混合应用程序，我们首先需要安装<code class="fe le lf lg lh b">@angular/upgrade</code> npm包。安装包后，我们创建主角度应用模块<code class="fe le lf lg lh b">AppModule</code>并导入<code class="fe le lf lg lh b">UpgradeModule</code>。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/89c9b9821dbd7279ea1159d856c4f242.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*4qr7Z7kBM730ay_pL2Hieg.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">导入升级模块</figcaption></figure><p id="132a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们从<strong class="ka ir">index.html</strong>中移除<code class="fe le lf lg lh b">ng-app</code>指令，并实现<code class="fe le lf lg lh b">ngDoBootstrap</code>方法。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/2f0ac9ecff73c9c258578891240eccfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*H5aBQGKzDWwHiUG3VZmp8A.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">实现ngDoBootstrap</figcaption></figure><p id="7e62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们创建将成为应用程序入口点的<code class="fe le lf lg lh b">main.ts</code>文件，并在<code class="fe le lf lg lh b">.angular-cli.json</code>文件中更改相关的<code class="fe le lf lg lh b">main</code>属性。请注意，我们使用<code class="fe le lf lg lh b">setAngularJSGlobal</code>方法，因为AngularJS是使用RequireJS延迟加载的(它在<code class="fe le lf lg lh b">window</code>对象上不可用)。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/c544e7ba6ea763a15bd0ff9ff62e0047.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*kXHMXilJlVS7lPg45E1yPA.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">主入口点文件</figcaption></figure><h1 id="5a1b" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><a class="ae kw" href="https://github.com/bampakoa/angular-athens-demo/tree/step-4" rel="noopener ugc nofollow" target="_blank">步骤4 </a>:配置和错误处理</h1><p id="7d34" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated">在这一步中，我们将使用<strong class="ka ir">环境</strong>文件来存储应用程序设置，并且我们将创建一个自定义<code class="fe le lf lg lh b">ErrorHandler</code>来处理未被显式捕获的全局错误。</p><p id="8c63" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">环境文件可以在项目根目录的<code class="fe le lf lg lh b">environments</code>文件夹中找到，并且是从Angular CLI自动创建的，你可以在这里找到更多信息<a class="ae kw" href="https://github.com/angular/angular-cli/wiki/stories-application-environments" rel="noopener ugc nofollow" target="_blank">。在每个文件中，我们定义了漫威API的url和开发者密钥，以及应用程序的其他配置设置，如标题和当前版本。</a></p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/0534cbb68c2363fd7f4c177056757a75.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/1*05I8a-Z6KXBjGNhdRfuiYQ.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">环境. ts</figcaption></figure><p id="c024" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要实现<code class="fe le lf lg lh b">ErrorHandler</code>接口的<code class="fe le lf lg lh b">handleError</code>方法来创建一个定制的错误处理程序。该方法将负责捕捉错误，并将其发送给<code class="fe le lf lg lh b">logger</code>服务进行进一步处理。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi od"><img src="../Images/89ed180ecb2c6057003d8485d4d7b405.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kl9jH3G1Hm5wmudTA-7yzg.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">app-错误处理程序. ts</figcaption></figure><p id="0e01" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">AngularJS上下文中的logger服务需要升级，以便可以在自定义错误处理程序中使用。我们可以直接升级它，但是不能从已经使用它的AngularJS组件中访问它。为此，我们将在一个单独的文件中创建日志服务的升级版本。</p><blockquote class="kx ky kz"><p id="ecb5" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">创建这样一个文件是一个很好的实践，它将包含您需要在Angular中使用的每个AngularJS服务的升级版本。</p></blockquote><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/6398dec00e34cca3f184e327a2baefc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*L9jjRkl_Zwf-t27Msj0w_A.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">ajs-升级的提供者. ts</figcaption></figure><blockquote class="kx ky kz"><p id="0d72" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">注意使用<code class="fe le lf lg lh b"><em class="iq">Injector</em></code>来获得升级的日志服务。这是必要的，因为<code class="fe le lf lg lh b">ErrorHandler</code>类是在引导AngularJS部分之前被实例化的，因此AngularJS <code class="fe le lf lg lh b">$injector</code>还没有被创建。</p></blockquote><h1 id="2b7d" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><a class="ae kw" href="https://github.com/bampakoa/angular-athens-demo/tree/step-5" rel="noopener ugc nofollow" target="_blank">第五步</a>:升级服务</h1><p id="15e8" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated">这个步骤描述了升级<code class="fe le lf lg lh b">core</code>模块的服务的过程，比如我们之前描述的<code class="fe le lf lg lh b">logger</code>服务，以及第三方库，比如用于HTTP数据访问的<code class="fe le lf lg lh b">angular-resource</code>。</p><p id="397b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回想一下上一步，我们为每个框架维护了两个版本的日志服务。我们现在将只保留有角度的那个，并将其导入各自的<code class="fe le lf lg lh b">CoreModule</code>。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi of"><img src="../Images/6a6666e76eee4b7cb45ecd214250e99c.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*hJYw3Vk3IsQnu1NfEo7-Cg.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">核心.模块. ts</figcaption></figure><p id="245b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们安装了<code class="fe le lf lg lh b">@angular/http</code>，这是Angular的新HTTP客户端。我们将<code class="fe le lf lg lh b">HttpClientModule</code>导入主应用模块，所有使用<code class="fe le lf lg lh b">HttpClient</code>的服务都被转换成Angular并降级，因为仍然有AngularJS组件使用它们。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi og"><img src="../Images/c35b46286be0cea4dfba6af2f61a7ed7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*4PS28wJrTHZ0PCK6uOn-ww.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">characters.service.ts</figcaption></figure><blockquote class="kx ky kz"><p id="0f87" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">如果您不是一次升级所有的数据访问服务，而是使用HTTP拦截器，那么您可以在升级过程中保留它们。</p></blockquote><p id="1809" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们用AngularJS模块定义在同一个文件中为每个特征模块创建角度模块，除了我们将在下一步升级的<code class="fe le lf lg lh b">widgets</code>和<code class="fe le lf lg lh b">layout</code>。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/0c738e1261a013adb6e228d26d5fa14b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*uSRLKckq9Y6emBK4rpWHVw.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">字符.模块. ts</figcaption></figure><h1 id="f32c" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><a class="ae kw" href="https://github.com/bampakoa/angular-athens-demo/tree/step-6" rel="noopener ugc nofollow" target="_blank">步骤6 </a>:升级组件</h1><p id="80d1" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated">该步骤描述了升级应用程序组件和第三方库(如AngularJS Material)的过程。</p><p id="b27d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们安装<code class="fe le lf lg lh b">@angular/material</code> npm包并创建一个单独的模块<code class="fe le lf lg lh b">AppMaterialModule</code>来导入和导出角形材料组件。</p><blockquote class="kx ky kz"><p id="d7d7" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">这是一个很好的实践，因为想要使用角形材料组件的特征模块将只需要导入该模块。</p></blockquote><p id="739e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们升级了<code class="fe le lf lg lh b">widgets</code>模块，并将相应的文件夹重命名为<code class="fe le lf lg lh b">shared</code>，以符合Angular官方风格指南。我们也可以开始升级功能模块的AngularJS组件。</p><blockquote class="kx ky kz"><p id="eff8" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">我通常更喜欢自下而上地首先升级子组件，以便在过程的早期尽可能多地消除依赖性。</p></blockquote><p id="303b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将<code class="fe le lf lg lh b">layout</code>模块重构为一个单独的组件，即<code class="fe le lf lg lh b">AppComponent</code>，因为不需要太多代码来将它保持为一个独立的模块。</p><blockquote class="kx ky kz"><p id="44d8" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">如果你的布局组件足够大，你可以把它们移到<code class="fe le lf lg lh b">core</code>模块，因为它们在应用程序启动时只会被使用一次。</p></blockquote><p id="3b1b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们目前使用<code class="fe le lf lg lh b">ui-router</code> npm包来处理应用程序中的路由。我们不想麻烦升级它，因为这是一个很大的工作量。因此，我们在<code class="fe le lf lg lh b">ajs-upgraded-providers.ts</code>文件中创建了一个升级版本的<code class="fe le lf lg lh b">$state</code>服务，以便在角度上下文中使用它，并创建一个定制的角度指令来模拟<code class="fe le lf lg lh b">ui-sref</code>指令的行为。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi oh"><img src="../Images/b36d8969b3300af03a8d2488d0feb61a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cvigx1UFl4gGY3YFdm2YMg.png"/></div></div></figure><blockquote class="kx ky kz"><p id="11a3" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">您可以直接在HTML元素中设置<code class="fe le lf lg lh b"><em class="iq">href</em></code>属性，而不是创建自定义指令，但是这种方法更容易测试。</p></blockquote><h1 id="9f96" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><a class="ae kw" href="https://github.com/bampakoa/angular-athens-demo/tree/step-7" rel="noopener ugc nofollow" target="_blank">第七步</a>:升级路由器</h1><p id="84b2" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated">路由机制的升级是一个复杂的过程。理想的场景是让<code class="fe le lf lg lh b">ui-router</code>(或者您用于路由的任何库)和Angular router在这个过程中一起运行。</p><blockquote class="oi"><p id="dec3" class="oj ok iq bd ol om on oo op oq or kv dk translated">我建议将路由升级留到所有组件和服务都完成升级之后</p></blockquote><p id="ad6e" class="pw-post-body-paragraph jy jz iq ka b kb os kd ke kf ot kh ki kj ou kl km kn ov kp kq kr ow kt ku kv ij bi translated">网上有文章和路由库文档指南描述了如何实现这一点，所以我就不赘述了。主要取决于代码库有多大，以及您是否决定在升级过程中保持应用程序的部署。在这种情况下，由于代码库很小，我们一次性升级了它。</p><p id="547f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们安装<code class="fe le lf lg lh b">@angular/router</code> npm包并重构所有组件，以使用<code class="fe le lf lg lh b">routerLink</code>指令，而不是我们在上一步中创建的自定义指令。最后，我们升级<code class="fe le lf lg lh b">AppComponent</code>并在Angular中引导它。</p><h1 id="e49c" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">再见安古拉吉斯</h1><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/d9e376ec529dc455dd371a3f281bb200.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*12xel1DNydZthRq_f_ilQQ.jpeg"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">再见，谢谢你</figcaption></figure><p id="c429" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们终于准备好完全移除AngularJS。到目前为止，它为我们提供了良好的服务，但现在是时候继续使用闪亮的新Angular了。</p><p id="1a0a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们现在可以安全地从项目中删除以下内容:</p><ul class=""><li id="ab23" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">吞咽</li><li id="cbf8" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated"><code class="fe le lf lg lh b">ajs-upgraded-providers.ts</code>文件</li><li id="12c1" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated"><code class="fe le lf lg lh b">UpgradeModule</code></li><li id="8c7e" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated"><code class="fe le lf lg lh b">ngDoBootstrap</code>的实施</li></ul><p id="a4c1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，不需要降级组件/服务，我们也不需要在<code class="fe le lf lg lh b">main.ts</code>文件中全局导入AngularJS。</p><p id="80ec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就是这样！我们完了！我们的应用程序现在运行在纯角度。</p><p id="afbe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望这篇文章对你和你的团队有用，因为它帮助了我。你喜欢用什么方法升级Angular？请在下面的评论中告诉我！</p></div></div>    
</body>
</html>