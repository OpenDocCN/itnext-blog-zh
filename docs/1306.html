<html>
<head>
<title>Vuidget — How to create an embeddable Vue.js widget with vue-custom-element</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">vuidget——如何用vue-custom-element创建一个可嵌入的Vue.js小部件</h1>
<blockquote>原文：<a href="https://itnext.io/vuidget-how-to-create-an-embeddable-vue-js-widget-with-vue-custom-element-674bdcb96b97?source=collection_archive---------0-----------------------#2018-09-06">https://itnext.io/vuidget-how-to-create-an-embeddable-vue-js-widget-with-vue-custom-element-674bdcb96b97?source=collection_archive---------0-----------------------#2018-09-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/001e2fe9a92efb27dca076b582af8d67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UFADKghEfTl2KrmbEWzV7w.jpeg"/></div></div></figure><p id="880f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不久前，我的工作单位要求我为游客创建一个Vue.js应用程序。对应用程序的要求是，它应该可以作为一个小部件嵌入到任何地方——只使用<strong class="ka ir">一个app.js </strong>和<strong class="ka ir">一个app.css文件</strong>——这就是我如何通过karol-f找到<a class="ae kw" href="https://github.com/karol-f/vue-custom-element" rel="noopener ugc nofollow" target="_blank"> vue-custom-element </a>，这允许我们将Vue.js应用程序呈现为像<code class="fe kx ky kz la b">&lt;my-app&gt;&lt;/my-app&gt;</code>一样的HTML定制元素。</p><p id="4ec1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我以前从未做过这样的事情，我有一条充满谷歌搜索的路要走——我将指导你完成这个过程，所以你不必这样做。</p><p id="ffbb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">-注意:我们将使用Vue CLI 3</p><h1 id="cae1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">1.将您的应用程序优化为HTML自定义元素</h1><p id="004c" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">这就是<a class="ae kw" href="https://github.com/karol-f/vue-custom-element" rel="noopener ugc nofollow" target="_blank"> vue-custom-element </a>的用途。它是Vue.js应用程序的包装器，允许您通过自定义HTML元素在源代码中调用它。</p><p id="d5ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">假设您在<code class="fe kx ky kz la b">main.js</code>中初始化您的应用程序，如下所示:</p><p id="b168" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kx ky kz la b">src/main.js</code></p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="5d86" class="mm lc iq la b gy mn mo l mp mq">import Vue from 'vue'<br/>import App from './App.vue'<br/>import router from './router'<br/>import store from './store/index'</span><span id="58c3" class="mm lc iq la b gy mr mo l mp mq">new Vue({<br/> router,<br/> store,<br/> render: h =&gt; h(App)<br/>}).$mount(‘#app’)</span></pre><p id="fca4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用vue-custom-element几乎是一样的</p><p id="f474" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kx ky kz la b">npm install vue-custom-element --save</code></p><p id="7872" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kx ky kz la b">src/main.js</code></p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="7a2b" class="mm lc iq la b gy mn mo l mp mq">import Vue from 'vue'<br/>import App from './App.vue'<br/>import router from './router'<br/>import store from './store/index'</span><span id="d67a" class="mm lc iq la b gy mr mo l mp mq">import vueCustomElement from 'vue-custom-element'</span><span id="c3b2" class="mm lc iq la b gy mr mo l mp mq">Vue.use(vueCustomElement)</span><span id="864e" class="mm lc iq la b gy mr mo l mp mq">App.store = store<br/>App.router = router<br/>Vue.customElement('vue-widget', App)</span></pre><p id="6173" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意，我们不再使用<code class="fe kx ky kz la b">new Vue()</code>了。调用<code class="fe kx ky kz la b">Vue.customElement()</code>为我们完成了这项工作——我们在第一个参数中提供了小部件名称(HTML中的<code class="fe kx ky kz la b">&lt;vue-widget&gt;&lt;/vue-widget&gt;</code>),在第二个参数中提供了我们的应用程序组件。警告:使用不带破折号的名字对我不起作用。</p><p id="a9ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你以前想包含在<code class="fe kx ky kz la b">new Vue()</code>中的任何东西，现在都应该作为一个属性包含在<code class="fe kx ky kz la b">App </code>中，在所有设置完成后调用<code class="fe kx ky kz la b">Vue.customElement()</code>。</p><h1 id="b8c3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">2.改变你的index.html</h1><p id="0586" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated"><code class="fe kx ky kz la b">public/index.html</code></p><p id="beb8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们应该移除我们的<code class="fe kx ky kz la b">&lt;div id="app"&gt;&lt;/div&gt;</code>并用新的<code class="fe kx ky kz la b">&lt;vue-widget&gt;&lt;/vue-widget&gt;</code>替换它。用您的应用程序重新加载浏览器选项卡。如果一切都像以前一样工作，您就可以构建了！</p><p id="6658" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">小心:当心老(更)浏览器。您可能需要自定义聚合填充，以便HTML自定义元素能够工作。只需下载它并将其导入到main.js文件中。</strong></p><p id="3f25" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kx ky kz la b">npm install document-register-element --save</code></p><p id="1b35" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kx ky kz la b">src/main.js</code></p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="a84c" class="mm lc iq la b gy mn mo l mp mq">import 'document-register-element/build/document-register-element'</span></pre><h1 id="6b7b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">3.运行构建</h1><p id="8cbf" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated"><code class="fe kx ky kz la b">npm run build</code></p><p id="465f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">建筑给你你想要的来源——压缩的、整洁的、体积小的。但是如果你正在开发一个更大的应用程序，你可能会体验到有<strong class="ka ir">几十个。您的dist (build)文件夹中的js块文件</strong>。这不是我们想要的！<strong class="ka ir">我们想要一个单独的app.js文件</strong>，可以导入到其他站点，而不是41个1-3kb的文件。js文件..</p><h1 id="bc6b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">4.禁用区块</h1><p id="c753" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">你可以用<strong class="ka ir"> Vue CLI 3 </strong>做一些魔术。您也可以使用较旧的CLI来实现这一点，但是它的实现方式不会在本文中展示。</p><p id="45f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在应用程序的根目录下创建一个<code class="fe kx ky kz la b">vue.config.js</code>文件(在<code class="fe kx ky kz la b">package.json</code>旁边)。这是在Vue CLI 3中编写webpack配置的地方。</p><p id="671c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要安装webpack来使用它的<em class="ms"> LimitChunkCountPlugin </em>。我们还需要传递配置来删除分割块。</p><p id="8a26" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kx ky kz la b">npm install webpack --save</code></p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="2094" class="mm lc iq la b gy mn mo l mp mq">const webpack = require('webpack')</span><span id="ee51" class="mm lc iq la b gy mr mo l mp mq">module.exports = {<br/>  configureWebpack: {<br/>    plugins: [<br/>      new webpack.optimize.LimitChunkCountPlugin({<br/>        maxChunks: 1<br/>      })<br/>    ]<br/>  },<br/>  chainWebpack:<br/>    config =&gt; {<br/>      config.optimization.delete('splitChunks')<br/>    }<br/>}</span></pre><p id="9865" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">编辑2019年3月30日—请随意将<code class="fe kx ky kz la b">filenameHashing: false</code>添加到配置<strong class="ka ir"> </strong>中，作为评论中提到的<a class="mt mu ep" href="https://medium.com/u/846c233c9aa5?source=post_page-----674bdcb96b97--------------------------------" rel="noopener" target="_blank">马克西姆·马尼洛夫</a>。</p><h1 id="4ec8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">5.运行构建..又来了？</h1><p id="711f" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated"><code class="fe kx ky kz la b">npm run build</code></p><p id="5903" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们做的一切都正确，现在的构建应该会好得多，只有一个app.js和一个app.css文件。耶！</p><p id="0063" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是等等。如果我们使用字体或图像，它们包含在构建文件夹(<code class="fe kx ky kz la b">/dist</code>)中，并绑定在样式和脚本文件中。我们不希望在想要嵌入小部件的页面中导入所有这些资产——我们也没有必要这样做！</p><h1 id="9422" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">6.主持它。htaccess it</h1><p id="55ac" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">当然，您的应用程序需要一个托管域。这个域必须包括<strong class="ka ir">你的整个编译源代码</strong>—<code class="fe kx ky kz la b">/dist</code>文件夹中的所有内容。假设我拥有一个域名<code class="fe kx ky kz la b"><a class="ae kw" href="https://vuidget-source.danajanoskova.sk/" rel="noopener ugc nofollow" target="_blank">https://vuidget-source.danajanoskova.sk/</a></code>和一个虚拟主机。我已经创建了一个Vue.js嵌入式小部件，我已经构建了源代码，现在，我将把<code class="fe kx ky kz la b">/dist</code>文件夹的内容上传到我的域中。所有需要的资产都在那里，我需要做的就是将我的app.js和app.css文件包含在我想要显示小部件的站点中。</p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="4c5a" class="mm lc iq la b gy mn mo l mp mq">&lt;link href="https://vuidget-source.danajanoskova.sk/css/app.css" rel="<!-- -->stylesheet"<!-- -->/&gt; <br/><br/>&lt;vue-widget title="Vuidget live example"&gt;&lt;/vue-widget&gt; <br/><br/>&lt;script src="http://vuidget-source.danajanoskova.sk/js/app.js"&gt;&lt;/script&gt;</span></pre><p id="a857" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，app.js和app.css文件正在寻找我们已经上传到我们的主机域(<code class="fe kx ky kz la b"><a class="ae kw" href="https://vuidget-source.danajanoskova.sk/" rel="noopener ugc nofollow" target="_blank">https://vuidget-source.danajanoskova.sk/</a>)</code>)的图像或字体等资产。这就是为什么我们必须让外部资源可以访问它们。我通过在我的域文件夹的根目录下添加一个<code class="fe kx ky kz la b">.htaccess</code>文件来解决这个问题，紧挨着我的<code class="fe kx ky kz la b">index.html</code>文件，其内容如下:</p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="56e8" class="mm lc iq la b gy mn mo l mp mq">Header add Access-Control-Allow-Origin "*"</span></pre><p id="56e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我的<em class="ms"> vuidget-source </em>站点已经运行良好，托管了app.js和app.css文件，所有资源可供其他站点使用。</p><h1 id="eb7d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">7.嵌入它</h1><p id="cfe7" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">恭喜，你已经走到这一步了。你现在需要做的就是使用你已经创建的文件。假设我有另一个域— <code class="fe kx ky kz la b"><a class="ae kw" href="https://vuidget.danajanoskova.sk/" rel="noopener ugc nofollow" target="_blank">https://vuidget.danajanoskova.sk/</a></code>，这个站点是我想嵌入小部件的地方。我需要做的就是在根目录下写一个内容如下的<code class="fe kx ky kz la b">index.html</code>文件</p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="c86b" class="mm lc iq la b gy mn mo l mp mq">&lt;!doctype html&gt;<br/>&lt;html&gt;</span><span id="c74f" class="mm lc iq la b gy mr mo l mp mq">&lt;head&gt;<br/> &lt;!-- widget source css --&gt;<br/> &lt;link href="<a class="ae kw" href="http://vuidget-source.danajanoskova.sk/css/app.css" rel="noopener ugc nofollow" target="_blank">https://vuidget-source.danajanoskova.sk/css/app.css</a>" rel="stylesheet"&gt;<br/>&lt;/head&gt;</span><span id="cbef" class="mm lc iq la b gy mr mo l mp mq">&lt;body&gt;<br/> &lt;vue-widget title="Vuidget live example"&gt;&lt;/vue-widget&gt;</span><span id="126d" class="mm lc iq la b gy mr mo l mp mq"> &lt;!-- widget source js --&gt;<br/> &lt;script src="<a class="ae kw" href="http://vuidget-source.danajanoskova.sk/js/app.js" rel="noopener ugc nofollow" target="_blank">https://vuidget-source.danajanoskova.sk/js/app.js</a>"&gt;&lt;/script&gt;<br/>&lt;/body&gt;</span><span id="ee79" class="mm lc iq la b gy mr mo l mp mq">&lt;/html&gt;</span></pre><p id="7a9e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">而且很管用！</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="9fde" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请随意查看我在GitHub<br/><a class="ae kw" href="https://github.com/DJanoskova/Vuidget" rel="noopener ugc nofollow" target="_blank">【https://github.com/DJanoskova/Vuidget</a><br/>的小部件源代码，在那里您可以找到所有的构建webpack设置和我的简单演示ToDo小部件的源代码。如果您分叉存储库，应用程序应该已经准备好让您尝试编辑和使用它，已经使用vue-custom-element。</p><p id="1370" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果一切正常，并且你对你的Vue.js小部件满意，别忘了顺便访问<a class="ae kw" href="https://github.com/karol-f/vue-custom-element" rel="noopener ugc nofollow" target="_blank"> vue-custom-element </a>并给它一颗星。</p></div></div>    
</body>
</html>