<html>
<head>
<title>Deploy a Single Page Application to Azure Storage using Azure Pipelines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure管道将单个页面应用程序部署到Azure存储</h1>
<blockquote>原文：<a href="https://itnext.io/deploy-a-single-page-application-to-azure-storage-using-azure-pipelines-22b201ae47cb?source=collection_archive---------1-----------------------#2020-08-26">https://itnext.io/deploy-a-single-page-application-to-azure-storage-using-azure-pipelines-22b201ae47cb?source=collection_archive---------1-----------------------#2020-08-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1154f6ed4536783e9099312bcd6bbc33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*67MnmeP3ikWQBL1q72UC1w.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图片由Pixabay的Peter H提供</figcaption></figure><p id="f816" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这篇文章中，我将解释如何将单页面应用程序部署到azure，并使用Azure存储帐户的“静态网站”功能，我还将向您展示如何在部署期间更改JSON文件中的一些变量值。</p><p id="ac26" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">对于本文，我假设您已经:</p><ul class=""><li id="668b" class="la lb iq ke b kf kg kj kk kn lc kr ld kv le kz lf lg lh li bi translated">Azure(门户)帐户(并创建了订阅和资源组)</li><li id="4953" class="la lb iq ke b kf lj kj lk kn ll kr lm kv ln kz lf lg lh li bi translated">Azure DevOps帐户(以及已配置的项目)</li></ul><h1 id="9ea3" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">创建简单的静态web应用程序</h1><p id="5f76" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">首先，我们将从一个非常简单的web应用程序开始，一个<code class="fe mr ms mt mu b">index.html</code>文件，它在页面上显示环境和版本。</p><blockquote class="mv mw mx"><p id="42cd" class="kc kd my ke b kf kg kh ki kj kk kl km mz ko kp kq na ks kt ku nb kw kx ky kz ij bi translated"><strong class="ke ir"> <em class="iq">注意</em></strong><em class="iq">web应用非常简单。您可以使用更复杂构建的结果(例如来自React、Angular或VueJs应用程序)。这不是本文的目的。</em></p></blockquote><p id="d400" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">下面是<code class="fe mr ms mt mu b">index.html</code>文件:</p><figure class="nc nd ne nf gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="09b6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后是<code class="fe mr ms mt mu b">script.js</code>文件:</p><figure class="nc nd ne nf gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="5311" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">和<code class="fe mr ms mt mu b">config.json</code>文件:</p><figure class="nc nd ne nf gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="7626" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如您所见，web应用程序非常简单，我们只想显示config.json文件中的两个变量，并且该文件的值可能会在部署过程中发生变化(指定环境或更改版本……)。</p><h1 id="28b9" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">创建存储帐户</h1><p id="1cbc" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">我们希望将我们的静态web应用程序存储在Azure存储帐户中，因此我们需要创建一个存储帐户并激活“静态webapp”功能。</p><p id="ac39" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们开始吧…</p><ul class=""><li id="1cf4" class="la lb iq ke b kf kg kj kk kn lc kr ld kv le kz lf lg lh li bi translated">登录到您的azure帐户</li><li id="ba2e" class="la lb iq ke b kf lj kj lk kn ll kr lm kv ln kz lf lg lh li bi translated">如果没有，请创建订阅和资源组</li><li id="ea15" class="la lb iq ke b kf lj kj lk kn ll kr lm kv ln kz lf lg lh li bi translated">然后创建一个存储帐户</li></ul><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/698e2a8e865bb5680428078c0f084c16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ZG8jilcCc9gcqYXZdLcVg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">创建存储帐户</figcaption></figure><ul class=""><li id="45e0" class="la lb iq ke b kf kg kj kk kn lc kr ld kv le kz lf lg lh li bi translated">创建后，转到“设置&gt;静态网站”，然后启用它并定义索引文档名称(和错误文档路径) :</li></ul><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/fbba0dc511cce74da83af0eab5c71843.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*VbhYO6RSFNH1c2BzEN6oLg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">启用静态网站</figcaption></figure><ul class=""><li id="2153" class="la lb iq ke b kf kg kj kk kn lc kr ld kv le kz lf lg lh li bi translated">然后保存，您将拥有一个访问您的应用程序的URL:<em class="my">https://{ STORAGE _ ACCOUNT _ NAME } . z6 . web . core . windows . net/</em></li></ul><p id="085f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果您返回到您的存储帐户的容器列表，您应该有一个名为<strong class="ke ir"> $web </strong>的新容器，这是我们将部署web应用程序源代码的位置。</p><h1 id="6d5b" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">创建“构建”管道</h1><p id="8baa" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">现在我们将创建一个azure管道。</p><p id="e548" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在您的源代码库中，添加一个文件:<code class="fe mr ms mt mu b">azure-pipelines.yml</code>，内容如下:</p><figure class="nc nd ne nf gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="4dbe" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">管道会将<strong class="ke ir"> src </strong>目录中的所有文件复制到一个“ArtifactStagingDirectory”中，然后发布名为site的工件。</p><p id="7bde" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后进入<strong class="ke ir">Azure devo PS&gt;Pipelines&gt;Pipelines</strong>点击<strong class="ke ir"> New Pipeline </strong>按钮，选择你的代码在哪里(我的例子是Azure Repos)，然后按照向导进行操作。在<strong class="ke ir">配置</strong>步骤，选择<em class="my">“现有Azure管道YAML文件”</em>，然后将<code class="fe mr ms mt mu b">azure-pipelines.yml</code>写成Path:</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/91126fef647864b62ef4e4d1f32d6b55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HytAzCxfEhRvut4Ttyv8Fg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">配置您的管道</figcaption></figure><p id="b710" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后运行您的管道。</p><p id="3629" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果一切正常，您应该看到您的管道发布了<strong class="ke ir"> 1 Artefact </strong></p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/a470b4fcc2a84602f32d37977be09dfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PWwJfb6HUsZd8YQK9IeABA.png"/></div></div></figure><p id="b6ee" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在我们制造了一个藏物，我们可以部署它了！！</p><h1 id="64b8" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">创建发布管道</h1><h2 id="f166" class="nl lp iq bd lq nm nn dn lu no np dp ly kn nq nr mc kr ns nt mg kv nu nv mk nw bi translated">创建服务连接</h2><p id="0a09" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">为了允许Azure DevOps在存储帐户中添加文件，您必须定义一个<strong class="ke ir">服务连接</strong>。为此，在Azure DevOps中，进入<strong class="ke ir">项目设置&gt;服务连接</strong>。如果你没有，创建一个… <a class="ae nx" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/library/service-endpoints?view=azure-devops&amp;tabs=yaml" rel="noopener ugc nofollow" target="_blank">这是文档</a></p><p id="8e4e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦有了服务连接，单击它。</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/e94b2864e2c796ed3763320df03a7731.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/1*rVqsu3OrlKU9gCoinW1KsQ.png"/></div></figure><p id="27bb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后点击链接:<em class="my">“管理服务主体”</em>，然后<strong class="ke ir">复制</strong><em class="my">显示名称</em>(看起来应该是:{LOGIN}-{PROJECT}-{UNIQ_ID})，回到服务连接细节，点击链接<em class="my">“管理服务连接角色”</em></p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/88f89a80352f0bbe1e27daa79959edc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dq-E5RqjF8dfiYABzNhVzg.png"/></div></div></figure><p id="854b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后点击<strong class="ke ir">添加</strong>，在<em class="my">“添加角色分配”</em>中，然后在<strong class="ke ir">添加角色分配</strong>面板中，作为<strong class="ke ir">“角色”</strong>，需要选择:<em class="my">“存储Blob数据贡献者”</em>或<em class="my">“存储Blob数据所有者”</em>，作为<strong class="ke ir">“选择框”</strong>，粘贴之前复制的显示名称，并选择显示的用户，然后<strong class="ke ir"/></p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/1cc6051800b6281d2f41e91c03392d64.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*Lt9XMujhhMHoFfXe5i8riw.png"/></div></figure><h2 id="7031" class="nl lp iq bd lq nm nn dn lu no np dp ly kn nq nr mc kr ns nt mg kv nu nv mk nw bi translated">创建发布管道</h2><p id="dfe4" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">现在我们可以创建主管道，返回Azure DevOps，然后转到<strong class="ke ir">管道&gt;发布</strong>，然后单击按钮<strong class="ke ir">新建管道</strong>，将显示<em class="my">“选择模板”</em>面板，单击<strong class="ke ir">空作业</strong>。</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ob"><img src="../Images/1502ebae882079036134acf37197a598.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*39U-DsNvbdT52AsaYcA9pw.png"/></div></div></figure><p id="7458" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后给你的阶段起个名字，记得也给你的管道起个名字…</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/19f7b3fae3439d345af92bd4b0f0c401.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ppB3Oe9uKKETGyo76zG7oQ.png"/></div></div></figure><p id="7bf6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">添加一个工件到你的管道点击<strong class="ke ir"> +添加一个工件</strong>，然后选择“构建”，然后项目，源代码库，管道和我定义的<em class="my">“源代码别名”</em>到<strong class="ke ir">站点</strong>。</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/3c439576ea25e3ddac05f34a65df581f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_TTkSzZqSM5u-SdiUrSeqg.png"/></div></div></figure><p id="b509" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在点击链接:<em class="my">“1个作业，0个任务”</em>创建您的任务…</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oe"><img src="../Images/97a0c28deb2e222e5407deefade3c263.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kKgfT-AI--4MVP7R-kRfpg.png"/></div></div></figure><p id="c489" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">点击<em class="my">“代理作业”</em>上的<strong class="ke ir"> + </strong>按钮，使用任务面板添加<strong class="ke ir">“Azure文件复制”</strong>任务。</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi of"><img src="../Images/7387c49c99668b22dd3defc2b36d0aa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ASS7ve-8VrLQgjGsJP6hHg.png"/></div></div></figure><p id="8b56" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后配置任务</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/184adeda4ce0448785a922a81b7f9e8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4CTObWp68YXIOaViKxp4Ug.png"/></div></div></figure><p id="a808" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后单击Save，给出一个Git Commit消息，并单击ok。</p><p id="a0a0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">点击左侧菜单中的<strong class="ke ir">管道&gt;发布</strong>项，然后选择您的管道，点击<strong class="ke ir">按钮【创建发布】</strong>，选择要触发的阶段(<strong class="ke ir"> <em class="my">部署工件</em> </strong>)，点击<strong class="ke ir">创建</strong>。</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/68afb34cd10eeb0cf31b5bcb695ab652.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*o8cP9GsjNkTDYi7drwI1MQ.png"/></div></figure><p id="62c1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果一切正常，你可以去看看<strong class="ke ir">你的网站，它应该是活的！！！</strong></p><h2 id="1b54" class="nl lp iq bd lq nm nn dn lu no np dp ly kn nq nr mc kr ns nt mg kv nu nv mk nw bi translated">重写config.json</h2><p id="3d76" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">好了，现在我们的web应用程序是活动的，但是我们希望<code class="fe mr ms mt mu b">config.json</code>文件的一些值根据应用程序部署的环境进行更改，</p><p id="2122" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为此，我们将在发布管道中添加一项任务:</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oi"><img src="../Images/bc05a5d41c972918f3d799a4d4386c14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*58LKH782wKTAqSsyjNDEjw.png"/></div></div></figure><p id="86f0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">保存。</p><p id="3e6f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在我们可以添加一些变量</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oj"><img src="../Images/73e43a71f5bf34c1e8fbe8f906c9b375.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rv3W4-ArTce1eyheEHXjKA.png"/></div></div></figure><p id="91f4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">保存您的管道，创建一个新的发布，并查看结果！！</p><p id="7787" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这些值已被管道修改。</p><p id="f072" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">希望这篇文章对你有帮助，欢迎评论和鼓掌。</p></div></div>    
</body>
</html>