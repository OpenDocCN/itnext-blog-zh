<html>
<head>
<title>How to run Cucumber parallel tests on Jenkins Pipeline stages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Jenkins管道阶段上运行黄瓜并行测试</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-run-cucumber-parallel-tests-on-jenkins-pipeline-stages-6382bbe4518f?source=collection_archive---------4-----------------------#2019-06-24">https://itnext.io/how-to-run-cucumber-parallel-tests-on-jenkins-pipeline-stages-6382bbe4518f?source=collection_archive---------4-----------------------#2019-06-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b105" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Cucumber是一个流行的用于行为驱动开发(BDD)的自动化测试工具，但是当你在你的工作项目中使用它一段时间后，自动化测试的数量就会增加，你需要花费几十分钟来运行你的Cucumber测试套件。有时候，复杂的项目可能需要几个小时的执行时间来进行黄瓜测试。为了节省时间并加快您在CI(持续集成)上构建Cucumber的速度，您可以使用CI并行化。在本文中，您将看到如何使用Jenkins并行管道为Jenkins实现这一点。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/7084faa73a7909894687625c9839c10f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lTNHiKXmAcWXdBxr.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">黄瓜+詹金斯</figcaption></figure><h1 id="7338" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">如何平行拆分黄瓜测试</h1><p id="d666" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">Jenkins允许您将管道配置为代码，并使用Jenkins管道阶段来定义将并行(同时)执行的任务。</p><p id="c13b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个例子中，您将使用持续集成工具，如cucumber ruby gem和<a class="ae me" href="https://knapsackpro.com/?utm_source=medium&amp;utm_medium=blog_post&amp;utm_campaign=cucumber-testing-with-jenkins-parallel-pipeline-to-get-down-ci-build-time" rel="noopener ugc nofollow" target="_blank">backpack _ pro gem，来跨并行的Jenkins阶段</a>分割测试。</p><p id="4510" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您使用Cucumber测试Ruby on Rails项目时，您希望确保并行执行的测试将在相似的时间完成工作，以充分利用您的CI服务器资源。正如你所知道的，一些测试文件可以有很少的测试，而其他的测试用例要多得多。根据测试文件的内容，每个测试文件的执行时间可能不同，这使得在并行任务之间以最佳方式分配测试变得更加困难。</p><p id="e82e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将测试套件中的测试文件分割到每个Jenkins并行阶段是很重要的，这样可以消除瓶颈(一个比其他阶段运行测试时间更长的缓慢阶段)。要做到这一点，你可以<a class="ae me" href="https://knapsackpro.com/?utm_source=medium&amp;utm_medium=blog_post&amp;utm_campaign=cucumber-testing-with-jenkins-parallel-pipeline-to-get-down-ci-build-time" rel="noopener ugc nofollow" target="_blank">使用Cucumber </a> test runner的背包Pro队列模式，跨并行阶段动态分割测试套件。在下面的视频中，您将了解队列模式是如何工作的:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mf mg l"/></div></figure><h1 id="a804" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">詹金斯流水线并行黄瓜测试</h1><p id="a98d" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">这是Jenkinsfile的配置，其中使用<a class="ae me" href="https://knapsackpro.com/?utm_source=medium&amp;utm_medium=blog_post&amp;utm_campaign=cucumber-testing-with-jenkins-parallel-pipeline-to-get-down-ci-build-time" rel="noopener ugc nofollow" target="_blank">backpack _ pro插件</a>运行黄瓜测试的4个并行阶段。</p><pre class="km kn ko kp gt mh mi mj mk aw ml bi"><span id="a181" class="mm lc iq mi b gy mn mo l mp mq">timeout(time: 60, unit: 'MINUTES') {<br/>  node() {<br/>    stage('Checkout') {<br/>      checkout([/* checkout code from git */])<br/><br/>      // determine git commit hash because we need to pass it to knapsack_pro<br/>      COMMIT_HASH = sh(returnStdout: true, script: 'git rev-parse HEAD').trim()<br/><br/>      stash 'source'<br/>    }<br/>  }<br/><br/>  def num_nodes = 4; // define your total number of CI nodes (how many parallel jobs will be executed)<br/>  def nodes = [:]<br/><br/>  for (int i = 0; i &lt; num_nodes; i++) {<br/>    def index = i;<br/>    nodes["ci_node_${i}"] = {<br/>      node() {<br/>        stage('Setup') {<br/>          unstash 'source'<br/>          // other setup steps<br/>        }<br/><br/>        def knapsack_options = """\<br/>            KNAPSACK_PRO_CI_NODE_TOTAL=${num_nodes}\<br/>            KNAPSACK_PRO_CI_NODE_INDEX=${index}\<br/>            KNAPSACK_PRO_COMMIT_HASH=${COMMIT_HASH}\<br/>            KNAPSACK_PRO_BRANCH=${env.BRANCH_NAME}\<br/>        """<br/><br/>        // Example how to run Cucumber tests in Knapsack Pro Queue Mode<br/>        // Queue Mode should be a last stage if you have other stages in your pipeline<br/>        // thanks to that it can autobalance CI build time if other tests were not perfectly distributed<br/>        stage('Run Cucumber tests') {<br/>          sh """KNAPSACK_PRO_CI_NODE_BUILD_ID=${env.BUILD_TAG} ${knapsack_options} bundle exec rake knapsack_pro:queue:cucumber"""<br/>        }<br/>      }<br/>    }<br/>  }<br/><br/>  parallel nodes // run CI nodes in parallel<br/>}</span></pre><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mf mg l"/></div></figure><h1 id="4c97" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">摘要</h1><p id="69b1" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">测试大型项目是一项耗费精力的任务。用Cucumber进行自动化测试会有所帮助。当您可以利用Jenkins stages的并行测试执行，并通过使用<a class="ae me" href="https://knapsackpro.com/?utm_source=medium&amp;utm_medium=blog_post&amp;utm_campaign=cucumber-testing-with-jenkins-parallel-pipeline-to-get-down-ci-build-time" rel="noopener ugc nofollow" target="_blank">背包Pro队列模式</a>进行最佳测试套件分割时，您的CI服务器(如Jenkins)可以提供更多帮助。队列模式也适用于其他<a class="ae me" href="https://docs.knapsackpro.com/integration/" rel="noopener ugc nofollow" target="_blank"> Ruby或JavaScript测试运行者</a>。</p><p id="2e99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi">— — —</p><p id="050e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最初发布于:<a class="ae me" href="https://docs.knapsackpro.com/2019/cucumber-testing-with-jenkins-parallel-pipeline-to-get-down-ci-build-time" rel="noopener ugc nofollow" target="_blank">https://docs . knapsackpro . com/2019/cucumber-testing-with-Jenkins-parallel-pipeline-to-get-down-ci-build-time</a></p></div></div>    
</body>
</html>