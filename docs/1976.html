<html>
<head>
<title>Custom WordPress Theme Development with SPRO</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用SPRO定制WordPress主题开发</h1>
<blockquote>原文：<a href="https://itnext.io/custom-wordpress-theme-development-with-spro-f2233ab35b0a?source=collection_archive---------7-----------------------#2019-03-05">https://itnext.io/custom-wordpress-theme-development-with-spro-f2233ab35b0a?source=collection_archive---------7-----------------------#2019-03-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a752a753999c58da11c73a85ecdd0c41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GRq9QgbNNmwh5dHWkcXlOw.jpeg"/></div></div></figure><p id="d9ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">SPRO是预定义吞咽任务的样板。任务是为你的项目建立开发环境，而不是一次又一次地编写冗长的任务。在这篇文章中，我将向你展示如何为自定义WordPress主题开发配置SPRO。</p><p id="9c6f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你想更多地了解SPRO，请阅读上周的介绍文章。</p><h1 id="951b" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">视频课</h1><p id="72b8" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">如果你更喜欢看视频而不是阅读文章，你可以继续<a class="ae kw" href="https://skl.sh/2EcUlRt" rel="noopener ugc nofollow" target="_blank">我为此录制的技能分享课程</a>。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ma"><img src="../Images/70145f941772af6914c2904b85e4baf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nhPRHCNC4QSTG1mD.jpg"/></div></div></figure><h1 id="94b4" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">项目结构</h1><p id="d842" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我将使用一个默认的WordPress安装作为我的起点。我使用飞轮的本地版本<a class="ae kw" href="https://local.getflywheel.com/" rel="noopener ugc nofollow" target="_blank">作为我的WordPress开发工具。</a></p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ma"><img src="../Images/57c11d3838c9bd53fb4e8572fb262ffc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jDAvrDXFC3n7cKeW.jpg"/></div></div></figure><p id="898d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">目的是为Sass、JavaScript、BrowserSync和Critical CSS的219个默认主题添加Gulp任务。</p><p id="1c62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我已经重新组织了主题中的代码。首先，我创建了一个名为<code class="fe mf mg mh mi b">css</code>的新文件夹，并将所有的Sass文件和<code class="fe mf mg mh mi b">sass</code>文件夹移到其中。接下来，我新建了一个名为<code class="fe mf mg mh mi b">src</code>的文件夹，并将新建的<code class="fe mf mg mh mi b">css</code>文件夹和现有的<code class="fe mf mg mh mi b">js</code>文件夹移动到<code class="fe mf mg mh mi b">src</code>文件夹中。</p><p id="31e7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">项目结构如下所示:</p><pre class="mb mc md me gt mj mi mk ml aw mm bi"><span id="2b30" class="mn ky iq mi b gy mo mp l mq mr">|-- src<br/>|   |-- css<br/>|   |   |-- style.scss<br/>|   |   |-- ...<br/>|   |   |-- sass<br/>|   |       |-- _normalize.scss<br/>|   |       |-- ...<br/>|   |-- js<br/>|       |-- customize-controls.js<br/>|       |-- ...</span></pre><h1 id="32ce" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">SPRO装置</h1><p id="1d55" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">要安装SPRO，运行<code class="fe mf mg mh mi b">npm install starter-project-cli -s</code>命令，然后通过执行<code class="fe mf mg mh mi b">node_modules/.bin/spro start</code>命令运行SPRO。SPRO<a class="ae kw" href="https://www.silvestarbistrovic.from.hr/articles/introducing-spro/#Installation" rel="noopener ugc nofollow" target="_blank">也可用于全球安装</a>。现在你应该被提示回答关于项目架构和吞咽任务的问题。</p><p id="bfe7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以下是我的简短回答:</p><pre class="mb mc md me gt mj mi mk ml aw mm bi"><span id="686c" class="mn ky iq mi b gy mo mp l mq mr">    GENERAL | Do you want to override the project? Yes<br/>    GENERAL | What is the root folder of the project? ./<br/>    GENERAL | Where is the folder with the source code of the project? src<br/>    GENERAL | Where do you want to store compiled code of the project? build<br/>    GENERAL | Are you sure that you want to override the project? Yes<br/>BROWSERSYNC | Do you want to run BrowserSync to preview changes in the browser? Yes<br/>       HTML | Do you want to run HTML tasks? No<br/>        CSS | Do you want to run CSS tasks? Yes<br/>        CSS | Are you using Sass? Yes<br/>        CSS | Where is the folder with CSS source code? css<br/>        CSS | Where do you want to store compiled CSS code? css<br/>        CSS | Do you want to minify CSS code? Yes<br/>        CSS | Do you want to autoprefix CSS code? Yes<br/>        CSS | Do you want to add sourcemaps for CSS code? No<br/>        CSS | Do you want to lint CSS code? No<br/>         JS | Do you want to run JavaScript (es6) tasks? Yes<br/>         JS | Where is the folder with JavaScript source code? js<br/>         JS | Where do you want to store compiled JavaScript code? js<br/>         JS | Do you want to minify JavaScript code? Yes<br/>         JS | Do you want to add sourcemaps for JavaScript code? No<br/>         JS | Do you want to lint JavaScript code? No<br/>     IMAGES | Do you want to run image optimization tasks? No<br/>      FONTS | Do you use local fonts? Do you want to run font tasks? No<br/>    FAVICON | Do you want to run favicon tasks? No<br/>   CRITICAL | Do you want to extract Critical CSS? Yes<br/>   COMPRESS | Do you want to compress (gzip) all assets? No<br/>        KSS | Do you want to add KSS style guide? No<br/>    SASSDOC | Do you want to add documentation for the SASS code (SassDoc)? No<br/>      JSDOC | Do you want to add documentation for the JS code (JSDoc)? No<br/>     SEMVER | Do you want to add semver versioning tasks? No<br/>       YARN | Do you use Yarn as your default dependency manager? Yes</span></pre><p id="bfdc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装完成后，SPRO会将任务和配置文件复制到<code class="fe mf mg mh mi b">gulpfile.js</code>文件夹中。</p><p id="7b07" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了能够运行吞咽任务，我们应该安装所有需要的依赖项。您可以在终端中找到安装命令，就在问题后面。将该命令粘贴到您的终端中，然后按Enter键。</p><h1 id="7136" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">SPRO构型</h1><p id="fb96" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">现在我们已经有了所有必需的Gulp任务和依赖项，我们可以配置SPRO了。</p><p id="f47d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">先说BrowserSync。我想使用BrowserSync来预览浏览器中的更改。本地通过飞轮工具已经为我配置了本地站点域。我的情况是<code class="fe mf mg mh mi b">spro-wp.v</code>。我将使用本地域作为BrowserSync的代理。</p><pre class="mb mc md me gt mj mi mk ml aw mm bi"><span id="2ff2" class="mn ky iq mi b gy mo mp l mq mr">{<br/>  “proxy”: “http://spro-wp.v"<br/>}</span></pre><p id="9264" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们应该更新提取关键CSS的URL，以匹配我们在<code class="fe mf mg mh mi b">.critical.json</code>文件中的开发域。</p><pre class="mb mc md me gt mj mi mk ml aw mm bi"><span id="0ad4" class="mn ky iq mi b gy mo mp l mq mr">[{<br/>  “src”: “style.css”,<br/>  “settings”: {<br/>    “out”: “style.critical.css”,<br/>    “url”: “http://spro-wp.v/",<br/>    “width”: 1920,<br/>    “height”: 1200,<br/>    “keepLargerMediaQueries”: true,<br/>    “strict”: false,<br/>    “blockJSRequests”: false,<br/>    “phantomJsOptions”: {<br/>      “ssl-protocol”: “any”,<br/>      “ignore-ssl-errors”: true<br/>    }<br/>  }<br/>}]</span></pre><p id="4927" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里还有其他选项，但最重要的是<code class="fe mf mg mh mi b">src</code>和<code class="fe mf mg mh mi b">out</code>选项。<code class="fe mf mg mh mi b">src</code>选项告诉我们使用哪个文件作为提取关键CSS的源文件，而<code class="fe mf mg mh mi b">out</code>选项告诉Penthouse应该在哪个文件中存储提取的关键CSS代码。要了解更多关于顶层公寓的信息，请访问顶层公寓官方网站。</p><p id="9305" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，我们应该在名为<code class="fe mf mg mh mi b">style.critical.scss</code>的<code class="fe mf mg mh mi b">sass</code>文件夹中创建一个新的Sass文件。</p><h1 id="119a" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">运行任务</h1><p id="2129" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">要查看可用Gulp任务列表，运行<code class="fe mf mg mh mi b">gulp --tasks</code>命令。我们有四项任务:</p><ul class=""><li id="d82a" class="ms mt iq ka b kb kc kf kg kj mu kn mv kr mw kv mx my mz na bi translated"><code class="fe mf mg mh mi b">clean</code>用于清理编译后的代码，以及</li><li id="256f" class="ms mt iq ka b kb nb kf nc kj nd kn ne kr nf kv mx my mz na bi translated">开发的三个任务:<code class="fe mf mg mh mi b">dev</code>、<code class="fe mf mg mh mi b">build</code>和<code class="fe mf mg mh mi b">default</code>。</li></ul><p id="c0c7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你运行<code class="fe mf mg mh mi b">default</code> Gulp任务，站点应该在浏览器中打开。</p><p id="6d8c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于我们编译的代码存储在<code class="fe mf mg mh mi b">build</code>文件夹中，我们应该更新CSS和JavaScript文件的路径。在<code class="fe mf mg mh mi b">functions.php</code>文件中，更新<code class="fe mf mg mh mi b">twentynineteen_scripts</code>功能:</p><pre class="mb mc md me gt mj mi mk ml aw mm bi"><span id="f953" class="mn ky iq mi b gy mo mp l mq mr">&lt;?php</span><span id="97c1" class="mn ky iq mi b gy ng mp l mq mr">function twentynineteen_scripts() {<br/>  // Will load CSS file at the end of the page<br/>  // wp_enqueue_style( ‘twentynineteen-style’, get_stylesheet_uri(), array(), wp_get_theme()-&gt;get( ‘Version’ ) );</span><span id="395e" class="mn ky iq mi b gy ng mp l mq mr">wp_style_add_data( ‘twentynineteen-style’, ‘rtl’, ‘replace’ );</span><span id="cf3a" class="mn ky iq mi b gy ng mp l mq mr">  // Will update the path to the JavaScript files<br/>  if ( has_nav_menu( ‘menu-1’ ) ) {<br/>    wp_enqueue_script( ‘twentynineteen-priority-menu’, get_theme_file_uri( ‘/build/js/priority-menu.js’ ), array(), ‘1.1’, true );<br/>    wp_enqueue_script( ‘twentynineteen-touch-navigation’, get_theme_file_uri( ‘/build/js/touch-keyboard-navigation.js’ ), array(), ‘1.1’, true );<br/>  }</span><span id="55b9" class="mn ky iq mi b gy ng mp l mq mr">  // Will update the path to the print CSS file<br/>  wp_enqueue_style( ‘twentynineteen-print-style’, get_template_directory_uri() . ‘/build/css/print.css’, array(), wp_get_theme()-&gt;get( ‘Version’ ), ‘print’ );</span><span id="c742" class="mn ky iq mi b gy ng mp l mq mr">  if ( is_singular() &amp;&amp; comments_open() &amp;&amp; get_option( ‘thread_comments’ ) ) {<br/>    wp_enqueue_script( ‘comment-reply’ );<br/>  }<br/>}<br/>?&gt;</span></pre><p id="a7ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们正在删除主样式文件，并更新JavaScript和打印CSS文件的路径。</p><p id="582b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe mf mg mh mi b">footer.php</code>文件中，在结束body标签之前添加一个到主样式文件的链接:</p><pre class="mb mc md me gt mj mi mk ml aw mm bi"><span id="7bc6" class="mn ky iq mi b gy mo mp l mq mr">&lt;link rel=”stylesheet” href=”&lt;?php echo get_theme_file_uri(‘/build/css/style.css’); ?&gt;”&gt;</span></pre><p id="1e7f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">理想情况下，我们应该按照Google的建议推迟加载不重要的CSS文件<a class="ae kw" href="https://developers.google.com/web/tools/lighthouse/audits/unused-css#deferring" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="d339" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">关键CSS</h1><p id="95ff" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">接下来，让我们在HTML文档的头部内联关键CSS，在<code class="fe mf mg mh mi b">header.php</code>文件中。</p><pre class="mb mc md me gt mj mi mk ml aw mm bi"><span id="e24e" class="mn ky iq mi b gy mo mp l mq mr">&lt;?php<br/>$critical = get_template_directory() . ‘/build/css/style.critical.css’;</span><span id="2236" class="mn ky iq mi b gy ng mp l mq mr">if ( file_exists( $critical ) ) {<br/>  echo ‘&lt;style&gt;’;<br/>  require_once $critical;<br/>  echo ‘&lt;/style&gt;’;<br/>}<br/>?&gt;</span></pre><p id="ee70" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您正确遵循了说明，您应该能够在您的终端中运行<code class="fe mf mg mh mi b">gulp</code>命令。Gulp应该编译代码，然后在浏览器中打开站点，然后提取关键的CSS，然后刷新浏览器。</p><h1 id="4d4d" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h1><p id="4e2b" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">正如你所看到的，我从来没有碰过任何Gulp任务，只是配置文件。这正是SPRO的全部。</p><p id="8851" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您有任何反馈，我们将不胜感激。SPRO还处于早期阶段，不久将会增加更多功能。</p><p id="d2d9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请广而告之。更多课程即将推出！📣</p></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><p id="577b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="no">原载于</em><a class="ae kw" href="https://www.silvestarbistrovic.from.hr/articles/custom-wordpress-theme-development-with-spro/" rel="noopener ugc nofollow" target="_blank"><em class="no">www . silvestarbitrovic . from . HR</em></a><em class="no">。</em></p></div></div>    
</body>
</html>