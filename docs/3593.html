<html>
<head>
<title>Let’s talk about big numbers in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我们来谈谈JavaScript中的大数字</h1>
<blockquote>原文：<a href="https://itnext.io/lets-talk-about-big-numbers-in-javascript-b0a2c8edb170?source=collection_archive---------1-----------------------#2020-01-14">https://itnext.io/lets-talk-about-big-numbers-in-javascript-b0a2c8edb170?source=collection_archive---------1-----------------------#2020-01-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a31853f534a52520befa0b2405347b0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rSsK_BvanOJWU8cyIcAJ0w.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">数字——照片由<a class="ae kc" href="https://pexels.com/" rel="noopener ugc nofollow" target="_blank">https://pexels.com</a>提供</figcaption></figure><blockquote class="kd"><p id="4615" class="ke kf iq bd kg kh ki kj kk kl km kn dk translated">实话实说，在2020年，用JavaScript处理数字仍然显得很原始！</p></blockquote><h1 id="a610" class="ko kp iq bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">介绍</h1><p id="1955" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi kn ij bi translated">在本文中，我们将回顾“JavaScript中的大数支持”的状态，尽管这个话题由来已久，并在社区论坛中被广泛讨论，但它仍然非常重要。对于希望在JavaScript/Node.js中找到一个健壮的运行时来构建所有类型的web应用程序的JavaScript开发人员来说,“最了解”。</p><p id="be01" class="pw-post-body-paragraph lm ln iq lo b lp mj lr ls lt mk lv lw lx ml lz ma mb mm md me mf mn mh mi kn ij bi translated">从未听说过这个问题？只需在您的JavaScript控制台上执行以下算术计算:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="8237" class="mx kp iq mt b gy my mz l na nb">0.0000000000000001 + 1</span></pre></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><p id="8a5b" class="pw-post-body-paragraph lm ln iq lo b lp mj lr ls lt mk lv lw lx ml lz ma mb mm md me mf mn mh mi kn ij bi translated">让我们通过描述当前JavaScript支持的数据类型来深入了解一下。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="6d64" class="mx kp iq mt b gy my mz l na nb">The latest ECMAScript standard defines eight data types. Seven data types that are <a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Glossary/Primitive" rel="noopener ugc nofollow" target="_blank">primitives</a>:</span><span id="4fbe" class="mx kp iq mt b gy nj mz l na nb">1. <a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Glossary/Boolean" rel="noopener ugc nofollow" target="_blank">Boolean</a><br/>2. <a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Glossary/Null" rel="noopener ugc nofollow" target="_blank">Null</a><br/>3. <a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Glossary/Undefined" rel="noopener ugc nofollow" target="_blank">Undefined</a><br/>4. <a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Glossary/Number" rel="noopener ugc nofollow" target="_blank">Number</a><br/>5. <a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Glossary/BigInt" rel="noopener ugc nofollow" target="_blank">BigInt</a><br/>6. <a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Glossary/String" rel="noopener ugc nofollow" target="_blank">String</a><br/>7. <a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Glossary/Symbol" rel="noopener ugc nofollow" target="_blank">Symbol</a></span><span id="e538" class="mx kp iq mt b gy nj mz l na nb">and <a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Glossary/Object" rel="noopener ugc nofollow" target="_blank">Object</a></span></pre><blockquote class="nk nl nm"><p id="d919" class="lm ln nn lo b lp mj lr ls lt mk lv lw no ml lz ma np mm md me nq mn mh mi kn ij bi translated"><a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures" rel="noopener ugc nofollow" target="_blank">T10】https://developer . Mozilla . org/en-US/docs/Web/JavaScript/Data _ structuresT12】</a></p></blockquote><p id="6085" class="pw-post-body-paragraph lm ln iq lo b lp mj lr ls lt mk lv lw lx ml lz ma mb mm md me mf mn mh mi kn ij bi translated">正如我们所注意到的，数字只能用两种数据类型来表示。JavaScript <code class="fe nr ns nt mt b">Number</code>类型，即<a class="ae kc" href="https://en.wikipedia.org/wiki/Floating-point_arithmetic" rel="noopener ugc nofollow" target="_blank">双精度64位二进制格式IEEE 754 </a>值，而任意精度的整数可以使用<code class="fe nr ns nt mt b"><a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt" rel="noopener ugc nofollow" target="_blank">BigInt</a></code>类型表示。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="911f" class="mx kp iq mt b gy my mz l na nb">typeof 3.9 === “number”   // -&gt; TRUE<br/>typeof 2   === “number”   // -&gt; TRUE<br/>typeof -1  === “number”   // -&gt; TRUE</span><span id="d315" class="mx kp iq mt b gy nj mz l na nb">typeof -1<strong class="mt ir">n</strong> === "bigint"   // -&gt; TRUE<br/>typeof 1304958309583095830495830459830459830<strong class="mt ir">n</strong> === "bigint" //-&gt; TRUE</span><span id="6123" class="mx kp iq mt b gy nj mz l na nb">1n + 2 // -&gt; Uncaught TypeError: Cannot mix BigInt and other types, use explicit conversions</span></pre><p id="f068" class="pw-post-body-paragraph lm ln iq lo b lp mj lr ls lt mk lv lw lx ml lz ma mb mm md me mf mn mh mi kn ij bi translated">到此为止，我们已经发现了几个问题:</p><ul class=""><li id="c344" class="nu nv iq lo b lp mj lt mk lx nw mb nx mf ny kn nz oa ob oc bi translated">没有整数、双精度、小数、浮点数等分类，每个数字都只是一个<code class="fe nr ns nt mt b">Number</code></li><li id="bb9a" class="nu nv iq lo b lp od lt oe lx of mb og mf oh kn nz oa ob oc bi translated"><code class="fe nr ns nt mt b"><a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt" rel="noopener ugc nofollow" target="_blank">BigInt</a></code>数据类型只包含任意精度的整数。</li><li id="d0d0" class="nu nv iq lo b lp od lt oe lx of mb og mf oh kn nz oa ob oc bi translated"><code class="fe nr ns nt mt b">Number</code>和<code class="fe nr ns nt mt b"><a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt" rel="noopener ugc nofollow" target="_blank">BigInt</a></code>类型不能组合使用。</li><li id="1793" class="nu nv iq lo b lp od lt oe lx of mb og mf oh kn nz oa ob oc bi translated">任意精度的小数不能用<code class="fe nr ns nt mt b">Number</code>数据类型来表示，因为它们会被四舍五入成更小的格式。</li></ul><p id="ac09" class="pw-post-body-paragraph lm ln iq lo b lp mj lr ls lt mk lv lw lx ml lz ma mb mm md me mf mn mh mi kn ij bi translated">我的钱在哪里？</p><p id="2d3b" class="pw-post-body-paragraph lm ln iq lo b lp mj lr ls lt mk lv lw lx ml lz ma mb mm md me mf mn mh mi kn ij bi translated">不能支持应用程序运行时涉及大数字的数学运算，实际上听起来像是一个交易破坏者。也许我们需要大量支持的最常见的情况是货币操作。<br/>例如，我们可以提及在线银行、加密货币交易所等金融应用..</p><h1 id="3c51" class="ko kp iq bd kq kr ks kt ku kv kw kx ky kz oi lb lc ld oj lf lg lh ok lj lk ll bi translated">好吧，我该怎么解决？</h1><p id="8592" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi kn ij bi translated">幸运的是，JavaScript社区已经提供了机制来填补JavaScript运行时的这一空白。其中，我想强调一下伟大的<strong class="lo ir"><em class="nn">bignome . js</em></strong>库:</p><div class="ol om gp gr on oo"><a href="https://github.com/MikeMcl/bignumber.js/" rel="noopener  ugc nofollow" target="_blank"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd ir gy z fp ot fr fs ou fu fw ip bi translated">MikeMcl/bignumber.js</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">一个用于任意精度十进制和非十进制算术的JavaScript库</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">github.com</p></div></div><div class="ox l"><div class="oy l oz pa pb ox pc jw oo"/></div></div></a></div><p id="91e4" class="pw-post-body-paragraph lm ln iq lo b lp mj lr ls lt mk lv lw lx ml lz ma mb mm md me mf mn mh mi kn ij bi translated">这意味着，我们将使用一个名为<code class="fe nr ns nt mt b">BigNumber.</code> <br/>的JavaScript类，而不是使用原始的<code class="fe nr ns nt mt b">Number</code>类型进行算术运算。让我们通过一个例子来描述它:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="eefc" class="mx kp iq mt b gy my mz l na nb">const BigNumber = require('bignumber.js');</span><span id="fad7" class="mx kp iq mt b gy nj mz l na nb">const x = new BigNumber('0.0000000000000001')<br/>const y = new BigNumber('1')</span><span id="28db" class="mx kp iq mt b gy nj mz l na nb">console.log(x.plus(y).toString()) // -&gt; '1.0000000000000001'</span></pre><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/e61d358fea671291fb95e4b2ad09f2f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*y8u7ukFEQLog5JjtnAU0hA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://github.com/MikeMcl/bignumber.js/" rel="noopener ugc nofollow" target="_blank">https://github.com/MikeMcl/bignumber.js</a></figcaption></figure><p id="6ffa" class="pw-post-body-paragraph lm ln iq lo b lp mj lr ls lt mk lv lw lx ml lz ma mb mm md me mf mn mh mi kn ij bi translated"><strong class="lo ir">JSON解析支持怎么样？</strong></p><p id="8baf" class="pw-post-body-paragraph lm ln iq lo b lp mj lr ls lt mk lv lw lx ml lz ma mb mm md me mf mn mh mi kn ij bi translated">现在我们知道，使用bignumber.js这样的数学库，我们可以使用大数执行基本算术运算，这些运算被视为并表示为字符串。但是，如何解析和序列化包含大数字的JSON有效载荷呢？</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="5dc5" class="mx kp iq mt b gy my mz l na nb">const payload = "{\"user\": \"bill\",\"balance\": 9999999999999999999.000000999999999}"</span><span id="f658" class="mx kp iq mt b gy nj mz l na nb">JSON.parse(payload) <br/>// -&gt; {user: “bill”, balance: 10000000000000000000}</span></pre><p id="88d3" class="pw-post-body-paragraph lm ln iq lo b lp mj lr ls lt mk lv lw lx ml lz ma mb mm md me mf mn mh mi kn ij bi translated">再一次，我们需要看看这里的社区解决方案，因为没有我们可以使用的本地技巧。在这种情况下，我们将使用<strong class="lo ir"><em class="nn">true-JSON-bigint</em></strong>库:</p><div class="ol om gp gr on oo"><a href="https://github.com/SebastianG77/true-json-bigint" rel="noopener  ugc nofollow" target="_blank"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd ir gy z fp ot fr fs ou fu fw ip bi translated">SebastianG77/true-json-bigint</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">这是一个模块，用于将JSON字符串解析为JSON对象，并将JSON对象字符串化为JSON字符串。这是一把叉子…</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">github.com</p></div></div><div class="ox l"><div class="pe l oz pa pb ox pc jw oo"/></div></div></a></div><p id="5add" class="pw-post-body-paragraph lm ln iq lo b lp mj lr ls lt mk lv lw lx ml lz ma mb mm md me mf mn mh mi kn ij bi translated">让我们再试一次:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="b21a" class="mx kp iq mt b gy my mz l na nb">const JSON = require('true-json-bigint')</span><span id="debf" class="mx kp iq mt b gy nj mz l na nb">const payload = "{\"user\": \"bill\",\"balance\": 9999999999999999999.000000999999999}"</span><span id="0e23" class="mx kp iq mt b gy nj mz l na nb">const parsed = JSON.parse(payload) <br/>JSON.parse(payload).balance.constructor.name // -&gt; BigNumber 😘</span></pre><blockquote class="nk nl nm"><p id="f87b" class="lm ln nn lo b lp mj lr ls lt mk lv lw no ml lz ma np mm md me nq mn mh mi kn ij bi translated">这里我们将大数解析为<strong class="lo ir">bignome</strong>(<em class="iq">bignome . js</em>)对象。</p></blockquote><p id="d169" class="pw-post-body-paragraph lm ln iq lo b lp mj lr ls lt mk lv lw lx ml lz ma mb mm md me mf mn mh mi kn ij bi translated">反之亦然:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="396a" class="mx kp iq mt b gy my mz l na nb">JSON.stringify(parsed) <br/>// -&gt; “{\”user\”: \”bill\”,\”balance\”: 9999999999999999999.000000999999999}”</span></pre><p id="2bd4" class="pw-post-body-paragraph lm ln iq lo b lp mj lr ls lt mk lv lw lx ml lz ma mb mm md me mf mn mh mi kn ij bi translated">但是，数据库驱动程序呢？</p><p id="e53d" class="pw-post-body-paragraph lm ln iq lo b lp mj lr ls lt mk lv lw lx ml lz ma mb mm md me mf mn mh mi kn ij bi translated">当我们在Node.js中时，数据库驱动程序很可能不支持BigNumber类，因为它们自己想出了支持大数的实现。在这里，我们将讨论MongoDB驱动程序如何处理大十进制数。</p><blockquote class="nk nl nm"><p id="545f" class="lm ln nn lo b lp mj lr ls lt mk lv lw no ml lz ma np mm md me nq mn mh mi kn ij bi translated">我建议你做自己的研究，以防你使用其他类型的数据库引擎。</p></blockquote><div class="ol om gp gr on oo"><a href="https://docs.mongodb.com/manual/tutorial/model-monetary-data/" rel="noopener  ugc nofollow" target="_blank"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd ir gy z fp ot fr fs ou fu fw ip bi translated">货币数据模型- MongoDB手册</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">集合的值可以通过执行一次性转换或修改…</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">docs.mongodb.com</p></div></div><div class="ox l"><div class="pf l oz pa pb ox pc jw oo"/></div></div></a></div><p id="7f6f" class="pw-post-body-paragraph lm ln iq lo b lp mj lr ls lt mk lv lw lx ml lz ma mb mm md me mf mn mh mi kn ij bi translated">简而言之:</p><blockquote class="kd"><p id="d1dc" class="ke kf iq bd kg kh pg ph pi pj pk kn dk translated"><code class="fe nr ns nt mt b">decimal</code> <a class="ae kc" href="https://docs.mongodb.com/manual/reference/bson-types/" rel="noopener ugc nofollow" target="_blank"> BSON类型</a>使用IEEE 754 decimal128十进制浮点编码格式。与基于二进制的浮点格式(即<code class="fe nr ns nt mt b">double</code> BSON类型)不同，decimal128不近似十进制值，并且能够提供处理货币数据所需的精确精度。</p></blockquote><pre class="pl pm pn po pp ms mt mu mv aw mw bi"><span id="9b39" class="mx kp iq mt b gy my mz l na nb">db.transactions.insert({ <br/>  ...  <br/>  date: ISODate(), <br/>  amount: NumberDecimal(“2.0000000000000099”) <br/>})</span></pre><p id="55fb" class="pw-post-body-paragraph lm ln iq lo b lp mj lr ls lt mk lv lw lx ml lz ma mb mm md me mf mn mh mi kn ij bi translated">在您的查询操作中，您现在还应该使用<strong class="lo ir"> NumberDecimal </strong>构造函数:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="f00a" class="mx kp iq mt b gy my mz l na nb">db.transactions.find({ <br/>  amount: NumberDecimal(“2.0000000000000099”) <br/>})</span></pre><h1 id="458d" class="ko kp iq bd kq kr ks kt ku kv kw kx ky kz oi lb lc ld oj lf lg lh ok lj lk ll bi translated">结论</h1><p id="cbc0" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi kn ij bi translated">JavaScript对数字数据类型的支持很差。对于一门如今被广泛使用的语言来说，这是一件令人惊讶的事情。</p><blockquote class="kd"><p id="3892" class="ke kf iq bd kg kh pg ph pi pj pk kn dk translated">然而，在本文中，我们分析了可以用来缓解这种需求的可能的替代方案。具体来说，如何在JavaScript和Node.js中处理大数。</p></blockquote><p id="a7d7" class="pw-post-body-paragraph lm ln iq lo b lp pq lr ls lt pr lv lw lx ps lz ma mb pt md me mf pu mh mi kn ij bi translated">作为一个回顾，我们可以说有几个由社区维护的库，它们允许我们使用字符串表示对巨大的数字执行算术运算。同样，数据库驱动程序也提供了等效的解决方案。</p><p id="c3d5" class="pw-post-body-paragraph lm ln iq lo b lp mj lr ls lt mk lv lw lx ml lz ma mb mm md me mf mn mh mi kn ij bi translated">我的目标是创造意识！</p></div></div>    
</body>
</html>