<html>
<head>
<title>Publish web pages automatically with Rancher pipelines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Rancher管道自动发布网页</h1>
<blockquote>原文：<a href="https://itnext.io/publish-web-pages-automatically-with-rancher-pipelines-3db906b7bbb7?source=collection_archive---------1-----------------------#2020-12-20">https://itnext.io/publish-web-pages-automatically-with-rancher-pipelines-3db906b7bbb7?source=collection_archive---------1-----------------------#2020-12-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="3567" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">TL；</strong>博士:构建一个静态的web容器，推入你的容器注册中心，部署它，只需一个“git push”就可以获得免费的SSL证书。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/219e3624dbeea5f7ac4f65e6f0ba68c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3r4sujiuTCUDu8mHt5us7A.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">牧场主管道由詹金斯提供动力</figcaption></figure><h1 id="476f" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">介绍</h1><p id="3317" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">在互联网上发布和消费静态网页内容有很多选择。从AWS S3静态网站到一个简单的github.io网站。</p><p id="485d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此方法使用牧场主管道功能。Rancher管道相当于GitHub操作或Bitbucket管道。这是一种执行CI/CD任务或任何您想要自动执行的任务的方式。</p><p id="0b40" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">管道配置好之后，只需要做一个“git push”就可以保持静态内容的更新。</p><h1 id="c17f" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">先决条件</h1><p id="d4a4" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">当然，您需要一个带有牧场主管理的K8S集群。</p><div class="mh mi gp gr mj mk"><a href="https://jmrobles.medium.com/how-to-create-a-kubernetes-cluster-with-rancher-on-hetzner-3b2f7f0c037a" rel="noopener follow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd iu gy z fp mp fr fs mq fu fw is bi translated">如何创建一个库伯内特集群与赫茨纳牧场主</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">TL；DR:15分钟内，你就可以有一个实验室集群准备好测试或部署你的项目，既便宜又容易。</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">jmrobles.medium.com</p></div></div><div class="mt l"><div class="mu l mv mw mx mt my ky mk"/></div></div></a></div><p id="8aa5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您想在docker注册表中注册静态容器，而您还没有，那么您可以按照下面的方法操作。</p><div class="mh mi gp gr mj mk"><a href="https://jmrobles.medium.com/your-own-docker-registry-with-kubernetes-and-rancher-a71c9ecb6797" rel="noopener follow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd iu gy z fp mp fr fs mq fu fw is bi translated">你自己的码头登记处</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">TL；DR:只需5分钟即可部署一个私有docker注册表！</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">jmrobles.medium.com</p></div></div><div class="mt l"><div class="mz l mv mw mx mt my ky mk"/></div></div></a></div><p id="b488" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，您需要配置cert-manager来请求让我们加密免费证书。</p><div class="mh mi gp gr mj mk"><a href="https://jmrobles.medium.com/free-ssl-certificate-for-your-kubernetes-cluster-with-rancher-2cf6559adeba" rel="noopener follow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd iu gy z fp mp fr fs mq fu fw is bi translated">您的Kubernetes集群与Rancher的免费SSL证书</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">由于Let's encrypt，我们可以为我们的HTTPS或TLS服务创建SSL证书..免费！</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">jmrobles.medium.com</p></div></div><div class="mt l"><div class="na l mv mw mx mt my ky mk"/></div></div></a></div><h1 id="d242" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">管道</h1><p id="1eca" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">Rancher管道是通过文件配置的。rancher-pipelines.yaml”。这个文件放在GIT存储库的根目录下。</p><p id="be5c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是一个YAML文件，您可以在其中指定步骤/阶段及其操作。它非常类似于其他供应商的格式，如Bitbucket、GitHub或Jenkins CI/CD。</p><p id="2d57" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的渠道如下。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="5a19" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们定义了3个步骤:</p><ol class=""><li id="c0b5" class="nd ne it js b jt ju jx jy kb nf kf ng kj nh kn ni nj nk nl bi translated"><strong class="js iu">容器构建和推入注册表</strong>:我们使用“Dockerfile”构建容器映像，标记并将其推入外部docker注册表。</li><li id="c778" class="nd ne it js b jt nm jx nn kb no kf np kj nq kn ni nj nk nl bi translated"><strong class="js iu">部署</strong>:管道应用K8S部署和服务YAML清单。</li><li id="db9a" class="nd ne it js b jt nm jx nn kb no kf np kj nq kn ni nj nk nl bi translated">最后，你只需要应用入口清单。</li></ol><p id="5125" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们看看货单和文件。</p><h1 id="5d21" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">Dockerfile和Kubernetes清单</h1><p id="2020" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">Dockerfile文件非常简单。我们只是使用一个稳定的nginx基础映像，并将我们的内容复制到默认的nginx服务路径中。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="2148" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里是<code class="fe nr ns nt nu b">deployment.yaml</code></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="31d8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这非常简单。首先，我们定义一个使用外部docker注册中心的部署。该容器在80端口监听。我们定义了资源限制(最终它只是静态内容)。</p><p id="ba16" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最引人注目的是<code class="fe nr ns nt nu b">${CICD_EXECUTION_SEQUENCE}</code>的使用。它是一个由管道序列号替代的牧场主管道特定变量。</p><p id="76c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">还有那个<code class="fe nr ns nt nu b">ingress.yaml</code></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="23e2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">也很简单。唯一特别的是注解<code class="fe nr ns nt nu b">cert-manager.io/cluster-issuer</code>。这向“cert-manager”操作者表明，我们需要一个免费的SSL，让我们使用集群发行者“letencrypt-prod”来加密证书。</p><h1 id="aafd" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">启用管道</h1><p id="484c" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">在没有启用管道的情况下，一切准备就绪。</p><p id="7bde" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们进入我们的Rancher Admin UI，选择项目并转到“<strong class="js iu"> Resources →Pipelines </strong>”。我们点击“<strong class="js iu">配置存储库</strong>”。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nv"><img src="../Images/b274f390428d116b469f6c2030269d7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4byUjlCVnjdA7MBvukE3SA.png"/></div></div></figure><p id="f962" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在点击“<strong class="js iu">授权&amp;获取您的存储库</strong>”链接。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nw"><img src="../Images/8e1260d16ef4b08c08d85aa94aa2e1cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NtfipHqe-SoQds7r1Eycng.png"/></div></div></figure><p id="cf22" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此时，您需要将您最喜欢的Git提供者与您的集群链接起来。</p><p id="9a98" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如今Rancher只支持GitLab、Bitbucket和GitHub。</p><p id="35af" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">按照<a class="ae nx" href="https://rancher.com/docs/rancher/v2.x/en/pipelines/#1-configure-version-control-providers" rel="noopener ugc nofollow" target="_blank">的说明链接您的Git提供者</a>。</p><p id="576f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">链接建立之后，您需要启用存储库。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ny"><img src="../Images/3ffa206f1f7296a60708975562006b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zr0otAR9K3pps1N3UYAj-Q.png"/></div></div></figure><p id="8e1f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">点击进入<strong class="js iu">完成</strong>。我们准备好运行管道了！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nz"><img src="../Images/7db0566fe3a699f691dced058007e958.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qcrPn_Jumn4Kbedw_aKsFg.png"/></div></div></figure><h1 id="1a0e" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">跑管道！</h1><p id="8b81" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">你准备好第一次执行管道了吗？</p><p id="4451" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">只要输入“神奇的单词”</p><pre class="kp kq kr ks gt oa nu ob oc aw od bi"><span id="d9bf" class="oe lf it nu b gy of og l oh oi">% git push</span></pre><p id="681a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的管道开始了</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oj"><img src="../Images/cf833dcf4a2fccd088b685d444da4c82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*KXxDRqWuoqDNxIAcv2YYug.gif"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">魔法开始了</figcaption></figure><p id="b853" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果管道执行成功，您的静态内容现在可以在Internet上访问了。</p><h1 id="98a8" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="c3fe" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">我知道在互联网上发布静态内容有很多选择。但我喜欢这样，因为一旦定义了管道，将新的更新应用到网站或静态内容中非常简单。也没有供应商锁定。</p><p id="7d04" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您想了解更多关于#devops、#kubernetes或#go的内容，请关注我。</p></div></div>    
</body>
</html>