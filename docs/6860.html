<html>
<head>
<title>AWS Serverless Pattern: ECS Fargate Cluster Secure Access via VPC Link</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS无服务器模式:通过VPC链接的ECS Fargate集群安全访问</h1>
<blockquote>原文：<a href="https://itnext.io/aws-serverless-pattern-ecs-fargate-cluster-secure-access-via-vpc-link-1d6c98a83ff?source=collection_archive---------2-----------------------#2022-03-25">https://itnext.io/aws-serverless-pattern-ecs-fargate-cluster-secure-access-via-vpc-link-1d6c98a83ff?source=collection_archive---------2-----------------------#2022-03-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="3231" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">AWS无服务器</h2><div class=""/><div class=""><h2 id="d953" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">通过VPC链接到私有HTTP端点的API网关</h2></div></div><div class="ab cl kr ks hx kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="im in io ip iq"><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/fd89510501a912164db135ec7a4d5e42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mO9tWKQVeaj_QeEAYfNyCA.jpeg"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk translated">照片由<a class="ae lo" href="https://unsplash.com/@dtopkin1?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">戴恩·托普金</a>在<a class="ae lo" href="https://unsplash.com/s/photos/security?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="11d1" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">在这篇博文中，我们将研究一种AWS无服务器模式，如何向公共用户公开私有HTTP端点，而不将内部资源公开给公共子网。</p><p id="c504" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">在我们深入讨论实现细节之前，我建议花点时间了解以下服务、功能和资源的基础知识，以防您还不熟悉。</p><ul class=""><li id="7f10" class="ml mm it lr b ls lt lv lw ly mn mc mo mg mp mk mq mr ms mt bi translated"><a class="ae lo" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/welcome.html" rel="noopener ugc nofollow" target="_blank">亚马逊API网关</a></li><li id="58c9" class="ml mm it lr b ls mu lv mv ly mw mc mx mg my mk mq mr ms mt bi translated"><a class="ae lo" href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/AWS_Fargate.html" rel="noopener ugc nofollow" target="_blank">Fargate上的亚马逊ECS</a></li><li id="b6a2" class="ml mm it lr b ls mu lv mv ly mw mc mx mg my mk mq mr ms mt bi translated"><a class="ae lo" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-vpc-links.html" rel="noopener ugc nofollow" target="_blank"> VPC链接</a></li><li id="dcde" class="ml mm it lr b ls mu lv mv ly mw mc mx mg my mk mq mr ms mt bi translated"><a class="ae lo" href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/application-load-balancer-getting-started.html" rel="noopener ugc nofollow" target="_blank">应用负载平衡器</a></li></ul></div><div class="ab cl kr ks hx kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="im in io ip iq"><h2 id="b56c" class="mz na it bd nb nc nd dn ne nf ng dp nh ly ni nj nk mc nl nm nn mg no np nq iz bi translated"><strong class="ak">该模式是如何工作的？</strong></h2><p id="ed38" class="pw-post-body-paragraph lp lq it lr b ls nr kd lu lv ns kg lx ly nt ma mb mc nu me mf mg nv mi mj mk im bi translated">该模式允许将公共API网关端点集成到私有HTTP端点。在这种情况下，私有端点是应用负载平衡器(ALB ),其背后是ECS Fargate集群。公共API端点和私有ALB之间的API网关集成是使用VPC链接实现的。它允许在不暴露私有子网资源的情况下构建安全模式，并且只能通过VPC链接进行访问。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/8ca2f727ec70c711878bda4911d8d203.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/0*dntVgf4-nwS4IBR4.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk translated">API网关和私有HTTP端点集成</figcaption></figure></div><div class="ab cl kr ks hx kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="im in io ip iq"><h2 id="fe8f" class="mz na it bd nb nc nd dn ne nf ng dp nh ly ni nj nk mc nl nm nn mg no np nq iz bi translated">实施细节</h2><p id="9d8d" class="pw-post-body-paragraph lp lq it lr b ls nr kd lu lv ns kg lx ly nt ma mb mc nu me mf mg nv mi mj mk im bi translated">去年，我已经提交了这个模式和一个使用AWS <a class="ae lo" href="https://aws.amazon.com/serverless/sam/" rel="noopener ugc nofollow" target="_blank"> SAM(无服务器应用程序模型)</a>到<a class="ae lo" href="https://serverlessland.com/" rel="noopener ugc nofollow" target="_blank"> ServerlessLand </a>的示例参考项目。</p><p id="04e1" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">您可以参考下面的示例项目，了解使用AWS <a class="ae lo" href="https://aws.amazon.com/serverless/sam/" rel="noopener ugc nofollow" target="_blank"> SAM(无服务器应用程序模型)</a>和<a class="ae lo" href="https://www.terraform.io/" rel="noopener ugc nofollow" target="_blank"> Terraform </a>的参考实现。</p><ul class=""><li id="c941" class="ml mm it lr b ls lt lv lw ly mn mc mo mg mp mk mq mr ms mt bi translated"><a class="ae lo" href="https://serverlessland.com/patterns/apigw-vpclink-pvt-alb" rel="noopener ugc nofollow" target="_blank">山姆参考</a>。</li><li id="3b3b" class="ml mm it lr b ls mu lv mv ly mw mc mx mg my mk mq mr ms mt bi translated"><a class="ae lo" href="https://serverlessland.com/patterns/apigw-vpclink-pvt-alb-terraform" rel="noopener ugc nofollow" target="_blank">地形参考</a>。</li></ul><p id="603d" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">这些项目提供以下资源。假设VPC和子网已经配置了所需的网络路由。此外，VPC和子网id作为输入提供。</p><ul class=""><li id="555c" class="ml mm it lr b ls lt lv lw ly mn mc mo mg mp mk mq mr ms mt bi translated">必需的安全组。</li><li id="5700" class="ml mm it lr b ls mu lv mv ly mw mc mx mg my mk mq mr ms mt bi translated">具有服务和任务定义的ECS Fargate集群。</li><li id="7fd4" class="ml mm it lr b ls mu lv mv ly mw mc mx mg my mk mq mr ms mt bi translated">具有适当监听器和目标组的专用应用程序负载平衡器。</li><li id="b92e" class="ml mm it lr b ls mu lv mv ly mw mc mx mg my mk mq mr ms mt bi translated">VPC林克。</li><li id="2542" class="ml mm it lr b ls mu lv mv ly mw mc mx mg my mk mq mr ms mt bi translated">API端点和私有ALB之间通过VPC链接的API网关集成。</li></ul><p id="a285" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">有关如何部署资源并进行测试的详细说明，请参考以下链接。</p><ul class=""><li id="0668" class="ml mm it lr b ls lt lv lw ly mn mc mo mg mp mk mq mr ms mt bi translated"><a class="ae lo" href="https://github.com/aws-samples/serverless-patterns/tree/main/apigw-vpclink-pvt-alb-terraform" rel="noopener ugc nofollow" target="_blank">https://github . com/AWS-samples/server less-patterns/tree/main/API GW-VP clink-PVT-ALB-terra form</a></li><li id="30a3" class="ml mm it lr b ls mu lv mv ly mw mc mx mg my mk mq mr ms mt bi translated"><a class="ae lo" href="https://github.com/aws-samples/serverless-patterns/tree/main/apigw-vpclink-pvt-alb" rel="noopener ugc nofollow" target="_blank">https://github . com/AWS-samples/server less-patterns/tree/main/API GW-VP clink-PVT-ALB</a></li></ul><p id="9359" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">此外，完成后，通过删除创建的资源来节省成本！</p></div><div class="ab cl kr ks hx kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="im in io ip iq"><h2 id="b9bf" class="mz na it bd nb nc nd dn ne nf ng dp nh ly ni nj nk mc nl nm nn mg no np nq iz bi translated">LocalStack —您的本地AWS云</h2><p id="a7d5" class="pw-post-body-paragraph lp lq it lr b ls nr kd lu lv ns kg lx ly nt ma mb mc nu me mf mg nv mi mj mk im bi translated">那么，为什么我在这里提到了<a class="ae lo" href="https://localstack.cloud/" rel="noopener ugc nofollow" target="_blank"> LocalStack </a>？</p><p id="c548" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">我将它用于Terraform示例项目的初始配置和测试。我们需要这个项目的LocalStack Pro版本，因为它使用了社区版本中不可用的某些服务。</p><p id="8dc8" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">LocalStack允许您在本地模拟AWS云环境，而无需在AWS上提供任何东西。</p><p id="ec2c" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">社区版有很多服务，都是免费的！“专业”版会花你一些钱，但如果你经常使用AWS服务进行开发，并且使用社区版中没有的服务，这可能还是值得的。</p><p id="c69a" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">如果您想运行Terraform项目，请遵循以下步骤。</p><ul class=""><li id="8520" class="ml mm it lr b ls lt lv lw ly mn mc mo mg mp mk mq mr ms mt bi translated"><a class="ae lo" href="https://learn.hashicorp.com/tutorials/terraform/install-cli" rel="noopener ugc nofollow" target="_blank">安装地形</a>。</li><li id="c0a6" class="ml mm it lr b ls mu lv mv ly mw mc mx mg my mk mq mr ms mt bi translated"><a class="ae lo" href="https://docs.localstack.cloud/get-started/#get-localstack-up-and-running" rel="noopener ugc nofollow" target="_blank">安装并配置本地堆栈</a>。[选择最适合您的安装选项。]</li></ul><p id="e125" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">将“aws”提供程序配置为使用假凭据和自定义URL，指向本地运行的LocalStack环境。下面的文件与<a class="ae lo" href="https://github.com/aws-samples/serverless-patterns/blob/main/apigw-vpclink-pvt-alb-terraform/main.tf" rel="noopener ugc nofollow" target="_blank">https://github . com/AWS-samples/server less-patterns/blob/main/API GW-VP clink-PVT-ALB-terraform/main . TF</a>中的几乎相同，除了第14行中的提供者配置。我使用下面的配置来包含多个服务作为参考，但是您可以只配置您需要的服务。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="7071" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">去吧，试一试。</p><p id="9364" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">快乐大厦！</p><p id="7bad" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated"><strong class="lr jd"> <em class="nz">注意:</em> </strong> <em class="nz">安全组规则和一些与该示例项目中创建的资源相关的配置可能不是生产级的，仅用于参考目的。</em></p></div><div class="ab cl kr ks hx kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="im in io ip iq"><h2 id="39d4" class="mz na it bd nb nc nd dn ne nf ng dp nh ly ni nj nk mc nl nm nn mg no np nq iz bi translated">参考</h2><p id="dfb8" class="pw-post-body-paragraph lp lq it lr b ls nr kd lu lv ns kg lx ly nt ma mb mc nu me mf mg nv mi mj mk im bi translated">进一步阅读了解更多关于这些类型的无服务器集成模式:</p><ul class=""><li id="9244" class="ml mm it lr b ls lt lv lw ly mn mc mo mg mp mk mq mr ms mt bi translated"><a class="ae lo" href="https://serverlessland.com/" rel="noopener ugc nofollow" target="_blank">https://serverlessland.com/</a></li><li id="783c" class="ml mm it lr b ls mu lv mv ly mw mc mx mg my mk mq mr ms mt bi translated"><a class="ae lo" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-develop-integrations-private.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/API gateway/latest/developer guide/http-API-develop-integrations-private . html</a></li><li id="5f0d" class="ml mm it lr b ls mu lv mv ly mw mc mx mg my mk mq mr ms mt bi translated"><a class="ae lo" href="https://aws.amazon.com/blogs/compute/configuring-private-integrations-with-amazon-api-gateway-http-apis/" rel="noopener ugc nofollow" target="_blank">https://AWS . Amazon . com/blogs/compute/configuring-private-integrations-with-Amazon-API-gateway-http-APIs/</a></li><li id="d2c5" class="ml mm it lr b ls mu lv mv ly mw mc mx mg my mk mq mr ms mt bi translated"><a class="ae lo" href="https://localstack.cloud/" rel="noopener ugc nofollow" target="_blank">https://localstack.cloud/</a></li></ul></div><div class="ab cl kr ks hx kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="im in io ip iq"><p id="4172" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated"><em class="nz">本帖原载于</em><a class="ae lo" href="https://dev.to/aws-builders/aws-serverless-pattern-ecs-fargate-cluster-secure-access-via-vpc-link-ml7" rel="noopener ugc nofollow" target="_blank"><em class="nz">dev . to</em></a><em class="nz">。</em></p><p id="01ea" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated"><em class="nz">关注我上</em><a class="ae lo" href="https://www.linkedin.com/in/bideep/" rel="noopener ugc nofollow" target="_blank"><em class="nz">LinkedIn</em></a><em class="nz">，</em><a class="ae lo" href="https://twitter.com/bbideep" rel="noopener ugc nofollow" target="_blank"><em class="nz">Twitter</em></a><em class="nz">。</em></p><p id="ed99" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated"><a class="ae lo" href="https://bbideep.medium.com/subscribe" rel="noopener"> <em class="nz">在</em> </a> <em class="nz">上订阅更多此类帖子。</em></p></div></div>    
</body>
</html>