<html>
<head>
<title>Uncaught Exception Secrets, Zones</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">未捕获的异常机密，区域</h1>
<blockquote>原文：<a href="https://itnext.io/uncaught-exception-secrets-zones-c9759fa7a60e?source=collection_archive---------1-----------------------#2021-07-09">https://itnext.io/uncaught-exception-secrets-zones-c9759fa7a60e?source=collection_archive---------1-----------------------#2021-07-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/c7a7efd80219999ad91bb4b2eac006ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aOSq0seyg9dRHSYS18uA2A.jpeg"/></div></div></figure><p id="d1c2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们如何处理行为良好的扩展的未被捕获的异常？在这个过程中，我们发现一个未被捕获的异常，然后修改代码来解释它；在这个过程中，区域可以发挥作用。</p><h1 id="2e39" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak">隔离区和隔离区，天啊</strong></h1><p id="f627" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">【Dart不是单线程的。事实是一个线程处于孤立状态。例如，主函数从一个单独的Zone.root开始:</p><p id="0a6e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">那么，当我们在main的子区域中创建另一个区域时会发生什么呢？是的，我们有一个单独的隔离，这意味着如果我们有一个未捕获的异常，它不会关闭应用程序的主要功能，因为它在一个单独的隔离中。</p><p id="840b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要点是，如果我们设置了正确的区域，那么我们就能够通过运行应用程序来调试我们的应用程序，以查看IDE控制台日志中显示的未捕获异常，然后重新编写一些代码来处理这种情况，并再次运行应用程序，查看异常是否消失。</p><h1 id="141f" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak">使用区域</strong></h1><p id="5946" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated"><strong class="kd iu">首先，我们建立了一个错误处理器来捕捉颤振异常:</strong></p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="4960" class="ml la it mh b gy mm mn l mo mp"><strong class="mh iu">FlutterError.onError = (FlutterErrorDetails details) async {</strong></span><span id="05c9" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">if (isInDebugMode) {</strong></span><span id="c878" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu"><em class="mr">// In development mode simply print to console.</em></strong></span><span id="ea79" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">FlutterError.dumpErrorToConsole(details);</strong></span><span id="9b7d" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">} else {</strong></span><span id="2f2d" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu"><em class="mr">// In production mode report to the application zone to report to</em></strong></span><span id="5b41" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu"><em class="mr">// app exceptions provider. We do not need this in Profile mode.</em></strong></span><span id="b21f" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu"><em class="mr">// ignore: no-empty-block</em></strong></span><span id="22de" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">if (isInReleaseMode) {</strong></span><span id="455c" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu"><em class="mr">// FlutterError class has something not changed as far as null safety</em></strong></span><span id="2ee1" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu"><em class="mr">// so I just assume we do not have a stack trace but still want the</em></strong></span><span id="57fd" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu"><em class="mr">// detail of the exception.</em></strong></span><span id="0ede" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu"><em class="mr">// ignore: cast_nullable_to_non_nullable</em></strong></span><span id="3484" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">Zone.current.handleUncaughtError(</strong></span><span id="ca09" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu"><em class="mr">// ignore: cast_nullable_to_non_nullable</em></strong></span><span id="e8dc" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">details.exception,</strong></span><span id="2be0" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu"><em class="mr">// ignore: cast_nullable_to_non_nullable</em></strong></span><span id="542a" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">details.stack as StackTrace,</strong></span><span id="03ff" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">);</strong></span><span id="9f40" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">}</strong></span><span id="ab19" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">}</strong></span><span id="4e0a" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">};</strong></span></pre><p id="232e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">我们调用了一个Zone.current，以便将错误传递给Zone未捕获的处理程序，因为所有的Flutter框架错误都将是未捕获的异常。</strong></p><p id="b4f5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，记住main是在它自己的Zone.root隔离区中，所以我们需要为runApp调用设置一个内部区域:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="8300" class="ml la it mh b gy mm mn l mo mp"><strong class="mh iu">runZonedGuarded&lt;Future&lt;Null&gt;&gt;(</strong></span><span id="c3f3" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">() async {</strong></span><span id="a1a5" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu"><em class="mr">//Since we start another zone we need to</em></strong></span><span id="a5d5" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu"><em class="mr">//ensure that SkyEngine has fully loaded Flutter</em></strong></span><span id="ab5a" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu"><em class="mr">// and it needs to be called here to enable grabbing the errors</em></strong></span><span id="2936" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">WidgetsFlutterBinding.ensureInitialized();</strong></span><span id="765e" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu"><em class="mr">// Service and other initializations here</em></strong></span><span id="b431" class="ml la it mh b gy mq mn l mo mp">myLogger.info('app initialized');</span><span id="3f3d" class="ml la it mh b gy mq mn l mo mp">runApp(<em class="mr">const</em> MyApp());</span><span id="d289" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">},</strong></span><span id="4d5f" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu"><em class="mr">// ignore: no-empty-block</em></strong></span><span id="927a" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">(Object error, StackTrace stack) {</strong></span><span id="ae71" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">log('$error.runtimeType $stack');</strong></span><span id="56e9" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">},</strong></span><span id="2056" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">zoneSpecification: ZoneSpecification(</strong></span><span id="80ad" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">// Intercept all print calls</strong></span><span id="74b9" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">print: (self, parent, zone, line) async {</strong></span><span id="8157" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">// Include a timestamp and the name of the App</strong></span><span id="bfd8" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">final messageToLog = "[${DateTime.now()}] $myAppTitle $line $zone";</strong></span><span id="9677" class="ml la it mh b gy mq mn l mo mp">// Also print the message in the "Debug Console"</span><span id="db42" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">// but it's ony an info message and contains no</strong></span><span id="a5a0" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">// privacy prohibited stuff</strong></span><span id="a8eb" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">parent.print(zone, messageToLog);</strong></span><span id="4b5f" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">},</strong></span><span id="ac67" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">),</strong></span><span id="5852" class="ml la it mh b gy mq mn l mo mp"><strong class="mh iu">);</strong></span></pre><p id="7916" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">我们使用ZoneSpecification来重新定义控制台转储(它是print)以格式化控制台输出。这是完整的代码:</strong></p><figure class="mc md me mf gt ju"><div class="bz fp l di"><div class="ms mt l"/></div></figure><h1 id="3523" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak">结论</strong></h1><p id="d8c8" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">这只是你必须为你创建的每个应用程序完成的样板文件的一部分。在另一篇文章中，我将向您展示如何将它与Catcher插件结合起来，以便我们可以向应用程序用户显示一个定制的错误小部件，并将应用程序异常报告传递给第三方服务。</p><h1 id="61ca" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak">关于我，弗雷德·格罗特</strong></h1><p id="3705" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我是一名改过自新的Android、Java、Kotlin和前端开发人员。我是一个改过自新的多动症患者，编码和设计牛仔。不仅如此，我还通过中等文章写作有机地创建了我的Flutter Developer Book章节，在:</p><p id="4224" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">https://fredgrott.medium.com</p><p id="a854" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">该书系列的代码是在一个原始的操场上工作的:</p><div class="mu mv gp gr mw mx"><a href="https://github.com/fredgrott/flutter_design_and_arch_rosetta" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">Fred grott/flutter _ design _ and _ arch _ Rosetta</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">我正在创建一个颤振开发和设计系列图书，这是它的巨大回购。</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">github.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl jz mx"/></div></div></a></div><p id="134e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">更正式的“即将出版”代码位于:</p><div class="mu mv gp gr mw mx"><a href="https://github.com/fredgrott/ddi_flutter" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">fredgrott/ddi_flutter</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">这是我更正式的版本，是一个关于Flutter演示的Rosetta Stone，鼓励你深入研究flutter…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">github.com</p></div></div><div class="ng l"><div class="nm l ni nj nk ng nl jz mx"/></div></div></a></div><p id="7758" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我的GitHub档案在</p><div class="mu mv gp gr mw mx"><a href="https://github.com/fredgrott" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">fredgrott -概述</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">我是创业前端开发设计师。我正在构建一些flutter应用程序和编写一些flutter应用程序开发人员…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">github.com</p></div></div><div class="ng l"><div class="nn l ni nj nk ng nl jz mx"/></div></div></a></div><p id="366e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我可以在:</p><div class="mu mv gp gr mw mx"><a href="https://keybase.io/fredgrott" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">弗雷德·格罗特(弗雷德·格罗特)</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">Keybase是什么鬼东西？Keybase为您提供了管理身份、创建安全聊天和…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">keybase.io</p></div></div><div class="ng l"><div class="no l ni nj nk ng nl jz mx"/></div></div></a></div></div></div>    
</body>
</html>