<html>
<head>
<title>Getting started with Hapi JS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">哈比神JS入门</h1>
<blockquote>原文：<a href="https://itnext.io/getting-started-with-hapi-js-e841724da924?source=collection_archive---------1-----------------------#2019-02-17">https://itnext.io/getting-started-with-hapi-js-e841724da924?source=collection_archive---------1-----------------------#2019-02-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4e61" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">第1部分:启动服务器和基本路由</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8910495eb4137d1ee442ae96fee0bf94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GIKkOpHNbHA1BiP4wwvdWw.jpeg"/></div></div></figure><p id="d32b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我知道似乎Node的唯一框架是<a class="ae ln" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express </a>，但是我认为让新程序员尝试一下<a class="ae ln" href="https://hapijs.com/" rel="noopener ugc nofollow" target="_blank"> hapi </a>是值得的。哈比神非常轻量级，围绕一个插件系统构建，保持一切模块化。另外，它的<a class="ae ln" href="https://hapijs.com/api" rel="noopener ugc nofollow" target="_blank">文档很棒</a> <em class="lo"> </em>，而且它们有<em class="lo"> </em>一个不错的小<a class="ae ln" href="https://hapijs.com/tutorials" rel="noopener ugc nofollow" target="_blank">教程部分</a>。在这个系列中，我们将回顾基础知识，从启动服务器和添加一些路由开始。</p><blockquote class="lp lq lr"><p id="f70a" class="kr ks lo kt b ku kv jr kw kx ky ju kz ls lb lc ld lt lf lg lh lu lj lk ll lm ij bi translated">这里有一个GitHub可以看到完成的项目</p></blockquote><h2 id="35c2" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated">哈比神16对17</h2><p id="fd5e" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">关于你应该使用哪个版本的快速提示。从16到17，框架发生了变化，从使用回调到异步/等待。本教程，以及大部分专业世界，将使用hapi 17及以上。如果你正在处理需要更新的旧代码，我强烈推荐使用<a class="ae ln" href="https://futurestud.io/tutorials/hapi-v17-upgrade-guide-your-move-to-async-await" rel="noopener ugc nofollow" target="_blank">这篇hapi转换文章</a>作为指南。那也是一个很棒的网站，我喜欢浏览他们的教程。</p><h1 id="101d" class="mt lw iq bd lx mu mv mw ma mx my mz md jw na jx mg jz nb ka mj kc nc kd mm nd bi translated">入门:安装</h1><p id="6318" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">跑步，你就可以出发了。您还应该全局安装<a class="ae ln" href="https://nodemon.io/" rel="noopener ugc nofollow" target="_blank"> nodemon </a>。这将负责在文件更改时重启服务器。或者，你可以克隆我的<a class="ae ln" href="https://github.com/MostlyFocusedMike/hapi-notes-1" rel="noopener ugc nofollow" target="_blank"> GitHub </a>，它使用<a class="ae ln" href="https://medium.com/@maybekatz/introducing-npx-an-npm-package-runner-55f7d4bd282b" rel="noopener"> npx </a>的魔力来运行一个本地安装的nodemon。</p><h1 id="84e2" class="mt lw iq bd lx mu mv mw ma mx my mz md jw na jx mg jz nb ka mj kc nc kd mm nd bi translated">使用server.js文件启动和运行</h1><p id="a5d4" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">到目前为止，我们的<code class="fe ne nf ng nh b">server.js</code>文件是这样的:</p><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="ada8" class="lv lw iq nh b gy nm nn l no np">const Hapi = require(‘hapi’); </span><span id="c4f2" class="lv lw iq nh b gy nq nn l no np">const server = new Hapi.Server({ <br/>    host: ‘localhost’, <br/>    port: 3101, <br/>}); </span><span id="eb50" class="lv lw iq nh b gy nq nn l no np">const launch = async () =&gt; {<br/>    try { <br/>        await server.start(); <br/>    } catch (err) { <br/>        console.error(err); <br/>        process.exit(1); <br/>    }; <br/>    console.log(`Server running at ${server.info.uri}`); <br/>}</span><span id="1f9c" class="lv lw iq nh b gy nq nn l no np">launch();</span></pre><p id="4e86" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你运行<code class="fe ne nf ng nh b">npm start</code>并转到<a class="ae ln" href="http://localhost:3101/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3101/ </a>，你会看到我们的服务器<em class="lo">已经启动并正在运行</em>，你只是得到一个404，因为我们还没有做一个路由处理器。但在此之前，我们先来谈谈这两个主要部分:</p><h2 id="6dd8" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated">服务器方法及其配置对象</h2><p id="d1e8" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">如您所见，我们通过调用hapi的<code class="fe ne nf ng nh b"><a class="ae ln" href="https://hapijs.com/api#server" rel="noopener ugc nofollow" target="_blank">Server method</a></code>来创建我们的服务器。它接受一个<a class="ae ln" href="https://hapijs.com/api#server.options" rel="noopener ugc nofollow" target="_blank">配置对象</a>并返回一个我们可以使用的<code class="fe ne nf ng nh b">server</code>对象。这么多东西<em class="lo">可以</em>放入config对象，但是现在你需要的是一个主机和端口，一个字符串和一个整数。此外，如果你只是闲逛，<code class="fe ne nf ng nh b">‘localhost’</code>很好，但是如果你使用Docker，把<a class="ae ln" href="https://stackoverflow.com/questions/47025647/localhost-vs-0-0-0-0-with-docker-on-mac-os" rel="noopener ugc nofollow" target="_blank">设置为<code class="fe ne nf ng nh b">‘0.0.0.0’</code>会让你自己更加烦恼。</a></p><h2 id="b624" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated">“发射”方法</h2><p id="32fe" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">哈比神在名为<code class="fe ne nf ng nh b">start()</code>的服务器上有一个内置的异步方法，你会认为这就是你所需要的。但是很快，我们将在服务器真正启动之前对它做很多事情，把它们都放在一个地方会很有帮助。这就是为什么创建自己的函数很常见。我喜欢把我的命名为“发射”，但你可以叫它什么。它还将通过将错误打印到控制台并退出节点进程来处理任何错误。</p><p id="9b9a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我们定义了函数之后，我们在文件的末尾调用它，这最终启动了我们的服务器。现在，让我们添加一些路线！</p><h1 id="b0a6" class="mt lw iq bd lx mu mv mw ma mx my mz md jw na jx mg jz nb ka mj kc nc kd mm nd bi translated">添加基本路线</h1><p id="49d9" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">您通过使用服务器对象的<code class="fe ne nf ng nh b"><a class="ae ln" href="https://hapijs.com/api#-serverrouteroute" rel="noopener ugc nofollow" target="_blank">route()</a></code> <a class="ae ln" href="https://hapijs.com/api#-serverrouteroute" rel="noopener ugc nofollow" target="_blank">方法</a>来添加路由。该方法采用配置对象或对象数组。下面是最基本的路线:</p><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="3d26" class="lv lw iq nh b gy nm nn l no np">server.route({   <br/>    method: 'GET',   <br/>    path: '/',   <br/>    handler: (request, h) =&gt; {     <br/>        return 'I am the home route'   <br/>    } <br/>});</span></pre><p id="f0a2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，如果你进入<a class="ae ln" href="http://localhost:3101/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3101/ </a>，屏幕上会显示一个字符串，而不是404。进步！至于配置对象，我们现在给它最少三个属性:<code class="fe ne nf ng nh b">method</code>、<code class="fe ne nf ng nh b">path</code>和<code class="fe ne nf ng nh b">handler</code>。</p><h2 id="0ebe" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated">方法</h2><p id="1ea2" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">这是触发路由的http动词，它可以是一个字符串或字符串数组(更常见的是字符串)。大小写无所谓，但是我个人觉得全大写看起来比较整洁。</p><h2 id="8f17" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated">小路</h2><p id="2790" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">这是您将放入浏览器的实际路由字符串路径，您将在此指定您的<a class="ae ln" href="https://hapijs.com/api#path-parameters" rel="noopener ugc nofollow" target="_blank">参数</a>。</p><h2 id="d9e9" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated">处理函数</h2><p id="0765" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">这是一个决定什么被发送回客户端的函数。它既可以访问初始的<code class="fe ne nf ng nh b"><a class="ae ln" href="https://hapijs.com/api#request" rel="noopener ugc nofollow" target="_blank">request</a></code> <a class="ae ln" href="https://hapijs.com/api#request" rel="noopener ugc nofollow" target="_blank">对象</a>，也可以访问名为<code class="fe ne nf ng nh b"><a class="ae ln" href="https://hapijs.com/api#response-toolkit" rel="noopener ugc nofollow" target="_blank">h response toolkit</a></code>的对象。它们非常适合更复杂的响应，但是只需要发送一个简单的<code class="fe ne nf ng nh b">return</code>就可以了。json或者strings。</p><h1 id="f8b6" class="mt lw iq bd lx mu mv mw ma mx my mz md jw na jx mg jz nb ka mj kc nc kd mm nd bi translated">在上下文中向服务器添加路由</h1><p id="21dc" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">所有这些加在一起，这就是你最终的<code class="fe ne nf ng nh b">server.js</code>文件的样子:</p><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="29c4" class="lv lw iq nh b gy nm nn l no np">const Hapi = require('hapi');</span><span id="7986" class="lv lw iq nh b gy nq nn l no np">// create a server with a host and port<br/>const server = new Hapi.Server({<br/>    host: 'localhost',<br/>    port: 3101<br/>});</span><span id="cb72" class="lv lw iq nh b gy nq nn l no np">// add each route<br/>server.route([<br/>    {<br/>        method: 'GET',<br/>        path: '/',<br/>        handler: (request, h) =&gt; {<br/>            return 'I am the home route';<br/>        },<br/>    },<br/>    {<br/>        method: 'GET',<br/>        path: '/example',<br/>        handler: (request, h) =&gt; {<br/>            return { msg: 'I am json' };<br/>        },<br/>    }<br/>]);</span><span id="5c5d" class="lv lw iq nh b gy nq nn l no np">// define server start function<br/>const launch = async () =&gt; {<br/>    try {<br/>        await server.start(); <br/>    } catch (err) {<br/>        console.error(err);<br/>        process.exit(1);<br/>    };<br/>    console.log(`Server running at ${server.info.uri}`);<br/>}</span><span id="8aca" class="lv lw iq nh b gy nq nn l no np">// start your server<br/>launch();</span></pre><p id="c032" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">恭喜你！你已经用hapi建立了一个微型服务器！我们将在下一期讨论<a class="ae ln" href="https://hapijs.com/api#path-parameters" rel="noopener ugc nofollow" target="_blank">路径参数</a>以及如何使用<a class="ae ln" href="https://hapijs.com/api#response-toolkit" rel="noopener ugc nofollow" target="_blank">响应工具包</a>，但我鼓励您同时查看教程和文档。</p><p id="d2c6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">大家编码快乐，</p><p id="0f9b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">迈克</p></div></div>    
</body>
</html>