<html>
<head>
<title>Create Pull Requests and then Merge Multiple GitHub Repos from the Command Line</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建Pull请求，然后从命令行合并多个GitHub Repos</h1>
<blockquote>原文：<a href="https://itnext.io/create-pull-requests-and-then-merge-multiple-github-repos-from-the-command-line-ceef76c3cf65?source=collection_archive---------6-----------------------#2020-09-02">https://itnext.io/create-pull-requests-and-then-merge-multiple-github-repos-from-the-command-line-ceef76c3cf65?source=collection_archive---------6-----------------------#2020-09-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/072e74bad62ed539771a1517ae995316.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q32hPaYKCOibog-lT1_-sA.png"/></div></div></figure><p id="65a2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我试图解决的问题是:如何为多个GitHub仓库创建PRs，然后通过CLI合并这些仓库——而不使用GitHub UI！</p><p id="dc8e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我决定利用GitHub的<a class="ae kz" href="https://hub.github.com/" rel="noopener ugc nofollow" target="_blank"> Hub </a>，GitHub将其描述为“命令行git的扩展”来创建pull请求，然后使用GitHub的<a class="ae kz" href="https://developer.github.com/v3/pulls/#merge-a-pull-request" rel="noopener ugc nofollow" target="_blank"> API来合并这些pr。</a>我在Mac上工作，所以我用Brew安装了Hub: <code class="fe la lb lc ld b">brew install hub</code></p><p id="6104" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了解决这个问题，我开发了这个Bash脚本来创建Pull请求(注意，小于/大于括号<code class="fe la lb lc ld b">&lt;&gt;</code>中的任何内容都需要修改以匹配您的设置):</p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="ce56" class="lm ln it ld b gy lo lp l lq lr">#!/bin/bash</span><span id="ba2a" class="lm ln it ld b gy ls lp l lq lr">date=$(date +%F-%H)<br/>curdir=$(pwd)<br/>echo '#!/bin/bash' &gt;&gt; merge_all-${date}.sh<br/>echo 'source .env' &gt;&gt; merge_all-${date}.sh<br/>for path in */&lt;path_goes_here&gt;*<br/>do<br/>  [[ ! -d "$path" ]] &amp;&amp; continue<br/>  echo "$path"<br/>  cd "$path"<br/>  pr=$(hub pull-request --base &lt;<!-- -->OWNER&gt;:&lt;base_branch&gt; <!-- -->--head &lt;branch_with_changes&gt; -m "helpful message goes here")<br/>  echo "$pr"<br/>  repo=$(echo "$pr" | awk -F "/" {'print $5'})<br/>  pull_number=$(echo "$pr" | awk -F "/" {'print $7'})<br/>  cd $curdir<br/>  echo "echo \"$repo\"" &gt;&gt; merge_all-${date}.sh<br/>  echo "curl -s -X PUT \<br/>  -H \"Authorization: token \$token\" \<br/> <a class="ae kz" href="https://api.github.concur.com/repos/SM/$repo/pulls/$pull_number/merge" rel="noopener ugc nofollow" target="_blank">https://api.github.com/repos/&lt;OWNER&gt;/$repo/pulls/$pull_number/merge</a>" &gt;&gt; merge_all-${date}.sh<br/>done</span></pre><p id="457b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这个脚本位于包含几个repos的目录的根目录下。它使用<code class="fe la lb lc ld b">$path</code>变量遍历目录，创建PR，然后将PR添加到根目录下生成的新脚本中。生成的脚本将被称为<code class="fe la lb lc ld b">merge_all-&lt;Date_of_Execution&gt;.sh</code>，并将包含几个curl命令，这些命令使用GitHub API来合并PRs。为了给同行评审留出时间，我将拉取请求和合并分离到不同的脚本中。</p><p id="e497" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，GitHub API需要一个授权令牌，您可以按照GitHub的<a class="ae kz" href="https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token" rel="noopener ugc nofollow" target="_blank">文档</a>来设置它。这个令牌需要放在一个<code class="fe la lb lc ld b">.env</code>文件中，该文件也位于根目录下。下面是那个<code class="fe la lb lc ld b">.env </code>文件的样子:</p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="ecac" class="lm ln it ld b gy lo lp l lq lr">token=“&lt;GitHub_Token_Goes_Here&gt;”</span></pre><p id="8b20" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果在运行拉请求创建脚本后一切顺利，您应该有一个类似如下的脚本:</p><figure class="le lf lg lh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lt"><img src="../Images/bf3b4ae6970fd17ed46fa7c9ed23e5ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F0BfCFgxRRqSYVF6MloqKQ.png"/></div></div></figure><p id="5640" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果这对你有所帮助，那么恭喜你省下了在GitHub GUI中手动合并单个回购的时间🙂</p></div></div>    
</body>
</html>