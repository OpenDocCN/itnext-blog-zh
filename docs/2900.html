<html>
<head>
<title>Building Scalable Multi-Platform Projects with Angular and Nx</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Angular和Nx构建可扩展的多平台项目</h1>
<blockquote>原文：<a href="https://itnext.io/building-scalable-multi-platform-projects-with-angular-and-nx-a13b40885e54?source=collection_archive---------2-----------------------#2019-08-25">https://itnext.io/building-scalable-multi-platform-projects-with-angular-and-nx-a13b40885e54?source=collection_archive---------2-----------------------#2019-08-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8089" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">构建可扩展的项目很难。本文将展示Nx如何帮助我们在一个代码库中创建多个角度项目</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/93e177fd3abc03062fe5b80cbb0c926e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*erZf_hQ4V3MLHSyf"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">戴维·拉古萨在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="dd32" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这篇文章是我之前写的关于在Angular 中<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/building-an-enterprise-grade-angular-project-structure-f5be32533ba3?source=---------19------------------">构建企业级项目的想法的后续。</a></p><p id="983e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在前一篇文章中，提到了monorepos和Nx，但我还没有有幸试用它们。很明显，尽管所提到的结构对于针对单一平台的单一项目来说已经足够好了，但是对于与其他项目共享代码来说，它还不够好。</p><h2 id="5f36" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">Monorepos来拯救</h2><p id="ee0c" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在过去的几个月里，我一直在从事多个项目——有些项目非常复杂；我的一个项目要求我<strong class="ky ir">编写一个需要能够在多个平台上运行的应用程序</strong>，这也是为什么我觉得上一篇文章需要更新的原因之一:</p><ul class=""><li id="6451" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">我想为多个设备(移动设备、桌面设备)发布一个项目，尽可能多地共享代码</li><li id="2742" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">我希望我的项目的<em class="ne"> API </em>在同一个工作空间中与客户端应用程序共享模型</li><li id="6ddf" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">我想要<em class="ne"> SSR </em>(服务器端渲染)因为，嗯，现在是2019年</li></ul><h2 id="22bd" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">这篇文章是关于什么的</h2><p id="db14" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">让我们面对现实吧——构建可扩展的项目很难。我相信你在职业生涯中至少有过一次类似的对话:</p><ul class=""><li id="0a9e" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated"><strong class="ky ir">你</strong>:哎，这些功能要放在哪里？越来越乱了🤔</li><li id="1e90" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">同事:哦，创建(另一个)文件夹“utils”并放在那里😐</li><li id="68d6" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">你:好的……🙄</li></ul><p id="5912" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文的第一部分，<strong class="ky ir">我们将讨论Nx如何帮助构建您的应用</strong>，以及我们如何利用它来构建可伸缩性极高的项目。</p><p id="d449" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第二部分中，我们采取了一种更实际的方法:<strong class="ky ir">一个关于设置Angular应用程序的分步指南</strong>，它是使用NestJS在服务器端呈现的，与移动Ionic应用程序共享代码。我花了一些时间才把它弄好，所以我想帮助你(和未来的我)毫不费力地做到这一点。</p><h1 id="e4bb" class="nf lt iq bd lu ng nh ni lx nj nk nl ma jw nm jx md jz nn ka mg kc no kd mj np bi translated">技术堆栈</h1><p id="0a6b" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">为此，我将使用以下技术:</p><ul class=""><li id="9f52" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated"><a class="ae kv" href="https://nx.dev/angular" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> Nx Workspaces </strong> </a>:毫无疑问是管理monorepos与<em class="ne"> Angular </em>项目的最佳工具。Nx增强了CLI，使我们能够在同一个存储库中轻松构建多个应用</li><li id="49d4" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated"><strong class="ky ir"> Ionic/xplat: </strong> Ionic是一个非常棒的移动框架，用于构建跨平台应用。感谢<a class="ae kv" href="https://nstudio.io/xplat" rel="noopener ugc nofollow" target="_blank"> xPlat </a>，我们将能够轻松创建一个与<em class="ne"> Nx </em>集成的Ionic应用</li><li id="315b" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated"><a class="ae kv" href="https://nestjs.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> NestJS </strong> </a>:受<em class="ne"> Angular </em>启发的渐进式<em class="ne"> NodeJS </em>框架</li></ul><h1 id="d80a" class="nf lt iq bd lu ng nh ni lx nj nk nl ma jw nm jx md jz nn ka mg kc no kd mj np bi translated">Nx工作区简介</h1><p id="9fd5" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">你可能想要使用<em class="ne"> Nx </em>有两个原因:</p><ul class=""><li id="4a79" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">您与可以共享代码的多个团队和多个项目一起工作</li><li id="f71c" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">或者说，你和我一样痴迷于代码组织！</li></ul><p id="b1ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">玩笑归玩笑，<em class="ne"> Nx </em>是一个很棒的工具，它帮助<strong class="ky ir">以可伸缩的方式组织代码</strong>；即使你不打算写下一个脸书，Nrwl团队提供的好东西也足以让我用Nx启动我的项目。</p><h2 id="c7e6" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">应用程序</h2><p id="373a" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">Nx是一个创建可扩展单库项目的工具。如果你使用过Angular CLI，<em class="ne"> Nx </em>看起来会很熟悉，但是有一些不同。</p><p id="1a85" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每个应用程序都将在一个名为<code class="fe nq nr ns nt b">/apps</code>的文件夹中创建，包括您的e2e测试项目。例如，你可以创建用<em class="ne"> Angular </em>、<em class="ne"> React </em>、<em class="ne"> Ionic </em>、<em class="ne"> Nativescript </em>、<em class="ne"> Express </em>、<em class="ne"> NestJS </em>等编写的应用程序。</p><p id="e977" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">或者，<strong class="ky ir">一次全部</strong>，共享代码！</p><h2 id="ee20" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">图书馆</h2><p id="41f3" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">相反，您的库将被放置在文件夹<code class="fe nq nr ns nt b">/libs</code>中。</p><p id="71e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，它们到底是什么？当然，比我们工作区内的任何应用程序都能使用的更小的可重用代码片段；但是正如<em class="ne"> Nx </em>也说的那样，<strong class="ky ir">库是具有良好定义的API </strong>的更小的代码单元。</p><p id="4954" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">库是共享<strong class="ky ir">角度实体</strong>和<strong class="ky ir">打字实体的理想选择。</strong>例如:</p><ul class=""><li id="68d0" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">您可能希望在前端和后端之间共享相同的接口。创建一个名为<code class="fe nq nr ns nt b">models</code>的库将允许所有的应用程序访问相同的模型，而不必重写两次</li><li id="2599" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">您的应用程序可能会使用许多组件、管道、指令和服务，它们在您的所有应用程序之间是通用的:测试、移动、前台、后台等。</li></ul><h2 id="04b2" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">Nx工作空间的剖析</h2><p id="1482" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">下面的项目结构是任何Nx项目的起点:</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="098e" class="ls lt iq nt b gy ny nz l oa ob">&lt;workspace name&gt;/<br/>├── apps/<br/>│   ├── myapp/<br/>│   │   ├── src/<br/>│   │   │   ├── app/<br/>│   │   │   ├── assets/<br/>│   │   │   ├── environments/<br/>│   │   │   ├── favicon.ico<br/>│   │   │   ├── index.html<br/>│   │   │   ├── main.ts<br/>│   │   │   ├── polyfills.ts<br/>│   │   │   ├── styles.scss<br/>│   │   │   └── test.ts<br/>│   │   ├── browserslist<br/>│   │   ├── jest.config.js<br/>│   │   ├── tsconfig.app.json<br/>│   │   ├── tsconfig.json<br/>│   │   ├── tsconfig.spec.json<br/>│   │   └── tslint.json<br/>│   └── myapp-e2e/<br/>│       ├── src/<br/>│       │   ├── fixtures/<br/>│       │   │   └── example.json<br/>│       │   ├── integration/<br/>│       │   │   └── app.spec.ts<br/>│       │   ├── plugins/<br/>│       │   │   └── index.ts<br/>│       │   └── support/<br/>│       │       ├── app.po.ts<br/>│       │       ├── commands.ts<br/>│       │       └── index.ts<br/>│       ├── cypress.json<br/>│       ├── tsconfig.e2e.json<br/>│       ├── tsconfig.json<br/>│       └── tslint.json<br/>├── libs/<br/>├── tools/<br/>├── README.md<br/>├── angular.json<br/>├── nx.json<br/>├── package.json<br/>├── tsconfig.json<br/>└── tslint.json</span></pre><h1 id="1e6f" class="nf lt iq bd lu ng nh ni lx nj nk nl ma jw nm jx md jz nn ka mg kc no kd mj np bi translated">使用Nx:创建应用程序</h1><p id="c25a" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">现在我(可能已经)说服你使用<em class="ne"> Nx </em>和<em class="ne"> Angular </em>，我将一步一步地向你展示如何建立我上面描述的梦想技术栈。</p><h2 id="bd13" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">使用角度和嵌套创建新的Nx工作空间</h2><p id="4ecb" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我们将从几个命令开始，由于有了<em class="ne"> Nx </em>，这些命令将启动我们的项目结构，直到我们有一个具有最新Angular版本和<em class="ne">NestJS</em>as<em class="ne">NodeJs</em>框架的monorepo项目。</p><p id="db5f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下命令将使用最新的Angular版本和NestJS作为服务器端节点框架生成一个工作monorepo项目:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/db9c620cdfe5e7f1615023092cc7f0d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uhEP6aleLqbeyXYuptXvWg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">用Nx创建一个新的工作空间</figcaption></figure><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="841d" class="ls lt iq nt b gy ny nz l oa ob">$ new workspace --preset="angular-nest" --appName="nx-angular-ssr" --style="scss" --collection=<a class="ae kv" href="http://twitter.com/nrwl/workspace" rel="noopener ugc nofollow" target="_blank">@nrwl/workspace</a></span></pre><p id="56ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">命令行会提示你喜欢什么风格的预处理器，我推荐选择<em class="ne"> SCSS </em>。静观其变，这需要一段时间。Nx将在名为<code class="fe nq nr ns nt b">workspace</code>的文件夹中创建一个工作区。</p><h1 id="0827" class="nf lt iq bd lu ng nh ni lx nj nk nl ma jw nm jx md jz nn ka mg kc no kd mj np bi translated">API和服务器端渲染</h1><p id="18d6" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">NestJS提供了一个很棒的CLI插件，以便自动为服务器端呈现准备应用程序。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/c663ab40b2f2d50b22c3e19a5e2f8013.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4A3J6f6vjWzOPYGtfijqKQ.png"/></div></div></figure><p id="dcc2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Nx工作区中运行以下命令:</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="7ee1" class="ls lt iq nt b gy ny nz l oa ob">$ ng add @nestjs/ng-universal</span></pre><p id="16cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当命令行提示输入应用程序名称时，输入<code class="fe nq nr ns nt b">nx-angular-ssr</code>。该插件将创建一个名为<code class="fe nq nr ns nt b">server</code>的文件夹，但我们已经有一个服务器应用程序，所以我们将忽略它(这意味着，你可以删除它)。正如所料，我们需要做一些改变。</p><h2 id="ef5d" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">导入Angular的通用模块</h2><p id="925f" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">首先要做的是在我们的Nest应用程序中导入Angular Universal:为此，我们打开文件<code class="fe nq nr ns nt b">apps/api/app/app.module.ts</code>，并将以下代码粘贴到<code class="fe nq nr ns nt b">AppModule</code>类的imports数组中:</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="5c9c" class="ls lt iq nt b gy ny nz l oa ob">AngularUniversalModule.forRoot({<br/>  viewsPath: join(process.cwd(), 'dist/browser'),<br/>  bundle: require('../server/main'),<br/>  liveReload: true<br/>})</span></pre><p id="ea75" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当然，别忘了导入<code class="fe nq nr ns nt b">AngularUniversalModule</code>和<code class="fe nq nr ns nt b">join</code>。</p><h2 id="db22" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">修复环境的道路</h2><p id="e931" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我们需要对<code class="fe nq nr ns nt b">angular.json</code>配置做一点小小的改动。不幸的是，环境文件的路径是不正确的，所以我们根据真实路径打补丁，真实路径是<code class="fe nq nr ns nt b">apps/nx-angular-ssr/src/environments</code>，如下图所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/e484e863a86e1ad684d082e75e9edb29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BJqLeuogbRK5Er5qzy6Tug.png"/></div></div></figure><h2 id="e153" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">调整Webpack的配置</h2><p id="48e5" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我们需要调整的最后一件事是服务器的Webpack配置。打开文件<code class="fe nq nr ns nt b">webpack.server.config</code>并用以下代码片段替换内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="e2d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">至此，一切都结束了！我们只需要构建并运行我们的应用程序。</p><h2 id="b362" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">使用Nest JS运行服务器渲染的Angular应用程序</h2><p id="dfdc" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">NestJS插件添加了一些有用的命令来构建和运行应用程序。我们首先需要运行以下命令来构建SSR应用程序:</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="fb69" class="ls lt iq nt b gy ny nz l oa ob">$ npm run build:ssr</span></pre><p id="06c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们就可以端上来了:</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="ff0d" class="ls lt iq nt b gy ny nz l oa ob">$ npm run serve:ssr</span></pre><p id="4ae4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe nq nr ns nt b">http://localhost:3333</code>打开你的浏览器，这是你的服务器渲染的<em class="ne"> Angular </em>应用，由<em class="ne"> NestJS </em>提供支持！</p><h1 id="aa81" class="nf lt iq bd lu ng nh ni lx nj nk nl ma jw nm jx md jz nn ka mg kc no kd mj np bi translated">使用xPlat添加离子应用程序</h1><p id="abed" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated"><a class="ae kv" href="https://nstudio.io/xplat/getting-started/getting-started" rel="noopener ugc nofollow" target="_blank"> xPlat </a>是一个扩展Nx工作空间的工具，它带有一组生成器，可以帮助用<em class="ne">electronic</em>、<em class="ne"> NativeScript </em>和<em class="ne"> Ionic </em>编写的kickstart项目。在我们的例子中，我们想用它来生成一个用Ionic编写的移动应用程序。</p><h2 id="249d" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">生成离子应用程序</h2><p id="97a6" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">为了使用xPlat生成应用程序，我们需要首先安装它。在您的工作区根目录中运行以下CLI命令:</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="c943" class="ls lt iq nt b gy ny nz l oa ob">ng add @nstudio/xplat</span></pre><p id="1234" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">系统会提示您要使用哪种应用程序:</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="f4d0" class="ls lt iq nt b gy ny nz l oa ob">[] Electron<br/>[] NativeScript<br/>[-] Ionic</span></pre><p id="fdef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的例子中，我们将为角度项目选择Ionic(这将在下一步中被询问)。</p><p id="ea2e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们将使用以下命令生成我们的应用程序:</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="c85f" class="ls lt iq nt b gy ny nz l oa ob">$ ng generate app</span></pre><p id="a4b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">CLI将提示我们进行一些配置。以下是我的选择:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/2e175775940d1ed490710ff15bd5de38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vUwvmpVe47N9wcoIV-ehAA.png"/></div></div></figure><p id="ce83" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当CLI询问应用程序所在的文件夹时，输入一个空格，它将自动放置在<code class="fe nq nr ns nt b">apps</code>内。</p><h2 id="15b3" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">添加电容器</h2><p id="70a7" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated"><em class="ne">电容器</em>是<em class="ne"> Ionic的</em>框架，用于构建跨平台应用。由于某种原因，它没有自动添加，所以我们手动安装它:</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="ae6d" class="ls lt iq nt b gy ny nz l oa ob">$ npm i --save-dev @capacitor/core</span></pre><h2 id="03d5" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">运行应用程序</h2><p id="1904" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我们将以运行任何其他CLI应用程序的相同方式运行该应用程序。唯一需要注意的是<em class="ne"> xPlat </em>在我们的应用程序名称前面加上了前缀<code class="fe nq nr ns nt b">ionic-</code>。</p><p id="498e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行以下命令，以便在浏览器中运行Ionic应用程序:</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="6964" class="ls lt iq nt b gy ny nz l oa ob">$ ng serve ionic-mobile</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/13ddc1475eea5ef91e57e722d52d5a56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nrXO1F4fbIGGgTP_95RsEA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">浏览器上运行的Ionic应用程序</figcaption></figure><h2 id="e8ab" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">共享代码</h2><p id="43ec" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">既然应用程序已经安装并运行，我们希望开始在我们的应用程序之间共享代码。理想代码共享的一个例子是我们的状态管理模块或UI组件库。</p><p id="3a27" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如前所述，我们计划在应用程序间共享的所有代码都将作为库添加到文件夹<code class="fe nq nr ns nt b">libs</code>下。xPlat生成的应用程序已经为我们设置了使用虚拟路径导入库的路径，但是我对此不太满意。</p><p id="8dd0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">tsconfig.json中的默认虚拟路径设置如下:</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="50d4" class="ls lt iq nt b gy ny nz l oa ob">"@workspace/*": ["../../libs/*"]</span></pre><p id="e170" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不幸的是，这使得我们不得不把整个路径写到<code class="fe nq nr ns nt b">src/lib/index.ts</code>桶文件中，这很不方便。因此，我决定添加以下路径，以便更快地访问UI库:</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="d90e" class="ls lt iq nt b gy ny nz l oa ob">"paths": {<br/>    ...other paths,<br/>    "@workspace/ui": ["../../libs/ui/src/index.ts"],<br/>    "@workspace/ui/*": ["../../libs/ui/src/*"]<br/>}</span></pre><p id="8edb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完成后，我在我们的移动应用程序中打开文件<code class="fe nq nr ns nt b">home.module.ts</code>，并导入UI库的模块:</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="0372" class="ls lt iq nt b gy ny nz l oa ob"><em class="ne">// other imports...<br/>import</em> { <strong class="nt ir">UiModule</strong> } <em class="ne">from</em> <strong class="nt ir">'@workspace/ui'</strong>;</span><span id="0264" class="ls lt iq nt b gy oj nz l oa ob">@NgModule({<br/>  imports: [SharedModule, HomeRoutingModule, <strong class="nt ir">UiModule</strong>],<br/>  declarations: [HomeComponent], <br/>  schemas: [CUSTOM_ELEMENTS_SCHEMA]<br/>})<br/><em class="ne">export</em> class HomeModule {}</span></pre><p id="ffcd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在ion应用程序中的主路径现在可以访问与其他平台并行开发的组件！</p><h2 id="768f" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">不仅仅是离子型</h2><p id="4808" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">正如我们所说的，<em class="ne"> xPlat </em>还允许您为其他平台构建，比如<em class="ne"> NativeScript </em>和<em class="ne">electronic</em>(谁知道将来还会发生什么呢！).</p><p id="f05d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，代码可以在更多的应用程序之间共享。</p><h2 id="e61d" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">最后一句话</h2><p id="eb38" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">构建一个大型项目，能够在多个团队之间共享代码和扩展，肯定不是一件容易的事。</p><p id="39ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Monorepo体系结构允许我们并行工作并轻松共享代码，Nx使得管理monorepo比其他方式更容易。</p><p id="9fa3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文向您展示了一个例子，说明我们如何利用令人敬畏的技术(如<em class="ne"> NestJS </em>和<em class="ne">ion</em>)实现梦想中的技术堆栈，加速流程，最大限度地提高代码的可重用性，并借助<em class="ne"> Nx组织可扩展的项目结构。</em></p><h2 id="e259" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">参考文献及相关阅读</h2><ul class=""><li id="f059" class="mq mr iq ky b kz ml lc mm lf ok lj ol ln om lr mv mw mx my bi translated"><a class="ae kv" href="https://nx.dev/angular" rel="noopener ugc nofollow" target="_blank"> Nx </a></li><li id="0fb1" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated"><a class="ae kv" href="https://nstudio.io/xplat" rel="noopener ugc nofollow" target="_blank"> XPlat </a></li><li id="9a70" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated"><a class="ae kv" href="https://blog.nrwl.io/misconceptions-about-monorepos-monorepo-monolith-df1250d4b03c" rel="noopener ugc nofollow" target="_blank">对Monorepo的误解:mono repo！=整体</a>维克多·萨维金</li></ul><p id="b97c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您需要任何澄清，或者您认为有些事情不清楚或错误，请留下评论！</p></div><div class="ab cl on oo hu op" role="separator"><span class="oq bw bk or os ot"/><span class="oq bw bk or os ot"/><span class="oq bw bk or os"/></div><div class="ij ik il im in"><p id="b1d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ne">希望您喜欢这篇文章！如果是，请在</em> <a class="ae kv" href="https://medium.com/@.gc?source=post_page---------------------------" rel="noopener"> <em class="ne">中</em></a><a class="ae kv" href="https://twitter.com/home?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"><em class="ne">推特</em> </a> <em class="ne">或我的</em> <a class="ae kv" href="https://frontend.consulting" rel="noopener ugc nofollow" target="_blank"> <em class="ne">网站</em> </a> <em class="ne">上关注我，获取更多关于软件开发的文章，首页，RxJS，Typescript等等！</em></p></div><div class="ab cl on oo hu op" role="separator"><span class="oq bw bk or os ot"/><span class="oq bw bk or os ot"/><span class="oq bw bk or os"/></div><div class="ij ik il im in"><p id="052a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ne">原为发表于</em><a class="ae kv" href="https://frontend.consulting/building-scalable-multi-platform-projects-with-angular-and-nx" rel="noopener ugc nofollow" target="_blank"><em class="ne">https://front . consulting</em></a><em class="ne">。</em></p></div></div>    
</body>
</html>