<html>
<head>
<title>Dark Theme in Jetpack Compose with Material 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">喷气背包中的黑暗主题由材料3组成</h1>
<blockquote>原文：<a href="https://itnext.io/dark-theme-in-jetpack-compose-with-material-3-757e45118259?source=collection_archive---------0-----------------------#2022-12-07">https://itnext.io/dark-theme-in-jetpack-compose-with-material-3-757e45118259?source=collection_archive---------0-----------------------#2022-12-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a6a2228d6c6be2013e5fe67113737d70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xz9SBhz9b8tMUqpujjolEQ.png"/></div></div></figure><p id="c45c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用Jetpack Compose创建和处理主题非常容易。在这篇博客中，我们将看到实现它的“简单”和“困难”的方法。</p><p id="6a16" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最简单的方法是让系统决定我们的主题，这意味着如果用户在手机中设置了“黑暗模式”或“黑暗主题”，我们的应用程序也将处于黑暗模式。</p><p id="91fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">另一方面，难的方法，顾名思义，需要更多的工作，但并不真的很难。我们必须手动检查用户想要什么，并据此设置主题。</p><p id="68b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们开始之前，我将使用这个网站来建立我的主题。很有用，很好用。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kx"><img src="../Images/bd1f8d638ecb9f94178e6c49b34d4441.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HrX3IPVjaO0K3hT1hkUCzQ.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">材料3主题构建器<a class="ae kw" href="https://m3.material.io/theme-builder#/custom" rel="noopener ugc nofollow" target="_blank">材料设计</a></figcaption></figure><h1 id="a9c6" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated"><strong class="ak">目录</strong></h1><ol class=""><li id="24f5" class="me mf iq ka b kb mg kf mh kj mi kn mj kr mk kv ml mm mn mo bi translated"><a class="ae kw" href="#cc40" rel="noopener ugc nofollow">简单易行的方法</a></li><li id="c57c" class="me mf iq ka b kb mp kf mq kj mr kn ms kr mt kv ml mm mn mo bi translated"><a class="ae kw" href="#eba0" rel="noopener ugc nofollow">敬酒不吃吃罚酒</a></li></ol><h1 id="941e" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">入门指南</h1><p id="602a" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated">首先，让我们添加材料3依赖。您可以在<a class="ae kw" href="https://developer.android.com/jetpack/androidx/releases/compose-material3" rel="noopener ugc nofollow" target="_blank">合成材料3发布页面</a>上看到最新的M3版本。</p><pre class="ky kz la lb gt mx my mz bn na nb bi"><span id="6121" class="nc lh iq my b be nd ne l nf ng">def material3_version = "1.0.1"<br/>implementation "androidx.compose.material3:material3:$material3_version"</span></pre><p id="d6ac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">可选地，如果你已经在使用材料2，你可以跟随<a class="ae kw" href="https://material.io/blog/migrating-material-3" rel="noopener ugc nofollow" target="_blank">这篇博客</a>迁移到材料3。</p><h1 id="0890" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">设置颜色</h1><p id="950b" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated">我已经将颜色代码从<a class="ae kw" href="https://m3.material.io/theme-builder#/custom" rel="noopener ugc nofollow" target="_blank">材料3主题构建器网站</a>复制到<code class="fe nh ni nj my b">ui.theme/Color.kt</code>。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="e7e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们准备好出发了。让我们看看简单和困难的方法。</p><h1 id="cc40" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">休闲小站</h1><p id="b75b" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated">添加完颜色后，让我们前往<code class="fe nh ni nj my b">ui.theme/Theme.kt</code>并设置我们的颜色。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="nk nl l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated"><a class="ae kw" href="https://arkadiuszchmura.com/posts/how-to-change-system-bar-colors-in-compose/" rel="noopener ugc nofollow" target="_blank">最后一部分，文章链接</a></figcaption></figure><p id="24ee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就是这样！就这么简单。您可以使用<code class="fe nh ni nj my b">MaterialTheme.colorScheme.&lt;Color&gt;</code>在项目的任何地方访问主题颜色，例如<code class="fe nh ni nj my b">MaterialTheme.colorScheme.onPrimaryContainer</code></p><p id="199f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们来测试一下。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/d7a9fb4f34f2d735a801c5327ff6a187.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/format:webp/1*-QJYGa1ztg0OUU4lcN6OtA.png"/></div></figure></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h1 id="eba0" class="lg lh iq bd li lj nu ll lm ln nv lp lq lr nw lt lu lv nx lx ly lz ny mb mc md bi translated">艰难的道路</h1><p id="d48a" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated">因为我们已经有了我们的颜色和主题，我们可以跳过这一部分。</p><p id="0a8e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们添加<a class="ae kw" href="https://developer.android.com/topic/libraries/architecture/datastore" rel="noopener ugc nofollow" target="_blank">数据存储</a>依赖关系。</p><pre class="ky kz la lb gt mx my mz bn na nb bi"><span id="2b28" class="nc lh iq my b be nd ne l nf ng">implementation "androidx.datastore:datastore-preferences:1.0.0"</span></pre><p id="7642" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们准备创建我们的数据存储util类。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="9dbd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，我们将创建视图模型来处理状态。这个视图模型非常简单，我们只需保留<code class="fe nh ni nj my b">isDarkThemeEnabled</code>状态变量并监听变化。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="9324" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们将在UI中实现我们的逻辑。这节课会稍微长一点，所以让我们一部分一部分地解释。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="7649" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我们创建我们的<code class="fe nh ni nj my b">themeViewModel</code>和<code class="fe nh ni nj my b">dataStoreUtil</code>对象。</p><p id="b7ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们得到<code class="fe nh ni nj my b">systemTheme</code>，它简单地检查系统主题是否是黑暗主题。这是必要的，因为当用户打开应用程序时，我们的数据存储是空的，我们还没有任何数据，所以我们得到用户的系统主题。我们可以跳过这一部分，直接设置false而不是<code class="fe nh ni nj my b">systemTheme</code>由你决定。</p><p id="cd05" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，我们创建<code class="fe nh ni nj my b">theme</code>变量，它从数据存储中返回保存的值。</p><p id="eb05" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们将主题的<code class="fe nh ni nj my b">darkTheme</code>值设置为<code class="fe nh ni nj my b">theme</code>变量，以便应用正确的主题颜色。</p><p id="43f0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们看看我们的UI部分。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="779d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同样，我们首先创建变量。我们将<code class="fe nh ni nj my b">switchState</code>变量设置为<code class="fe nh ni nj my b">themeViewModel.isDarkThemeEnable</code>，这样每当我们切换开关时，我们的UI都会被重新组合。<code class="fe nh ni nj my b">coroutineScope</code>用于将主题偏好保存到数据存储，因为<code class="fe nh ni nj my b">saveTheme</code>函数是一个<code class="fe nh ni nj my b">suspended</code>函数。</p><p id="3057" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，每当用户切换开关时，<code class="fe nh ni nj my b">onCheckedChange</code>被触发。在<code class="fe nh ni nj my b">onCheckedChange</code>中，我们更改了两个<code class="fe nh ni nj my b">switchState</code>变量，并将主题偏好保存到数据存储中，这样无论何时用户重启应用程序，我们都能够“记住”并相应地设置主题。</p><p id="b00c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就是这样！现在让我们看看结果。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="nz nl l"/></div></figure><p id="4f31" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我希望它是有用的。👋👋</p><h2 id="0862" class="oa lh iq bd li ob oc dn lm od oe dp lq kj of og lu kn oh oi ly kr oj ok mc ol bi translated">完整代码</h2><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><p id="554f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以联系我，</p><ul class=""><li id="48f2" class="me mf iq ka b kb kc kf kg kj om kn on kr oo kv op mm mn mo bi translated"><a class="ae kw" href="https://www.linkedin.com/in/burak-fidan/" rel="noopener ugc nofollow" target="_blank">领英</a></li><li id="19eb" class="me mf iq ka b kb mp kf mq kj mr kn ms kr mt kv op mm mn mo bi translated"><a class="ae kw" href="https://github.com/MrNtlu" rel="noopener ugc nofollow" target="_blank"> Github </a></li><li id="3710" class="me mf iq ka b kb mp kf mq kj mr kn ms kr mt kv op mm mn mo bi translated"><a class="ae kw" href="https://twitter.com/BurakFNtlu" rel="noopener ugc nofollow" target="_blank">推特</a></li></ul></div></div>    
</body>
</html>