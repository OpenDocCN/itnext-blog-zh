<html>
<head>
<title>Boost Apollo GraphQL performance with cache normalization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过缓存规范化提升Apollo GraphQL性能</h1>
<blockquote>原文：<a href="https://itnext.io/boost-apollo-graphql-performance-with-cache-normalization-c7800fc8771e?source=collection_archive---------4-----------------------#2021-11-08">https://itnext.io/boost-apollo-graphql-performance-with-cache-normalization-c7800fc8771e?source=collection_archive---------4-----------------------#2021-11-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/817f2ebf5968d91f750e86554eadc8db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o0Xi6lNVIIzbKvF350o86w.png"/></div></div></figure><h1 id="8c43" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">介绍</h1><p id="0a64" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">Apollo是一个流行的GraphQL客户端，有很多特性。您可以将它用于获取数据和状态管理。Apollo有一个健壮的缓存机制。正确使用时，它可以通过减少您发出的API请求的数量来显著提高您的应用程序的性能。</p><p id="55ab" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">让我们看看Apollo是如何处理缓存规范化的，并介绍一些有助于您充分利用它的技巧。</p><h1 id="0f0e" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">什么是缓存正常化？</h1><p id="cabd" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">规范化是指减少冗余的做法。在数据库中，减少冗余意味着通过调整数据库的结构来减少重复数据的数量。</p><p id="6f71" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">对于Apollo，缓存规范化意味着使用缓存来减少重复API请求的数量。Apollo客户机可以从缓存中返回匹配的数据，而不是发出请求。</p><h1 id="4ddf" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">Apollo如何执行缓存规范化？</h1><p id="7abc" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">让我们简要介绍一下缓存规范化是如何工作的。</p><p id="6ae6" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">在底层，Apollo客户机使用一个带有键值对的JavaScript对象来存储缓存数据。这个对象是平面的，这使得从缓存中获取数据几乎是即时的。</p><p id="826a" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">无论何时发送查询，Apollo都会检查该数据是否已经存在于缓存中。如果它这样做了，客户端将立即返回缓存的数据，防止一个多余的API请求。</p><p id="27e7" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">只要返回的数据具有有效的格式，Apollo就会通过保存查询和变异的响应将新数据添加到缓存中。此外，每当缓存更新时，所有依赖于Apollo数据的UI部分都会自动重新呈现并反映新数据。</p><p id="d8e0" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">为了能够在缓存中保存数据，您的响应需要包含一个唯一的标识符。这个标识符和<code class="fe mc md me mf b">__typename</code>字段一起被用作缓存对象中的一个键，比如:<code class="fe mc md me mf b">__typeName + id</code>。默认情况下，Apollo会查找<code class="fe mc md me mf b">id</code>字段，但是在配置缓存对象时，您可以<a class="ae mg" href="https://www.apollographql.com/docs/react/caching/cache-configuration/#customizing-cache-ids" rel="noopener ugc nofollow" target="_blank">调整唯一标识符键</a>。</p><h1 id="bcf8" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">阿波罗行动能缓存和不能缓存</h1><p id="9763" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">并非所有的阿波罗行动都是平等的。其中一些可以由Apollo自动缓存，因为它们返回有效的数据，而另一些必须手动处理。</p><p id="8988" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">以下是Apollo可以自动缓存的操作列表:</p><ul class=""><li id="5895" class="mh mi it lb b lc lx lg ly lk mj lo mk ls ml lw mm mn mo mp bi translated">问题</li><li id="784e" class="mh mi it lb b lc mq lg mr lk ms lo mt ls mu lw mm mn mo mp bi translated">变异单个对象</li><li id="c61c" class="mh mi it lb b lc mq lg mr lk ms lo mt ls mu lw mm mn mo mp bi translated">变异一组对象</li></ul><p id="876f" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">以下是Apollo无法缓存的操作列表:</p><ul class=""><li id="0250" class="mh mi it lb b lc lx lg ly lk mj lo mk ls ml lw mm mn mo mp bi translated">添加数据</li><li id="46a5" class="mh mi it lb b lc mq lg mr lk ms lo mt ls mu lw mm mn mo mp bi translated">删除数据</li></ul><p id="fac4" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">Apollo不知道您希望应用程序何时反映添加或删除数据。在这些情况下，您可以手动改变缓存或使用新的查询重新提取更新的数据。</p><h1 id="8f86" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">更好的缓存规范化技巧</h1><p id="f2b2" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">现在让我们来介绍一些技巧，它们将帮助您充分利用Apollo的自动缓存规范化。</p><h2 id="4bfa" class="mv kc it bd kd mw mx dn kh my mz dp kl lk na nb kp lo nc nd kt ls ne nf kx ng bi translated">返回查询的id</h2><p id="f8bb" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">正如我之前提到的，Apollo需要一个惟一的标识符作为键，所以一个好的经验法则是总是为您想要缓存的任何查询返回<code class="fe mc md me mf b">id</code>字段。</p><figure class="ni nj nk nl gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/484d4dc2b62f33ef28ab8ed6cee33366.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JV0Q8bO6NXLnCHxNBSH9FQ.png"/></div></div></figure><h2 id="d035" class="mv kc it bd kd mw mx dn kh my mz dp kl lk na nb kp lo nc nd kt ls ne nf kx ng bi translated">返回突变的id和更新数据</h2><p id="dfa0" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">类似地，如果您希望Apollo缓存它，您应该总是返回id和来自您的变化的更新数据。这个技巧既适用于单个突变，也适用于一组对象的突变。</p><figure class="ni nj nk nl gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/b2ccfe1a15a8fadd2d143dfa4f777b35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w-Zrm-Si1yorX7GzBBgQQw.png"/></div></div></figure><h1 id="1b6e" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">结论</h1><p id="3fe6" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">在这篇文章中，我们简要介绍了Apollo的缓存机制是如何工作的，以及如何优化GraphQL查询以充分利用它并减少应用程序进行的冗余API调用的数量。编码快乐！</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><p id="fdf9" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated"><em class="nt">原载于2021年11月8日【https://isamatov.com】<a class="ae mg" href="https://isamatov.com/graphql-apollo-cache-normalization/" rel="noopener ugc nofollow" target="_blank"><em class="nt"/></a><em class="nt">。</em></em></p></div></div>    
</body>
</html>