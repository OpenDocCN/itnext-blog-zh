<html>
<head>
<title>Scalable Microservice Demo K8s Istio Kafka</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可扩展微服务演示K8s Istio Kafka</h1>
<blockquote>原文：<a href="https://itnext.io/scalable-microservice-demo-k8s-istio-kafka-344a2610eba3?source=collection_archive---------1-----------------------#2020-03-09">https://itnext.io/scalable-microservice-demo-k8s-istio-kafka-344a2610eba3?source=collection_archive---------1-----------------------#2020-03-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8ebf" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Kafka进行异步通信的高可伸缩微服务应用程序演示</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/52bb7586d71b057d28a3cd3fe9c5a374.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nod1-jbkmrfcJB987Zm9CA.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/photos/-rckGTtnN7w" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/-rckGTtnN7w</a></figcaption></figure><h2 id="d3d1" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">系列内容</h2><p id="1971" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">该系列使用不同的技术创建相同的可扩展微服务应用程序:</p><ol class=""><li id="1a37" class="mo mp it lx b ly mq mb mr li ms lm mt lq mu mn mv mw mx my bi translated">(本文)</li><li id="5075" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn mv mw mx my bi translated"><a class="ae ky" href="https://medium.com/@wuestkamp/scalable-serverless-microservice-demo-aws-lambda-kinesis-terraform-cbe6036bf5ac?source=friends_link&amp;sk=074614683a6641cab9b6067929bdc660" rel="noopener">使用AWS Lambda Kinesis的可扩展无服务器微服务演示</a></li><li id="9af0" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn mv mw mx my bi translated">使用Knative和Kafka的可扩展无服务器微服务演示(计划中)</li></ol><h2 id="f923" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">这是怎么回事？</h2><p id="6e77" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">这描述了一个使用Kubernetes，Istio和Kafka的高度可扩展的微服务演示应用程序。通过同步REST API调用，可以创建用户。在里面，所有的交流都是通过卡夫卡异步完成的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/c9ada36040fa97afb297b46989c74d6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8yh_ZFZs5J17RCJ7Eevgqw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图1:架构概述</figcaption></figure><p id="9914" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">Kafka消费者/生产者UserApprovalService根据Kafka主题中有多少未处理的消息被自动缩放(HPA)。还有一个节点/集群缩放器。</p><p id="f34b" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated"><strong class="lx iu">我们将扩展到每秒23000个Kafka事件，11个Kubernetes节点和280个pod。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/e1ff40358a010be18cd1501d93d4049d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j9_jyDzW2xymZzbC_xi_AQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图2:结果概述</figcaption></figure><p id="08d0" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">该应用程序完全是在Terraform的帮助下编写的，可以使用一个命令运行。</p><h2 id="1eb4" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">技术堆栈:</h2><ul class=""><li id="b02a" class="mo mp it lx b ly lz mb mc li nj lm nk lq nl mn nm mw mx my bi translated">将（行星）地球化（以适合人类居住）</li><li id="f103" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn nm mw mx my bi translated">(Azure) K8s，MongoDB，容器注册表</li><li id="e3a5" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn nm mw mx my bi translated">卡夫卡</li><li id="b1c7" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn nm mw mx my bi translated">伊斯迪奥</li><li id="a6d4" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn nm mw mx my bi translated">格拉法纳，普罗米修斯，卡夫卡出口商，基亚利</li><li id="b3de" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn nm mw mx my bi translated">蟒蛇，走</li></ul><h2 id="6895" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">贮藏室ˌ仓库</h2><p id="cc7c" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated"><a class="ae ky" href="https://github.com/wuestkamp/scalable-microservice-demo" rel="noopener ugc nofollow" target="_blank">https://github.com/wuestkamp/scalable-microservice-demo</a></p><p id="90f7" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">查看自述文件，了解如何自己运行它。</p><h1 id="e310" class="nn la it bd lb no np nq le nr ns nt lh jz nu ka ll kc nv kd lp kf nw kg lt nx bi translated">体系结构</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/b0748b9dd71e05745732d59ad759e42d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T2dd4tVz1zQci2cj8NMdIw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图3:建筑</figcaption></figure><p id="7430" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">我们有三种微服务:</p><ul class=""><li id="b566" class="mo mp it lx b ly mq mb mr li ms lm mt lq mu mn nm mw mx my bi translated"><strong class="lx iu"> OperationService </strong> (Python):接收同步REST请求，并将这些请求转换成异步事件。将请求作为“操作”进行跟踪，并将它们存储在自己的数据库中。</li><li id="6ce1" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn nm mw mx my bi translated"><strong class="lx iu"> UserService </strong> (Python):处理用户创建并将它们存储在自己的数据库中。</li><li id="761f" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn nm mw mx my bi translated"><strong class="lx iu">useapprovalserver</strong>(Go):可以批准/拒绝一个用户，无状态。</li></ul><p id="aaf2" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">Kafka集群由ConfluentCloud管理，Mongo数据库和K8s集群由Azure管理。</p><h2 id="87a9" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">每个服务模式的数据库</h2><p id="9a25" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">我们不使用多个服务共享的大型数据库，如果是有状态的，每个服务都有自己的数据库。我们仍然只有一个MongoDB数据库服务器，但是在这个服务器上可以存在多个数据库。如果微服务使用相同的类型/版本，它们可以共享同一个数据库服务器。点击阅读更多<a class="ae ky" href="https://microservices.io/patterns/data/database-per-service.html" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="cfb6" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">异步通信</h2><p id="7b56" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">这三个微服务彼此异步通信，没有直接的同步连接。异步的一个优点是松耦合。如果UserApprovalService关闭了一段时间，请求不会失败，只是需要更长的时间，直到用户获得批准。因此，当使用异步通信时，不需要实施重试或断路器。</p><h2 id="7bc4" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">消息工作流</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/4904f689498b77b2cb13c509588d76f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E_kDrSMB-Vlzp7Y9OFh72w.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图4:消息工作流</figcaption></figure><p id="b7fa" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">图4显示了生成和消费的消息。<strong class="lx iu">用户服务</strong>使用<code class="fe oa ob oc od b">user-create</code>消息，创建存储在MongoDB中的“待批准”用户，并生成消息<code class="fe oa ob oc od b">user-approve</code>。</p><p id="8d87" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">一旦它接收到来自<strong class="lx iu">userprovalservice</strong>的<code class="fe oa ob oc od b">user-approve-response</code>消息，它就将用户更新为“已批准”或“未批准”并产生<code class="fe oa ob oc od b">user-create-response</code>消息，该消息将被<strong class="lx iu"> OperationService </strong>接收，后者将操作状态更新为“已完成”。</p><h2 id="1feb" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">传奇模式</h2><p id="a6f3" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">当您使用一个大型(MySQL)关系数据库时，您可以简单地将您的操作包装在数据库事务中。SAGA模式可用于跨多个微服务为操作实现类似ACID的事务。</p><p id="7829" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">在图4中，用户服务可以被认为是SAGA用户创建的编排者。因为它通过生成和消费各种消息来协调用户创建。在本例中，只涉及到一个服务(UserApprovalService)，但是如果有更多的服务，情况会变得更加复杂。</p><p id="9d6b" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">一个传奇可以被比作一个状态机来实现。点击这里阅读更多关于传奇模式和编排与编排的区别:<a class="ae ky" href="https://microservices.io/patterns/data/saga.html" rel="noopener ugc nofollow" target="_blank">https://microservices.io/patterns/data/saga.html</a></p><h2 id="9376" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">同步异步转换</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/b978f2d62f916073c6a0b3684dbcd6a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yDFDndNhzL1mXjg9tXqqzw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图5:同步到异步转换</figcaption></figure><p id="787c" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">(<strong class="lx iu"> 1 </strong>)图5显示，首先对OperationService进行同步REST调用，以创建一个新操作，在本例中为“user-create”。OperationService发出异步消息，然后立即返回处于挂起状态的新操作。</p><p id="2cd2" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">(<strong class="lx iu"> 2 </strong>)返回的操作包含一个UUID，它可以用来定期获取该操作的当前状态。该操作将根据其他服务发出的进一步异步请求进行更新。</p><h1 id="22b3" class="nn la it bd lb no np nq le nr ns nt lh jz nu ka ll kc nv kd lp kf nw kg lt nx bi translated">基于Kafka消息计数的缩放</h1><p id="e31d" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">Kubernetes集群扩展是用Azure上的Terraform配置的。我们在UserApprovalService部署上也有一个HPA(水平Pod自动缩放器)。</p><p id="b801" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">HPA监听自定义指标，该指标提供了关于Kafka主题用户批准中有多少消息尚未处理的信息。如果有消息在排队，我们会旋转更多的pod。</p><p id="9172" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">UserApprovalService在处理完一条消息后会休眠200毫秒。这意味着如果它是唯一的实例并且新消息不断出现，它将会落后。</p><h1 id="9821" class="nn la it bd lb no np nq le nr ns nt lh jz nu ka ll kc nv kd lp kf nw kg lt nx bi translated">监控和指标</h1><p id="7cfc" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">我们用普罗米修斯和格拉夫纳来想象正在发生的事情。</p><h2 id="f9b6" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">卡夫卡度量</h2><p id="3bc8" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">为了从Kafka获得度量，我们使用了<a class="ae ky" href="https://github.com/danielqsj/kafka_exporter" rel="noopener ugc nofollow" target="_blank"> kafka_exporter </a>，这使得这些在Prometheus和Grafana中可用。我们在UserApprovalService的每个Pod中将kafka_exporter实现为sidecar，这样每个Pod都可以使用这些指标。</p><p id="32be" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">为了将这些Kafka Prometheus指标用作K8s自定义指标(HPA需要)，我们使用了<a class="ae ky" href="https://github.com/DirectXMan12/k8s-prometheus-adapter" rel="noopener ugc nofollow" target="_blank"> k8s-prometheus-adapter </a>。</p><pre class="kj kk kl km gt of od og oh aw oi bi"><span id="6df2" class="kz la it od b gy oj ok l ol om"># confirm install<br/>kubectl api-versions | grep "custom.metrics"</span><span id="f97a" class="kz la it od b gy on ok l ol om"># list Kafka topic metrics<br/>kubectl get --raw /apis/custom.metrics.k8s.io/v1beta1  | jq</span><span id="4ff1" class="kz la it od b gy on ok l ol om"># list Kafka topic metrics for every pod<br/>kubectl get --raw "/apis/custom.metrics.k8s.io/v1beta1/namespaces/default/pod/*/kafka_consumergroup_lag" | jq</span></pre><p id="2d00" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">项目的<code class="fe oa ob oc od b"><a class="ae ky" href="https://github.com/wuestkamp/scalable-microservice-demo/blob/master/infrastructure/helm/config/prometheus-adapter.yaml" rel="noopener ugc nofollow" target="_blank">prometheus-adapter.yaml</a></code>中有更多细节。现在，我们能够将这些Kafka指标用于K8s HPA。</p><h2 id="c52f" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">Istio metrics / Kiali</h2><p id="c227" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">Kiali与Istio配合得非常好，可以立即向我们概述正在发生的事情:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/67646325b0446437dcced9a337f32c8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*51zyUCqAybYQrKvdAghBwQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图6: Kiali网络</figcaption></figure><p id="f98c" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">在图6中，我们看到REST请求到达Istio Gateway，然后到达OperationService。所有其他通信都通过“PassthroughCluster”进行，这是外部管理的Kafka。我们还可以看到kafka-exporter正在与kafka通信以收集指标。</p><p id="5585" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">到今天为止，Istio还不能更详细地管理Kafka流量，它把它作为TCP来处理。特使似乎已经能够做到这一点，这意味着Istio将跟进。我们可能还会看到Kiali的进步，比如在边缘上显示每秒的消息数量。</p><p id="8297" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">在Joel Takvorian的Twitter帖子中可以看到更多，他成功地将Kafka节点包含到了Kiali服务图中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><h1 id="6d3a" class="nn la it bd lb no np nq le nr ns nt lh jz nu ka ll kc nv kd lp kf nw kg lt nx bi translated">在活动</h1><p id="bbc7" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">现在好戏开始了。</p><h2 id="70c5" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">UserApprovalService滞后</h2><p id="5d87" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">如果不启用HPA，我们每秒会创建大约60个新事件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/59747c3aeb95b9d597049145344bd071.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zDjRe4Hkp95iEPVCWfxzEg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图7:主题用户批准延迟增加</figcaption></figure><p id="7b2f" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated"><strong class="lx iu">从左到右我们看到:</strong></p><ul class=""><li id="f4b5" class="mo mp it lx b ly mq mb mr li ms lm mt lq mu mn nm mw mx my bi translated">卡夫卡事件/秒</li><li id="3dd4" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn nm mw mx my bi translated">尚未处理(滞后)的用户批准事件</li><li id="fd20" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn nm mw mx my bi translated">用户批准服务窗格数量</li><li id="22ed" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn nm mw mx my bi translated">节点数量</li></ul><p id="be76" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">UserApprovalService在处理完一条消息后会休眠200毫秒。这意味着如果它只有一个实例，并且新事件不断出现，它将会落后，正如我们在图7中看到的。</p><h2 id="d117" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">启用缩放</h2><p id="5a5a" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">现在，随着HPA的启用和不断增加的输入REST请求来创建新用户。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/3622fc6229a317e1b5d73b9e8229fba3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XpIAl39Db6sUpYMY8WUonQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图8:无负载，但我们从9个节点开始，以实现更快的扩展</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/a9ed254e2bc8100a0fed305106d5016d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Pkz184hzRiYQ6PWKMYufA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图9:请求命中，我们看到HPA扩展了Kafka消费者UserApprovalService</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/4354fdb40a95015ccef717dc19904cdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PxDR-iQUUByDVULdmGdCrw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图10:每秒2045个事件</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/fe262d405aff4b01fea125c97ee3b8eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_rILSbTxUhQM0_RFdWDNoQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图11:第一个节点缩放</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/85a861f5b9a631605b74971bfd65e770.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*89a3v09ggt_K0Uqw-Bel1w.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图12:每秒接近20000个事件</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/abc83626a97c7b527255f679ebe76f56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*38YDpWoGJaegBICt8hNy5Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图13: 23000！</figcaption></figure><h1 id="15ab" class="nn la it bd lb no np nq le nr ns nt lh jz nu ka ll kc nv kd lp kf nw kg lt nx bi translated">概述</h1><p id="0695" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">该应用程序自动扩展到约280个UserApprovalService pods、11个节点，每秒处理约23000个事件！这是一个很好的开始:)</p><p id="9de0" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">这只是由于Azure帐户的计算限制而停止，无法创建更多节点。</p><h1 id="0299" class="nn la it bd lb no np nq le nr ns nt lh jz nu ka ll kc nv kd lp kf nw kg lt nx bi translated">来源</h1><ul class=""><li id="2f15" class="mo mp it lx b ly lz mb mc li nj lm nk lq nl mn nm mw mx my bi translated">我非常喜欢的一本书:Chris Richardson的微服务模式。这本书的很多信息也可以在<a class="ae ky" href="https://microservices.io" rel="noopener ugc nofollow" target="_blank"> https://microservices.io </a>上找到</li><li id="e312" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn nm mw mx my bi translated"><a class="ae ky" href="https://medium.com/@ranrubin/horizontal-pod-autoscaling-hpa-triggered-by-kafka-event-f30fe99f3948" rel="noopener">一篇关于如何在Kafka上使用HPA的好文章</a></li></ul><h1 id="3bcf" class="nn la it bd lb no np nq le nr ns nt lh jz nu ka ll kc nv kd lp kf nw kg lt nx bi translated">成为Kubernetes认证</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><a href="https://killer.sh"><div class="gh gi ox"><img src="../Images/cf3901a56841fcb55f9e4e17b9f07672.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7Kbj17_6VncUuoBqNsAzzg.png"/></div></a><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://killer.sh" rel="noopener ugc nofollow" target="_blank"> https://killer.sh </a></figcaption></figure></div></div>    
</body>
</html>