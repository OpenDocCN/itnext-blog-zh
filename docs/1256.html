<html>
<head>
<title>Draft.js: List depth control</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Draft.js:列表深度控件</h1>
<blockquote>原文：<a href="https://itnext.io/draft-js-lists-depth-control-800fb3a6714c?source=collection_archive---------6-----------------------#2018-08-22">https://itnext.io/draft-js-lists-depth-control-800fb3a6714c?source=collection_archive---------6-----------------------#2018-08-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="9b43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<a class="ae kl" href="https://www.propellercrm.com/" rel="noopener ugc nofollow" target="_blank"> Propeller </a>上，让用户和平台之间的交互尽可能顺畅对我们来说非常重要。这种交互的一个要点是文本编辑。我们选择DraftJS编辑器作为工具，为我们的用户提供RichText功能。为了获得最好的用户体验，我们需要遵循RichText编辑领域的一些常用模式，但是DraftJS并没有遵循这些现成的模式。相反，它为您提供了根据需要定制编辑器的广泛可能性。</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h1 id="8914" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">问题是</h1><p id="f5ac" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">假设您有一个嵌套列表(有序或无序)。当你完成了当前深度级别的工作后，你需要上一级。通常的做法是将该项目留空，然后点击<code class="fe lw lx ly lz b">Return</code>按钮。深度水平会降低，你可以继续你的工作，甚至不用考虑按下特定的组合键。并且如果光标在第一深度级别上，则编辑器应该关闭列表。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ma"><img src="../Images/d9edcc8a28ea157a678b238531a8a67c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*JcgVgKyZkzI_eUuSO6qL_Q.gif"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">谷歌文档</figcaption></figure><p id="1db1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">默认情况下，DraftJS实现了不同的逻辑——当你点击空白列表项上的<code class="fe lw lx ly lz b">Return</code>时，会创建一个新项。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/acd2d85c36e01f804bde87b3193ba5da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/1*BDlqptSAVfx93nQqe5VzUA.gif"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">DraftJS默认行为</figcaption></figure><p id="0944" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了提高你的应用程序的UX，你可以使用<a class="ae kl" href="https://www.npmjs.com/package/draft-js-list-depth-plugin" rel="noopener ugc nofollow" target="_blank">这个插件</a>或者按照以下步骤操作。</p><h1 id="c8a2" class="kt ku iq bd kv kw mr ky kz la ms lc ld le mt lg lh li mu lk ll lm mv lo lp lq bi translated">解决办法</h1><p id="9c9e" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">算法非常简单:当用户按下<code class="fe lw lx ly lz b">Return</code>时，我们需要检查当前列表项是否为空。如果是这样，我们需要检查深度水平。如果它大于0，我们需要减少它。否则我们需要关闭列表。深度级别不能小于0。和往常一样，当涉及到DraftJS及其文档时，事情开始变得复杂。</p><p id="d789" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我们需要改变<code class="fe lw lx ly lz b">Return</code>按键的行为，DraftJS方法<code class="fe lw lx ly lz b">handleReturn</code>将是一个很好的起点！首先，我们需要得到当前选择的块(如果有的话)来工作。为此，我们需要获得选择和内容的当前状态，并选择选择开始的块。</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="5869" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦选择了该块，我们需要检查该块是否是一个列表项，以及该项是否没有文本。让我们实现一个函数来做到这一点。</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="40e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，当我们需要改变默认行为时，我们可以检测到确切的情况。现在让我们把目前所有的东西结合起来。</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="4c2c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到目前为止一切顺利！现在让我们根据描述的算法实现<code class="fe lw lx ly lz b">handleReturnForListItem</code>方法。</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="4fb0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">改变块的深度水平被证明是非常简单的。因为DraftJS在内部使用Immutable.js，所以我们可以调用块的<code class="fe lw lx ly lz b">set</code>方法来获得具有更新属性的对象的副本。然后我们需要相应地更新编辑器的状态。</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="fdf5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，这里使用的是DraftJS中的<code class="fe lw lx ly lz b">EditorState</code>——而不是本地存储的<code class="fe lw lx ly lz b">editorState</code>。还要注意这里使用了<code class="fe lw lx ly lz b">adjust-depth</code>改变类型。DraftJS使用变更类型来确定当前变更是否可以被视为撤销/重做行为的边界状态。</p><p id="cf0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们差不多完成了！剩下要写的唯一部分是如果深度级别为0时关闭列表的逻辑。</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="6b98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">来自<code class="fe lw lx ly lz b">RichUtils</code>模块的方法<code class="fe lw lx ly lz b">tryToRemoveBlockStyle</code>允许我们安全地将块类型更改为<code class="fe lw lx ly lz b">unstyled</code>。这意味着我们的列表将被关闭，列表中的最后一项将是前一项。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/66ca9b7e1b9e65ae2dbc233612d87814.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/1*tqd5IcHJq4h108oUqvtx-A.gif"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">我们将通用模式应用于DraftJS编辑器。干得好！</figcaption></figure><p id="c18e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你到现在还在读这篇文章，你可能也想看看我的另一篇文章<a class="ae kl" href="https://medium.com/@semin_andrey/multiline-items-in-draft-js-list-97075eaae608" rel="noopener">和应用这个增强功能。</a></p></div></div>    
</body>
</html>