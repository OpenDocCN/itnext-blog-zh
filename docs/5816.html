<html>
<head>
<title>Building GraphQL APIs with Quarkus</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Quarkus构建GraphQL APIs</h1>
<blockquote>原文：<a href="https://itnext.io/building-graphql-apis-with-quarkus-dbbf23f897df?source=collection_archive---------2-----------------------#2021-06-01">https://itnext.io/building-graphql-apis-with-quarkus-dbbf23f897df?source=collection_archive---------2-----------------------#2021-06-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5e7b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://graphql.org/" rel="noopener ugc nofollow" target="_blank"> GraphQL </a>被用作REST的替代品来构建Web APIs，并且在最近变得越来越流行。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/0cf2ca48b8b1420959d2b4247e2c8861.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-fdiPOs2J-hfZZJxlMLvHw.jpeg"/></div></div></figure><h1 id="392e" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">GraphQL是什么？</h1><p id="c462" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">最初的GraphQL协议是由脸书创建的，现在由GraphQL基金会维护。在GraphQL官方网站的主页上，GraphQL被描述为:</p><blockquote class="mb mc md"><p id="f427" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated">GraphQL是一种API查询语言，也是一种用现有数据完成这些查询的运行时语言。GraphQL为API中的数据提供了完整且易于理解的描述，使客户能够准确地要求他们需要的东西，使API更容易随时间发展，并支持强大的开发工具。</p></blockquote><p id="824b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到GraphQL <a class="ae kl" href="https://graphql.org/code" rel="noopener ugc nofollow" target="_blank">代码</a>页面，它列出了当前用不同语言实现的GraphQL工具和库。</p><p id="a23d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最新的Quarkus增加了一个额外的MicroProfile GraphQL实现(通过SmallRye GraphQL)来取代原来的Vertx实现。</p><p id="c4ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们将创建一个Quarkus项目，并体验这个内置的GraphQL特性。</p><h1 id="2b66" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">生成项目框架</h1><p id="34bd" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">打开浏览器，导航到<a class="ae kl" href="https://code.quarkus.io" rel="noopener ugc nofollow" target="_blank"> Quarkus Code </a>页面，将<em class="me"> SmallRye GraphQL </em>添加到项目依赖项中，然后点击<em class="me">Generate your application</em>生成项目框架。下载生成的归档文件并提取光盘中的文件，然后将项目导入IDE。</p><p id="250f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于现有的Quarkus项目，打开一个终端并切换到项目根文件夹，运行以下命令添加<em class="me"> SmallRye GraphQL </em>扩展。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="9f63" class="mn kz iq mj b gy mo mp l mq mr">mvn quarkus:add-extension -Dextensions="smallrye-graphql"</span></pre><p id="70dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，您会发现在<em class="me"> pom.xml </em>文件中添加了以下依赖项。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="572a" class="mn kz iq mj b gy mo mp l mq mr">&lt;dependency&gt;<br/>    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;<br/>    &lt;artifactId&gt;quarkus-smallrye-graphql&lt;/artifactId&gt;<br/>&lt;/dependency&gt;</span></pre><p id="17fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们来煮GraphQL API。</p><p id="781b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">类似于构建RESTful APIs，有两个原则可以选择，<strong class="jp ir">代码优先</strong>或者<strong class="jp ir">模式优先</strong>。</p><p id="722b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">SmallRye GraphQL遵循<strong class="jp ir">代码优先</strong>原则，在运行时从代码中生成GraphQL模式。</p><h1 id="0707" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">声明GraphQL API</h1><p id="d398" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">创建一个类，并在该类上添加一个<code class="fe ms mt mu mj b">@GraphQLApi</code>注释来声明GraphQL API。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="3f36" class="mn kz iq mj b gy mo mp l mq mr">@GraphQLApi<br/>@RequiredArgsConstructor<br/>public class GraphQLResource {<br/>    final PostService postService;</span><span id="8e8e" class="mn kz iq mj b gy mv mp l mq mr">    @Query<br/>    @Description("Get all posts")<br/>    public List&lt;Post&gt; getAllPosts() {<br/>        return this.postService.getAllPosts();<br/>    }</span><span id="5776" class="mn kz iq mj b gy mv mp l mq mr">    @Query<br/>    @Description("Get a specific post by providing an id")<br/>    public Optional&lt;Post&gt; getPostById(@Name("postId") String id) {<br/>        return this.postService.getPostById(id);<br/>    }</span><span id="115a" class="mn kz iq mj b gy mv mp l mq mr">    @Mutation<br/>    @Description("Create a new post")<br/>    public Post createPost(@Valid CreatePost createPostInput) {<br/>        return this.postService.createPost(createPostInput);<br/>    }<br/>}</span></pre><p id="0144" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的代码片段中，<code class="fe ms mt mu mj b">@RequiredArgsConstructor</code>是一个<a class="ae kl" href="https://projectlombok.org/" rel="noopener ugc nofollow" target="_blank"> Lombok </a>注释(不要忘记将<code class="fe ms mt mu mj b">org.projectlombok:lombok</code>添加到依赖项中)。</p><p id="3941" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ms mt mu mj b">PostService</code>是一个CDI bean，用于处理特定的业务逻辑。</p><p id="a833" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ms mt mu mj b">@Query</code>定义了一个<code class="fe ms mt mu mj b">query</code>操作，<code class="fe ms mt mu mj b">Post</code>映射到一个GraphQL <em class="me">对象类型</em>，<code class="fe ms mt mu mj b">@Name("postId")</code>定义了一个GraphQL <em class="me">参数</em>的名称，<code class="fe ms mt mu mj b">@Mutation</code>是一个<code class="fe ms mt mu mj b">mutation</code>操作，<code class="fe ms mt mu mj b">CreatePost</code>映射到一个GraphQL <em class="me">输入</em>类型。</p><p id="e3d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更多关于GraphQL的概念，如<em class="me">查询</em>、<em class="me">变异</em>、<em class="me">对象类型</em>，以及<em class="me">输入类型</em>，请参考<a class="ae kl" href="https://graphql.org/learn/" rel="noopener ugc nofollow" target="_blank"> GraphQL学习页面</a>。</p><p id="8d42" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们来看看<code class="fe ms mt mu mj b">Post</code>、<code class="fe ms mt mu mj b">Comment</code>、<code class="fe ms mt mu mj b">CreatePost</code>的内容。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="a78a" class="mn kz iq mj b gy mo mp l mq mr">@Data<br/>@Builder<br/>@ToString<br/>@Type<br/>@NoArgsConstructor<br/>@AllArgsConstructor<br/>public class Post {<br/>    @Id<br/>    String id;<br/>    String title;<br/>    String content;</span><span id="8528" class="mn kz iq mj b gy mv mp l mq mr">    int countOfComments;</span><span id="6ce1" class="mn kz iq mj b gy mv mp l mq mr">    @Builder.Default<br/>    List&lt;Comment&gt; comments = new ArrayList&lt;&gt;();<br/>}</span><span id="a398" class="mn kz iq mj b gy mv mp l mq mr">@Data<br/>@Builder<br/>@Type<br/>@NoArgsConstructor<br/>@AllArgsConstructor<br/>public class Comment {<br/>    @Id<br/>    String id;<br/>    String content;<br/>}<br/></span><span id="472f" class="mn kz iq mj b gy mv mp l mq mr">@Data<br/>@Builder<br/>@NoArgsConstructor<br/>@AllArgsConstructor<br/>@Input<br/>public class CreatePost {<br/>    String title;</span><span id="04e4" class="mn kz iq mj b gy mv mp l mq mr">    String content;<br/>}</span></pre><p id="7305" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意有两个注释:<code class="fe ms mt mu mj b">@Type</code>和<code class="fe ms mt mu mj b">@Input</code>被添加到类中。其他注释来自龙目岛。</p><p id="fbc0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们继续学习<code class="fe ms mt mu mj b">PostService</code>课程。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="302c" class="mn kz iq mj b gy mo mp l mq mr">@ApplicationScoped<br/>public class PostService {</span><span id="e57c" class="mn kz iq mj b gy mv mp l mq mr">    static List&lt;Post&gt; STORE = new ArrayList&lt;&gt;();</span><span id="ddcd" class="mn kz iq mj b gy mv mp l mq mr">    public void init(List&lt;Post&gt; data) {<br/>        STORE.clear();<br/>        STORE.addAll(data);<br/>    }</span><span id="c8e9" class="mn kz iq mj b gy mv mp l mq mr">    List&lt;Post&gt; getAllPosts() {<br/>        return STORE;<br/>    }</span><span id="fa67" class="mn kz iq mj b gy mv mp l mq mr">    Optional&lt;Post&gt; getPostById(String id) {<br/>        return STORE.stream().filter(p -&gt; p.id.equals(id)).findFirst();<br/>    }</span><span id="c271" class="mn kz iq mj b gy mv mp l mq mr">    Post createPost(CreatePost postInput) {<br/>        var data = Post.builder().id(UUID.randomUUID().toString())<br/>                .title(postInput.title)<br/>                .content(postInput.content)<br/>                .build();<br/>        STORE.add(data);<br/>        return data;<br/>    }<br/>}</span></pre><p id="be42" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个虚拟实现，目的是消除后端数据库需求。您可以简单地用访问真实数据库的代码来替换它。</p><h1 id="5979" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">运行应用程序</h1><p id="40a5" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">在运行应用程序之前，让我们添加一些示例数据。创建一个CDI bean来观察<code class="fe ms mt mu mj b">StartupEvent</code>事件，它将在应用程序已经启动时执行。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="0066" class="mn kz iq mj b gy mo mp l mq mr">@ApplicationScoped<br/>@RequiredArgsConstructor<br/>public class DataInitializer {<br/>    public static final Logger LOGGER = Logger.getLogger(DataInitializer.class.getName());<br/>    //<br/>    final PostService postService;</span><span id="8a03" class="mn kz iq mj b gy mv mp l mq mr">    //<br/>    public void onStartup(@Observes StartupEvent e) {</span><span id="8b1e" class="mn kz iq mj b gy mv mp l mq mr">        var initData = IntStream.range(1, 5).mapToObj(<br/>                i -&gt; {<br/>                    var comments = IntStream.range(1, new Random().nextInt(5)+1).mapToObj(c -&gt; Comment.builder().id(UUID.randomUUID().toString()).content("comment #" + c).build())<br/>                            .toList();<br/>                    var data = Post.builder().title("title #" + i)<br/>                            .id(UUID.randomUUID().toString())<br/>                            .content("test content of #" + i)<br/>                            .comments(comments)<br/>                            .build();<br/>                    return data;<br/>                }<br/>        ).toList();</span><span id="2474" class="mn kz iq mj b gy mv mp l mq mr">        this.postService.init(initData);</span><span id="5c03" class="mn kz iq mj b gy mv mp l mq mr">        this.postService.getAllPosts()<br/>                .forEach(p -&gt; LOGGER.log(Level.INFO, "post data : {0}", p));</span><span id="823e" class="mn kz iq mj b gy mv mp l mq mr">    }<br/>}</span></pre><p id="05a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开终端，运行项目根文件夹中的<code class="fe ms mt mu mj b">mvn quarkus:dev</code>。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="cd62" class="mn kz iq mj b gy mo mp l mq mr">2021-06-01 18:10:27,726 INFO  [io.quarkus] (Quarkus Main Thread) quarkus-examples-graphql 1.0.0-SNAPSHOT on JVM (powered by Quarkus 2.0.0.CR2) started in 5.654s. Listening on: <a class="ae kl" href="http://l" rel="noopener ugc nofollow" target="_blank">http://l</a><br/>ocalhost:8080<br/>2021-06-01 18:10:27,727 INFO  [io.quarkus] (Quarkus Main Thread) Profile dev activated. Live Coding activated.<br/>2021-06-01 18:10:27,728 INFO  [io.quarkus] (Quarkus Main Thread) Installed features: [cdi, hibernate-validator, resteasy, smallrye-context-propagation, smallrye-graphql]</span><span id="390f" class="mn kz iq mj b gy mv mp l mq mr">--<br/>Tests paused, press [r] to resume</span></pre><p id="9146" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应用程序启动后，打开浏览器并导航至<a class="ae kl" href="http://localhost:8080/q/dev/" rel="noopener ugc nofollow" target="_blank">开发界面</a>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mw"><img src="../Images/586eaeb129e3e1b4dc285b1356d7d6cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yDcKylzwdwUP5svF.png"/></div></div></figure><p id="ed09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的应用有一个<strong class="jp ir"> SmallRye GraphQL </strong>卡。<em class="me"> GraphQL模式</em>是生成的模式定义。而<em class="me"> GraphQL UI </em>是供开发者直接测试GraphQL操作的交互UI。</p><p id="8690" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击<em class="me"> GraphQL UI </em>打开图形UI页面。</p><p id="f21b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尝试执行一个<em class="me"> allPosts </em>查询，点击执行按钮，你会看到下面的页面。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mx"><img src="../Images/0c6515628486f67af77cb2b5fb458fbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Pk0ZGUmxCpmwc8ZT.png"/></div></div></figure><p id="f782" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要按ID获取文章，请尝试下面的查询，它需要一个额外的参数。在<em class="me">查询变量</em>输入框中设置<code class="fe ms mt mu mj b">postId</code>变量，是<code class="fe ms mt mu mj b">JSON</code>格式。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi my"><img src="../Images/57615b403b95ffecbcd36e8518e4783c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jOf3BWIMA88xEnGT.png"/></div></div></figure><p id="bdad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果<code class="fe ms mt mu mj b">postId</code>是一个不存在的id，它将返回一个<code class="fe ms mt mu mj b">null</code>结果，如下所示。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="e457" class="mn kz iq mj b gy mo mp l mq mr">{<br/>    "data":{<br/>    	"postById":null<br/>	}<br/>}</span></pre><p id="81f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以定义一个自定义异常，并将其转换为GraphQL错误。</p><h1 id="f9d8" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">异常处理</h1><p id="ffb7" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">创建一个<code class="fe ms mt mu mj b">PostNotFoundException</code>。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="1277" class="mn kz iq mj b gy mo mp l mq mr">import io.smallrye.graphql.api.ErrorCode;</span><span id="35e5" class="mn kz iq mj b gy mv mp l mq mr">@ErrorCode("POST_NOT_FOUND")<br/>public class PostNotFoundException extends RuntimeException{</span><span id="30d1" class="mn kz iq mj b gy mv mp l mq mr">    public PostNotFoundException(String id) {<br/>        super("Post: "+ id +" was not found.");<br/>    }<br/>}</span></pre><p id="8bfd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并在<em class="me">应用程序中添加以下配置。</em></p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="441a" class="mn kz iq mj b gy mo mp l mq mr">mp.graphql.showErrorMessage=com.example.demo.PostNotFoundException<br/>smallrye.graphql.errorExtensionFields=exception,classification,code,description,validationErrorType,queryPath</span></pre><p id="ab79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">再次运行应用程序，并提供一个不存在的文章ID，然后执行查询。当您看到错误被添加到查询结果中时，它包括您在异常类中定义的代码和消息。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mz"><img src="../Images/257453047e73706f85354d7745d22471.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jlwaKY5PARWnrUMn.png"/></div></div></figure><h1 id="792c" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">解析字段</h1><p id="2f12" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">在我们之前的例子中，一个<code class="fe ms mt mu mj b">Post</code>直接包含了<code class="fe ms mt mu mj b">comments</code>字段，这是一个<em class="me">急切的</em>方法。在现实世界的应用程序中，您可能希望按需获取相关评论的数据。当在查询字符串的结果字段列表中设置了一个<em class="me">评论</em>字段时，它可以命中后端数据库或从缓存中检索并返回指定帖子ID的结果。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="243a" class="mn kz iq mj b gy mo mp l mq mr">@GraphQLApi<br/>@RequiredArgsConstructor<br/>public class GraphQLResource {<br/>    final PostService postService;</span><span id="7bd6" class="mn kz iq mj b gy mv mp l mq mr">    public int comments(@Source Post post) {<br/>        return postService.commentsByPostId(post.getId());<br/>    }<br/>}</span></pre><p id="e0c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还可以对一些<em class="me">虚拟</em>字段应用解析规则(这里我指的是那些不存在于后端数据库中并在运行时评估的字段)，这里有一些例子:</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="7695" class="mn kz iq mj b gy mo mp l mq mr">// calculate the comments count of a specified post<br/>public int countOfComments(@Source Post post) {<br/>     return ...<br/>}</span><span id="7461" class="mn kz iq mj b gy mv mp l mq mr">// retrieve the current user info from the GraphQL context <br/>// and determine if he/her has voted the current post<br/>public boolean voted(@Source Post post, @Context context) {<br/>     return ...<br/>}</span></pre><h1 id="7fda" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">输入验证</h1><p id="ca84" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">您可以在输入类型上应用一些bean验证注释，以检查它是否满足您的要求。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="7e49" class="mn kz iq mj b gy mo mp l mq mr">public class CreatePost {</span><span id="99b0" class="mn kz iq mj b gy mv mp l mq mr">    @NotEmpty//add hibernate-validator, else bean validation dose not work.<br/>    @Length(min = 5)<br/>    String title;</span><span id="f8f0" class="mn kz iq mj b gy mv mp l mq mr">    String content;<br/>}</span></pre><p id="4306" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并且不要忘记在项目deps中添加<code class="fe ms mt mu mj b">hibernate-validator</code>扩展。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="46e6" class="mn kz iq mj b gy mo mp l mq mr">mvn quarkus:add-extension -Dextensions="hibernate-validator"</span></pre><p id="87c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行应用程序，试一试。将<em class="me">标题</em>留空，点击<em class="me">执行</em>按钮，验证异常被转换为GraphQL错误。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi na"><img src="../Images/beddc237c257078d3e2c3462e108e024.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hQrPD2svFxYJ4BKu.png"/></div></div></figure><p id="d07b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们没有探究GraphQL规范中的<code class="fe ms mt mu mj b">Subscription</code>类型——消息传递契约。我们将在以后的文章中讨论它。</p><p id="a054" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/hantsy/quarkus-sandbox/tree/master/graphql" rel="noopener ugc nofollow" target="_blank">从我的Github中抓取源代码</a>。</p></div></div>    
</body>
</html>