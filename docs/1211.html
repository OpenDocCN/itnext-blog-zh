<html>
<head>
<title>Trim $GOPATH from stack trace</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从堆栈跟踪中删除GOPATH</h1>
<blockquote>原文：<a href="https://itnext.io/trim-gopath-from-stack-trace-88b7402c8b47?source=collection_archive---------4-----------------------#2018-08-12">https://itnext.io/trim-gopath-from-stack-trace-88b7402c8b47?source=collection_archive---------4-----------------------#2018-08-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5d8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">既然你已经开始写Go了，那么你很可能对栈跟踪很熟悉。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="5566" class="ku kv iq kq b gy kw kx l ky kz">panic: panic from library</span><span id="d31a" class="ku kv iq kq b gy la kx l ky kz">goroutine 1 [running]:<br/>github.com/aerokite/build/pkg/lib.Panic()<br/> /Users/mir/go/src/github.com/aerokite/build/pkg/lib/lib.go:5 +0x39<br/>github.com/aerokite/build/pkg.Middle()<br/> /Users/mir/go/src/github.com/aerokite/build/pkg/pkg.go:7 +0x20<br/>main.main()<br/> /Users/mir/go/src/github.com/aerokite/build/main.go:6 +0x20</span></pre><p id="2ce8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在大多数情况下，堆栈跟踪提供了足够的信息来确定死机(在本例中)发生的位置。它显示了函数调用链和带有调用函数的行号的源文件。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="9d4f" class="ku kv iq kq b gy kw kx l ky kz">/Users/mir/go/src/github.com/aerokite/build/pkg/lib/lib.go:5 +0x39<br/>/Users/mir/go/src/github.com/aerokite/build/pkg/pkg.go:7 +0x20<br/>/Users/mir/go/src/github.com/aerokite/build/main.go:6 +0x20</span></pre><p id="7a1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">源文件路径包括您可能不想在生产中使用的<code class="fe lb lc ld kq b">$GOPATH</code>。因此，在为生产构建二进制文件时，我们可以从源文件路径中删除这个<code class="fe lb lc ld kq b">$GOPATH</code>部分。</p><figure class="kl km kn ko gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi le"><img src="../Images/95e6bf6168372a80c8c824a4c26f0a5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YsXvF2lpJBaQelpJyptiRw.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">来源:谷歌图片</figcaption></figure><h2 id="8542" class="ku kv iq bd lq lr ls dn lt lu lv dp lw jy lx ly lz kc ma mb mc kg md me mf mg bi translated">示例代码</h2><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="cebf" class="ku kv iq kq b gy kw kx l ky kz">// <!-- -->$GOPATH/src/github.com/aerokite/build/main.go<br/>package main<br/>import "github.com/aerokite/build/pkg"<br/>func main() {<br/>    pkg.Middle()<br/>}</span><span id="a349" class="ku kv iq kq b gy la kx l ky kz">// $GOPATH/src/github.com/aerokite/build/pkg/pkg.go<br/>package pkg<br/>import "github.com/aerokite/build/pkg/lib"<br/>func Middle() {<br/>    lib.Panic()<br/>}</span><span id="9af1" class="ku kv iq kq b gy la kx l ky kz">// $GOPATH/src/github.com/aerokite/build/pkg/lib/lib.go<br/>package lib<br/>func Panic() {<br/>    panic("panic from library")<br/>}</span></pre><p id="ad96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">构建源代码并运行</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="9978" class="ku kv iq kq b gy kw kx l ky kz"><strong class="kq ir">$</strong> go build -o trace .<br/><strong class="kq ir">$</strong> ./trace<br/>panic: panic from library</span><span id="6c3b" class="ku kv iq kq b gy la kx l ky kz">goroutine 1 [running]:<br/>github.com/aerokite/build/pkg/lib.Panic()<br/> /Users/mir/go/src/github.com/aerokite/build/pkg/lib/lib.go:5 +0x39<br/>github.com/aerokite/build/pkg.Middle()<br/> /Users/mir/go/src/github.com/aerokite/build/pkg/pkg.go:7 +0x20<br/>main.main()<br/> /Users/mir/go/src/github.com/aerokite/build/main.go:6 +0x20</span></pre><p id="1173" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里，堆栈跟踪显示源文件路径中的<code class="fe lb lc ld kq b">$GOPATH</code>。如果你想从源文件路径中删除<code class="fe lb lc ld kq b">$GOPATH</code>，重新构建如下</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="621b" class="ku kv iq kq b gy kw kx l ky kz"><strong class="kq ir">$</strong> go build -o trace <em class="mh">-gcflags "all=-trimpath=$GOPATH"</em> .<br/><strong class="kq ir">$</strong> ./trace<br/>panic: panic from library</span><span id="dc29" class="ku kv iq kq b gy la kx l ky kz">goroutine 1 [running]:<br/>github.com/aerokite/build/pkg/lib.Panic()<br/> src/github.com/aerokite/build/pkg/lib/lib.go:5 +0x39<br/>github.com/aerokite/build/pkg.Middle()<br/> src/github.com/aerokite/build/pkg/pkg.go:7 +0x20<br/>main.main()<br/> src/github.com/aerokite/build/main.go:6 +0x20</span></pre><p id="0fba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个堆栈跟踪中，<code class="fe lb lc ld kq b">/Users/mir/go/</code>被从源文件路径中删除。</p><p id="de21" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">标志<code class="fe lb lc ld kq b">-trimpath</code>用于告诉<em class="mh">开始编译</em>以从堆栈跟踪中的源文件路径修剪<code class="fe lb lc ld kq b">$GOPATH</code>。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="ee27" class="ku kv iq kq b gy kw kx l ky kz">go tool compile --help | grep -A 1 trimpath<br/>  -trimpath prefix<br/>     remove prefix from recorded source file paths</span></pre><p id="25df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是你如何构建你的二进制文件，堆栈跟踪不会在源文件路径中打印出<code class="fe lb lc ld kq b">$GOPATH</code>。</p></div></div>    
</body>
</html>