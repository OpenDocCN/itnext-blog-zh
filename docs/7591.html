<html>
<head>
<title>Connect to containers using Kubectl Exec</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Kubectl Exec连接到容器</h1>
<blockquote>原文：<a href="https://itnext.io/connect-to-containers-using-kubectl-exec-b1fb5c171f03?source=collection_archive---------6-----------------------#2022-11-16">https://itnext.io/connect-to-containers-using-kubectl-exec-b1fb5c171f03?source=collection_archive---------6-----------------------#2022-11-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="06a4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何连接到您的Kubernetes容器</h2></div><p id="6724" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将研究<code class="fe le lf lg lh b">kubectl exec</code>命令，展示如何将shell放入Kubernetes (K8S)集群中正在运行的容器，以及如何在容器上运行单独的命令，并提供一些有用的示例。</p><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi li"><img src="../Images/21adf62c6d72ad925b6f57e0e0fa4498.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m2kcZkZB0dKEJWio"/></div></div></figure><h2 id="d915" class="lu lv it bd lw lx ly dn lz ma mb dp mc kr md me mf kv mg mh mi kz mj mk ml mm bi translated">示例设置</h2><p id="0265" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">要将shell添加到容器中，首先要找到它的名称。</p><pre class="lj lk ll lm gt ms lh mt mu aw mv bi"><span id="7bfa" class="lu lv it lh b gy mw mx l my mz">kubectl get pods</span></pre><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div class="gh gi na"><img src="../Images/fe9b50bec24ef633f98862a3c6307eb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*FiIsHzkp9NJfvsAOpCIo9g.png"/></div></figure><p id="99e5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意，为了获得一个外壳，您的容器映像必须有可用的外壳。</p><p id="2ee7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我在我的Azure Kubernetes服务(AKS)集群上运行了一个名为<em class="nb">AKS-hello world-one-56 c7b 8d 79d-lkz6s</em>的服务，我们将在这些示例中使用它。这使用了<a class="ae nc" href="https://hub.docker.com/_/microsoft-azuredocs-aci-helloworld" rel="noopener ugc nofollow" target="_blank"> Hello world image </a>,这是一个简单的Node.js web应用程序，用在Azure容器实例中，用于docs.microsoft.com的例子。</p><p id="4247" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个容器由一个名为<em class="nb">的部署控制。</em></p><pre class="lj lk ll lm gt ms lh mt mu aw mv bi"><span id="b1e4" class="lu lv it lh b gy mw mx l my mz">kubectl get deployments</span></pre><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi nd"><img src="../Images/e9acca50f6977a1dbcc900503eab5613.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5YckA0W09K3dEbzwDd9Ldw.png"/></div></div></figure><p id="7c65" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我的<em class="nb">aks-hello world-one . YAML</em>部署文件如下所示:</p><pre class="lj lk ll lm gt ms lh mt mu aw mv bi"><span id="d9df" class="lu lv it lh b gy mw mx l my mz">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: aks-helloworld-one<br/>spec:<br/>  replicas: 1<br/>  selector:<br/>    matchLabels:<br/>      app: aks-helloworld-one<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: aks-helloworld-one<br/>    spec:<br/>      containers:<br/>      - name: aks-helloworld-one<br/>        image: mcr.microsoft.com/azuredocs/aks-helloworld:v1<br/>        ports:<br/>        - containerPort: 80<br/>        env:<br/>        - name: TITLE<br/>          value: "Welcome to Azure Kubernetes Service (AKS)"<br/>---<br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: aks-helloworld-one<br/>spec:<br/>  type: ClusterIP<br/>  ports:<br/>  - port: 80<br/>  selector:<br/>    app: aks-helloworld-one</span></pre><p id="ce95" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您正在进行，您可以创建上面的文件，并使用下面的命令在您的集群上部署容器:</p><pre class="lj lk ll lm gt ms lh mt mu aw mv bi"><span id="6464" class="lu lv it lh b gy mw mx l my mz">kubectl create deployment aks-helloworld-one.yaml</span></pre><h2 id="1569" class="lu lv it bd lw lx ly dn lz ma mb dp mc kr md me mf kv mg mh mi kz mj mk ml mm bi translated">连接到您的容器</h2><p id="90eb" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">要将bash shell放入正在运行的容器:</p><pre class="lj lk ll lm gt ms lh mt mu aw mv bi"><span id="f5f8" class="lu lv it lh b gy mw mx l my mz">kubectl exec --stdin --tty aks-helloworld-one-56c7b8d79d-xqx5t -- /bin/bash</span></pre><ul class=""><li id="a46b" class="ne nf it kk b kl km ko kp kr ng kv nh kz ni ld nj nk nl nm bi translated">双破折号(<code class="fe le lf lg lh b">--</code>)将您想要传递给命令的参数与<code class="fe le lf lg lh b">kubectl</code>参数分开。</li><li id="412d" class="ne nf it kk b kl nn ko no kr np kv nq kz nr ld nj nk nl nm bi translated"><code class="fe le lf lg lh b">/bin/bash</code>是您想要的外壳类型(例如也可以是<code class="fe le lf lg lh b">/bin/sh</code>)。</li><li id="6039" class="ne nf it kk b kl nn ko no kr np kv nq kz nr ld nj nk nl nm bi translated"><code class="fe le lf lg lh b">--stdin</code>选项将stdin(或标准输入)传递给容器。简称用<code class="fe le lf lg lh b">-i</code>。</li><li id="baf9" class="ne nf it kk b kl nn ko no kr np kv nq kz nr ld nj nk nl nm bi translated">标准输入是一个TTY。简称用<code class="fe le lf lg lh b">-t</code>。</li><li id="3aca" class="ne nf it kk b kl nn ko no kr np kv nq kz nr ld nj nk nl nm bi translated">您也可以指定<code class="fe le lf lg lh b">--quiet</code>或<code class="fe le lf lg lh b">-q</code>选项来禁用<code class="fe le lf lg lh b">kubectl</code>本身的所有输出。您只会看到容器中运行的流程产生的输出。</li><li id="e6f1" class="ne nf it kk b kl nn ko no kr np kv nq kz nr ld nj nk nl nm bi translated">您还可以使用<code class="fe le lf lg lh b">-pod-runnning-timeout</code>指定等待时间长度，直到至少有一个pod正在运行，默认为1m。这被指定为时间长度(如5s、2m或3h，大于零)，例如<code class="fe le lf lg lh b">--pod-running-timeout=2m</code>。</li></ul><p id="2fce" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">进入容器后，您可以直接运行命令，例如<code class="fe le lf lg lh b">ls</code>来列出目录的内容。</p><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi ns"><img src="../Images/8afc6ca3ad14f5654c4f8fe073fd5ffc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*LCP3Me-2ATOhUszkQYfP-w.png"/></div></div></figure><p id="bfd1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">或<code class="fe le lf lg lh b">ps aux</code>查看正在运行的进程:</p><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi nt"><img src="../Images/2c1a3602edd34ee4b8e9c05cc4304216.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q6pDL25g10ebR3S2Sd7buw.png"/></div></div></figure><p id="4a91" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦你在容器中完成，输入<code class="fe le lf lg lh b">exit</code>返回到你的控制台外壳。</p><h2 id="32e1" class="lu lv it bd lw lx ly dn lz ma mb dp mc kr md me mf kv mg mh mi kz mj mk ml mm bi translated">在容器中运行单个命令</h2><p id="6783" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">您也可以使用<code class="fe le lf lg lh b">kubectl exec</code>直接运行单个命令，下面显示了一些有用的示例:</p><ul class=""><li id="a45c" class="ne nf it kk b kl km ko kp kr ng kv nh kz ni ld nj nk nl nm bi translated">获取时间和日期</li></ul><pre class="lj lk ll lm gt ms lh mt mu aw mv bi"><span id="386f" class="lu lv it lh b gy mw mx l my mz">kubectl exec &lt;pod name&gt; -- date</span></pre><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/8591a645ab51977c761f38867f017972.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*jr8mXC3NsgAC5r_4HJZvzA.png"/></div></figure><ul class=""><li id="cf81" class="ne nf it kk b kl km ko kp kr ng kv nh kz ni ld nj nk nl nm bi translated">列出运行环境变量</li></ul><pre class="lj lk ll lm gt ms lh mt mu aw mv bi"><span id="5732" class="lu lv it lh b gy mw mx l my mz">kubectl exec &lt;pod name&gt; -- env</span></pre><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi nv"><img src="../Images/01915f45460c495ade13c6cdc8d89ec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HaUgQ8--9m4omfQM2qoj2g.png"/></div></div></figure><ul class=""><li id="14e3" class="ne nf it kk b kl km ko kp kr ng kv nh kz ni ld nj nk nl nm bi translated">更新包</li></ul><pre class="lj lk ll lm gt ms lh mt mu aw mv bi"><span id="4493" class="lu lv it lh b gy mw mx l my mz">kubectl exec &lt;pod name&gt; -- apt-get update</span></pre><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi nw"><img src="../Images/c8d39cda71e6a5752b0c67c084175e78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VLET6lrZs-wnkHvwQ7qw8g.png"/></div></div></figure><ul class=""><li id="e6f4" class="ne nf it kk b kl km ko kp kr ng kv nh kz ni ld nj nk nl nm bi translated">查看装载点</li></ul><pre class="lj lk ll lm gt ms lh mt mu aw mv bi"><span id="fcb7" class="lu lv it lh b gy mw mx l my mz">kubectl exec shell-demo -- cat /proc/1/mounts</span></pre><h2 id="788a" class="lu lv it bd lw lx ly dn lz ma mb dp mc kr md me mf kv mg mh mi kz mj mk ml mm bi translated">当一个Pod有多个容器时，连接到指定的容器</h2><p id="929f" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">如果一个Pod有多个容器，使用<code class="fe le lf lg lh b">--container</code>或<code class="fe le lf lg lh b">-c</code>在<code class="fe le lf lg lh b">kubectl exec</code>命令中指定一个容器。</p><pre class="lj lk ll lm gt ms lh mt mu aw mv bi"><span id="c61a" class="lu lv it lh b gy mw mx l my mz">kubectl exec -i -t &lt;pod name&gt; --container &lt;container name&gt; -- /bin/bash</span></pre><h2 id="df06" class="lu lv it bd lw lx ly dn lz ma mb dp mc kr md me mf kv mg mh mi kz mj mk ml mm bi translated">摘要</h2><p id="68f7" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">您可以使用<code class="fe le lf lg lh b">kubectl exec</code>连接到一个正在运行的容器，并使用它来执行单个命令。连接到容器对于查看日志、检查进程、挂载点、环境变量和包版本等非常有用。</p><p id="6c68" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe le lf lg lh b">kubectl exec</code>将为您提供对容器的完全shell访问权限，因此可以修改它并安装不属于容器映像的包，但除非出于临时故障排除的目的，否则不建议这样做。如果容器永久地需要额外的修改或打包，那么应该修改映像并部署新版本以保持不变性和可再现性。</p><p id="c2b1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">干杯！🍻</p><div class="nx ny gp gr nz oa"><a href="https://www.buymeacoffee.com/jackwesleyroper" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">Jack Roper正在Azure、Azure DevOps、Terraform、Kubernetes和Cloud tech上写博客！</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">希望我的博客能帮到你，你会喜欢它的内容！我真的很喜欢写技术内容和分享…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">www.buymeacoffee.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo ls oa"/></div></div></a></div><p id="e153" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="nb">最初发表于</em><a class="ae nc" href="https://spacelift.io/" rel="noopener ugc nofollow" target="_blank"><em class="nb">space lift . io</em></a><em class="nb">。</em></p></div></div>    
</body>
</html>