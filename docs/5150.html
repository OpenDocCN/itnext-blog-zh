<html>
<head>
<title>Using SSE in Go web server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Go web服务器中使用SSE</h1>
<blockquote>原文：<a href="https://itnext.io/create-go-service-the-easy-way-iv-c1f6b91401c1?source=collection_archive---------0-----------------------#2020-12-23">https://itnext.io/create-go-service-the-easy-way-iv-c1f6b91401c1?source=collection_archive---------0-----------------------#2020-12-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7e63" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">服务器以最简单的方式发送事件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0243cd43ffd7d54cb5eb45bfb48a7270.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*InFe0jU-dOOJbhFISFyZXg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由Renee French创建的原始地鼠图像，使用由Maria Letta创建的地鼠图像</figcaption></figure><ol class=""><li id="6d8c" class="ky kz it la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">部分:<a class="ae lq" href="https://petrjahoda.medium.com/create-go-service-the-easy-way-de827d7f07cf" rel="noopener">创建服务</a></li><li id="2480" class="ky kz it la b lb lr ld ls lf lt lh lu lj lv ll lm ln lo lp bi translated">part: <a class="ae lq" href="https://petrjahoda.medium.com/create-go-service-the-easy-way-ii-c397fd17875" rel="noopener">改善服务</a></li><li id="ba9c" class="ky kz it la b lb lr ld ls lf lt lh lu lj lv ll lm ln lo lp bi translated">part: <a class="ae lq" href="https://medium.com/swlh/create-go-service-the-easy-way-iii-c84489cc1ee0" rel="noopener">网页升级</a></li><li id="ed75" class="ky kz it la b lb lr ld ls lf lt lh lu lj lv ll lm ln lo lp bi translated">part: <strong class="la iu">你现在正在读</strong></li><li id="73b1" class="ky kz it la b lb lr ld ls lf lt lh lu lj lv ll lm ln lo lp bi translated">部分:<a class="ae lq" href="https://petrjahoda.medium.com/create-go-service-the-easy-way-v-63c260594ed9" rel="noopener">简单的javascript前端功能</a></li><li id="a153" class="ky kz it la b lb lr ld ls lf lt lh lu lj lv ll lm ln lo lp bi translated">零件:<a class="ae lq" href="https://petrjahoda.medium.com/create-go-service-the-easy-way-vi-1fc383d435bd" rel="noopener">前端—后端通信</a></li><li id="445f" class="ky kz it la b lb lr ld ls lf lt lh lu lj lv ll lm ln lo lp bi translated">部分:<a class="ae lq" href="https://petrjahoda.medium.com/create-go-service-the-easy-way-vii-2a550c9204a6" rel="noopener">服务器端日志</a></li><li id="7c5e" class="ky kz it la b lb lr ld ls lf lt lh lu lj lv ll lm ln lo lp bi translated">零件:<a class="ae lq" href="https://petrjahoda.medium.com/create-go-service-the-easy-way-viii-157427e7cd35" rel="noopener">在docker </a>中运行所有零件</li><li id="3aca" class="ky kz it la b lb lr ld ls lf lt lh lu lj lv ll lm ln lo lp bi translated">零件:<a class="ae lq" href="https://petrjahoda.medium.com/test-story-618d1cfca0cd" rel="noopener">添加数据库容器</a></li><li id="8b1f" class="ky kz it la b lb lr ld ls lf lt lh lu lj lv ll lm ln lo lp bi translated">零件:<a class="ae lq" href="https://petrjahoda.medium.com/communication-between-go-service-and-postgres-database-both-running-in-docker-ae0fd53a25b8" rel="noopener">数据库—服务通信</a></li></ol><p id="a83f" class="pw-post-body-paragraph lw lx it la b lb lc ju ly ld le jx lz lf ma mb mc lh md me mf lj mg mh mi ll im bi translated">追加1: <a class="ae lq" rel="noopener ugc nofollow" target="_blank" href="/go-functions-methods-pointers-and-interfaces-1c034fd198d3">函数、方法、指针和接口</a> <br/>追加2: <a class="ae lq" rel="noopener ugc nofollow" target="_blank" href="/websocket-communication-between-two-go-programs-the-easy-way-d8c9cf40043f"> websocket通信</a> <br/>追加3: <a class="ae lq" href="https://petrjahoda.medium.com/plain-socket-communication-between-two-go-programs-the-easy-way-bd5ac5819eb6" rel="noopener"> socket通信</a></p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="8cbe" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">这是什么意思，SSE？我为什么要用它？</h1><p id="6b7d" class="pw-post-body-paragraph lw lx it la b lb ni ju ly ld nj jx lz lf nk mb mc lh nl me mf lj nm mh mi ll im bi translated">SSE代表<a class="ae lq" href="https://en.wikipedia.org/wiki/Server-sent_events" rel="noopener ugc nofollow" target="_blank">服务器发送事件</a>，标准化的<strong class="la iu">推送</strong>技术，非常容易使用。</p><p id="b9e7" class="pw-post-body-paragraph lw lx it la b lb lc ju ly ld le jx lz lf ma mb mc lh md me mf lj mg mh mi ll im bi translated">如果你想更新网页上的内容，你可以使用SSE。无论是发送时间、表格、颜色、通知徽章，…</p><p id="1d1f" class="pw-post-body-paragraph lw lx it la b lb lc ju ly ld le jx lz lf ma mb mc lh md me mf lj mg mh mi ll im bi translated">在本文中，我们将使用一个简单的例子，在这里您将看到SSE的强大功能。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="3a71" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">准备项目</h1><p id="90b9" class="pw-post-body-paragraph lw lx it la b lb ni ju ly ld nj jx lz lf nk mb mc lh nl me mf lj nm mh mi ll im bi translated">从添加正确的模块开始，该模块已经在程序的服务器端内置了该功能。</p><p id="b27b" class="pw-post-body-paragraph lw lx it la b lb lc ju ly ld le jx lz lf ma mb mc lh md me mf lj mg mh mi ll im bi translated">我们将再次使用julienschmidt的存储库，这次是来自<code class="fe nn no np nq b">github.com/julienschmidt/sse</code>的模块。所以添加新模块并导入它。您的导入代码块应该类似于下面的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><h1 id="c072" class="mq mr it bd ms mt nt mv mw mx nu mz na jz nv ka nc kc nw kd ne kf nx kg ng nh bi translated">添加SSE功能</h1><p id="4174" class="pw-post-body-paragraph lw lx it la b lb ni ju ly ld nj jx lz lf nk mb mc lh nl me mf lj nm mh mi ll im bi translated">然后导航到<code class="fe nn no np nq b">run()</code>方法，并在您的<code class="fe nn no np nq b">router := httprouter.New()</code>下添加一行新代码。这行代码将创建一个名为timer的新流。忽略红色曲线，因为我们将立即使用该飘带。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><h2 id="8e84" class="ny mr it bd ms nz oa dn mw ob oc dp na lf od oe nc lh of og ne lj oh oi ng oj bi translated">在服务器端实现SSE</h2><p id="9505" class="pw-post-body-paragraph lw lx it la b lb ni ju ly ld nj jx lz lf nk mb mc lh nl me mf lj nm mh mi ll im bi translated">再添加两行代码:<code class="fe nn no np nq b">router.Handler(“GET”, “/time”, timer)</code>和<code class="fe nn no np nq b">go streamTime(timer)</code>，这样最后你的<code class="fe nn no np nq b">run()</code>方法应该看起来像下面的代码。第一个新行将为这个streamer注册一个句柄，第二个行将运行新的<strong class="la iu"> goroutine </strong>，它将流式传输时间，直到服务停止。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="ab6b" class="pw-post-body-paragraph lw lx it la b lb lc ju ly ld le jx lz lf ma mb mc lh md me mf lj mg mh mi ll im bi translated">使用ALT+ENTER创建那个<code class="fe nn no np nq b">streamTime()</code>函数，并将其移动到您的<strong class="la iu">主页。go </strong>文件。用下面的代码更新这个函数。只要您的服务在运行，这段代码就会以每毫秒的时间流传输实际时间。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><h2 id="797b" class="ny mr it bd ms nz oa dn mw ob oc dp na lf od oe nc lh of og ne lj oh oi ng oj bi translated">在客户端实现SSE</h2><p id="f4fe" class="pw-post-body-paragraph lw lx it la b lb ni ju ly ld nj jx lz lf nk mb mc lh nl me mf lj nm mh mi ll im bi translated">现在我们将向您的<strong class="la iu">homepage.html</strong>文件添加一个新元素，它将显示流时间。是id为actual-time的元素:<code class="fe nn no np nq b">&lt;h2 id=”actual-time” &gt;&lt;/h2&gt;.</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="e4dc" class="pw-post-body-paragraph lw lx it la b lb lc ju ly ld le jx lz lf ma mb mc lh md me mf lj mg mh mi ll im bi translated">最后，给你的<strong class="la iu"> homepage.js </strong>文件添加几行新代码。这几行代码访问我们在<code class="fe nn no np nq b">router.Handler(“GET”, “/time”, timer)</code>中定义的<code class="fe nn no np nq b"><strong class="la iu"> /time</strong></code>句柄。每次——在本例中是每毫秒——它都会用实际时间更新html元素。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><h2 id="36b2" class="ny mr it bd ms nz oa dn mw ob oc dp na lf od oe nc lh of og ne lj oh oi ng oj bi translated">测试一下，SSE能工作多快</h2><p id="76c0" class="pw-post-body-paragraph lw lx it la b lb ni ju ly ld nj jx lz lf nk mb mc lh nl me mf lj nm mh mi ll im bi translated">现在您可以测试它，但是不要忘记从您的<code class="fe nn no np nq b">serveHomepage()</code>函数中移除那个<code class="fe nn no np nq b"><strong class="la iu">time.Sleep()</strong></code>方法。你应该看到你的SSE工作得很好。时间每毫秒刷新一次。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/1bf6d8d98592ce4ae1d08b446492f7a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*1DolqnesCj4FhwmR13x4Mg.gif"/></div></div></figure><p id="7cc7" class="pw-post-body-paragraph lw lx it la b lb lc ju ly ld le jx lz lf ma mb mc lh md me mf lj mg mh mi ll im bi translated"><strong class="la iu">现在你看到SSE的威力了吧。</strong></p><h2 id="cd42" class="ny mr it bd ms nz oa dn mw ob oc dp na lf od oe nc lh of og ne lj oh oi ng oj bi translated">立正！</h2><p id="a912" class="pw-post-body-paragraph lw lx it la b lb ni ju ly ld nj jx lz lf nk mb mc lh nl me mf lj nm mh mi ll im bi translated">但是，请，这只是作为一个例子，如何发送数据从后端到前端。不要使用SSE每毫秒发送一次时间。看下面的截图，当测量这个<em class="ol">每毫秒传输时间</em>的数据传输量时，看起来是什么样子。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/a90e2e8814a8380d645e252256e649f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*OJfZYr_YDSAjlCSQMNxzFQ.gif"/></div></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="d43b" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">摘要</h1><p id="d525" class="pw-post-body-paragraph lw lx it la b lb ni ju ly ld nj jx lz lf nk mb mc lh nl me mf lj nm mh mi ll im bi translated">SSE技术只能单向传输数据流。从服务器到客户端。用它在你的网页上显示毫秒时间是不明智的，你可以在客户端用javascript完全做到这一点。</p><p id="04d4" class="pw-post-body-paragraph lw lx it la b lb lc ju ly ld le jx lz lf ma mb mc lh md me mf lj mg mh mi ll im bi translated">我专门用发送时间向您展示，有多少数据和多快可以从服务器传输到客户端，但在实际应用程序中，我用它来通知和更新各种数据。</p><p id="c078" class="pw-post-body-paragraph lw lx it la b lb lc ju ly ld le jx lz lf ma mb mc lh md me mf lj mg mh mi ll im bi translated">总结一下，读完这篇文章，你知道如何…</p><ul class=""><li id="e49b" class="ky kz it la b lb lc ld le lf lg lh li lj lk ll on ln lo lp bi translated">在Go中的服务器端实现SSE</li><li id="23cb" class="ky kz it la b lb lr ld ls lf lt lh lu lj lv ll on ln lo lp bi translated">用HTML和Javascript在客户端实现SSE</li><li id="ad91" class="ky kz it la b lb lr ld ls lf lt lh lu lj lv ll on ln lo lp bi translated">SSE的优势是什么(快速且易于使用)</li><li id="cf48" class="ky kz it la b lb lr ld ls lf lt lh lu lj lv ll on ln lo lp bi translated">SSE的缺点是什么(仅限于服务器到客户端)</li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="defd" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">现实生活中的例子</h1><p id="f4ad" class="pw-post-body-paragraph lw lx it la b lb ni ju ly ld nj jx lz lf nk mb mc lh nl me mf lj nm mh mi ll im bi translated">举个例子，这是我使用SSE的方式。</p><p id="3411" class="pw-post-body-paragraph lw lx it la b lb lc ju ly ld le jx lz lf ma mb mc lh md me mf lj mg mh mi ll im bi translated">这是一个大屏幕的截图，挂在某工厂的一个生产大厅里。SSE用于更新这张截图上的几乎每一条数据。颜色、文本、百分比，在这种情况下，甚至是时间(因为客户希望每个面板上的时间同步)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/03a7402683e0144ef48fe0c20fe70664.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hdoWNzlGOhnSkVOvpEm6Ug.png"/></div></div></figure><h2 id="47a4" class="ny mr it bd ms nz oa dn mw ob oc dp na lf od oe nc lh of og ne lj oh oi ng oj bi translated">整洁的特征</h2><p id="33f8" class="pw-post-body-paragraph lw lx it la b lb ni ju ly ld nj jx lz lf nk mb mc lh nl me mf lj nm mh mi ll im bi translated">使用SSE的一个非常简洁的特征是我称之为<em class="ol">“连续性”</em>。当你停止服务，即使用SSE发送所有数据，但<strong class="la iu">让页面打开</strong>，你会立即看到，页面上的数据没有刷新。</p><p id="0538" class="pw-post-body-paragraph lw lx it la b lb lc ju ly ld le jx lz lf ma mb mc lh md me mf lj mg mh mi ll im bi translated">在这种LCD面板的情况下，您看不到新的更新…但页面仍然打开。在我们关于时间的例子中，时间停止了。但是当您再次启动该服务时，您会看到时间又开始运行了。你自己检查一下。如果是LCD面板，它会自动刷新新数据。</p><p id="7d03" class="pw-post-body-paragraph lw lx it la b lb lc ju ly ld le jx lz lf ma mb mc lh md me mf lj mg mh mi ll im bi translated"><em class="ol">附:你可以在这里</em>  <em class="ol">看到液晶面板</em> <a class="ae lq" href="https://github.com/petrjahoda/display_webservice" rel="noopener ugc nofollow" target="_blank"> <em class="ol">的完整代码，但该服务只是项目的一部分，所以忽略与SSE无关的一切:-) </em></a></p><div class="op oq gp gr or os"><a href="https://github.com/petrjahoda/medium_service/tree/Chapter_4" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">petrjahoda/中型服务</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">中等_服务。在GitHub上创建一个帐户，为petrjahoda/medium-service的发展作出贡献。</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">github.com</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg ks os"/></div></div></a></div></div></div>    
</body>
</html>