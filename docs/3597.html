<html>
<head>
<title>WebAssembly &amp; Transferable, a Perfect Match</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">WebAssembly &amp; Transferable，完美匹配</h1>
<blockquote>原文：<a href="https://itnext.io/webassembly-transferable-a-perfect-match-d78866b78d86?source=collection_archive---------5-----------------------#2020-01-14">https://itnext.io/webassembly-transferable-a-perfect-match-d78866b78d86?source=collection_archive---------5-----------------------#2020-01-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/7ee6663b85f37b0c76bd5ececb42741b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*LiH6TwUvhDWYW_VpgtgTpQ.png"/></div></figure><p id="1e77" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">大多数时候，我们在Web Worker(或Node.js中的worker_thread)内部运行WebAssembly代码，以防止阻塞主线程，并维护一个有响应的UI。</p><p id="3de4" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">为了与web worker通信，我们使用<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" rel="noopener ugc nofollow" target="_blank"> Window.postMessage() </a>将数据从主线程发送到Web Worker线程。有时您可能需要发送数兆字节的数据(尤其是对于多媒体应用程序)，这将导致较长的数据传输时间，甚至出现内存不足异常，这是由于postMessage()的本质是将数据从主线程克隆到web worker线程。</p><figure class="kx ky kz la gt ju gh gi paragraph-image"><div class="gh gi kw"><img src="../Images/437991615054a9dceddcabd5b7eee7f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*NjCRekjySntXmLljZ_yOeA.png"/></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">向网络工作者发送数据的基本方式</figcaption></figure><p id="4ff0" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">要解决这个问题，您可以在postMessage()中使用<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/Transferable" rel="noopener ugc nofollow" target="_blank"> Transferable </a>，只需在postMessage()中传递第二个参数，您就可以在不太麻烦的情况下获得速度提升和内存节省。</p><pre class="kx ky kz la gt lf lg lh li aw lj bi"><span id="640b" class="lk ll it lg b gy lm ln l lo lp">// Without Transerable, takes up to 2000 ms for worker to get data<br/>const data = new UInt8Array(1024*1024*1024);<br/>worker.postMessage(data);</span><span id="5b3f" class="lk ll it lg b gy lq ln l lo lp">// With Transerable, takes up to 100 ms for worker to get data<br/>const data = new UInt8Array(1024*1024*1024);<br/>worker.postMessage(data, [data.buffer]);</span></pre><p id="ed24" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在这个资源库中查看一个演示:【https://github.com/jeromewu/web-worker-transferable-demo T4】</p><p id="1979" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">因为使用Transferable几乎是免费的，而且可以在应用程序中提高速度和节省内存，所以您应该现在就开始在应用程序中使用它。</p><p id="3ec9" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">下一个故事再见。:)</p></div></div>    
</body>
</html>