<html>
<head>
<title>Part 1: Introduction to Azure Container Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第1部分:Azure容器应用简介</h1>
<blockquote>原文：<a href="https://itnext.io/part-1-introduction-to-azure-container-apps-3e879343ae9b?source=collection_archive---------4-----------------------#2022-11-06">https://itnext.io/part-1-introduction-to-azure-container-apps-3e879343ae9b?source=collection_archive---------4-----------------------#2022-11-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/5793f52cefe0fb7f2375c23c02fe772c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yhq7VEPqnpdEKb5-on9EWQ.png"/></div></div></figure><div class=""/><div class=""><h2 id="0232" class="pw-subtitle-paragraph jy ja jb bd b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dk translated">系列:使用Azure容器应用和Terraform构建微服务</h2></div><h2 id="a020" class="kq kr jb bd ks kt ku dn kv kw kx dp ky kz la lb lc ld le lf lg lh li lj lk ll bi translated"><strong class="ak">系列:</strong></h2><ul class=""><li id="b8ca" class="lm ln jb lo b lp lq lr ls kz lt ld lu lh lv lw lx ly lz ma bi translated"><a class="ae mb" rel="noopener ugc nofollow" target="_blank" href="/part-0-adding-some-spicy-to-microservice-vs-monolith-4303c869684f">第0部分:给微服务和整体服务增加一些趣味</a></li></ul><h1 id="73dc" class="mc kr jb bd ks md me mf kv mg mh mi ky kh mj ki lc kk mk kl lg kn ml ko lk mm bi translated">介绍</h1><p id="9a8e" class="pw-post-body-paragraph mn mo jb lo b lp lq kc mp lr ls kf mq kz mr ms mt ld mu mv mw lh mx my mz lw ij bi translated">正在为容器寻找Azure应用服务的替代品，但对AKS集群的成本不太感兴趣，或者正在寻找一个直接用于容器的非个人化托管平台？</p><p id="af2a" class="pw-post-body-paragraph mn mo jb lo b lp na kc mp lr nb kf mq kz nc ms mt ld nd mv mw lh ne my mz lw ij bi translated">这一点以及更多内容将在这个关于使用Azure Container应用程序和Terraform构建微服务的系列中讨论。</p><blockquote class="nf ng nh"><p id="4525" class="mn mo ni lo b lp na kc mp lr nb kf mq nj nc ms mt nk nd mv mw nl ne my mz lw ij bi translated">对于这些服务，我将使用Dotnet、C#和docker。但是如前所述，如果你的代码可以在容器中运行，那么不要害怕。在这篇简短的介绍中，我试图总结一下MSDN的文档，但是我建议你读一读:<a class="ae mb" href="https://learn.microsoft.com/en-gb/azure/container-apps/?ocid=AID3042118" rel="noopener ugc nofollow" target="_blank"> Azure Container Apps文档|微软学习</a></p></blockquote></div><div class="ab cl nm nn hu no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ij ik il im in"><h1 id="76a8" class="mc kr jb bd ks md nt mf kv mg nu mi ky kh nv ki lc kk nw kl lg kn nx ko lk mm bi translated">什么是Azure容器应用？</h1><p id="381b" class="pw-post-body-paragraph mn mo jb lo b lp lq kc mp lr ls kf mq kz mr ms mt ld mu mv mw lh mx my mz lw ij bi translated">它是一种无服务器的以应用程序为中心的托管服务，只要你的代码被打包在一个容器中，它就不会受到编程模型或语言的影响。容器应用程序建立在Kubernetes生态系统之上，但是您作为开发人员并不维护或学习Kubernetes的所有复杂性、其维护或所有底层的编排器和基础设施。</p><p id="e73a" class="pw-post-body-paragraph mn mo jb lo b lp na kc mp lr nb kf mq kz nc ms mt ld nd mv mw lh ne my mz lw ij bi translated">在底层，容器应用运行在Azure Kubernetes Services (AKS)上，集成了分布式应用运行时(Dapr)、Envoy和Kubernetes事件驱动自动缩放(KEDA)。</p><figure class="ny nz oa ob gt is"><div class="bz fp l di"><div class="oc od l"/></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">Gif: Noice</figcaption></figure></div><div class="ab cl nm nn hu no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ij ik il im in"><h1 id="28ee" class="mc kr jb bd ks md nt mf kv mg nu mi ky kh nv ki lc kk nw kl lg kn nx ko lk mm bi translated">用例</h1><p id="ad30" class="pw-post-body-paragraph mn mo jb lo b lp lq kc mp lr ls kf mq kz mr ms mt ld mu mv mw lh mx my mz lw ij bi translated">如前所述，微服务是一个主要使用案例，但还有其他案例，例如:</p><ul class=""><li id="3a12" class="lm ln jb lo b lp na lr nb kz oi ld oj lh ok lw lx ly lz ma bi translated">一个应用程序，需要使用队列中的消息，并且需要通过根据消息数量增加/减少实例来随着数量的增加而扩展。</li><li id="5725" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated">长期运行的后台进程。</li><li id="b95b" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated">HTTP消息处理，可以基于实例之间的百分比进行拆分。即修订版1获得80%的流量，而修订版2获得20%的流量。</li><li id="bba3" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated">我甚至见过一些团队把他们的Azure功能移植到容器应用中。</li></ul></div><div class="ab cl nm nn hu no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ij ik il im in"><h1 id="42d5" class="mc kr jb bd ks md nt mf kv mg nu mi ky kh nv ki lc kk nw kl lg kn nx ko lk mm bi translated">特征</h1><ul class=""><li id="ec04" class="lm ln jb lo b lp lq lr ls kz lt ld lu lh lv lw lx ly lz ma bi translated">支持托管身份</li><li id="d8f0" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated">自定义域</li><li id="ae9b" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated">应用之间的加密流量</li><li id="50eb" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated">VNET一体化</li><li id="bb46" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated">健康探针</li><li id="56fb" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated">AAD和其他社交账户认证集成</li><li id="8b2a" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated">环境秘密</li><li id="7f3b" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated">基于缩放触发器的缩放</li><li id="a8a2" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated">配置为在内部或外部公开服务</li><li id="974b" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated">控制应用的vCPUs和RAM数量。</li></ul></div><div class="ab cl nm nn hu no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ij ik il im in"><h1 id="caa6" class="mc kr jb bd ks md nt mf kv mg nu mi ky kh nv ki lc kk nw kl lg kn nx ko lk mm bi translated">它是如何工作的？</h1><figure class="ny nz oa ob gt is"><div class="bz fp l di"><div class="oc od l"/></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">Gif: Cogs</figcaption></figure><p id="adc2" class="pw-post-body-paragraph mn mo jb lo b lp na kc mp lr nb kf mq kz nc ms mt ld nd mv mw lh ne my mz lw ij bi translated">好的，那么你要做的第一件事就是运输容器，所以你自然需要某种容器注册，比如Azure容器注册。</p><p id="7003" class="pw-post-body-paragraph mn mo jb lo b lp na kc mp lr nb kf mq kz nc ms mt ld nd mv mw lh ne my mz lw ij bi translated">当创建一个Azure容器应用程序时，你需要指定一个<strong class="lo jc">容器应用程序环境</strong>并把它放在一个区域中。这被用作一个或多个容器应用程序周围的安全边界，这些容器应用程序相互通信并且<strong class="lo jc">共享</strong>虚拟网络、Dapr和日志。请注意，此环境中的应用程序将写入同一个日志分析工作区。在撰写本文时，您不能拥有跨多个地区或虚拟网络的环境，因此它是特定于VNET地区的。</p><figure class="ny nz oa ob gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oq"><img src="../Images/b348d933bde52aedb4d0243e8a524b74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nt5k001dmVoH0n1IGuZiFA.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">插图:创建Azure容器应用程序环境</figcaption></figure><p id="d28b" class="pw-post-body-paragraph mn mo jb lo b lp na kc mp lr nb kf mq kz nc ms mt ld nd mv mw lh ne my mz lw ij bi translated">Azure容器应用程序环境内部是你的容器应用程序所在的地方。每个容器应用程序由修订版、副本和容器组成。</p><figure class="ny nz oa ob gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi or"><img src="../Images/895e010e4317c1441dee9b3ed1d9ac65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*hVQI95JL7h1kppRGOwxFcw.gif"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">插图:Azure容器应用程序环境</figcaption></figure><h2 id="4a99" class="kq kr jb bd ks kt ku dn kv kw kx dp ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">修订本</h2><p id="6df8" class="pw-post-body-paragraph mn mo jb lo b lp lq kc mp lr ls kf mq kz mr ms mt ld mu mv mw lh mx my mz lw ij bi translated">是容器应用程序版本的不可变快照。第一个版本是在第一次部署时创建的。该应用程序可以在单个或多个版本模式下运行，最多可保留100个版本。有了修订版，就有可能在它们之间分割HTTP流量。修订是容器应用程序生命周期的核心</p><p id="8aaa" class="pw-post-body-paragraph mn mo jb lo b lp na kc mp lr nb kf mq kz nc ms mt ld nd mv mw lh ne my mz lw ij bi translated">在<strong class="lo jc">单版本</strong>模式下，一次只有一个版本处于活动状态，当新版本可用时，它将取代当前版本。在<strong class="lo jc">多版本</strong>模式下，多个版本同时并行运行。</p><p id="0af2" class="pw-post-body-paragraph mn mo jb lo b lp na kc mp lr nb kf mq kz nc ms mt ld nd mv mw lh ne my mz lw ij bi translated">对容器应用程序的更改属于<strong class="lo jc">应用程序/修订范围</strong>更改。</p><ul class=""><li id="fa52" class="lm ln jb lo b lp na lr nb kz oi ld oj lh ok lw lx ly lz ma bi translated"><strong class="lo jc">版本-范围</strong>:变更仅影响特定版本，通过以下方式触发:<br/> —容器配置和图像变更<br/> —版本后缀<br/> —容器应用的比例规则</li><li id="f944" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated"><strong class="lo jc">应用范围</strong>:应用于所有修订版<strong class="lo jc">但</strong>不创建新修订版的更改，通过以下方式触发:<br/> —秘密值更改(注意:您需要重新启动修订版才能识别更改)<br/> —修订版模式更改<br/> — Dapr设置<br/> —私有容器注册凭证更改<br/> —入口更改，例如:打开/关闭|流量分流规则|标签</li></ul><blockquote class="nf ng nh"><p id="7491" class="mn mo ni lo b lp na kc mp lr nb kf mq nj nc ms mt nk nd mv mw nl ne my mz lw ij bi translated">注意:当对<strong class="lo jc">修订范围</strong>进行更改时，会自动创建一个新的修订。您只能通过<strong class="lo jc">应用范围</strong>变更来影响修订，因为修订是不可变的，这些变更将被全局应用。</p></blockquote><h2 id="d314" class="kq kr jb bd ks kt ku dn kv kw kx dp ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">修订标签</h2><p id="d2f4" class="pw-post-body-paragraph mn mo jb lo b lp lq kc mp lr ls kf mq kz mr ms mt ld mu mv mw lh mx my mz lw ij bi translated">使用容器应用程序，您可以在应用程序的多个版本之间分割%的入站HTTP流量，但是如果您想要创建一个版本，并为某些测试用户提供特定的URL，会发生什么情况呢？这就是标签的用武之地，它们是将外部流量导向特定版本的手段。要使用标签在版本之间切换流量，您需要将版本模式设置为多版本，并根据目标版本更新标签。</p><p id="c623" class="pw-post-body-paragraph mn mo jb lo b lp na kc mp lr nb kf mq kz nc ms mt ld nd mv mw lh ne my mz lw ij bi translated">这里的一个例子是一个修订模式设置为multiple的容器应用程序，其中<em class="ni"> revision-3 </em>有一个分配给<em class="ni">测试用户</em>的标签。带有标签的修订版的URL将是:</p><figure class="ny nz oa ob gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi os"><img src="../Images/7b3f54d8da35da89ab1bc5f34804a408.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vJL4k6pggM4udBjvXVRsVA.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">插图:使用标签的修订示例</figcaption></figure><pre class="ny nz oa ob gt ot ou ov ow aw ox bi"><span id="6f00" class="kq kr jb ou b gy oy oz l pa pb"><a class="ae mb" href="https://capp-blog-eu-west---test-users.greenplant-a864fe65.westeurope.azurecontainerapps.io/" rel="noopener ugc nofollow" target="_blank">https://capp-blog-eu-west---test-users.greenplant-a864fe65.westeurope.azurecontainerapps.io/</a></span></pre><p id="1db6" class="pw-post-body-paragraph mn mo jb lo b lp na kc mp lr nb kf mq kz nc ms mt ld nd mv mw lh ne my mz lw ij bi translated">这很有用，因为当您将标签移动到另一个版本时，URL将保持不变。</p><blockquote class="nf ng nh"><p id="d211" class="mn mo ni lo b lp na kc mp lr nb kf mq nj nc ms mt nk nd mv mw nl ne my mz lw ij bi translated">注意:<br/> -你可以选择使用标签，流量分流，或者两者都用。<br/> -一个版本只能应用一个标签。<br/> -流量分割不需要使用标签</p></blockquote><h2 id="5843" class="kq kr jb bd ks kt ku dn kv kw kx dp ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">集装箱</h2><p id="a709" class="pw-post-body-paragraph mn mo jb lo b lp lq kc mp lr ls kf mq kz mr ms mt ld mu mv mw lh mx my mz lw ij bi translated">Azure Container Apps为我们管理Kubernetes，并负责编排。如前所述，您可以在单个容器应用程序中以sidecar模式运行单个容器或多个容器。</p><p id="873e" class="pw-post-body-paragraph mn mo jb lo b lp na kc mp lr nb kf mq kz nc ms mt ld nd mv mw lh ne my mz lw ij bi translated">可以使用任何公共或私有容器注册表中的容器以及任何基于Linux的x86–64容器映像。</p><p id="7c4d" class="pw-post-body-paragraph mn mo jb lo b lp na kc mp lr nb kf mq kz nc ms mt ld nd mv mw lh ne my mz lw ij bi translated">配置容器应用程序时，您需要指定容器注册表、资源(vCPU/RAM)、任何卷挂载和容器映像名称，并且您可以指定健康探测器。</p><p id="9f82" class="pw-post-body-paragraph mn mo jb lo b lp na kc mp lr nb kf mq kz nc ms mt ld nd mv mw lh ne my mz lw ij bi translated">在本系列的稍后部分，我们将深入探讨健康探针，熟悉Kubernetes的人会认识到这3:</p><ul class=""><li id="5558" class="lm ln jb lo b lp na lr nb kz oi ld oj lh ok lw lx ly lz ma bi translated">活性</li><li id="eb1b" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated">准备就绪</li><li id="6fd8" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated">启动</li></ul><p id="ca41" class="pw-post-body-paragraph mn mo jb lo b lp na kc mp lr nb kf mq kz nc ms mt ld nd mv mw lh ne my mz lw ij bi translated">容器应用支持托管身份，稍后我们将看到如何在Azure Container Registry和容器应用之间以及容器应用和Azure应用配置之间设置托管身份。</p><p id="d831" class="pw-post-body-paragraph mn mo jb lo b lp na kc mp lr nb kf mq kz nc ms mt ld nd mv mw lh ne my mz lw ij bi translated">重要的是要注意，如果你的应用程序试图运行一个需要root的进程，那么在容器内部运行的应用程序将抛出一个运行时错误，并且只支持基于Linux的容器映像。</p><h2 id="5693" class="kq kr jb bd ks kt ku dn kv kw kx dp ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">应用程序生命周期</h2><p id="23ed" class="pw-post-body-paragraph mn mo jb lo b lp lq kc mp lr ls kf mq kz mr ms mt ld mu mv mw lh mx my mz lw ij bi translated">容器应用程序有4种生命周期状态:部署、更新、停用和关闭。</p><ul class=""><li id="f516" class="lm ln jb lo b lp na lr nb kz oi ld oj lh ok lw lx ly lz ma bi translated">第一次部署时，会自动<em class="ni">创建一个新版本</em>并设置为活动状态。</li><li id="1c1b" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated">当一个容器应用程序被<em class="ni">更新</em>时，一个新的版本被创建。</li><li id="c9f3" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated">您可以<em class="ni">取消激活</em>一个修订或选择自动取消激活旧修订</li><li id="195d" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated"><em class="ni">关闭</em>发生在:应用扩展、被删除或被停用</li></ul></div><div class="ab cl nm nn hu no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ij ik il im in"><h1 id="8c01" class="mc kr jb bd ks md nt mf kv mg nu mi ky kh nv ki lc kk nw kl lg kn nx ko lk mm bi translated">定价</h1><p id="4b0c" class="pw-post-body-paragraph mn mo jb lo b lp lq kc mp lr ls kf mq kz mr ms mt ld mu mv mw lh mx my mz lw ij bi translated">计费分为两种类型的费用:</p><ul class=""><li id="d176" class="lm ln jb lo b lp na lr nb kz oi ld oj lh ok lw lx ly lz ma bi translated"><strong class="lo jc">资源消耗</strong> : <br/> —分配的vCPU/RAM按每秒计费</li><li id="b90c" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated"><strong class="lo jc"> HTTP请求</strong> : <br/> —您的应用程序收到的HTTP请求的数量。</li></ul><p id="f5f6" class="pw-post-body-paragraph mn mo jb lo b lp na kc mp lr nb kf mq kz nc ms mt ld nd mv mw lh ne my mz lw ij bi translated">在撰写本文时，您确实可以从每个月的订阅中获得一些免费内容:</p><ul class=""><li id="49b6" class="lm ln jb lo b lp na lr nb kz oi ld oj lh ok lw lx ly lz ma bi translated">第一个180，000 vCPU秒</li><li id="8660" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated">最初的360，000千兆秒</li><li id="9521" class="lm ln jb lo b lp ol lr om kz on ld oo lh op lw lx ly lz ma bi translated">前200万个HTTP请求</li></ul><p id="1fb9" class="pw-post-body-paragraph mn mo jb lo b lp na kc mp lr nb kf mq kz nc ms mt ld nd mv mw lh ne my mz lw ij bi translated">如果您的容器应用程序没有运行副本，则不会产生消费费用。但是，当您运行副本和修订版时，它们将按有效费率计费。微软确实指出，副本可以进入空闲状态，然后以较低的费率计费。</p><p id="5076" class="pw-post-body-paragraph mn mo jb lo b lp na kc mp lr nb kf mq kz nc ms mt ld nd mv mw lh ne my mz lw ij bi translated">除了资源消耗之外，还将根据收到的HTTP请求向您收取请求费用。值得指出的是，在撰写本文时，每个日历月的前200万次订阅请求是免费的。</p></div><div class="ab cl nm nn hu no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ij ik il im in"><h1 id="973b" class="mc kr jb bd ks md nt mf kv mg nu mi ky kh nv ki lc kk nw kl lg kn nx ko lk mm bi translated">摘要</h1><p id="9f6c" class="pw-post-body-paragraph mn mo jb lo b lp lq kc mp lr ls kf mq kz mr ms mt ld mu mv mw lh mx my mz lw ij bi translated">Kubernetes有一个陡峭的学习曲线，Azure Container应用程序使开发人员更容易利用这些功能，而不必预先投入成本和时间来开始使用Kubernetes或AKS。这是托管您的微服务并让您的团队专注于更快交付客户价值的绝佳模式。</p><p id="4668" class="pw-post-body-paragraph mn mo jb lo b lp na kc mp lr nb kf mq kz nc ms mt ld nd mv mw lh ne my mz lw ij bi translated">我们的调查将在下一节<em class="ni">terra form简介</em>中继续</p><figure class="ny nz oa ob gt is"><div class="bz fp l di"><div class="oc od l"/></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">Gif:大侦探皮卡丘</figcaption></figure></div></div>    
</body>
</html>