<html>
<head>
<title>How to map PostgreSQL ARRAY type to List using JPA and EclipseLink</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用JPA和EclipseLink将PostgreSQL数组类型映射到列表</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-map-postgresql-array-type-to-list-using-jpa-and-eclipselink-b4e25ca13490?source=collection_archive---------0-----------------------#2020-06-07">https://itnext.io/how-to-map-postgresql-array-type-to-list-using-jpa-and-eclipselink-b4e25ca13490?source=collection_archive---------0-----------------------#2020-06-07</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><figure class="gm go js jt ju jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj jr"><img src="../Images/154b5798221a43a9ffa1ee9a2516bb92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3gqlYHrmDZH_d4BSMYWxoA.png"/></div></div></figure><p id="5757" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在PostgreSQL数据库中，可以将表中的列作为任意类型(内置或用户定义的基本类型、枚举类型、复合类型、范围类型或域)的可变长度多维<a class="ae la" href="https://www.postgresql.org/docs/current/arrays.html" rel="noopener ugc nofollow" target="_blank">数组</a>:</p><pre class="lb lc ld le gu lf lg lh li aw lj bi"><span id="d909" class="lk ll iu lg b gz lm ln l lo lp">CREATE TABLE product<br/>(<br/>  id        bigint,<br/>  images    text[]<br/>)</span></pre><p id="7cfc" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这个功能类似于<a class="ae la" href="https://docs.oracle.com/cd/B28359_01/appdev.111/b28370/collections.htm#CHDEIJHD" rel="noopener ugc nofollow" target="_blank">甲骨文</a> <code class="fe lq lr ls lg b"><a class="ae la" href="https://docs.oracle.com/cd/B28359_01/appdev.111/b28370/collections.htm#CHDEIJHD" rel="noopener ugc nofollow" target="_blank">VARRAY</a></code> <a class="ae la" href="https://docs.oracle.com/cd/B28359_01/appdev.111/b28370/collections.htm#CHDEIJHD" rel="noopener ugc nofollow" target="_blank">类型</a>。您可以按以下格式将数据插入到该类型的列中:</p><pre class="lb lc ld le gu lf lg lh li aw lj bi"><span id="91f0" class="lk ll iu lg b gz lm ln l lo lp">INSERT INTO product(id, images)<br/>   VALUES (1, '{"url1", "url2", "url3"}');</span></pre><p id="d952" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">您可以使用PostgreSQL数组类型可用的<a class="ae la" href="https://www.postgresql.org/docs/9.1/functions-array.html#ARRAY-OPERATORS-TABLE" rel="noopener ugc nofollow" target="_blank">函数和操作符</a>来获取数据:</p><pre class="lb lc ld le gu lf lg lh li aw lj bi"><span id="0988" class="lk ll iu lg b gz lm ln l lo lp">SELECT * FROM PRODUCT WHERE images @&gt; ARRAY['url2']</span></pre><p id="d1a0" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">您必须使用针对数组数据类型的JDBC API的<a class="ae la" href="https://jdbc.postgresql.org/documentation/head/arrays.html" rel="noopener ugc nofollow" target="_blank"> PostgreSQL扩展</a>,以便在PostgreSQL的where子句中将数组用作列类型、函数参数和标准。你可以在这里阅读关于PostgreSQL数据类型<a class="ae la" href="https://www.postgresql.org/docs/current/arrays.html" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="2dcf" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">不幸的是，JPA不支持映射数组数据类型，我们有三种选择:</p><ul class=""><li id="8c74" class="lt lu iu ke b kf kg kj kk kn lv kr lw kv lx kz ly lz ma mb bi translated">在JPA中使用一种替代方法来建模一对多关系(而不是数组数据类型),如<a class="ae la" href="https://en.wikibooks.org/wiki/Java_Persistence/ElementCollection" rel="noopener ugc nofollow" target="_blank"> ElementCollection </a>或<a class="ae la" href="https://en.wikibooks.org/wiki/Java_Persistence/OneToMany" rel="noopener ugc nofollow" target="_blank"> OneToMany </a>或…</li><li id="187b" class="lt lu iu ke b kf mc kj md kn me kr mf kv mg kz ly lz ma mb bi translated">对数组数据类型使用原生查询和对JDBC API的PostgreSQL扩展。</li><li id="2ec4" class="lt lu iu ke b kf mc kj md kn me kr mf kv mg kz ly lz ma mb bi translated">对数组数据类型使用EclipseLink或Hibernate特定的特性。</li></ul><p id="1dca" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">EclipseLink和hibernate支持以不同的方式映射该数据类型。在下面的链接中，您可以找到一篇关于如何使用Hibernate Types项目在PostgreSQL中映射数组数据类型的好文章。</p><div class="mh mi gq gs mj mk"><a href="https://vladmihalcea.com/postgresql-array-java-list/" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab fp"><div class="mm ab mn cl cj mo"><h2 class="bd iv gz z fq mp fs ft mq fv fx it bi translated">如何用JPA和Hibernate将PostgreSQL数组映射到Java列表</h2><div class="mr l"><h3 class="bd b gz z fq mp fs ft mq fv fx dk translated">在本文中，我将向您展示如何映射PostgreSQL数组列类型(例如，text、int、double、enum、date…</h3></div><div class="ms l"><p class="bd b dl z fq mp fs ft mq fv fx dk translated">vladmihalcea.com</p></div></div><div class="mt l"><div class="mu l mv mw mx mt my ka mk"/></div></div></a></div><h2 id="2208" class="lk ll iu bd mz na nb dn nc nd ne dp nf kn ng nh ni kr nj nk nl kv nm nn no np bi translated">使用@Struct和@Array在EclipseLink中映射数组数据类型</h2><p id="249d" class="pw-post-body-paragraph kc kd iu ke b kf nq kh ki kj nr kl km kn ns kp kq kr nt kt ku kv nu kx ky kz in bi translated">就像Hibernate一样，在EclipseLink中有一个映射数组数据类型的特定方法。为此，您必须使用<code class="fe lq lr ls lg b"><a class="ae la" href="https://www.eclipse.org/eclipselink/documentation/2.4/jpa/extensions/a_struct.htm" rel="noopener ugc nofollow" target="_blank">@Struct</a></code>引入一个类来映射到数据库<code class="fe lq lr ls lg b">Struct</code>类型，并在映射到数组数据类型的集合属性上使用<code class="fe lq lr ls lg b"><a class="ae la" href="https://www.eclipse.org/eclipselink/documentation/2.4/jpa/extensions/a_array.htm" rel="noopener ugc nofollow" target="_blank">@Array</a></code>:</p><pre class="lb lc ld le gu lf lg lh li aw lj bi"><span id="30bf" class="lk ll iu lg b gz lm ln l lo lp">@Entity<br/>@Struct<em class="nv">(</em>name = "images"<em class="nv">)<br/></em>public class Product implements Serializable <em class="nv">{<br/><br/>    </em>@Id<br/><em class="nv">    @GeneratedValue(strategy = GenerationType.IDENTITY)<br/>    </em>private long id;<br/><br/>    @Column<em class="nv">(</em>columnDefinition="TEXT[]"<em class="nv">)<br/>    </em>@Array<em class="nv">(</em>databaseType="varchar"<em class="nv">)<br/>    </em>private List<em class="nv">&lt;</em>String<em class="nv">&gt; </em>images;<br/>.<br/>.<br/>.</span></pre><p id="1fd6" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">您还可以使用<code class="fe lq lr ls lg b"><a class="ae la" href="https://www.eclipse.org/eclipselink/documentation/2.4/jpa/extensions/a_struct.htm" rel="noopener ugc nofollow" target="_blank">@Struct</a></code>来映射Oracle <code class="fe lq lr ls lg b">VARRAY</code>数据类型。</p><p id="b6bd" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">我不得不提到，你应该使用<code class="fe lq lr ls lg b">@Column</code>和<code class="fe lq lr ls lg b">@Array</code>属性来引入你的数组的类型。</p><p id="1578" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">现在，您可以使用EclipseLink轻松存储您的图像阵列:</p><pre class="lb lc ld le gu lf lg lh li aw lj bi"><span id="0bd3" class="lk ll iu lg b gz lm ln l lo lp">Product product1 = new Product<em class="nv">()</em>;<br/>product1.setImages<em class="nv">(</em>Arrays.<em class="nv">asList(</em>"url1", "url2", "url3"<em class="nv">))</em>;</span><span id="b5d0" class="lk ll iu lg b gz nw ln l lo lp">em.persist<em class="nv">(</em>product1<em class="nv">)</em>;</span></pre><p id="8fec" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">您还可以通过使用JPA原生查询，使用PostgreSQL数组类型的特定<a class="ae la" href="https://www.postgresql.org/docs/9.1/functions-array.html#ARRAY-OPERATORS-TABLE" rel="noopener ugc nofollow" target="_blank">函数和操作符</a>来获取数据:</p><pre class="lb lc ld le gu lf lg lh li aw lj bi"><span id="b259" class="lk ll iu lg b gz lm ln l lo lp">List<em class="nv">&lt;</em>String<em class="nv">&gt; </em>images = Arrays.<em class="nv">asList(</em>"url2"<em class="nv">)</em>;<br/>String imagesStr = images.stream<em class="nv">()</em>.collect<em class="nv">(joining(</em>",", "{", "}"<em class="nv">))</em>;<br/><br/>Query query = em.createNativeQuery<em class="nv">(<br/>        </em>"SELECT * FROM PRODUCT WHERE images @&gt; CAST(? AS text[])",<br/>        Product.class<br/><em class="nv">)</em>.setParameter<em class="nv">(</em>1, imagesStr<em class="nv">)</em>;<br/><br/>List<em class="nv">&lt;</em>Product<em class="nv">&gt; </em>result = query.getResultList<em class="nv">()</em>;</span></pre></div></div>    
</body>
</html>