<html>
<head>
<title>Building a space shooter game with HTML5 canvas &amp; Typescript — Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用HTML5 canvas &amp; Typescript构建一个太空射击游戏—第3部分</h1>
<blockquote>原文：<a href="https://itnext.io/building-a-space-shooter-game-with-html5-canvas-typescript-part-3-f1b2808e85bd?source=collection_archive---------2-----------------------#2020-12-14">https://itnext.io/building-a-space-shooter-game-with-html5-canvas-typescript-part-3-f1b2808e85bd?source=collection_archive---------2-----------------------#2020-12-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="8c58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文是由以下作者撰写的系列文章的第三部分:</p><p id="4b54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://andreteixeira.medium.com/building-a-space-shooter-game-with-html5-canvas-typescript-part-1-20663025c7f5" rel="noopener">第一部分——画星星</a>⭐<br/>T3】第二部分——画一艘宇宙飞船并让它旋转🚀<br/> <a class="ae kl" href="https://andreteixeira.medium.com/building-a-space-shooter-game-with-html5-canvas-typescript-part-3-f1b2808e85bd" rel="noopener">第3部分——让飞船移动并拍摄</a>💨<br/>第4部分—为移动🕹️制作操纵杆📱<br/>第5部分——敌舰和碰撞💥</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><p id="16b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在实现了本系列第1部分和第2部分中描述的步骤之后，我们有了一个星空和一个可以绕着中心旋转的宇宙飞船。依我看，这个游戏需要更多的动作。因此，第三部分将是关于让它飞来飞去和拍摄。</p><h1 id="e215" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">加速度和运动</h1><p id="47ef" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">这艘船有一个后置发动机:因此，推进力使它向机头方向移动。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi lw"><img src="../Images/098f5af3ba044f37a0e94c3ab067e54a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4wLzXodPsiu3dsGL60afew.png"/></div></div></figure><p id="0881" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设游戏循环每秒调用draw方法约60次，我们可以考虑计算一个法向量，并在每个循环中将船向它移动1步。</p><p id="3886" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下图显示了一个draw方法调用的快照。让我们更深入地了解一下这个单独的执行是如何进行计算的:</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mi"><img src="../Images/eb2bc269f7d86c6732908b97c9365a66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i8j2rNDTILvGgU_ha5Z6Wg.png"/></div></div></figure><h2 id="3a2f" class="mj ku iq bd kv mk ml dn kz mm mn dp ld jy mo mp lh kc mq mr ll kg ms mt lp mu bi translated">TL/DR</h2><p id="8f42" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">此时，飞船更新函数已经知道位置x，y，以及每次执行时飞船的旋转。它可以在图表中表示为:</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/ef0acb7fe238cb10d548068a1913a017.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*_P02nKIVVrZSsHraFZBHcA.png"/></div></figure><p id="3718" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在可以定义一个常数来表示每次迭代中飞船运动的长度。这个常数，上面用蓝色向量表示，是这个例子的三角形的假设(我将为这个研究选择随机值18.0277)。</p><p id="916c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">知道我们可以使用<strong class="jp ir">毕达哥拉斯定理</strong>得到p2的x和y值。存在:</p><pre class="lx ly lz ma gt mw mx my mz aw na bi"><span id="db7d" class="mj ku iq mx b gy nb nc l nd ne">sin = opposite leg / hypothenuse;<br/>sen = adjacent leg / hypothenuse;</span></pre><p id="3476" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以肯定地说:</p><pre class="lx ly lz ma gt mw mx my mz aw na bi"><span id="c5f8" class="mj ku iq mx b gy nb nc l nd ne">x = sin(33<strong class="mx ir">) * </strong>hypothenuse;<strong class="mx ir"><br/></strong>y = cos(33<strong class="mx ir">) * </strong>hypothenuse;</span></pre><p id="307c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者，使用JavaScript的通用方法:</p><pre class="lx ly lz ma gt mw mx my mz aw na bi"><span id="9b49" class="mj ku iq mx b gy nb nc l nd ne">const x = Math.sin(this.rotation<strong class="mx ir">) * </strong>this.speed<strong class="mx ir">;<br/></strong>const y = Math.cos(this.rotation<strong class="mx ir">) * </strong>this.speed<strong class="mx ir">;</strong></span></pre><h1 id="3d60" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">让它飞起来</h1><p id="f916" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">以下是使其工作所需的属性:</p><ul class=""><li id="8ec3" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated"><strong class="jp ir">速度</strong>——代表飞船在平面上位移的长度；</li><li id="eb8b" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><strong class="jp ir">加速度</strong>——合成矢量；</li><li id="52ec" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><strong class="jp ir">减速</strong>——代表松开油门后减少飞船运动的摩擦力。</li></ul><h2 id="8d2c" class="mj ku iq bd kv mk ml dn kz mm mn dp ld jy mo mp lh kc mq mr ll kg ms mt lp mu bi translated">变量</h2><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h2 id="6a14" class="mj ku iq bd kv mk ml dn kz mm mn dp ld jy mo mp lh kc mq mr ll kg ms mt lp mu bi translated">键盘监听器</h2><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h2 id="3eee" class="mj ku iq bd kv mk ml dn kz mm mn dp ld jy mo mp lh kc mq mr ll kg ms mt lp mu bi translated">运动</h2><p id="2aad" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">最后，在飞船更新方法中，我们通过将新的加速位置添加到当前飞船位置来应用更改值。我们可以通过向spaceship update方法添加以下块来实现:</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="f483" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">矢量类也需要加法和减法运算，将加速度矢量与当前位置矢量相加，格式如下:</p><pre class="lx ly lz ma gt mw mx my mz aw na bi"><span id="399a" class="mj ku iq mx b gy nb nc l nd ne">public add(vector: Vector): void {<br/>    this.x += vector.x;<br/>    this.y += vector.y;<br/>}</span><span id="cb55" class="mj ku iq mx b gy nv nc l nd ne">public subtract(vector: Vector): void {<br/>    this.x -= vector.x;<br/>    this.y -= vector.y;<br/>}</span></pre><h2 id="b937" class="mj ku iq bd kv mk ml dn kz mm mn dp ld jy mo mp lh kc mq mr ll kg ms mt lp mu bi translated">重要细节</h2><p id="7a2f" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">由于画布平面原点(0，0)位于左上方，我们需要通过将Y轴乘以-1来反转Y轴计算方向。</p><h2 id="5585" class="mj ku iq bd kv mk ml dn kz mm mn dp ld jy mo mp lh kc mq mr ll kg ms mt lp mu bi translated">部分演示</h2><p id="8836" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">你可以在这里看到一个工作演示:<br/><a class="ae kl" href="http://spaceship-part3-partial.s3-website.eu-central-1.amazonaws.com/" rel="noopener ugc nofollow" target="_blank">http://space ship-part 3-partial . S3-website . eu-central-1 . Amazon AWS . com/</a></p><h1 id="e7ca" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">射击</h1><p id="243f" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">开火背后的理论并没有太大的不同。一旦用户点击触发器(空格键)，一个抛射体将被绘制在船的顶部/中心，并遵循给定的绘制功能执行的法向矢量投影。</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="f5fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">射击的想法与移动是一样的，不同之处在于当创建一个子弹实例时，它会获得给定时刻的飞船角度。相比之下，飞船移动方法为每个绘图获取最新的方向。</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="8faa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为最后一步，需要绘制和更新游戏类项目符号。我们需要一个项目符号列表，它将在每次游戏抽签时显示在更新的位置上(听起来像我们在第一部分中对星星所做的那样，对吗？).</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h2 id="fb52" class="mj ku iq bd kv mk ml dn kz mm mn dp ld jy mo mp lh kc mq mr ll kg ms mt lp mu bi translated"><strong class="ak">此阶段之前的代码标记在:</strong></h2><p id="4a2a" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/ateixeira/spaceship-game/releases/tag/part3_final" rel="noopener ugc nofollow" target="_blank">https://github . com/ateixeira/spacex-game/releases/tag/part 3 _ final</a></p><h2 id="e4b0" class="mj ku iq bd kv mk ml dn kz mm mn dp ld jy mo mp lh kc mq mr ll kg ms mt lp mu bi translated">演示到这一部分:</h2><p id="0823" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated"><a class="ae kl" href="http://spaceship-part3-final.s3-website-eu-west-1.amazonaws.com/" rel="noopener ugc nofollow" target="_blank">http://space ship-part 3-final . S3-website-eu-west-1 . Amazon AWS . com/</a></p></div></div>    
</body>
</html>