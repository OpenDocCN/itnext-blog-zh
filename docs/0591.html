<html>
<head>
<title>Javascript ES8 asynchronous await service + ES6 Modules</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Javascript ES8异步等待服务+ ES6模块</h1>
<blockquote>原文：<a href="https://itnext.io/javascript-es8-asynchronous-await-service-es6-modules-bcb842340c0e?source=collection_archive---------2-----------------------#2018-04-06">https://itnext.io/javascript-es8-asynchronous-await-service-es6-modules-bcb842340c0e?source=collection_archive---------2-----------------------#2018-04-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/92b6724968b7fd7ee0bdec8786c19768.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xcnJE5kn0pCdZNpFQT86tQ.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="a496" class="pw-subtitle-paragraph jy ja jb bd b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dk translated">ES8从不同模块异步获取。</h2></div><blockquote class="kq kr ks"><p id="e0e2" class="kt ku kv kw b kx ky kc kz la lb kf lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><a class="ae lq" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fitnext.io%2Fjavascript-es8-asynchronous-await-service-es6-modules-bcb842340c0e%3Futm_source%3Dmedium_sharelink%26utm_medium%3Dsocial%26utm_campaign%3Dbuffer" rel="noopener ugc nofollow" target="_blank">点击这里在LinkedIn上分享这篇文章</a></p></blockquote></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><p id="f9e3" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc ly le lf lg lz li lj lk ma lm ln lo lp ij bi mb translated"><span class="l mc md me bm mf mg mh mi mj di">我</span>推荐熟悉最新版本的ECMAScript或者“ECMA-262”。真正对我有帮助的好资源可以在这里找到<a class="ae lq" href="https://es6.io/" rel="noopener ugc nofollow" target="_blank">。Jeffery Way有一个关于ES2015+的优秀系列，适合初学者</a><a class="ae lq" href="https://laracasts.com/series/es6-cliffsnotes" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="d2fe" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc ly le lf lg lz li lj lk ma lm ln lo lp ij bi translated">假设我们有一个ES6类文件，包含所有需要从不同来源获取数据的方法。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="4eac" class="mt mu jb mp b gy mv mw l mx my">(function () {<br/>   'use strict';<br/>}());</span><span id="dc49" class="mt mu jb mp b gy mz mw l mx my">export default class someClass {<br/>    constructor() {<br/>        this.users = '<a class="ae lq" href="https://jsonplaceholder.typicode.com/users" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/users</a>';<br/>        this.posts ='<a class="ae lq" href="https://jsonplaceholder.typicode.com/posts/" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/posts</a>';</span><span id="d9c7" class="mt mu jb mp b gy mz mw l mx my">        this.getUsers();<br/>        this.getPosts();<br/>    }</span><span id="1bb7" class="mt mu jb mp b gy mz mw l mx my">    getUsers() {<br/>        fetch(this.posts)<br/>        .then(response =&gt; response.json())<br/>        .then(data =&gt; console.log(data))<br/>        .catch(error =&gt; console.log('Error:', error));<br/>    }</span><span id="0568" class="mt mu jb mp b gy mz mw l mx my">    getPosts() {<br/>        fetch(this.posts)<br/>        .then(response =&gt; response.json())<br/>        .then(data =&gt; console.log(data))<br/>        .catch(error =&gt; console.log('Error:', error));<br/>    }<br/>}</span></pre><p id="0c0d" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc ly le lf lg lz li lj lk ma lm ln lo lp ij bi translated">正如你在上面看到的，getUsers()和getPosts()实际上包含了相同的获取请求逻辑。我们在这里复制代码，这可以包装在一个ES8糖异步等待功能。让我们首先将类代码改为更简洁的代码:-</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="c524" class="mt mu jb mp b gy mv mw l mx my">(function () {<br/>   'use strict';<br/>}());</span><span id="bfd7" class="mt mu jb mp b gy mz mw l mx my">import { getData } from './GetDataHelper.js';</span><span id="9b4b" class="mt mu jb mp b gy mz mw l mx my">export default class someClass {<br/>    constructor() {<br/>        this.users = '<a class="ae lq" href="https://jsonplaceholder.typicode.com/users" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/users</a>';<br/>        this.posts ='<a class="ae lq" href="https://jsonplaceholder.typicode.com/posts/" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/posts</a>';</span><span id="46db" class="mt mu jb mp b gy mz mw l mx my">        this.getUsers();<br/>        this.getPosts();<br/>    }</span><span id="1833" class="mt mu jb mp b gy mz mw l mx my">    getUsers() {<br/>        getData(this.users);<br/>    }</span><span id="ee65" class="mt mu jb mp b gy mz mw l mx my">    getPosts() {<br/>        getData(this.posts);<br/>    }<br/>}</span></pre><p id="0362" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc ly le lf lg lz li lj lk ma lm ln lo lp ij bi translated">我们现在可以创建一个新文件GetDataHelper.js:-</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="53ad" class="mt mu jb mp b gy mv mw l mx my">(function () {<br/>   'use strict';<br/>}());</span><span id="021a" class="mt mu jb mp b gy mz mw l mx my">// async function<br/>export async function getData(url) {<br/>    return await (await(fetch(url))).json();<br/>}</span></pre><p id="6ab2" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc ly le lf lg lz li lj lk ma lm ln lo lp ij bi translated">总之，我们现在将getData作为一个模块导入到类中。这个模块可以包含多个方法，如果我们想在类中使用更多的方法，我们可以将导入改为:-</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="22c3" class="mt mu jb mp b gy mv mw l mx my">import { getData, someFunc, anotherFunc } from './GetDataHelper.js';</span></pre><p id="b454" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc ly le lf lg lz li lj lk ma lm ln lo lp ij bi translated">或者全部使用星号。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="bc8b" class="mt mu jb mp b gy mv mw l mx my">import { * } from './GetDataHelper.js';</span></pre><p id="8b25" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc ly le lf lg lz li lj lk ma lm ln lo lp ij bi translated">我们正在等待在新模块中使用我们新的异步方法获取JSON的承诺。如果你需要的话，这可以变得更复杂，但是正如你所看到的，现在它非常简洁明了。所有需要的是使用转换器如babel来转换ES2015+代码。我需要使用ES8异步功能和HTML5的本地存储功能的更复杂的例子可以在我最近的作品中看到。</p><p id="61b8" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc ly le lf lg lz li lj lk ma lm ln lo lp ij bi translated">类文件这里是<a class="ae lq" href="http://here" rel="noopener ugc nofollow" target="_blank">这里是</a>。</p><p id="2880" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc ly le lf lg lz li lj lk ma lm ln lo lp ij bi translated">缓存服务(HTML5 —本地存储在这里是<a class="ae lq" href="https://github.com/maxsilvauk/js-aircraft-seats-selection-widget/blob/master/src/assets/js/CacheServiceHelper.js" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="2f05" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc ly le lf lg lz li lj lk ma lm ln lo lp ij bi translated">异步请求服务(getData helper)在这里是<a class="ae lq" href="https://github.com/maxsilvauk/js-aircraft-seats-selection-widget/blob/master/src/assets/js/RequestServiceHelper.js" rel="noopener ugc nofollow" target="_blank"/>。</p></div></div>    
</body>
</html>