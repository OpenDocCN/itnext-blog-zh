<html>
<head>
<title>gRPC APIs with Nameko</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带Nameko的gRPC APIs</h1>
<blockquote>原文：<a href="https://itnext.io/grpc-apis-with-nameko-11bbd9492225?source=collection_archive---------4-----------------------#2019-02-28">https://itnext.io/grpc-apis-with-nameko-11bbd9492225?source=collection_archive---------4-----------------------#2019-02-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/dff51bcb19f5f5b01d040c57d05f5f30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CRsbHnx5vmZ1PwySOOM3tg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Nameko已经准备好和院子里的孩子们一起玩了。</figcaption></figure><div class=""/><p id="0391" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">gRPC 是快速跨平台RPC通信的伟大工具。由于支持多种语言，它降低了不同服务实现之间的障碍。</p><p id="80ee" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Nameko是一个用于构建Python微服务的健壮框架。Nameko-gRPC 扩展库刚刚登陆，在本文中，我将向您展示如何通过Nameko轻松利用gRPC的强大功能。</p><blockquote class="lb lc ld"><p id="2dc7" class="kc kd le ke b kf kg kh ki kj kk kl km lf ko kp kq lg ks kt ku lh kw kx ky kz ij bi translated"><strong class="ke jg">https://github.com/nameko/nameko-examples-grpc</strong>:此处直接进入Nameko gRPC的实现示例:<a class="ae la" href="https://github.com/kooba/nameko-examples-grpc" rel="noopener ugc nofollow" target="_blank">这里是</a></p></blockquote><p id="e1ad" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">传统上，要与Nameko服务通信，您可以选择使用HTTP REST APIs或实现Nameko自己的RPC over AMQP协议。Nameko的RPC虽然相当简单并且独立于语言，但它不是一个标准，必须为每种语言/平台独立实现。</p><p id="4819" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">新的gRPC扩展为Nameko带来了许多新的机会，其中包括:</p><ul class=""><li id="aa82" class="li lj jf ke b kf kg kj kk kn lk kr ll kv lm kz ln lo lp lq bi translated">公开和使用堆栈中其他服务的API的直接方法。</li><li id="3084" class="li lj jf ke b kf lr kj ls kn lt kr lu kv lv kz ln lo lp lq bi translated">很好地处理了<a class="ae la" href="https://istio.io/" rel="noopener ugc nofollow" target="_blank"> Istio </a>类型的服务网格部署。</li><li id="29d3" class="li lj jf ke b kf lr kj ls kn lt kr lu kv lv kz ln lo lp lq bi translated">能够为您的服务编排金丝雀部署。</li></ul><h2 id="3907" class="lw lx jf bd ly lz ma dn mb mc md dp me kn mf mg mh kr mi mj mk kv ml mm mn mo bi translated">使用Nameko-gRPC</h2><p id="ac0b" class="pw-post-body-paragraph kc kd jf ke b kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv mt kx ky kz ij bi translated">与其他Nameko扩展一样，Nameko-gRPC库为我们提供了入口点和客户端代理实现。</p><p id="9b86" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们从定义我们的<a class="ae la" href="https://developers.google.com/protocol-buffers/docs/proto3" rel="noopener ugc nofollow" target="_blank"> <strong class="ke jg"> Protobuf </strong> </a>服务定义开始:</p><figure class="mu mv mw mx gt is"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="51d0" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">要公开上面定义的gRPC入口点，只需在方法实现中添加<code class="fe na nb nc nd b">@grpc</code> decorator:</p><figure class="mu mv mw mx gt is"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="cb86" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您的方法名对应于protobuf定义中描述的服务方法名，在我们的例子中是<code class="fe na nb nc nd b">get_product</code>。它接受两个参数:</p><ul class=""><li id="5f31" class="li lj jf ke b kf kg kj kk kn lk kr ll kv lm kz ln lo lp lq bi translated"><code class="fe na nb nc nd b">request</code>在我们的例子中是gRPC请求消息类型的一个实例<code class="fe na nb nc nd b">GetProduct</code></li><li id="6d3b" class="li lj jf ke b kf lr kj ls kn lt kr lu kv lv kz ln lo lp lq bi translated"><code class="fe na nb nc nd b">context</code>允许您访问gRPC和Nameko请求元数据</li></ul><p id="6d44" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">要使用gRPC服务，您可以使用<strong class="ke jg"> GrpcProxy </strong>:</p><figure class="mu mv mw mx gt is"><div class="bz fp l di"><div class="my mz l"/></div></figure><h2 id="c3d0" class="lw lx jf bd ly lz ma dn mb mc md dp me kn mf mg mh kr mi mj mk kv ml mm mn mo bi translated">跨平台示例</h2><p id="64cb" class="pw-post-body-paragraph kc kd jf ke b kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv mt kx ky kz ij bi translated">对于这些概念的端到端说明，您可以看看示例存储库【https://github.com/nameko/nameko-examples-grpc<a class="ae la" href="https://github.com/kooba/nameko-examples-grpc" rel="noopener ugc nofollow" target="_blank">T3】，它展示了公开GraphQL API的NodeJS网关服务和公开gRPC APIs的Nameko服务之间的跨平台集成。</a></p><p id="6746" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">示例的高级架构:</p><figure class="mu mv mw mx gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ne"><img src="../Images/e78644ae5848c2ada67f9b7bbbc0720d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wTd_NeQu8efYrphUGYe5MA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">NodeJS服务使用Nameko gRPC API</figcaption></figure><p id="841b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">主要组件有:</p><ul class=""><li id="58f3" class="li lj jf ke b kf kg kj kk kn lk kr ll kv lm kz ln lo lp lq bi translated"><strong class="ke jg">网关:</strong>带有GraphQL API的NodeJS服务。</li><li id="97fc" class="li lj jf ke b kf lr kj ls kn lt kr lu kv lv kz ln lo lp lq bi translated"><strong class="ke jg">订单:</strong>使用gRPC API和PostgreSQL作为数据存储的Python Nameko服务。该服务还将发布<code class="fe na nb nc nd b">order_created</code>事件。</li><li id="1ee9" class="li lj jf ke b kf lr kj ls kn lt kr lu kv lv kz ln lo lp lq bi translated"><strong class="ke jg">产品:</strong>以gRPC API和Redis为数据存储的Python Nameko服务。该服务也将消耗<code class="fe na nb nc nd b">order_created</code>事件。</li></ul><p id="b07a" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">网关节点服务为我们的API公开了简单的GraphQL模式:</p><figure class="mu mv mw mx gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nf"><img src="../Images/2503e5f8144dc02efa13b365a3e7cc55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0f9869aqT8tdUGPL3VXFIQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">网关的GraphQL模式</figcaption></figure><p id="32a9" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">要使用这些示例，请遵循存储库的自述文件中描述的步骤，并启动GraphQL Playground。在那里你可以运行我们可用的查询和突变。</p><figure class="mu mv mw mx gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ng"><img src="../Images/dbc610b6a2feadb49e809fa8d54be37b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YHRutiz3TR1FQba5gsDrSA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">GraphQL游乐场</figcaption></figure><p id="dc61" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们示例中的GraphQL模式解析器使用NodeJS gRPC客户端，这些客户端配置了与Nameko服务本身使用的相同的产品和订单Protobuf服务定义。</p><h2 id="330e" class="lw lx jf bd ly lz ma dn mb mc md dp me kn mf mg mh kr mi mj mk kv ml mm mn mo bi translated">结论</h2><p id="6466" class="pw-post-body-paragraph kc kd jf ke b kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv mt kx ky kz ij bi translated">将Nameko引入您现有的微服务平台从未如此简单。如果您已经在使用gRPC进行服务对服务的通信，Nameko将非常适合。有了Nameko，您的开发人员可以专注于实现应用程序逻辑，同时利用丰富的Python生态系统。</p><p id="288c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">头来举例:<br/>T11】https://github.com/nameko/nameko-examples-grpc</p><p id="2da0" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Checkout Nameko-gRPC实现:<br/><a class="ae la" href="https://github.com/nameko/nameko-grpc" rel="noopener ugc nofollow" target="_blank">https://github.com/nameko/nameko-grpc</a></p><p id="5b24" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">访问Nameko: <br/>网站:<a class="ae la" href="https://www.nameko.io/" rel="noopener ugc nofollow" target="_blank">https://www . Nameko . io</a>T19】论坛:<a class="ae la" href="https://discourse.nameko.io/" rel="noopener ugc nofollow" target="_blank">https://discourse . Nameko . io</a>T22】推特:<a class="ae la" href="https://twitter.com/nameko_python" rel="noopener ugc nofollow" target="_blank">https://twitter.com/nameko_python</a></p></div></div>    
</body>
</html>