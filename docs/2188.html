<html>
<head>
<title>`node-config` made type-safe</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">“节点配置”成为类型安全的</h1>
<blockquote>原文：<a href="https://itnext.io/node-config-made-type-safe-5be0a08ad5ba?source=collection_archive---------6-----------------------#2019-04-13">https://itnext.io/node-config-made-type-safe-5be0a08ad5ba?source=collection_archive---------6-----------------------#2019-04-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e1f707ca97c0f3caaa107fb8e8d3ba5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*evKKhhvR-AGBenDXcOWsjg.jpeg"/></div></div></figure><p id="e867" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">&gt;我现在有了一个闪亮的新博客。阅读这篇文章，了解https://blog.goncharov.page/node-config-made-type-safe的最新动态</p><p id="5913" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://github.com/lorenwest/node-config" rel="noopener ugc nofollow" target="_blank"> node-config </a>多年来一直是Node.js社区的默认配置解决方案。它简单而强大的设计帮助它像病毒一样在多个JS库中传播。然而，这些设计选择并不总是受到新的严格类型儿童的欢迎。比如打字稿。我们如何继续使用我们最喜欢的配置工具，并保持类型安全呢？</p><h1 id="c2d2" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">步骤1:为您的配置创建一个界面</h1><p id="2fa9" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">假设您的项目中有一个<code class="fe ma mb mc md b">config</code>文件夹，在最简单的情况下，其结构如下:</p><ul class=""><li id="ded4" class="me mf iq ka b kb kc kf kg kj mg kn mh kr mi kv mj mk ml mm bi translated"><code class="fe ma mb mc md b">default.ts</code></li><li id="a2cf" class="me mf iq ka b kb mn kf mo kj mp kn mq kr mr kv mj mk ml mm bi translated"><code class="fe ma mb mc md b">production.ts</code></li></ul><blockquote class="ms mt mu"><p id="037c" class="jy jz mv ka b kb kc kd ke kf kg kh ki mw kk kl km mx ko kp kq my ks kt ku kv ij bi translated"><em class="iq">是的，</em><a class="ae kw" href="https://github.com/lorenwest/node-config" rel="noopener ugc nofollow" target="_blank"><em class="iq">node-config</em></a><em class="iq">说出现成的打字稿！</em></p></blockquote><p id="8533" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们考虑一个为应用程序编写配置的例子，它创建了一个只有猫居住的新世界。</p><p id="2a49" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的默认配置如下所示:</p><figure class="mz na nb nc gt jr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="9c9a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的生产配置可能是这样的:</p><figure class="mz na nb nc gt jr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="c9bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">基本上，我们的生产配置总是默认配置的子集。因此，我们可以为默认配置创建一个接口，并将该接口的一部分(<a class="ae kw" href="https://stackoverflow.com/questions/45372227/how-to-implement-typescript-deep-partial-mapped-type-not-breaking-array-properti/49936686#49936686" rel="noopener ugc nofollow" target="_blank"> DeepPartial </a>为真)用于我们的生产配置。</p><p id="b90e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们用界面添加<code class="fe ma mb mc md b">constraint.ts</code>文件:</p><figure class="mz na nb nc gt jr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="ac34" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后我们可以在我们的<code class="fe ma mb mc md b">default.ts</code>中使用它:</p><figure class="mz na nb nc gt jr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="d821" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">而在我们的<code class="fe ma mb mc md b">production.ts</code>:</p><figure class="mz na nb nc gt jr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h1 id="499b" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">步骤2:使<code class="fe ma mb mc md b">config.get</code>成为类型安全的</h1><p id="55cb" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">到目前为止，我们解决了各种配置之间的任何不一致。但是<code class="fe ma mb mc md b">config.get</code>还是返回<code class="fe ma mb mc md b">any</code>。</p><p id="ab73" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了解决这个问题，让我们添加另一个类型化版本的<code class="fe ma mb mc md b">config.get</code>到它的原型中。</p><p id="6575" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">假设您的项目的根目录中有文件夹<code class="fe ma mb mc md b">config</code>，文件夹<code class="fe ma mb mc md b">src</code>中有您的应用程序的代码，让我们在<code class="fe ma mb mc md b">src/config.service.ts</code>创建一个新文件</p><figure class="mz na nb nc gt jr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="71de" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们可以在应用程序的任何地方使用<code class="fe ma mb mc md b">config.getTyped</code>，从<code class="fe ma mb mc md b">src/config.service</code>导入它。</p><blockquote class="ms mt mu"><p id="4724" class="jy jz mv ka b kb kc kd ke kf kg kh ki mw kk kl km mx ko kp kq my ks kt ku kv ij bi translated"><em class="iq">要知道，我们再也做不到</em> <code class="fe ma mb mc md b"><em class="iq">caonfig.getTyped('cat.pawsNum')</em></code> <em class="iq">。不可能使它成为类型安全的。</em></p><p id="61e2" class="jy jz mv ka b kb kc kd ke kf kg kh ki mw kk kl km mx ko kp kq my ks kt ku kv ij bi translated"><em class="iq">使</em> <code class="fe ma mb mc md b"><em class="iq">import config from 'config'</em></code> <em class="iq">工作集</em><code class="fe ma mb mc md b"><em class="iq">"esModuleInterop":true</em></code><em class="iq"/><code class="fe ma mb mc md b"><em class="iq">compilerOptions</em></code><em class="iq">于你的</em> <code class="fe ma mb mc md b"><em class="iq">tsconfig.json</em></code> <em class="iq">。</em></p></blockquote><p id="b30e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们的<code class="fe ma mb mc md b">src/app.ts</code>中可能是这样的:</p><figure class="mz na nb nc gt jr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="7317" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://repl.it/@aigoncharov/node-config-made-type-safe-demo" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">现场演示</strong> </a></p><blockquote class="ms mt mu"><p id="1d56" class="jy jz mv ka b kb kc kd ke kf kg kh ki mw kk kl km mx ko kp kq my ks kt ku kv ij bi translated"><em class="iq">你可能想要使用</em><a class="ae kw" href="https://github.com/dividab/tsconfig-paths" rel="noopener ugc nofollow" target="_blank"><em class="iq">ts config-paths</em></a><em class="iq">来避免深度相对导入。</em></p></blockquote><p id="ad37" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">希望你已经找到了对你的项目有用的东西。请随时将您的反馈传达给我！我非常感谢任何批评和问题。</p></div></div>    
</body>
</html>