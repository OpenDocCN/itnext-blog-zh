<html>
<head>
<title>Observations and thoughts after building 3 kubernetes platforms in Financial Services Industry — Part 3 — GitOps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">金融服务业三大kubernetes平台建设后的观察与思考——第三部分——GitOps</h1>
<blockquote>原文：<a href="https://itnext.io/observations-and-thoughts-after-building-3-kubernetes-platforms-in-financial-services-industry-7d6c60206717?source=collection_archive---------0-----------------------#2022-08-22">https://itnext.io/observations-and-thoughts-after-building-3-kubernetes-platforms-in-financial-services-industry-7d6c60206717?source=collection_archive---------0-----------------------#2022-08-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/930adb549b0d30b8bba4f83534568322.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ja0lc5B_aiE_79G0.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">ArgoCD赢得GitOps空间</figcaption></figure><p id="196c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这个博客系列的第三部分，我分享了我对使用GitOps管理kubernetes上运行的平台组件和工作负载的观察。</p><p id="3a28" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">以前的零件:</p><ul class=""><li id="9d42" class="la lb iq ke b kf kg kj kk kn lc kr ld kv le kz lf lg lh li bi translated"><a class="ae lj" rel="noopener ugc nofollow" target="_blank" href="/observations-and-thoughts-after-building-3-kubernetes-platforms-in-financial-services-industry-6705511c8e9b">第1部分</a> —概述，K8s平台即服务产品，网络</li><li id="4bc6" class="la lb iq ke b kf lk kj ll kn lm kr ln kv lo kz lf lg lh li bi translated"><a class="ae lj" rel="noopener ugc nofollow" target="_blank" href="/observations-and-thoughts-after-building-3-kubernetes-platforms-in-financial-services-industry-158eba494528">第二部分</a> —工作负载身份、秘密管理/外部化</li></ul><h1 id="f814" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">GitOps工具</h1><p id="145a" class="pw-post-body-paragraph kc kd iq ke b kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv mr kx ky kz ij bi translated">在这一领域，市场并不缺乏选择。GitOps是关于只根据存储在Git中的状态(配置)来配置集群和工作负载，并让操作员确保所需的状态与当前状态相匹配。想法是您可以删除一个集群并从Git中完全重新部署它。</p><p id="91ad" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">GitOps工具是一个我非常固执己见的领域，因为我已经看到了好的、坏的和丑陋的方面。在我工作过的3个环境中，我与以下人员互动过(按优先顺序)</p><ul class=""><li id="c581" class="la lb iq ke b kf kg kj kk kn lc kr ld kv le kz lf lg lh li bi translated"><strong class="ke ir"> ArgoCD </strong> — ArgoCD是GitOps刀具的瑞士刀。它以集中的模式运作。它可用于平台和应用程序工作负载。它具有UI、身份集成、控制(资源白名单/黑名单、RBAC)、部署排序(waves)、部署监控&amp;健康检查、强大的声明式支持(helm、kustomize、plain YAML等)，以及一组与应用管理一致的定制资源(<em class="ms">应用</em>、<em class="ms"> AppProject </em>、<em class="ms">应用集</em>)</li><li id="3878" class="la lb iq ke b kf lk kj ll kn lm kr ln kv lo kz lf lg lh li bi translated"><strong class="ke ir"> Terraform </strong> —在单租户平台中，我们没有复杂的需求，所有部署都是掌舵图，所以我在Terraform中构建了一个小型掌舵图“部署者”，并集成了从Azure Key Vault中提取秘密的功能。与部署完整的ArgoCD堆栈、秘密外部化和其他组件相比，这是一个简单的解决方案。</li><li id="6db7" class="la lb iq ke b kf lk kj ll kn lm kr ln kv lo kz lf lg lh li bi translated"><strong class="ke ir"> FluxCD — </strong>我在我的第一个平台构建和平台组件(Splunk daemonset、Aquasec、pod identity、nginx等)中使用了Flux。当时，它没有秘密集成，这是一个很大的挑战。Flux是一个分散模型，其中每个实例同步一个应用程序堆栈。</li><li id="b0ca" class="la lb iq ke b kf lk kj ll kn lm kr ln kv lo kz lf lg lh li bi translated"><strong class="ke ir"> Anthos配置同步</strong> —针对GKE(或Anthos客户)的解决方案。配置同步是一个基本的工具，支持kustomize和基本的头盔支持(渲染)。它的目标是应该在所有集群上的“平台”组件。它以“集群舰队为部署单位”的思维运作。它提供选择器来允许配置被部署/定制到集群的子集。总的来说，如果您将配置同步的范围限制在必须部署到所有集群的最基本的基础上，那么配置同步可能是好的。它的爆炸半径对我来说太大了。此外，将应用程序组件分解成层次结构是一项工程开销，我真的很纠结！此外，购买Anthos的客户认为他们必须使用它来平衡他们的投资，并且经常以次优的GitOps管理而告终。</li><li id="0aed" class="la lb iq ke b kf lk kj ll kn lm kr ln kv lo kz lf lg lh li bi translated"><strong class="ke ir">定制数据库/后端</strong> —定制应用程序围绕部署和生命周期管理SQL和API中的应用程序清单。</li></ul><p id="7fd7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">关键观察:</strong></p><ul class=""><li id="0d44" class="la lb iq ke b kf kg kj kk kn lc kr ld kv le kz lf lg lh li bi translated">将工具与小爆炸半径的展开装置对齐！部署范围太大，你会做各种各样的体操；导致修补、覆盖和排除的网络。如果你发现自己在创建一个如何定制配置的决策矩阵…那你就做错了。Kubernetes足够复杂；不要让它变得更复杂。</li><li id="7dd1" class="la lb iq ke b kf lk kj ll kn lm kr ln kv lo kz lf lg lh li bi translated">选择一个GitOps工具。使用我的企业架构师思维，为一项功能选择一个工具并使用它。一旦您开始在同一个环境中使用多个冗余工具，您就在重复投资并增加复杂性</li><li id="b600" class="la lb iq ke b kf lk kj ll kn lm kr ln kv lo kz lf lg lh li bi translated">不要走常规路线——大多数问题已经解决了。很少有组织需要重新发明轮子。分析市场，找到最合适的，并使用它。</li><li id="1555" class="la lb iq ke b kf lk kj ll kn lm kr ln kv lo kz lf lg lh li bi translated">在我看来，ArgoCD是这一领域的赢家</li></ul><p id="3fea" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在未来的实验中，我想使用ArgoCD来管理集群上的一切，并利用waves在需要时以特定的顺序实例化组件(即:在任何具有外部化机密的服务之前部署外部机密)。我还想尝试应用程序集。</p></div></div>    
</body>
</html>