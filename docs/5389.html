<html>
<head>
<title>Create a SharePoint File Picker in React with Microsoft Graph and Fluent UI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Microsoft Graph和Fluent UI在React中创建SharePoint文件选择器</h1>
<blockquote>原文：<a href="https://itnext.io/create-a-sharepoint-file-picker-in-react-with-microsoft-graph-and-fluent-ui-8653e3342942?source=collection_archive---------4-----------------------#2021-02-22">https://itnext.io/create-a-sharepoint-file-picker-in-react-with-microsoft-graph-and-fluent-ui-8653e3342942?source=collection_archive---------4-----------------------#2021-02-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9de8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让您的React应用成为微软365生态系统的一部分</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/349a5bb266ae7ccf2f4459747d5b5185.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FO8br2Ma4ieBgqqAwWHzhA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">我们将创建的文件选择器</figcaption></figure><p id="2f28" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">微软365平台在过去的十年里真正流行起来，许多转型企业最终将其IT环境转移到了云上。对于开发人员来说，这意味着通过将他们的应用程序与这些云环境相集成，可以获得越来越多的价值。为了促进这一点，微软创建了微软图形平台，在这个平台上，所有不同的系统通过一个OData网关连接到外部世界。</p><p id="e81a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本文中，我想向您展示如何使用Microsoft Graph构建一个文件选择器，从用户的在线驱动器中选择文件。如果您现在有一个应用程序，用户现在可以上传他们在本地office安装中创建的文件，您现在可以升级该应用程序，以处理他们OneDrive文件夹中的文件。</p><h1 id="d074" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">使用Microsoft身份验证</h1><p id="c6cf" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">要开始使用Graph，你首先需要用Azure Active Directory实现SSO。最简单的方法就是跟随微软React的教程。您只需要验证码，您可以在“获取日历视图”步骤停止。</p><p id="5996" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您从Microsoft示例中获取了准确的代码，您必须更改授权范围，以包括对用户文件的访问。我们还需要保持<code class="fe mp mq mr ms b">user.read</code>的范围，这样<code class="fe mp mq mr ms b">withAuthProvider</code>组件仍然可以加载当前用户的配置文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">访问用户文件的正确范围</figcaption></figure><h1 id="040a" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated"><strong class="ak">通过Microsoft Graph查询文件夹</strong></h1><p id="6463" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">在我们设置了Microsoft Identity以获取所需的访问令牌后，我们可以开始通过Graph client编写查询。我们将从定义我们实际想要从API加载的数据开始。用于文件夹和项目的类型如下所示。根据您想要在文件选择器中包含多少列，您可以添加和删除<code class="fe mp mq mr ms b">GraphItem</code>类型的属性，只是不要忘记相应地更新查询。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">我们将要处理的两种基本类型的数据</figcaption></figure><p id="914f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通过使用<code class="fe mp mq mr ms b">/me/drive/root</code>端点获取当前用户的根文件夹，可以使用Microsoft Graph查询用户的文件。根文件夹是用户登录OneDrive时看到的内容。通过扩展到<code class="fe mp mq mr ms b">children</code>,我们可以在一个查询中获得根文件夹中的项目:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">加载文件夹及其内容的Microsoft Graph查询，以及将数据解析为所需数据结构的函数</figcaption></figure><p id="1a20" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">相同的API调用也可以用于所有其他文件夹，尽管基本url略有不同。你也可以扩展这个函数，例如通过使用<code class="fe mp mq mr ms b">/me/drive/recent</code>而不是指向根文件夹来加载当前用户最近的所有文件。</p><h1 id="07fd" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">文件选择器组件</h1><p id="09b6" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">文件选择器的根组件将保存当前视图中的<code class="fe mp mq mr ms b">GraphFolder</code>的状态。在这个组件中，我们将在顶部呈现一个带有项目和一些附加信息的列表。当用户点击一个文件夹时，我们会将该文件夹加载到状态中并替换当前的文件夹。然而，如果用户点击一个文件，我们将调用来自props的回调，将选择的文件传递给<code class="fe mp mq mr ms b">FilePicker</code>组件的消费者。这也将设置状态中的<code class="fe mp mq mr ms b">selectedFile</code>属性并关闭模态。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">文件选择器的根组件</figcaption></figure><p id="1e01" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在文件选择器本身的逻辑之外，我们也有一些它的关闭状态的逻辑。在关闭状态下，我们显示了一个打开文件选择器的按钮，在它旁边显示了所选文件的名称以及在SharePoint中打开它的链接。在带有文件夹的模型中，我们显示了两个组件:一个<code class="fe mp mq mr ms b">commandBar</code>和一个<code class="fe mp mq mr ms b">detailList</code>。<code class="fe mp mq mr ms b">detailList</code>将显示文件夹中项目的列表，而<code class="fe mp mq mr ms b">commandBar</code>将提供文件选择器的标题(如本文的标题图片所示)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/0934685dc07f3ba653df5f831b1beeb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7vQsuDWPVgJhzRnX7t7C8w.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">文件选取器的两种关闭状态</figcaption></figure><p id="82e2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个元素是来自<a class="ae mo" href="https://developer.microsoft.com/en-us/fluentui#/" rel="noopener ugc nofollow" target="_blank">微软流畅用户界面库</a>的<code class="fe mp mq mr ms b"><a class="ae mo" href="https://developer.microsoft.com/en-us/fluentui#/controls/web/commandbar" rel="noopener ugc nofollow" target="_blank">CommandBar</a></code>。该函数的实现如下所示。通过使用流畅的用户界面，我们不仅仅是从微软平台加载东西，我们还让它看起来像是更大生态系统的一部分。您已经在前面的代码示例中看到了一些用于<code class="fe mp mq mr ms b">Modal</code>和<code class="fe mp mq mr ms b">ProgressIndicator</code>的流畅UI元素。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">文件选取器关闭状态的渲染函数</figcaption></figure><h1 id="d5cb" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">使用Microsoft Fluent用户界面显示文件夹</h1><p id="3834" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">对于项目的渲染，我们将使用Fluent UI中的<code class="fe mp mq mr ms b"><a class="ae mo" href="https://developer.microsoft.com/en-us/fluentui#/controls/web/detailslist" rel="noopener ugc nofollow" target="_blank">DetailList</a></code>组件。该组件通过使用列定义的集合来呈现项目列表。请注意，在下面的示例代码中，我省略了很多列，它们本质上都是一样的，占用了很多空间。这个组件的完整代码可以在GitHub的<a class="ae mo" href="https://gist.github.com/WimJongeneel/d4c256382da69b7045003a0cdba8b11d" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">当前打开的文件夹中的文件夹和文件列表的呈现功能</figcaption></figure><p id="e7d3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最重要的部分之一是<code class="fe mp mq mr ms b">onItemInvoked</code>功能。在这里，当用户点击一行时，我们或者调用<code class="fe mp mq mr ms b">loadFolder</code>或者<code class="fe mp mq mr ms b">onSelectFile</code>。</p><p id="68d3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在项目列表的顶部，我们将显示一个带有当前文件夹名称的<code class="fe mp mq mr ms b"><a class="ae mo" href="https://developer.microsoft.com/en-us/fluentui#/controls/web/commandbar" rel="noopener ugc nofollow" target="_blank">CommandBar</a></code>，一个导航到其父文件夹的按钮和一个在SharePoint中打开该文件夹的链接。这也是一个<code class="fe mp mq mr ms b">CommandBar</code>(类似于关闭的视图)，但是这里我们也使用<code class="fe mp mq mr ms b">farItems</code>道具来显示模态最右边的按钮。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">文件选择器顶部栏的渲染功能</figcaption></figure><h1 id="31a3" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">结论</h1><p id="9f22" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">有了标题，我们现在在React中有了一个完整的SharePoint文件选择器。当然，这一个仍然相对简单，但可以很容易地扩展像搜索，过滤器或多选等功能。我希望这篇文章向您展示了如何编写一个与微软云环境集成的React组件。</p></div></div>    
</body>
</html>