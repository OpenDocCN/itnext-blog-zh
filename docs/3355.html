<html>
<head>
<title>Run Kubernetes On Your Machine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在你的机器上运行Kubernetes</h1>
<blockquote>原文：<a href="https://itnext.io/run-kubernetes-on-your-machine-7ee463af21a2?source=collection_archive---------0-----------------------#2019-11-27">https://itnext.io/run-kubernetes-on-your-machine-7ee463af21a2?source=collection_archive---------0-----------------------#2019-11-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9984" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">立即开始玩K8s的几个选项</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/019b854b57310c954531b68fa072610c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*96mOrfBZjSWj2NCA7z6OJA.png"/></div></div></figure><p id="b3a3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在线获得Kubernetes集群真的很容易，因为几乎每个云提供商都提供自己的解决方案(<a class="ae lq" href="https://cloud.google.com/kubernetes-engine" rel="noopener ugc nofollow" target="_blank">谷歌GKE </a>、<a class="ae lq" href="https://aws.amazon.com/en/eks/" rel="noopener ugc nofollow" target="_blank">亚马逊EKS </a>、<a class="ae lq" href="https://azure.microsoft.com/en-en/services/kubernetes-service/" rel="noopener ugc nofollow" target="_blank">微软AKS </a>、<a class="ae lq" href="https://www.digitalocean.com/products/kubernetes/" rel="noopener ugc nofollow" target="_blank">数字海洋DOKS </a>、<a class="ae lq" href="https://www.civo.com/kube100" rel="noopener ugc nofollow" target="_blank"> Civo Kubernetes </a>、…)。因为有时我们只是想在本地玩，这篇文章列出了这种用法的一些主要选项。</p><h2 id="affb" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">快速笔记</h2><p id="6cc1" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">要从本地机器访问Kubernetes集群，我们首先需要安装和配置<em class="mp"> kubectl </em>，这是一个命令行工具，用于向集群的API服务器发送请求。<a class="ae lq" href="https://kubernetes.io/en/docs/tasks/tools/install-kubectl/" rel="noopener ugc nofollow" target="_blank">安装</a>非常简单(下载并添加到路径中的二进制文件)，我们将在示例中看到如何配置<em class="mp"> kubectl </em>来定位特定的集群。</p><p id="84c1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此外，多个解决方案在一个虚拟机中运行，因此需要一个虚拟机管理程序。在几个例子中，我们将使用<a class="ae lq" href="https://multipass.run" rel="noopener ugc nofollow" target="_blank"> Multipass </a>，这是一个伟大的工具，它允许在Mac、Linux或Windows工作站上启动Ubuntu虚拟机。根据您的操作系统，它使用Hyper-V，HyperKit，KVM或VirtualBox本机最快的启动时间。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/cb137fa8511d8fcff0f67c11c48567fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*HtD7wb3Wfj88ZTSZ_-z8xA.jpeg"/></div></figure><p id="014e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Minikube可能是最广为人知的解决方案，它启动一个虚拟机，并在其中运行所有的Kubernetes进程。默认情况下，Minikube过去使用VirtualBox运行，但现在它可以选择系统上可用的最佳驱动程序。</p><p id="cb34" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们首先需要下载<a class="ae lq" href="https://github.com/kubernetes/minikube/releases" rel="noopener ugc nofollow" target="_blank">最新的稳定版本</a>，然后运行<em class="mp"> minikube start </em>我们就可以开始了。下面是Minikube在MacOS上启动的例子。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/bbb5df9e3f627d75ecef236fb4d65fda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pN5HetOOybBKBWPcWspBVQ.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">默认情况下使用HyperKit在MacOS上运行Minikube</figcaption></figure><p id="3fbb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在启动期间，kubeconfig文件(<em class="mp"> ~/)。kube/config </em>缺省情况下)被更新(或者如果它还不在那里则被创建)并且一个名为<em class="mp"> minikube </em>的新上下文被创建。该上下文被设置为默认上下文，因此<em class="mp"> kubectl </em>可以立即与minikube通信。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/cb5f47382525ea98bed802b40e8b5bea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2UYVu9NCyWcac19sDDVm8w.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">获取Minikube的节点</figcaption></figure></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/dcc426ce5e7b7455d7a78d40a6730f30.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*X4tpHnlFUfOGLSx-XOrXpg.png"/></div></figure><p id="8df7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在MacOS或Windows 10上，我们可以使用<a class="ae lq" href="https://www.docker.com/products/docker-desktop" rel="noopener ugc nofollow" target="_blank"> Docker Desktop </a>，这是一款专注于开发者体验的工具，用于构建和共享容器化的应用和微服务。Docker桌面附带众所周知的工具，如Docker Compose和Docker Machine。</p><p id="693c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Docker桌面的分发可在https://www.docker.com/products/docker-desktop的<a class="ae lq" href="https://www.docker.com/products/docker-desktop" rel="noopener ugc nofollow" target="_blank">获得。安装后，可以配置它运行单节点Kubernetes。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/d7ba8121137ac37dd4f6707ded8962e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yeOZ4hZJkTwDzZEkqN_tcA.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">在Docker桌面(MacOS)上启用Kubernetes</figcaption></figure><p id="703d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这创建了一个新的上下文，命名为<em class="mp"> docker-desktop </em>。我们只需要将这个上下文设置为当前上下文，就可以开始了。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="6c27" class="lr ls it ng b gy nk nl l nm nn">$ kubectl config use-context docker-desktop</span><span id="2f02" class="lr ls it ng b gy no nl l nm nn">$ kubectl get nodes<br/>NAME             STATUS   ROLES    AGE   VERSION<br/>docker-desktop   Ready    master   22d   v1.15.5</span></pre></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/b991ea644a4585cbf01179adbd0a57ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*uLYufcqu6I_XyW74YuTuIg.png"/></div></figure><p id="27d9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://github.com/kubernetes-sigs/kind" rel="noopener ugc nofollow" target="_blank"> Kind </a>代表Docker中的Kubernetes，因为每个集群的节点都运行在Docker容器中。</p><p id="b4fb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要使用它，我们需要Docker(用Docker桌面或有用的快捷方式'<em class="mp">curl</em><a class="ae lq" href="https://get.docker.com" rel="noopener ugc nofollow" target="_blank"><em class="mp">https://get.docker.com</em></a><em class="mp">| sh '</em>)和<a class="ae lq" href="https://github.com/kubernetes-sigs/kind/releases" rel="noopener ugc nofollow" target="_blank">最新版本</a>。下面的屏幕截图显示了可用于管理集群生命周期的命令。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/a7cb596a00e879167dee8bee545a5ff8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Seo_Cl5O91Y52sfNVD8o6w.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">种类可用的命令</figcaption></figure><p id="a67c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建单节点集群非常简单，如以下命令所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/913f20436e24b994c131c363872afae2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vJedwFFQhCxGUtmC4_LEQQ.png"/></div></div></figure><p id="075f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Kind还允许创建多节点集群，为此它需要一个配置文件。例如，下面的文件定义了一个6节点集群:3个主节点和3个工作节点。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="03cb" class="lr ls it ng b gy nk nl l nm nn"><em class="mp"># HA-config.yaml</em><br/>kind<strong class="ng iu">:</strong> Cluster<br/>apiVersion<strong class="ng iu">:</strong> kind.sigs.k8s.io/v1alpha3<br/>nodes<strong class="ng iu">:</strong><br/>- role<strong class="ng iu">:</strong> control-plane<br/>- role<strong class="ng iu">:</strong> control-plane<br/>- role<strong class="ng iu">:</strong> control-plane<br/>- role<strong class="ng iu">:</strong> worker<br/>- role<strong class="ng iu">:</strong> worker<br/>- role<strong class="ng iu">:</strong> worker</span></pre><p id="bd0d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在创建命令中，我们只需要提供配置文件作为附加参数:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/f2d19a2720ea6fd90e3e2ede15ea381d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MdS7rywnd5y593nOILXioA.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">使用Kind创建多节点集群</figcaption></figure><p id="a6ec" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建了两个集群后，我们可以看到相应的Docker容器在本地机器上运行。基于<em class="mp">kindest/node:v 1 . 16 . 3</em>Docker映像有7个容器，每个容器属于一个集群。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/042bf4f8a1fa10c50d95cbcbe1dec24e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1sXiXVamwI7UIQ9_kZP-NA.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">每种类型的节点都运行在一个Docker容器中</figcaption></figure><p id="7d11" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">和前面的例子一样，Kind更新kubeconfig文件(<em class="mp"> ~/)。默认为kube/config </em>)与新的上下文。在下面的列表中，我们可以看到迄今为止创建的不同上下文:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="0099" class="lr ls it ng b gy nk nl l nm nn">$ kubectl config get-contexts<br/>         docker-desktop docker-desktop   docker-desktop<br/>         kind-k8s       kind-k8s         kind-k8s<br/>*        kind-k8s-HA    kind-k8s-HA      kind-k8s-HA<br/>         minikube       minikube         minikube</span></pre><p id="0a77" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当前上下文链接到我们创建的最后一个集群<em class="mp"> k8s-HA </em>。如果我们列出节点，我们会得到集群的3个主节点和3个工作节点。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="600c" class="lr ls it ng b gy nk nl l nm nn">$ kubectl get nodes<br/>NAME                    STATUS   ROLES    AGE     VERSION<br/>k8s-ha-control-plane    Ready    master   4m8s    v1.16.3<br/>k8s-ha-control-plane2   Ready    master   3m24s   v1.16.3<br/>k8s-ha-control-plane3   Ready    master   2m24s   v1.16.3<br/>k8s-ha-worker           Ready    &lt;none&gt;   107s    v1.16.3<br/>k8s-ha-worker2          Ready    &lt;none&gt;   106s    v1.16.3<br/>k8s-ha-worker3          Ready    &lt;none&gt;   106s    v1.16.3</span></pre></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/1238a922a36826b69e897ec450ea013b.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*oGN2hzpJel_wB_3WyVGCvg.png"/></div></figure><p id="c4c1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">MicroK8s是一款专注于简单性和开发者体验的工具。对于物联网、Edge和在Linux机器上运行来说，这是非常棒的。它非常轻量级，但提供了“附加组件”，这些附加组件是预打包的组件，为Kubernetes提供了一些额外的功能:从简单的DNS管理到Kubeflow的机器学习。</p><p id="2e90" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">看到Kelsey Hightower关于MicroK8s的这条推文了吗:)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/1d9d61249f115ea7296a7078b8ffc3d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*rchlz4fmIrMn10cfl08irA.png"/></div></figure><p id="ab05" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在Windows、MacOS或Linux上，MicroK8s可以很容易地安装在配备了<a class="ae lq" href="https://multipass.run" rel="noopener ugc nofollow" target="_blank"> Multipass </a>的Ubuntu虚拟机上。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="80a1" class="lr ls it ng b gy nk nl l nm nn"># Create a new Ubuntu VM<br/>$ multipass launch --name microk8s --mem 4G</span><span id="cb48" class="lr ls it ng b gy no nl l nm nn"># Install microk8s in the VM through snap<br/>$ multipass exec microk8s -- sudo snap install microk8s --classic</span></pre><p id="d379" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，我们将集群配置复制到本地文件中:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="e1e0" class="lr ls it ng b gy nk nl l nm nn">$ multipass exec microk8s -- sudo microk8s.config &gt; microk8s.yaml</span></pre><p id="b933" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意:MicroK8s附带了几个二进制文件，其中包括:</p><ul class=""><li id="d5db" class="nu nv it kw b kx ky la lb ld nw lh nx ll ny lp nz oa ob oc bi translated"><em class="mp"> microk8s.config: </em>提供了从外部使用的<em class="mp"> kubectl </em>配置</li><li id="1843" class="nu nv it kw b kx od la oe ld of lh og ll oh lp nz oa ob oc bi translated"><em class="mp">microk8s . kubectl</em>:<em class="mp"/>自己版本的kubectl</li></ul><p id="df81" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，我们设置KUBECONFIG环境变量来定义本地<em class="mp"> kubectl </em>使用的上下文:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="0c63" class="lr ls it ng b gy nk nl l nm nn">$ export KUBECONFIG=$PWD/microk8s.yaml</span></pre><p id="60ca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们已经准备好使用您的新MicroK8s单节点集群:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="59bb" class="lr ls it ng b gy nk nl l nm nn">$ kubectl get nodes<br/>NAME       STATUS   ROLES    AGE     VERSION<br/>microk8s   Ready    &lt;none&gt;   4m48s   v1.16.3</span></pre></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/fd3805c14ca64897f2933f77c086d9a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*E89srdNhG2-KwZSpd_HmZw.png"/></div></figure><p id="ec6c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://k3s.io/" rel="noopener ugc nofollow" target="_blank"> K3s </a>是一款轻量级的Kubernetes(比k8s中少了5个s:)。这是一款经过认证的Kubernetes发行版，专为物联网、边缘计算、CI等领域打造</p><p id="fe7f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在Windows、MacOS或Linux上，K3s可以很容易地安装在配备了<a class="ae lq" href="https://multipass.run" rel="noopener ugc nofollow" target="_blank"> Multipass </a>的Ubuntu VM中(就像我们对MicroK8s所做的那样)。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="8d10" class="lr ls it ng b gy nk nl l nm nn"># Create a new Ubuntu VM<br/>$ multipass launch --name k3s</span><span id="c21e" class="lr ls it ng b gy no nl l nm nn"># Get the VM's IP address (we will need it later on)<br/>$ IP=$(multipass info k3s | grep IP | awk '{print $2}')</span><span id="f019" class="lr ls it ng b gy no nl l nm nn"># Run a shell in the VM<br/>$ multipass exec k3s -- \<br/>bash -c "curl -sfL <a class="ae lq" href="https://get.k3s.io" rel="noopener ugc nofollow" target="_blank">https://get.k3s.io</a> | sh -"</span></pre><p id="ae1d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">安装完成后，我们在本地机器上复制在虚拟机内的<em class="mp">/etc/rancher/k3s/k3s . YAML</em>中生成的kubeconfig文件。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="5dde" class="lr ls it ng b gy nk nl l nm nn">$ multipass exec k3s sudo cat /etc/rancher/k3s/k3s.yaml &gt; k3s.yaml</span></pre><p id="ef72" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这个文件中，我们需要更改<em class="mp">服务器</em>密钥，以便它引用虚拟机的外部IP，而不是回环(127.0.0.1)。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="0c25" class="lr ls it ng b gy nk nl l nm nn">$ sed -i '' "s/127.0.0.1/$IP/" k3s.yaml</span></pre><p id="c27d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后我们设置KUBECONFIG环境变量来设置由<em class="mp"> kubectl </em>使用的上下文:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="cb21" class="lr ls it ng b gy nk nl l nm nn">$ export KUBECONFIG=$PWD/k3s.yaml</span></pre><p id="a174" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后我们就可以开始玩K3s了！</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="164f" class="lr ls it ng b gy nk nl l nm nn">$ kubectl get nodes<br/>NAME   STATUS   ROLES    AGE     VERSION<br/>k3s    Ready    master   2m40s   v1.16.3-k3s.2</span></pre><p id="094d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意:如果你在Linux上，你可以使用命令直接安装k3s</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="28fa" class="lr ls it ng b gy nk nl l nm nn">$ curl -sfL https://get.k3s.io | sh -</span></pre><p id="17f4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这篇<a class="ae lq" href="https://medium.com/better-programming/local-k3s-cluster-made-easy-with-multipass-108bf6ce577c" rel="noopener">上一篇文章</a>中，您将找到设置K3s多节点集群的更多细节。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/53cc0238be847a822d17cf3edfd09fd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*RudnB9tUnleosqYTETCdfw.png"/></div></figure><p id="cd9e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://github.com/rancher/k3d" rel="noopener ugc nofollow" target="_blank"> k3d </a>是来自<a class="ae lq" href="https://rancher.com" rel="noopener ugc nofollow" target="_blank"> Rancher labs </a>的另一个工具，它在容器中部署k3s集群(感谢<a class="ok ol ep" href="https://medium.com/u/78e4f790de62?source=post_page-----7ee463af21a2--------------------------------" rel="noopener" target="_blank"> Michael Martinez </a>谈到这个)。它只需要一台运行Docker的机器。</p><p id="e1f9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">安装k3d非常简单，可以用下面的命令来完成:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="0336" class="lr ls it ng b gy nk nl l nm nn">$ curl -s https://raw.githubusercontent.com/rancher/k3d/master/install.sh | bash</span></pre><p id="f64a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建集群需要带有一些可选参数的<em class="mp"> k3d create </em>命令，例如:</p><ul class=""><li id="7de8" class="nu nv it kw b kx ky la lb ld nw lh nx ll ny lp nz oa ob oc bi translated">集群的名称</li><li id="3621" class="nu nv it kw b kx od la oe ld of lh og ll oh lp nz oa ob oc bi translated">在本地机器上发布api服务器的端口(默认为6443)</li><li id="bf15" class="nu nv it kw b kx od la oe ld of lh og ll oh lp nz oa ob oc bi translated">向外部发布服务的端口</li><li id="264a" class="nu nv it kw b kx od la oe ld of lh og ll oh lp nz oa ob oc bi translated">多节点集群的工作线程数量</li></ul><p id="ec61" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在下面的截图中，我们创建了一个名为<em class="mp"> k3s </em>的集群，有两个工作节点(在主节点之上)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/854ce510bfe0ce8b1dfe7ed1d2b6955a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1_k9wwZ7KhkdSkyl81wFsg.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">使用k3d创建的k3s集群</figcaption></figure><p id="d45c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在后面，我们可以看到创建了3个容器，每个容器用于集群的一个节点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/d881373285faf0d1af31d9d0ef6cefca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2dVcxdL5bjRU_M8fOS-D-g.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">在容器中运行的k3s节点</figcaption></figure><p id="4083" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，我们可以设置KUBECONFIG环境变量，以使用为集群创建的kubeconfig:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="f7ec" class="lr ls it ng b gy nk nl l nm nn">$ export KUBECONFIG="$(k3d get-kubeconfig --name='k3s')"</span></pre><p id="3be8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">开始使用我们的新集群:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="3929" class="lr ls it ng b gy nk nl l nm nn">$ kubectl get nodes<br/>NAME               STATUS   ROLES    AGE     VERSION<br/>k3d-k3s-server     Ready    master   4m45s   v1.16.2-k3s.1<br/>k3d-k3s-worker-1   Ready    &lt;none&gt;   4m45s   v1.16.2-k3s.1<br/>k3d-k3s-worker-0   Ready    &lt;none&gt;   4m44s   v1.16.2-k3s.1</span></pre><p id="a002" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意:为了向外部公开服务，需要用<em class="mp"> - publish </em>标志创建集群，文档中的<a class="ae lq" href="https://github.com/rancher/k3d/blob/master/docs/examples.md" rel="noopener ugc nofollow" target="_blank">说明了几个配置选项</a></p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/7b48c4d8c91296ef1a1518b7c8f96b94.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*d_b85sc8-4ap15mS3xfNog.png"/></div></figure><p id="b7f2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://github.com/alexellis/k3sup" rel="noopener ugc nofollow" target="_blank"> k3sup </a>是一个很棒的工具，来自<a class="ok ol ep" href="https://medium.com/u/89b4ba5a32ff?source=post_page-----7ee463af21a2--------------------------------" rel="noopener" target="_blank"> Alex Ellis </a>，用于设置k3s集群(以及更多)，它只需要一个ssh访问一个预先配置的虚拟机。让我们看看它如何与使用Multipass创建的VM一起工作。</p><p id="462c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Multipass使用自己的密钥ssh到它创建的虚拟机上，该密钥的位置取决于操作系统(例如，在MacOS上，它位于<em class="mp">/var/root/Library/Application Support/multipassd/ssh-keys/id _ RSA</em>)。通常建议用一个定义ssh授权密钥的cloud-init文件启动一个多通道VM。</p><p id="882d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">假设我们的公钥在<em class="mp"> ~/中。ssh/id_rsa.pub </em>(默认位置)，可以使用以下命令创建一个简单的cloud-init文件:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="1681" class="lr ls it ng b gy nk nl l nm nn">$ cat&lt;&lt;EOF &gt; cloud.init<br/>ssh_authorized_keys:<br/> - $(cat ~/.ssh/id_rsa.pub)<br/>EOF</span></pre><p id="d6c5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用这个文件，我们创建一个虚拟机并获取它的IP地址。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="9f0c" class="lr ls it ng b gy nk nl l nm nn"># Create a new Ubuntu VM<br/>$ multipass launch --name k3s --cloud-init cloud.init</span><span id="d253" class="lr ls it ng b gy no nl l nm nn"># Get the VM's IP address<br/>$ export IP=$(multipass info k3s | grep IP | awk '{print $2}')</span></pre><p id="e133" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，我们使用以下命令设置一个带有<em class="mp"> k3sup </em>的k3s集群</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="e667" class="lr ls it ng b gy nk nl l nm nn">$ k3sup install --ip $IP --user multipass</span></pre><p id="f203" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">k3s准备就绪，可以使用当前目录中创建的kubeconfig文件进行访问。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="b382" class="lr ls it ng b gy nk nl l nm nn">$ export KUBECONFIG=$PWD/kubeconfig</span><span id="05a8" class="lr ls it ng b gy no nl l nm nn">$ kubectl get node<br/>NAME   STATUS   ROLES    AGE    VERSION<br/>k3s    Ready    master   105s   v1.16.3-k3s.2</span></pre></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h2 id="c46c" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">kubectx和kube-ps1前来救援</h2><p id="ab63" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">如果您在阅读这篇文章时测试了几个工具，那么您现在有了几个上下文，您的本地<em class="mp"> kubectl </em>可以使用这些上下文来定位一个或另一个集群。可用上下文的示例:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="1bb1" class="lr ls it ng b gy nk nl l nm nn">$ kubectl config get-contexts<br/>CURRENT  NAME           CLUSTER          AUTHINFO          NAMESPACE<br/>         docker-desktop docker-desktop   docker-desktop<br/>         kind-k8s       kind-k8s         kind-k8s<br/>*        kind-k8s-HA    kind-k8s-HA      kind-k8s-HA<br/>         minikube       minikube         minikube</span></pre><p id="157b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了更容易地在这些上下文之间导航，我建议你尝试一下<a class="ae lq" href="https://github.com/ahmetb/kubectx" rel="noopener ugc nofollow" target="_blank"> kubectx </a>。安装非常简单，因为这只是一个添加到路径中的shell脚本。</p><p id="e831" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">还有，避开“黎明吧！我对错误的集群运行命令”，kube-ps1 是必须的。该工具为当前集群和命名空间提供了一个很好的PS1 /提示符。看看这个:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="9ba6" class="lr ls it ng b gy nk nl l nm nn"># Shell without kube-ps1<br/>luc@saturn:~$</span><span id="f43e" class="lr ls it ng b gy no nl l nm nn"># Shell with kube-ps1<br/>[luc@saturn ~ (⎈ |kind-k8s:default)]$</span></pre></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h2 id="b487" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">在线游乐场</h2><p id="486c" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">其他解决方案支持在线玩Kubernetes(阅读:无需在本地安装任何东西)。这不是这篇文章的目的，但仍然是有趣的话题:)</p><div class="kj kk kl km gt ab cb"><figure class="oo kn op oq or os ot paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/8c352f8526160a07b9a3f645bae3be67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*IncbpxTlJ9b0JJ2QFtx49A.png"/></div></figure><figure class="oo kn op oq or os ot paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/6f36e06b8bd20bd3e0d0974d7b5348d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*wy5EqvhGWRGq4T2KlEnW4g.png"/></div></figure></div><ul class=""><li id="a041" class="nu nv it kw b kx ky la lb ld nw lh nx ll ny lp nz oa ob oc bi translated">PWK</li></ul><p id="c74d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">PWK ( <a class="ae lq" href="https://play-with-k8s.com" rel="noopener ugc nofollow" target="_blank">和库伯内特</a>玩)是PWD(<a class="ae lq" href="https://play-with-docker.com/" rel="noopener ugc nofollow" target="_blank">和码头工人</a>玩)的小哥哥。它提供了一个有5个终端的环境，持续4个小时，并指导您使用<a class="ae lq" href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/" rel="noopener ugc nofollow" target="_blank"> kubeadm </a>(一个用于设置生产集群的工具)完成Kubernetes集群的设置。PWK的一个终端感觉像一个真实VM中的外壳，但它实际上是一个运行在Alpine容器中的外壳，容器中已经安装了几个工具(docker、kubectl、kubelet等等)。</p><ul class=""><li id="182b" class="nu nv it kw b kx ky la lb ld nw lh nx ll ny lp nz oa ob oc bi translated">卡塔科达</li></ul><p id="3fe5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://katacoda.com" rel="noopener ugc nofollow" target="_blank"> Katacoda </a>专注于<a class="ae lq" href="https://cncf.io" rel="noopener ugc nofollow" target="_blank">云原生</a>应用，这包括Kubernetes，但也包括许多其他项目和技术。这是通过许多主题的交互式教程进行学习的好地方，其中包括:</p><ul class=""><li id="f367" class="nu nv it kw b kx ky la lb ld nw lh nx ll ny lp nz oa ob oc bi translated">Kubernetes(你还可以得到一个漂亮的<a class="ae lq" href="https://katacoda.com/courses/kubernetes/playground" rel="noopener ugc nofollow" target="_blank">游乐场</a>)和相关技术</li><li id="adbc" class="nu nv it kw b kx od la oe ld of lh og ll oh lp nz oa ob oc bi translated">无服务器</li><li id="971c" class="nu nv it kw b kx od la oe ld of lh og ll oh lp nz oa ob oc bi translated">将（行星）地球化（以适合人类居住）</li><li id="7f43" class="nu nv it kw b kx od la oe ld of lh og ll oh lp nz oa ob oc bi translated">机器学习</li><li id="962f" class="nu nv it kw b kx od la oe ld of lh og ll oh lp nz oa ob oc bi translated">编程语言:Go，Ruby，Node。Js，Python，Kotlin，…</li><li id="35bc" class="nu nv it kw b kx od la oe ld of lh og ll oh lp nz oa ob oc bi translated">Linux操作系统</li><li id="ba96" class="nu nv it kw b kx od la oe ld of lh og ll oh lp nz oa ob oc bi translated">…以及更多</li></ul><p id="219d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">看看所有可用的<a class="ae lq" href="https://katacoda.com/learn" rel="noopener ugc nofollow" target="_blank">学习途径</a>！</p><h2 id="eefa" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">摘要</h2><p id="e0a8" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">本文中详细介绍的所有工具都可以用来设置本地Kubernetes集群。它们有不同的功能和选项:快速设置，轻松升级，定期更新，简化与生态系统其他项目的集成，…我建议您检查其中的一些(全部？:) )并选择最符合您需求的一款。此外，正如我们在示例中看到的，Multipass是一个很好的工具，它简化了VM的创建过程。</p></div></div>    
</body>
</html>