<html>
<head>
<title>Kubernetes on bare-metal “batteries included“ with k8s-tew</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">k8s-tew裸机“附带电池”上的Kubernetes</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-on-bare-metal-batteries-included-with-k8s-tew-b7df7d661443?source=collection_archive---------1-----------------------#2019-03-27">https://itnext.io/kubernetes-on-bare-metal-batteries-included-with-k8s-tew-b7df7d661443?source=collection_archive---------1-----------------------#2019-03-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="abbd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">作为一名kubernetes管理员，我通常部署独立的kubernetes集群来测试一些特性、应用程序，甚至是Kubernetes工具。但在这种情况下，需要花费一些时间来部署Kubernetes、CNI、存储解决方案、负载均衡器服务实施、入口控制器、监控、日志记录等。对于像GKE或DigitalOcean这样的Kubernetes-ready云分发，这相当简单，但如何用裸机做到这一点呢？当然，这可能包括您机器上的linux虚拟机…</p><p id="eb81" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> k8s-tew </strong>是用GO编写的单个二进制文件，没有外部依赖性，它将轻松地在裸机上部署Kubernetes集群(理解:不需要云提供商),甚至为您的POCs部署单节点测试平台。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/93997d167f16141af41ac7cd6890a41f.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*eQtyht27Xec__QQtP8vxpw.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">k8s-tew徽标</figcaption></figure><p id="9779" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> k8s-tew </strong>将展开:</p><ul class=""><li id="825d" class="la lb it js b jt ju jx jy kb lc kf ld kj le kn lf lg lh li bi translated">通过所有CNCF一致性测试的HA或非HA集群设置(Kubernetes <a class="ae lj" href="https://github.com/cncf/k8s-conformance/tree/master/v1.10/k8s-tew" rel="noopener ugc nofollow" target="_blank"> 1.10 </a>、<a class="ae lj" href="https://github.com/cncf/k8s-conformance/tree/master/v1.11/k8s-tew" rel="noopener ugc nofollow" target="_blank"> 1.11 </a>、<a class="ae lj" href="https://github.com/cncf/k8s-conformance/tree/master/v1.12/k8s-tew" rel="noopener ugc nofollow" target="_blank"> 1.12 </a> &amp; <a class="ae lj" href="https://github.com/cncf/k8s-conformance/tree/master/v1.13/k8s-tew" rel="noopener ugc nofollow" target="_blank"> 1.13 </a>)</li><li id="99db" class="la lb it js b jt lk jx ll kb lm kf ln kj lo kn lf lg lh li bi translated">集装箱管理:<a class="ae lj" href="https://containerd.io/" rel="noopener ugc nofollow" target="_blank">集装箱id</a></li><li id="a7c7" class="la lb it js b jt lk jx ll kb lm kf ln kj lo kn lf lg lh li bi translated">联网:<a class="ae lj" href="https://www.projectcalico.org/" rel="noopener ugc nofollow" target="_blank">印花布</a></li><li id="17ab" class="la lb it js b jt lk jx ll kb lm kf ln kj lo kn lf lg lh li bi translated">Ingress: <a class="ae lj" href="https://kubernetes.github.io/ingress-nginx/" rel="noopener ugc nofollow" target="_blank"> NGINX Ingress </a>和<a class="ae lj" href="http://docs.cert-manager.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> cert-manager </a> for <a class="ae lj" href="https://letsencrypt.org/" rel="noopener ugc nofollow" target="_blank">让我们加密</a></li><li id="c002" class="la lb it js b jt lk jx ll kb lm kf ln kj lo kn lf lg lh li bi translated">存储:<a class="ae lj" href="https://ceph.com/" rel="noopener ugc nofollow" target="_blank"> Ceph/RBD </a></li><li id="14a5" class="la lb it js b jt lk jx ll kb lm kf ln kj lo kn lf lg lh li bi translated">指标:<a class="ae lj" href="https://github.com/kubernetes-incubator/metrics-server" rel="noopener ugc nofollow" target="_blank">计量指标</a>和<a class="ae lj" href="https://github.com/kubernetes/heapster" rel="noopener ugc nofollow" target="_blank">堆集器</a></li><li id="3a85" class="la lb it js b jt lk jx ll kb lm kf ln kj lo kn lf lg lh li bi translated">监控:<a class="ae lj" href="https://prometheus.io/" rel="noopener ugc nofollow" target="_blank">普罗米修斯</a>和<a class="ae lj" href="https://grafana.com/" rel="noopener ugc nofollow" target="_blank">格拉夫纳</a></li><li id="4c4e" class="la lb it js b jt lk jx ll kb lm kf ln kj lo kn lf lg lh li bi translated">测井:<a class="ae lj" href="https://fluentbit.io/" rel="noopener ugc nofollow" target="_blank">流畅钻头</a>、<a class="ae lj" href="https://www.elastic.co/" rel="noopener ugc nofollow" target="_blank">弹性搜索</a>、<a class="ae lj" href="https://www.elastic.co/products/kibana" rel="noopener ugc nofollow" target="_blank">基巴纳</a>和<a class="ae lj" href="https://github.com/lmenezes/cerebro" rel="noopener ugc nofollow" target="_blank">脑波机</a></li><li id="5b44" class="la lb it js b jt lk jx ll kb lm kf ln kj lo kn lf lg lh li bi translated">备份:<a class="ae lj" href="https://github.com/heptio/ark" rel="noopener ugc nofollow" target="_blank">方舟</a>、<a class="ae lj" href="https://restic.net/" rel="noopener ugc nofollow" target="_blank"> Restic </a>和<a class="ae lj" href="https://www.minio.io/" rel="noopener ugc nofollow" target="_blank"> Minio </a></li><li id="bc30" class="la lb it js b jt lk jx ll kb lm kf ln kj lo kn lf lg lh li bi translated">控制器负载平衡:<a class="ae lj" href="http://gobetween.io/" rel="noopener ugc nofollow" target="_blank"> gobetween </a></li><li id="154d" class="la lb it js b jt lk jx ll kb lm kf ln kj lo kn lf lg lh li bi translated">包装经理:<a class="ae lj" href="https://helm.sh/" rel="noopener ugc nofollow" target="_blank">掌舵人</a></li><li id="7c44" class="la lb it js b jt lk jx ll kb lm kf ln kj lo kn lf lg lh li bi translated">仪表板:<a class="ae lj" href="https://github.com/kubernetes/dashboard" rel="noopener ugc nofollow" target="_blank"> Kubernetes仪表板</a></li><li id="c795" class="la lb it js b jt lk jx ll kb lm kf ln kj lo kn lf lg lh li bi translated">使用和<a class="ae lj" href="https://www.mysql.com/" rel="noopener ugc nofollow" target="_blank"> MySQL </a>来测试安装</li></ul><p id="4120" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">即使<strong class="js iu"> k8s-tew </strong>能够在多个节点上部署HA集群，一个有趣的特性是能够在单个节点上部署完整的功能集群，从而促进kubernetes的自我培训。</p><p id="c516" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae lj" href="https://darxkies.github.io/k8s-tew/" rel="noopener ugc nofollow" target="_blank">文档</a>的快速入门部分是关于单节点设置的，而且非常简单:</p><pre class="kp kq kr ks gt lp lq lr ls aw lt bi"><span id="bb85" class="lu lv it lq b gy lw lx l ly lz"><em class="ma"># Switch to user root</em><br/>sudo su -</span><span id="ed57" class="lu lv it lq b gy mb lx l ly lz"><em class="ma"># Download Binary</em><br/>wget https://github.com/darxkies/k8s-tew/releases/download/2.2.4/k8s-tew<br/>chmod a+x k8s-tew<br/><br/><em class="ma"># Everything is installed relative to the root directory</em><br/>export K8S_TEW_BASE_DIRECTORY=/<br/><br/><em class="ma"># Create cluster data</em><br/>./k8s-tew initialize<br/>./k8s-tew node-add -s </span><span id="7dcc" class="lu lv it lq b gy mb lx l ly lz"># Only on Ubuntu 18.04 :<br/>./k8s-tew configure --resolv-conf=/run/systemd/resolve/resolv.conf</span><span id="f965" class="lu lv it lq b gy mb lx l ly lz"><em class="ma"># Prepare cluster<br/></em>./k8s-tew generate<br/><br/><em class="ma"># Activate and start service</em><br/>systemctl daemon-reload<br/>systemctl enable k8s-tew<br/>systemctl start k8s-tew</span></pre><p id="d6a4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，您可以在以下位置下载您的<em class="ma"> kubeconfig </em>文件:</p><pre class="kp kq kr ks gt lp lq lr ls aw lt bi"><span id="1a5a" class="lu lv it lq b gy lw lx l ly lz">/etc/k8s-tew/k8s/kubeconfig/admin.kubeconfig</span></pre><p id="d36c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">…几分钟后(Kubernetes收敛到所有应用程序设置所需的状态所需的时间)，您就可以享受您的Kubernetes集群了:</p><pre class="kp kq kr ks gt lp lq lr ls aw lt bi"><span id="2d2f" class="lu lv it lq b gy lw lx l ly lz"># List of PODs by namespace<br/>NAMESPACE     NAME<br/>backup        ark-7bbcb7ff9b-t6jq5<br/>backup        minio-85974b6ff-d8b58<br/>backup        restic-rzfgh<br/>default       elasticsearch-operator-sysctl-6tzfh<br/>kube-system   coredns-74c648b76d-hf724<br/>kube-system   coredns-74c648b76d-rczxk<br/>kube-system   etcd-lab1<br/>kube-system   gobetween-lab1<br/>kube-system   heapster-heapster-849c47d8c9-wxznk<br/>kube-system   kube-apiserver-lab1<br/>kube-system   kube-controller-manager-lab1<br/>kube-system   kube-proxy-lab1<br/>kube-system   kube-scheduler-lab1<br/>kube-system   kubernetes-dashboard-565db58d47-4v46w<br/>kube-system   tiller-deploy-c8bfd74c4-525mc<br/>logging       cerebro-elasticsearch-cluster-7785948b9d-85dd9<br/>logging       elasticsearch-operator-5c597554d4-v5dpr<br/>logging       es-client-elasticsearch-cluster-cb795d4b8-g6f9x<br/>logging       es-data-elasticsearch-cluster-default-0<br/>logging       es-master-elasticsearch-cluster-default-0<br/>logging       fluent-bit-2d4nk<br/>logging       kibana-elasticsearch-cluster-7fb7f88f55-5fk65<br/>monitoring    alertmanager-kube-prometheus-0<br/>monitoring    kube-prometheus-exporter-kube-state-6599774694-tkznb<br/>monitoring    kube-prometheus-exporter-node-kx75d<br/>monitoring    kube-prometheus-grafana-6cc9c9c96b-ntk2r<br/>monitoring    metrics-server-5df85b997d-qwp5s<br/>monitoring    prometheus-kube-prometheus-0<br/>monitoring    prometheus-operator-7d9844f964-gx7mh<br/>networking    calico-node-v6v6x<br/>networking    cert-manager-58898b5d55-246mp<br/>networking    metallb-controller-7444c5f7b5-5kthm<br/>networking    metallb-speaker-pfrbp<br/>networking    nginx-ingress-controller-v8nnd<br/>networking    nginx-ingress-default-backend-7b84c755cc-88ncb<br/>showcase      mysql-54d86bc8d-4vlsb<br/>showcase      wordpress-65779ff967-sz8dc<br/>storage       ceph-mds-lab1-688dc7dcd-549tx<br/>storage       ceph-mgr-6fc4d984cd-k9hs2<br/>storage       ceph-mon-lab1-6db48dc68d-vcpvn<br/>storage       ceph-osd-lab1-5d8c7dc6bc-9548r<br/>storage       ceph-rgw-6fcb67fd78-vlwg2<br/>storage       csi-cephfsplugin-attacher-0<br/>storage       csi-cephfsplugin-gdjvg<br/>storage       csi-cephfsplugin-provisioner-0<br/>storage       csi-rbdplugin-attacher-0<br/>storage       csi-rbdplugin-provisioner-0<br/>storage       csi-rbdplugin-vwr75</span></pre><p id="5d18" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，您可以访问:</p><ul class=""><li id="e0bf" class="la lb it js b jt ju jx jy kb lc kf ld kj le kn lf lg lh li bi translated">WordPress showcase:<a class="ae lj" href="http://[node-ip]:30100" rel="noopener ugc nofollow" target="_blank">http://[node-IP]:30100</a></li><li id="bdce" class="la lb it js b jt lk jx ll kb lm kf ln kj lo kn lf lg lh li bi translated">minio UI:<a class="ae lj" href="http://[node-ip]:30800" rel="noopener ugc nofollow" target="_blank">http://[node-IP]:30800</a></li><li id="c047" class="la lb it js b jt lk jx ll kb lm kf ln kj lo kn lf lg lh li bi translated">grafana UI:<a class="ae lj" href="http://[node-ip]:30900" rel="noopener ugc nofollow" target="_blank">http://[node-IP]:30900</a></li><li id="09d9" class="la lb it js b jt lk jx ll kb lm kf ln kj lo kn lf lg lh li bi translated">基巴纳UI:<a class="ae lj" href="https://[node-ip]:30980" rel="noopener ugc nofollow" target="_blank">https://[node-IP]:30980</a></li><li id="2629" class="la lb it js b jt lk jx ll kb lm kf ln kj lo kn lf lg lh li bi translated">脑波强化器UI:<a class="ae lj" href="http://[node-ip]:30990" rel="noopener ugc nofollow" target="_blank">http://[node-IP]:30990</a></li><li id="71b0" class="la lb it js b jt lk jx ll kb lm kf ln kj lo kn lf lg lh li bi translated">ceph UI:<a class="ae lj" href="https://[node-ip]:30700" rel="noopener ugc nofollow" target="_blank">https://[node-IP]:30700</a></li></ul><h1 id="1716" class="mc lv it bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated"><strong class="ak">主观观点:</strong></h1><p id="0b57" class="pw-post-body-paragraph jq jr it js b jt mz jv jw jx na jz ka kb nb kd ke kf nc kh ki kj nd kl km kn im bi translated">我认为<strong class="js iu"> k8s-tew </strong>是一个非常好的工具，可以用来玩Kubernetes和管理“第二天”,而不仅仅是k8s raw设置。但我不建议在生产中使用<strong class="js iu"> k8s-tew </strong>，因为这个项目到目前为止只有一个人维护(达克斯·基斯/<a class="ae lj" href="https://github.com/darxkies" rel="noopener ugc nofollow" target="_blank">https://github.com/darxkies</a>，非常感谢他为社区提供了这个项目)，他于2018年6月开始了这个项目。这个项目确实应该得到更多人的支持。</p><p id="a32a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<a class="ae lj" href="https://darxkies.github.io/k8s-tew/" rel="noopener ugc nofollow" target="_blank">https://darxkies.github.io/k8s-tew/</a>上自己发现<strong class="js iu"> k8s-tew </strong></p><p id="5ffc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ma">编辑:更多设置选项，请参见:</em><a class="ae lj" href="https://github.com/darxkies/k8s-tew/tree/master/setup" rel="noopener ugc nofollow" target="_blank"><em class="ma">https://github.com/darxkies/k8s-tew/tree/master/setup</em></a></p></div></div>    
</body>
</html>