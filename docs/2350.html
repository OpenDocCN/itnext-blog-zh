<html>
<head>
<title>How to send JWT automatically in Angular HTTP requests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在角度HTTP请求中自动发送JWT</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-send-jwt-automatically-in-angular-http-requests-31c1fd060871?source=collection_archive---------4-----------------------#2019-05-09">https://itnext.io/how-to-send-jwt-automatically-in-angular-http-requests-31c1fd060871?source=collection_archive---------4-----------------------#2019-05-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/4310fc13cb21f378ec504cdee89f3801.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z-J_z14pcGnUnBCjxUU-RQ.png"/></div></div></figure><div class=""/><div class=""><h2 id="2237" class="pw-subtitle-paragraph kb jd je bd b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dk translated">使用HTTP拦截器自动包含JWT</h2></div><p id="6b67" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">Angular 是一个强大的框架，用于开发高度可扩展的企业级应用。它集成了许多功能，如模板，测试支持，动画，路由和HTTP请求。由于许多API要求对请求者进行身份验证，所以客户端必须发送某种后端可以验证的令牌。</p><p id="ec44" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><a class="ae lp" href="https://jwt.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv jf">【JSON Web令牌】</strong> </a> <strong class="kv jf"> </strong>是一种开放的行业标准方法，用于安全地表示双方之间的索赔。它们包含JSON编码的数据。这意味着您可以让您的JWT存储任意多的JSON数据，并且可以将您的令牌字符串解码成JSON对象。这使得它们便于嵌入信息。</p><p id="31ea" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们将使用<a class="ae lp" href="https://angular.io/api/common/http/HttpClient" rel="noopener ugc nofollow" target="_blank"><strong class="kv jf">HTTP client</strong></a><strong class="kv jf"/>来发出经过认证的HTTP请求。由于Angular支持HTTP拦截器(从版本4.3开始)，我们可以在请求被发送到后端之前自动修改它。在本教程中，我将使用现有的库(<a class="ae lp" href="https://github.com/auth0/angular2-jwt" rel="noopener ugc nofollow" target="_blank">由Auth0的专家开发)</a>为每个请求自动包含JWT，这样我们就不需要自己编写HTTP拦截器了。请注意，这不适用于已弃用的<a class="ae lp" href="https://angular.io/api/http/Http" rel="noopener ugc nofollow" target="_blank"><em class="lq">Http</em></a><em class="lq"/>服务，而仅适用于HttpClient，因为已弃用的Http不支持Http拦截器。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h2 id="aee9" class="ly lz je bd ma mb mc dn md me mf dp mg lc mh mi mj lg mk ml mm lk mn mo mp mq bi translated">如何用Angular在每个HTTP请求中发送JWT</h2><ol class=""><li id="d2a7" class="mr ms je kv b kw mt kz mu lc mv lg mw lk mx lo my mz na nb bi translated">使用NPM<code class="fe nc nd ne nf b"><strong class="kv jf">npm install @auth0/angular-jwt</strong></code>安装<a class="ae lp" href="https://github.com/auth0/angular2-jwt" rel="noopener ugc nofollow" target="_blank"><strong class="kv jf"><em class="lq">angular-jwt</em></strong></a>库。或者，<a class="ae lp" href="https://angular.io/guide/http#intercepting-requests-and-responses" rel="noopener ugc nofollow" target="_blank">自己创建一个HTTP拦截器</a>。</li><li id="0057" class="mr ms je kv b kw ng kz nh lc ni lg nj lk nk lo my mz na nb bi translated">在您的<em class="lq"> AppModule </em>中，您需要<strong class="kv jf">为拦截器提供检索JWT </strong>的方法。这应该使HttpClient能够获得JWT并将其包含在每个请求中。通常，您将令牌存储在<a class="ae lp" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies" rel="noopener ugc nofollow" target="_blank"> cookie </a>(首选)或<a class="ae lp" href="https://developer.mozilla.org/de/docs/Web/API/Storage" rel="noopener ugc nofollow" target="_blank">浏览器存储器</a>中。</li><li id="18f8" class="mr ms je kv b kw ng kz nh lc ni lg nj lk nk lo my mz na nb bi translated">在您的模块中导入<a class="ae lp" href="https://github.com/auth0/angular2-jwt" rel="noopener ugc nofollow" target="_blank"><strong class="kv jf">http client module</strong></a><strong class="kv jf"/>。为了在组件/服务/管道/指令中注入HttpClient服务，这是必需的。</li><li id="3c63" class="mr ms je kv b kw ng kz nh lc ni lg nj lk nk lo my mz na nb bi translated">使用<strong class="kv jf"> HttpClient </strong>发送HTTP请求，该请求现在将自动包含JWT。</li></ol></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h2 id="9410" class="ly lz je bd ma mb mc dn md me mf dp mg lc mh mi mj lg mk ml mm lk mn mo mp mq bi translated">导入必要模块的示例AppModule</h2><pre class="nl nm nn no gt np nf nq nr aw ns bi"><span id="e24b" class="ly lz je nf b gy nt nu l nv nw">// called on every request to retrieve the token<br/>export function jwtOptionsFactory(tokenService: TokenService) {<br/>  return {<br/>    tokenGetter: () =&gt; tokenService.getToken(),<br/>    whitelistedDomains: ['my-domain', 'my-domain2']<br/>  };<br/>}<br/>// the actual module imports<br/>@NgModule({<br/>  declarations: [...],<br/>  imports: [HttpClientModule, JwtModule.forRoot({<br/>      jwtOptionsProvider: {<br/>        provide: JWT_OPTIONS,<br/>        useFactory: jwtOptionsFactory,<br/>        deps: [TokenService]<br/>      }<br/>    }),<br/>  providers: [...]<br/>}</span></pre><p id="d33b" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">下面是一个示例服务，它使用HttpClient发出创建用户的POST请求。</p><pre class="nl nm nn no gt np nf nq nr aw ns bi"><span id="644b" class="ly lz je nf b gy nt nu l nv nw"><a class="ae lp" href="http://twitter.com/Injectable" rel="noopener ugc nofollow" target="_blank">@Injectable</a>({providedIn: 'root'})<br/>export class UserService {</span><span id="8246" class="ly lz je nf b gy nx nu l nv nw">  constructor(private httpClient: HttpClient) {}</span><span id="b87d" class="ly lz je nf b gy nx nu l nv nw">  createUser(route: string, body: User) {<br/>    return this.httpClient.post(route, body);<br/>  }<br/>  <br/>}</span></pre></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h2 id="f18c" class="ly lz je bd ma mb mc dn md me mf dp mg lc mh mi mj lg mk ml mm lk mn mo mp mq bi translated">结论</h2><p id="4f37" class="pw-post-body-paragraph kt ku je kv b kw mt kf ky kz mu ki lb lc ny le lf lg nz li lj lk oa lm ln lo im bi translated">感谢阅读这篇文章。如您所见，很容易在每个HTTP请求上自动发送JWT。如果您需要更多的自定义行为和功能，您可以简单地编写自己的Angular支持的HTTP拦截器。如果这篇文章对你有帮助，请在评论中告诉我。</p><p id="a2ce" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">关于JWT的进一步推荐文章:</p><ul class=""><li id="8973" class="mr ms je kv b kw kx kz la lc ob lg oc lk od lo oe mz na nb bi translated"><a class="ae lp" href="https://jwt.io/introduction/" rel="noopener ugc nofollow" target="_blank"><em class="lq">JSON Web Token简介</em> </a></li><li id="b620" class="mr ms je kv b kw ng kz nh lc ni lg nj lk nk lo oe mz na nb bi translated"><a class="ae lp" href="https://blog.codecentric.de/en/2017/08/use-json-web-tokens-services/" rel="noopener ugc nofollow" target="_blank"> <em class="lq">如何以及何时使用JSON Web令牌为您服务</em> </a></li><li id="f52b" class="mr ms je kv b kw ng kz nh lc ni lg nj lk nk lo oe mz na nb bi translated">如果你的JWT被偷了会怎么样？ </li></ul></div></div>    
</body>
</html>