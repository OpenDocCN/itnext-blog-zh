<html>
<head>
<title>Sandboxed Containers: Are Virtual Machines making a Comeback in a new Avatar?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">沙盒容器:虚拟机在新的虚拟角色中卷土重来了吗？</h1>
<blockquote>原文：<a href="https://itnext.io/sandboxed-containers-are-virtual-machines-making-a-comeback-in-a-new-avatar-cf83e1c4a5fb?source=collection_archive---------3-----------------------#2021-11-08">https://itnext.io/sandboxed-containers-are-virtual-machines-making-a-comeback-in-a-new-avatar-cf83e1c4a5fb?source=collection_archive---------3-----------------------#2021-11-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/5ae8b47d8e4b6536ad11b2f74d32887c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZnLeM-QwkQ0JWsrv.jpg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">马加瓦(鸣谢:images.twinkl.co.uk)</figcaption></figure><p id="9d5d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一只能够探测未爆炸地雷的冈比亚囊鼠Magawa发现了许多地雷和柬埔寨内战遗留的其他军械。2020年9月，这只老鼠被授予PDSA金质奖章，这是一项动物勇敢奖，旨在表彰动物的勇敢和对职责的奉献。(来源:维基百科)</p><h1 id="9a62" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">介绍</h1><p id="1b5d" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">人工智能、大数据和区块链等数字技术正在推动对可以在微秒内大规模扩展的应用的需求。企业内部的开发人员面临着在几天内大量生产新功能的压力。混合云是新常态，数字化转型是保持竞争力的必要条件。容器已经成为应对这些挑战的重要技术。容器在开发人员和操作人员中的巨大成功已经见证了这种技术在各种行业中的快速广泛应用。</p><h1 id="9953" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">集装箱太棒了</h1><p id="3bf2" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">容器技术几乎已经取代虚拟化成为消耗本地和云计算资源的主要手段。虚拟机本质上是一种硬件虚拟化技术，即在裸机主机上运行的一款名为VMM的软件控制硬件资源(CPU、内存、硬盘等)。)并将它们呈现为多个离散的虚拟资源。这允许在主机上运行多个离散的虚拟机，每个虚拟机都有自己的操作系统。</p><p id="3cfb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">另一方面，容器不虚拟化硬件，而是使用主机操作系统内核的高级功能(cgroups和namespaces)在主机上创建一个隔离的计算环境。应用程序在这个隔离的计算环境中运行。对于应用程序来说，容器就像一个虚拟机，而对于主机来说，容器只是另一个进程。简而言之，您可以将一个运行操作系统的裸机服务器(或虚拟服务器)变成一个由独立容器组成的盘子。然而，所有这些容器都共享主机的OS内核。</p><h1 id="2a73" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">虚拟机提供了强大的隔离</h1><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi me"><img src="../Images/60866a17d8e9fdfaa0f59c58d4d98b00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/0*-GzeJthk4yvc3rvj.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">信用:unit42.paloaltonetworks.com</figcaption></figure><p id="8bf3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">虽然容器很棒，但是人们应该认识到这样一个事实，在一个服务器上运行的多个容器，<strong class="ke ir">共享同一个操作系统内核</strong>。而且，与任何软件一样，容器化的应用程序也可能存在安全漏洞。这些漏洞的来源可能存在于应用程序源代码或应用程序使用的某个库中。在这种情况下，如果恶意用户利用这些漏洞并能够侵入容器，入侵者很有可能能够推进攻击并渗透到主机内核中。如果发生这种情况，结果可能是灾难性的，因为这也暴露了主机上的其余容器。</p><p id="d949" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果同一个应用程序在一个虚拟机中运行，那么入侵者最多只能渗透到该虚拟机的客户内核中，而无法访问服务器的内核。这样，安全攻击仅限于受影响的虚拟机，服务器上的其他虚拟机不受影响。简而言之，与容器相比，VM提供了更高程度的隔离，因为它有自己的内核。</p><h1 id="673b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">沙盒容器:轻量级虚拟机</h1><p id="0ae3" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">因为容器共享来自主机的更多资源，所以它们对存储、内存和CPU周期的使用比VM高效得多。然而，更多共享的缺点是容器和主机之间的信任边界较弱。一般来说，虚拟化硬件隔离比容器中使用的名称空间隔离创建了更强的安全边界。攻击者逃离容器(进程)的风险远远高于逃离虚拟机的机会。一些应用和用例确实需要高度的隔离，同时需要容器的优势，即两全其美。例如，为多个租户提供服务的系统需要很强的隔离，这样应用程序数据就不会泄露。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mj"><img src="../Images/2b7608c9ccd88e3e2857882216777533.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dc1jB1NUXxD9NAKE"/></div></div></figure><p id="32b9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一个显而易见的问题是:有没有一种方法可以让我运行一个容器化的应用程序，同时从虚拟机提供的高度隔离中获益？答案是响亮的“是”。欢迎来到名为<strong class="ke ir">沙盒容器</strong>的新型容器。</p><p id="6785" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">简而言之，这些容器有自己的内核，很像虚拟机。内核的这一层被称为<strong class="ke ir">用户空间内核</strong>。然而，这个内核在本质上是非常轻量级的，使用现代编程技术编写，并且只是为了充当容器和主机之间的一个额外的强隔离层而专门构建的。</p><p id="b8ee" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">因此，它可以动态配置，可以快速创建和销毁。如果符合开放容器倡议(OCI)和容器运行时接口(CRI)规范，这种沙盒容器也可以与Docker和Kubernetes等容器工具配合使用。</p><p id="4435" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在接下来的章节中，我们将深入研究两种广泛使用的沙盒容器技术:Google gVisor和Kata容器</p><h1 id="2813" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">谷歌眼镜</h1><p id="ec9e" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">gVisor是一个用Go编写的应用程序内核，它实现了Linux系统调用接口的很大一部分。它在运行的应用程序和主机操作系统之间提供了一个额外的隔离层。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mk"><img src="../Images/4bed64f9f6e9a5be9a960ae7521c7c03.png" data-original-src="https://miro.medium.com/v2/resize:fit:742/0*n79UNZfDHI3nJ0av"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">信用:gvisor.io</figcaption></figure><p id="d561" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">它包括一个名为<code class="fe ml mm mn mo b">runsc</code>的OCI运行时，使得使用现有的容器工具变得容易。<code class="fe ml mm mn mo b">runsc</code>运行时与Docker和Kubernetes集成，使得运行沙盒容器变得简单。gVisor可以配合Docker、Kubernetes使用，也可以直接使用<code class="fe ml mm mn mo b">runsc</code></p><p id="106d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当您使用gVisor启动一个容器时，runsc容器运行时会首先启动一个用户空间内核的实例。用户空间内核充当另一层防御，它拦截来自容器的系统调用，或者自己处理这些调用，或者将它们传递给主机。实际的应用程序是在这个用户空间内核之上启动的。为了让事情更有吸引力，gVisor是一个开源项目，所以当您看到需要时，可以添加新的功能和增强。它也符合CRI规范，所以gVisor容器可以在Kubernetes中运行。</p><h1 id="418a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Kata容器</h1><p id="8d97" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">Kata容器与容器一样轻便快捷，并与容器管理层集成，包括Docker和Kubernetes (K8s)等流行的编排工具，同时还提供了虚拟机的安全优势。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/ce28988d2c82000b6dfa9620dd66cd55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1L7kt6frgEFej2nwg4Q85g.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Credit: katacontainers.io</figcaption></figure><p id="0fac" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Kata容器与OCI、容器运行时接口(CRI)和容器网络接口(CNI)完全集成。它支持各种类型的网络模型(例如，直通、MacVTap、桥接、tc镜像)和可配置的客户内核，因此需要特殊网络模型或内核版本的应用程序都可以在其上运行。上图显示了Kata虚拟机中的容器如何与现有的编排平台进行交互。</p><p id="78eb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Kata在主机上有一个<em class="la"> kata运行时</em>来启动和配置新的容器。对于Kata VM中的每个容器，主机上都有一个对应的Kata Shim。Kata Shim从客户端(例如docker或kubectl)接收API请求，并通过VSock将请求转发给Kata VM内部的代理。Kata容器进一步做了一些优化来减少VM启动时间。</p><h1 id="19ef" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="f74b" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">与普通容器相比，沙盒容器提供了更强的隔离。这种高度隔离提供了额外的安全层，在一些使用案例和行业中非常有用。这种容器技术符合OCI和CRI规范，因此它们可以很好地与现有的容器工具和Kubernetes兼容。看到虚拟机如何在新的虚拟角色中卷土重来，真是太神奇了！</p><p id="e238" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">感谢阅读。如果你喜欢这篇文章，请在Twitter( <a class="ae mq" href="https://twitter.com/senthilrch" rel="noopener ugc nofollow" target="_blank"> @senthilch </a>)和Medium(<a class="mr ms ep" href="https://medium.com/u/35b3e4a1e602?source=post_page-----cf83e1c4a5fb--------------------------------" rel="noopener" target="_blank">Senthil Raja Chermapandian</a>)上关注我</p><p id="7cbb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="la">查看</em><a class="ae mq" href="https://github.com/senthilrch/kube-fledged" rel="noopener ugc nofollow" target="_blank"><em class="la"/></a><em class="la">，这是一个Kubernetes操作器，用于直接在集群工作节点上创建和管理容器图像的缓存，因此应用程序pods几乎可以立即启动</em></p></div></div>    
</body>
</html>