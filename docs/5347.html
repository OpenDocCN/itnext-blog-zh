<html>
<head>
<title>Getting started with GraphQL in Python with FastAPI and Graphene</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用FastAPI和Graphene开始使用Python中的GraphQL</h1>
<blockquote>原文：<a href="https://itnext.io/getting-started-with-graphql-in-python-with-fastapi-and-graphene-abb4f3eb04f4?source=collection_archive---------0-----------------------#2021-02-14">https://itnext.io/getting-started-with-graphql-in-python-with-fastapi-and-graphene-abb4f3eb04f4?source=collection_archive---------0-----------------------#2021-02-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/2cc2dde9251aab9a947a8d3cf60317c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cawCoz83tcpA-QFh.png"/></div></div></figure><p id="eacf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇文章是<a class="ae kw" href="http://blog.adnansiddiqi.me/tag/fastapi/" rel="noopener ugc nofollow" target="_blank"> FastAPI系列</a>的一部分。</p><p id="05cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是另一篇与FastAPI(间接)相关的帖子，我将在其中讨论如何使用基于GraphQL的API来访问和操作数据。在之前的<a class="ae kw" href="http://blog.adnansiddiqi.me/create-your-first-rest-api-in-fastapi/" rel="noopener ugc nofollow" target="_blank">帖子</a>中，我已经讨论过如何在FastAPI框架中创建Rest API。我们将学习GraphQL的一些基础知识，以及graphene如何帮助我们使用Python编写基于GraphQL的应用程序。所以，让我们开始吧！</p><h1 id="2577" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">什么是GraphQL</h1><p id="758c" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">来自官网:</p><blockquote class="ma mb mc"><p id="bc54" class="jy jz md ka b kb kc kd ke kf kg kh ki me kk kl km mf ko kp kq mg ks kt ku kv ij bi translated">GraphQL是一种API查询语言，也是一种用现有数据完成这些查询的运行时语言。GraphQL为API中的数据提供了完整且易于理解的描述，使客户能够准确地要求他们需要的东西，使API更容易随时间发展，并支持强大的开发工具</p></blockquote><p id="2ebf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">GraphQL是由Lee Byron和他的团队在2012年内部开发的，用于许多内部项目，包括脸书移动应用程序，后来在2015年公开发布。</p><p id="bd9e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">官网提供了一个<a class="ae kw" href="https://graphql.org/learn/" rel="noopener ugc nofollow" target="_blank">学习GraphQL不同部分的优秀资源</a>，具体可以参考。在这里，我将更多地讨论Python中的实现。不要担心，我会分享一些基本的东西。</p><p id="d272" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在继续之前，让我们设置一下本地开发环境。像以前的<a class="ae kw" href="http://blog.adnansiddiqi.me/tag/fastapi" rel="noopener ugc nofollow" target="_blank"> FastAPI帖子</a>一样，我也将在这里使用<code class="fe mh mi mj mk b">Pipenv</code>。除了安装<a class="ae kw" href="https://graphene-python.org/" rel="noopener ugc nofollow" target="_blank">石墨烯</a>之外，我不打算重复所有步骤。</p><h1 id="700b" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">石墨烯是什么</h1><p id="589f" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">来自官方<a class="ae kw" href="https://graphene-python.org/" rel="noopener ugc nofollow" target="_blank">网站</a>:</p><blockquote class="ma mb mc"><p id="89db" class="jy jz md ka b kb kc kd ke kf kg kh ki me kk kl km mf ko kp kq mg ks kt ku kv ij bi translated">Graphene-Python是一个用于在Python中轻松构建GraphQL APIs的库，其主要目标是提供一个简单但可扩展的API，使开发人员的生活更加轻松。</p></blockquote><p id="321c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">简而言之，它可以帮助您轻松设置GraphQL特性。</p><p id="6b4a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">GraphQL提供了一个测试GraphQL查询的平台。它输入GraphQL服务器的URL并让您测试查询。我将首先设置操场，然后我们将开始编码我们的应用程序。应用程序是一样的:联系人管理系统。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="a866" class="mt ky iq mk b gy mu mv l mw mx">import graphene<br/>from fastapi import FastAPI<br/>from starlette.graphql import GraphQLApp</span><span id="6ba1" class="mt ky iq mk b gy my mv l mw mx">class Query(graphene.ObjectType):<br/>    hello = graphene.String(name=graphene.String(default_value="stranger"))</span><span id="b9e4" class="mt ky iq mk b gy my mv l mw mx">def resolve_hello(self,info,name):<br/>        return "Hello " + name</span><span id="09a1" class="mt ky iq mk b gy my mv l mw mx">app = FastAPI(title='ContactQL', description='GraphQL Contact APIs', version='0.1')<br/><a class="ae kw" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.get("/")<br/>async def root():<br/>    return {"message": "Contact Applications!"}</span><span id="8083" class="mt ky iq mk b gy my mv l mw mx">app.add_route("/graphql", GraphQLApp(schema=graphene.Schema(query=Query)))</span></pre><p id="7745" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">导入<code class="fe mh mi mj mk b">graphene</code>后我是导入<code class="fe mh mi mj mk b">GraphQLApp</code>。GraphQL工具实际上是由<em class="md"> Starlette </em>提供的。由于FastAPI正在使用Starlette，因此它对我们来说是自动可用的。</p><p id="6976" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我进入<code class="fe mh mi mj mk b">http://localhost:8080/grapgql</code>时，显示如下界面:</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c4db451caaacb091132946e3beb2330d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ECdxXRPXa4vJbjIx.png"/></div></div></figure><p id="344d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不要对这里写的东西感到恐慌。我想透露的是，你在上面看到的花哨界面之所以可用，只是因为有了这条线<code class="fe mh mi mj mk b">app.add_route("/graphql", GraphQLApp(schema=graphene.Schema(query=Query)))</code></p><p id="2430" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好了，现在我们已经为运行不同的查询准备好了场地。是时候学习GraphQL查询的基础知识了。</p><h1 id="9600" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">问题</h1><p id="5d3f" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">关于GraphQL，您需要知道的第一件事是查询graphql服务器。您遵循特定的语法:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="f9c2" class="mt ky iq mk b gy mu mv l mw mx">{<br/>  hello<br/>}</span></pre><p id="5ba5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你在上面看到的东西实际上是在调用一个对象，在这里，<code class="fe mh mi mj mk b">hello</code>是一个对象。您向graphql服务器传递一个JSONish like查询，它返回:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="d2d9" class="mt ky iq mk b gy mu mv l mw mx">{<br/>  "data": {<br/>    "hello": "Hello stranger"<br/>  }<br/>}</span></pre><p id="9218" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如您所见，graphql查询非常类似于返回的JSON。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="f7b7" class="mt ky iq mk b gy mu mv l mw mx">query {<br/> hello <br/>}</span></pre><p id="1cda" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了更好地理解，您可以在查询中显式传递<code class="fe mh mi mj mk b">query</code>关键字。</p><p id="99e2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好吧，上面的查询是在一个奇特的GraphQL交互界面中执行的，但是现实生活并不那么奇特。为了让前端应用程序与您的graphql服务器交互，您必须像访问典型的REST API一样访问它。下面是上面的cURL版本:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="6400" class="mt ky iq mk b gy mu mv l mw mx">curl '<a class="ae kw" href="http://127.0.0.1:8000/graphql'" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/graphql'</a> \<br/>  -H 'Content-Type: application/json' \<br/>  --data-raw '{"query":"{hello}"}' \<br/>  --compressed</span></pre><p id="5d10" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在《邮差》中，它看起来像是:</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/43c1bceaf7a5642779caf5e4426ae272.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iD5jWrojiDDgzhsL.png"/></div></div></figure><p id="29bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">听起来很酷，不是吗？<code class="fe mh mi mj mk b">GET</code>版本打开交互式客户端，而<code class="fe mh mi mj mk b">POST</code>调用实际上用于执行GraphQL查询。在生产代码中，您可能不喜欢向您的用户提供<strong class="ka ir"> <em class="md"> graphiql </em> </strong>接口。您可以简单地通过在<code class="fe mh mi mj mk b">GraphQLApp</code>构造函数中传递<code class="fe mh mi mj mk b">graphiql=False</code>来禁用它。但我保留它是为了测试的目的。</p><p id="d116" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们开始真正的应用程序。在<a class="ae kw" href="http://blog.adnansiddiqi.me/getting-started-with-fastapi-and-mysql/" rel="noopener ugc nofollow" target="_blank">之前的帖子</a>中，我制作了必要的DB和模型相关文件，所以我在这里只是使用它们。我在这里复制了<code class="fe mh mi mj mk b">models</code>文件夹和<code class="fe mh mi mj mk b">database.py</code>文件。当前文件夹结构如下所示:</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/d65a060d7ce67f8d79a0a2f6e3d2db4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/0*oXYmN0vhX26NNrJw.png"/></div></figure><p id="a7f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好了，现在我要对<code class="fe mh mi mj mk b">main.py</code>文件做一些修改。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="5c7e" class="mt ky iq mk b gy mu mv l mw mx">import graphene<br/>from fastapi import FastAPI<br/>from starlette.graphql import GraphQLApp</span><span id="3093" class="mt ky iq mk b gy my mv l mw mx">from models.contact import list_contacts</span><span id="13f3" class="mt ky iq mk b gy my mv l mw mx">class Contact(graphene.ObjectType):<br/>    first_name = graphene.String()<br/>    last_name = graphene.String()<br/>    email = graphene.String()</span><span id="745e" class="mt ky iq mk b gy my mv l mw mx">class QueryContact(graphene.ObjectType):<br/>    contacts = graphene.List(Contact)</span><span id="3e8a" class="mt ky iq mk b gy my mv l mw mx"><a class="ae kw" href="http://twitter.com/staticmethod" rel="noopener ugc nofollow" target="_blank">@staticmethod</a><br/>    def resolve_contacts(self, info):<br/>        records = []<br/>        contacts = list_contacts()<br/>        for c in contacts:<br/>            records.append({'first_name': c.first_name, 'last_name': c.last_name, 'email': c.email})</span><span id="e87e" class="mt ky iq mk b gy my mv l mw mx">return records</span></pre><p id="d480" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">导入所有必要的东西后，我正在创建一个类型为<code class="fe mh mi mj mk b">graphene.ObjectType</code>的类<code class="fe mh mi mj mk b">Contact</code>。这样做的原因是我们必须暴露某些领域的联系。因为目的是显示联系人列表，然后我们将它传递给接受类类型的<code class="fe mh mi mj mk b">graphene.List</code>。你可以在这里了解更多。</p><p id="53b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建完类后，我在<code class="fe mh mi mj mk b">QueryContact</code>类中创建了一个字段<code class="fe mh mi mj mk b">contacts</code>，它的类型是<code class="fe mh mi mj mk b">List</code>。您可以在其中传递任何类型。在我们的例子中，它属于<code class="fe mh mi mj mk b">Contact</code>类型。</p><p id="0a53" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">resolver方法中的代码是不言自明的。它从<code class="fe mh mi mj mk b">contacts</code>表中取出记录并追加到<code class="fe mh mi mj mk b">records</code>列表中</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/2ec899ac95d49bab01f4626e9794ca26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*zv5gQGNWnRcTttsU.gif"/></div></figure><p id="0fa3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里，根对象是<code class="fe mh mi mj mk b">contacts</code>。如果你想知道为什么它会显示联系人。这是因为我们在类型为<code class="fe mh mi mj mk b">List</code>的<code class="fe mh mi mj mk b">QueryContact</code>类中定义了一个名为的字段。所有的子字段都是从类型为<code class="fe mh mi mj mk b">Contact</code>的类中获取的，该类本身也属于<code class="fe mh mi mj mk b">ObjectType</code>。</p><p id="812a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以无论你传递什么字段(确保它们是系统的一部分)，它们在这里都是可见的。下面是执行上述操作的cURL和Python请求版本，以防需要在系统中集成graphql。</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/07ee921314806d426d9de1c6ced7c8fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2Pqx360wlOcTCgdZ.png"/></div></div></figure><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b9df6a45c9850a77b32fe59a72157a96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eiOLdRstb7WcKX29.png"/></div></div></figure><p id="fe77" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面的例子返回了所有的项目，但是如果我想返回一个或多个符合特定条件的项目呢？Graphql为您提供了在查询中传递参数<a class="ae kw" href="https://graphql.org/learn/queries/#arguments" rel="noopener ugc nofollow" target="_blank">的选项。这就是你要做的:</a></p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="2406" class="mt ky iq mk b gy mu mv l mw mx">{<br/>  contacts(id:1) { <br/>     firstName<br/>     email<br/>  }<br/>}</span></pre><p id="288f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如你看到的，我正在传递一个参数，<code class="fe mh mi mj mk b">id</code>来过滤结果。代码现在将如下所示:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="1b6b" class="mt ky iq mk b gy mu mv l mw mx">class QueryContact(graphene.ObjectType):<br/>    contacts = graphene.List(Contact, id=graphene.Int())</span><span id="741c" class="mt ky iq mk b gy my mv l mw mx"><a class="ae kw" href="http://twitter.com/staticmethod" rel="noopener ugc nofollow" target="_blank">@staticmethod</a><br/>    def resolve_contacts(self, info, id=0):<br/>        records = []<br/>        result = None</span><span id="9df4" class="mt ky iq mk b gy my mv l mw mx">if id == 0:<br/>            contacts = list_contacts()<br/>            for c in contacts:<br/>                records.append({'first_name': c.first_name, 'last_name': c.last_name, 'email': c.email})<br/>            result = records<br/>        elif id &gt; 0:<br/>            contact = get_contact(id)<br/>            if contact is not None:<br/>                result = [{'first_name': contact.first_name, 'last_name': contact.last_name, 'email': contact.email}]<br/>            else:<br/>                result = []<br/>        return result</span></pre><p id="4f3c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mh mi mj mk b">contacts</code>字段传递了一个类型为<code class="fe mh mi mj mk b">graphene,Int()</code>的参数<code class="fe mh mi mj mk b">id</code>。一旦完成，我们将在<code class="fe mh mi mj mk b">resolve_contacts</code>方法中传递一个默认的<code class="fe mh mi mj mk b">id</code>参数。代码的其余部分应该是清楚的。我正在检查一个<code class="fe mh mi mj mk b">id</code>是否被传递，然后调用<code class="fe mh mi mj mk b">get_contact</code>，否则调用<code class="fe mh mi mj mk b">list_contacts()</code>。因为我们已经在使用list类型的<code class="fe mh mi mj mk b">contacts</code>，所以即使只有一条记录返回，它也会被包装在<code class="fe mh mi mj mk b">list</code>中。</p><p id="69b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">很酷，不是吗？如果您想将这些查询与RDBMS的SQL查询进行映射，那么应该是:<code class="fe mh mi mj mk b">SELECT first_name,email from contacts</code>，对于单个查询，应该是<code class="fe mh mi mj mk b">SELECT first_name,email from contacts where id = 2</code>。</p><h1 id="d87e" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">变化</h1><p id="112a" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">到目前为止，我们正在拉数据，如果我们想改变它，<a class="ae kw" href="https://graphql.org/learn/queries/#mutations" rel="noopener ugc nofollow" target="_blank">突变</a>允许您操纵数据。突变查询语法如下所示:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="7204" class="mt ky iq mk b gy mu mv l mw mx">mutation {<br/>  createContact(firstName:"Musab",lastName:"Siddiqi",email:"<a class="ae kw" href="mailto:musab@gmail.com" rel="noopener ugc nofollow" target="_blank">musab@gmail.com</a>",phone:"123-0393") {<br/>    id<br/>    firstName<br/>  }    <br/>}</span></pre><p id="10d5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们写代码吧！</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="6bbc" class="mt ky iq mk b gy mu mv l mw mx">from models.contact import list_contacts, get_contact, create_contact</span><span id="5578" class="mt ky iq mk b gy my mv l mw mx">class CreateContact(graphene.Mutation):<br/>    # These fields will be displayed after successful insert<br/>    id = graphene.Int()<br/>    first_name = graphene.String()</span><span id="60bd" class="mt ky iq mk b gy my mv l mw mx">class Arguments:<br/>        first_name = graphene.String()<br/>        last_name = graphene.String()<br/>        email = graphene.String()<br/>        phone = graphene.String()</span><span id="9068" class="mt ky iq mk b gy my mv l mw mx">def mutate(self, info, first_name, last_name, email, phone):<br/>        new_contact = create_contact(first_name=first_name, last_name=last_name, email=email, phone=phone, status=1)</span><span id="4269" class="mt ky iq mk b gy my mv l mw mx">if new_contact is None:<br/>            raise Exception('Contact with the given email already exists')</span><span id="dc40" class="mt ky iq mk b gy my mv l mw mx">return CreateContact(id=new_contact.id, first_name=new_contact.first_name)</span><span id="c77c" class="mt ky iq mk b gy my mv l mw mx">class Mutation(graphene.ObjectType):<br/>    create_contact = CreateContact.Field()</span><span id="424f" class="mt ky iq mk b gy my mv l mw mx">app.add_route("/graphql", GraphQLApp(graphiql=True, schema=graphene.Schema(query=QueryContact, mutation=Mutation)))</span></pre><p id="693b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以我创建了一个继承了类<code class="fe mh mi mj mk b">Mutation</code>的<code class="fe mh mi mj mk b">CreateContact</code>类。</p><p id="cbb1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我定义了几个字段。这些字段实际上显示了数据插入或删除/更新后的数据(<em class="md">是的，变异可用于任何类型的数据操作</em>)。然后，<code class="fe mh mi mj mk b">Arguments</code>类用于传递参数，这些参数包含将要插入的信息。<code class="fe mh mi mj mk b">mutate</code>方法实际上类似于<em class="md"> resolve_ </em>方法。这个方法的返回是类<code class="fe mh mi mj mk b">CreateContact</code>的对象。我们这样做是因为我们必须显示这些字段作为回报。然后，我正在创建一个继承了<code class="fe mh mi mj mk b">ObjectType</code>的类。该类包含类型为<code class="fe mh mi mj mk b">CreateContact</code>的字段<code class="fe mh mi mj mk b">create_contact</code>。最后，<code class="fe mh mi mj mk b">graphene.Schema</code>将被传递另一个设置<code class="fe mh mi mj mk b">Mutation</code>类的参数。代码的结果如下所示:</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/8570b4deb4069216886c93d4cc8b2faf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*L1ttbA6QtqKyoujX.gif"/></div></figure><p id="e290" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，它创建了一个新记录。当你试图插入相同的记录w.r.t电子邮件它提出了一个异常，酷，不是吗？</p><h1 id="4e70" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h1><p id="a2cb" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在这篇文章中，您了解了如何为您的应用程序创建基于graphql的查询。我只讨论了它的基础。万一你有兴趣深入学习，你可以去探索一下<a class="ae kw" href="https://graphql.org/learn/" rel="noopener ugc nofollow" target="_blank"> GraphQL </a>和石墨烯的文档。像往常一样，这些代码可以在Github 上获得。</p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><p id="6c7f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="md">原载于2021年2月14日</em><a class="ae kw" href="http://blog.adnansiddiqi.me/getting-started-with-graphql-in-python-with-fastapi-and-graphene/" rel="noopener ugc nofollow" target="_blank"><em class="md">http://blog . adnansiddiqi . me</em></a><em class="md">。</em></p></div></div>    
</body>
</html>