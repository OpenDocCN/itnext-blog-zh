# 带提供商的 Firebase 流

> 原文：<https://itnext.io/firebase-streams-with-provider-5f4d3bdfba5b?source=collection_archive---------1----------------------->

![](img/2c61026373c92a4bb180a2ea4ff26281.png)

在我的 Firebase 之旅中，我的剧目中少了一样东西，那就是 streams。我知道这是一个我需要学习的重要课题，但是我不确定如何管理这个流以及随之而来的一切。但是后来我了解了供应商。随着我对 Provider 的了解，我也了解了 StreamProvider，最终事情开始变得明朗起来。

## 那么溪流有什么特别之处呢？

根据请求读取数据(就像我一直在做的那样)，只需从服务器获取一次数据。如果您需要更新数据，您需要调用一个函数来再次获取数据。检索一次数据有很多用例。比如在 Instagram 上，你只想在用户下拉刷新的时候更新 feed。但是，当 firebase 中的信息发生变化时，如果您希望看到信息的更新，该怎么办呢？这就是溪流的来源。当您“流式传输”的数据发生变化时，流会收到通知。然后它会更新你的应用程序中的数据，所以一切都是最新的。对于更新 Instagram 上的 feed 来说，这没有意义。如果你关注了很多人，它会不断更新，并打乱你向下滚动的距离。但是对于像聊天消息这样的东西，你需要它是一个流，这样消息就会在正确的时间出现。

我在 Firebase 和 Provider 中使用了两种类型的流。这些是认证流和 Firestore 流。

## 流式身份验证状态

对于身份验证流，您需要向整个应用程序提供该流，因为整个应用程序需要确保您的身份验证状态没有改变。在本视频所示的示例中，我们使用 google 登录，并传输身份验证状态。请注意，我们实际上不是直接从 Firebase 流式传输它，而是流式传输本地 auth 状态。所以从技术上来说，这不是一个火基流。为什么要流式传输本地身份验证状态？假设有人偷了你的手机，但你设法注销了你的谷歌账户，他们将无法访问该应用程序中的信息，即使它一直在后台运行。显然，在大多数情况下，这是多余的，可能没有必要，但对于 Robinhood 或 Chase 这样的应用程序，你可以打赌，为了安全起见，他们正在传输身份验证状态。

## Firestore 流

流的一个更实际和常用的原因是从数据库中获取实时数据。在这个例子中，我们使用 Firestore 来演示一个简单的显示书籍列表的流。每当一个新的文档(书籍)被添加，它会立即显示在应用程序中。在使用 provider(无论是 streams 还是常规 Provider)时，有一件事你需要记住，那就是你不希望把你的数据暴露给任何不需要它的东西。你可以看到，我们向整个应用程序公开了授权流，因为整个应用程序都需要它。但我们只是将 Firestore 流显示在主屏幕上。

## 现金流定价

现在您已经理解了流，您将需要考虑如何为每种不同类型的情况检索数据。流最终可能比常规数据收集更昂贵。每次有些数据发生变化，都会被 firestore 统计为“已读”。但是，如果您的数据很少发生变化，那么如果什么都没有发生变化，您也不希望从 firestore 请求数据。

每当你引入许多变量并需要降低价格时，Firebase 就会变得非常复杂。确保花时间真正了解你的应用程序需要什么，以及满足这些需求的最有效方式。

感谢您的阅读

推特:@tadaspetra

Instagram: @AmateurCoder