<html>
<head>
<title>How to run RSpec, Jest, Cypress tests faster on Heroku CI with parallel testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用并行测试在Heroku CI上更快地运行RSpec、Jest、Cypress测试</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-run-rspec-jest-cypress-tests-faster-on-heroku-ci-with-parallel-testing-77d182bf469?source=collection_archive---------5-----------------------#2019-06-06">https://itnext.io/how-to-run-rspec-jest-cypress-tests-faster-on-heroku-ci-with-parallel-testing-77d182bf469?source=collection_archive---------5-----------------------#2019-06-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5e3a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Heroku为团队提供了现成的CI解决方案。Heroku CI 可以在dyno实例中为您的项目运行测试。更有趣的是，您可以将并行dynos作为CI构建的一部分来运行。这允许您在并行dynos上分割测试，以更快地完成CI构建并节省时间。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/fee777406f087469fb8c90b7d18bc65e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*i4ieBFTr6VSzoKDh.jpg"/></div></div></figure><p id="1646" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Heroku对每个dyno的运行时间收费。这意味着，您可以将测试套件拆分到多个dyno上，而不是在单个dyno上运行您的慢速测试套件，并支付或多或少相同的费用，从而显著减少项目的CI构建时间。</p><h1 id="8720" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">如何从Heroku CI开始</h1><blockquote class="lv lw lx"><p id="b0d7" class="jn jo ly jp b jq jr js jt ju jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj kk ij bi translated">如果您在Heroku dashboard中已经有一个团队，那么您可以使用Heroku CI并为您的项目运行测试。</p></blockquote><p id="4ed0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Heroku，你可以为你的一个项目打开你的团队和特定的管道。您可以在那里找到一个<em class="ly">测试</em>选项卡，在那里您可以启用Heroku CI。</p><p id="06e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还需要在项目的存储库中有一个<em class="ly"> app.json </em>文件。该文件包含在Heroku上运行项目所需的信息。您可以向<em class="ly"> app.json </em>文件添加Heroku CI所需的附加配置。</p><p id="e169" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了使用Heroku CI并行测试运行，我们需要启用它。您可以请求Heroku支持人员为您的项目激活它。这个特性允许为您的CI构建运行多达32个并行dynos。</p><p id="4840" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还可以观看更详细的视频中的所有步骤，或者从本文中复制一些示例。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="e368" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是如何在Heroku CI上为Ruby和JavaScript项目分割测试的例子。</p><h1 id="8769" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">如何在Ruby on Rails项目中为测试套件运行并行dynos</h1><p id="1819" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk ij bi translated">您可以将用<strong class="jp ir"> RSpec </strong>、<strong class="jp ir"> Minitest </strong>、<strong class="jp ir"> Cucumber </strong>或其他测试程序编写的Ruby测试以动态方式拆分到并行的dyno上，所有的dyno将在相似的时间完成工作，这样您就可以尽快得到测试套件是绿色还是红色的结果。为此，您可以使用<a class="ae mj" href="https://knapsackpro.com/?utm_source=medium&amp;utm_medium=blog_post&amp;utm_campaign=how-to-run-tests-faster-on-heroku-ci-with-parallel-dynos" rel="noopener ugc nofollow" target="_blank">backpack Pro</a>工具及其<a class="ae mj" href="https://youtu.be/hUEB1XDKEFY" rel="noopener ugc nofollow" target="_blank">队列模式进行动态测试套件分割</a>。使用<em class="ly"> quantity </em>键，您可以设置想要使用多少个并行dynos来运行您的<em class="ly">脚本测试</em>命令。</p><pre class="km kn ko kp gt mk ml mm mn aw mo bi"><span id="bf89" class="mp ky iq ml b gy mq mr l ms mt">{<br/>  "environments": {<br/>    "test": {<br/>      "formation": {<br/>        "test": {<br/>          "quantity": 2<br/>        }<br/>      },<br/>      "addons": [<br/>        "heroku-postgresql"<br/>      ],<br/>      "scripts": {<br/>        "test": "bundle exec rake knapsack_pro:queue:rspec"<br/>      },<br/>      "env": {<br/>        "KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC": "rspec-token"<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="5393" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还可以更改CI构建的动态大小。如果您运行需要更多CPU或内存的复杂测试，那么您可以向<em class="ly"> app.json </em>添加<em class="ly"> size </em>参数来定义<a class="ae mj" href="https://devcenter.heroku.com/articles/dyno-types" rel="noopener ugc nofollow" target="_blank"> dyno type </a>。</p><pre class="km kn ko kp gt mk ml mm mn aw mo bi"><span id="5a48" class="mp ky iq ml b gy mq mr l ms mt">{<br/>  "environments": {<br/>    "test": {<br/>      "formation": {<br/>        "test": {<br/>          "quantity": 1,<br/>          "size": "performance-l"<br/>        }<br/>      }<br/>   }<br/>}</span></pre><h1 id="3c47" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">针对赛普拉斯E2E测试套件，在并行Heroku CI dynos上运行JavaScript测试</h1><p id="45d4" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk ij bi translated">端到端测试(E2E)通常需要很多时间，因为点击网站的多个场景非常耗时。在多个dynos上拆分<strong class="jp ir"> Cypress </strong>测试套件将帮助我们节省大量时间，并保持CI快速构建。</p><p id="7e54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用<a class="ae mj" href="https://github.com/KnapsackPro/knapsack-pro-cypress" rel="noopener ugc nofollow" target="_blank">@ backpackage-pro/cypress</a>项目。它使用<a class="ae mj" href="https://knapsackpro.com/?utm_source=medium&amp;utm_medium=blog_post&amp;utm_campaign=how-to-run-tests-faster-on-heroku-ci-with-parallel-dynos" rel="noopener ugc nofollow" target="_blank">背包Pro队列模式</a>。</p><p id="03f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是你的<em class="ly"> app.json </em>的配置</p><pre class="km kn ko kp gt mk ml mm mn aw mo bi"><span id="08e8" class="mp ky iq ml b gy mq mr l ms mt">{<br/>  "environments": {<br/>    "test": {<br/>      "formation": {<br/>        "test": {<br/>          "quantity": 2<br/>        }<br/>      },<br/>      "addons": [<br/>        "heroku-postgresql"<br/>      ],<br/>      "scripts": {<br/>        "test": "$(npm bin)/knapsack-pro-cypress"<br/>      },<br/>      "env": {<br/>        "KNAPSACK_PRO_TEST_SUITE_TOKEN_CYPRESS": "example"<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="9271" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想了解更多关于Cypress的知识，那么查看一篇文章中的视频<a class="ae mj" href="https://docs.knapsackpro.com/2018/run-javascript-e2e-tests-faster-with-cypress-on-parallel-ci-nodes" rel="noopener ugc nofollow" target="_blank">在并行CI节点上用Cypress运行javascript E2E测试</a>。</p><h1 id="62d9" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">在并行Heroku CI dynos上用JavaScript运行Jest测试</h1><p id="b7e4" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk ij bi translated">我们可以使用<a class="ae mj" href="https://github.com/KnapsackPro/knapsack-pro-jest" rel="noopener ugc nofollow" target="_blank">@ backpackage-pro/Jest</a>客户端库来拆分你的<strong class="jp ir"> Jest </strong>测试。它使用<a class="ae mj" href="https://knapsackpro.com/?utm_source=medium&amp;utm_medium=blog_post&amp;utm_campaign=how-to-run-tests-faster-on-heroku-ci-with-parallel-dynos" rel="noopener ugc nofollow" target="_blank">背包Pro队列模式</a>。</p><p id="d10f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是你的<em class="ly"> app.json </em>的配置</p><pre class="km kn ko kp gt mk ml mm mn aw mo bi"><span id="d02a" class="mp ky iq ml b gy mq mr l ms mt">{<br/>  "environments": {<br/>    "test": {<br/>      "formation": {<br/>        "test": {<br/>          "quantity": 2<br/>        }<br/>      },<br/>      "addons": [<br/>        "heroku-postgresql"<br/>      ],<br/>      "scripts": {<br/>        "test": "$(npm bin)/knapsack-pro-jest"<br/>      },<br/>      "env": {<br/>        "KNAPSACK_PRO_TEST_SUITE_TOKEN_JEST": "example"<br/>      }<br/>    }<br/>  }<br/>}</span></pre><h1 id="cabf" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">摘要</h1><blockquote class="lv lw lx"><p id="fb24" class="jn jo ly jp b jq jr js jt ju jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj kk ij bi translated">您可以在安装指南中找到各种测试运行器的所有集成。<br/> <a class="ae mj" href="https://docs.knapsackpro.com/integration/" rel="noopener ugc nofollow" target="_blank">参见背包Pro </a>中支持的测试跑者。</p></blockquote><p id="5b98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">赫罗库词是赫罗库的一大补充。如果您已经使用Heroku，您可以轻松地利用并行dyno并保持CI的低成本，因为您只需为dyno的使用付费。最棒的是，您可以使用测试套件的子集运行许多并行CI dynos，从而为您的工程团队节省大量时间。你可以了解更多关于<a class="ae mj" href="https://knapsackpro.com/?utm_source=medium&amp;utm_medium=blog_post&amp;utm_campaign=how-to-run-tests-faster-on-heroku-ci-with-parallel-dynos" rel="noopener ugc nofollow" target="_blank">背包专业版如何通过更快的CI构建帮助你节省时间</a>。</p><p id="66d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下面的视频中了解更多关于队列模式及其解决的问题。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="acce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi">— — —</p><p id="15e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最初发布于:<a class="ae mj" href="https://docs.knapsackpro.com/2019/how-to-run-tests-faster-on-heroku-ci-with-parallel-dynos" rel="noopener ugc nofollow" target="_blank">https://docs . knapsackpro . com/2019/how-to-run-tests-faster-on-heroku-ci-with-parallel-dynos</a></p></div></div>    
</body>
</html>