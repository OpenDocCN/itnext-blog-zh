<html>
<head>
<title>How to deal with 4xx responses in MicroProfile Rest-Client</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在MicroProfile Rest-Client中处理4xx响应</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-deal-with-4xx-5xx-responses-in-microprofile-rest-client-2e16559f542?source=collection_archive---------1-----------------------#2019-11-29">https://itnext.io/how-to-deal-with-4xx-5xx-responses-in-microprofile-rest-client-2e16559f542?source=collection_archive---------1-----------------------#2019-11-29</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><p id="aeb7" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">Eclipse微文件 <a class="ae km" href="https://github.com/eclipse/microprofile-rest-client" rel="noopener ugc nofollow" target="_blank"> Rest客户端</a>是一款非常酷的软件。<a class="ae km" rel="noopener ugc nofollow" target="_blank" href="/authentication-with-microprofile-rest-client-d1e9da774f70">我想我甚至在</a>之前提到过😀。其中一个很酷的特性是你不必处理底层的http处理。</p><figure class="ko kp kq kr gu ks gi gj paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gi gj kn"><img src="../Images/ea16b72ba9f1475963f4e58645d4ac09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gVPygEdI_4W3Ynoq3maU-A.png"/></div></div></figure><p id="5348" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">但是有时你想实际处理http的本质——特别是处理传达语义的不同状态代码。默认的处理是，对于每一个代码≥ 400，抛出一个<em class="kz"> WebApplicationException </em>，只是告诉你调用没有成功，并没有进一步区分。</p><h2 id="a4f4" class="la lb ir bd lc ld le dn lf lg lh dp li jz lj lk ll kd lm ln lo kh lp lq lr ls bi translated">自定义异常映射器的帮助</h2><p id="faf1" class="pw-post-body-paragraph jo jp ir jq b jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh lx kj kk kl ik bi translated">幸运的是，我们不需要求助于基本的HttpClient来解决这个问题，而是可以使用一个强大的特性，即自定义ResponseExceptionMappers。让我们先看看一个示例实现，然后看看如何将它应用到您的代码中。这建立在我上一篇文章的<a class="ae km" rel="noopener ugc nofollow" target="_blank" href="/authentication-with-microprofile-rest-client-d1e9da774f70">代码之上。</a></p><pre class="ko kp kq kr gu ly lz ma mb aw mc bi"><span id="6bea" class="la lb ir lz b gz md me l mf mg"><strong class="lz is">@Priority</strong>(4000)                                            // <strong class="lz is"><em class="kz">(1)</em></strong><br/>public class <strong class="lz is">MyMapper</strong> implements <br/>             ResponseExceptionMapper&lt;RuntimeException&gt; {   // <strong class="lz is"><em class="kz">(2)</em></strong></span><span id="72b5" class="la lb ir lz b gz mh me l mf mg">  @Override<br/>  public RuntimeException toThrowable(Response response) {<br/>    int status = response.getStatus();                     // <strong class="lz is"><em class="kz">(3)</em></strong><br/><br/>    String msg = getBody(response); // see below<br/><br/>    RuntimeException re ;<br/>    switch (status) {<br/>      case <strong class="lz is">412</strong>: re = new ValidationException(msg);         // <strong class="lz is"><em class="kz">(4)</em></strong><br/>      break;<br/>      default:<br/>        re = new WebApplicationException(status);          // <strong class="lz is"><em class="kz">(5)</em></strong><br/>    }<br/>    return re;<br/>  }</span></pre><ol class=""><li id="2bd5" class="mi mj ir jq b jr js jv jw jz mk kd ml kh mm kl mn mo mp mq bi translated">告诉其他客户优先级。如果多个映射器匹配，则采用优先级最低的映射器</li><li id="af8d" class="mi mj ir jq b jr mr jv ms jz mt kd mu kh mv kl mn mo mp mq bi translated">我们的类需要实现ResponseExceptionMapper接口</li><li id="df70" class="mi mj ir jq b jr mr jv ms jz mt kd mu kh mv kl mn mo mp mq bi translated">我们可以从响应中检索状态代码</li><li id="ec6c" class="mi mj ir jq b jr mr jv ms jz mt kd mu kh mv kl mn mo mp mq bi translated">并使用它来分派不同类型的异常</li><li id="05d6" class="mi mj ir jq b jr mr jv ms jz mt kd mu kh mv kl mn mo mp mq bi translated">对于所有其他代码，我们使用默认值</li></ol><p id="72c2" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">如果我们调用的服务器在主体中返回一个响应，我们希望知道它并在异常中提供它。这可以通过以下方式实现:</p><pre class="ko kp kq kr gu ly lz ma mb aw mc bi"><span id="b4dc" class="la lb ir lz b gz md me l mf mg">private String getBody(Response response) {<br/>  ByteArrayInputStream is = (ByteArrayInputStream) response.getEntity();<br/>  byte[] bytes = new byte[is.available()];<br/>  is.read(bytes,0,is.available());<br/>  String body = new String(bytes);<br/>  return body;<br/>}</span></pre><p id="5db8" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">现在我们有了映射器功能，我们需要告诉rest客户机何时应该应用它。为此，我们将映射器注册到我们希望使用它的接口:</p><pre class="ko kp kq kr gu ly lz ma mb aw mc bi"><span id="1e11" class="la lb ir lz b gz md me l mf mg">@RegisterRestClient<br/><strong class="lz is">@RegisterProvider</strong>(value = <strong class="lz is">MyMapper.class</strong>,<br/>                  priority = 50)<br/>public interface <strong class="lz is">VerifyEngine</strong> {</span></pre><p id="b7e7" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">只需在接口上添加一个<em class="kz"> @RegisterProvider </em>注释就大功告成了。如果远程服务器现在响应代码412，您将得到一个ValidationException，您可以使用它:</p><pre class="ko kp kq kr gu ly lz ma mb aw mc bi"><span id="8fb5" class="la lb ir lz b gz md me l mf mg">@Inject<br/>@RestClient<br/>VerifyEngine engine;</span><span id="15cd" class="la lb ir lz b gz mh me l mf mg">[...]</span><span id="da63" class="la lb ir lz b gz mh me l mf mg">try {<br/>  <strong class="lz is">engine.verify</strong>(policy);<br/>}<br/>catch (ValidationException ve) {<br/>  // Deal with a 412 response<br/>}<br/>catch (Exception e) {<br/>  // Deal with other cases<br/>}</span></pre><h1 id="2928" class="mw lb ir bd lc mx my mz lf na nb nc li nd ne nf ll ng nh ni lo nj nk nl lr nm bi translated">更多？</h1><p id="0eef" class="pw-post-body-paragraph jo jp ir jq b jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh lx kj kk kl ik bi translated">如果你想了解更多关于Eclipse MicroProfile的知识，可以看看我也是合著者的书“<a class="ae km" href="https://www.packtpub.com/web-development/hands-on-enterprise-java-microservices-with-eclipse-microprofile" rel="noopener ugc nofollow" target="_blank"> <strong class="jq is">用Eclipse MicroProfile </strong> </a>动手操作企业Java微服务”。</p><figure class="ko kp kq kr gu ks gi gj paragraph-image"><div class="gi gj nn"><img src="../Images/b98916f13a93c476031ffe4fc6841dfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*2TpxgNcoNpjDKmJeiwWY5g.jpeg"/></div></figure></div></div>    
</body>
</html>