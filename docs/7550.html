<html>
<head>
<title>Kubernetes CrashLoopBackoff Status</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">kubernetes crash loop回退状态</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-crashloopbackoff-status-d254dd642d10?source=collection_archive---------0-----------------------#2022-11-03">https://itnext.io/kubernetes-crashloopbackoff-status-d254dd642d10?source=collection_archive---------0-----------------------#2022-11-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0569" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">排除故障并修复错误！</h2></div><p id="bdde" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Kubernetes (K8S)群集中的一个pod的状态可能会显示“CrashLoopBackoff”错误，这是在一个pod崩溃并多次尝试重新启动时显示的。在本文中，我们将介绍如何发现错误，如何修复错误，以及出现错误的一些原因。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/91d032b7eb1b6a94214343d18b7d0f4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uxup1TRSoIA-IpFO7-pLcg.jpeg"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">马库斯·斯皮斯克在<a class="ae lu" href="https://unsplash.com/s/photos/crash?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h2 id="d9bd" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">到底什么是CrashLoopBackoff错误？</h2><p id="f7c3" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">K8S <code class="fe mt mu mv mw b">kubelet</code>在尝试再次启动吊舱之前，将在两次碰撞之间等待一个不断增加的“后退”时间。K8S <code class="fe mt mu mv mw b">restartPolicy</code>默认设置为“始终”，如果<code class="fe mt mu mv mw b">restartPolicy</code>已更改为“onFailure”，也会出现这种情况。重新启动之间的这段时间让我们有时间进行故障诊断，以尝试修复问题。最大“回退”时间为5分钟，从10秒开始，呈指数增长，直到达到最大值。当pod显示CrashLoopBackoff状态时，这意味着它正在等待“Backoff”指定的给定时间来重新启动，并且可能会再次失败。在再次崩溃之前，容器可能会短暂地显示为“正在运行”。</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h2 id="7a25" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">如何找到“CrashLoopBackoff”错误</h2><p id="2d4b" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">要显示窗格的状态，请运行以下命令:</p><pre class="lf lg lh li gt ne mw nf ng aw nh bi"><span id="c132" class="lv lw it mw b gy ni nj l nk nl">kubectl get pods -n &lt;namespace&gt;</span></pre><p id="5bce" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">状态部分将显示pod状态。如果pod处于CrashLoopBackOff状态，它将显示为<em class="nm">未</em>就绪，(如下图0/1所示)，并将显示0次以上的重启。</p><pre class="lf lg lh li gt ne mw nf ng aw nh bi"><span id="a05c" class="lv lw it mw b gy ni nj l nk nl">NAME                     READY     STATUS             RESTARTS   AGE<br/>nginx-5796d5bc7d-xtl6q   0/1       CrashLoopBackOff   4         1m</span></pre><p id="25b3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">“正常”状态包括:</p><ul class=""><li id="f4cb" class="nn no it kk b kl km ko kp kr np kv nq kz nr ld ns nt nu nv bi translated">运转</li></ul><p id="0369" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">pod运行正常，没有任何问题。</p><ul class=""><li id="cb9f" class="nn no it kk b kl km ko kp kr np kv nq kz nr ld ns nt nu nv bi translated">等待</li></ul><p id="95f1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">pod仍在启动，它可能正在提取容器图像，或者正在接收秘密数据。一旦完成，它应该转换到运行状态。</p><ul class=""><li id="3826" class="nn no it kk b kl km ko kp kr np kv nq kz nr ld ns nt nu nv bi translated">终止的</li></ul><p id="6eba" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">具有此状态的pod要么运行完成，要么由于某种原因失败。</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h2 id="88d8" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">故障排除具有CrashLoopBackOff状态的pod</h2><p id="0d73" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">下面列出的四个kubectl命令是开始对出错的pod进行故障诊断的推荐方法。</p><ol class=""><li id="5a4a" class="nn no it kk b kl km ko kp kr np kv nq kz nr ld nw nt nu nv bi translated"><code class="fe mt mu mv mw b">kubectl describe pod</code></li><li id="0386" class="nn no it kk b kl nx ko ny kr nz kv oa kz ob ld nw nt nu nv bi translated"><code class="fe mt mu mv mw b">kubectl logs</code></li><li id="e2c9" class="nn no it kk b kl nx ko ny kr nz kv oa kz ob ld nw nt nu nv bi translated"><code class="fe mt mu mv mw b">kubectl get events</code></li></ol><p id="476b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从<code class="fe mt mu mv mw b">kubectl describe</code>命令开始，您可以使用它来获得更多细节。</p><pre class="lf lg lh li gt ne mw nf ng aw nh bi"><span id="214e" class="lv lw it mw b gy ni nj l nk nl">kubectl describe pod &lt;pod name&gt; -n &lt;namespace&gt;</span></pre><p id="2215" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">pod状态部分将显示与pod相关的任何错误消息。输出的events部分将为您提供关于pod状态的信息。查找包含“回退重启失败的容器”的条目，如下例所示。</p><pre class="lf lg lh li gt ne mw nf ng aw nh bi"><span id="d927" class="lv lw it mw b gy ni nj l nk nl">Name:         pod name<br/>Namespace:    default<br/>Priority:     0<br/>…<br/>State:        Waiting<br/>Reason:       CrashLoopBackOff<br/>Last State:   Terminated<br/>Reason:       Error<br/>…<br/>Warning  BackOff                1m (x5 over 1m)   kubelet, ip-10-0-9-132.us-east-2.compute.internal  Back-off restarting failed container<br/>…</span></pre><p id="02ee" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，使用<code class="fe mt mu mv mw b">kubectl logs</code>命令检查故障pod的日志。<code class="fe mt mu mv mw b">-p</code>(或<code class="fe mt mu mv mw b">--previous</code>)标志将从pod的最后一个失败实例中检索日志，这有助于了解应用程序级别发生了什么。可以使用<code class="fe mt mu mv mw b">--all-containers</code>标志指定所有容器或一个容器的日志。您可以通过添加<code class="fe mt mu mv mw b">---tail</code>标志来查看日志文件的最后一部分。</p><pre class="lf lg lh li gt ne mw nf ng aw nh bi"><span id="8f89" class="lv lw it mw b gy ni nj l nk nl">kubectl logs &lt;pod name&gt; -n &lt;namespace&gt; -p</span><span id="10ae" class="lv lw it mw b gy oc nj l nk nl">kubectl logs <!-- -->&lt;pod name&gt; -n &lt;namespace&gt;<!-- --> --previous</span><span id="0b60" class="lv lw it mw b gy oc nj l nk nl">kubectl logs &lt;pod name&gt; -n &lt;namespace&gt; --all-containers</span><span id="2f65" class="lv lw it mw b gy oc nj l nk nl">kubectl logs &lt;pod name&gt; -n &lt;namespace&gt; -c mycontainer</span><span id="13ff" class="lv lw it mw b gy oc nj l nk nl">kubectl logs &lt;pod name&gt; -n &lt;namespace&gt; --tail 50</span></pre><p id="fa56" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，您应该使用<code class="fe mt mu mv mw b">kubectl get events</code>命令检查K8S事件，并查看pod崩溃之前的事件。您可以使用<code class="fe mt mu mv mw b">--sort-by=</code>标志按时间戳排序。要查看单个pod中的事件，请使用<code class="fe mt mu mv mw b">--field-selector</code>标志。</p><pre class="lf lg lh li gt ne mw nf ng aw nh bi"><span id="2306" class="lv lw it mw b gy ni nj l nk nl">kubectl get events <!-- -->-n &lt;namespace&gt; <!-- -->--sort-by=.metadata.creationTimestamp</span><span id="2fd5" class="lv lw it mw b gy oc nj l nk nl">kubectl get events -n &lt;namespace&gt; --field-selector involvedObject.name=&lt;pod name&gt;</span></pre><p id="8edc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">输出将显示在列表中，示例如下:</p><pre class="lf lg lh li gt ne mw nf ng aw nh bi"><span id="e0d0" class="lv lw it mw b gy ni nj l nk nl">kube-system 60m Normal Pulling pod/node-problem-detector-vmcf2                        pulling image "k8s.gcr.io/node-problem-detector:v0.7.0"</span><span id="9886" class="lv lw it mw b gy oc nj l nk nl">kube-system 60m Normal Pulled pod/node-problem-detector-vmcf2                        Successfully pulled image "k8s.gcr.io/node-problem-detector:v0.7.0"</span><span id="d30d" class="lv lw it mw b gy oc nj l nk nl">kube-system 60m Normal Created pod/node-problem-detector-vmcf2                        Created container</span><span id="482d" class="lv lw it mw b gy oc nj l nk nl">kube-system 60m Normal Started pod/node-problem-detector-vmcf2</span></pre></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h2 id="a04a" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">CrashLoopBackOff错误的原因及防止方法</h2><p id="f77f" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">导致CrashLoopBackOff错误的原因有很多，下面列出了一些常见的原因:</p><ol class=""><li id="31f3" class="nn no it kk b kl km ko kp kr np kv nq kz nr ld nw nt nu nv bi translated">容器的错误配置—检查配置文件中的拼写错误或错误配置的值。</li><li id="164d" class="nn no it kk b kl nx ko ny kr nz kv oa kz ob ld nw nt nu nv bi translated">内存或资源不足—检查是否正确指定了资源限制。这可能是由交通或活动的突然或意外增加引起的。检查配置文件的“资源:限制”部分。</li><li id="44d5" class="nn no it kk b kl nx ko ny kr nz kv oa kz ob ld nw nt nu nv bi translated">两个或多个容器被配置为使用同一个端口，如果它们在同一个pod中，这将导致错误。</li><li id="80fe" class="nn no it kk b kl nx ko ny kr nz kv oa kz ob ld nw nt nu nv bi translated">由于其他pod正在使用某个文件或数据库，该文件或数据库被锁定，pod正在尝试连接该文件或数据库。</li><li id="5477" class="nn no it kk b kl nx ko ny kr nz kv oa kz ob ld nw nt nu nv bi translated">pod可能引用不存在的资源或包，例如可以在容器或永久存储卷中找到的脚本。</li><li id="ccc1" class="nn no it kk b kl nx ko ny kr nz kv oa kz ob ld nw nt nu nv bi translated">部署软件时出现一般错误—软件特有的任何错误和异常。</li><li id="703f" class="nn no it kk b kl nx ko ny kr nz kv oa kz ob ld nw nt nu nv bi translated">命令行参数可能不正确或丢失。</li><li id="ed0c" class="nn no it kk b kl nx ko ny kr nz kv oa kz ob ld nw nt nu nv bi translated">活性探测器配置不正确—请检查配置文件。</li><li id="30ca" class="nn no it kk b kl nx ko ny kr nz kv oa kz ob ld nw nt nu nv bi translated">指定的权限不正确或授予的权限不足。</li><li id="4b24" class="nn no it kk b kl nx ko ny kr nz kv oa kz ob ld nw nt nu nv bi translated">pod试图写入的文件系统或文件夹是只读的。</li><li id="8d9a" class="nn no it kk b kl nx ko ny kr nz kv oa kz ob ld nw nt nu nv bi translated">连接问题—网络配置不正确或DNS不可达。<code class="fe mt mu mv mw b">kube-dns</code>可能未运行且容器无法联系外部服务。</li><li id="5ad0" class="nn no it kk b kl nx ko ny kr nz kv oa kz ob ld nw nt nu nv bi translated">设置了不正确的环境变量—使用env检查环境变量。</li><li id="778e" class="nn no it kk b kl nx ko ny kr nz kv oa kz ob ld nw nt nu nv bi translated">在将身份分配给pod的情况下，例如在Azure Kubernetes服务中，Azure Active Directory中的托管身份被错误分配或无法访问。</li></ol></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h2 id="2a2d" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">摘要</h2><p id="e9ab" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">CrashLoopBackoff状态是一个通知，通知pod由于错误正在重新启动，并且正在等待指定的“回退”时间，直到它将尝试再次启动。</p><p id="32e9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">运行上面详细介绍的步骤应该有助于您找到状态的根本原因并纠正问题。</p><p id="e07b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">想要更多Kubernetes内容？查看我在K8S上的其他文章<a class="ae lu" href="https://jackwesleyroper.medium.com/kubernetes-k8s-related-articles-index-54718769e390" rel="noopener">这里</a>！</p><p id="bc6a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">干杯！🍻</p><div class="od oe gp gr of og"><a href="https://www.buymeacoffee.com/jackwesleyroper" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd iu gy z fp ol fr fs om fu fw is bi translated">Jack Roper正在Azure、Azure DevOps、Terraform、Kubernetes和Cloud tech上写博客！</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">希望我的博客能帮到你，你会喜欢它的内容！我真的很喜欢写技术内容和分享…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">www.buymeacoffee.com</p></div></div><div class="op l"><div class="oq l or os ot op ou lo og"/></div></div></a></div><p id="bffc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="nm">原载于</em><a class="ae lu" href="https://spacelift.io/" rel="noopener ugc nofollow" target="_blank"><em class="nm">space lift . io</em></a><em class="nm">。</em></p></div></div>    
</body>
</html>