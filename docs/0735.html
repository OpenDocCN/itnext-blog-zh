<html>
<head>
<title>A quick tip on testing Observables 👀</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">测试可观测量的快速技巧👀</h1>
<blockquote>原文：<a href="https://itnext.io/a-quick-tip-on-testing-observables-e2fbdebef4c?source=collection_archive---------2-----------------------#2018-05-17">https://itnext.io/a-quick-tip-on-testing-observables-e2fbdebef4c?source=collection_archive---------2-----------------------#2018-05-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="1835" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">测试异步可观测性，就像它们是同步的一样！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/70fc831b7f9388442b342d0cf0d6c391.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7iXaNQ9kMCuh0vHF."/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">由<a class="ae lb" href="https://unsplash.com/@sharonp?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">莎伦·皮特韦</a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="9135" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你用过Angular (2+)，你一定用过Observables。事实上，Angular使用的实现——RxJs紧密地结合在框架本身的基础中，用于路由和Http之类的东西。</p><p id="66a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想了解更多关于Observables以及如何使用它们，你可以参考下面<a class="lc ld ep" href="https://medium.com/u/9530b046d2ac?source=post_page-----e2fbdebef4c--------------------------------" rel="noopener" target="_blank"> Gerard Sans </a>关于RxJs的酷帖。</p><div class="le lf gp gr lg lh"><a href="https://medium.com/google-developer-experts/angular-introduction-to-reactive-extensions-rxjs-a86a7430a61f" rel="noopener follow" target="_blank"><div class="li ab fo"><div class="lj ab lk cl cj ll"><h2 class="bd ir gy z fp lm fr fs ln fu fw ip bi translated">角度—反应式延伸(RxJS)简介</h2><div class="lo l"><h3 class="bd b gy z fp lm fr fs ln fu fw dk translated">如何在AngularJS中使用可观察序列</h3></div><div class="lp l"><p class="bd b dl z fp lm fr fs ln fu fw dk translated">medium.com</p></div></div><div class="lq l"><div class="lr l ls lt lu lq lv kv lh"/></div></div></a></div><p id="fecc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们都知道(我希望如此)我们应该测试我们的代码，但是我们也知道测试异步代码可能很麻烦，尤其是在处理像Observables这样复杂的主题时。</p><p id="848c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，我们可以有以下方法:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="927b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，我们返回一个平面数组，并故意将其延迟500毫秒。</p><p id="c5fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们如何测试这个？</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="cf79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这能行吗？显然不会，因为我们的测试运行程序不知道什么时候执行它的断言，并且会在500毫秒的延迟过去之前退出。</p><p id="4117" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了解决这个问题，我们可以使用<strong class="jp ir"> done </strong>回调并指示测试运行程序何时执行其断言，比如:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="55bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个可以，但是因为某些原因你不喜欢，对吧？这有点冗长，它有嵌套和一个每次都要调用的额外回调。</p><h2 id="1443" class="ly lz iq bd ma mb mc dn md me mf dp mg jy mh mi mj kc mk ml mm kg mn mo mp mq bi translated">我们能做得更好吗？</h2><p id="d6bf" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">我们当然可以，这是Javascript，你可以做任何事情！</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="1295" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我向你展示了一个简单的助手函数，它将接收一个流(可观察的)和一个skipTime。它将订阅可观察值，将其值赋给一个局部变量，<strong class="jp ir">跳过一段时间</strong>并返回值。</p><p id="a897" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">等等，什么？</strong> <strong class="jp ir">你不能这么做！<br/></strong><code class="fe mw mx my mz b">jasmine.clock.tick()</code>如何工作？</p><div class="le lf gp gr lg lh"><a href="https://stackoverflow.com/a/28889643/1841820" rel="noopener  ugc nofollow" target="_blank"><div class="li ab fo"><div class="lj ab lk cl cj ll"><h2 class="bd ir gy z fp lm fr fs ln fu fw ip bi translated">茉莉花钟是如何工作的？</h2><div class="lo l"><h3 class="bd b gy z fp lm fr fs ln fu fw dk translated">我不想花几个小时阅读代码来找到相关的部分，但我很好奇jasmine是如何实现它的时钟的。的…</h3></div><div class="lp l"><p class="bd b dl z fp lm fr fs ln fu fw dk translated">stackoverflow.com</p></div></div><div class="lq l"><div class="na l ls lt lu lq lv kv lh"/></div></div></a></div><p id="2e05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它基本上用定制函数模仿基于时间的API，使这些调用同步，并让您在时间上“前进”到<code class="fe mw mx my mz b">ticking</code>。</p><p id="3e6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还需要在每次测试之前安装jasmine的时钟，然后卸载它，比如:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="2f34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好的，但是我如何使用它？</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="6f03" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很酷吧。同步，线性，简单！</p><p id="d30d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在<a class="ae lb" href="https://github.com/angelnikolov/ngx-cacheable" rel="noopener ugc nofollow" target="_blank"> ngx可缓存</a>的<strong class="jp ir">测试</strong> <a class="ae lb" href="https://github.com/angelnikolov/ngx-cacheable/blob/master/cacheable.decorator.spec.ts" rel="noopener ugc nofollow" target="_blank">这里</a>看到更多用例。另外，如果您还没有阅读我之前关于简单缓存装饰器的文章，请阅读:</p><div class="le lf gp gr lg lh"><a href="https://medium.com/@darkysharky/improve-your-angular-app-performance-by-using-this-simple-observable-cache-decorator-7d7ecea470d2" rel="noopener follow" target="_blank"><div class="li ab fo"><div class="lj ab lk cl cj ll"><h2 class="bd ir gy z fp lm fr fs ln fu fw ip bi translated">使用这个简单的可观察缓存装饰器来提高Angular应用程序的性能🎉</h2><div class="lo l"><h3 class="bd b gy z fp lm fr fs ln fu fw dk translated">当我们即将在SwiftViews中完成我们的应用程序开发时，我们注意到我们所有的…</h3></div><div class="lp l"><p class="bd b dl z fp lm fr fs ln fu fw dk translated">medium.com</p></div></div><div class="lq l"><div class="nb l ls lt lu lq lv kv lh"/></div></div></a></div><p id="3144" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">页（page的缩写）在Angular的最新版本中，你也可以使用NgZone的<code class="fe mw mx my mz b">fakeAsync</code> + <code class="fe mw mx my mz b">tick</code>并获得相同的效果。然而，如果你在一个非angular项目中使用Observables，你就不需要zone.js在测试中的开销，但是如果你测试一个Angular应用，也许那会是更好的选择。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/d09768ad586a4129e75a8149eda183f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:192/0*JDnP-N1WOzShrCVA"/></div></figure><p id="3ca3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">想找一份远程前端工作？<br/>有空的时候通知我们！现在就订阅<a class="ae lb" href="https://www.remotefrontendjobs.com/" rel="noopener ugc nofollow" target="_blank">https://www.remotefrontendjobs.com/</a></p></div></div>    
</body>
</html>