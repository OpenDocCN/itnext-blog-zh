<html>
<head>
<title>How to set up React Native authentication with react-native-app-auth</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用react-native-app-auth设置React本机身份验证</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-set-up-react-native-authentication-with-react-native-app-auth-f6fd66e0e6d0?source=collection_archive---------1-----------------------#2019-05-01">https://itnext.io/how-to-set-up-react-native-authentication-with-react-native-app-auth-f6fd66e0e6d0?source=collection_archive---------1-----------------------#2019-05-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/744187286873d8e5d3ab219d34aad181.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k2549xFsiA_FKSv0"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kf" href="https://unsplash.com/@cmdrshane?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> CMDR Shane </a>拍摄的照片</figcaption></figure><h2 id="70e7" class="kg kh it bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">版本</h2><p id="4018" class="pw-post-body-paragraph lc ld it le b lf lg lh li lj lk ll lm kp ln lo lp kt lq lr ls kx lt lu lv lw im bi translated">开始之前，请确保您安装了以下版本:</p><p id="b0aa" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">" react": "16.8.3 "，<br/> "react-native": "0.59.1 "，<br/>" react-native-contacts ":" 3 . 1 . 5 "，</p><p id="8162" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated"><strong class="le iu">如果你想了解一下的话，这里有Github回购的链接</strong>:<a class="ae kf" href="https://github.com/FormidableLabs/react-native-app-auth" rel="noopener ugc nofollow" target="_blank">https://github.com/FormidableLabs/react-native-app-auth</a></p><p id="0525" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated"><strong class="le iu"> React-native-app-auth </strong>用于在React-native应用程序中提供身份验证。在我的情况下，我试图使用它与谷歌，所以这里有一个解释，你可以安装和使用它的上述版本。</p><p id="c5ff" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">在他们的文档中，它还被解释为用于与<a class="ae kf" href="https://tools.ietf.org/html/rfc6749" rel="noopener ugc nofollow" target="_blank"> OAuth 2.0 </a>和<a class="ae kf" href="http://openid.net/specs/openid-connect-core-1_0.html" rel="noopener ugc nofollow" target="_blank"> OpenID Connect </a>提供者通信的<a class="ae kf" href="https://github.com/openid/AppAuth-iOS" rel="noopener ugc nofollow" target="_blank"> AppAuth-iOS </a>和<a class="ae kf" href="https://github.com/openid/AppAuth-Android" rel="noopener ugc nofollow" target="_blank">app auth-Android</a>SDK的React本地桥。</p><h1 id="328b" class="mc kh it bd ki md me mf kl mg mh mi ko mj mk ml ks mm mn mo kw mp mq mr la ms bi translated">经过测试的OpenID提供商:</h1><p id="228c" class="pw-post-body-paragraph lc ld it le b lf lg lh li lj lk ll lm kp ln lo lp kt lq lr ls kx lt lu lv lw im bi translated">这些提供商是OpenID兼容的，这意味着您可以使用<a class="ae kf" href="https://openid.net/specs/openid-connect-discovery-1_0.html" rel="noopener ugc nofollow" target="_blank">自动发现</a>:</p><ul class=""><li id="32c5" class="mt mu it le b lf lx lj ly kp mv kt mw kx mx lw my mz na nb bi translated"><a class="ae kf" href="https://demo.identityserver.io/" rel="noopener ugc nofollow" target="_blank">身份服务器4 </a> ( <a class="ae kf" href="https://github.com/FormidableLabs/react-native-app-auth/blob/master/docs/config-examples/identity-server-4.md" rel="noopener ugc nofollow" target="_blank">示例配置</a>)</li><li id="6331" class="mt mu it le b lf nc lj nd kp ne kt nf kx ng lw my mz na nb bi translated"><a class="ae kf" href="https://github.com/IdentityServer/IdentityServer3.md" rel="noopener ugc nofollow" target="_blank">身份服务器3 </a> ( <a class="ae kf" href="https://github.com/FormidableLabs/react-native-app-auth/blob/master/docs/config-examples/identity-server-3.md" rel="noopener ugc nofollow" target="_blank">示例配置</a>)</li><li id="4659" class="mt mu it le b lf nc lj nd kp ne kt nf kx ng lw my mz na nb bi translated"><a class="ae kf" href="https://developers.google.com/identity/protocols/OAuth2" rel="noopener ugc nofollow" target="_blank">谷歌</a> ( <a class="ae kf" href="https://github.com/FormidableLabs/react-native-app-auth/blob/master/docs/config-examples/google.md" rel="noopener ugc nofollow" target="_blank">示例配置</a>)</li><li id="92b8" class="mt mu it le b lf nc lj nd kp ne kt nf kx ng lw my mz na nb bi translated"><a class="ae kf" href="https://developer.okta.com/" rel="noopener ugc nofollow" target="_blank"> Okta </a> ( <a class="ae kf" href="https://github.com/FormidableLabs/react-native-app-auth/blob/master/docs/config-examples/okta.md" rel="noopener ugc nofollow" target="_blank">示例配置</a>)</li><li id="f0a1" class="mt mu it le b lf nc lj nd kp ne kt nf kx ng lw my mz na nb bi translated"><a class="ae kf" href="http://www.keycloak.org/" rel="noopener ugc nofollow" target="_blank">键盘锁</a> ( <a class="ae kf" href="https://github.com/FormidableLabs/react-native-app-auth/blob/master/docs/config-examples/keycloak.md" rel="noopener ugc nofollow" target="_blank">示例配置</a>)</li><li id="fbd5" class="mt mu it le b lf nc lj nd kp ne kt nf kx ng lw my mz na nb bi translated"><a class="ae kf" href="https://docs.microsoft.com/en-us/azure/active-directory" rel="noopener ugc nofollow" target="_blank"> Azure活动目录</a> ( <a class="ae kf" href="https://github.com/FormidableLabs/react-native-app-auth/blob/master/docs/config-examples/azure-active-directory.md" rel="noopener ugc nofollow" target="_blank">示例配置</a>)</li><li id="20bb" class="mt mu it le b lf nc lj nd kp ne kt nf kx ng lw my mz na nb bi translated"><a class="ae kf" href="https://eu-west-1.console.aws.amazon.com/cognito" rel="noopener ugc nofollow" target="_blank"> AWS认知</a> ( <a class="ae kf" href="https://github.com/FormidableLabs/react-native-app-auth/blob/master/docs/config-examples/aws-cognito.md" rel="noopener ugc nofollow" target="_blank">示例配置</a>)</li></ul><h1 id="bc5c" class="mc kh it bd ki md me mf kl mg mh mi ko mj mk ml ks mm mn mo kw mp mq mr la ms bi translated">经过测试的OAuth2提供程序:</h1><p id="0ad0" class="pw-post-body-paragraph lc ld it le b lf lg lh li lj lk ll lm kp ln lo lp kt lq lr ls kx lt lu lv lw im bi translated">这些提供者实现OAuth2规范，但不是OpenID提供者，这意味着您必须自己配置授权和令牌端点。</p><ul class=""><li id="fe6a" class="mt mu it le b lf lx lj ly kp mv kt mw kx mx lw my mz na nb bi translated"><a class="ae kf" href="https://developer.uber.com/docs/deliveries/guides/three-legged-oauth.md" rel="noopener ugc nofollow" target="_blank">优步</a> ( <a class="ae kf" href="https://github.com/FormidableLabs/react-native-app-auth/blob/master/docs/config-examples/uber" rel="noopener ugc nofollow" target="_blank">示例配置</a>)</li><li id="9c15" class="mt mu it le b lf nc lj nd kp ne kt nf kx ng lw my mz na nb bi translated"><a class="ae kf" href="https://dev.fitbit.com/build/reference/web-api/oauth2/" rel="noopener ugc nofollow" target="_blank"> Fitbit </a> ( <a class="ae kf" href="https://github.com/FormidableLabs/react-native-app-auth/blob/master/docs/config-examples/fitbit.md" rel="noopener ugc nofollow" target="_blank">示例配置</a>)</li><li id="7dbf" class="mt mu it le b lf nc lj nd kp ne kt nf kx ng lw my mz na nb bi translated"><a class="ae kf" href="https://www.dropbox.com/developers/reference/oauth-guide" rel="noopener ugc nofollow" target="_blank"> Dropbox </a> ( <a class="ae kf" href="https://github.com/FormidableLabs/react-native-app-auth/blob/master/docs/config-examples/dropbox.md" rel="noopener ugc nofollow" target="_blank">示例配置</a>)</li><li id="f857" class="mt mu it le b lf nc lj nd kp ne kt nf kx ng lw my mz na nb bi translated"><a class="ae kf" href="https://github.com/reddit-archive/reddit/wiki/oauth2" rel="noopener ugc nofollow" target="_blank"> Reddit </a> ( <a class="ae kf" href="https://github.com/FormidableLabs/react-native-app-auth/blob/master/docs/config-examples/reddit.md" rel="noopener ugc nofollow" target="_blank">示例配置</a>)</li></ul><h2 id="91b3" class="kg kh it bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated"><strong class="ak">安装</strong></h2><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="c45d" class="kg kh it nm b gy nq nr l ns nt">npm install react-native-app-auth --save<br/>react-native link react-native-app-auth</span></pre><p id="11fa" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated"><strong class="le iu"> IOS <br/> </strong>在文档中，有三种方法可以实现这种状态，但我更喜欢<strong class="le iu"> CocoaPods。</strong></p><p id="e529" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">如果您是第一次使用CocoaPods，请完成以下步骤:</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="efac" class="kg kh it nm b gy nq nr l ns nt">sudo gem install cocoapods</span></pre><p id="11f4" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">从您的根文件夹打开</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="e065" class="kg kh it nm b gy nq nr l ns nt">cd ios</span><span id="d3e0" class="kg kh it nm b gy nu nr l ns nt">pod init</span></pre><p id="3de2" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">pod init命令将初始化iOS目录中的pod文件。</p><p id="102f" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">然后在Podfile的<strong class="le iu">target‘your _ app’do</strong>之后添加下面这一行</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="8239" class="kg kh it nm b gy nq nr l ns nt">pod 'AppAuth', '0.95.0'</span></pre><h2 id="4a6b" class="kg kh it bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated"><strong class="ak">注册重定向URL方案</strong></h2><p id="3164" class="pw-post-body-paragraph lc ld it le b lf lg lh li lj lk ll lm kp ln lo lp kt lq lr ls kx lt lu lv lw im bi translated">如果您打算支持iOS 10和更早版本，您需要在您的<code class="fe nv nw nx nm b">Info.plist</code>中定义支持的重定向URL方案，如下所示:</p><p id="4cc7" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">注意:您将从<strong class="le iu"> oauth提供者</strong>处获得这些值。<br/>谷歌:<a class="ae kf" href="https://console.developers.google.com/" rel="noopener ugc nofollow" target="_blank">https://console.developers.google.com/</a></p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="db3a" class="kg kh it nm b gy nq nr l ns nt">&lt;key&gt;CFBundleURLTypes&lt;/key&gt;<br/>&lt;array&gt;<br/>  &lt;dict&gt;<br/>    &lt;key&gt;CFBundleURLName&lt;/key&gt;<br/>    &lt;string&gt;com.your.app.identifier&lt;/string&gt;<br/>    &lt;key&gt;CFBundleURLSchemes&lt;/key&gt;<br/>    &lt;array&gt;<br/>      &lt;string&gt;io.identityserver.demo&lt;/string&gt;<br/>    &lt;/array&gt;<br/>  &lt;/dict&gt;<br/>&lt;/array&gt;</span></pre><ul class=""><li id="0da6" class="mt mu it le b lf lx lj ly kp mv kt mw kx mx lw my mz na nb bi translated"><code class="fe nv nw nx nm b">CFBundleURLName</code>是任何全局唯一的字符串。一个常见的做法是使用你的应用标识符。</li><li id="4fd0" class="mt mu it le b lf nc lj nd kp ne kt nf kx ng lw my mz na nb bi translated"><code class="fe nv nw nx nm b">CFBundleURLSchemes</code>是你的应用程序需要处理的一系列URL方案。方案是OAuth重定向URL的开始，直到方案分隔符(<code class="fe nv nw nx nm b">:</code>)字符。</li></ul><h2 id="8929" class="kg kh it bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated"><strong class="ak">在AppDelegate中定义openURL回调</strong></h2><p id="a2ef" class="pw-post-body-paragraph lc ld it le b lf lg lh li lj lk ll lm kp ln lo lp kt lq lr ls kx lt lu lv lw im bi translated">您需要保留auth会话，以便从重定向继续授权流。请遵循以下步骤:</p><p id="4c39" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">使<code class="fe nv nw nx nm b">AppDelegate</code>符合<code class="fe nv nw nx nm b">RNAppAuthAuthorizationFlowManager</code>，对<code class="fe nv nw nx nm b">AppDelegate.h</code>做如下修改:</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="504d" class="kg kh it nm b gy nq nr l ns nt">+ #import "RNAppAuthAuthorizationFlowManager.h"</span><span id="3fa3" class="kg kh it nm b gy nu nr l ns nt">- @interface AppDelegate : UIResponder &lt;UIApplicationDelegate&gt;<br/>+ @interface AppDelegate : UIResponder &lt;UIApplicationDelegate, RNAppAuthAuthorizationFlowManager&gt;</span><span id="5283" class="kg kh it nm b gy nu nr l ns nt">+ @property(nonatomic, weak)id&lt;RNAppAuthAuthorizationFlowManagerDelegate&gt;authorizationFlowManagerDelegate;</span></pre><p id="f9dd" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">从<code class="fe nv nw nx nm b">AppDelegate.m</code>中的<code class="fe nv nw nx nm b">UIApplicationDelegate</code>改变以下方法:</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="e894" class="kg kh it nm b gy nq nr l ns nt">- (BOOL)application:(UIApplication *)app openURL:(NSURL *)url options:(NSDictionary&lt;NSString *, id&gt; *)options {<br/> return [self.authorizationFlowManagerDelegate resumeExternalUserAgentFlowWithURL:url];<br/>}</span></pre><p id="cec8" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated"><strong class="le iu">安卓</strong></p><p id="6761" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">成功链接后，您应该添加<strong class="le iu">Android/app/build . grandle</strong>文件defaultConfig值作为您的标识符重定向url。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="eb9f" class="kg kh it nm b gy nq nr l ns nt">manifestPlaceholders = [</span><span id="04b0" class="kg kh it nm b gy nu nr l ns nt">appAuthRedirectScheme: “<!-- -->io.identityserver.demo<!-- -->”</span><span id="8677" class="kg kh it nm b gy nu nr l ns nt">]</span></pre><h2 id="544e" class="kg kh it bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">使用</h2><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="b6d4" class="kg kh it nm b gy nq nr l ns nt">import { authorize } from 'react-native-app-auth';</span><span id="9035" class="kg kh it nm b gy nu nr l ns nt">// base config<br/>const config = {<br/>  issuer: '&lt;YOUR_ISSUER_URL&gt;',<br/>  clientId: '&lt;YOUR_CLIENT_ID&gt;',<br/>  redirectUrl: '&lt;YOUR_REDIRECT_URL&gt;',<br/>  scopes: ['&lt;YOUR_SCOPES_ARRAY&gt;'],<br/>};</span><span id="bb8b" class="kg kh it nm b gy nu nr l ns nt">// use the client to make the auth request and receive the authState<br/>try {<br/>  const result = await authorize(config);<br/>  // result includes accessToken, accessTokenExpirationDate and refreshToken<br/>} catch (error) {<br/>  console.log(error);<br/>}</span></pre></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><p id="11bd" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated"><em class="of">如果你觉得这篇文章很有帮助，你可以通过使用我的推荐链接注册一个</em> <a class="ae kf" href="https://melihyumak.medium.com/membership" rel="noopener"> <strong class="le iu"> <em class="of">中级会员来访问类似的文章</em> </strong> </a> <em class="of">。</em>T38</p><p id="bedb" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated"><strong class="le iu"> <em class="of">关注我</em> </strong> <a class="ae kf" href="https://twitter.com/hadnazzar" rel="noopener ugc nofollow" target="_blank"> <strong class="le iu">推特</strong> </a></p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi og"><img src="../Images/e09adde9fd734db2f987c8df72839da8.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/0*NxeTL1qQlC1dv9-b.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">在<a class="ae kf" href="https://www.youtube.com/c/TechnologyandSoftware?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank"> Youtube </a>上订阅更多内容</figcaption></figure><h1 id="8d23" class="mc kh it bd ki md me mf kl mg mh mi ko mj mk ml ks mm mn mo kw mp mq mr la ms bi translated">编码快乐！</h1><p id="d50c" class="pw-post-body-paragraph lc ld it le b lf lg lh li lj lk ll lm kp ln lo lp kt lq lr ls kx lt lu lv lw im bi translated">梅利赫</p></div></div>    
</body>
</html>