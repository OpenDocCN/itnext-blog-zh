<html>
<head>
<title>📷 Building a Camera App in TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">📷在TypeScript中构建相机应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/building-a-camera-app-in-typescript-f1981f5ce960?source=collection_archive---------2-----------------------#2019-05-17">https://itnext.io/building-a-camera-app-in-typescript-f1981f5ce960?source=collection_archive---------2-----------------------#2019-05-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5373" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何用HTML5、CSS3和TypeScript构建一个简单的照片应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/39dce52c451f1aa78dd393f99ce242ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zv2kKyn9_51p3phX6C9ujA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">使用<a class="ae ky" href="https://kenreilly.github.io/typescript-photo-booth/" rel="noopener ugc nofollow" target="_blank">简单的基于浏览器的相机应用</a>的<a class="ae ky" href="https://code.visualstudio.com" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码</a>的截图</figcaption></figure><h2 id="3154" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">介绍</h2><p id="e045" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">在本文中，我们将看看如何在<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5" rel="noopener ugc nofollow" target="_blank"> HTML5 </a>、<a class="ae ky" href="https://developer.mozilla.org/en/docs/Web/CSS/CSS3" rel="noopener ugc nofollow" target="_blank"> CSS3 </a>和<a class="ae ky" href="https://www.typescriptlang.org" rel="noopener ugc nofollow" target="_blank"> TypeScript </a>中构建一个简单的相机web应用程序。该项目的完整源代码可在<a class="ae ky" href="https://github.com/kenreilly/typescript-photo-booth" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p><p id="dc9c" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">TypeScript强大而丰富的特性集非常适合从头构建定制应用程序，因为开发人员可以从一个干净而稳定的环境开始，如<a class="ae ky" href="https://nodejs.org" rel="noopener ugc nofollow" target="_blank"> node </a>，或者在我们的例子中，从一个<a class="ae ky" href="https://caniuse.com/#feat=es5" rel="noopener ugc nofollow" target="_blank">现代浏览器API </a>(两者都包括JavaScript引擎的高性能实现)。</p><p id="73da" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">现代的、符合标准的浏览器提供了极其强大和灵活的API，用于以各种方式使用浏览器引擎，包括访问各种硬件设备(如照相机)。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="9d8b" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">项目配置</h2><p id="7710" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">让我们看看用<em class="na"> npm init </em>生成的<strong class="lx iu"> package.json </strong>文件，以及一个干净的<strong class="lx iu"> tsconfig.json </strong>来定义编译器选项:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/1afa4fb9d09a8a787687cb31caab95f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zt5qKav1l4zvx-CsauBkKQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">包含<strong class="bd lb"> package.json </strong>和<strong class="bd lb"> tsconfig.json </strong>文件的项目结构</figcaption></figure><p id="031f" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">除了node和TypeScript编译器之外，该项目不使用任何外部依赖项。文件<strong class="lx iu"> tsconfig.json </strong>指示TypeScript编译器生成ES6模块并输出到<strong class="lx iu">。/build </strong>文件夹。这就完成了项目配置，意味着剩下的部分必须手工实现。虽然具有挑战性，但类型检查和其他语言功能，以及现代开发环境中可用的强大代码完成和重构工具，如<a class="ae ky" href="https://code.visualstudio.com" rel="noopener ugc nofollow" target="_blank"> Visual Studio Code </a>，使这变得更加容易。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="80c8" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">应用程序HTML结构</h2><p id="da6c" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">这个简单应用的页面结构在<strong class="lx iu">index.html</strong>中定义:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/793bd7312be119efc6e321cdce3086a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ReHMEllZ--XCfk67jAvurw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd lb">index.html</strong>用元数据和文件导入</figcaption></figure><p id="80c9" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">这个短小精悍的HTML文件包含了一个像样的示例应用程序所需的最基本的东西:一些<a class="ae ky" href="http://ogp.me/" rel="noopener ugc nofollow" target="_blank">打开图</a>和其他元数据，以及<strong class="lx iu"> css/style.css </strong>和模块<strong class="lx iu">的导入。/build/photobooth.js </strong>和app结构，这是一个带有<strong class="lx iu">视频的<strong class="lx iu">主</strong>容器、</strong>和一个带有两个<strong class="lx iu">按钮</strong>的<strong class="lx iu">页脚</strong>—一个用于拍照，另一个用于在设备相机之间切换。</p><p id="fdc2" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">注意用于<strong class="lx iu">按钮</strong>图标的内嵌<a class="ae ky" href="https://en.wikipedia.org/wiki/Scalable_Vector_Graphics" rel="noopener ugc nofollow" target="_blank"> SVG </a>。通过将<strong class="lx iu"> svg </strong>元素上的<em class="na"> viewBox </em>属性设置为<em class="na">-1-1 2 2】，</em>整个框的点坐标系在每个轴上居中于-1和1之间。这使得像上面例子中那样画圆和人字形变得相当简单，使用像<em class="na"> r=0.6 </em>这样的值来表示从中心到边缘总跨度的<em class="na"> 60% </em>。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="599c" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">应用程序CSS定义</h2><p id="8032" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">此应用程序的布局和样式在<strong class="lx iu"> css/style.css </strong>中定义:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/cd34c499064ae24cee48e041b351a46a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S7v8HmPpmVyUP58A8TN7WA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd lb"> style.css </strong>定义(减去<strong class="bd lb">按钮:悬停</strong>效果)</figcaption></figure><p id="0cd3" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">这个文件也很短，除了<em class="na">按钮:悬停</em>选择器之外，它的大部分都适合这个截图。为了简单起见，已经为页脚度量定义了一个根单元<em class="na"> 16px </em>，其中<strong class="lx iu">页脚</strong>高度为(<em class="na"> 16px * 7) </em>，而<strong class="lx iu">按钮</strong>高度为(<em class="na"> 16px * 5) </em>，这导致页脚与按钮高度的比例为<em class="na"> 7:5 </em>。</p><p id="b98f" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><strong class="lx iu"> html </strong>、<strong class="lx iu"> body </strong>和<strong class="lx iu"> svg </strong>图标被设置为<em class="na"> 100% </em>宽度和高度，空白或填充。<strong class="lx iu">视频</strong>宽度设置为<em class="na"> 100vw，</em>高度设置为<em class="na"> 100vh </em>减去页脚高度。使用<a class="ae ky" href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/" rel="noopener ugc nofollow" target="_blank"> CSS3 Flexbox属性</a>将按钮水平居中并均匀分布在页脚。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="8353" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">TypeScript实现</h2><p id="d33f" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">接下来是包含该应用程序主要功能的实际实现的TypeScript文件，它们是:</p><ol class=""><li id="ffec" class="nc nd it lx b ly mo mb mp li ne lm nf lq ng mn nh ni nj nk bi translated">预览实时摄像机输出</li><li id="801c" class="nc nd it lx b ly nl mb nm li nn lm no lq np mn nh ni nj nk bi translated">在前置和后置摄像头之间切换</li><li id="068d" class="nc nd it lx b ly nl mb nm li nn lm no lq np mn nh ni nj nk bi translated">拍照并保存到本地设备文件系统</li></ol><p id="ed0f" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">首先我们来看看文件<strong class="lx iu"> src/types.ts </strong>，为了方便和类型安全，其中导出了一些有用的类型:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/1083ab090118e9be1e2f7473c75630ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u082MYQ9OZ-u-vUs44Rd6A.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd lb"> src/types.ts </strong>的内容，带有各种类型的定义</figcaption></figure><p id="8ff1" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">在文件<strong class="lx iu"> src/types.ts，</strong>中有一个用于<strong class="lx iu"> CameraMode </strong>的enum，它将用于选择前后摄像头，一个<strong class="lx iu"> IButtons </strong>接口定义了app按钮，还有一个<strong class="lx iu"> Defaults </strong>类定义了<em class="na"> width=640 </em>。</p><p id="dc4d" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">接下来是主应用文件，<strong class="lx iu"> src/photobooth.ts </strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/3d9a2a94d499d23dcd88040561456d7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VP4TjpksOaeAHmvIZkqfwA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">具有静态属性和初始化器的<strong class="bd lb"> PhotoBooth </strong>抽象类</figcaption></figure><p id="82ba" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><strong class="lx iu"> PhotoBooth </strong>类包含静态属性，用于保存对应用程序中使用的这四个重要组件的引用:</p><ol class=""><li id="0c4b" class="nc nd it lx b ly mo mb mp li ne lm nf lq ng mn nh ni nj nk bi translated"><strong class="lx iu">模式</strong>:当前选择的<strong class="lx iu">相机模式</strong></li><li id="cf66" class="nc nd it lx b ly nl mb nm li nn lm no lq np mn nh ni nj nk bi translated"><strong class="lx iu">按钮</strong>:按钮<strong class="lx iu"> HTMLButtonElement </strong></li><li id="b94b" class="nc nd it lx b ly nl mb nm li nn lm no lq np mn nh ni nj nk bi translated"><strong class="lx iu">画布</strong>:屏幕外的<strong class="lx iu">画布</strong>，用于从直播流中提取照片</li><li id="38e9" class="nc nd it lx b ly nl mb nm li nn lm no lq np mn nh ni nj nk bi translated"><strong class="lx iu"> video </strong>:一个<strong class="lx iu"> HTMLVideoElement </strong>显示现场摄像机流</li></ol><p id="b0e8" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">还定义了一个静态的<strong class="lx iu"> init() </strong>方法，该方法检索对按钮的DOM引用以将点击处理程序附加到按钮上，然后调用静态方法<strong class="lx iu"> on_enumerate_devices() </strong>，该方法进而开始摄像机初始化。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/108192687921be33cb74d6d678ad5ab5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2g1HjK93IQTmUXyIa4mm0Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">具有初始化和特征方法的<strong class="bd lb"> PhotoBooth </strong>类</figcaption></figure><p id="cb1d" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">方法<strong class="lx iu"> init_camera() </strong>通过调用<strong class="lx iu"> get_media() </strong>方法来初始化摄像机，以从浏览器中检索一个<strong class="lx iu">Promise&lt;media stream&gt;</strong>，该Promise与<strong class="lx iu"> constraints、</strong>中定义的标准相匹配，然后将该Promise传递给<strong class="lx iu"> on_get_media() </strong>处理程序，该处理程序进而设置<strong class="lx iu"> canvas </strong>和<strong class="lx iu"> video </strong>对象并设置设置画布和视频的高度和宽度的最终初始化任务放在<strong class="lx iu"> on_video_ready() </strong>处理程序中，一旦浏览器完成将其加载到DOM并呈现在屏幕上，该处理程序就会由<strong class="lx iu"> video </strong>元素触发。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/faf63281cd4cc4cc8fbcb50de4dd60d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RVQSLWuc9rc47CK2pvIOdQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">显示处理程序和特征方法的<strong class="bd lb"> PhotoBooth </strong>类</figcaption></figure><p id="8c7e" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">在<strong class="lx iu"> PhotoBooth </strong>类中定义的最后一个事件处理程序是<strong class="lx iu"> on_error() </strong>，它被用作应用程序中<strong class="lx iu"> Promise </strong>对象的通用错误处理程序，通过。<strong class="lx iu"> catch() </strong>方法。此外，我们有照片应用程序的实际功能。第一个是<strong class="lx iu"> take_photo() </strong>，它检索一个<strong class="lx iu">。jpeg </strong>图像，通过屏幕外<strong class="lx iu">画布</strong>对象代理<strong class="lx iu">视频</strong>，然后通过锚点触发下载。<em class="na"> click() </em>事件。第二种是方法<strong class="lx iu"> switch_cam() </strong>，<strong class="lx iu"> </strong>交换<strong class="lx iu"> CameraMode </strong>并重新初始化相机。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="d22f" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h2><p id="866a" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">这个示例项目演示了如何利用HTML5、CSS3和TypeScript的现代特性以及为支持它们而设计的环境，用几行html 5、CSS3和TypeScript构建一个简单应用程序的原型。TypeScript的强大功能之一是能够以非常结构化的方式定义应用程序，在这种方式中，它类似于设计良好的服务器机架，而不是到处都是杂乱无章的电线。</p><p id="cafe" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">该应用的完整源代码可在<a class="ae ky" href="https://github.com/kenreilly/typescript-photo-booth" rel="noopener ugc nofollow" target="_blank">此处</a>获得，现场演示可在此处<a class="ae ky" href="https://kenreilly.github.io/typescript-photo-booth" rel="noopener ugc nofollow" target="_blank">获得。</a></p><p id="b266" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我希望你喜欢这篇文章，并发现它很有用。如果你有任何更正或建议，或任何其他想法，请随时给我留言。</p><p id="c89d" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">感谢阅读！</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><blockquote class="nr"><p id="546f" class="ns nt it bd nu nv nw nx ny nz oa mn dk translated">肯尼斯·雷利(<a class="ae ky" href="https://twitter.com/8_bit_hacker" rel="noopener ugc nofollow" target="_blank"> 8_bit_hacker </a>)是<a class="ae ky" href="https://lvl-up.tech/" rel="noopener ugc nofollow" target="_blank"> LevelUP </a>的CTO</p></blockquote></div></div>    
</body>
</html>