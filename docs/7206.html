<html>
<head>
<title>SQLcl Docker Desktop Extension</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQLcl Docker桌面扩展</h1>
<blockquote>原文：<a href="https://itnext.io/sqlcl-docker-desktop-extension-982c51110835?source=collection_archive---------0-----------------------#2022-07-15">https://itnext.io/sqlcl-docker-desktop-extension-982c51110835?source=collection_archive---------0-----------------------#2022-07-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f7fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我解释了通过Docker扩展为开发者提供的生态系统的重要性之后，我决定为<a class="ae kl" href="https://www.oracle.com/database/sqldeveloper/technologies/sqlcl/" rel="noopener ugc nofollow" target="_blank">Oracle SQL工具</a>构建一个新的生态系统，它与我之前为<a class="ae kl" rel="noopener ugc nofollow" target="_blank" href="/oraclexe-21c-docker-extension-95c25bec0f31"> OracleXE </a>构建的生态系统成对工作</p><p id="cb4d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这一扩展背后的想法是有一个简单的命令行工具来连接Oracle XE 21c或任何其他RDBMS实例，包括基于云的部署。这个扩展看起来像这样:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/938633af324227223aa03c55e066676d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VZVgu04Ny2dS6aLO"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">Oracle SQLcl Docker桌面扩展</figcaption></figure><h1 id="b6ff" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">为什么我需要SQLcl Docker桌面扩展</h1><p id="d050" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">SQL客户端工具如<strong class="jp ir"> <em class="mf"> SQLcl </em> </strong>可以在任何操作系统上下载和安装，但需要几个步骤:下载、解压、安装<strong class="jp ir"><em class="mf"/></strong>，最后创建快捷方式图标。</p><p id="c36f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用Docker Desktop作为开发环境的基础，您只需点击几下鼠标就可以使用一个<strong class="jp ir"><em class="mf"/></strong>SQL，无需在您的计算机中安装库或额外的<strong class="jp ir"> <em class="mf"> JDK </em> </strong>。只需安装，您将得到如下所示的<strong class="jp ir"><em class="mf">SQL QL</em></strong>欢迎屏幕:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/e95ac7e28fe8ece684b4affa07f9a4a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rug0E_OjegM_Gsdj"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">SQL欢迎页面</figcaption></figure><h1 id="c0bc" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">手动安装</h1><p id="eaf0" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">在Docker扩展中心准备好该扩展之前，您只需执行以下命令即可安装:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="8499" class="ml ld iq mh b gy mm mn l mo mp">$ docker extension install <a class="ae kl" href="https://hub.docker.com/repository/docker/mochoa/sqlcl-docker-extension" rel="noopener ugc nofollow" target="_blank">mochoa/sqlcl-docker-extension:22.2.0</a><br/>Extensions can install binaries, invoke commands and access files on your machine.<br/>Are you sure you want to continue? [y/N] y<br/>Installing new extension "mochoa/sqlcl-docker-extension:22.2.0"<br/>Installing service in Desktop VM...<br/>Setting additional compose attributes<br/>VM service started<br/>Installing Desktop extension UI for tab "sqlcl"...<br/>Extension UI tab "sqlcl" added.<br/>Extension "Oracle SQLcl client tool" installed successfully</span></pre><p id="1a71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用SQLcl Docker扩展</strong></p><p id="3ffa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装完扩展后，Docker桌面的<strong class="jp ir"> <em class="mf">扩展(Beta) </em> </strong>窗格中会列出一个新的扩展。</p><p id="0970" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过点击<strong class="jp ir"><em class="mf">SQL</em></strong>图标，扩展主窗口将显示该扩展加载过程，并显示几秒钟的进度条指示器</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/0127959e7afa4c85d4ca1af4a09c33c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*InFW6B4LmjhlXXGt"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">加载进度条</figcaption></figure><p id="c938" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦加载了<strong class="jp ir"> <em class="mf"> SQLcl </em> </strong>，您必须使用connect命令进行连接，例如使用OracleXE和scott用户:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/8793e66fbe507ea4b187e2c02fe57f78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*byHiGwErBTMAum-y"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">使用OracleXE和scott用户连接的示例</figcaption></figure><p id="6d56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要从外部Docker容器连接，我的意思是不作为容器运行的应用程序可以使用localhost:1521，但是要从其他容器连接，你必须使用内部IP；在Docker桌面上运行的OracleXE的IP可在菜单中找到，设置-&gt;资源-&gt;网络-&gt; Docker子网，在我的例子中是192.168.65.0/24，因此用于访问OracleXE的内部IP是192.168.65.2，还有一个内部DNS名称解析上述IP，名为<strong class="jp ir"><em class="mf">host . Docker . internal</em></strong>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mq"><img src="../Images/af4459ecf5f34b5027f95bfa211c861f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*a37_X3RpkMeiW9gA"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">找到Docker子网的IP地址</figcaption></figure><p id="8ff7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从上面的截图看，它显示了如下连接信息:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="360a" class="ml ld iq mh b gy mm mn l mo mp">SQL&gt; connect scott/tiger@host.docker.internal:1521/xepdb1</span></pre><p id="9720" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这意味着:</p><ul class=""><li id="bc7f" class="mr ms iq jp b jq jr ju jv jy mt kc mu kg mv kk mw mx my mz bi translated">用户:<strong class="jp ir">T43【斯科特】T44</strong></li><li id="c21f" class="mr ms iq jp b jq na ju nb jy nc kc nd kg ne kk mw mx my mz bi translated">密码:<strong class="jp ir"> <em class="mf">老虎</em> </strong></li><li id="5e59" class="mr ms iq jp b jq na ju nb jy nc kc nd kg ne kk mw mx my mz bi translated">数据库IP:<strong class="jp ir"><em class="mf">host . docker . internal</em>T3】</strong></li><li id="e4eb" class="mr ms iq jp b jq na ju nb jy nc kc nd kg ne kk mw mx my mz bi translated">数据库端口:<strong class="jp ir">T5 1521T7】</strong></li><li id="b39d" class="mr ms iq jp b jq na ju nb jy nc kc nd kg ne kk mw mx my mz bi translated">PDB: <strong class="jp ir"> <em class="mf"> xepdb1 </em> </strong></li></ul><p id="c26d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所见，我使用的是具有密码tiger的历史用户scott，该用户是在OracleXE Docker桌面扩展首次启动时创建的。</p><h1 id="e652" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">体系结构</h1><p id="fa4e" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">在引擎盖下，这个Docker扩展启动了一个具有两个主要进程的容器，一个服务应用程序与Docker桌面上运行的UI(Ract app)进行对话，一个ttyd作为用Java编写的SQL命令行应用程序的web前端。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nf"><img src="../Images/99436f058896a0a9d91244913ecfeb0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UsIC-hsr8FKWqBwQ"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">在扩展虚拟机上运行的进程</figcaption></figure><p id="d5a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://tsl0922.github.io/ttyd/" rel="noopener ugc nofollow" target="_blank"> ttyd </a>流程包括包装为终端设计的旧命令行应用程序的功能，以通过浏览器作为web应用程序运行。我从扩展<a class="ae kl" href="https://github.com/spurin/diveintoansible-extension" rel="noopener ugc nofollow" target="_blank"> Dive Into Ansible Lab — Docker扩展</a>中获得了这个想法。</p><p id="d4d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，<strong class="jp ir"> <em class="mf"> tini </em> </strong> app用于避免扩展在没有使用exit命令的情况下关闭时的Java僵尸进程。接下来的截图展示了<strong class="jp ir"> <em class="mf"> ttyd </em> </strong> app如何在浏览器中包装命令行应用</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ng"><img src="../Images/e38b9e4f99443f9c20a4a7ae6b37c025.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*zzVP9EUn4-ZNK93jGq3mLA.gif"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">ttyd示例用法</figcaption></figure><p id="1585" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，用Go语言编写的服务应用程序监听Docker桌面UI并检查<strong class="jp ir"> <em class="mf"> ttyd </em> </strong>守护进程的可用性，一旦<strong class="jp ir"> <em class="mf"> ttyd </em> </strong>准备好接受http连接，Docker桌面扩展就使用main的ttyd页面重新加载，该页面使用<strong class="jp ir"> <em class="mf"> sqlcl </em> </strong>和<strong class="jp ir"> <em class="mf"> /nolog </em> </strong>参数运行。</p><h1 id="a6ca" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">上传/下载文件</h1><p id="86b3" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">如果您想从Oracle<strong class="jp ir"><em class="mf"/></strong>中导入/导出大文件，使用<strong class="jp ir"> <em class="mf"> SQLcl </em> </strong>的一些功能，如<strong class="jp ir"> <em class="mf"> dp </em> </strong>(数据泵)或load命令是必要的，以便将文件提供给扩展永久卷，您可以通过使用Volumes菜单来检查它:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nh"><img src="../Images/fbacfe9f7c12d99793e733c5af85d692.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DZdlhN995x75t5a9"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">Docker卷</figcaption></figure><p id="36d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">持久卷是<strong class="jp ir"><em class="mf">mochoa _ SQL cl-docker-extension-desktop-extension _ SQL cl _ home</em></strong>。</p><p id="5417" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">摘自杰夫·史密斯博客但使用了SQLcl Docker扩展的示例用法如下:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="cd9e" class="ml ld iq mh b gy mm mn l mo mp">SQL&gt; set feedback off<br/>SQL&gt; spool <strong class="mh ir"><em class="mf">objects.csv</em></strong><br/>SQL&gt; SELECT * FROM all_objects fetch FIRST 100 ROWS ONLY;<br/>SQL&gt; spool off</span></pre><p id="06f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将导出的数据复制到您的本地文件系统，并在另一个目录中再次上传，在命令行shell中运行以下命令:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="fd14" class="ml ld iq mh b gy mm mn l mo mp">$ docker cp <strong class="mh ir"><em class="mf">mochoa_sqlcl-docker-extension-desktop-extension-service:/home/sqlcl/objects.csv</em></strong> .<br/>$ docker cp objects.csv <strong class="mh ir"><em class="mf">mochoa_sqlcl-docker-extension-desktop-extension-service:/tmp</em></strong></span></pre><p id="9b3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后使用SQLcl LOAD命令再次导入:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="3924" class="ml ld iq mh b gy mm mn l mo mp">SQL&gt; CREATE TABLE demo_load AS SELECT * FROM all_objects WHERE 1=2;<br/>Table DEMO_LOAD created.</span><span id="4747" class="ml ld iq mh b gy ni mn l mo mp">SQL&gt; load demo_load /tmp/objects.csv<br/>Load data into table SCOTT.DEMO_LOAD</span><span id="1167" class="ml ld iq mh b gy ni mn l mo mp">csv<br/>column_names on<br/>delimiter ,<br/>enclosures ""<br/>encoding UTF8<br/>row_limit off<br/>row_terminator default<br/>skip_rows 0<br/>skip_after_names</span><span id="d605" class="ml ld iq mh b gy ni mn l mo mp">#INFO Number of rows processed: 100<br/>#INFO Number of rows in error: 0<br/>#INFO No rows committed<br/>SUCCESS: Processed without errors</span><span id="89a7" class="ml ld iq mh b gy ni mn l mo mp">SQL&gt; set sqlformat default<br/>SQL&gt; select count(*) from demo_load;<br/>  COUNT(*)<br/>----------<br/>       100</span></pre><h1 id="c556" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">连接到Oracle云自治数据库</h1><p id="3e28" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">SQLcl Desktop Extension能够连接到您的自治数据库，您必须首先从OCI云控制台下载您的Wallet文件，如<a class="ae kl" href="https://docs.oracle.com/en-us/iaas/autonomous-database-shared/doc/connect-download-wallet.html#GUID-B06202D2-0597-41AA-9481-3B174F75D4B1" rel="noopener ugc nofollow" target="_blank">下载数据库连接信息</a>中所述，您将看到一个类似如下的选项卡:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/ec72fea81006c1bc7cc10417f6e4b09f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*wendOYTkXqtViKsxHy70BQ.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">ATP数据库连接Wallet下载标签</figcaption></figure><p id="4f24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有了Zip文件后，使用docker cp命令将它上传到SQL持久卷:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="dcc5" class="ml ld iq mh b gy mm mn l mo mp">$ docker cp <strong class="mh ir"><em class="mf">Wallet_DBparquet.zip</em></strong> mochoa_sqlcl-docker-extension-desktop-extension-service:/home/sqlcl</span></pre><p id="6343" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，在SQLcl Docker扩展中使用您的钱包:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="89e6" class="ml ld iq mh b gy mm mn l mo mp">SQL&gt; set cloudconfig /home/sqlcl/<strong class="mh ir"><em class="mf">Wallet_DBparquet.zip</em></strong><br/>SQL&gt; connect admin/***********@dbparquet_high<br/>SQL&gt; desc demo_tab<br/>SQL&gt; select count(*) from demo_tab;</span></pre><h1 id="3272" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">来源</h1><p id="7184" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">一如往常，这个扩展的代码在<a class="ae kl" href="https://github.com/marcelo-ochoa/sqlcl-docker-extension" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上，欢迎随时提出修改建议和投稿，注意，我是<strong class="jp ir">T5 ReactT7】和<strong class="jp ir">T9】TypeScriptT11】的初级开发者，所以欢迎投稿使这个<strong class="jp ir">T13】UIT15】更好。</strong></strong></strong></p></div></div>    
</body>
</html>