<html>
<head>
<title>Getting a Bearer Token in Postman / Newman Automatically for a Collection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Postman / Newman中自动获取集合的不记名令牌</h1>
<blockquote>原文：<a href="https://itnext.io/getting-a-bearer-token-in-postman-newman-automatically-for-a-collection-d3001a0dc1ea?source=collection_archive---------0-----------------------#2022-01-01">https://itnext.io/getting-a-bearer-token-in-postman-newman-automatically-for-a-collection-d3001a0dc1ea?source=collection_archive---------0-----------------------#2022-01-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/28c69e57117db4e9f004c505f76219eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*h82oVzi4imMA76yL"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">马库斯·斯皮斯克在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="e6b0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的平台需要一个不记名令牌来对所有API进行认证。在正常的流程中，我们从前端UI获得这个令牌；然而，我希望能够执行一些自动化测试，这不涉及前端。</p><p id="3850" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该团队创建了一个仅供内部使用的服务，它允许我通过编程获得一个带有用户名和密码(没有2FA)的不记名令牌。这是该团队用于他们将要做的其他一些测试的，它完全符合要求。</p><p id="0a3a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我有一个Curl命令可以运行，这很棒，但只是一部分。</p><h1 id="63f1" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">自动化邮递员</h1><p id="997d" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">现在我有了一个获得令牌的方法，我想让它自动化，这样我就可以<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/automating-api-testing-with-newman-1e5d0aabcec">通过纽曼在GitLab CI/CD </a>中运行收藏。为了实现这一点，我需要Postman/Newman能够自动获取这个令牌，然后在它的所有调用中使用它。</p><p id="28ce" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这正是“预请求脚本”的用途！让我们来看看如何将它添加到集合中。</p><p id="9950" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在集合中，没有一个请求，您将需要设置2件事。</p><h2 id="b26d" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated">授权选项卡</h2><p id="289d" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在Authorization选项卡中，将类型设置为Bearer Token，对于令牌put变量的值，我使用了{{BEARERTOKEN}}</p><figure class="mu mv mw mx gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mt"><img src="../Images/a2996b7df6d17ad6cc268670b14ea7b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0AN8iHwn7MCEP7NVq0A3Sg.png"/></div></div></figure><h2 id="868c" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated">预请求脚本选项卡</h2><p id="6390" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在“请求前脚本”选项卡中，这就是神奇的地方。在这里，我们将使用Postman用正确的参数调用我们的API，解析响应并用不记名令牌设置一个变量。</p><p id="5a7f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当然你需要修改以适应你的需求，但是下面是对我有用的。我从API得到一个JSON响应，其中的令牌在access_token键中。</p><figure class="mu mv mw mx gt ju"><div class="bz fp l di"><div class="my mz l"/></div></figure><h2 id="e69d" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated">请求设置</h2><p id="ea79" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">现在您已经设置了这两项，您的每个请求和文件夹都需要设置为从父项继承身份验证。这将使用集合中的不记名令牌！</p><figure class="mu mv mw mx gt ju gh gi paragraph-image"><div class="gh gi na"><img src="../Images/86cf9a79e6a73fa601530949ac3ee271.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*roaXEcWbsFlwOkMdnSfGCw.png"/></div></figure><h1 id="98a0" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="eb38" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">现在，您已经自动授权您的Postman收藏，您可以通过Postman或Newman完全自动地运行您的收藏。这对于我的用例来说非常完美，因为每当团队在我们的开发或QA Kubernetes环境中构建和部署一个新的容器时，我都希望运行一个完整的API测试。因为我们使用GitLab，所以我能够使用Newman容器并从那里运行集合。我将很快写下这个过程。</p><p id="f6c1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">希望你觉得这有用，如果是这样，请鼓掌或分享出来。</p></div></div>    
</body>
</html>