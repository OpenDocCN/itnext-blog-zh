<html>
<head>
<title>Using Enum in Symfony</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Symfony中使用枚举</h1>
<blockquote>原文：<a href="https://itnext.io/using-enum-in-symfony-8f32d9cfaa0f?source=collection_archive---------3-----------------------#2022-02-27">https://itnext.io/using-enum-in-symfony-8f32d9cfaa0f?source=collection_archive---------3-----------------------#2022-02-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e9d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">PHP 8.1引入了官方的<em class="kl"> Enum </em>支持。<a class="ae km" href="https://www.doctrine-project.org/2022/01/11/orm-2.11.html" rel="noopener ugc nofollow" target="_blank"> Doctrine在其ORM框架</a>中引入了Enum类型支持，<a class="ae km" href="https://symfony.com/blog/new-in-symfony-5-4-php-enumerations-support" rel="noopener ugc nofollow" target="_blank"> Symfony增加了对Enum类型的序列化和反序列化支持</a>。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/2898f06ba8a8dfe1e2f53fbfc161d43c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zM0-IX7pIVhjXuP1aJtb4w.jpeg"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">在<a class="ae km" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae km" href="https://unsplash.com/@kakachen?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> te chan </a>拍摄的照片</figcaption></figure><p id="5579" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您正在使用第三方枚举解决方案，现在是时候将您的项目迁移到使用PHP Enum了。</p><p id="5ae5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要使用PHP <em class="kl"> Enum </em>，必须升级到PHP 8.1，并在project composer文件中将PHP版本设置为<code class="fe ld le lf lg b">8.1</code>。</p><pre class="ko kp kq kr gt lh lg li lj aw lk bi"><span id="f116" class="ll lm iq lg b gy ln lo l lp lq">{<br/>    //...<br/>    "require": {<br/>        "php": "&gt;=8.1",<br/>        //...<br/>    }<br/>}</span></pre><h1 id="aa81" class="lr lm iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">正在创建枚举类</h1><p id="0116" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">例如，我们将在<code class="fe ld le lf lg b">Post</code>实体中添加一个<code class="fe ld le lf lg b">Status</code>，并定义了帖子状态的几个固定值。</p><pre class="ko kp kq kr gt lh lg li lj aw lk bi"><span id="b996" class="ll lm iq lg b gy ln lo l lp lq">&lt;?php</span><span id="c5bf" class="ll lm iq lg b gy mt lo l lp lq">namespace App\Entity;</span><span id="b7fb" class="ll lm iq lg b gy mt lo l lp lq">enum Status: string<br/>{<br/>    case Draft = "DRAFT";<br/>    case PendingModerated = "PENDING_MODERATED";<br/>    case Published = "PUBLISHED";<br/>}</span></pre><p id="fe86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我们使用一个<em class="kl">字符串</em>支持的枚举，在<code class="fe ld le lf lg b">Post</code>类中添加一个字段。</p><pre class="ko kp kq kr gt lh lg li lj aw lk bi"><span id="53e0" class="ll lm iq lg b gy ln lo l lp lq">#[Column(type: "string", enumType: Status::class)]<br/>private Status $status;</span></pre><p id="eced" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，将<em class="kl">枚举类型</em>设置为<code class="fe ld le lf lg b">Status</code>类。它将状态值作为字符串存储在数据库表中。</p><p id="dbb1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe ld le lf lg b">Post</code>构造函数中，为状态分配一个默认值。</p><pre class="ko kp kq kr gt lh lg li lj aw lk bi"><span id="9342" class="ll lm iq lg b gy ln lo l lp lq">public function __construct()<br/>{<br/>    $this-&gt;status = Status::Draft;<br/>    //...<br/>}</span></pre><p id="0140" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在一切都好了。</p><h1 id="d76a" class="lr lm iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">创建HttpMethod</h1><p id="2eee" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">当我们在控制器类上设置<code class="fe ld le lf lg b">Route</code>属性时，我们使用一个文字值来设置HTTP方法。</p><pre class="ko kp kq kr gt lh lg li lj aw lk bi"><span id="8124" class="ll lm iq lg b gy ln lo l lp lq">#[Route(path: "/{id}", name: "byId", methods: ["GET"])]</span></pre><p id="b405" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于<em class="kl">方法</em>值，只有几个选项可供选择。显然，如果引入<em class="kl">枚举</em>，它将提供一种<em class="kl">类型安全的</em>方式来设置值并减少输入错误。</p><p id="1abf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建一个名为<code class="fe ld le lf lg b">HttpMethod</code>的枚举。</p><pre class="ko kp kq kr gt lh lg li lj aw lk bi"><span id="0014" class="ll lm iq lg b gy ln lo l lp lq">&lt;?php</span><span id="9426" class="ll lm iq lg b gy mt lo l lp lq">namespace App\Annotation;</span><span id="d701" class="ll lm iq lg b gy mt lo l lp lq">enum HttpMethod<br/>{<br/>    case GET;<br/>    case POST;<br/>    case HEAD;<br/>    case OPTIONS;<br/>    case PATCH;<br/>    case PUT;<br/>    case DELETE;<br/>}</span></pre><p id="e7d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后重构<code class="fe ld le lf lg b">Route</code>属性，创建一系列属性(<code class="fe ld le lf lg b">Get</code>、<code class="fe ld le lf lg b">Post</code>、<code class="fe ld le lf lg b">Put</code>、<code class="fe ld le lf lg b">Delete</code>等)。)映射到不同的HTTP方法。</p><pre class="ko kp kq kr gt lh lg li lj aw lk bi"><span id="7435" class="ll lm iq lg b gy ln lo l lp lq">//file : src/Annotation/Get.php<br/>#[Attribute]<br/>class Get extends Route<br/>{<br/>    public function getMethods()<br/>    {<br/>        return [HttpMethod::GET-&gt;name];<br/>    }</span><span id="77b1" class="ll lm iq lg b gy mt lo l lp lq">}</span><span id="2e7d" class="ll lm iq lg b gy mt lo l lp lq">//file : src/Annotation/Head.php<br/>#[Attribute]<br/>class Head extends Route<br/>{<br/>    public function getMethods()<br/>    {<br/>        return [HttpMethod::HEAD-&gt;name];<br/>    }</span><span id="866b" class="ll lm iq lg b gy mt lo l lp lq">}</span><span id="60e6" class="ll lm iq lg b gy mt lo l lp lq">//file : src/Annotation/Options.php<br/>#[Attribute]<br/>class Options extends Route<br/>{<br/>    public function getMethods()<br/>    {<br/>        return [HttpMethod::OPTIONS-&gt;name];<br/>    }</span><span id="d8f9" class="ll lm iq lg b gy mt lo l lp lq">}</span><span id="2014" class="ll lm iq lg b gy mt lo l lp lq">//file : src/Annotation/Patch.php<br/>#[Attribute]<br/>class Patch extends Route<br/>{<br/>    public function getMethods()<br/>    {<br/>        return [HttpMethod::PATCH-&gt;name];<br/>    }<br/>}</span><span id="f6b7" class="ll lm iq lg b gy mt lo l lp lq">//file : src/Annotation/Post.php<br/>#[Attribute]<br/>class Post extends Route<br/>{<br/>    public function getMethods()<br/>    {<br/>        return [HttpMethod::POST-&gt;name];<br/>    }<br/>}</span><span id="e9d9" class="ll lm iq lg b gy mt lo l lp lq">//file : src/Annotation/Put.php<br/>#[Attribute]<br/>class Put extends Route<br/>{<br/>    public function getMethods()<br/>    {<br/>        return [HttpMethod::PUT-&gt;name];<br/>    }<br/>}</span><span id="271d" class="ll lm iq lg b gy mt lo l lp lq">//file : src/Annotation/Delete.php<br/>#[Attribute]<br/>class Delete extends Route<br/>{<br/>    public function getMethods()<br/>    {<br/>        return [HttpMethod::DELETE-&gt;name];<br/>    }<br/>}</span></pre><p id="f5d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在你可以润色<code class="fe ld le lf lg b">PostController</code>，使用这些属性代替。正如您所看到的，新属性的命名看起来更加清晰。</p><pre class="ko kp kq kr gt lh lg li lj aw lk bi"><span id="ec10" class="ll lm iq lg b gy ln lo l lp lq">#[Route(path: "/posts", name: "posts_")]<br/>class PostController extends AbstractController<br/>{</span><span id="71e1" class="ll lm iq lg b gy mt lo l lp lq">    // constructor...</span><span id="2e4a" class="ll lm iq lg b gy mt lo l lp lq">    // #[Route(path: "", name: "all", methods: ["GET"])]<br/>    #[Get(path: "", name: "all")]<br/>    public function all(#[QueryParam] string $keyword,<br/>                        #[QueryParam] int $offset = 0,<br/>                        #[QueryParam] int $limit = 20): Response<br/>    {<br/>        //...<br/>    }</span><span id="ae25" class="ll lm iq lg b gy mt lo l lp lq">    // #[Route(path: "/{id}", name: "byId", methods: ["GET"])]<br/>    #[Get(path: "/{id}", name: "byId")]<br/>    public function getById(Uuid $id): Response<br/>    {<br/>       //...<br/>    }</span><span id="3d3f" class="ll lm iq lg b gy mt lo l lp lq">    //#[Route(path: "", name: "create", methods: ["POST"])]<br/>    #[Post(path: "", name: "create")]<br/>    public function create(#[Body] CreatePostDto $data): Response<br/>    {<br/>        //...<br/>    }</span><span id="a9e0" class="ll lm iq lg b gy mt lo l lp lq">    //#[Route(path: "/{id}", name: "update", methods: ["PUT"])]<br/>    #[Put(path: "/{id}", name: "update")]<br/>    public function update(Uuid $id, #[Body] UpdatePostDto $data): Response<br/>    {<br/>        //...<br/>    }</span><span id="be61" class="ll lm iq lg b gy mt lo l lp lq">    // #[Route(path: "/{id}/status", name: "update_status", methods: ["PUT"])]<br/>    #[Put(path: "/{id}/status", name: "update_status")]<br/>    public function updateStatus(Uuid $id, #[Body] UpdatePostStatusDto $data): Response<br/>    {<br/>       //...<br/>    }</span><span id="e9c8" class="ll lm iq lg b gy mt lo l lp lq">    //#[Route(path: "/{id}", name: "delete", methods: ["DELETE"])]<br/>    #[Delete(path: "/{id}", name: "delete")]<br/>    public function deleteById(Uuid $id): Response<br/>    {<br/>        //...<br/>    }</span><span id="7e8b" class="ll lm iq lg b gy mt lo l lp lq">    // comments sub resources.<br/>    //#[Route(path: "/{id}/comments", name: "commentByPostId", methods: ["GET"])]<br/>    #[GET(path: "/{id}/comments", name: "commentByPostId")]<br/>    public function getComments(Uuid $id): Response<br/>    {<br/>      //...<br/>    }</span><span id="ad11" class="ll lm iq lg b gy mt lo l lp lq">    //#[Route(path: "/{id}/comments", name: "addComments", methods: ["POST"])]<br/>    #[Post(path: "/{id}/comments", name: "addComments")]<br/>    public function addComment(Uuid $id, Request $request): Response<br/>    {<br/>		//...<br/>    }</span><span id="ed90" class="ll lm iq lg b gy mt lo l lp lq">}</span></pre><p id="fdf8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">再次运行该应用程序以确保其正常工作。</p><h2 id="70fc" class="ll lm iq bd ls mu mv dn lw mw mx dp ma jy my mz me kc na nb mi kg nc nd mm ne bi translated">从我的Github获取源代码。</h2><h2 id="fbe2" class="ll lm iq bd ls mu mv dn lw mw mx dp ma jy my mz me kc na nb mi kg nc nd mm ne bi translated">顺便说一句，我已经把我原来的Symfony帖子更新成了一个分步指南，在线阅读:<a class="ae km" href="https://hantsy.github.io/symfony-rest-sample/" rel="noopener ugc nofollow" target="_blank">https://hantsy.github.io/symfony-rest-sample/</a></h2></div></div>    
</body>
</html>