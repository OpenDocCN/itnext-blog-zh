<html>
<head>
<title>CKA/CKAD exam: Managing ETCD cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CKA/CKAD考试:管理ETCD集群</h1>
<blockquote>原文：<a href="https://itnext.io/cka-ckad-exam-managing-etcd-cluster-fc3feecfab5c?source=collection_archive---------4-----------------------#2020-07-07">https://itnext.io/cka-ckad-exam-managing-etcd-cluster-fc3feecfab5c?source=collection_archive---------4-----------------------#2020-07-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/19e6b75046e02242e3d2997ab1f988da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GeCrt1fmnJiRr2Bv3aV4Zg.jpeg"/></div></div></figure><h1 id="6d99" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">一点上下文。</h1><p id="fa89" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">作为准备Kubernetes认证管理员(CKA)和认证Kubernetes应用程序开发员(CKAD)考试的一部分，我必须深入管理Etcd集群例程，并完成安装、添加、删除节点、管理证书等所有手动过程。Etcd对我来说并不陌生，我以前使用过Etcd集群，并在一些项目中使用过它，但是最近还没有机会使用Etcd。换句话说，几年没碰了。令我惊讶和敬畏的是，Etcd已经发展成为一个相当先进和成熟的产品。因此，这个关于如何管理Etcd集群的小故事和我偶然发现的一些障碍，当然，都是在准备考试的背景下。</p><h1 id="a3b1" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">让我们做一些蚀刻</h1><p id="71dc" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">众所周知，Etcd是Kubernetes的一个关键组件，因为它存储了集群的整个状态:配置、规格和正在运行的工作负载的状态。你可能会认为这是对Kubernetes的回忆。这里是Etc <a class="ae lx" href="https://etcd.io/docs/v3.4.0/op-guide/" rel="noopener ugc nofollow" target="_blank">操作指南</a>的快速链接，我将在接下来的章节中大量引用。此外，链接到经典的<a class="ae lx" href="https://github.com/kelseyhightower/kubernetes-the-hard-way" rel="noopener ugc nofollow" target="_blank">kubernes The Hard Way</a>，虽然凯尔西的指南使用一些GCP CLI命令和GCP环境，我的部署在AWS环境中，所以你会看到一些差异。还有一个相关链接<a class="ae lx" href="https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/" rel="noopener ugc nofollow" target="_blank">管理kubernetes.io上的Etcd集群</a>。</p><p id="b8b8" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">我的学习集群的部署架构看起来是这样的:<strong class="lb iu"> 3个控制器/主节点、2个工作节点和1个负载平衡器节点</strong>。而且，您可能知道，我们将只需要在主/控制器节点上部署Etcd。</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi md"><img src="../Images/e7e011fe615cf28e0a4dcc3226befb75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rr_S9shdU8v-GyU6lPsaNA.png"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">主节点上的Etcd。资料来源:Kubernetes docs</figcaption></figure><p id="aca4" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">还有非常酷的在线Etcd游乐场<a class="ae lx" href="http://play.etcd.io/" rel="noopener ugc nofollow" target="_blank"> play.etcd.io </a>。</p><h1 id="76b1" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">先决条件</h1><p id="511b" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">好吧，首先..让我们为节点编写环境脚本(假设节点已启动并准备就绪)，每个节点由3个变量描述<code class="fe mm mn mo mp b">&lt;node type&gt;_HOST</code> - DNS节点名称、<code class="fe mm mn mo mp b">&lt;node type&gt;_IP</code> -节点的私有IP和<code class="fe mm mn mo mp b">&lt;node type&gt;_IP_PUB</code> -节点的公共IP，以便从您的笔记本电脑连接到它。</p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="25db" class="mu kc it mp b gy mv mw l mx my"># env.sh<br/>#!/usr/bin/env bash</span><span id="75b3" class="mu kc it mp b gy mz mw l mx my"># load balancer<br/>export LB_HOST=oleggor1c.mylabserver.com<br/>export LB_IP=172.31.43.80<br/>export LB_IP_PUB=54.245.131.142</span><span id="7279" class="mu kc it mp b gy mz mw l mx my"># master 1<br/>export CONTROLLER0_HOST=oleggor2c.mylabserver.com<br/>export CONTROLLER0_IP=172.31.34.87<br/>export CONTROLLER0_IP_PUB=54.149.219.59</span><span id="d8b8" class="mu kc it mp b gy mz mw l mx my"># master 2<br/>export CONTROLLER1_HOST=oleggor3c.mylabserver.com<br/>export CONTROLLER1_IP=172.31.46.87<br/>export CONTROLLER1_IP_PUB=52.41.230.156</span><span id="666b" class="mu kc it mp b gy mz mw l mx my"># master 3<br/>export CONTROLLER2_HOST=oleggor4c.mylabserver.com<br/>export CONTROLLER2_IP=172.31.33.127<br/>export CONTROLLER2_IP_PUB=35.163.200.225</span><span id="427c" class="mu kc it mp b gy mz mw l mx my"># worker 1<br/>export WORKER0_HOST=oleggor5c.mylabserver.com<br/>export WORKER0_IP=172.31.35.78<br/>export WORKER0_IP_PUB=52.27.6.98</span><span id="53a2" class="mu kc it mp b gy mz mw l mx my"># worker 2<br/>export WORKER1_HOST=oleggor6c.mylabserver.com<br/>export WORKER1_IP=172.31.47.59<br/>export WORKER1_IP_PUB=54.184.144.135</span></pre><p id="e788" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">确保您的工作目录中有这个<code class="fe mm mn mo mp b">env.sh</code>。这样做是为了方便和加快速度，所以每次我们销毁节点并启动新的节点时，我们只需更新<code class="fe mm mn mo mp b">env.sh</code>脚本中的IPs，然后重新运行所有其他脚本，正如您在下面几节中看到的。</p><p id="31d5" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">为了避免任何类型的复制过去错误，我将为每个控制器节点打开3个终端(或终端选项卡),并对控制器节点#0使用SSH，例如:</p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="7b1b" class="mu kc it mp b gy mv mw l mx my">source env.sh &amp;&amp; ssh cloud_user@$CONTROLLER0_IP_PUB</span></pre><p id="66b8" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">这也有助于考试，尤其是如果你使用tmux或类似的工具。</p><h1 id="3cc4" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">生成证书</h1><p id="22b0" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">对于那些经历过凯尔西的艰难历程的人来说，是时候获得证书了。我将使用下面的脚本<code class="fe mm mn mo mp b">generate-certs.sh</code>:</p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="d57d" class="mu kc it mp b gy mv mw l mx my">#!/usr/bin/env bash<br/>source ./env.sh</span><span id="66d3" class="mu kc it mp b gy mz mw l mx my">cat &gt; ca-config.json &lt;&lt; EOF<br/>{<br/>  "signing": {<br/>    "default": {<br/>      "expiry": "8760h"<br/>    },<br/>    "profiles": {<br/>      "kubernetes": {<br/>        "usages": ["signing", "key encipherment", "server auth", "client auth"],<br/>        "expiry": "8760h"<br/>      }<br/>    }<br/>  }<br/>}<br/>EOF</span><span id="6d04" class="mu kc it mp b gy mz mw l mx my">cat &gt; ca-csr.json &lt;&lt; EOF<br/>{<br/>  "CN": "Kubernetes",<br/>  "key": {<br/>    "algo": "rsa",<br/>    "size": 2048<br/>  },<br/>  "names": [<br/>    {<br/>      "C": "US",<br/>      "L": "Portland",<br/>      "O": "Kubernetes",<br/>      "OU": "CA",<br/>      "ST": "Oregon"<br/>    }<br/>  ]<br/>}<br/>EOF<br/>cfssl gencert -initca ca-csr.json | cfssljson -bare ca</span><span id="e3b7" class="mu kc it mp b gy mz mw l mx my">cat &gt; admin-csr.json &lt;&lt; EOF<br/>{<br/>  "CN": "admin",<br/>  "key": {<br/>    "algo": "rsa",<br/>    "size": 2048<br/>  },<br/>  "names": [<br/>    {<br/>      "C": "US",<br/>      "L": "Portland",<br/>      "O": "system:masters",<br/>      "OU": "Kubernetes The Hard Way",<br/>      "ST": "Oregon"<br/>    }<br/>  ]<br/>}<br/>EOF<br/>cfssl gencert \<br/>  -ca=ca.pem \<br/>  -ca-key=ca-key.pem \<br/>  -config=ca-config.json \<br/>  -profile=kubernetes \<br/>  admin-csr.json | cfssljson -bare admin</span><span id="95cc" class="mu kc it mp b gy mz mw l mx my">cat &gt; ${WORKER0_HOST}-csr.json &lt;&lt; EOF<br/>{<br/>    "CN": "system:node:${WORKER0_HOST}",<br/>    "key": {<br/>      "algo": "rsa",<br/>      "size": 2048<br/>    },<br/>    "names": [<br/>      {<br/>        "C": "US",<br/>        "L": "Portland",<br/>        "O": "system:nodes",<br/>        "OU": "Kubernetes The Hard Way",<br/>        "ST": "Oregon"<br/>      }<br/>    ]<br/>  }<br/>EOF<br/>cfssl gencert \<br/>  -ca=ca.pem \<br/>  -ca-key=ca-key.pem \<br/>  -config=ca-config.json \<br/>  -hostname=${WORKER0_IP},${WORKER0_HOST} \<br/>  -profile=kubernetes \<br/>  ${WORKER0_HOST}-csr.json | cfssljson -bare ${WORKER0_HOST}</span><span id="e7ce" class="mu kc it mp b gy mz mw l mx my">cat &gt; ${WORKER1_HOST}-csr.json &lt;&lt; EOF<br/>{<br/>    "CN": "system:node:${WORKER1_HOST}",<br/>    "key": {<br/>      "algo": "rsa",<br/>      "size": 2048<br/>    },<br/>    "names": [<br/>      {<br/>        "C": "US",<br/>        "L": "Portland",<br/>        "O": "system:nodes",<br/>        "OU": "Kubernetes The Hard Way",<br/>        "ST": "Oregon"<br/>      }<br/>    ]<br/>  }<br/>EOF<br/>cfssl gencert \<br/>    -ca=ca.pem \<br/>    -ca-key=ca-key.pem \<br/>    -config=ca-config.json \<br/>    -hostname=${WORKER1_IP},${WORKER1_HOST} \<br/>    -profile=kubernetes \<br/>    ${WORKER1_HOST}-csr.json | cfssljson -bare ${WORKER1_HOST}</span><span id="fc7a" class="mu kc it mp b gy mz mw l mx my">cat &gt; kube-controller-manager-csr.json &lt;&lt; EOF<br/>{<br/>      "CN": "system:kube-controller-manager",<br/>      "key": {<br/>        "algo": "rsa",<br/>        "size": 2048<br/>      },<br/>      "names": [<br/>        {<br/>          "C": "US",<br/>          "L": "Portland",<br/>          "O": "system:kube-controller-manager",<br/>          "OU": "Kubernetes The Hard Way",<br/>          "ST": "Oregon"<br/>        }<br/>      ]<br/>}<br/>EOF<br/>cfssl gencert \<br/>    -ca=ca.pem \<br/>    -ca-key=ca-key.pem \<br/>    -config=ca-config.json \<br/>    -profile=kubernetes \<br/>    kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager</span><span id="5230" class="mu kc it mp b gy mz mw l mx my">cat &gt; kube-proxy-csr.json &lt;&lt; EOF<br/>{<br/>  "CN": "system:kube-proxy",<br/>  "key": {<br/>    "algo": "rsa",<br/>    "size": 2048<br/>  },<br/>  "names": [<br/>    {<br/>      "C": "US",<br/>      "L": "Portland",<br/>      "O": "system:node-proxier",<br/>      "OU": "Kubernetes The Hard Way",<br/>      "ST": "Oregon"<br/>    }<br/>  ]<br/>}<br/>EOF<br/>cfssl gencert \<br/>  -ca=ca.pem \<br/>  -ca-key=ca-key.pem \<br/>  -config=ca-config.json \<br/>  -profile=kubernetes \<br/>  kube-proxy-csr.json | cfssljson -bare kube-proxy</span><span id="39cb" class="mu kc it mp b gy mz mw l mx my">cat &gt; kube-scheduler-csr.json &lt;&lt; EOF<br/>{<br/>  "CN": "system:kube-scheduler",<br/>  "key": {<br/>    "algo": "rsa",<br/>    "size": 2048<br/>  },<br/>  "names": [<br/>    {<br/>      "C": "US",<br/>      "L": "Portland",<br/>      "O": "system:kube-scheduler",<br/>      "OU": "Kubernetes The Hard Way",<br/>      "ST": "Oregon"<br/>    }<br/>  ]<br/>}<br/>EOF<br/>cfssl gencert \<br/>  -ca=ca.pem \<br/>  -ca-key=ca-key.pem \<br/>  -config=ca-config.json \<br/>  -profile=kubernetes \<br/>  kube-scheduler-csr.json | cfssljson -bare kube-scheduler</span><span id="c2f3" class="mu kc it mp b gy mz mw l mx my">CERT_HOSTNAMES=10.32.0.1,${CONTROLLER0_IP},${CONTROLLER0_HOST},${CONTROLLER1_HOST},${CONTROLLER1_IP},${CONTROLLER2_HOST},${CONTROLLER2_IP},${LB_IP},${LB_HOST},${LB_IP_PUB},127.0.0.1,localhost,kubernetes.default</span><span id="96a9" class="mu kc it mp b gy mz mw l mx my">cat &gt; kubernetes-csr.json &lt;&lt; EOF<br/>{<br/>  "CN": "kubernetes",<br/>  "key": {<br/>    "algo": "rsa",<br/>    "size": 2048<br/>  },<br/>  "names": [<br/>    {<br/>      "C": "US",<br/>      "L": "Portland",<br/>      "O": "Kubernetes",<br/>      "OU": "Kubernetes The Hard Way",<br/>      "ST": "Oregon"<br/>    }<br/>  ]<br/>}<br/>EOF<br/>cfssl gencert \<br/>  -ca=ca.pem \<br/>  -ca-key=ca-key.pem \<br/>  -config=ca-config.json \<br/>  -hostname=${CERT_HOSTNAMES} \<br/>  -profile=kubernetes \<br/>  kubernetes-csr.json | cfssljson -bare kubernetes</span><span id="cc8e" class="mu kc it mp b gy mz mw l mx my">cat &gt; service-account-csr.json &lt;&lt; EOF<br/>{<br/>  "CN": "service-accounts",<br/>  "key": {<br/>    "algo": "rsa",<br/>    "size": 2048<br/>  },<br/>  "names": [<br/>    {<br/>      "C": "US",<br/>      "L": "Portland",<br/>      "O": "Kubernetes",<br/>      "OU": "Kubernetes The Hard Way",<br/>      "ST": "Oregon"<br/>    }<br/>  ]<br/>}<br/>EOF<br/>cfssl gencert \<br/>  -ca=ca.pem \<br/>  -ca-key=ca-key.pem \<br/>  -config=ca-config.json \<br/>  -profile=kubernetes \<br/>  service-account-csr.json | cfssljson -bare service-account</span></pre><p id="d6ea" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">请注意用于生成<code class="fe mm mn mo mp b">kubernetes.pem</code>证书的变量<code class="fe mm mn mo mp b">CERT_HOSTNAMES</code>，我稍后会用到它。</p><p id="f184" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">执行该脚本后，您应该看到CA证书和8对TLS证书:</p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="daaa" class="mu kc it mp b gy mv mw l mx my">ca-config.json<br/>ca-csr.json<br/>ca.pem<br/>ca-key.pem<br/>ca.csr<br/>admin-csr.json<br/>admin.pem<br/>admin-key.pem<br/>admin.csr<br/>oleggor5c.mylabserver.com-csr.json<br/>oleggor5c.mylabserver.com.pem<br/>oleggor5c.mylabserver.com-key.pem<br/>oleggor5c.mylabserver.com.csr<br/>oleggor6c.mylabserver.com-csr.json<br/>oleggor6c.mylabserver.com.pem<br/>oleggor6c.mylabserver.com-key.pem<br/>oleggor6c.mylabserver.com.csr<br/>kube-controller-manager-csr.json<br/>kube-controller-manager.pem<br/>kube-controller-manager-key.pem<br/>kube-controller-manager.csr<br/>kube-proxy-csr.json<br/>kube-proxy.pem<br/>kube-proxy-key.pem<br/>kube-proxy.csr<br/>kube-scheduler-csr.json<br/>kube-scheduler.pem<br/>kube-scheduler-key.pem<br/>kube-scheduler.csr<br/>kubernetes-csr.json<br/>kubernetes.pem<br/>kubernetes-key.pem<br/>kubernetes.csr<br/>service-account-csr.json<br/>service-account.pem<br/>service-account-key.pem<br/>service-account.csr</span></pre><p id="e749" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">为了设置Etcd集群，我们只需要3个文件:<code class="fe mm mn mo mp b">ca.pem kubernetes-key.pem kubernetes.pem</code>。剩余的证书&amp;密钥用于多个Kubernetes服务。</p><h1 id="7574" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">分发证书</h1><p id="c5c5" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">下一步是将CA和TLS证书复制到控制器节点。为此，有一个方便的脚本<code class="fe mm mn mo mp b">distribute-certs.sh</code>:</p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="be7b" class="mu kc it mp b gy mv mw l mx my">#!/usr/bin/env bash<br/>source ./env.sh</span><span id="62d7" class="mu kc it mp b gy mz mw l mx my">scp env.sh ca.pem ca-key.pem kubernetes-key.pem kubernetes.pem \<br/>    service-account-key.pem service-account.pem \<br/>    user@${CONTROLLER0_IP_PUB}:~/<br/>scp env.sh ca.pem ca-key.pem kubernetes-key.pem kubernetes.pem \<br/>    service-account-key.pem service-account.pem \<br/>    user@${CONTROLLER1_IP_PUB}:~/<br/>scp env.sh ca.pem ca-key.pem kubernetes-key.pem kubernetes.pem \<br/>    service-account-key.pem service-account.pem \<br/>    user@${CONTROLLER2_IP_PUB}:~/</span></pre><p id="bb32" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">它使用<code class="fe mm mn mo mp b">user</code>帐户将证书上传到主目录的节点上，因此我们将不得不在以后将证书放在适当的位置。如你所见，这也上传了环境脚本(<code class="fe mm mn mo mp b">env.sh</code>)，这将帮助我们在接下来的步骤中加快速度。</p><h1 id="903a" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">在主节点上部署Etcd</h1><p id="db8d" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">下一步是将Etcd二进制文件放到每个节点上，并将证书放到正确的位置。在节点<code class="fe mm mn mo mp b">${CONTROLLER0_IP_PUB} ${CONTROLLER1_IP_PUB} ${CONTROLLER2_IP_PUB}</code>上运行以下程序:</p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="5c33" class="mu kc it mp b gy mv mw l mx my">wget -q --show-progress --https-only --timestamping \<br/>  "<a class="ae lx" href="https://github.com/coreos/etcd/releases/download/v3.3.5/etcd-v3.3.5-linux-amd64.tar.gz" rel="noopener ugc nofollow" target="_blank">https://github.com/coreos/etcd/releases/download/v3.3.5/etcd-v3.3.5-linux-amd64.tar.gz</a>"<br/>tar -xvf etcd-v3.3.5-linux-amd64.tar.gz<br/>sudo mv etcd-v3.3.5-linux-amd64/etcd* /usr/local/bin/<br/>sudo mkdir -p /etc/etcd /var/lib/etcd<br/>sudo cp ca.pem kubernetes-key.pem kubernetes.pem /etc/etcd/</span></pre><p id="0ab2" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">并且，确认所有证书都在正确的位置:</p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="87ba" class="mu kc it mp b gy mv mw l mx my">ls -ltr /etc/etcd/*</span></pre><h1 id="9be1" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">引导Etcd节点</h1><p id="20b9" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated"><strong class="lb iu">以下步骤只能在</strong> <code class="fe mm mn mo mp b"><strong class="lb iu">${CONTROLLER0_IP_PUB} ${CONTROLLER1_IP_PUB}</strong></code> <strong class="lb iu">上执行！原因是——我们将练习在Etcd集群中添加和删除节点。</strong></p><p id="0c76" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">设置一些环境变量:</p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="ff6e" class="mu kc it mp b gy mv mw l mx my">ETCD_NAME=$(hostname)<br/>INTERNAL_IP=$(curl <a class="ae lx" href="http://169.254.169.254/latest/meta-data/local-ipv4" rel="noopener ugc nofollow" target="_blank">http://169.254.169.254/latest/meta-data/local-ipv4</a>)<br/>INITIAL_CLUSTER=${CONTROLLER0_HOST}=<a class="ae lx" href="https://${CONTROLLER0_IP}:2380,${CONTROLLER1_HOST}=https://${CONTROLLER1_IP}:2380" rel="noopener ugc nofollow" target="_blank">https://${CONTROLLER0_IP}:2380,${CONTROLLER1_HOST}=https://${CONTROLLER1_IP}:2380</a></span></pre><p id="eb04" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">然后，生成Etcd服务配置文件:</p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="cd93" class="mu kc it mp b gy mv mw l mx my">cat &lt;&lt; EOF | sudo tee /etc/systemd/system/etcd.service<br/>[Unit]<br/>Description=etcd<br/>Documentation=<a class="ae lx" href="https://github.com/coreos" rel="noopener ugc nofollow" target="_blank">https://github.com/coreos</a><br/>[Service]<br/>ExecStart=/usr/local/bin/etcd \\<br/>  --name ${ETCD_NAME} \\<br/>  --cert-file=/etc/etcd/kubernetes.pem \\<br/>  --key-file=/etc/etcd/kubernetes-key.pem \\<br/>  --peer-cert-file=/etc/etcd/kubernetes.pem \\<br/>  --peer-key-file=/etc/etcd/kubernetes-key.pem \\<br/>  --trusted-ca-file=/etc/etcd/ca.pem \\<br/>  --peer-trusted-ca-file=/etc/etcd/ca.pem \\<br/>  --peer-client-cert-auth \\<br/>  --client-cert-auth \\<br/>  --initial-advertise-peer-urls <a class="ae lx" rel="noopener ugc nofollow" target="_blank" href="/${INTERNAL_IP}:2380">https://${INTERNAL_IP}:2380</a> \\<br/>  --listen-peer-urls <a class="ae lx" rel="noopener ugc nofollow" target="_blank" href="/${INTERNAL_IP}:2380">https://${INTERNAL_IP}:2380</a> \\<br/>  --listen-client-urls <a class="ae lx" href="https://${INTERNAL_IP}:2379,https://127.0.0.1:2379" rel="noopener ugc nofollow" target="_blank">https://${INTERNAL_IP}:2379,https://127.0.0.1:2379</a> \\<br/>  --advertise-client-urls <a class="ae lx" rel="noopener ugc nofollow" target="_blank" href="/${INTERNAL_IP}:2379">https://${INTERNAL_IP}:2379</a> \\<br/>  --initial-cluster-token etcd-cluster-0 \\<br/>  --initial-cluster ${INITIAL_CLUSTER} \\<br/>  --initial-cluster-state existing \\<br/>  --data-dir=/var/lib/etcd<br/>Restart=on-failure<br/>RestartSec=5<br/>[Install]<br/>WantedBy=multi-user.target<br/>EOF</span></pre><p id="27dd" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">然后，启动Etcd服务:</p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="79ae" class="mu kc it mp b gy mv mw l mx my">sudo systemctl daemon-reload &amp;&amp; sudo systemctl start etcd<br/>sudo systemctl enable etcd</span></pre><p id="9cba" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">并且，检查它的状态:</p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="8a99" class="mu kc it mp b gy mv mw l mx my">sudo systemctl status etcd</span></pre><p id="cc6f" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">如果您看到任何错误消息，您可能希望通过键入以下命令来检查日志:</p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="559d" class="mu kc it mp b gy mv mw l mx my">sudo tail -50 /var/logs/system</span></pre><p id="5273" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">如果没有错误，通过在其中一个主服务器上运行以下命令来检查Etcd集群的成员(<code class="fe mm mn mo mp b">$<strong class="lb iu">CONTROLLER0_IP_PUB</strong></code> <strong class="lb iu"> </strong>或<strong class="lb iu"> </strong> <code class="fe mm mn mo mp b"><strong class="lb iu">$CONTROLLER1_IP_PUB</strong></code>)</p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="5706" class="mu kc it mp b gy mv mw l mx my">sudo ETCDCTL_API=3 etcdctl member list \<br/>  --endpoints=<a class="ae lx" href="https://127.0.0.1:2379" rel="noopener ugc nofollow" target="_blank">https://127.0.0.1:2379</a> \<br/>  --cacert=/etc/etcd/ca.pem \<br/>  --cert=/etc/etcd/kubernetes.pem \<br/>  --key=/etc/etcd/kubernetes-key.pem</span></pre><p id="0286" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">这应该会产生类似如下的输出</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi na"><img src="../Images/43ceb63af340da1e1ea8e3e70741796e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QOtTsQcvGYoGQNfZ7kVyvQ.png"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">双节点Etcd集群</figcaption></figure><p id="0530" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">如果您遇到一些错误，请参考底部的故障排除部分，我在那里列出了可能的问题以及如何解决它们，或者看看我在最后发布的链接，它们可能会有所帮助。更多关于Etcd安全和引导的话题请点击<a class="ae lx" href="https://etcd.io/docs/v3.4.0/op-guide/security/" rel="noopener ugc nofollow" target="_blank">T21链接。</a></p><h1 id="7c19" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">将节点添加到Etcd集群</h1><p id="af17" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">SSH到一个现有的控制器节点，并确保在一个现有的etcd节点上执行<code class="fe mm mn mo mp b">member add</code>命令，比如说在<code class="fe mm mn mo mp b">$CONTROLLER0_HOST</code>上:</p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="cf23" class="mu kc it mp b gy mv mw l mx my">$ sudo ETCDCTL_API=3 etcdctl --endpoints=<a class="ae lx" href="https://127.0.0.1:2379" rel="noopener ugc nofollow" target="_blank">https://127.0.0.1:2379</a>   --cacert=/etc/etcd/ca.pem   --cert=/etc/etcd/kubernetes.pem   --key=/etc/etcd/kubernetes-key.pem  member add oleggor4c.mylabserver.com --peer-urls=<a class="ae lx" href="https://172.31.33.127:2380" rel="noopener ugc nofollow" target="_blank">https://172.31.33.127:2380</a></span></pre><p id="f313" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">这应该会给你类似于:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nb"><img src="../Images/31c3fcffc1c8e12b8352b4b34f7e9953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m6xFMASer5NVfLVvR-qGPQ.png"/></div></div></figure><p id="7091" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">并且，如果您再次运行<code class="fe mm mn mo mp b">member list</code>命令，它应该给出3个成员，其中一个(新的)处于未启动状态:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/1676a91ecb37582e2e6ad4566694286c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zheRTWHXbsIETZN1VYhAXg.png"/></div></div></figure><p id="2259" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">SSH到新节点<code class="fe mm mn mo mp b">$CONTROLLER2_IP_PUB</code> <strong class="lb iu"> </strong>，检查<code class="fe mm mn mo mp b">/etc/etcd</code>下是否有所有正确的证书。</p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="a206" class="mu kc it mp b gy mv mw l mx my">ca.pem<br/>kubernetes.pem<br/>kubernetes-key.pem</span></pre><p id="467f" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">在继续下一步之前，还要运行一次检查。如果我能早点想到这一点，我就可以节省几个小时的故障排除时间..</p><p id="2763" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">当SSH连接到新节点(<code class="fe mm mn mo mp b">172.31.33.127</code>)时，运行<code class="fe mm mn mo mp b">member list </code>命令并使用<em class="nd">控制器节点#0的私有IP</em>(<code class="fe mm mn mo mp b">$CONTROLLER0_HOST</code>)，在本例中为<code class="fe mm mn mo mp b">172.31.34.87</code>。</p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="2809" class="mu kc it mp b gy mv mw l mx my">sudo ETCDCTL_API=3 etcdctl member list \<br/>  --endpoints=https://172.31.34.87:2379 \<br/>  --cacert=/etc/etcd/ca.pem \<br/>  --cert=/etc/etcd/kubernetes.pem \<br/>  --key=/etc/etcd/kubernetes-key.pem</span></pre><p id="d3c3" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">这将确保:1)节点上的证书是正确的，2)新节点的名称和IP包含在<code class="fe mm mn mo mp b">kubernetes.pem</code>证书中。</p><p id="f78c" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">让我们继续新节点的其余设置。设置环境变量并记下<code class="fe mm mn mo mp b">INITIAL_CLUSTER</code>，因为它包括<code class="fe mm mn mo mp b">$CONTROLLER2_HOST</code></p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="8977" class="mu kc it mp b gy mv mw l mx my">ETCD_NAME=$(hostname)<br/>INTERNAL_IP=$(curl <a class="ae lx" href="http://169.254.169.254/latest/meta-data/local-ipv4" rel="noopener ugc nofollow" target="_blank">http://169.254.169.254/latest/meta-data/local-ipv4</a>)<br/>INITIAL_CLUSTER=${CONTROLLER0_HOST}=https://${CONTROLLER0_IP}:2380,${CONTROLLER1_HOST}=https://${CONTROLLER1_IP}:2380,${CONTROLLER2_HOST}=https://${CONTROLLER2_IP}:2380</span></pre><p id="d5de" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">在本例中，<code class="fe mm mn mo mp b">INTERNAL_IP</code>被设置为新节点的私有IP 172 . 31 . 33 . 127。</p><p id="78a2" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">生成etcd系统配置文件<code class="fe mm mn mo mp b"> /etc/systemd/system/etcd.service</code>。注:参数<code class="fe mm mn mo mp b">—-initial-cluster-state </code>变更为<code class="fe mm mn mo mp b">existing</code>。</p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="e2ef" class="mu kc it mp b gy mv mw l mx my">cat &lt;&lt; EOF | sudo tee /etc/systemd/system/etcd.service<br/>[Unit]<br/>Description=etcd<br/>Documentation=<a class="ae lx" href="https://github.com/coreos" rel="noopener ugc nofollow" target="_blank">https://github.com/coreos</a><br/>[Service]<br/>ExecStart=/usr/local/bin/etcd \\<br/>  --name ${ETCD_NAME} \\<br/>  --cert-file=/etc/etcd/kubernetes.pem \\<br/>  --key-file=/etc/etcd/kubernetes-key.pem \\<br/>  --peer-cert-file=/etc/etcd/kubernetes.pem \\<br/>  --peer-key-file=/etc/etcd/kubernetes-key.pem \\<br/>  --trusted-ca-file=/etc/etcd/ca.pem \\<br/>  --peer-trusted-ca-file=/etc/etcd/ca.pem \\<br/>  --peer-client-cert-auth \\<br/>  --client-cert-auth \\<br/>  --initial-advertise-peer-urls <a class="ae lx" rel="noopener ugc nofollow" target="_blank" href="/${INTERNAL_IP}:2380">https://${INTERNAL_IP}:2380</a> \\<br/>  --listen-peer-urls <a class="ae lx" rel="noopener ugc nofollow" target="_blank" href="/${INTERNAL_IP}:2380">https://${INTERNAL_IP}:2380</a> \\<br/>  --listen-client-urls <a class="ae lx" href="https://${INTERNAL_IP}:2379,https://127.0.0.1:2379" rel="noopener ugc nofollow" target="_blank">https://${INTERNAL_IP}:2379,https://127.0.0.1:2379</a> \\<br/>  --advertise-client-urls <a class="ae lx" rel="noopener ugc nofollow" target="_blank" href="/${INTERNAL_IP}:2379">https://${INTERNAL_IP}:2379</a> \\<br/>  --initial-cluster-token etcd-cluster-0 \\<br/>  --initial-cluster ${INITIAL_CLUSTER} \\<br/>  --initial-cluster-state existing \\<br/>  --data-dir=/var/lib/etcd<br/>Restart=on-failure<br/>RestartSec=5<br/>[Install]<br/>WantedBy=multi-user.target<br/>EOF</span></pre><p id="8891" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">然后，运行systemctl命令:</p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="b9ba" class="mu kc it mp b gy mv mw l mx my">sudo systemctl daemon-reload &amp;&amp; sudo systemctl start etcd<br/>sudo systemctl enable etcd<br/>sudo systemctl status etcd</span></pre><p id="5258" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">如果状态显示错误或服务停止，检查<code class="fe mm mn mo mp b">/var/log/system</code>日志文件，因为它包含更多故障排除信息。</p><p id="cffe" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">如果一切顺利，并且您看到类似这样的东西，那么您就可以开始了。</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/4f99b811917821b52f8cdf871c97958b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BwyAg71TSeO060p5-i703w.png"/></div></div></figure><p id="be8a" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">再次运行etcd <code class="fe mm mn mo mp b">member list </code>命令，确认所有集群成员。</p><h1 id="af70" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">从Etcd集群中删除节点</h1><p id="2354" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">运行<code class="fe mm mn mo mp b">member list</code>命令获取成员ID，这是第一列。然后运行<code class="fe mm mn mo mp b">member remove</code>命令并传递ID给它:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nb"><img src="../Images/71de4fa27000dd4a9caad9f1c953ff28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zCqL2NBYCgdmGlzBs34_lA.png"/></div></div></figure><h1 id="2999" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">解决纷争</h1><h2 id="451b" class="mu kc it bd kd nf ng dn kh nh ni dp kl lk nj nk kp lo nl nm kt ls nn no kx np bi translated">用例1</h2><p id="103a" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">Etcd服务正在运行，但出现错误<code class="fe mm mn mo mp b">request cluster ID mismatch</code></p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nq"><img src="../Images/17a249ae19796c493a6f0c5e2267ba9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gxp0qovecv0r8cTvI1BZKw.png"/></div></div></figure><p id="87fe" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">这意味着节点上的etcd服务创建了自己的本地集群，并将配置存储在本地磁盘上。您需要移除本地配置/目录，确保在服务配置<code class="fe mm mn mo mp b">—-initial-cluster-state</code>中设置为<code class="fe mm mn mo mp b">existing</code>并重启服务:</p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="88e9" class="mu kc it mp b gy mv mw l mx my">$ sudo rm -rf /var/lib/etcd  &amp;&amp; sudo systemctl daemon-reload &amp;&amp; sudo systemctl restart etcd</span></pre><h2 id="c846" class="mu kc it bd kd nf ng dn kh nh ni dp kl lk nj nk kp lo nl nm kt ls nn no kx np bi translated">用例2</h2><p id="91a0" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">Etcd服务正在运行(或崩溃)并抛出错误<code class="fe mm mn mo mp b">rejected connection from “172.31.46.87:55186” (error “remote error: tls: bad certificate”, ServerName “”)</code></p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nr"><img src="../Images/1495c7ef5bf00c1e65d7f3268362efc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FeJRTuYd-VytExrIsub3iQ.png"/></div></div></figure><p id="429c" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">这意味着，最有可能的问题是证书。在我的例子中，这是在<code class="fe mm mn mo mp b">CERT_HOSTNAMES</code>变量中的打字错误(参见第一步:生成证书)，它丢失了新节点的私有IP地址。确认<code class="fe mm mn mo mp b">CERT_HOSTNAMES</code>包含新节点的私有IP和DNS名称，重新生成证书(参见第一步)，将它们分发给节点，并确保它们最终到达每个节点上的<code class="fe mm mn mo mp b">/etc/etcd</code>目录。然后，要获取新证书，请在每个节点上运行以下命令来重新启动etcd服务:</p><pre class="me mf mg mh gt mq mp mr ms aw mt bi"><span id="03cc" class="mu kc it mp b gy mv mw l mx my">sudo systemctl daemon-reload &amp;&amp; sudo systemctl restart etcd</span></pre><p id="8a2e" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">“向Etcd集群添加节点”一节中提到的快速检查点有助于消除任何与证书相关的问题。</p><h1 id="1a48" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">有用的链接</h1><p id="8a69" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">一些链接极大地帮助了我调查这些问题..</p><div class="ns nt gp gr nu nv"><a href="https://github.com/etcd-io/etcd/issues/8298" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd iu gy z fp oa fr fs ob fu fw is bi translated">向现有etcd添加成员(检查对等时不匹配的成员)问题#8298 …</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">解散GitHub是超过5000万开发者的家园，他们一起工作来托管和审查代码，管理项目，以及…</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">github.com</p></div></div><div class="oe l"><div class="of l og oh oi oe oj jz nv"/></div></div></a></div><div class="ns nt gp gr nu nv"><a href="https://stackoverflow.com/questions/56515078/adding-removed-etcd-member-in-kubernetes-master" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd iu gy z fp oa fr fs ob fu fw is bi translated">在Kubernetes master中添加删除的etcd成员</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">我遵循Kelsey Hightower的kubernetes-the-hard-way repo，成功创建了一个包含3个主节点的集群…</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">stackoverflow.com</p></div></div><div class="oe l"><div class="ok l og oh oi oe oj jz nv"/></div></div></a></div><div class="ns nt gp gr nu nv"><a href="https://github.com/etcd-io/etcd/issues/8603" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd iu gy z fp oa fr fs ob fu fw is bi translated">tls显示错误“传输:远程错误:TLS:错误证书”的ETCD证书…</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">解散GitHub是超过5000万开发者的家园，他们一起工作来托管和审查代码，管理项目，以及…</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">github.com</p></div></div><div class="oe l"><div class="ol l og oh oi oe oj jz nv"/></div></div></a></div><div class="ns nt gp gr nu nv"><a href="https://github.com/etcd-io/etcd/issues/9398" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd iu gy z fp oa fr fs ob fu fw is bi translated">3.2/3.3带有tls的etcd服务器会以错误“TLS:错误证书”问题#9398启动…</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">解散GitHub是超过5000万开发者的家园，他们一起工作来托管和审查代码，管理项目，以及…</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">github.com</p></div></div><div class="oe l"><div class="om l og oh oi oe oj jz nv"/></div></div></a></div><h1 id="6b14" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">摘要</h1><p id="1393" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">本文的目的不是深入研究etcd和操作的各个方面，而是稍微解释一下如何为CKA考试设置它，并提供一些故障排除的指导。</p><p id="6ba5" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">一如既往，感谢您阅读本文，希望您能发现这有所帮助！请随意鼓掌并关注我以获取更多的文章和阅读！干杯！</p></div></div>    
</body>
</html>