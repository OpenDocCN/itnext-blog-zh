<html>
<head>
<title>PWA with Next.js (create-next-app) in 2020 ⚡️</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">2020年⚡️的PWA与Next.js (create-next-app)</h1>
<blockquote>原文：<a href="https://itnext.io/pwa-with-next-js-create-next-app-in-2020-%EF%B8%8F-9ee0e1a6313d?source=collection_archive---------0-----------------------#2020-02-15">https://itnext.io/pwa-with-next-js-create-next-app-in-2020-%EF%B8%8F-9ee0e1a6313d?source=collection_archive---------0-----------------------#2020-02-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="a8ad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Next.js + PWA = ⚡️📱</p><p id="b01e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们将一个<code class="fe ko kp kq kr b">create-next-app</code>项目转换成一个渐进式Web应用程序(PWA)</p><h1 id="b2b7" class="ks kt it bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">1.设置</h1><p id="8188" class="pw-post-body-paragraph jq jr it js b jt lq jv jw jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn im bi translated">让我们通过运行以下命令，使用<code class="fe ko kp kq kr b">create-next-app</code> (CNA)创建一个样板Next.js项目:</p><pre class="lv lw lx ly gt lz kr ma mb aw mc bi"><span id="f262" class="md kt it kr b gy me mf l mg mh">npx create-next-app</span></pre><p id="ea33" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以在文本编辑器中打开项目文件夹。该步骤之后的所有终端命令都假定在项目目录中<strong class="js iu">执行。</strong></p><h1 id="b178" class="ks kt it bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">2.安装下一个-pwa</h1><p id="5d96" class="pw-post-body-paragraph jq jr it js b jt lq jv jw jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn im bi translated">让我们将<code class="fe ko kp kq kr b">next-pwa</code>包添加到我们的项目中。运行:</p><pre class="lv lw lx ly gt lz kr ma mb aw mc bi"><span id="8e3d" class="md kt it kr b gy me mf l mg mh">npm install next-pwa</span></pre><p id="06d1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">或者:</p><pre class="lv lw lx ly gt lz kr ma mb aw mc bi"><span id="2c9b" class="md kt it kr b gy me mf l mg mh">yarn add next-pwa</span></pre><h1 id="6b8e" class="ks kt it bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">3.创建<code class="fe ko kp kq kr b">next.config.js</code>文件</h1><p id="aa3d" class="pw-post-body-paragraph jq jr it js b jt lq jv jw jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn im bi translated">你可以使用这个命令创建一个<code class="fe ko kp kq kr b">next.config.js</code>文件。</p><pre class="lv lw lx ly gt lz kr ma mb aw mc bi"><span id="faee" class="md kt it kr b gy me mf l mg mh">touch next.config.js</span></pre><p id="8ade" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们需要编辑这个文件并包含我们所有的<code class="fe ko kp kq kr b">next-pwa</code>配置。这里有一个例子<code class="fe ko kp kq kr b">next.config.js</code>可以帮助你开始:</p><figure class="lv lw lx ly gt mi"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="13ff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意，我们已经在<code class="fe ko kp kq kr b">withPwa</code>中添加了<code class="fe ko kp kq kr b">pwa</code>配置。在以前版本的Next中，为服务人员提供服务需要一个自定义服务器。但是从下一个9+开始，这不是必需的。现在轻松多了！<code class="fe ko kp kq kr b">next-pwa</code>将创建<code class="fe ko kp kq kr b">sw.js</code>文件，该文件将从生产版本的<code class="fe ko kp kq kr b">public</code>文件夹中提供。</p><h1 id="3cc8" class="ks kt it bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">4.创建manifest.json文件</h1><p id="9f52" class="pw-post-body-paragraph jq jr it js b jt lq jv jw jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn im bi translated">您可以从这个在线工具创建一个manifest.json文件。确保你也从这个工具中生成图标。我们需要他们。</p><div class="ml mm gp gr mn mo"><a href="https://app-manifest.firebaseapp.com/" rel="noopener  ugc nofollow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd iu gy z fp mt fr fs mu fu fw is bi translated">应用清单生成器</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">Web应用程序清单允许指定不同大小的图标。上传图标的512x512图像，我们将…</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">app-manifest.firebaseapp.com</p></div></div></div></a></div><p id="ff65" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您将获得一个<code class="fe ko kp kq kr b">.zip</code>下载。拉开拉链。<strong class="js iu">将下载文件夹中的</strong> <code class="fe ko kp kq kr b"><strong class="js iu">manifest.json</strong></code> <strong class="js iu">复制到</strong> <code class="fe ko kp kq kr b"><strong class="js iu">/public</strong></code> <strong class="js iu">文件夹中。</strong></p><p id="2cfe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">并将下载文件夹中<code class="fe ko kp kq kr b">/images</code>的内容复制到项目的<code class="fe ko kp kq kr b">/public</code>文件夹中。您将看到一个<code class="fe ko kp kq kr b">icons</code>文件夹:</p><figure class="lv lw lx ly gt mi gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/13c0e2ad66396e4f6beca2d0608d8ab9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*s0uz8ywDRet6R2chF4vezg.png"/></div></figure><h1 id="abf4" class="ks kt it bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">5.创建元标签</h1><p id="6384" class="pw-post-body-paragraph jq jr it js b jt lq jv jw jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn im bi translated">我们需要创建一组meta标签，并使用从<code class="fe ko kp kq kr b">next/head</code>导入的<code class="fe ko kp kq kr b">&lt;Head&gt;</code>组件将其添加到我们的页面中。我已经参考了这个<a class="ae na" href="https://github.com/gokulkrishh/awesome-meta-and-manifest" rel="noopener ugc nofollow" target="_blank"> repo </a>来获取所需的元标签:</p><div class="ml mm gp gr mn mo"><a href="https://github.com/gokulkrishh/awesome-meta-and-manifest" rel="noopener  ugc nofollow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd iu gy z fp mt fr fs mu fu fw is bi translated">gokulkrishh/awesome-meta-and-manifest</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">⚡真棒集合元标签和清单属性。-gokulkrishh/awesome-meta-and-manifest</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">github.com</p></div></div></div></a></div><p id="c8f0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以下是所需元标记的示例:</p><figure class="lv lw lx ly gt mi"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="2349" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我已经编辑了<code class="fe ko kp kq kr b">components/nav.js</code>来包含这个元标签。现在，我的<code class="fe ko kp kq kr b">nav.js</code>长这样。为了避免混淆，我没有删除任何样板代码。</p><figure class="lv lw lx ly gt mi"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="7c75" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以使用这个<a class="ae na" href="https://www.favicon-generator.org/" rel="noopener ugc nofollow" target="_blank">在线工具</a>生成<strong class="js iu">收藏夹图标</strong>并将它们放在您的<code class="fe ko kp kq kr b">/public</code>文件夹中:</p><div class="ml mm gp gr mn mo"><a href="https://www.favicon-generator.org/" rel="noopener  ugc nofollow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd iu gy z fp mt fr fs mu fu fw is bi translated">图标和应用程序图标生成器</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">转换PNG到ICO，JPG到ICO，GIF到ICO。创建favicon.ico和iOS / Android应用程序图标。编辑一个favicon以适合您的…</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">www.favicon-generator.org</p></div></div></div></a></div><h1 id="070d" class="ks kt it bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">6.考考你的PWA！</h1><p id="c5f8" class="pw-post-body-paragraph jq jr it js b jt lq jv jw jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn im bi translated">现在，你的应用程序已经准备好了。我们只需要测试一下。当我们使用<code class="fe ko kp kq kr b">next-pwa</code>时，服务人员仅在生产时启用。所以，我们应该用<code class="fe ko kp kq kr b">npm run build</code>或者<code class="fe ko kp kq kr b">yarn build</code>来构建我们的应用。你会看到这样的东西。</p><figure class="lv lw lx ly gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nb"><img src="../Images/acc77efccf80a5614adb498833c41055.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HYHAk1JDVyVyeqRPZvaBlw.png"/></div></div></figure><p id="aacc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后用<code class="fe ko kp kq kr b">npm run start</code>或<code class="fe ko kp kq kr b">yarn start</code>启动生产本地服务器。</p><p id="6115" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">转到<code class="fe ko kp kq kr b"><a class="ae na" href="http://localhost:" rel="noopener ugc nofollow" target="_blank">http://localhost</a>:3000</code>。如果你在谷歌浏览器上，运行灯塔审计。您应该会看到类似这样的内容:</p><figure class="lv lw lx ly gt mi gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/e55a8cbbd78352ed7e4aa01b5ffe4116.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*1UiS8EgEnDAQL-ew_0eKOQ.png"/></div></figure><p id="305e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面报告中标记为红色的一项是:</p><figure class="lv lw lx ly gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nh"><img src="../Images/567a832a03b049a9281e4e296dddfd45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7W_2n8JitPKch9v_H9tKIw.png"/></div></div></figure><p id="b07f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是因为，PWAs需要在HTTPS上运行。Localhost是个例外。<strong class="js iu">将它部署到一个服务器，并通过HTTPS </strong>提供服务，您将得到一个类似如下的审计:</p><figure class="lv lw lx ly gt mi gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/d0ae621dbca4a30efef929ac82a174f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*a2ek2imX5XZb-NLoxc1dLQ.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">成功！</figcaption></figure><p id="2f21" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">开箱即用，你得到缓存，离线支持和“添加到主屏幕”的提示将出现在Chrome(移动)。这使得用户可以像使用本地应用程序一样使用您的PWA。享受你的进步网络应用！</p><p id="080b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本教程Github Repo:</p><div class="ml mm gp gr mn mo"><a href="https://github.com/skolhustick/next-js-pwa-create-next-app/tree/master" rel="noopener  ugc nofollow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd iu gy z fp mt fr fs mu fu fw is bi translated">skolhustick/next-js-pwa-create-next-app</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">带有create-next-app的NextJS + PWA。为skolhustick/next-js-pwa-create-next-app开发做出贡献，创建一个…</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">github.com</p></div></div><div class="nn l"><div class="no l np nq nr nn ns my mo"/></div></div></a></div></div></div>    
</body>
</html>