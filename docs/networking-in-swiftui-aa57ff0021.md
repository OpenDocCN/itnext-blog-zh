# SwiftUI 网络

> 原文：<https://itnext.io/networking-in-swiftui-aa57ff0021?source=collection_archive---------3----------------------->

![](img/2fe159a76d7cd8eac7a96d5897dab514.png)

优素福·萨尔汗在 [Unsplash](https://unsplash.com/s/photos/iphone?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上的照片

过去几年我一直在写 Swift。最近我开始了我的 SwiftUI 之旅。我的第一个问题是如何在 SwiftUI 中使用 Combine 进行联网。在尝试了不同的解决方案后，我想出了一个符合我需求的可接受的版本。因为这可以让新用户受益，我想我会写一篇关于这个主题的文章。

首先，我们创建一个可以容纳不同端点的**网络环境**枚举。对于这个例子，我们将使用开放天气 API。

为了保持类型安全，我们还引入了一个描述我们需要的不同路由和参数的 **NetworkRoute** 协议，以及一个不言自明的 **NetworkMethod** enum。

类型安全万岁

将报头默认为 nil，这样我们就不必在所有路由中重新实现它

我们使用一个方法来扩展该协议，该方法将基于配置的属性创建一个 **URLRequest** 。我知道强制解包，我希望它在无效时崩溃，因为这将表明开发人员的错误。

因为我们想在发生事情时向用户显示一个状态，所以我们引入了一个可以保存三个基本状态的**资源**枚举。

*   装货
*   成功
*   错误

当我们的网络请求运行到上述三种状态中的任何一种时，我们可以更新我们的视图。

现在是时候介绍 **Combine** 了，我们差不多有了所有的拼图，可以开始提出请求了。让我们通过创建我们的**网络**协议来完成它。

我们可以获取任何符合可解码的

我们还扩展了这个协议，并添加了一个方法，该方法将从给定的**网络路由**中获取任何**可解码的**。我们将整个封装在一个**资源**中，并将其发布到我们的流中。

最后，是时候实现我们的 OpenWeather API 了。让我们首先定义我们的 **OpenWeatherNetwork** 结构，并在 **OpenWeatherRoute** 中实现我们想要支持的路由。

定制解码器以满足您的需求

不要忘记填写城市和正确的 appId

为了开始发出网络请求，我们将创建一个可以从 SwiftUI 中观察到的视图模型。我们将介绍一个**网络视图模型**协议。

现在我们有一个基础来创建我们实际的**天气视图模型**。

我们注入网络，设置网络资源别名并指定路由

然后，我们创建并传递我们的**视图模型**作为**环境对象**，并在我们的 SwiftUI 视图中实现它。

就这样结束了！我将把符合**可解码**的**模型**的创建和**视图模型**的初始化留给读者作为练习。

*在这里的*[*Pinch*](https://pinch.nl)*，我们继续试验 SwiftUI，让我们的应用变得更好。你有任何问题或评论吗？请在评论中告诉我们。*