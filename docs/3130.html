<html>
<head>
<title>My take on Environment Variables in Android project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我对Android项目中环境变量的看法</h1>
<blockquote>原文：<a href="https://itnext.io/my-take-on-environment-variables-in-android-project-d77e0e466f43?source=collection_archive---------2-----------------------#2019-10-09">https://itnext.io/my-take-on-environment-variables-in-android-project-d77e0e466f43?source=collection_archive---------2-----------------------#2019-10-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/688479f2cc9fba21a95bce225d256141.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*__vpd9s4Fs2std30dJWsYg.png"/></div></div></figure><p id="1132" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">今天我想告诉你一个管理env变量的有趣方法(那些你通常放在<code class="fe kw kx ky kz b">build.gradle</code>中的东西)。</p><blockquote class="la lb lc"><p id="ae04" class="jy jz ld ka b kb kc kd ke kf kg kh ki le kk kl km lf ko kp kq lg ks kt ku kv ij bi translated"><em class="iq">免责声明:</em>我并不是在假装这是最正确的做法(甚至根本就是正确的)，但它解决了我在项目中面临的问题。</p></blockquote><h1 id="93e4" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">环境和变量</h1><p id="de59" class="pw-post-body-paragraph jy jz iq ka b kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv ij bi translated">首先我们来定义一个<strong class="ka ir">环境变量</strong>在Android app中是什么意思<strong class="ka ir"> </strong>。通常它是一个<code class="fe kw kx ky kz b">String</code>或<code class="fe kw kx ky kz b">boolean</code>标志，根据你运行应用的环境而变化。假设您的API有两个不同的服务器:</p><ul class=""><li id="cca3" class="mk ml iq ka b kb kc kf kg kj mm kn mn kr mo kv mp mq mr ms bi translated"><em class="ld">开发服务器，</em>主要开发和测试发生的地方</li><li id="0798" class="mk ml iq ka b kb mt kf mu kj mv kn mw kr mx kv mp mq mr ms bi translated"><em class="ld">生产服务器，</em>您的应用上线的地方</li></ul><p id="9567" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Android中那些服务器的URL常用的放置方式是什么？对，是<code class="fe kw kx ky kz b">BuildConfig</code></p><figure class="my mz na nb gt jr"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="1601" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">像这样设置好你的<code class="fe kw kx ky kz b">build.gradle</code>并同步项目后，你可以用<code class="fe kw kx ky kz b">BuildConfig.BASE_URL</code>在你的代码中访问它。这里是你的环境变量。根据你使用的建筑类型，它会有所不同。</p><h1 id="83fe" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">构建脚本与代码</h1><p id="f40c" class="pw-post-body-paragraph jy jz iq ka b kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv ij bi translated">这是一个非常好的方法，适用于大多数项目。但是不久前，我的领导给了我一个有趣的任务:“我们应该能够通过点击一个按钮从开发切换到生产，然后再切换回来”。<br/>事实证明，我无法用<code class="fe kw kx ky kz b">BuildConfig</code>方法轻松地做到这一点:<code class="fe kw kx ky kz b">BuildConfig</code>类是在编译时生成的，所有变量的设置取决于所选的构建类型，并且不能更改。</p><p id="40a4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">也就是说，我决定将所有的环境变量从<code class="fe kw kx ky kz b">build.gradle</code>转移到实际代码中。首先，让我们描述一下我们的环境变量(在本文中尽量简短):</p><figure class="my mz na nb gt jr"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="683a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，我们需要为我们的应用程序定义所有的环境</p><figure class="my mz na nb gt jr"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="b86c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">作为最后一步，我们将编写一个<code class="fe kw kx ky kz b">EnvironmentManager</code>类，它将允许我们获取任何env变量，也可以轻松地切换环境。<br/> <em class="ld">(注意下面代码片段中的注释，它们解释了所发生的事情👍)</em></p><figure class="my mz na nb gt jr"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="2bb3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要做的最后一件事是将我们的<code class="fe kw kx ky kz b">buildTypes</code>连接到代码中描述的环境，以便在代码中没有选择任何内容的情况下，为每个构建类型使用正确的变量。为此，我们定义了一个buildConfig属性:<code class="fe kw kx ky kz b">DEFAULT_ENV</code> <br/>，因此，对于全新安装，您的应用程序将使用在<code class="fe kw kx ky kz b">DEFAULT_ENV</code>中设置的环境</p><p id="971b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">仅此而已！现在你可以像这样使用<code class="fe kw kx ky kz b">EnvironmentManager</code>:</p><figure class="my mz na nb gt jr"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="c684" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你喜欢这个帖子，请给一些掌声👏<br/>在twitter上关注我</p><p id="7689" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae ne" href="https://twitter.com/timofeipl" rel="noopener ugc nofollow" target="_blank">https://twitter.com/timofeipl</a></p></div></div>    
</body>
</html>