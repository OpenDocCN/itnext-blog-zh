<html>
<head>
<title>How I built my first Progressive Web App (PWA)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何构建我的第一个渐进式网络应用程序(PWA)</h1>
<blockquote>原文：<a href="https://itnext.io/how-i-built-my-first-progressive-web-app-pwa-6fd3f5a164c0?source=collection_archive---------0-----------------------#2019-11-20">https://itnext.io/how-i-built-my-first-progressive-web-app-pwa-6fd3f5a164c0?source=collection_archive---------0-----------------------#2019-11-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="2743" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">渐进式网络应用</h2><div class=""/><div class=""><h2 id="0665" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">得到完美的灯塔分数</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/95f262dbd16d04bc4268754da11d58b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xz2OcptBSxv6XkY5Cnw-WA.jpeg"/></div></div></figure><p id="c473" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">从今天起，我的网站可以作为一个进步的网络应用程序。耶！💯</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lw"><img src="../Images/1a7e88def5e9c1cbef772ae4ca45db73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6iFn36MIl6YAAU7V.gif"/></div></div></figure><p id="98ab" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在这篇文章中，你将会了解到更多关于我如何以及为什么在我的网站上添加这个令人兴奋的特性。</p><h1 id="aa9a" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">我为什么要这么做？</h1><p id="ad1c" class="pw-post-body-paragraph la lb iq lc b ld mp ka lf lg mq kd li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">我喜欢认为自己是一个非常迂腐的人，我从第一天开始就试图让我的网站变得更好。当我建立我的网站时，我并不了解所有来自网页性能工具的指标，如PageSpeed Insights或WebPageTest。但是，当我试图让我的网站更好的时候，我在学习新的技术，我的网站变得越来越好。</p><p id="dd65" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">现在我的网站得分最高，但有一件事困扰了我一段时间。这是渐进式网络应用评分。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lw"><img src="../Images/c09f20968d295d837e5746f32df537cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sZC4Fl9tRM82p-a-.png"/></div></div></figure><p id="0903" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">通过查看PWA报告，我意识到我的网站已经为PWA做好了准备。只有几个问题需要解决。我不理解这些问题，但这从未阻止过我。</p><h1 id="fdda" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">我是如何做到的</h1><p id="1ddb" class="pw-post-body-paragraph la lb iq lc b ld mp ka lf lg mq kd li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">作为我的起点，我决定遵循<a class="ae mu" href="https://codelabs.developers.google.com/codelabs/your-first-pwapp/#4" rel="noopener ugc nofollow" target="_blank">“你的第一个渐进式Web应用”教程</a>。第一步是更新我的<code class="fe mv mw mx my b">webmanifest.json</code>文件。我添加了<code class="fe mv mw mx my b">start_url</code>和<code class="fe mv mw mx my b">display</code>选项以及一些必需的meta标签，比如<code class="fe mv mw mx my b">&lt;meta name="apple-mobile-web-app-capable" content="yes"&gt;</code>。</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="c29c" class="nd ly iq my b gy ne nf l ng nh">{<br/>  "name": "SB site - Silvestar Bistrović website",<br/>  "short_name": "SB site - Silvestar Bistrović website",<br/>  "icons": [<br/>    …<br/>  ],<br/>  "theme_color": "#12e09f",<br/>  "background_color": "#fff",<br/>  "start_url": "/offline.html",<br/>  "display": "standalone"<br/>}</span></pre><p id="f74d" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">接下来，我为服务人员创建了<code class="fe mv mw mx my b">sw.js</code>文件。要注册服务人员，需要将一小段代码添加到您的索引页面中:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="e010" class="nd ly iq my b gy ne nf l ng nh">// CODELAB: Register service worker.<br/>if ('serviceWorker' in navigator) {<br/>  window.addEventListener('load', () =&gt; {<br/>    navigator.serviceWorker.register('/service-worker.js')<br/>      .then((reg) =&gt; {<br/>        console.log('Service worker registered.', reg);<br/>      });<br/>  });<br/>}</span></pre><p id="d9de" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">服务工作者文件的内容可能会有所不同，这取决于您希望在您的站点上实现什么。由于我的网站非常简单，我决定只使用基本的离线体验。这意味着我需要一个<code class="fe mv mw mx my b">offline.html</code>文件用于离线体验。这将是我主页的精简版。所以我移除了外部图像，并用CSS创建了一个占位符。我移除了外部CSS文件并将其内联到<code class="fe mv mw mx my b">head</code>部分。剩下唯一要做的就是添加favicon文件。我还不确定这是否需要，但我决定把它放在那里，以防万一。反正那些文件也不大。</p><p id="20be" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><code class="fe mv mw mx my b">sw.js</code>文件可以分成四个部分:</p><ul class=""><li id="e6a3" class="ni nj iq lc b ld le lg lh lj nk ln nl lr nm lv nn no np nq bi translated">定义常数，</li><li id="525e" class="ni nj iq lc b ld nr lg ns lj nt ln nu lr nv lv nn no np nq bi translated">安装，</li><li id="7ba0" class="ni nj iq lc b ld nr lg ns lj nt ln nu lr nv lv nn no np nq bi translated">激活，以及</li><li id="21d0" class="ni nj iq lc b ld nr lg ns lj nt ln nu lr nv lv nn no np nq bi translated">引人入胜。</li></ul><p id="67ed" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">首先，我定义了缓存名称和要缓存的文件。</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="7058" class="nd ly iq my b gy ne nf l ng nh">// constants<br/>const CACHE_NAME = 'sb-cache-v1.3'<br/>const FILES_TO_CACHE = [<br/>  '/offline.html',<br/>  '/favicon/apple-touch-icon.png',<br/>  '/favicon/favicon-32x32.png',<br/>  '/favicon/favicon-16x16.png',<br/>  '/favicon/site.webmanifest',<br/>  '/favicon/safari-pinned-tab.svg',<br/>  '/favicon/favicon.ico',<br/>  '/favicon/mstile-144x144.png',<br/>  '/favicon/browserconfig.xml'<br/>]</span></pre><p id="f923" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">接下来，我创建了<code class="fe mv mw mx my b">install</code>事件，它使用给定的缓存名称打开缓存并缓存文件。</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="1ad5" class="nd ly iq my b gy ne nf l ng nh">self.addEventListener('install', (event) =&gt; {<br/>  // CODELAB: Precache static resources here.<br/>  event.waitUntil(<br/>    caches.open(CACHE_NAME).then((cache) =&gt; {<br/>      console.log('[ServiceWorker] Pre-caching offline page')<br/>      return cache.addAll(FILES_TO_CACHE)<br/>    })<br/>  )<br/>})</span></pre><p id="4324" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">之后，我创建了<code class="fe mv mw mx my b">activate</code>事件，它从磁盘中清除缓存的文件。</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="8d9e" class="nd ly iq my b gy ne nf l ng nh">self.addEventListener('activate', (event) =&gt; {<br/>  // CODELAB: Remove previous cached data from disk.<br/>  event.waitUntil(<br/>    caches.keys().then(keyList =&gt; Promise.all(keyList.map((key) =&gt; {<br/>      if (key !== CACHE_NAME) {<br/>        console.log('[ServiceWorker] Removing old cache', key)<br/>        return caches.delete(key)<br/>      }<br/>    })))<br/>  )<br/>})</span></pre><p id="60d9" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">最后，我创建了<code class="fe mv mw mx my b">fetch</code>事件，该事件仅在请求<code class="fe mv mw mx my b">.mode</code>为<code class="fe mv mw mx my b">navigate</code>时处理页面导航。如果请求无法从网络上获取项目，它会尝试获取<code class="fe mv mw mx my b">offline.html</code>文件。</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="9284" class="nd ly iq my b gy ne nf l ng nh">self.addEventListener('fetch', (event) =&gt; {<br/>  // CODELAB: Add fetch event handler here.<br/>  if (event.request.mode === 'navigate') {<br/>    event.respondWith(<br/>      fetch(event.request)<br/>        .catch(() =&gt; caches.open(CACHE_NAME)<br/>          .then(cache =&gt; cache.match('offline.html')))<br/>    )<br/>  }<br/>})</span></pre><h1 id="9cd8" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">决赛成绩</h1><p id="f7da" class="pw-post-body-paragraph la lb iq lc b ld mp ka lf lg mq kd li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">部署完成后，我运行了站点的审计，现在它看起来像这样:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lw"><img src="../Images/af425e0f7ebedc392bcad4f99c6f4c1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9Mm2NPsD1a97-MHd.png"/></div></div></figure><p id="6812" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我觉得烟花值得另一个样子。💯</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lw"><img src="../Images/83683d46b4ea6f204b437cbc82146a24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WgWF1d9LggB4S_dQ.gif"/></div></div></figure><h1 id="edf2" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">后续步骤</h1><p id="eb35" class="pw-post-body-paragraph la lb iq lc b ld mp ka lf lg mq kd li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">接下来的步骤是了解更多关于<a class="ae mu" href="https://developers.google.com/web/tools/workbox/" rel="noopener ugc nofollow" target="_blank">工具箱</a>的信息。在那之后，我计划为我的边项目<a class="ae mu" href="https://cld.silvestar.codes/" rel="noopener ugc nofollow" target="_blank">代码行每日</a>添加完整的离线体验。</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><p id="ac52" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><em class="od">最初发布于</em><a class="ae mu" href="https://www.silvestar.codes/articles/how-i-built-my-first-progressive-web-app-pwa/" rel="noopener ugc nofollow" target="_blank"><em class="od">https://www . silvestar . codes</em></a><em class="od">。</em></p></div></div>    
</body>
</html>