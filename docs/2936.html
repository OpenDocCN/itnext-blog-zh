<html>
<head>
<title>Testing Angular applications with Jest and Spectator</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Jest和旁观者测试角度应用</h1>
<blockquote>原文：<a href="https://itnext.io/testing-angular-applications-with-jest-and-spectator-c05991579807?source=collection_archive---------0-----------------------#2019-09-03">https://itnext.io/testing-angular-applications-with-jest-and-spectator-c05991579807?source=collection_archive---------0-----------------------#2019-09-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fdf3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">加速测试与Jest和观众的角度应用。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a7dd9783988ea8aae7f2f35d35a86614.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MBe8w80SS2I8rygZfB226Q.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">品牌:<a class="ae kv" href="https://angular.io" rel="noopener ugc nofollow" target="_blank">棱角</a>，<a class="ae kv" href="https://jestjs.io" rel="noopener ugc nofollow" target="_blank">笑话</a>，<a class="ae kv" href="https://github.com/ngneat/spectator" rel="noopener ugc nofollow" target="_blank">看客</a></figcaption></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="26bf" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated"><strong class="lf ir">2020年2月29日</strong></p><p id="7b8c" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">更新了项目依赖项，未更改配置或代码。</p><ul class=""><li id="7c4e" class="lz ma iq lf b lg lh lj lk lm mb lq mc lu md ly me mf mg mh bi translated">角度9.0.x</li><li id="7fb5" class="lz ma iq lf b lg mi lj mj lm mk lq ml lu mm ly me mf mg mh bi translated">旁观者5.1.x</li><li id="612b" class="lz ma iq lf b lg mi lj mj lm mk lq ml lu mm ly me mf mg mh bi translated">Jest预设角度8.0.x</li></ul></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="9bde" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">为什么<a class="ae kv" href="https://angular.io" rel="noopener ugc nofollow" target="_blank">有角度</a> (8.2.x)</p><ul class=""><li id="8f0b" class="lz ma iq lf b lg lh lj lk lm mb lq mc lu md ly me mf mg mh bi translated">这是一个建立良好的框架，用于构建有大量用户的单页面和移动应用程序。</li><li id="7f68" class="lz ma iq lf b lg mi lj mj lm mk lq ml lu mm ly me mf mg mh bi translated">它在一个框架中提供了构建应用程序所需的一切。</li><li id="28e2" class="lz ma iq lf b lg mi lj mj lm mk lq ml lu mm ly me mf mg mh bi translated">没有必要在用于构建应用程序的库之间进行选择。</li><li id="ef86" class="lz ma iq lf b lg mi lj mj lm mk lq ml lu mm ly me mf mg mh bi translated">它有一个内置的IoC容器来注入您的依赖项。</li><li id="1362" class="lz ma iq lf b lg mi lj mj lm mk lq ml lu mm ly me mf mg mh bi translated">它有一个内置的测试框架(我们将用Jest替换它的一部分)。</li><li id="31eb" class="lz ma iq lf b lg mi lj mj lm mk lq ml lu mm ly me mf mg mh bi translated">有很多<a class="ae kv" href="https://stackoverflow.com/questions/tagged/angular" rel="noopener ugc nofollow" target="_blank"> StackOverflow </a>的帖子可以帮助你度过开发过程中的难关。</li></ul><p id="41cc" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">为什么<a class="ae kv" href="https://jestjs.io" rel="noopener ugc nofollow" target="_blank">开玩笑</a> (24.9.x)</p><ul class=""><li id="2d11" class="lz ma iq lf b lg lh lj lk lm mb lq mc lu md ly me mf mg mh bi translated">这是一个一体化的测试框架，“开箱即用”，而且确实如此！</li><li id="a619" class="lz ma iq lf b lg mi lj mj lm mk lq ml lu mm ly me mf mg mh bi translated">支持组件的<a class="ae kv" href="https://jestjs.io/docs/en/snapshot-testing" rel="noopener ugc nofollow" target="_blank">快照测试</a>。</li><li id="66c9" class="lz ma iq lf b lg mi lj mj lm mk lq ml lu mm ly me mf mg mh bi translated">并行运行测试。</li><li id="eb21" class="lz ma iq lf b lg mi lj mj lm mk lq ml lu mm ly me mf mg mh bi translated">不需要浏览器(默认情况下Jest使用<code class="fe mn mo mp mq b">jsdom</code>)。这对CI环境来说非常好。</li><li id="e303" class="lz ma iq lf b lg mi lj mj lm mk lq ml lu mm ly me mf mg mh bi translated">具有内置的覆盖率报告。</li></ul><p id="f423" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">为什么<a class="ae kv" href="https://github.com/ngneat/spectator" rel="noopener ugc nofollow" target="_blank">看客</a> (4.0.x)</p><ul class=""><li id="007c" class="lz ma iq lf b lg lh lj lk lm mb lq mc lu md ly me mf mg mh bi translated">减少设置角度测试套件所需的样板文件。</li><li id="5769" class="lz ma iq lf b lg mi lj mj lm mk lq ml lu mm ly me mf mg mh bi translated">内置嘲讽。</li><li id="f420" class="lz ma iq lf b lg mi lj mj lm mk lq ml lu mm ly me mf mg mh bi translated">支持Jasmine或Jest开箱即用。</li><li id="9314" class="lz ma iq lf b lg mi lj mj lm mk lq ml lu mm ly me mf mg mh bi translated">有助于保持测试的整洁和集中。</li></ul><h2 id="16ff" class="mr ms iq bd mt mu mv dn mw mx my dp mz lm na nb nc lq nd ne nf lu ng nh ni nj bi translated">设置</h2><p id="da96" class="pw-post-body-paragraph ld le iq lf b lg nk jr li lj nl ju ll lm nm lo lp lq nn ls lt lu no lw lx ly ij bi translated">使用<code class="fe mn mo mp mq b">@angular/cli</code>创建一个新的角度项目。询问时选择默认选项。</p><p id="8184" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated"><a class="ae kv" href="https://angular.io/guide/setup-local#step-1-install-the-angular-cli" rel="noopener ugc nofollow" target="_blank"> Angular docs </a>建议您在全球范围内安装<code class="fe mn mo mp mq b">@angular/cli</code>，但您并不必须这样做。您可以简单地使用<code class="fe mn mo mp mq b">npx</code>运行一次<code class="fe mn mo mp mq b">cli</code>来创建一个新项目，该项目将包含作为<code class="fe mn mo mp mq b">devDependencies</code>的<code class="fe mn mo mp mq b">cli</code>。</p><pre class="kg kh ki kj gt np mq nq nr aw ns bi"><span id="907d" class="mr ms iq mq b gy nt nu l nv nw"><strong class="mq ir">$ npx -p @angular/cli ng new angular-jest-spectator</strong></span><span id="d91b" class="mr ms iq mq b gy nx nu l nv nw">? Would you like to add Angular routing? <strong class="mq ir">// answer: 'N'</strong><br/>? Which stylesheet format would you like to use? // <strong class="mq ir">answer: 'CSS'</strong></span></pre><p id="5fae" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">一旦项目被创建，进入<code class="fe mn mo mp mq b">angular-jest-spectator</code>并运行<code class="fe mn mo mp mq b">npm test -- -no-watch --browsers=ChromeHeadless</code>来查看存根测试是否通过。</p><pre class="kg kh ki kj gt np mq nq nr aw ns bi"><span id="6c67" class="mr ms iq mq b gy nt nu l nv nw"><strong class="mq ir">$ cd angular-jest-spectator</strong></span><span id="a1a1" class="mr ms iq mq b gy nx nu l nv nw"><strong class="mq ir">$ npm test -- --no-watch --browsers=ChromeHeadless</strong></span><span id="b572" class="mr ms iq mq b gy nx nu l nv nw">&gt; angular-jest-spectator@0.0.0 test /angular-jest-spectator<br/>&gt; ng test --no-watch --browsers=ChromeHeadless</span><span id="7344" class="mr ms iq mq b gy nx nu l nv nw">30% building 16/16 modules 0 active</span><span id="b2f0" class="mr ms iq mq b gy nx nu l nv nw">INFO [karma-server]: Karma v4.1.0 server started at <a class="ae kv" href="http://0.0.0.0:9876/" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:9876/</a><br/>INFO [launcher]: Launching browsers ChromeHeadless with concurrency unlimited<br/>INFO [launcher]: Starting browser ChromeHeadless<br/>INFO [HeadlessChrome 76.0.3809 (Mac OS X 10.14.6)]: Connected on socket mMeLgzT2Z6Kc7RVYAAAA with id 93795886</span><span id="140a" class="mr ms iq mq b gy nx nu l nv nw">HeadlessChrome 76.0.3809 (Mac OS X 10.14.6): Executed 3 of 3 SUCCESS (0.326 secs / 0.274 secs)</span><span id="6bfb" class="mr ms iq mq b gy nx nu l nv nw">TOTAL: 3 SUCCESS</span></pre><h2 id="7136" class="mr ms iq bd mt mu mv dn mw mx my dp mz lm na nb nc lq nd ne nf lu ng nh ni nj bi translated">用笑话代替茉莉和因果报应</h2><p id="89af" class="pw-post-body-paragraph ld le iq lf b lg nk jr li lj nl ju ll lm nm lo lp lq nn ls lt lu no lw lx ly ij bi translated">从<code class="fe mn mo mp mq b">package.json</code>文件的<code class="fe mn mo mp mq b">devDependencies</code>部分删除以<code class="fe mn mo mp mq b">jasmine</code>或<code class="fe mn mo mp mq b">karma</code>开头或包含<code class="fe mn mo mp mq b">jasmine</code>或【】的包。</p><p id="05c6" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">删除<code class="fe mn mo mp mq b">karma.config.js</code>和<code class="fe mn mo mp mq b">src/test.ts</code>文件。</p><p id="3eb0" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">使用npm安装所需的<code class="fe mn mo mp mq b">jest</code>包。这也将卸载并删除上面删除的<code class="fe mn mo mp mq b">jasmine</code>和<code class="fe mn mo mp mq b">karma</code>软件包:</p><pre class="kg kh ki kj gt np mq nq nr aw ns bi"><span id="6d5d" class="mr ms iq mq b gy nt nu l nv nw"><strong class="mq ir">$ npm install --save-dev jest jest-preset-angular @types/jest</strong></span></pre><p id="ca4e" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">从<code class="fe mn mo mp mq b">angular.json</code>文件中删除<code class="fe mn mo mp mq b">test</code>条目，并更新<code class="fe mn mo mp mq b">package.json</code>中的<code class="fe mn mo mp mq b">test</code>脚本以调用<code class="fe mn mo mp mq b">jest</code>。</p><pre class="kg kh ki kj gt np mq nq nr aw ns bi"><span id="4eeb" class="mr ms iq mq b gy nt nu l nv nw"><strong class="mq ir">// package.json </strong></span><span id="f176" class="mr ms iq mq b gy nx nu l nv nw">{<br/>  ...<br/>  "scripts": {<br/>    ...<br/>   <strong class="mq ir"> "test": "jest",<br/>    ...</strong><br/>  },<br/>  ...<br/>}</span></pre><p id="7971" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">用以下条目更新<code class="fe mn mo mp mq b">tsconfig.spec.json</code>中的<code class="fe mn mo mp mq b">compilerOptions</code>:</p><ul class=""><li id="526c" class="lz ma iq lf b lg lh lj lk lm mb lq mc lu md ly me mf mg mh bi translated"><code class="fe mn mo mp mq b">types</code> —删除<code class="fe mn mo mp mq b">"jasmine"</code>条目，添加<code class="fe mn mo mp mq b">"jest"</code>，这样就剩下<code class="fe mn mo mp mq b">types: ["node", "jest"]</code>。</li><li id="fa87" class="lz ma iq lf b lg mi lj mj lm mk lq ml lu mm ly me mf mg mh bi translated"><code class="fe mn mo mp mq b">emitDecoratorMetadata: true</code> —当您需要为注入到其他服务或组件中的服务建立模拟而不必用<code class="fe mn mo mp mq b">@Inject</code>标记它们时，添加这个将有助于测试。</li><li id="43fc" class="lz ma iq lf b lg mi lj mj lm mk lq ml lu mm ly me mf mg mh bi translated"><code class="fe mn mo mp mq b">esModuleInterop: true</code> —添加此项以清除jest包模块导入的<code class="fe mn mo mp mq b">jest</code>警告消息。</li><li id="6639" class="lz ma iq lf b lg mi lj mj lm mk lq ml lu mm ly me mf mg mh bi translated"><code class="fe mn mo mp mq b">files</code> —移除<code class="fe mn mo mp mq b">src/test.ts</code>入口。</li></ul><pre class="kg kh ki kj gt np mq nq nr aw ns bi"><span id="fc41" class="mr ms iq mq b gy nt nu l nv nw"><strong class="mq ir">// tsconfig.spec.json</strong></span><span id="969d" class="mr ms iq mq b gy nx nu l nv nw">{<br/>  ...<br/>  "compilerOptions": {<br/>    "outDir": "./out-tsc/spec",<br/>    <strong class="mq ir">"types": [<br/>      "jest",<br/>      "node"<br/>    ], <br/>    "emitDecoratorMetadata": true, <br/>    "esModuleInterop": true</strong><br/>  },<br/> <strong class="mq ir"> "files": [<br/>    "src/polyfills.ts"<br/>  ]</strong><br/>  <strong class="mq ir">... </strong><br/>}</span></pre><p id="9109" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在<code class="fe mn mo mp mq b">src</code>文件夹的根目录下添加一个<code class="fe mn mo mp mq b">setupJest.ts</code>文件，实现如下:</p><pre class="kg kh ki kj gt np mq nq nr aw ns bi"><span id="f7ae" class="mr ms iq mq b gy nt nu l nv nw"><strong class="mq ir">// src/setupJest.ts</strong></span><span id="bb07" class="mr ms iq mq b gy nx nu l nv nw">import 'jest-preset-angular';</span></pre><p id="f2ea" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在项目的根目录下添加一个<code class="fe mn mo mp mq b">jest.config.js</code>文件，以覆盖<code class="fe mn mo mp mq b">jest-preset-angular</code>包中的一些基本配置。</p><p id="dd64" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">如果你现在尝试运行<code class="fe mn mo mp mq b">npm test</code>，它会失败。这是因为<code class="fe mn mo mp mq b">jest-preset-angular</code>包试图在<code class="fe mn mo mp mq b">src</code>目录中寻找<code class="fe mn mo mp mq b">tsconfig.spec.json</code>文件，而不是在生成过程中<code class="fe mn mo mp mq b">angular/cli</code>放置它的项目根目录中。</p><p id="d3d0" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">对<code class="fe mn mo mp mq b">jest.config.js</code>文件进行以下更改，以修复<code class="fe mn mo mp mq b">tsconfig</code>路径问题。粗体的变化是重要的变化:</p><pre class="kg kh ki kj gt np mq nq nr aw ns bi"><span id="2b16" class="mr ms iq mq b gy nt nu l nv nw"><strong class="mq ir">// jest.config.js (located at the project root)</strong></span><span id="3c8b" class="mr ms iq mq b gy nx nu l nv nw">// base config from <!-- -->jest-present-angular<br/>const jestPreset = require('jest-preset-angular/jest-preset');</span><span id="bcf2" class="mr ms iq mq b gy nx nu l nv nw">const { globals } = jestPreset;<br/>const tsjest = globals['ts-jest'];</span><span id="3eb8" class="mr ms iq mq b gy nx nu l nv nw">// set the correct path to the spect ts-config file<br/>// the default for the jest-preset-angular package<br/>// points to an incorrect path:<br/>// &lt;rootDir/src/tsconfig.spec.js<strong class="mq ir"><br/></strong>const tsjestOverrides = {<br/>  ...tsjest,<br/>  <strong class="mq ir">tsConfig: '&lt;rootDir&gt;/tsconfig.spec.json'</strong><br/>};</span><span id="e5fa" class="mr ms iq mq b gy nx nu l nv nw">const globalOverrides = {<br/>  ...globals,<br/>  'ts-jest': { ...tsjestOverrides }<br/>};</span><span id="a0f3" class="mr ms iq mq b gy nx nu l nv nw">// make sure to add in the required preset and<br/>// and setup file entries<br/>module.exports = {<br/>  ...jestPreset,<br/>  globals: { ...globalOverrides },<br/>  <strong class="mq ir">preset: 'jest-preset-angular',<br/>  setupFilesAfterEnv: ['&lt;rootDir&gt;/src/setupJest.ts']</strong><br/>};</span></pre><p id="2188" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">此时，运行<code class="fe mn mo mp mq b">npm test</code>，应该使用Jest运行，并且所有测试应该仍然通过:</p><pre class="kg kh ki kj gt np mq nq nr aw ns bi"><span id="97d0" class="mr ms iq mq b gy nt nu l nv nw"><strong class="mq ir">$ npm test</strong></span><span id="2c55" class="mr ms iq mq b gy nx nu l nv nw">&gt; angular-jest-spectator@0.0.0 test /angular-jest-spectator<br/>&gt; jest</span><span id="4059" class="mr ms iq mq b gy nx nu l nv nw"><strong class="mq ir">PASS </strong> src/app/<strong class="mq ir">app.component.spec.ts</strong></span><span id="5949" class="mr ms iq mq b gy nx nu l nv nw">AppComponent<br/>  ✓ should create the app (224ms)<br/>  ✓ should have as title 'angular-jest-spectator' (135ms)<br/>  ✓ should render title (151ms)</span><span id="dd61" class="mr ms iq mq b gy nx nu l nv nw"><strong class="mq ir">Test Suites: 1 passed</strong>, 1 total<br/><strong class="mq ir">Tests:       3 passed</strong>, 3 total<br/><strong class="mq ir">Snapshots:   </strong>0 total</span><span id="5efa" class="mr ms iq mq b gy nx nu l nv nw"><strong class="mq ir">Time:</strong>        3.796s</span><span id="da66" class="mr ms iq mq b gy nx nu l nv nw">Ran all test suites.</span></pre><p id="5db8" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">您可以选择用<code class="fe mn mo mp mq b">test</code>块更新<code class="fe mn mo mp mq b">src/app/app.component.spec.ts</code>文件的<code class="fe mn mo mp mq b">it</code>块。如果您选择将它们保留为<code class="fe mn mo mp mq b">it</code>，它们在<code class="fe mn mo mp mq b">jest</code>中的功能是相同的。</p><h2 id="18a1" class="mr ms iq bd mt mu mv dn mw mx my dp mz lm na nb nc lq nd ne nf lu ng nh ni nj bi translated">添加观众</h2><p id="e502" class="pw-post-body-paragraph ld le iq lf b lg nk jr li lj nl ju ll lm nm lo lp lq nn ls lt lu no lw lx ly ij bi translated">在一个中型到大型的项目中，将会有许多测试，这些测试需要相同的样板设置来编译和运行组件、服务、指令等。正在测试中。通过使用Spectator从样板文件中提取噪音，我们可以节省大量时间。</p><p id="c712" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">从安装旁观者包开始:</p><pre class="kg kh ki kj gt np mq nq nr aw ns bi"><span id="02ec" class="mr ms iq mq b gy nt nu l nv nw"><strong class="mq ir">$ npm install --save-dev @ngneat/spectator</strong></span></pre><p id="de2f" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">接下来，用旁观者设置更新规格文件。确保导入观众包的<code class="fe mn mo mp mq b">/jest</code>变体:</p><pre class="kg kh ki kj gt np mq nq nr aw ns bi"><span id="18a5" class="mr ms iq mq b gy nt nu l nv nw"><strong class="mq ir">// app.component.spec.ts</strong></span><span id="2baa" class="mr ms iq mq b gy nx nu l nv nw"><strong class="mq ir">import { <br/>  createComponentFactory, <br/>  Spectator <br/>} from '@ngneat/spectator/jest';</strong></span><span id="8b3a" class="mr ms iq mq b gy nx nu l nv nw"><strong class="mq ir">// with Spectator:<br/>describe('AppComponent', () =&gt; {<br/>  const createComponent = createComponentFactory({<br/>    component: AppComponent<br/>  });</strong></span><span id="5fce" class="mr ms iq mq b gy nx nu l nv nw"><strong class="mq ir">  let spectator: Spectator&lt;AppComponent&gt;;</strong></span><span id="5724" class="mr ms iq mq b gy nx nu l nv nw"><strong class="mq ir">  beforeEach(() =&gt; spectator = createComponent());</strong></span><span id="5024" class="mr ms iq mq b gy nx nu l nv nw"><strong class="mq ir">  it('should create the app', () =&gt; {<br/>    const app = spectator.component;<br/>    expect(app).toBeTruthy();<br/>  });</strong></span><span id="d46f" class="mr ms iq mq b gy nx nu l nv nw"><strong class="mq ir">  // more 'it' blocks<br/>});</strong></span><span id="d731" class="mr ms iq mq b gy nx nu l nv nw">// before (without Spectator):<br/>// ignore the lines below, they are for comparison only<strong class="mq ir"><br/></strong>describe('AppComponent', () =&gt; {<br/>  beforeEach(async(() =&gt; {<br/>    TestBed.configureTestingModule({<br/>      declarations: [<br/>        AppComponent<br/>      ]<br/>    }).compileComponents();<br/>  }));</span><span id="212b" class="mr ms iq mq b gy nx nu l nv nw">  it(‘should create the app’, () =&gt; {<br/>    const fixture = TestBed.createComponent(AppComponent);<br/>    const app = fixture.debugElement.componentInstance;<br/>    expect(app).toBeTruthy();<br/>  });</span><span id="87ff" class="mr ms iq mq b gy nx nu l nv nw">  // more ‘it’ blocks<br/>});</span></pre><p id="f47b" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">再次运行<code class="fe mn mo mp mq b">npm test</code>以验证测试仍然通过！</p><pre class="kg kh ki kj gt np mq nq nr aw ns bi"><span id="e5b9" class="mr ms iq mq b gy nt nu l nv nw"><strong class="mq ir">$ npm test</strong></span><span id="bed2" class="mr ms iq mq b gy nx nu l nv nw">&gt; angular-jest-spectator@0.0.0 test /angular-jest-spectator<br/>&gt; jest</span><span id="5e08" class="mr ms iq mq b gy nx nu l nv nw"><strong class="mq ir">PASS </strong> src/app/<strong class="mq ir">app.component.spec.ts</strong></span><span id="aa94" class="mr ms iq mq b gy nx nu l nv nw">AppComponent<br/>  ✓ should create the app (224ms)<br/>  ✓ should have as title 'angular-jest-spectator' (143ms)<br/>  ✓ should render title (159ms)</span><span id="1af0" class="mr ms iq mq b gy nx nu l nv nw"><strong class="mq ir">Test Suites: 1 passed</strong>, 1 total<br/><strong class="mq ir">Tests:       3 passed</strong>, 3 total</span><span id="039f" class="mr ms iq mq b gy nx nu l nv nw"><strong class="mq ir">Snapshots:   </strong>0 total</span><span id="c6ea" class="mr ms iq mq b gy nx nu l nv nw"><strong class="mq ir">Time:</strong>        2.259s</span><span id="43a9" class="mr ms iq mq b gy nx nu l nv nw">Ran all test suites.</span></pre><h2 id="252f" class="mr ms iq bd mt mu mv dn mw mx my dp mz lm na nb nc lq nd ne nf lu ng nh ni nj bi translated"><strong class="ak">常见用例</strong></h2><p id="7e53" class="pw-post-body-paragraph ld le iq lf b lg nk jr li lj nl ju ll lm nm lo lp lq nn ls lt lu no lw lx ly ij bi translated">使用<code class="fe mn mo mp mq b">createComponentFactory(options: {})</code>功能创建被测组件:</p><ul class=""><li id="7e98" class="lz ma iq lf b lg lh lj lk lm mb lq mc lu md ly me mf mg mh bi translated"><code class="fe mn mo mp mq b">shallow: true</code> —当您只想呈现测试中的组件，而不想呈现其模板中的任何嵌套组件时。您可以将该选项设置为<code class="fe mn mo mp mq b">true</code>，这样您就不必担心模仿模板中的嵌套组件。</li><li id="1d84" class="lz ma iq lf b lg mi lj mj lm mk lq ml lu mm ly me mf mg mh bi translated"><code class="fe mn mo mp mq b">detectChanges: false</code> —默认设置为<code class="fe mn mo mp mq b">true</code>，因此组件的生命周期挂钩(想想<code class="fe mn mo mp mq b">ngOnInit</code>)将为每个<code class="fe mn mo mp mq b">test/it</code>模块运行。如果您将此设置为<code class="fe mn mo mp mq b">false</code>，您可以在您需要的每个<code class="fe mn mo mp mq b">test/it</code>模块中用<code class="fe mn mo mp mq b">spectator.detectChanges()</code>手动触发变化检测。这将允许您<code class="fe mn mo mp mq b">mock/spy</code>在服务运行之前，在生命周期挂钩中调用这些服务。</li></ul><p id="79fd" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在开发过程中，你可以运行<code class="fe mn mo mp mq b">npm run test -- --watch</code>或者添加一个新的叫做<code class="fe mn mo mp mq b">test:watch</code>的<code class="fe mn mo mp mq b">npm</code>脚本，它将在观察模式下启动Jest，只观察和运行针对已经改变的文件的测试。</p><p id="f4f6" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">将下面的<code class="fe mn mo mp mq b">test:watch</code>脚本添加到您的<code class="fe mn mo mp mq b">package.json</code>文件中，并使用<code class="fe mn mo mp mq b">npm run test:watch</code>在终端中运行它。</p><pre class="kg kh ki kj gt np mq nq nr aw ns bi"><span id="dc45" class="mr ms iq mq b gy nt nu l nv nw"><strong class="mq ir">// package.json</strong></span><span id="418c" class="mr ms iq mq b gy nx nu l nv nw">{<br/>  ...<br/>  "scripts": {<br/>    ...<br/>    <strong class="mq ir">"test:watch": "npm run test --watch",</strong><br/>    ...<br/>  },<br/>  ...<br/>}</span></pre><h2 id="91df" class="mr ms iq bd mt mu mv dn mw mx my dp mz lm na nb nc lq nd ne nf lu ng nh ni nj bi translated">警告</h2><p id="cd00" class="pw-post-body-paragraph ld le iq lf b lg nk jr li lj nl ju ll lm nm lo lp lq nn ls lt lu no lw lx ly ij bi translated">如果您选择使用依赖于<code class="fe mn mo mp mq b">jasmine</code>和<code class="fe mn mo mp mq b">protractor</code>的内置<code class="fe mn mo mp mq b">e2e</code>测试设置，您将与<code class="fe mn mo mp mq b">jest</code>及其类型发生冲突。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="2baf" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">这就是你所需要的和Jest和Spectator一起运行。享受编写和测试Angular应用程序的乐趣！</p><p id="909f" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">来源:<a class="ae kv" href="https://github.com/vanister/angular-jest-spectator" rel="noopener ugc nofollow" target="_blank">https://github.com/vanister/angular-jest-spectator</a>。</p></div></div>    
</body>
</html>