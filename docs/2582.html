<html>
<head>
<title>SQL —The Case statement</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL—Case语句</h1>
<blockquote>原文：<a href="https://itnext.io/sql-the-case-statement-87ec7eee736e?source=collection_archive---------10-----------------------#2019-06-17">https://itnext.io/sql-the-case-statement-87ec7eee736e?source=collection_archive---------10-----------------------#2019-06-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2dc6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">数据库只是存储数据的工具，但是它附带的查询语言SQL也非常强大。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/531d01dd694456870f7c202537c5f97f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5ya4p7Uh08D7-fl4ZmMm0g.png"/></div></div></figure><p id="8157" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在JavaScript、Java或C#等编程语言中，我们一直在使用复杂的逻辑运算。所以这样做是完全正常的:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="2dc5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本上，它需要一个字符串数组/列表，在这个例子中是车辆名称。我们最终想要的是具有名为<code class="fe kz la lb lc b">type</code>的属性的单个名称，以便以后进行更昂贵的操作。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="bdf5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完整的结果列表如下所示:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="f569" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，这可以在上面看到的应用程序代码中完成，但在很多情况下，这里出现的问题是我们正在使用应用程序的服务器CPU。这并不理想，因为这些事情可以用SQL来完成。</p><p id="f937" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是首先，我们需要显示数据库中有哪些数据。让我们看一个示例表。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ld"><img src="../Images/209eac299303531382836bf094740780.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C01F-tsVLkwowoj-gBBWJg.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">车辆表</figcaption></figure><p id="2ce4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是非常简单的数据，但这里缺少的是车辆的分组。在应用程序级别进行分组可能会占用太多的CPU资源，但是我们已经有了分组功能。有可能将分组功能从我们的应用程序代码转换成SQL语句。</p><p id="a025" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">欢迎使用SQL中的<code class="fe kz la lb lc b">CASE</code>语句🎉</p><p id="4881" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe kz la lb lc b">CASE</code>语句几乎可以在查询中的任何地方使用。这篇博文中的例子将集中在PostgreSQL上，但是应该适用于几乎所有的关系数据库管理系统(RDBMS)。</p><p id="7b62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了创建合适的SQL查询，我建议首先可视化我们想要实现的结果。我们的预期结果应该是这样的:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi li"><img src="../Images/76347159efae72cf6b61d508a3fbf3e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yij10Kuj8pKYZV6zWPavvA.png"/></div></div></figure><p id="fbae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个按车辆类型分组的表，它只存在于我们的应用程序代码中，是按类型分组的每辆车的总量。</p><p id="903f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要了解当前的第一步是什么，我们需要了解原始数据中缺少哪些数据。在我们的基本SQL表数据中，这是车辆类型。车辆类型已经在应用程序代码中编程，因此可以从那里获取。要将它插入到查询中，我们应该先了解PostgreSQL中的<code class="fe kz la lb lc b">ANY</code>操作符。您可以通过以下链接找到相关文档:<a class="ae lj" href="https://www.postgresql.org/docs/9.4/functions-comparisons.html" rel="noopener ugc nofollow" target="_blank">https://www . PostgreSQL . org/docs/9.4/functions-comparisons . html</a>或点击此处关注博客。</p><p id="9368" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本上，<code class="fe kz la lb lc b">ANY</code>与JavaScript中的<code class="fe kz la lb lc b">includes</code>或Java中的<code class="fe kz la lb lc b">contains</code>功能相同。这是一个检查项目是否在列表或可迭代数据类型中的功能。在PostgreSQL中，这通常用于数组。对于我们的用例，可以用两种方式定义列表:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="kx ky l"/></div></figure><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="534e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二种方法似乎更自然，类似于我们在现代编程语言中所习惯的方法，所以我将遵循这种方法。这就是我们将在这篇博文中用到的。所以使用它的第一件事可能是在一个简单的查询中从我们的数据集中获取所有的飞机。最简单的查询如下所示:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="2994" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它将检查所有名字包含在列表中的车辆。</p><p id="8f77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同样的查询也可以用于汽车。它将只返回包含汽车的行。现在让我们用一种简单的方法来检查<code class="fe kz la lb lc b">CASE</code>语句，将车辆类型附加到数据中。第一种常见的方法是使用这样的东西:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="a163" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这种方法是可行的，但是确实有一个很大的缺点:对于这个查询中的每一个新的数据元素，我们都会有另一行代码，并且它会重复很多代码<code class="fe kz la lb lc b">WHEN name = '...' THEN vehicle_type</code>。这里的一个特点是我们需要调用一个<code class="fe kz la lb lc b">CASE</code>和<code class="fe kz la lb lc b">END</code>关键字来使case语句工作。</p><p id="9325" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是这可以通过我们之前学过的<code class="fe kz la lb lc b">ANY</code>操作符来改进:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="8518" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将产生以下数据集:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lk"><img src="../Images/75e5249c38ef49e385390915eda50306.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IKsljKblZXLVL-k7A9mGUA.png"/></div></div></figure><p id="1b37" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这确实接近了应该达到的最终结果。但是对于最后一部分，该查询需要在<code class="fe kz la lb lc b">vehicle_type</code>之前汇总价格。这可以通过使用<code class="fe kz la lb lc b">GROUP BY</code>语句轻松完成。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="0c6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是查询的样子。也许可以通过过滤掉将<code class="fe kz la lb lc b">NULL</code>作为<code class="fe kz la lb lc b">vehicle_type</code>的行来优化，但是在这个例子中应该显示主要的点，即<code class="fe kz la lb lc b">CASE</code>关键字。该关键字可用于许多其他用例(ba dum tss ),如多个表上的复杂<code class="fe kz la lb lc b">JOIN</code>。只是体验一下这个关键字，看看它是否可以应用在你的查询中。</p><p id="d8f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总的来说，本文表明这种“丢失数据”的逻辑甚至可以在数据库级别上实现，而不是在应用程序代码中实现，在应用程序代码中，它会使整个代码变得混乱。尽管在将业务逻辑放到数据库级别时应该非常小心，但在这种情况下，它只是数据扩展。</p><blockquote class="ll lm ln"><p id="70d2" class="jn jo lo jp b jq jr js jt ju jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj kk ij bi translated">感谢你阅读这篇文章。你摇滚了<em class="iq">🤘</em></p><p id="5f48" class="jn jo lo jp b jq jr js jt ju jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj kk ij bi translated">也可以看看我的其他博客文章，比如JavaScript中的<a class="ae lj" href="https://medium.com/@kevin_peters/function-parameters-in-javascript-clean-code-4caac109159b" rel="noopener">函数参数</a>、<a class="ae lj" href="https://medium.com/@kevin_peters/learn-how-to-refactor-vue-js-single-file-components-on-a-real-world-example-501b3952ae49" rel="noopener">学习如何用真实世界的例子重构Vue.js单个文件组件</a>或者Python的<a class="ae lj" href="https://medium.com/3yourmind/auto-formatters-for-python-8925065f9505" rel="noopener">自动格式化器</a>。</p><p id="32f2" class="jn jo lo jp b jq jr js jt ju jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj kk ij bi translated">如果你有任何反馈或者想给这篇文章添加一些东西，请在这里评论。您也可以在<a class="ae lj" href="https://twitter.com/kevinpeters_" rel="noopener ugc nofollow" target="_blank"> twitter </a>上关注我，或者访问我的<a class="ae lj" href="https://www.kevinpeters.net/" rel="noopener ugc nofollow" target="_blank">个人网站</a>来了解我的博客文章和更多内容。</p></blockquote></div></div>    
</body>
</html>