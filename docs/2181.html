<html>
<head>
<title>How to avoid VMware ESXi timedrift — Opvizor</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何避免VMware ESXi时间漂移— Opvizor</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-avoid-vmware-esxi-timedrift-opvizor-1758d29cdf4?source=collection_archive---------6-----------------------#2019-04-12">https://itnext.io/how-to-avoid-vmware-esxi-timedrift-opvizor-1758d29cdf4?source=collection_archive---------6-----------------------#2019-04-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7384" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无论您查看哪种最佳实践指南，都会有一条重要的建议来确保您的VMware vCenter和VMware ESXi的时间同步配置正确并正常工作。如果您忽略这一点，VMware ESXi时间漂移就会开始，情况可能会变得非常糟糕。</p><p id="1b87" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用我们最新版本的<a class="ae kl" href="https://www.opvizor.com" rel="noopener ugc nofollow" target="_blank">性能分析器</a>，我们拥有一个控制面板和警报，可帮助您控制vCenter和ESXi时间漂移以采取应对措施。</p><p id="3088" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">提到的控制面板名为VMware Config:Clocks and time drift，它确实可以做到这一点，显示所有ESXi主机和vCenter的时间和时间漂移。该时间漂移将与Performance Analyzer应用装置以及您的VMware vCSA进行比较。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/c70c6aa3b1876e2efd9909bf8bde9822.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RYnIjGruw090Bh-J.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">Opvizor性能分析器—检测VMware ESXi和VMware vCSA时间漂移</figcaption></figure><p id="417b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可能会想，有几秒钟的时间漂移并不是什么大问题。事实上，确实如此。它会影响备份、重做日志、活动目录同步、Kerberos认证、cookie持续时间和各种数据库操作或查询结果。因此，您应该始终确保尽可能精确地设置正确的时间。</p><p id="8198" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">与其他对等机的时间相比，VMware ESXi时间漂移越高，影响就越严重。我们了解了AD用户无法登录或AD计算机退出active directory的情况，因为时间漂移超过5分钟，所以Kerberos变得疯狂。</p><p id="4e19" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还注意到，当客户抱怨看不到填充了数据的仪表板时。或者在图表中有几个小时的间隔。在任何一种情况下，VMware ESXi时间漂移都远远偏离运行Performance Analyzer虚拟机的主机。一旦ESXi时间被纠正，一切都很顺利。因为我们经常遇到这些情况，所以我们决定对照我们在客户环境中可以找到的任何时间源进行检查，并尝试对最佳时间进行三角测量。</p><p id="4dcf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有很多方法可以确保时间总是正确的，只要确保选择并坚持你的选择，不要混淆。</p><h1 id="8975" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">VMware vCSA</h1><p id="8228" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">通过登录到管理页面，您可以非常简单地在VMware vCSA上配置时间同步:<a class="ae kl" href="https://vcsa:5480," rel="noopener ugc nofollow" target="_blank"> https://vcsa:5480，</a>选择时间并编辑时间同步。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/37c61b15844ac53abd7447f1f22c9d5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SjE2xoYgUw2-U3gY.png"/></div></div></figure><p id="36ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最好是使用<strong class="jp ir">三台NTP服务器</strong>进行同步(忽略我们的演示截图设置:-))。</p><h1 id="4886" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">ESXi NTP</h1><p id="4d0d" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">ESXi主机还应该与三台NTP服务器同步时间，您可以使用<a class="ae kl" href="https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.esxi.install.doc/GUID-77D10F4D-50FE-4BA6-B164-42D20D673F4F.html" rel="noopener ugc nofollow" target="_blank">主机配置文件</a>、<a class="ae kl" href="https://vtechdummies.wordpress.com/2017/10/22/powercli-scripts-to-check-and-configure-ntp-configuration-of-esxi-hosts/" rel="noopener ugc nofollow" target="_blank"> powercli脚本</a>或手动配置。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/0fc42139e8b5a2143a454b0e05b0ee2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8UyJq-QiEFMVA2gH.png"/></div></div></figure><p id="71e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请确保该服务已启动并且时间正确。如果时间漂移过大，您可能需要在同步开始之前先手动设置时间。</p><h1 id="4222" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">VMware工具</h1><p id="c175" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">在大多数情况下，虚拟机(VMware tools)的时间同步处于活动状态，并与ESXi主机的时间同步。更准确地说，虚拟机与运行它的ESXi主机的时间同步。</p><p id="ed56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设一个由10台ESXi主机组成的集群，其中9台主机的时间正确，但有一台主机的时间错误(假设为30分钟)。您的虚拟机在所有9台ESXi主机上运行良好，但是当DRS或手动vMotion将虚拟机移动到具有高时间漂移的ESXi主机时，您的虚拟机很乐意利用这段时间。</p><p id="dbd2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，如果您在虚拟机中配置了NTP或AD时间同步，并且不使用VMware tools时间同步功能，则不会发生这种情况。</p><p id="2923" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，请确保使用NTP/AD时间同步或VMware tools时间同步，并让所有ESXi主机与NTP服务器同步时间。</p><p id="4c89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您对配置不确定，可以阅读几篇知识库文章:</p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><p id="6b40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">【www.opvizor.com】最初发表于<a class="ae kl" href="https://www.opvizor.com/how-to-avoid-vmware-esxi-timedrift" rel="noopener ugc nofollow" target="_blank"><em class="mm"/></a><em class="mm">。</em></p></div></div>    
</body>
</html>