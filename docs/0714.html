<html>
<head>
<title>Parallel testing a GraphQL server with Jest and MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Jest和MongoDB并行测试GraphQL服务器</h1>
<blockquote>原文：<a href="https://itnext.io/parallel-testing-a-graphql-server-with-jest-44e206f3e7d2?source=collection_archive---------1-----------------------#2018-05-13">https://itnext.io/parallel-testing-a-graphql-server-with-jest-44e206f3e7d2?source=collection_archive---------1-----------------------#2018-05-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/71886179d8a1b5f6d0347e0bc5df7b27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sbxw2ENsT5aTH1REHw7DXg.png"/></div></div></figure><div class=""/><blockquote class="jy jz ka"><p id="f9a9" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这个故事被移到:<a class="ae la" href="https://jonathancardoso.com/en/blog/parallel-testing-a-graphql-server-with-jest/" rel="noopener ugc nofollow" target="_blank">https://jonathancardoso . com/en/blog/parallel-testing-a-graphql-server-with-jest/</a></p></blockquote><p id="fb33" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">这是西贝利厄斯·塞拉菲尼写的一篇精彩文章的后续:</p><div class="ip iq gp gr ir lg"><a href="https://medium.com/entria/testing-a-graphql-server-using-jest-4e00d0e4980e" rel="noopener follow" target="_blank"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd jc gy z fp ll fr fs lm fu fw ja bi translated">使用Jest测试GraphQL服务器</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">我创建了这个样板文件，以便于使用DataLoader启动一个新的GraphQL项目…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">medium.com</p></div></div></div></a></div><p id="964f" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">之前在<a class="ae la" href="https://github.com/entria" rel="noopener ugc nofollow" target="_blank"> Entria </a>这里，我们使用<code class="fe lp lq lr ls b">--runInBand</code>标志运行我们的测试，这使得Jest连续工作，一个接一个地运行测试。</p><p id="ca48" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">这是必要的，因为我们正在创建一个物理临时数据库，供所有的测试使用，因此，我们不能让两个测试同时运行，因为这会在不同的测试之间产生数据不一致。所以这个想法基本上是在每次测试之前连接到数据库，填充数据库并运行必要的测试，然后删除数据库，这样它就可以在下一次测试中重新创建。重复这一步骤，计算我们的测试次数。</p><p id="ec27" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">我们通过<a class="ae la" href="https://twitter.com/nodkz" rel="noopener ugc nofollow" target="_blank"> @nodkz </a>的出色的库mongodb-memory-server解决了这个问题</p><div class="ip iq gp gr ir lg"><a href="https://github.com/nodkz/mongodb-memory-server" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd jc gy z fp ll fr fs lm fu fw ja bi translated">nodkz/MongoDB-内存-服务器</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">mongodb-memory-server -在内存中运行mongod以进行快速测试。如果您并行运行测试，这个库有助于…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">github.com</p></div></div><div class="lt l"><div class="lu l lv lw lx lt ly ix lg"/></div></div></a></div><p id="bc5a" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">为了使用它，我们创建了自己的jest测试环境，它只是一个文件:</p><figure class="lz ma mb mc gt is"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="9558" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">并配置jest来使用它，通过设置<code class="fe lp lq lr ls b"><a class="ae la" href="https://facebook.github.io/jest/docs/en/configuration.html#testenvironment-string" rel="noopener ugc nofollow" target="_blank">testEnvironment</a></code>设置:</p><pre class="lz ma mb mc gt mf ls mg mh aw mi bi"><span id="bfc3" class="mj mk jb ls b gy ml mm l mn mo">//...<br/>  "jest": {</span><span id="0653" class="mj mk jb ls b gy mp mm l mn mo">    "testEnvironment": "&lt;rootDir&gt;/test/environment/mongodb",<br/>    "<!-- -->resetModules": true,</span><span id="131c" class="mj mk jb ls b gy mp mm l mn mo">    //...</span></pre><p id="f25a" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">注意这里的<code class="fe lp lq lr ls b">resetModules</code>设置，如果你使用Mongoose的话，这也很重要，否则它会试图重用之前运行的测试中的相同连接。这是因为我们使用mongose中的默认连接来设置我们的模型，该连接直接存储在导出的mongose对象上。</p><p id="fad7" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">就是这样，你可以在我们在Entria创建的样板文件中看到它，这里是PR添加它:<a class="ae la" href="https://github.com/entria/graphql-dataloader-boilerplate/pull/80" rel="noopener ugc nofollow" target="_blank">https://github . com/Entria/graph QL-data loader-boilerplate/pull/80</a></p><figure class="lz ma mb mc gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mq"><img src="../Images/480ddf72e2bee789761d8887159c947a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*7ShzCO10wMcjLODYzsJhiQ.gif"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">以前</figcaption></figure><figure class="lz ma mb mc gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mv"><img src="../Images/9b0db3fd77ff77c4301a0416da2e1883.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*gCjDOYVifgQVtPqpANRxlA.gif"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">在...之后</figcaption></figure><p id="8696" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">我们最大的项目之一:</p><figure class="lz ma mb mc gt is gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/4b450e4e532410a3c400e10916f95cb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*sM1_pohSHJy9J6UAHxwQ5g.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">以前</figcaption></figure><figure class="lz ma mb mc gt is gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/ff1b3dbe33c0898a761c0288c0dfbe13.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*ChFLukkgC59XSB5fByFOSQ.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">在...之后</figcaption></figure></div></div>    
</body>
</html>