<html>
<head>
<title>Building a Social Network: Part I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建社交网络:第一部分</h1>
<blockquote>原文：<a href="https://itnext.io/building-a-social-network-part-i-25856fc693e1?source=collection_archive---------2-----------------------#2020-07-01">https://itnext.io/building-a-social-network-part-i-25856fc693e1?source=collection_archive---------2-----------------------#2020-07-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a653" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在PostgreSQL中定义概念、模型和安全性</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7a6bea2b2ab8fb9613764e1f89359341.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*PlMT4dctrIVIaVAyPkh3Xg.gif"/></div></div></figure><h2 id="f260" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">介绍</h2><p id="836e" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi mj translated">社交网络已经成为当今世界许多人日常生活的一部分。在本文中，我们将探讨设计一个非常基本的社交网络的第一步:创建数据库模式。</p><p id="f211" class="pw-post-body-paragraph lq lr it ls b lt ms ju lv lw mt jx ly ld mu ma mb lh mv md me ll mw mg mh mi im bi translated">社交网络是<a class="ae mx" href="https://en.wikipedia.org/wiki/Top-down_and_bottom-up_design" rel="noopener ugc nofollow" target="_blank">自底向上设计</a>的完美用例，因为我们可以以健壮和可扩展的方式定义安全性和所需的行为。这使得未来的升级在很大程度上不会中断，同时相对容易实现和维护。</p><p id="5f34" class="pw-post-body-paragraph lq lr it ls b lt ms ju lv lw mt jx ly ld mu ma mb lh mv md me ll mw mg mh mi im bi translated">这个社交网络将提供标准的电子邮件/密码认证、上传图片、设置个人资料照片、发布内容(可选图片)以及关注其他用户。</p><p id="885d" class="pw-post-body-paragraph lq lr it ls b lt ms ju lv lw mt jx ly ld mu ma mb lh mv md me ll mw mg mh mi im bi translated">安全特性包括强大的密码哈希、自动生成的<a class="ae mx" href="https://en.wikipedia.org/wiki/Universally_unique_identifier" rel="noopener ugc nofollow" target="_blank"> UUID </a>作为主键、具有创建新条目的显式函数的受限访问API角色/用户，以及根据需要通过用户定义的类型进行严格键入。</p><blockquote class="my mz na"><p id="6a04" class="lq lr nb ls b lt ms ju lv lw mt jx ly nc mu ma mb nd mv md me ne mw mg mh mi im bi translated">本系列文章的项目源代码可以在GitHub 上的<a class="ae mx" href="https://github.com/kenreilly/social-network-demo" rel="noopener ugc nofollow" target="_blank">处获得。</a></p><p id="3f2e" class="lq lr nb ls b lt ms ju lv lw mt jx ly nc mu ma mb nd mv md me ne mw mg mh mi im bi translated">为了测试示例数据库，需要一个<a class="ae mx" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>环境。</p></blockquote></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="a7cd" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">设置</h2><p id="13c6" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">设置脚本<code class="fe nm nn no np b"><strong class="ls iu">db/_create.sh</strong></code>运行一系列SQL文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="2f37" class="pw-post-body-paragraph lq lr it ls b lt ms ju lv lw mt jx ly ld mu ma mb lh mv md me ll mw mg mh mi im bi translated">执行的第一个SQL文件是<code class="fe nm nn no np b"><strong class="ls iu">db/init.sql:</strong></code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="da81" class="pw-post-body-paragraph lq lr it ls b lt ms ju lv lw mt jx ly ld mu ma mb lh mv md me ll mw mg mh mi im bi translated">这个脚本创建了用户<code class="fe nm nn no np b">social_demo_admin</code>和<code class="fe nm nn no np b">social_demo_api</code>，然后创建了管理员作为所有者的<code class="fe nm nn no np b">social_demo</code>数据库。</p><p id="a2c2" class="pw-post-body-paragraph lq lr it ls b lt ms ju lv lw mt jx ly ld mu ma mb lh mv md me ll mw mg mh mi im bi translated">接下来，<code class="fe nm nn no np b">social_demo_api_role</code>被创建并被授予<code class="fe nm nn no np b">CONNECT</code>和<code class="fe nm nn no np b">USAGE</code>权限，以允许读取存储在该数据库中的所有信息，然后该角色被授予<code class="fe nm nn no np b">social_demo_api,</code>，API将使用该角色来获得有限的、明确定义的访问权限。这大大提高了安全性，并降低了开发人员出错的可能性。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="9725" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">核心功能</h2><p id="2f6e" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">核心功能和所需扩展在<code class="fe nm nn no np b"><strong class="ls iu">db/core.sql:</strong></code>中定义</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="5789" class="pw-post-body-paragraph lq lr it ls b lt ms ju lv lw mt jx ly ld mu ma mb lh mv md me ll mw mg mh mi im bi translated">这个和后续的SQL文件在<code class="fe nm nn no np b">social_demo</code>数据库的范围内执行。加载扩展<code class="fe nm nn no np b">plpgsql</code>和<code class="fe nm nn no np b">pgcrypto</code>以根据需要促进<a class="ae mx" href="https://en.wikipedia.org/wiki/PL/pgSQL" rel="noopener ugc nofollow" target="_blank"> PL/pgSQL </a>和<a class="ae mx" href="https://www.postgresql.org/docs/current/pgcrypto.html" rel="noopener ugc nofollow" target="_blank">密码</a>功能。</p><p id="4192" class="pw-post-body-paragraph lq lr it ls b lt ms ju lv lw mt jx ly ld mu ma mb lh mv md me ll mw mg mh mi im bi translated"><code class="fe nm nn no np b">hash</code>函数使用加密模块通过blowfish算法和八次迭代计数生成一个散列。这导致哈希的破解时间比MD5长100k倍，并且当结合良好的设计和适当的安全措施时，通常是安全的。</p><p id="480a" class="pw-post-body-paragraph lq lr it ls b lt ms ju lv lw mt jx ly ld mu ma mb lh mv md me ll mw mg mh mi im bi translated"><code class="fe nm nn no np b">flush</code>功能是隐私功能的一部分，执行时将删除任何超过24小时的内容(个人资料照片除外)。这将在以后被API定期调用，以删除旧内容并为更多内容腾出空间，这更加有机，并且类似于真实世界的交互(<em class="nb">不是每个事件都需要永久记录</em>)。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="74b6" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">形象</h2><p id="9e91" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">接下来让我们看看<code class="fe nm nn no np b"><strong class="ls iu">db/images.sql</strong>:</code>中的图像模式</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="a1da" class="pw-post-body-paragraph lq lr it ls b lt ms ju lv lw mt jx ly ld mu ma mb lh mv md me ll mw mg mh mi im bi translated">社交网络中的图像可以是<a class="ae mx" href="https://en.wikipedia.org/wiki/JPEG" rel="noopener ugc nofollow" target="_blank"> JPG </a>、<a class="ae mx" href="https://en.wikipedia.org/wiki/Portable_Network_Graphics" rel="noopener ugc nofollow" target="_blank"> PNG </a>或<a class="ae mx" href="https://en.wikipedia.org/wiki/GIF" rel="noopener ugc nofollow" target="_blank"> GIF </a>类型。类型<code class="fe nm nn no np b">new_image</code>用于定义要添加到<code class="fe nm nn no np b">images</code>表中的新图像，API只能通过用所需的数据结构调用<code class="fe nm nn no np b">add_image</code>来完成。同样，<code class="fe nm nn no np b">delete_image</code>是从图像表中删除图像记录的唯一方法。API将使用为映像生成的UUID和文件类型作为要存储在磁盘、云或其他存储中的文件的命名约定。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="2c7f" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">用户</h2><p id="388e" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">用户模式位于<code class="fe nm nn no np b">db/users.sql:</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="c795" class="pw-post-body-paragraph lq lr it ls b lt ms ju lv lw mt jx ly ld mu ma mb lh mv md me ll mw mg mh mi im bi translated">类型<code class="fe nm nn no np b">authenticated_user</code>和<code class="fe nm nn no np b">new_user</code>被定义为构造认证和创建用户所需的数据。<code class="fe nm nn no np b">users</code>表存储基本的标准用户数据，如登录信息、姓名和创建时间戳。同样，创建和删除用户的函数是为显式API访问定义的，以防止对用户表产生不必要的副作用。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="1c9a" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">邮件</h2><p id="af28" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">帖子的模式在<code class="fe nm nn no np b"><strong class="ls iu">db/posts.sql</strong>:</code>中</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="336f" class="pw-post-body-paragraph lq lr it ls b lt ms ju lv lw mt jx ly ld mu ma mb lh mv md me ll mw mg mh mi im bi translated">帖子非常简单，有效地由带有可选图像的文本内容组成。和以前一样，数据类型和创建/删除函数是为了标准化而定义的。<code class="fe nm nn no np b">posts</code>表为<a class="ae mx" href="https://en.wikipedia.org/wiki/Referential_integrity" rel="noopener ugc nofollow" target="_blank">引用完整性</a>引用了<code class="fe nm nn no np b">users</code>和<code class="fe nm nn no np b">images</code>表，这是PostgreSQL通常擅长的。<code class="fe nm nn no np b">user_id</code>必须匹配<code class="fe nm nn no np b">users</code>表中的记录，如果提供了<code class="fe nm nn no np b">image_id</code>，它必须匹配<code class="fe nm nn no np b">images</code>表中的记录。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="31a4" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">追随者</h2><p id="5896" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">追随者模式位于<code class="fe nm nn no np b"><strong class="ls iu">db/followers.sql</strong>:</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="1a49" class="pw-post-body-paragraph lq lr it ls b lt ms ju lv lw mt jx ly ld mu ma mb lh mv md me ll mw mg mh mi im bi translated">没有某种社交互动结构，任何社交网络都是不完整的，追随者模型非常适合这种应用程序以及其中内容的时间特性。<code class="fe nm nn no np b">followers</code>表和支持功能的设计保持简单，并遵循整个应用程序中使用的通用安全主题。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="94c6" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">结论</h2><p id="697a" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">这些SQL文件定义了一个简单的数据库模式，该模式具有适用于下一阶段的内置安全性和数据完整性特性:构建API和UI实现使用的通用模型，用于执行身份验证、与数据库交互以及为移动、web和其他客户端应用程序提供功能。</p><p id="c686" class="pw-post-body-paragraph lq lr it ls b lt ms ju lv lw mt jx ly ld mu ma mb lh mv md me ll mw mg mh mi im bi translated">请继续关注本系列的第2部分，在这一部分中，我们将了解在这个数据库的基础上构建一个可靠的API和UI需要做哪些准备工作，以一种安全可靠的方式轻松地部署到目标设备和服务。</p><p id="f475" class="pw-post-body-paragraph lq lr it ls b lt ms ju lv lw mt jx ly ld mu ma mb lh mv md me ll mw mg mh mi im bi translated">感谢阅读！</p><p id="0502" class="pw-post-body-paragraph lq lr it ls b lt ms ju lv lw mt jx ly ld mu ma mb lh mv md me ll mw mg mh mi im bi translated"><strong class="ls iu"><em class="nb">~</em></strong><a class="ae mx" href="https://twitter.com/8_bit_hacker" rel="noopener ugc nofollow" target="_blank"><strong class="ls iu"><em class="nb">8 _ bit _ hacker</em></strong></a></p></div></div>    
</body>
</html>