<html>
<head>
<title>Intro to WebAssembly via Rust</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Rust介绍WebAssembly</h1>
<blockquote>原文：<a href="https://itnext.io/intro-to-webassembly-via-rust-7365464868bf?source=collection_archive---------3-----------------------#2020-03-11">https://itnext.io/intro-to-webassembly-via-rust-7365464868bf?source=collection_archive---------3-----------------------#2020-03-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5ca9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">面向Javascript开发人员(但不仅仅是)！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/53bf402d7b932fe9c5ca9afc32835a59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KmdYFJxJRcuTVdoZYG53vQ.png"/></div></div></figure><p id="ce0f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">声明:这篇文章不会教你Rust，其动机是让你在直观的Rust生态系统上使用令人惊叹的<strong class="kt ir"> wasm-pack </strong>工具快速进入WASM。</p><p id="607e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不久前我开始对<strong class="kt ir">锈感兴趣- </strong>怎么会这样？</p><p id="f718" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">围绕WASM(网络组装)有一场炒作，它引发了我想尝试新事物的需求..我想成为那个派对的一部分🎉 🎊 🎈。</p><p id="b709" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我开始阅读一些关于wasm <a class="ae ln" href="https://webassembly.org/" rel="noopener ugc nofollow" target="_blank">这里</a>和<a class="ae ln" href="https://developer.mozilla.org/en-US/docs/WebAssembly" rel="noopener ugc nofollow" target="_blank">那里</a>的资料:</p><blockquote class="lo lp lq"><p id="6611" class="kr ks lr kt b ku kv jr kw kx ky ju kz ls lb lc ld lt lf lg lh lu lj lk ll lm ij bi translated">“WebAssembly是一种可以在现代web浏览器中运行的新型代码，它是一种低级的类似汇编的语言，具有紧凑的二进制格式，以接近本机的性能运行，并为C/C++和Rust等语言提供编译目标，以便它们可以在web上运行。它还被设计成与JavaScript并行运行，允许两者协同工作。”</p></blockquote><h2 id="f6b5" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated">与WASM博士一起，我们可以:</h2><ul class=""><li id="18fb" class="mo mp iq kt b ku mq kx mr la ms le mt li mu lm mv mw mx my bi translated">编译其他高级语言代码并在浏览器中运行二进制文件！(太酷了😎).</li><li id="598a" class="mo mp iq kt b ku mz kx na la nb le nc li nd lm mv mw mx my bi translated">获得(几乎)原生性能。</li><li id="b2b1" class="mo mp iq kt b ku mz kx na la nb le nc li nd lm mv mw mx my bi translated">直接从JavaScript加载和执行WASM二进制文件，并与JavaScript代码交换数据。</li></ul><h2 id="0c9d" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated">为WASM而来，为铁锈而留</h2><p id="00ef" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ne lc ld le nf lg lh li ng lk ll lm ij bi translated">我可以运行一个“hello world”或其他基本示例，但是我有点想要学习另一种语言的机会(新的生态系统，新的世界！).</p><p id="2b17" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">学习一门新的语言会让你更好地掌握你的主要语言，因为你会停下来思考不同之处，此外，你会寻找熟悉的模式，这会让你变得更敏锐。</p><p id="9397" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我不得不选择C/C++或Rust，为什么我选择了<strong class="kt ir"> Rust </strong>？</p><p id="73ee" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我没有进行任何彻底的研究就选择了Rust，原因如下:</p><ol class=""><li id="68eb" class="mo mp iq kt b ku kv kx ky la nh le ni li nj lm nk mw mx my bi translated">它相当新，<strong class="kt ir"> new =闪亮的</strong>，并且应用了从旧语言和生态系统“错误”中吸取的经验教训，或者采用了良好的实践。(我真的很好奇)。</li><li id="e0e8" class="mo mp iq kt b ku mz kx na la nb le nc li nd lm nk mw mx my bi translated">它是由我非常欣赏的<strong class="kt ir"> Mozilla </strong>人创建的(他们与mdn docs一起做了一项了不起的工作，这个伟大的社区推动了有趣的开源项目，如<a class="ae ln" href="https://aframe.io/" rel="noopener ugc nofollow" target="_blank"> a-frame </a>、<a class="ae ln" href="https://github.com/servo" rel="noopener ugc nofollow" target="_blank"> servo </a>、<a class="ae ln" href="https://iot.mozilla.org/" rel="noopener ugc nofollow" target="_blank">mozillating</a>s等等..</li><li id="2b68" class="mo mp iq kt b ku mz kx na la nb le nc li nd lm nk mw mx my bi translated">它有一个很酷的名字！(我的直接内涵是Megadeth的专辑是《锈在和平中》..)</li><li id="3d5d" class="mo mp iq kt b ku mz kx na la nb le nc li nd lm nk mw mx my bi translated">快速谷歌搜索显示，它有一个“函数”的概念<strong class="kt ir">，</strong>函数<strong class="kt ir"> </strong>可以作为参数传递给其他函数，内置高阶函数(如地图，过滤器折叠)用于迭代，有选项和结果和类型等..而且默认是<strong class="kt ir">完全不可变</strong>(除非用“mut”)。</li><li id="df94" class="mo mp iq kt b ku mz kx na la nb le nc li nd lm nk mw mx my bi translated">我看到它有一个<strong class="kt ir">异步运行时</strong> <strong class="kt ir">支持</strong>，我喜欢使用非阻塞函数，承诺很有趣，异步await模式也很有趣..</li><li id="a465" class="mo mp iq kt b ku mz kx na la nb le nc li nd lm nk mw mx my bi translated">我看到它有一个很好的<strong class="kt ir">型系统</strong>。</li></ol><p id="c171" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我的原因更多的是“开发”驱动，而不是性能或效率(例如，内存安全，小二进制)驱动，我想要一种语言，它能让我以我喜欢的风格编写(函数式的，但不仅仅是函数式的，具有类型、异步能力等)..).</p><h2 id="9199" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated"><strong class="ak">我使用的学习资源:</strong></h2><p id="ea76" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ne lc ld le nf lg lh li ng lk ll lm ij bi translated">有一个很好的课程可以用复数形式观看，叫做:<a class="ae ln" href="https://www.pluralsight.com/courses/rust-fundamentals" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir">【铁锈基础】</strong> </a> <strong class="kt ir">，</strong>我也经常使用<a class="ae ln" href="https://doc.rust-lang.org/book/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir">官方文件</strong> </a> <strong class="kt ir"> </strong>..我真的认为他们做得很好。我只是希望我能像在MDN一样在那里度过我的时间:)</p><h2 id="136a" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated"><strong class="ak">开发环境设置</strong></h2><p id="1e5d" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ne lc ld le nf lg lh li ng lk ll lm ij bi translated">你需要安装rust工具<strong class="kt ir">编译器</strong>、<strong class="kt ir">包管理器</strong>、<strong class="kt ir">版本管理器</strong>等等..).遵循<a class="ae ln" href="https://www.rust-lang.org/tools/install" rel="noopener ugc nofollow" target="_blank">指令</a>。</p><p id="5a15" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">📝注意:</strong> <a class="ae ln" href="https://crates.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> Cargo </strong> </a>就像npm，<a class="ae ln" href="https://github.com/rust-lang/rustup/blob/master/README.md" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> rustup </strong> </a>就像nvm，<a class="ae ln" href="https://rustc-dev-guide.rust-lang.org/codegen.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> rustc </strong> </a>就是编译器，我不会说它像tsc因为它实际上是把代码编译成二进制而不是其他高级语言。</p><h2 id="5a2e" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated">回到WASM —启动概念验证</h2><p id="1a75" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ne lc ld le nf lg lh li ng lk ll lm ij bi translated"><a class="ae ln" href="https://rustwasm.github.io/docs" rel="noopener ugc nofollow" target="_blank">文档</a>真的非常适合深入研究。如果你想快速开始，请遵循<a class="ae ln" href="https://rustwasm.github.io/docs/book/game-of-life/setup.html" rel="noopener ugc nofollow" target="_blank">这本</a>快速手册，安装为Rust和WASM设计的令人敬畏的开发工具。</p><p id="4339" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">开始一个项目时你应该知道的事情:</strong></p><ul class=""><li id="7845" class="mo mp iq kt b ku kv kx ky la nh le ni li nj lm mv mw mx my bi translated"><a class="ae ln" href="https://crates.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir">板条箱</strong> </a>是你可能要使用的第三方<strong class="kt ir">依赖</strong>(像npm门户回购)。</li><li id="eb74" class="mo mp iq kt b ku mz kx na la nb le nc li nd lm mv mw mx my bi translated"><a class="ae ln" href="http://Cargo.toml" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> Cargo.toml </strong> </a>类似于package.json — <a class="ae ln" href="https://doc.rust-lang.org/cargo/reference/manifest.html" rel="noopener ugc nofollow" target="_blank">学习如何读取和编辑它</a>，并运行它的<a class="ae ln" href="https://doc.rust-lang.org/cargo/commands/cargo-install.html" rel="noopener ugc nofollow" target="_blank">命令</a>(新建、安装、发布等..)—顺便说一句，还有一个自动生成的货物锁。</li><li id="b0a3" class="mo mp iq kt b ku mz kx na la nb le nc li nd lm mv mw mx my bi translated">开发web应用程序时，Rust+WASM的相关<a class="ae ln" href="https://rustwasm.github.io/docs/book/reference/crates.html" rel="noopener ugc nofollow" target="_blank">板条箱</a>。</li></ul><p id="3753" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了启动概念验证，我按照<a class="ae ln" href="https://rustwasm.github.io/docs/book/reference/project-templates.html" rel="noopener ugc nofollow" target="_blank">这本</a>官方手册介绍了一个叫做<strong class="kt ir"> wasm-pack: </strong>的工具</p><blockquote class="nl"><p id="d09c" class="nm nn iq bd no np nq nr ns nt nu lm dk translated"><strong class="ak"> wasm-pack </strong>是您构建、测试和发布Rust生成的WebAssembly的一站式商店。</p></blockquote><p id="bd66" class="pw-post-body-paragraph kr ks iq kt b ku nv jr kw kx nw ju kz la nx lc ld le ny lg lh li nz lk ll lm ij bi translated">我在构建我的POC项目时使用了<strong class="kt ir"> wasm-pack </strong>，你可以点击我的POC repo <a class="ae ln" href="https://github.com/LironHazan/rust-in-peace" rel="noopener ugc nofollow" target="_blank">这里</a>和web demo <a class="ae ln" href="https://focused-booth-bb8cdc.netlify.com/" rel="noopener ugc nofollow" target="_blank">那里</a>。</p><p id="0c85" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于一个更“真实的生活使用”角+锈+ WASM概念检查<a class="ae ln" href="https://github.com/LironHazan/angular-rust-wasm" rel="noopener ugc nofollow" target="_blank">我的另一个例子</a>。</p><p id="2d40" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们回顾一下该项目的有趣部分，这将使我们了解它是如何工作的:</p><p id="dd90" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> Cargo.toml: </strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/cf24f3d63f7e203ec1e16fedde0dc766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HyUIHC3VOOOgYvGnhUEB4g.png"/></div></div></figure><ul class=""><li id="ce9d" class="mo mp iq kt b ku kv kx ky la nh le ni li nj lm mv mw mx my bi translated"><a class="ae ln" href="https://docs.rs/web-sys/0.3.4/web_sys/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir">web _ sys</strong></a>crate依赖项真的很有趣——它提供了一个<a class="ae ln" href="https://developer.mozilla.org/en-US/docs/Mozilla/WebIDL_bindings" rel="noopener ugc nofollow" target="_blank">绑定</a>给浏览器提供的所有API(据我从这里的阅读<a class="ae ln" href="https://developer.mozilla.org/en-US/docs/Mozilla/WebIDL_bindings" rel="noopener ugc nofollow" target="_blank">所理解的，反映了C++渲染引擎的代码)。</a></li><li id="c888" class="mo mp iq kt b ku mz kx na la nb le nc li nd lm mv mw mx my bi translated">我在开发app时交互的依赖项是:<code class="fe ob oc od oe b"><a class="ae ln" href="https://rustwasm.github.io/docs/wasm-bindgen/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir">wasm-bindgen</strong></a></code>，(Rust库和CLI工具，方便wasm模块和JavaScript的高层交互)。</li></ul><p id="3907" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://github.com/LironHazan/rust-in-peace/blob/master/src/lib.rs" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"/></a><strong class="kt ir">:</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="fb0d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意<code class="fe ob oc od oe b">#[wasm_bindgen]</code> <a class="ae ln" href="https://doc.rust-lang.org/reference/attributes.html" rel="noopener ugc nofollow" target="_blank">属性</a>的使用，拥有它将导致2个包装器的生成:</p><ul class=""><li id="3478" class="mo mp iq kt b ku kv kx ky la nh le ni li nj lm mv mw mx my bi translated">接受JS类型转换成wasm的JavaScript包装器。</li><li id="39ba" class="mo mp iq kt b ku mz kx na la nb le nc li nd lm mv mw mx my bi translated">Rust包装器接收wasm类型并转换为Rust类型。</li></ul><p id="df33" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你可以在<a class="ae ln" href="https://hacks.mozilla.org/2018/04/javascript-to-rust-and-back-again-a-wasm-bindgen-tale/" rel="noopener ugc nofollow" target="_blank">这篇不错的帖子</a>上阅读更多关于互动的内容。</p><p id="d9fc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">wasm-pack模板</strong></p><p id="0733" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">运行webpack构建将生成<strong class="kt ir"> pkg </strong>和<strong class="kt ir"> dist </strong>文件夹(webpack配置需要一个<strong class="kt ir">@ wasm-tool/wasm-pack-plugin</strong>来编译我们的Rusty代码并生成带有所有需要的模板的pkg)</p><p id="9f6a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们打开位于<strong class="kt ir"> pkg </strong>文件夹中的index.js，我们会看到以下内容:</p><pre class="kg kh ki kj gt oh oe oi oj aw ok bi"><span id="2ed2" class="lv lw iq oe b gy ol om l on oo"><strong class="oe ir">import </strong>* <strong class="oe ir">as </strong>wasm <strong class="oe ir">from './index_bg.wasm'</strong>;<br/><br/><em class="lr">/**<br/>*/<br/></em><strong class="oe ir">export function </strong><em class="lr">rust_in_peace</em>() {<br/>    wasm.rust_in_peace();<br/>}</span></pre><p id="addf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以看到wasm-pack如何生成一个JavaScript包装器来调用我们的Rusty函数，该函数是从wasm二进制文件导入的。激动人心:)</p><h2 id="2cf7" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated">未来阅读—前端生锈的框架</h2><p id="cedf" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ne lc ld le nf lg lh li ng lk ll lm ij bi translated">有许多生锈的开源项目，只要看看<a class="ae ln" href="https://github.com/rust-unofficial/awesome-rust" rel="noopener ugc nofollow" target="_blank">棒极了的</a>回购就知道了。</p><p id="deeb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">放大到前端，我们可以使用一个框架来开发一个“本地”Rust (WASM)应用程序，以使体验更快/更容易/更具可扩展性(就代码库和软件架构而言)。</p><p id="d5a6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我个人的目标是检验<a class="ae ln" href="https://github.com/yewstack/yew" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir">Yew</strong></a><strong class="kt ir">—</strong>(一个现代的<a class="ae ln" href="https://www.rust-lang.org/" rel="noopener ugc nofollow" target="_blank"> Rust </a>框架，用于使用<a class="ae ln" href="https://webassembly.org/" rel="noopener ugc nofollow" target="_blank"> WebAssembly </a>创建多线程前端web应用程序。)</p><p id="e6af" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">目前就这些，如果你想开始使用WASM+rust，我真的认为开始使用wasm-pack是最好的方式，并且<a class="ae ln" href="https://rustwasm.github.io/docs/wasm-pack/" rel="noopener ugc nofollow" target="_blank">文档</a>真的很棒。</p><p id="8c10" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我要感谢<a class="op oq ep" href="https://medium.com/u/355b1dfe86ae?source=post_page-----7365464868bf--------------------------------" rel="noopener" target="_blank"> Uri Shaked </a>为我审阅这篇文章:)</p><p id="b429" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">干杯🥂</p><p id="c103" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">利伦。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="or og l"/></div></figure></div></div>    
</body>
</html>