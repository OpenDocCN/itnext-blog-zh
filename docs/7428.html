<html>
<head>
<title>How to connect to TLS-enabled Oracle DB using SQL Developer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用SQL Developer连接到支持TLS的Oracle DB</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-connect-to-tls-enabled-oracle-db-using-sql-developer-500d3e748e86?source=collection_archive---------2-----------------------#2022-09-20">https://itnext.io/how-to-connect-to-tls-enabled-oracle-db-using-sql-developer-500d3e748e86?source=collection_archive---------2-----------------------#2022-09-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="1b47" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">目的</h1><p id="8d4b" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">记录Java应用程序(如SQL Developer)成功连接到Oracle数据库所需的步骤，Oracle数据库只允许TLS连接来保护传输中的数据。</p><p id="5acb" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">根据<a class="ae lj" href="https://csrc.nist.gov/publications/detail/sp/800-52/rev-2/final" rel="noopener ugc nofollow" target="_blank"> NIST特别出版物(SP)800–52修订版2，传输层安全(TLS)实施的选择、配置和使用指南</a>，您需要在数据库端进行TLS加密(用于传输中的数据)。</p><h1 id="6cba" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">所需的服务器端设置</h1><ul class=""><li id="5319" class="lp lq iq kn b ko kp ks kt kw lr la ls le lt li lu lv lw lx bi translated">Oracle数据库启用了TLS，查看<a class="ae lj" href="https://oracle-base.com/articles/misc/configure-tcpip-with-ssl-and-tls-for-database-connections" rel="noopener ugc nofollow" target="_blank">这篇博客</a>了解如何实现。</li><li id="e400" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">只有服务器向客户端验证自己的身份(这种设置)。</li><li id="15c3" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">监听器监听两个端口1521 (tcp)和端口6028(TCP)。</li></ul><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi md"><img src="../Images/fb34962a0376e77eed257a0120006da4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hfpx-4owZdTRvvF2Ffp5yg.png"/></div></div></figure><ul class=""><li id="4f1a" class="lp lq iq kn b ko lk ks ll kw mp la mq le mr li lu lv lw lx bi translated"><a class="ae lj" href="https://docs.oracle.com/cd/E11882_01/network.112/e10835/sqlnet.htm#i479724" rel="noopener ugc nofollow" target="_blank"> sqlnet.ora </a>具有允许TLS连接的适当配置。</li></ul><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="ms mt l"/></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">sqlnet.ora</figcaption></figure><ul class=""><li id="2d85" class="lp lq iq kn b ko lk ks ll kw mp la mq le mr li lu lv lw lx bi translated">除TLS之外，您还可以使用<a class="ae lj" href="https://docs.oracle.com/en/database/oracle/oracle-database/19/dbseg/configuring-network-data-encryption-and-integrity.html" rel="noopener ugc nofollow" target="_blank">本地网络加密</a>。<em class="my"> SQLNET。IGNORE _ ANO _ ENCRYPTION _ FOR _ TCPS = TRUE</em>就是为了这个目的。</li><li id="59a3" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">在本例中，我使用了一个DN为CN=dbhost.mydomain.local的服务器证书，该证书被导入到TNS wallet (ewallet.p12)中，并且该wallet启用了自动登录。</li><li id="0057" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">服务器证书是在AWS证书管理器(ACM)中创建的。ACM有一个特性，允许任何组织快速<a class="ae lj" href="https://docs.aws.amazon.com/acm-pca/latest/userguide/create-CA.html" rel="noopener ugc nofollow" target="_blank">创建一个可用于生成证书的托管私有CA </a>。</li><li id="75dd" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">您将获得root.pem (CA证书)、server.pem(服务器证书)和server.key(加密的私钥)。</li><li id="cfa9" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">您可以使用<em class="my"> openssl pkcs12 </em>创建一个<a class="ae lj" href="https://docs.oracle.com/cd/E92519_02/pt856pbr3/eng/pt/tsvt/task_SettingUpOracleWalletUsingOpenSSL.html?pli=ul_d96e224_tsvt" rel="noopener ugc nofollow" target="_blank">pkcs12 wallet(Oracle wallet)</a>用于服务器端。</li><li id="b4cc" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">你可以使用<em class="my"> openssl </em>或<em class="my"> keytool </em>来创建<a class="ae lj" href="https://docs.oracle.com/cd/E19509-01/820-3503/ggfen/index.html" rel="noopener ugc nofollow" target="_blank"> JKS </a>信任库，它可以在任何基于Java的客户端应用上使用。</li></ul><h1 id="1e1e" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">SQL开发人员方面的步骤</h1><ul class=""><li id="856f" class="lp lq iq kn b ko kp ks kt kw lr la ls le lt li lu lv lw lx bi translated"><strong class="kn ir">由于SQL Developer是一个Java应用程序，您可以使用</strong> <a class="ae lj" href="https://blogs.oracle.com/developers/post/ssl-connection-to-oracle-db-using-jdbc-tlsv12-jks-or-oracle-wallets-122-and-lower#JKS" rel="noopener ugc nofollow" target="_blank"> <strong class="kn ir"> JKS进行TLS连接到数据库</strong> </a> <strong class="kn ir">并且这些步骤可以被任何Java应用程序用于TLS连接到Oracle数据库。</strong></li><li id="9ef4" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">找到sqldeveloper.conf文件，并将下面几行添加到该文件中。</li></ul><pre class="me mf mg mh gt mz na nb nc aw nd bi"><span id="d884" class="ne jo iq na b gy nf ng l nh ni">AddVMOption -Djavax.net.ssl.trustStore=&lt;Path to your truststore.jks with CA certificate&gt;<br/>AddVMOption -Djavax.net.ssl.trustStoreType=JKS<br/>AddVMOption -Djavax.net.ssl.trustStorePassword=&lt;your keystore password&gt;</span></pre><ul class=""><li id="d566" class="lp lq iq kn b ko lk ks ll kw mp la mq le mr li lu lv lw lx bi translated">重新启动SQL Developer。</li><li id="1e00" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">添加一个新的连接，并选择如下选项</li></ul><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nj"><img src="../Images/a3f1aaded1c8a98e6a39848054d83934.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aC3jYxHTccj3By0OsxsEZw.png"/></div></div></figure><ul class=""><li id="fade" class="lp lq iq kn b ko lk ks ll kw mp la mq le mr li lu lv lw lx bi translated">自定义JDBC URL</li></ul><pre class="me mf mg mh gt mz na nb nc aw nd bi"><span id="0be5" class="ne jo iq na b gy nf ng l nh ni">jdbc:oracle:thin:@(DESCRIPTION= (ADDRESS=<br/> (PROTOCOL=TCPS)(PORT=6028)(HOST=db-prim.mydomain.local))<br/> (CONNECT_DATA=(SERVICE_NAME=CONPPRDB_PRIM))<br/> (SECURITY=(ssl_server_cert_dn=”CN=dbhost.mydomain.local”)))</span></pre><ul class=""><li id="5d7a" class="lp lq iq kn b ko lk ks ll kw mp la mq le mr li lu lv lw lx bi translated">注意<em class="my">主机</em>和<em class="my"> ssl_server_cert_dn </em>不需要匹配，但是<em class="my"> ssl_server_cert_dn </em>应该与服务器证书中的相同，因为您在sqlnet.ora中使用了<em class="my">SSL _ SERVER _ DN _ MATCH = TRUE</em></li></ul><h1 id="3c55" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">测试数据库连接</h1><ul class=""><li id="6518" class="lp lq iq kn b ko kp ks kt kw lr la ls le lt li lu lv lw lx bi translated">使用来自SQL Developer的连接连接到数据库</li><li id="af5d" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">运行以下查询进行验证</li></ul><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nk"><img src="../Images/cb74434c7f376681475d3192604f8e3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FW8aCegut8vxHbZrW1Yu9g.png"/></div></div></figure><p id="47f8" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><strong class="kn ir">如果您有几个数据库拥有由不同根ca颁发的各自的服务器证书，您可以将其他根ca添加到同一个JKS信任库。</strong></p><h1 id="1c80" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">参考</h1><div class="nl nm gp gr nn no"><a href="https://blogs.oracle.com/developers/post/ssl-connection-to-oracle-db-using-jdbc-tlsv12-jks-or-oracle-wallets-122-and-lower" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">使用JDBC、TLSv1.2、JKS或Oracle wallet(12.2及更低版本)与Oracle数据库的SSL连接</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">SSL简介Oracle数据库产品在其标准版(从12c开始)中支持SSL/TLS连接…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">blogs.oracle.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc mn no"/></div></div></a></div></div><div class="ab cl od oe hu of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="ij ik il im in"><p id="330f" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">请查看我上一篇关于<a class="ae lj" rel="noopener ugc nofollow" target="_blank" href="/automating-db-client-failover-using-azure-function-app-6ed375ab5666"> <strong class="kn ir">使用Azure Function App </strong> </a> <strong class="kn ir">自动化DB客户端故障转移的博客。</strong></p><p id="84b7" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">请阅读我的其他文章，并分享您的反馈。如果你喜欢分享的内容，请点赞、评论并订阅新文章。</p></div></div>    
</body>
</html>