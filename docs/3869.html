<html>
<head>
<title>Azure DevOps Publish Artifacts for ASP.NET Core</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure DevOps为ASP.NET核心发布工件</h1>
<blockquote>原文：<a href="https://itnext.io/azure-devops-publish-artifacts-for-asp-net-core-ee85169deb35?source=collection_archive---------2-----------------------#2020-03-16">https://itnext.io/azure-devops-publish-artifacts-for-asp-net-core-ee85169deb35?source=collection_archive---------2-----------------------#2020-03-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="33ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章将建立在我们在前几篇文章中创建的Azure DevOps项目的基础上，并让构建管道到达你拥有应用程序二进制文件的地方。如果你刚刚加入这个系列，看看之前的文章。</p><p id="24c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://elanderson.net/2020/02/getting-started-with-azure-devops/" rel="noopener ugc nofollow" target="_blank">Azure DevOps入门</a> <br/> <a class="ae kl" href="https://elanderson.net/2020/03/pipeline-creation-in-azure-devops/" rel="noopener ugc nofollow" target="_blank">在Azure devo PS中创建管道</a></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/42dc08a4fc46feeec3439327cc668950.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/0*BsruIe_TN-picvGm.png"/></div></figure><h2 id="4715" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">编辑管道</h2><p id="7588" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">首先，我们需要回到我们正在处理的管道。从项目菜单中选择<strong class="jp ir">管道</strong>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/1617a3726730970b92657ca3b487ccf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:518/format:webp/0*6WUW3pktPHspTMAx.png"/></div></figure><p id="46eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将使您进入一个页面，其中列出了您最近运行的管道。如果您没有看到您的管道列表，您可能需要单击页面顶部附近的“全部”选项。由于我们在这个项目中只有一个管道，我们可以使用省略号打开一个上下文菜单，然后单击<strong class="jp ir"> Edit </strong>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lt"><img src="../Images/1f078198db8a8e5f898a0071da76bcee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*K1mxxIIbfZ2h--g1.png"/></div></div></figure><h2 id="2084" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">发布应用程序</h2><p id="9cbf" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">此时，我们管道的YAML如下所示。</p><pre class="kn ko kp kq gt ly lz ma mb aw mc bi"><span id="6a2e" class="ku kv iq lz b gy md me l mf mg">trigger:<br/>- master<br/><br/>pool:<br/>  vmImage: 'ubuntu-latest'<br/><br/>variables:<br/>  buildConfiguration: 'Release'<br/><br/>steps:<br/>- task: UseDotNet@2<br/>  inputs:<br/>    packageType: 'sdk'<br/>    version: '3.1.x'<br/><br/>- script: dotnet build --configuration $(buildConfiguration)<br/>  displayName: 'dotnet build $(buildConfiguration)'</span></pre><p id="cadf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">管道目前会告诉我们所包含的项目是否构建，但不会向我们提供构建的结果。使用右侧的任务面板搜索<strong class="jp ir">。NET Core </strong>任务然后点击产生的任务。这是您希望用来调用任何。NET CLI命令。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mh"><img src="../Images/74bf156b568362f6400a9c959638e321.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*okRrKfQLmKDv5Oow.png"/></div></div></figure><p id="0fd4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<strong class="jp ir">命令</strong>的下拉菜单，选择<strong class="jp ir">发布</strong>。对于这个示例，其余设置的默认值就可以了。最后，点击<strong class="jp ir">添加</strong>将任务添加到YAML文件中。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mi"><img src="../Images/d1a138219bd63652d22af9a5306fa37f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*I--dXky9c7I3sBII.png"/></div></div></figure><p id="af20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是由此产生的YAML。</p><pre class="kn ko kp kq gt ly lz ma mb aw mc bi"><span id="9f86" class="ku kv iq lz b gy md me l mf mg">trigger:<br/>- master<br/><br/>pool:<br/>  vmImage: 'ubuntu-latest'<br/><br/>variables:<br/>  buildConfiguration: 'Release'<br/><br/>steps:<br/>- task: UseDotNet@2<br/>  inputs:<br/>    packageType: 'sdk'<br/>    version: '3.1.x'<br/><br/>- script: dotnet build --configuration $(buildConfiguration)<br/>  displayName: 'dotnet build $(buildConfiguration)'<br/>  <br/>- task: DotNetCoreCLI@2<br/>  inputs:<br/>    command: 'publish'<br/>    publishWebProjects: true</span></pre><p id="ca1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们继续之前，我想指出YAML编辑器中任务上方的<strong class="jp ir">设置</strong>链接。单击<strong class="jp ir">设置</strong>会将该任务加载到屏幕右侧的任务面板中，您可以在其中进行更改，然后如果您点击“添加”按钮，它会用一个新任务替换您现有的任务，并选择新选项。注意不要改变YAML编辑器中的选择，因为添加按钮只是替换选定的文本，而不是记住你点击设置的任务。完成后，点击<strong class="jp ir">保存</strong>按钮，完成提交过程。完成后，点击<strong class="jp ir">运行</strong>按钮执行流水线。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mj"><img src="../Images/dee522146e2373349f9bb6f0876917a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xVcKkBWRsVf7OSiv.png"/></div></div></figure><h2 id="4aad" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">发布构建工件</h2><p id="b1e6" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">管道运行应该会成功，但是我们仍然没有任何可以使用的文件。了解管道中可用的变量以及如何使用它们是Azure管道入门最难的部分之一。对于我们的例子，我们试图获得由上面的发布步骤创建的两个zip文件，这意味着我们的管道将需要发布工件以使文件可用。我们将使用builtin <strong class="jp ir"> Build调整上面的publish命令和一个输出目录。ArtifactStagingDirectory </strong>变量。以下是修改后的完整任务。</p><pre class="kn ko kp kq gt ly lz ma mb aw mc bi"><span id="4d0a" class="ku kv iq lz b gy md me l mf mg">- task: DotNetCoreCLI@2<br/>  inputs:<br/>    command: 'publish'<br/>    publishWebProjects: true<br/>    arguments: '--configuration $(buildConfiguration) --output $(Build.ArtifactStagingDirectory)'</span></pre><p id="62a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于工件暂存目录中的文件，我们需要使用发布管道工件任务来发布这些文件。下面是将工件暂存目录发布到管道的完整任务。</p><pre class="kn ko kp kq gt ly lz ma mb aw mc bi"><span id="49a8" class="ku kv iq lz b gy md me l mf mg">- task: PublishPipelineArtifact@1<br/>  inputs:<br/>    targetPath: '$(Build.ArtifactStagingDirectory)'<br/>    publishLocation: 'pipeline'</span></pre><p id="095a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为参考，以下是包含上述所有变更的管道的完整YAML。</p><pre class="kn ko kp kq gt ly lz ma mb aw mc bi"><span id="b077" class="ku kv iq lz b gy md me l mf mg">trigger:<br/>- master<br/><br/>pool:<br/>  vmImage: 'ubuntu-latest'<br/><br/>variables:<br/>  buildConfiguration: 'Release'<br/><br/>steps:<br/>- task: UseDotNet@2<br/>  inputs:<br/>    packageType: 'sdk'<br/>    version: '3.1.x'<br/><br/>- script: dotnet build --configuration $(buildConfiguration)<br/>  displayName: 'dotnet build $(buildConfiguration)'<br/>  <br/>- task: DotNetCoreCLI@2<br/>  inputs:<br/>    command: 'publish'<br/>    publishWebProjects: true<br/>    arguments: '--configuration $(buildConfiguration) --output $(Build.ArtifactStagingDirectory)'<br/><br/>- task: PublishPipelineArtifact@1<br/>  inputs:<br/>    targetPath: '$(Build.ArtifactStagingDirectory)'<br/>    publishLocation: 'pipeline'</span></pre><p id="96c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">保存并运行管道。当管道完成时，在结果页面上，您将看到1个发布的工件。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mk"><img src="../Images/0f8acb2ae6dd8131d11077d42a25f1c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZeNKIPsYonthCCZT.png"/></div></div></figure><p id="e3e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击<strong class="jp ir"> 1出版</strong>，它会带你到一个列出文物的页面。如果您将鼠标悬停在任一行上，您将看到下载相关文件的选项。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/c5577f44992d199e537b406946750ad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/0*vAYGoqrhgC-On0Uo.png"/></div></figure><h2 id="e431" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">快速提示</h2><p id="0e2e" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">正如我在上面所说的，要弄清楚什么目录在哪里是一件痛苦的事情。如果您需要查看哪些文件在哪里，您可以使用下面的发布任务，通过发布管道的整个工作区来输出管道正在使用的全套文件。这在过去帮助我确定了自己的方向。</p><pre class="kn ko kp kq gt ly lz ma mb aw mc bi"><span id="9b02" class="ku kv iq lz b gy md me l mf mg">- task: PublishPipelineArtifact@1<br/>  inputs:<br/>    targetPath: '$(Pipeline.Workspace)'<br/>    publishLocation: 'pipeline'</span></pre><h2 id="0095" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">包扎</h2><p id="92f0" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">我们的管道现在已经有了可以部署的文件。希望这给你自己的构建管道一个良好的开端。Azure Pipelines是一个巨大的主题，这是一个非常基础的构建，所以请关注未来关于这个主题的更多帖子。</p></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><p id="4c6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mt">原载于</em><a class="ae kl" href="https://elanderson.net/2020/03/azure-devops-publish-asp-net-core/" rel="noopener ugc nofollow" target="_blank"><em class="mt"/></a><em class="mt">。</em></p></div></div>    
</body>
</html>