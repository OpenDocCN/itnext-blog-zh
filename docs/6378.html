<html>
<head>
<title>Isotope for Istio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Istio同位素</h1>
<blockquote>原文：<a href="https://itnext.io/isotope-for-istio-41dd3c218996?source=collection_archive---------2-----------------------#2021-11-01">https://itnext.io/isotope-for-istio-41dd3c218996?source=collection_archive---------2-----------------------#2021-11-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ac3b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用基于可定制服务图的拓扑测试Istio</h2></div><p id="0320" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Isotope是Istio Topology Performance的缩写，是一种工具，它利用定制服务二进制文件以可定制的服务图方式部署Istio，并使用Fortio作为负载生成器来测量其性能。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/3ee148b7c918b3519591dbd023d54b58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gQovhjR3wI7tyi4NqGEtjg.jpeg"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">具有8个服务和至少2个副本的同位素部署(<a class="ae lu" href="https://github.com/istio/tools/tree/release-1.9/perf/load" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="fa48" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要了解Istio在接近生产类型部署的环境中的性能，需要使用一组特定的调用序列创建多个服务，同时使用副本确保这些服务的高可用性。Istio community发布了这个工具，以便通过服务之间的可定制调用序列来自动部署多个服务，每个服务返回定制的有效负载大小(1 MB或10 MB等)。)利用虚拟服务二进制。</p><h1 id="fbc9" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">亮点或功能:</h1><ul class=""><li id="ad90" class="mn mo it kk b kl mp ko mq kr mr kv ms kz mt ld mu mv mw mx bi translated">容器可以部署在主节点和工作节点上</li><li id="18df" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">Isotope使用mock_service容器，该容器又包含isotope_service二进制文件(可在/usr/local/bin中找到)</li><li id="fdec" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">同位素服务是一个简单的http服务器，它遵循来自YAML文件的指令并公开普罗米修斯度量</li><li id="f10f" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">的用法。/isotopic _ service:max-idle-connections-per-host int，这是每台主机保持打开的最大TCP连接数</li><li id="9690" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">提供的“测试运行程序”可以帮助在GKE集群上部署服务图</li><li id="4889" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">提供了一组具有多达1000个服务/5000个端点的示例拓扑，以链接多个服务，从而以树调用顺序部署服务</li></ul><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/ddf111a9a8c194f1859a6ccad0b49bdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*bDhR93ksWXVifZfnujC04A.jpeg"/></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">带有特定调用图的示例服务图(<a class="ae lu" href="https://github.com/istio/tools/tree/master/isotope" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="cf58" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Isotope通过将各种指标暴露给一个可以被Prometheus收集的端点来帮助提供各种服务指标。Prometheus端点可以获取的指标很少:</p><ul class=""><li id="2073" class="mn mo it kk b kl km ko kp kr ne kv nf kz ng ld mu mv mw mx bi translated">` service _ incoming _ requests _ total`—此服务接收的请求的计数器</li><li id="7834" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">` service _ outgoing _ requests _ total`—发送到其他服务的请求的计数器</li><li id="d2e8" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">` service _ outgoing _ request _ size`—发送到其他服务的请求大小的直方图</li><li id="5413" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">` service _ request _ duration _ seconds`—从“收到请求”到“发送响应”的持续时间直方图</li><li id="35d3" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">` service_response_size` —此服务发送的响应大小的直方图</li></ul><p id="5035" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是Isotope提供的调谐或定制选项列表:</p><ul class=""><li id="66bb" class="mn mo it kk b kl km ko kp kr ne kv nf kz ng ld mu mv mw mx bi translated">HTTP 1.1或HTTP 2</li><li id="19ac" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">服务计数和名称</li><li id="d912" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">普罗米修斯——对还是错</li><li id="4a08" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">mTLS —对还是错</li><li id="a2fd" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">多集群配置-对或错</li><li id="9217" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">入口URL</li><li id="8c6f" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">探测器:活跃度、复杂性和预定义性</li><li id="4102" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">Fortio客户端选项:连接，输入QPS，大小，运行持续时间</li><li id="c929" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">副本数量</li></ul><p id="14af" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当同位素部署在Kubernetes集群之上时，部署以下容器:</p><ul class=""><li id="9861" class="mn mo it kk b kl km ko kp kr ne kv nf kz ng ld mu mv mw mx bi translated">不良健康容器</li><li id="7ed1" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">Istio应用程序容器:检查kube-api准备情况</li><li id="5f12" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">配置更改容器:部署时没有sidecar代理，包含设置Kubernetes集群的hyperKube容器映像</li><li id="78d5" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">Fortio客户端:没有sidecar代理的设置，称为客户端容器，并寻找一个URL来发送流量</li><li id="6313" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">部署scaler容器:拥有kubectl映像，pod部署并运行到完成，最终状态为“completed”</li><li id="004d" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">服务图容器:自动调用Istio和Envoy代理，sidecar被注入每个容器，除了部署容器</li></ul><h1 id="07c5" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">调试帮助</h1><p id="6270" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr nh kt ku kv ni kx ky kz nj lb lc ld im bi translated">如果您正在使用同位素，最有可能的是您正在寻找规模测试您的Istio部署。这里列出了一些有助于我更好地理解部署的命令。</p><h2 id="5393" class="nk lw it bd lx nl nm dn mb nn no dp mf kr np nq mh kv nr ns mj kz nt nu ml nv bi translated">你怎样才能看到容器使用的资源</h2><p id="5ea9" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr nh kt ku kv ni kx ky kz nj lb lc ld im bi translated">此命令提供被安排为尽力而为的pod的内存使用情况:</p><ul class=""><li id="2c1d" class="mn mo it kk b kl km ko kp kr ne kv nf kz ng ld mu mv mw mx bi translated">cat/sys/fs/c group/memory/kube pods . slice/kube pods-best effort . slice/kube pods-best effort-pod 5 FB 73 ff 3 _ 4fd 6 _ 46ca _ be95 _ 0 AFC 78 DC 17 a 8 . slice/memory . kmem . usage _ in _ bytes</li></ul><p id="d9cb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此命令提供被安排为可突发的pod的内存使用情况:</p><ul class=""><li id="15aa" class="mn mo it kk b kl km ko kp kr ne kv nf kz ng ld mu mv mw mx bi translated">cat/sys/fs/c group/memory/kube pods . slice/kube pods-burst able . slice/kube pods-burst able-pod 181 ac4b 2 _ 3d b5 _ 48f 7 _ 8b 58 _ 14 CDA 6 c 4204 f . slice/memory . usage _ in _ bytes</li></ul><h2 id="ac39" class="nk lw it bd lx nl nm dn mb nn no dp mf kr np nq mh kv nr ns mj kz nt nu ml nv bi translated">如何获取服务中的pod列表:</h2><ul class=""><li id="dfb7" class="mn mo it kk b kl mp ko mq kr mr kv ms kz mt ld mu mv mw mx bi translated">$ ku bectl get pods-n service-graph 00-selector = " app = SVC 00–0–8 "-output = wide</li><li id="3f2f" class="mn mo it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">选择器可以通过kubectl describe svc servicename找到</li></ul><h2 id="1868" class="nk lw it bd lx nl nm dn mb nn no dp mf kr np nq mh kv nr ns mj kz nt nu ml nv bi translated">如何登录到模拟服务容器:</h2><ul class=""><li id="7a51" class="mn mo it kk b kl mp ko mq kr mr kv ms kz mt ld mu mv mw mx bi translated">ku bectl exec-I-t-n service-graph 00 SVC 00–0–7-BCB 549 fdb-QQ DCD-容器模拟服务-sh</li></ul><p id="c659" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意，在一个16G内存和10个vCPUs的虚拟机中使用默认设置运行isotope，由于缺乏资源，isotope无法安装。所以确保你提供更多的资源。</p></div></div>    
</body>
</html>