<html>
<head>
<title>Next.js Export w/ a coupled express/apollo server.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Next.js导出带有耦合的express/apollo服务器。</h1>
<blockquote>原文：<a href="https://itnext.io/next-js-export-w-a-coupled-express-apollo-server-a7a4b4bc4f25?source=collection_archive---------2-----------------------#2018-11-28">https://itnext.io/next-js-export-w-a-coupled-express-apollo-server-a7a4b4bc4f25?source=collection_archive---------2-----------------------#2018-11-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f237" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我最近喜欢使用的典型堆栈是Next.js，带有一个定制的express服务器，该服务器中有一个Apollo GraphQL层，这样我就可以向同一个服务器发出请求。</p><p id="71e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这意味着该应用高度互联，微服务的概念已经过时。不管怎么说，总算摆脱了——它们增加了成本。</p><p id="114f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基线服务器是这样的</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="kq kr l"/></div></figure><p id="5bd8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">阿波罗服务器看起来像这样:</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="kq kr l"/></div></figure><p id="83ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中类型、上下文等在其他地方定义，就像普通的GraphQL设置一样。不需要在这里介绍。因此，我们的Next.js应用程序从这个服务器上消费数据，然后Next通过Apollo客户端进行各种魔法使其同构。</p><p id="3d55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，为了在导出过程中实际使用这些数据，只需要一些非常基本的脚本:</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="kq kr l"/></div></figure><p id="0aa5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并且在package.json中，您会想要使用<code class="fe ks kt ku kv b">ts-node export.ts</code>。它在做什么应该很明显:</p><ul class=""><li id="bdc4" class="kw kx iq jp b jq jr ju jv jy ky kc kz kg la kk lb lc ld le bi translated">启动一个准系统express服务器。</li><li id="0263" class="kw kx iq jp b jq lf ju lg jy lh kc li kg lj kk lb lc ld le bi translated">连接Apollo服务器链接</li><li id="cb18" class="kw kx iq jp b jq lf ju lg jy lh kc li kg lj kk lb lc ld le bi translated">开始<code class="fe ks kt ku kv b">next export</code>构建过程</li><li id="dd67" class="kw kx iq jp b jq lf ju lg jy lh kc li kg lj kk lb lc ld le bi translated">完成后，它会清理并关闭服务器</li></ul><p id="3bde" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当服务器启动(在端口3k上)时，我们的客户端链接将使用next用来构建导出的数据。</p><p id="61b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为参考，<a class="ae lk" href="https://gist.github.com/OutThisLife/587f6fc89f72fc3345b1d44880c8ae70" rel="noopener ugc nofollow" target="_blank">这里是我通常为Next.js </a>设置的apollo客户端。</p></div></div>    
</body>
</html>