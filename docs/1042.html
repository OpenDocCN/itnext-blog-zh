<html>
<head>
<title>Remove state from a Form component and allow Redux-Form to handle it</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从表单组件中移除状态，并允许Redux-Form处理它</h1>
<blockquote>原文：<a href="https://itnext.io/remove-state-from-a-form-component-and-allow-redux-form-to-handle-it-b702fe75b7b5?source=collection_archive---------6-----------------------#2018-07-10">https://itnext.io/remove-state-from-a-form-component-and-allow-redux-form-to-handle-it-b702fe75b7b5?source=collection_archive---------6-----------------------#2018-07-10</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><figure class="gm go jo jp jq jr"><div class="bz fq l di"><div class="js jt l"/></div></figure><p id="d746" class="pw-post-body-paragraph ju jv ir jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ik bi translated">当我在Redux应用程序中使用React form组件来控制它自己的本地状态时，我可以感觉到干草叉正在变尖。去纯粹主义者那里，这不是惯例吗？你要么允许Redux的商店管理你的应用程序的整个状态，或者你根本没有！没有中间地带。对吗？</p><p id="f036" class="pw-post-body-paragraph ju jv ir jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ik bi translated">这正是我在决定如何处理组件状态时所处的困境。我还不是100%确定我需要在我的应用程序状态中包含什么。所以我开始让它保持独立。这有助于防止我不得不写不必要的动作，减少，然后担心回去，改变或删除的东西在未来。</p><p id="d015" class="pw-post-body-paragraph ju jv ir jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ik bi translated">让我先给你看看我想出来的，然后我们可以解决我们的Redux问题。</p><pre class="ks kt ku kv gu kw kx ky kz aw la bi"><span id="1c70" class="lb lc ir kx b gz ld le l lf lg">import React, { Component } from 'react';<br/>import { Form, Message, Modal } from 'semantic-ui-react';<br/>import ModalPlayerButtons from './ModalPlayerButtons';<br/>import { connect } from 'react-redux';<br/>import { bindActionCreators } from 'redux';<br/>import { currentPlayer } from '../actions';</span><span id="eb2c" class="lb lc ir kx b gz lh le l lf lg">class QuestionModalClue extends Component {<br/>  constructor(props) {<br/>    super(props);</span><span id="53d8" class="lb lc ir kx b gz lh le l lf lg">this.state = {<br/>      disabled: true,<br/>      hidden: true,<br/>      correct: false,<br/>      value: ''<br/>    }<br/>    this.playersAnswer = this.playersAnswer.bind(this);<br/>    this.handleChange = this.handleChange.bind(this);<br/>    this.handleSubmit = this.handleSubmit.bind(this);<br/>  }<br/> <br/> handleChange(e) {<br/>    this.setState({<br/>      value: e.target.value<br/>    });<br/>  }</span><span id="dd6a" class="lb lc ir kx b gz lh le l lf lg">handleSubmit(e) {<br/>    e.preventDefault();<br/>    this.setState({<br/>      hidden: false,<br/>      value: ''<br/>    })<br/>    if (this.state.value.toLowerCase() === this.props.clue.answer.toLowerCase()) {<br/>      this.setState({<br/>        correct: true<br/>      })<br/>    }<br/>    this.setState({<br/>      disabled: true<br/>    })<br/>  }</span><span id="a6d3" class="lb lc ir kx b gz lh le l lf lg">playersAnswer = (e) =&gt; {<br/>    let player = e.currentTarget.textContent;<br/>    this.props.currentPlayer(player);<br/>    this.setState({<br/>      disabled: false<br/>    })<br/>  }</span><span id="64ea" class="lb lc ir kx b gz lh le l lf lg">render() {<br/>    return (<br/>      &lt;Modal <br/>        open={this.props.modalOpen}<br/>        centered={true}<br/>        size='fullscreen' <br/>        dimmer='blurring'<br/>        style={{ 'textAlign': 'center', 'marginTop': '20px', 'backgroundColor': '#2185d0' }} <br/>      &gt;<br/>        &lt;Modal.Content<br/>          style={{ 'backgroundColor': '#2185d0', 'color': '#fff' }}<br/>        &gt;<br/>          {this.props.clue !== undefined &amp;&amp;<br/>            &lt;Modal.Header<br/>              as='h1'<br/>              onClick={this.props.test}      <br/>            &gt;<br/>              {this.props.clue.description}<br/>            &lt;/Modal.Header&gt;<br/>          }<br/>        &lt;/Modal.Content&gt;<br/>        &lt;ModalPlayerButtons playersAnswer={this.playersAnswer} /&gt;<br/>      <br/>        &lt;Form<br/>          as='form'<br/>          size='massive'<br/>          onSubmit={this.handleSubmit}<br/>        &gt;<br/>          &lt;Form.Field width={6} style={{ 'marginLeft': 'auto', 'marginRight': 'auto', 'marginTop': '20px', 'marginBottom': '10px' }}<br/>            disabled={this.state.disabled}<br/>          &gt;<br/>            &lt;label style={{'color': 'white'}}&gt;Player's Answer&lt;/label&gt;<br/>            &lt;Form.Input <br/>              type="text"<br/>              placeholder="What is..."<br/>              value={this.state.value}<br/>              onChange={this.handleChange}<br/>            /&gt;<br/>          &lt;/Form.Field&gt;<br/>          &lt;Form.Field<br/>            width={6}<br/>            style={{ 'marginLeft': 'auto', 'marginRight': 'auto', 'marginTop': '20px', 'marginBottom': '10px' }}<br/>          &gt;<br/>          {<br/>            this.state.correct ? (<br/>              &lt;Message<br/>                hidden={this.state.hidden}<br/>                size="massive"<br/>                color="green"<br/>                header="Correct Answer"<br/>                content="Current score plus 200"<br/>              /&gt;<br/>            ) : (<br/>              &lt;Message<br/>                hidden={this.state.hidden}<br/>                size="massive"<br/>                color="red"<br/>                header="Incorrect Answer"<br/>                content="Current score minus 200"<br/>              /&gt;<br/>            )<br/>          }<br/>          &lt;/Form.Field&gt;<br/>        &lt;/Form&gt;<br/>      &lt;/Modal&gt;<br/>    )<br/>  }<br/>}</span><span id="81fa" class="lb lc ir kx b gz lh le l lf lg">const mapDispatchToProps = dispatch =&gt; {<br/>  return bindActionCreators({<br/>    currentPlayer<br/>  }, dispatch);  <br/>}<br/>export default connect(null, mapDispatchToProps)(QuestionModalClue);</span></pre><p id="da30" class="pw-post-body-paragraph ju jv ir jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ik bi translated">更好的是，也可能更糟的是，我同时还连接到了我的组件中的Redux的store。我们有一些功能只是控制状态，其他的控制状态和来自Redux的道具。到处都是。在这个组件中，我有两个不同的东西来控制我的状态。谈谈调试和效率的噩梦。我能感觉到暴民在追杀我。</p><p id="a1ab" class="pw-post-body-paragraph ju jv ir jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ik bi translated">那我该怎么办呢？看着状态中的不同项目，我不想担心在Redux中控制它们，并手动编码每个单独的项目。我订阅编码员都很懒，那就找点东西替我们管管这些东西吧。但我必须指出这一点，我也坚信知道幕后发生了什么。所以要知道你的工具在为你做什么。</p><p id="33c2" class="pw-post-body-paragraph ju jv ir jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ik bi translated">这让我想到了这个博客的标题。让我们来谈谈“还原形式”。Redux-Form使状态变得简单。Redux-Form将自己描述为在Redux 中管理表单状态的最佳方式。</p><p id="a4cf" class="pw-post-body-paragraph ju jv ir jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ik bi translated">这个博客并不是设置Redux-Form的完整教程。但是他们在他们的网站上给出了一个很好的教程，将Redux-Form包含在一个项目中。</p><p id="e450" class="pw-post-body-paragraph ju jv ir jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ik bi translated">快速地，如果你已经有一个制作好的项目，只需要用<code class="fe lj lk ll kx b">yarn add redux-form</code>包含Redux-Form。如果你没有注意到，我将使用<code class="fe lj lk ll kx b">yarn</code>而不是<code class="fe lj lk ll kx b">npm</code>。按照说明将<code class="fe lj lk ll kx b">redux-form</code>连接到您的redux商店。然后只需遵循他们的api来包含您的必要项目。</p><p id="fec1" class="pw-post-body-paragraph ju jv ir jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ik bi translated">所以让我们再来看看同一个组件，但是这次允许<code class="fe lj lk ll kx b">redux-form</code>控制我以前的状态。</p><pre class="ks kt ku kv gu kw kx ky kz aw la bi"><span id="1f34" class="lb lc ir kx b gz ld le l lf lg">import React, { Component } from 'react';<br/>import { Form, Message, Modal } from 'semantic-ui-react';<br/>import ModalPlayerButtons from './ModalPlayerButtons';<br/>import { connect } from 'react-redux';<br/>import { bindActionCreators } from 'redux';<br/>import { currentPlayer } from '../actions';<br/>import { Field, reduxForm, formValueSelector } from 'redux-form';</span><span id="7460" class="lb lc ir kx b gz lh le l lf lg">class QuestionModalClue extends Component {<br/>  constructor(props) {<br/>    super(props);</span><span id="bafa" class="lb lc ir kx b gz lh le l lf lg">    // variable names to be assigned depending on result of answer<br/>    this.correctAnswer;<br/>    this.incorrectAnswer;</span><span id="3ad9" class="lb lc ir kx b gz lh le l lf lg">    this.playersAnswer = this.playersAnswer.bind(this);<br/>    this.handleSubmit = this.handleSubmit.bind(this);<br/>  }</span><span id="dde2" class="lb lc ir kx b gz lh le l lf lg">  handleSubmit(e) {<br/>    e.preventDefault();<br/>    if (this.props.answerValue.toLowerCase() === this.props.clue.answer.toLowerCase()) {<br/>      this.correctAnswer = &lt;Message<br/>        size="massive"<br/>        color="green"<br/>        header="Correct Answer"<br/>        content="Current score plus 200"<br/>      /&gt;<br/>      this.forceUpdate();<br/>    } else {<br/>      this.incorrectAnswer = &lt;Message<br/>        size="massive"<br/>        color="red"<br/>        header="Incorrect Answer"<br/>        content="Current score minus 200"<br/>      /&gt;<br/>      this.forceUpdate();<br/>    }<br/>  }</span><span id="a98f" class="lb lc ir kx b gz lh le l lf lg">  playersAnswer = (e) =&gt; {<br/>    let player = e.currentTarget.textContent;<br/>    this.props.currentPlayer(player);<br/>  }</span><span id="99a7" class="lb lc ir kx b gz lh le l lf lg">  render() {</span><span id="58e1" class="lb lc ir kx b gz lh le l lf lg">    const { answerValue } = this.props;</span><span id="dff4" class="lb lc ir kx b gz lh le l lf lg">    return (<br/>      &lt;Modal <br/>        open={this.props.modalOpen}<br/>        centered={true}<br/>        size='fullscreen' <br/>        dimmer='blurring'<br/>        style={{ 'textAlign': 'center', 'marginTop': '20px', 'backgroundColor': '#2185d0' }} <br/>      &gt;<br/>        &lt;Modal.Content<br/>          style={{ 'backgroundColor': '#2185d0', 'color': '#fff' }}<br/>        &gt;<br/>          {<br/>            this.props.clue !== undefined &amp;&amp;<br/>              &lt;Modal.Header<br/>                as='h1'<br/>                onClick={this.props.modalClose}      <br/>              &gt;<br/>                {this.props.clue.description}<br/>              &lt;/Modal.Header&gt;<br/>          }<br/>        &lt;/Modal.Content&gt;<br/>        &lt;ModalPlayerButtons playersAnswer={this.playersAnswer} /&gt;<br/>        &lt;Form<br/>          as='form'<br/>          size='massive'<br/>          onSubmit={this.handleSubmit}<br/>        &gt;<br/>          &lt;Form.Field <br/>            width={6} <br/>            style={{ 'marginLeft': 'auto', 'marginRight': 'auto', 'marginTop': '20px', 'marginBottom': '10px' }}<br/>            disabled={this.props.playerGuessing == undefined}<br/>          &gt;<br/>            &lt;label style={{'color': 'white'}}&gt;Player's Answer&lt;/label&gt;<br/>            &lt;Field <br/>              name='playerAnswer' <br/>              component='input' <br/>              type='text' <br/>              placeholder='What is... ?' <br/>            /&gt;<br/>          &lt;/Form.Field&gt;<br/>          &lt;Form.Field<br/>            width={6}<br/>            style={{ 'marginLeft': 'auto', 'marginRight': 'auto', 'marginTop': '20px', 'marginBottom': '10px' }}<br/>          &gt;<br/>            {this.correctAnswer}<br/>            {this.incorrectAnswer}<br/>          &lt;/Form.Field&gt;<br/>        &lt;/Form&gt;<br/>      &lt;/Modal&gt;<br/>    )<br/>  }<br/>}</span><span id="8f93" class="lb lc ir kx b gz lh le l lf lg">const mapStateToProps = state =&gt; {<br/>  return {<br/>    playerGuessing: state.currentPlayer.currentPlayer<br/>  }<br/>}</span><span id="7a53" class="lb lc ir kx b gz lh le l lf lg">const mapDispatchToProps = dispatch =&gt; {<br/>  return bindActionCreators({<br/>    currentPlayer<br/>  }, dispatch);  <br/>}</span><span id="ad39" class="lb lc ir kx b gz lh le l lf lg">QuestionModalClue = reduxForm({<br/>  form: 'answer'<br/>})(QuestionModalClue);</span><span id="90ab" class="lb lc ir kx b gz lh le l lf lg">const selector = formValueSelector('answer');</span><span id="85e1" class="lb lc ir kx b gz lh le l lf lg">QuestionModalClue = connect(state =&gt; {<br/>  const answerValue = selector(state, 'playerAnswer')<br/>  return {<br/>    answerValue,<br/>  }<br/>})(QuestionModalClue);</span><span id="e0d4" class="lb lc ir kx b gz lh le l lf lg">export default connect(mapStateToProps, mapDispatchToProps)(QuestionModalClue);</span></pre><p id="d821" class="pw-post-body-paragraph ju jv ir jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ik bi translated">你可能注意到的第一件事是state已经从我们的构造函数中移除了。我们的函数不再用于设置组件状态。相反，它们被用来给我们的变量赋值。我创建了一个新的<code class="fe lj lk ll kx b">mapStateToProps</code>函数来访问我们的redux存储。这是为了当玩家被点击时，表单输入会显示。在代码的底部有点混乱。所以让我们稍微回顾一下。</p><pre class="ks kt ku kv gu kw kx ky kz aw la bi"><span id="42c5" class="lb lc ir kx b gz ld le l lf lg">QuestionModalClue = reduxForm({<br/>  form: 'answer'<br/>})(QuestionModalClue);</span></pre><p id="2fdd" class="pw-post-body-paragraph ju jv ir jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ik bi translated">这用于将我们的表单直接连接到redux。我们使用<code class="fe lj lk ll kx b">form: 'answer'</code>来命名我们的表单以供参考。</p><p id="f88c" class="pw-post-body-paragraph ju jv ir jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ik bi translated">然后是<code class="fe lj lk ll kx b">const selector = formValueSelector('answer');</code>。我们可以使用<code class="fe lj lk ll kx b">formValueSelector</code>来连接表单值。它<em class="lm">创建</em>一个选择器函数，接受字段名并从指定的表单返回相应的值。参考Redux-Form站点，因为有几种不同的方法来实现这一点。您可能不需要一个单独的<code class="fe lj lk ll kx b">mapStateToProps</code>函数，或者您可能在一个字段组中有多个想要访问的字段。</p><pre class="ks kt ku kv gu kw kx ky kz aw la bi"><span id="7b63" class="lb lc ir kx b gz ld le l lf lg">QuestionModalClue = connect(state =&gt; {<br/>  const answerValue = selector(state, 'playerAnswer')<br/>  return {<br/>    answerValue<br/>  }<br/>})(QuestionModalClue);</span></pre><p id="a6ec" class="pw-post-body-paragraph ju jv ir jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ik bi translated">在这里，我们可以选择使用表单中输入名称的值来分配变量名。然后我们返回这个值，这样我们就可以访问它了。</p><pre class="ks kt ku kv gu kw kx ky kz aw la bi"><span id="afc6" class="lb lc ir kx b gz ld le l lf lg">export default connect(mapStateToProps, mapDispatchToProps)(QuestionModalClue);</span></pre><p id="5bfd" class="pw-post-body-paragraph ju jv ir jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ik bi translated">最后，我们通常连接到redux，这使我们能够使用<code class="fe lj lk ll kx b">mapStateToProps</code>和<code class="fe lj lk ll kx b">mapDispatchToProps</code>。你可以选择将其中的一些组合在一起，但对我来说，为了可读性更好，更容易将它们分开。</p><p id="a8c6" class="pw-post-body-paragraph ju jv ir jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ik bi translated">现在每个人都可以放松了。我的组件中不再包含本地状态，但它们都在redux的存储中。我就不说什么是正确的，什么是不正确的了。但是我完全理解在组件内部控制简单表单的本地状态，而不是使用redux。我很想在下面的评论中听到一些观点或者任何其他关于控制状态的建议。我的博客到此结束。我想这是我的下一个项目或想法。下次见。</p><figure class="ks kt ku kv gu jr"><div class="bz fq l di"><div class="ln jt l"/></div></figure></div></div>    
</body>
</html>