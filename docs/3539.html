<html>
<head>
<title>Why should we prefer the YAML file over the properties file for configurations in Spring Boot projects?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对于Spring Boot项目中的配置，为什么我们应该选择YAML文件而不是属性文件？</h1>
<blockquote>原文：<a href="https://itnext.io/why-should-we-prefer-the-yaml-file-over-the-properties-file-for-configurations-in-spring-boot-f31a273a923b?source=collection_archive---------1-----------------------#2020-01-06">https://itnext.io/why-should-we-prefer-the-yaml-file-over-the-properties-file-for-configurations-in-spring-boot-f31a273a923b?source=collection_archive---------1-----------------------#2020-01-06</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><figure class="gm go js jt ju jv gi gj paragraph-image"><div class="gi gj jr"><img src="../Images/036afbdbf4c62d2865aec446e2fea112.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*p2aE1t0-YMoYJyEkIjQQ2w.png"/></div><figcaption class="jy jz gk gi gj ka kb bd b be z dk translated">图片来自"<a class="ae kc" href="https://www.codeproject.com/Articles/1214409/Learn-YAML-in-five-minutes" rel="noopener ugc nofollow" target="_blank">五分钟学会YAML！</a>”</figcaption></figure><p id="0244" class="pw-post-body-paragraph kd ke iu kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la in bi translated">传统上，Spring开发人员将他们的配置数据(如参数或缩写设置值)放入一个属性文件中，并在他们的Spring应用程序中使用它。在Spring Boot，我们可以使用<a class="ae kc" href="http://yaml.org/" rel="noopener ugc nofollow" target="_blank"> YAML </a>文件代替属性文件。</p><p id="942b" class="pw-post-body-paragraph kd ke iu kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la in bi translated"><a class="ae kc" href="http://yaml.org/" rel="noopener ugc nofollow" target="_blank"> YAML </a>是一种人性化的数据序列化标准，但主要用于配置文件。YAML代表YAML不是标记语言(递归缩写)。YAML(1.2版)是JSON的超集，是一种非常方便的指定分层配置数据的格式。与属性文件相比，YAML文件更加清晰易读，还为我们提供了几个独特而有用的功能。YAML支持地图、列表和标量类型。</p><p id="5fdc" class="pw-post-body-paragraph kd ke iu kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la in bi translated"><code class="fe lb lc ld le b">SpringApplication</code>类将自动支持YAML作为属性的替代，它使用<a class="ae kc" href="http://www.snakeyaml.org/" rel="noopener ugc nofollow" target="_blank"> SnakeYAML </a>库作为YAML解析器。如果您的类路径中有<code class="fe lb lc ld le b">spring-boot-starter</code>，那么会自动提供<a class="ae kc" href="http://www.snakeyaml.org/" rel="noopener ugc nofollow" target="_blank"> SnakeYAML </a>库。</p><p id="9cdb" class="pw-post-body-paragraph kd ke iu kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la in bi translated">Spring Framework提供了两个方便的类，可以用来加载YAML文档。<code class="fe lb lc ld le b">YamlPropertiesFactoryBean</code>将加载YAML为<code class="fe lb lc ld le b">Properties</code>,<code class="fe lb lc ld le b">YamlMapFactoryBean</code>将加载YAML为<code class="fe lb lc ld le b">Map</code>。</p><p id="5995" class="pw-post-body-paragraph kd ke iu kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la in bi translated">在本文中，我想比较定义Spring Boot项目中配置的这两个标准，并提及YAML文件相对于属性文件的优势:</p><h2 id="ef34" class="lf lg iu bd lh li lj dn lk ll lm dp ln ko lo lp lq ks lr ls lt kw lu lv lw lx bi translated">一个文件中的多个弹簧轮廓</h2><p id="6d7d" class="pw-post-body-paragraph kd ke iu kf b kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw mc ky kz la in bi translated">如果你想在你的Spring Boot项目中有多个概要文件，通过使用YAML文件，你只需要定义一个配置文件，并将特定概要文件的配置数据放入其中，但是如果你使用属性文件，你需要为每个概要文件定义单独的文件。</p><p id="9a6c" class="pw-post-body-paragraph kd ke iu kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la in bi translated">例如，您可以在一个YAML文件中定义多个概要文件，方法是使用一个<code class="fe lb lc ld le b">spring.profiles</code>键来指示文档应用的时间:</p><pre class="md me mf mg gu mh le mi mj aw mk bi"><span id="3ff1" class="lf lg iu le b gz ml mm l mn mo">server:<br/>    address: 192.168.1.100<br/><em class="mp">---</em><br/>spring:<br/>    profiles: development<br/>server:<br/>    address: 127.0.0.1<br/><em class="mp">---</em><br/>spring:<br/>    profiles: production<br/>server:<br/>    address: 192.168.1.120</span></pre><p id="6e43" class="pw-post-body-paragraph kd ke iu kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la in bi translated">在这个例子中，如果<code class="fe lb lc ld le b">development</code>配置文件是活动的，<code class="fe lb lc ld le b">server.address</code>属性将是<code class="fe lb lc ld le b">127.0.0.1</code>。如果<code class="fe lb lc ld le b">development</code>和<code class="fe lb lc ld le b">production</code>配置文件未启用，则属性值将为<code class="fe lb lc ld le b">192.168.1.100</code>。</p><p id="5a89" class="pw-post-body-paragraph kd ke iu kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la in bi translated">当应用程序上下文启动时，如果没有明确激活的概要文件，则默认概要文件被激活。因此，在这个YAML中，我们为<code class="fe lb lc ld le b">security.user.password</code>设置了一个仅在“默认”配置文件中可用的值:</p><pre class="md me mf mg gu mh le mi mj aw mk bi"><span id="115e" class="lf lg iu le b gz ml mm l mn mo">server:<br/>  port: 8000<br/><em class="mp">---</em><br/>spring:<br/>  profiles: default<br/>security:<br/>  user:<br/>    password: weak</span></pre><p id="2d48" class="pw-post-body-paragraph kd ke iu kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la in bi translated">使用三个破折号，您可以分开两个配置文件并指示一个新配置文件的开始，这样所有的配置文件都可以在同一个YAML文件中描述。</p><h2 id="0203" class="lf lg iu bd lh li lj dn lk ll lm dp ln ko lo lp lq ks lr ls lt kw lu lv lw lx bi translated">列表和地图</h2><p id="79ad" class="pw-post-body-paragraph kd ke iu kf b kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw mc ky kz la in bi translated">YAML支持列表作为分层属性或内嵌列表，例如，YAML:</p><pre class="md me mf mg gu mh le mi mj aw mk bi"><span id="2f6a" class="lf lg iu le b gz ml mm l mn mo">my:<br/>   servers:<br/>       - dev<br/>       - prod</span><span id="06b2" class="lf lg iu le b gz mq mm l mn mo">my:<br/>   servers: [dev, prod]</span></pre><p id="99fd" class="pw-post-body-paragraph kd ke iu kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la in bi translated">会转化成这些特性:</p><pre class="md me mf mg gu mh le mi mj aw mk bi"><span id="716e" class="lf lg iu le b gz ml mm l mn mo">my.servers[0]=dev<br/>my.servers[1]=prod</span><span id="dd66" class="lf lg iu le b gz mq mm l mn mo">my.servers=dev, prod</span></pre><p id="9f6e" class="pw-post-body-paragraph kd ke iu kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la in bi translated">正如你所看到的，YAML版本更简洁，更易于阅读。YAML也支持使用空格的地图:</p><pre class="md me mf mg gu mh le mi mj aw mk bi"><span id="e159" class="lf lg iu le b gz ml mm l mn mo">map1:<br/>  key1:value1<br/>  key2:value2</span></pre><p id="579a" class="pw-post-body-paragraph kd ke iu kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la in bi translated">除此之外，YAML支持定义地图的内嵌格式:</p><pre class="md me mf mg gu mh le mi mj aw mk bi"><span id="cdfe" class="lf lg iu le b gz ml mm l mn mo">map1: {key1=value1, key2=value2}</span></pre><h2 id="f75a" class="lf lg iu bd lh li lj dn lk ll lm dp ln ko lo lp lq ks lr ls lt kw lu lv lw lx bi translated">将一个字符串分成多行</h2><p id="8507" class="pw-post-body-paragraph kd ke iu kf b kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw mc ky kz la in bi translated">虽然您可以在Spring Framework的属性文件中使用反斜杠字符(<code class="fe lb lc ld le b"><strong class="kf iv">\</strong></code> ) <strong class="kf iv"> </strong>)将一个字符串拆分成多行，但是您可以在YAML文件中使用更多功能以标准方式完成此操作。为此，YAML标准中有几种样式，例如，您可以使用YAML <a class="ae kc" href="http://www.yaml.org/spec/1.2/spec.html#id2796251" rel="noopener ugc nofollow" target="_blank">折叠样式</a>:</p><pre class="md me mf mg gu mh le mi mj aw mk bi"><span id="3998" class="lf lg iu le b gz ml mm l mn mo">key: &gt;<br/>  this is a very very very<br/>  long text</span></pre><p id="002e" class="pw-post-body-paragraph kd ke iu kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la in bi translated">这种样式删除字符串中的单个换行符，并在末尾添加一个换行符，并将双换行符转换为单个换行符。输出应该是这样的:</p><pre class="md me mf mg gu mh le mi mj aw mk bi"><span id="6dad" class="lf lg iu le b gz ml mm l mn mo">this is a very very very long text\n</span></pre><p id="d059" class="pw-post-body-paragraph kd ke iu kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la in bi translated">也可以使用<a class="ae kc" href="http://www.yaml.org/spec/1.2/spec.html#id2795688" rel="noopener ugc nofollow" target="_blank">文字样式</a>、<a class="ae kc" href="http://www.yaml.org/spec/1.2/spec.html#style/flow/double-quoted" rel="noopener ugc nofollow" target="_blank"> <em class="mp">双引号样式</em> </a> <em class="mp">或</em> <a class="ae kc" href="http://www.yaml.org/spec/1.2/spec.html#style/flow/single-quoted" rel="noopener ugc nofollow" target="_blank"> <em class="mp">单引号样式</em> </a> <em class="mp">。</em></p><h2 id="10f5" class="lf lg iu bd lh li lj dn lk ll lm dp ln ko lo lp lq ks lr ls lt kw lu lv lw lx bi translated">在其他语言和框架中的流行程度</h2><p id="832a" class="pw-post-body-paragraph kd ke iu kf b kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw mc ky kz la in bi translated">属性文件<strong class="kf iv"> </strong>专门用于Java项目，但是YAML <strong class="kf iv"> </strong>文件<strong class="kf iv"> </strong>被许多语言、框架和库使用，如果你想在它们之间共享配置，YAML文件肯定是更好的选择。</p><h2 id="b867" class="lf lg iu bd lh li lj dn lk ll lm dp ln ko lo lp lq ks lr ls lt kw lu lv lw lx bi translated">分级结构</h2><p id="7898" class="pw-post-body-paragraph kd ke iu kf b kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw mc ky kz la in bi translated">与属性文件的非分层或平面结构相比，YAML标准的分层结构导致了更易于阅读的配置，考虑以下YAML文档:</p><pre class="md me mf mg gu mh le mi mj aw mk bi"><span id="23cf" class="lf lg iu le b gz ml mm l mn mo">environments:<br/>    dev:<br/>        url: <a class="ae kc" href="http://dev.bar.com" rel="noopener ugc nofollow" target="_blank">http://dev.bar.com</a><br/>        name: Developer Setup<br/>    prod:<br/>        url: <a class="ae kc" href="http://foo.bar.com" rel="noopener ugc nofollow" target="_blank">http://foo.bar.com</a><br/>        name: My Cool App</span></pre><p id="e4a0" class="pw-post-body-paragraph kd ke iu kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la in bi translated">会转化成这些特性:</p><pre class="md me mf mg gu mh le mi mj aw mk bi"><span id="a0b1" class="lf lg iu le b gz ml mm l mn mo">environments.dev.url=http://dev.bar.com<br/>environments.dev.name=Developer Setup<br/>environments.prod.url=http://foo.bar.com<br/>environments.prod.name=My Cool App</span></pre><p id="f796" class="pw-post-body-paragraph kd ke iu kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la in bi translated">正如您所看到的，YAML文件的层次结构产生了一个可读性更强的配置文件，样板字符更少。</p><h2 id="d78e" class="lf lg iu bd lh li lj dn lk ll lm dp ln ko lo lp lq ks lr ls lt kw lu lv lw lx bi translated">@财产来源</h2><p id="3ad3" class="pw-post-body-paragraph kd ke iu kf b kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw mc ky kz la in bi translated">不能使用<code class="fe lb lc ld le b">@PropertySource</code>注释加载YAML文件。因此，如果您需要以这种方式加载值，您需要使用一个属性文件。<code class="fe lb lc ld le b">YamlPropertySourceLoader</code>类可以用来在春天<code class="fe lb lc ld le b">Environment</code>揭露YAML是一个<code class="fe lb lc ld le b">PropertySource</code>。这允许您使用熟悉的带有占位符语法的<code class="fe lb lc ld le b">@Value</code>注释来访问YAML属性。</p><h1 id="7a62" class="mr lg iu bd lh ms mt mu lk mv mw mx ln my mz na lq nb nc nd lt ne nf ng lw nh bi translated">结论</h1><p id="12be" class="pw-post-body-paragraph kd ke iu kf b kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw mc ky kz la in bi translated">在我看来，在Spring Boot项目中，YAML文件相对于属性文件的主要优势是<code class="fe lb lc ld le b">Hierarchical Structure</code>和<code class="fe lb lc ld le b">Popularity among other languages and frameworks</code>，如果你想跟上时代并拥有一些现代特征，我强烈推荐使用YAML文件而不是属性文件。但是如果您使用属性文件，除了拥有<code class="fe lb lc ld le b">Multiple Spring profiles in one file</code>和一个更易于阅读、更简洁的语法以及几个很棒的特性之外，您不会失去任何东西。</p><h1 id="1947" class="mr lg iu bd lh ms mt mu lk mv mw mx ln my mz na lq nb nc nd lt ne nf ng lw nh bi translated">资源</h1><ul class=""><li id="ba63" class="ni nj iu kf b kg ly kk lz ko nk ks nl kw nm la nn no np nq bi translated"><a class="ae kc" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config-yaml" rel="noopener ugc nofollow" target="_blank"> Spring Boot官方文件</a></li><li id="89be" class="ni nj iu kf b kg nr kk ns ko nt ks nu kw nv la nn no np nq bi translated">五分钟学会YAML！</li></ul></div></div>    
</body>
</html>