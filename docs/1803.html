<html>
<head>
<title>Dynamic Forms in Angular —The pattern beyond the buzz</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">有角度的动态形式——嗡嗡声之外的模式</h1>
<blockquote>原文：<a href="https://itnext.io/dynamic-forms-in-angular-the-pattern-beyond-the-buzz-da12f560b0d4?source=collection_archive---------1-----------------------#2019-02-01">https://itnext.io/dynamic-forms-in-angular-the-pattern-beyond-the-buzz-da12f560b0d4?source=collection_archive---------1-----------------------#2019-02-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jn jo jp jq gh gi paragraph-image"><div class="ab gu cl jr"><img src="../Images/9ab821f2a33828b5e343ecbbd9e49859.png" data-original-src="https://miro.medium.com/v2/0*v2LsIjpuVBgeJgvp"/></div></figure><p id="3c6a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这篇文章中，我的目标是用Angular来解释术语“动态”形式背后的思想。</p><p id="1ad4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">动态表单</strong>实际上是一个<strong class="jw ir">模式</strong>(不是一些人认为的另一个构建表单的API)，其中我们基于<strong class="jw ir">元描述</strong>构建一个表单，我们使用<strong class="jw ir">反应式表单API </strong>来实现它。</p><p id="7c8b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">反应式表单API为我们提供了一些非常有用的工具来<strong class="jw ir">构建</strong>表单，<strong class="jw ir">通过访问表单组<strong class="jw ir">控件</strong>(直接通过控件或使用某个控件的getter)等来访问</strong>其<strong class="jw ir">数据模型</strong>，并且<strong class="jw ir">通过代码定义</strong>其<strong class="jw ir">验证器</strong>。</p><p id="1874" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">该API提供了以下功能:</p><pre class="ks kt ku kv gt kw kx ky kz aw la bi"><span id="b8e1" class="lb lc iq kx b gy ld le l lf lg"><strong class="kx ir">import </strong>{ FormBuilder, FormControl, FormGroup, Validators, FormArray } <strong class="kx ir">from '@angular/forms'</strong>;</span></pre><p id="e6f5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">短评:</strong></p><ul class=""><li id="84c1" class="lh li iq jw b jx jy kb kc kf lj kj lk kn ll kr lm ln lo lp bi translated">新表单组将创建表单组的一个实例。</li><li id="cc08" class="lh li iq jw b jx lq kb lr kf ls kj lt kn lu kr lm ln lo lp bi translated">新的FormControl将创建控件的一个实例—提供给一个窗体组。</li><li id="a2c8" class="lh li iq jw b jx lq kb lr kf ls kj lt kn lu kr lm ln lo lp bi translated">验证器——在控件上设置许多验证选项。</li><li id="63c4" class="lh li iq jw b jx lq kb lr kf ls kj lt kn lu kr lm ln lo lp bi translated">form builder——以相对较短的语法创建表单组和相关控件(以及验证)的静态方法。</li><li id="6008" class="lh li iq jw b jx lq kb lr kf ls kj lt kn lu kr lm ln lo lp bi translated">格式数组—允许以格式数组的形式访问控件，以动态创建一组控件，这有点难以捕捉，所以我添加了以下代码片段:</li></ul><pre class="ks kt ku kv gt kw kx ky kz aw la bi"><span id="271f" class="lb lc iq kx b gy ld le l lf lg">@Input() <strong class="kx ir">myfromGroup</strong>: FormGroup;<br/><br/>addItem() {<br/>   <strong class="kx ir">this</strong>.<strong class="kx ir">repeatControls </strong>= <strong class="kx ir">this</strong>.<strong class="kx ir">myfromGroup</strong>.get(<strong class="kx ir">'repeatControls'</strong>) <strong class="kx ir">as </strong>FormArray;<br/>   <strong class="kx ir">this</strong>.<strong class="kx ir">repeatControls</strong>.push(<strong class="kx ir">this</strong>.createItem());<br/>}<br/><br/>createItem() {<br/>   <strong class="kx ir">return this</strong>.<strong class="kx ir">formBuilder</strong>.array(<br/>      [<strong class="kx ir">this</strong>.<strong class="kx ir">formBuilder</strong>.group(<strong class="kx ir">this</strong>.<strong class="kx ir">myfromGroup</strong>.<strong class="kx ir">controls</strong>.repeatControls)],<br/>   );<br/>}</span></pre><p id="c0ba" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">(此外，还有相关的指令，如<strong class="jw ir"> formControlName，formGroup，formArrayName) </strong></p><p id="4bbf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在该API之上，构建了术语“<strong class="jw ir">动态表单</strong>”,</p><blockquote class="lv lw lx"><p id="67fa" class="ju jv ly jw b jx jy jz ka kb kc kd ke lz kg kh ki ma kk kl km mb ko kp kq kr ij bi translated">基于描述业务对象模型的元数据动态创建表单可能更经济</p></blockquote><p id="e386" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">元描述的一个例子:</p><pre class="ks kt ku kv gt kw kx ky kz aw la bi"><span id="0bd6" class="lb lc iq kx b gy ld le l lf lg"><strong class="kx ir">nameDescription</strong>: {<br/>   <strong class="kx ir">name</strong>: {<br/>      <strong class="kx ir">type</strong>: <strong class="kx ir">'text'</strong>,<br/>      <strong class="kx ir">value</strong>: <strong class="kx ir">'Type policy name'</strong>,<br/>      <strong class="kx ir">label</strong>: <strong class="kx ir">'name'</strong>,<br/>      <strong class="kx ir">validation</strong>: {<br/>         <strong class="kx ir">required</strong>: <strong class="kx ir">true</strong>,<br/>      },<br/>   },<br/>   <strong class="kx ir">description</strong>: {<br/>      <strong class="kx ir">type</strong>: <strong class="kx ir">'text'</strong>,<br/>      <strong class="kx ir">value</strong>: <strong class="kx ir">'Type description for policy'</strong>,<br/>      <strong class="kx ir">label</strong>: <strong class="kx ir">'description'</strong>,<br/>      <strong class="kx ir">validation</strong>: {<br/>         <strong class="kx ir">required</strong>: <strong class="kx ir">false</strong>,<br/>      },<br/>   },<br/>   <strong class="kx ir">notes</strong>: {<br/>      <strong class="kx ir">type</strong>: <strong class="kx ir">'text'</strong>,<br/>      <strong class="kx ir">value</strong>: <strong class="kx ir">'Write a comment to explain what changes'</strong>,<br/>      <strong class="kx ir">label</strong>: <strong class="kx ir">'notes'</strong>,<br/>      <strong class="kx ir">validation</strong>: {<br/>         <strong class="kx ir">required</strong>: <strong class="kx ir">false</strong>,<br/>      },<br/>   },</span><span id="fdf0" class="lb lc iq kx b gy mc le l lf lg"><strong class="kx ir"> cancel: {<br/>   type: 'button',<br/>   label: 'Cancel',<br/> },<br/> OK: {<br/>   type: 'button',<br/>   label: 'OK',<br/>}</strong><br/>},</span></pre><p id="41d1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">一个可玩的例子:</p><div class="md me gp gr mf mg"><a href="https://stackblitz.com/edit/dynamic-form-simple-example?file=src/app/dynamic-form-simple-example/dynamic-form-simple-example.component.ts" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab fo"><div class="mi ab mj cl cj mk"><h2 class="bd ir gy z fp ml fr fs mm fu fw ip bi translated">动态表单简单示例堆栈</h2><div class="mn l"><h3 class="bd b gy z fp ml fr fs mm fu fw dk translated">导出到Angular CLI的Angular应用程序的启动项目</h3></div><div class="mo l"><p class="bd b dl z fp ml fr fs mm fu fw dk translated">stackblitz.com</p></div></div><div class="mp l"><div class="mq l mr ms mt mp mu js mg"/></div></div></a></div><p id="6e73" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">至于包含内部形式的更复杂的形式:</p><p id="8a37" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我最近意识到，用嵌套的表单组创建表单组不是一个好的架构模式。</p><p id="68a9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在嵌套表单的情况下——通过使用<strong class="jw ir"/><a class="ae mv" href="https://angular.io/api/forms/ControlValueAccessor" rel="noopener ugc nofollow" target="_blank"><strong class="jw ir">ControlValueAccessor</strong></a>API使内部表单成为<strong class="jw ir">控件</strong>,并在发生变化时反应性地更新表单组，IMO这是处理嵌套表单的角度方式，它是更优雅和简单的方法，一般来说，最好尽可能保持结构扁平，这样迭代的复杂性将保持线性:</p><p id="6595" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">做:</p><pre class="ks kt ku kv gt kw kx ky kz aw la bi"><span id="2455" class="lb lc iq kx b gy ld le l lf lg">createForm(descriptor): FormGroup {<br/>   <strong class="kx ir">const </strong>_simpleFormGroup: FormGroup | <strong class="kx ir">any </strong>= {};<br/>   <strong class="kx ir">for </strong>(<strong class="kx ir">const </strong>_control <strong class="kx ir">of <em class="ly">Object</em></strong>.keys(descriptor)) {<br/>      <strong class="kx ir">let </strong>control: FormControl;<br/>      <strong class="kx ir">if </strong>( <strong class="kx ir">this</strong>.<strong class="kx ir">descriptor</strong>[_control].<strong class="kx ir">value </strong>) {<br/>         <strong class="kx ir">if </strong>(<strong class="kx ir">this</strong>.<strong class="kx ir">descriptor</strong>[_control].Validators) {<br/>            control = <strong class="kx ir">this</strong>.formBuilder.control(<strong class="kx ir">this</strong>.<strong class="kx ir">descriptor</strong>[_control].<strong class="kx ir">value</strong>, {<br/>               <strong class="kx ir">validators</strong>: <strong class="kx ir">this</strong>.<strong class="kx ir">descriptor</strong>[_control].Validators,<br/>            });<br/>         } <strong class="kx ir">else </strong>{<br/>            control = <strong class="kx ir">this</strong>.formBuilder.control(<strong class="kx ir">this</strong>.<strong class="kx ir">descriptor</strong>[_control].<strong class="kx ir">value</strong>);<br/>         }<br/>      }<br/>      _simpleFormGroup[_control] = control;<br/>   }<br/>   <strong class="kx ir">return this</strong>.formBuilder.group(_simpleFormGroup);<br/>}</span></pre><p id="6ef9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果出于某种原因，您选择了嵌套表单结构，我的解决方案是:</p><p id="137a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">DONT:</p><pre class="ks kt ku kv gt kw kx ky kz aw la bi"><span id="210e" class="lb lc iq kx b gy ld le l lf lg">createMainForm(desc) {<br/>   <strong class="kx ir">const </strong>mainFormGroup = {};<br/>   <strong class="kx ir">for </strong>(<strong class="kx ir">const </strong>nestedGroup <strong class="kx ir">of <em class="ly">Object</em></strong>.keys(desc)) {<br/>      <strong class="kx ir">const </strong>nestedFormGroup = {};<br/>      <strong class="kx ir">let </strong>formControl;<br/>      <strong class="kx ir">for </strong>(<strong class="kx ir">const </strong>control <strong class="kx ir">of <em class="ly">Object</em></strong>.keys(desc[nestedGroup])) {<br/>         formControl = <strong class="kx ir">this</strong>.<strong class="kx ir">formBuilder</strong>.control(desc[nestedGroup][control].<strong class="kx ir">value</strong>);<br/>         nestedFormGroup[control] = formControl;<br/>      }<br/>      mainFormGroup[nestedGroup] = <strong class="kx ir">this</strong>.<strong class="kx ir">formBuilder</strong>.group(nestedFormGroup);<br/>   }<br/>   <strong class="kx ir">return this</strong>.<strong class="kx ir">formBuilder</strong>.group(mainFormGroup);<br/>}</span></pre><p id="eefc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我希望我能以简单的方式解释它，一旦你理解了反应式表单API，它就真的不复杂了，把它和ngSwitch，NGF一起使用，我们可以做一些非常酷的通用东西。</p><p id="6f2f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">参考:</p><div class="md me gp gr mf mg"><a href="https://angular.io/guide/dynamic-form" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab fo"><div class="mi ab mj cl cj mk"><h2 class="bd ir gy z fp ml fr fs mm fu fw ip bi translated">角度文档</h2><div class="mn l"><h3 class="bd b gy z fp ml fr fs mm fu fw dk translated">编辑描述</h3></div><div class="mo l"><p class="bd b dl z fp ml fr fs mm fu fw dk translated">angular.io</p></div></div></div></a></div></div></div>    
</body>
</html>