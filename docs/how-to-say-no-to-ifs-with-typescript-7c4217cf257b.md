# 用 Typescript 对 if 说不

> 原文：<https://itnext.io/how-to-say-no-to-ifs-with-typescript-7c4217cf257b?source=collection_archive---------4----------------------->

![](img/70869ca0e5649212a130e72252e74787.png)

任何与我交谈过的人都会注意到我对 if 语句的厌恶。当然，你不能避免它们，因为如果你必须比较两个数字，除了 if 语句，没有其他方法。

我对如果有什么不满？软件是一个有趣的词，如果你靠近它看，它包含单词 soft。让我们查一下英语词典，单词 soft 是什么意思。

容易塑造，不难改变。这是我们作为工程师每天都在做的事情，我们创建代码，更改代码，调试代码，制造新的错误。这一切都以维护结束，我们创建一个代码，几年来我们的主要任务是创建功能和维护旧代码。

这是我对 if 语句的不满。他们没有让代码易于维护，而是让代码变得复杂。可悲的是，如果没有威士忌的副作用，如果不会变得更好。Ifs 自然会编写代码来扩展，一个 if，两个逻辑，再多一个，你就已经有四个商业案例了。

那么如何避免呢？寻找聪明的模式，许多如果只是说:“嘿，伙计，你需要某种引擎对国家做出反应”。那么最好创造一个引擎，而不是从 ifs 中创造圣诞树。

女士们先生们，我给你们带来了打字稿中的指挥调度模式。

# 命令

什么是命令？该命令是一个参数容器。它不包含任何逻辑，它是一个简单的对象。

假设我们有一个用户注册的解决方案。必须提供的字段是姓名和年龄。那么我们的命令应该是“RegisterUser”

如何创建命令？

# 经理人

什么是处理程序？它处理业务逻辑，作为输入，它得到一个命令。

让我们创建一个 UserHandler。出于演示目的，它将有一个假的存储库，在生产中，它可能是一个 API 调用。

在 handlers 构造函数中，我们注册了一个 Handlers 可以处理的命令。基本上，我们在这里说，当你看到一个命令注册用户这样做。

这取决于你，有多少命令可以处理处理程序。干净利落。

每个处理程序必须扩展命令处理程序

包含存储处理程序，其中存储已注册的处理程序和方法寄存器。注册方法第一个参数是一种对象/命令，第二个参数是一个函数，其中输入是一个命令，输出是一个承诺。

# 分配器

现在我们有了命令和处理程序，我们需要第三个角色，一个调度程序。这个中间人有一项工作，就是为给定的命令执行适当的处理程序。

是的，我讨厌如果，如果可能的话，我会用可选的。

至于 CommandHandlerMap，这个类是一个中间人，它使得与处理程序一起工作更加令人满意。至于功能性，它将多个处理程序合并为一个。

# 最终游戏

正如单元测试所示。我们正在创建一个用户处理程序，并将其传递给处理程序映射。然后我们创建一个 dispatcher 和 pass handler 映射。创建一个命令并使用 dispatcher 执行该命令。

为什么需要地图？事实并非如此，但是当我们开始建造像这样的建筑时

看看增加功能是多么容易。切换功能的开/关。更多的处理程序没有问题，定义，添加和使用。

像这样的分支很容易在内部出错

那么为什么要使用 ifs 呢？只是[停止](https://www.youtube.com/watch?v=Ow0lr63y4Mw)，看看你的代码，寻找模式，寻找可能的“引擎”实现。维护“引擎”比维护巨大的“如果-那么”模块要容易得多。

[GitHub](https://github.com/alzuma/tools/blob/master/src/commands/__tests__/CommandHandler.test.ts) 中的代码照常运行。