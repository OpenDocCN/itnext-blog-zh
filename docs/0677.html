<html>
<head>
<title>Building RESTful Web APIs with Dart, Aqueduct, and PostgreSQL — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Dart、Aqueduct和PostgreSQL构建RESTful Web APIs第1部分</h1>
<blockquote>原文：<a href="https://itnext.io/building-restful-web-apis-with-dart-aqueduct-and-postgresql-3cc9b931f777?source=collection_archive---------0-----------------------#2018-05-05">https://itnext.io/building-restful-web-apis-with-dart-aqueduct-and-postgresql-3cc9b931f777?source=collection_archive---------0-----------------------#2018-05-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/06e8bbde0c96f1f6bf784142ca15afc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WZOMxFZ3wwPS9yd0OYUPHg.jpeg"/></div></div></figure><div class=""/></div><div class="ab cl jy jz hu ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ij ik il im in"><p id="ab45" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated"><strong class="kh jc"> <em class="ld">请注意:从Dart 2开始，导水管的API发生了变化，导致了重大变化。本文基于Dart v1的Aqueduct 2.5.0。</em>T3】</strong></p><p id="6714" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">【http://bit.ly/aqueduct-tutorial】<a class="ae le" href="http://bit.ly/aqueduct-tutorial" rel="noopener ugc nofollow" target="_blank"><strong class="kh jc"><em class="ld">我已经更新了这个作为新的视频系列</em></strong></a></p></div><div class="ab cl jy jz hu ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ij ik il im in"><p id="0c53" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">在这个关于另一个restful api教程(# yetanotherrat)的新系列中，我们将探索Dart平台及其在构建服务器端应用程序方面的贡献。</p><p id="397f" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">继我上一篇探索Dart语言的文章之后，我还研究了如何用Dart构建RESTful web服务。进一步挖掘，我偶然发现了<a class="ae le" href="https://aqueduct.io" rel="noopener ugc nofollow" target="_blank"> <strong class="kh jc">导水管</strong> </a>旁的稳仁。我第一眼看到它已经通过了第2版时印象深刻，一旦我发现文档很全面，有易于遵循的示例，我就确信要进一步探索。</p><p id="5830" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">在经历了如此多产和令人耳目一新的时间来浏览它的文档和跟随他们的例子之后，我现在很高兴带你和我一起踏上构建一个从头到尾都可以工作的api的旅程！</p></div><div class="ab cl jy jz hu ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ij ik il im in"><h1 id="1b8e" class="lf lg jb bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">那么，什么是导水管？</h1><p id="b1dd" class="pw-post-body-paragraph kf kg jb kh b ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky mh la lb lc ij bi translated">这是一个开源框架，用于在服务器上创建和部署RESTful web apis。它与<em class="ld">快车</em>和<em class="ld">哈比神</em>甚至<em class="ld">有着相似的味道。NET Web API，</em>提供了一个具有全面特性列表的入口点。</p><p id="d79f" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">我最喜欢的是:</p><ol class=""><li id="b5be" class="mi mj jb kh b ki kj km kn kq mk ku ml ky mm lc mn mo mp mq bi translated">流体，可链接<strong class="kh jc">路线</strong>。<em class="ld">组成你的路线的函数风格及其处理方法</em></li><li id="c022" class="mi mj jb kh b ki mr km ms kq mt ku mu ky mv lc mn mo mp mq bi translated">一个<strong class="kh jc"> CLI </strong>工具。<em class="ld">这允许你通过发布命令来搭建你的下一个项目</em></li><li id="be58" class="mi mj jb kh b ki mr km ms kq mt ku mu ky mv lc mn mo mp mq bi translated"><strong class="kh jc">开箱多线程</strong>。<em class="ld">通过Dart的“隔离”加速应用程序的多个实例，在服务器上的所有CPU内核间扩展。</em></li><li id="4e73" class="mi mj jb kh b ki mr km ms kq mt ku mu ky mv lc mn mo mp mq bi translated">具有内置的<strong class="kh jc">表单</strong>。如果你使用关系数据库，这是必备的！还支持数据库迁移。</li><li id="419c" class="mi mj jb kh b ki mr km ms kq mt ku mu ky mv lc mn mo mp mq bi translated">有一个<strong class="kh jc">集成测试</strong>库。<em class="ld">因为你需要测试所有的东西！与TravisCI等工具配合良好。</em></li></ol><p id="6336" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">在本系列中，我们将为个人阅读列表(<em class="ld">姑且称之为</em> <strong class="kh jc"> <em class="ld">收藏夹</em> </strong>)构建一个api📚<em class="ld"> ) </em>，涵盖这些话题:</p><ul class=""><li id="bd9a" class="mi mj jb kh b ki kj km kn kq mk ku ml ky mm lc mw mo mp mq bi translated"><strong class="kh jc">第1部分:设置并运行示例</strong> ( <em class="ld">我们到了</em>)</li><li id="0e57" class="mi mj jb kh b ki mr km ms kq mt ku mu ky mv lc mw mo mp mq bi translated"><a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/building-restful-web-apis-with-dart-aqueduct-and-postgresql-part-2-routing-with-crud-operations-629fe58114fa"> <strong class="kh jc">第2部分:用CRUD操作实现路由</strong> </a></li><li id="1742" class="mi mj jb kh b ki mr km ms kq mt ku mu ky mv lc mw mo mp mq bi translated"><a class="ae le" href="https://medium.com/@98d967ac6f3a/90ff70742675" rel="noopener"> <strong class="kh jc">第3部分:将Web APIs连接到PostgreSQL数据库</strong> </a></li><li id="72bc" class="mi mj jb kh b ki mr km ms kq mt ku mu ky mv lc mw mo mp mq bi translated"><a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/building-restful-web-apis-with-dart-aqueduct-and-postgresql-part-4-testing-de3618515639"> <strong class="kh jc">第4部分:编写自动化测试</strong> </a></li><li id="020e" class="mi mj jb kh b ki mr km ms kq mt ku mu ky mv lc mw mo mp mq bi translated"><a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/building-restful-web-apis-with-dart-aqueduct-and-postgresql-bonus-content-2fc086b7259a"><strong class="kh jc">*奖金内容* </strong> <em class="ld"> </em> DB迁移和模型关系</a></li></ul><figure class="my mz na nb gt is gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/72474ef0c1d3e1e4d68c20b48be28b55.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*dpgYbqlEkEGJxY6R5nfK1w.gif"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">通过<a class="ae le" href="https://giphy.com/gifs/door-wife-candles-GSrZUFaPs7yCs/fullscreen" rel="noopener ugc nofollow" target="_blank"> Giphy </a></figcaption></figure><h1 id="21f3" class="lf lg jb bd lh li ng lk ll lm nh lo lp lq ni ls lt lu nj lw lx ly nk ma mb mc bi translated">设置和运行示例</h1><p id="6d27" class="pw-post-body-paragraph kf kg jb kh b ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky mh la lb lc ij bi translated">如果你还没有，我建议你安装Dart SDK。有Windows，Mac，Linux的使用说明。</p><p id="a694" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">您可以通过检查终端来确认Dart正在运行:</p><pre class="my mz na nb gt nl nm nn no aw np bi"><span id="976d" class="nq lg jb nm b gy nr ns l nt nu">dart --version</span></pre><p id="7d96" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">Dart附带了一个名为<strong class="kh jc"> pub </strong>的工具来管理它的包。让我们用这个工具来安装导水管:</p><pre class="my mz na nb gt nl nm nn no aw np bi"><span id="286b" class="nq lg jb nm b gy nr ns l nt nu">pub global activate aqueduct</span></pre><p id="aa56" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">这使我们能够访问可执行文件<code class="fe nv nw nx nm b">aqueduct</code>。转到您的工作目录，让我们创建我们的项目:</p><pre class="my mz na nb gt nl nm nn no aw np bi"><span id="232e" class="nq lg jb nm b gy nr ns l nt nu">aqueduct create fave_reads &amp;&amp; cd fave_reads</span></pre><p id="5874" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">现在，您应该位于包含所有项目文件的<code class="fe nv nw nx nm b">fave_reads</code>目录中。现在，我们将重点关注:</p><pre class="my mz na nb gt nl nm nn no aw np bi"><span id="ab50" class="nq lg jb nm b gy nr ns l nt nu">bin/<br/>  main.dart<br/>lib/<br/>  fave_reads_sink.dart<br/>pubspec.yaml</span></pre><ul class=""><li id="7859" class="mi mj jb kh b ki kj km kn kq mk ku ml ky mm lc mw mo mp mq bi translated"><strong class="kh jc"> bin/main.dart </strong> <em class="ld">创建我们的服务器并启动app </em></li><li id="b556" class="mi mj jb kh b ki mr km ms kq mt ku mu ky mv lc mw mo mp mq bi translated"><strong class="kh jc">lib/fave _ reads _ sink . dart</strong>s<em class="ld">用它的配置设置你的应用</em></li><li id="c84e" class="mi mj jb kh b ki mr km ms kq mt ku mu ky mv lc mw mo mp mq bi translated"><strong class="kh jc"> pubspec.yaml </strong> <em class="ld">包含关于项目的元数据。类似于有一个package.json用于Node.js开发</em></li></ul><p id="1446" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">让我们使用下面的命令启动应用程序:</p><pre class="my mz na nb gt nl nm nn no aw np bi"><span id="b63e" class="nq lg jb nm b gy nr ns l nt nu">aqueduct serve # or `dart bin/main.dart`</span></pre><p id="2405" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">我们开始吧:</p><figure class="my mz na nb gt is gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/34ea00f7ebde803978ee260e9cd0a976.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X5Rb-mpdTws4yRVIVm4weA.png"/></div></figure><p id="4768" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">我们现在有一个运行在<code class="fe nv nw nx nm b">http://localhost:8081</code>的服务器，<code class="fe nv nw nx nm b">/example</code>是唯一创建的路由。访问<code class="fe nv nw nx nm b">http://localhost:8081/example</code>将返回如下响应:</p><pre class="my mz na nb gt nl nm nn no aw np bi"><span id="6ad7" class="nq lg jb nm b gy nr ns l nt nu">{ "key": "value" }</span></pre><p id="47b0" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">在这一点上，值得一提的是，Aqueduct有一个RequestSink的概念，根据文档:</p><blockquote class="nz oa ob"><p id="a4a8" class="kf kg ld kh b ki kj kk kl km kn ko kp oc kr ks kt od kv kw kx oe kz la lb lc ij bi translated">处理应用程序的初始化，包括设置路由、授权和数据库连接。</p></blockquote><p id="5c78" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">应用程序需要一个<code class="fe nv nw nx nm b">RequestSink</code>子类来接收请求。我们的例子有一个扩展基类<code class="fe nv nw nx nm b">RequestSink</code>的<code class="fe nv nw nx nm b">FaveReadsSink</code>，使我们能够用自己的实现覆盖它的方法。具体方法有<code class="fe nv nw nx nm b">setupRouter</code>和<code class="fe nv nw nx nm b">willOpen</code>。第一种方法将允许我们定义与相关控制器和其他中间件的路由，而后者允许我们在路由建立之后和应用程序接收请求之前执行任何异步初始化。</p><p id="3de7" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">对于当前请求，默认响应类型设置为JSON。然而，这可以被设置为适合满足我们需求的任何内容类型。</p><p id="2e5a" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">让我们通过在setupRouter方法中创建第二个路由来演示这一点:</p><pre class="my mz na nb gt nl nm nn no aw np bi"><span id="7f32" class="nq lg jb nm b gy nr ns l nt nu">router.route('/').listen((request) async {<br/>  return new Response.ok('Hello world')<br/>    ..<strong class="nm jc">contentType = ContentType.TEXT</strong>;<br/>});</span></pre><p id="e3b2" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">使用方法级联，我们能够将contentType属性设置为<code class="fe nv nw nx nm b">text/plain</code>。<code class="fe nv nw nx nm b">ContentType</code>工具自带<a class="ae le" href="https://api.dartlang.org/stable/1.24.3/dart-io/ContentType-class.html" rel="noopener ugc nofollow" target="_blank">飞镖</a>，可通过以下方式使用:</p><pre class="my mz na nb gt nl nm nn no aw np bi"><span id="f4cb" class="nq lg jb nm b gy nr ns l nt nu">new ContentType(primaryType, subType, {String charset, Map parameters});</span></pre><p id="40f6" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">它已经有了HTML、JSON和TEXT的常量，所以在大多数情况下你应该使用它们。</p><p id="3ca7" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">现在，通过终止当前进程并再次运行<code class="fe nv nw nx nm b">aqueduct serve</code>来重启服务器。访问根路径应该会得到以下结果:</p><figure class="my mz na nb gt is gh gi paragraph-image"><div class="gh gi of"><img src="../Images/ccce58444016a4ae9eb4350eef853a73.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*lbEy0nXBgb9Z--M5l2e-9w.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">答对了。</figcaption></figure><p id="1da9" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">在总结之前，让我们将应用实例扩展到我们拥有的内核数量。在<strong class="kh jc"> bin/main.dart </strong>中，当<code class="fe nv nw nx nm b">app.start</code>被调用时，当前设置为2:</p><pre class="my mz na nb gt nl nm nn no aw np bi"><span id="8095" class="nq lg jb nm b gy nr ns l nt nu">await app.start(numberOfInstances: <strong class="nm jc">2</strong>);</span></pre><p id="66b1" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">为了解决这个问题，我们将从“dart:io”库中导入Dart的<a class="ae le" href="https://api.dartlang.org/stable/1.24.3/dart-io/Platform-class.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kh jc">平台</strong> </a>类，并将<strong class="kh jc"> main.dart </strong>修改如下:</p><pre class="my mz na nb gt nl nm nn no aw np bi"><span id="bbd5" class="nq lg jb nm b gy nr ns l nt nu">import<strong class="nm jc"> 'dart:io'</strong> show <strong class="nm jc">Platform</strong>;</span><span id="cca8" class="nq lg jb nm b gy og ns l nt nu">Future main() async {<br/>  ...<br/>  ...<br/>  await app.start(numberOfInstances: <strong class="nm jc">Platform.numberOfProcessors</strong>);<br/>  ...<br/>}</span></pre><h1 id="dd95" class="lf lg jb bd lh li ng lk ll lm nh lo lp lq ni ls lt lu nj lw lx ly nk ma mb mc bi translated">VS代码的一些开发技巧👈</h1><p id="1c3f" class="pw-post-body-paragraph kf kg jb kh b ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky mh la lb lc ij bi translated">首先，确保通过Dart代码安装<a class="ae le" href="https://marketplace.visualstudio.com/items?itemName=Dart-Code.dart-code" rel="noopener ugc nofollow" target="_blank"> <strong class="kh jc"> Dart </strong> </a>扩展，以启用Dart和颤振支持。</p><p id="0bb0" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">其次，使用以下设置为Dart添加启动配置:</p><pre class="my mz na nb gt nl nm nn no aw np bi"><span id="f132" class="nq lg jb nm b gy nr ns l nt nu">{<br/>  "name": "Dart",<br/>  "type": "dart",<br/>  "request": "launch",<br/>  "program": "${workspaceFolder}/bin/main.dart"<br/>}</span></pre><p id="bba9" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">这将允许您通过VS代码运行应用程序，并能够添加断点来帮助调试:</p><figure class="my mz na nb gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oh"><img src="../Images/31b604ea820b41afe914a4754a5d1463.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*0wfkifW-0nJ7WQJRyAsiCQ.gif"/></div></div></figure></div><div class="ab cl jy jz hu ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ij ik il im in"><p id="4b7b" class="pw-post-body-paragraph kf kg jb kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">本系列的第1部分到此结束。源代码<a class="ae le" href="https://github.com/graphicbeacon/favereads" rel="noopener ugc nofollow" target="_blank">在github </a>上可用，而<a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/building-restful-web-apis-with-dart-aqueduct-and-postgresql-part-2-routing-with-crud-operations-629fe58114fa"> Part 2 </a>现在也可用。<strong class="kh jc">如果您喜欢这篇文章，请喜欢并关注我</strong>了解更多关于Dart的内容。</p><h1 id="6e82" class="lf lg jb bd lh li ng lk ll lm nh lo lp lq ni ls lt lu nj lw lx ly nk ma mb mc bi translated">进一步阅读</h1><ol class=""><li id="5a6f" class="mi mj jb kh b ki md km me kq oi ku oj ky ok lc mn mo mp mq bi translated"><a class="ae le" href="https://aqueduct.io/docs/" rel="noopener ugc nofollow" target="_blank">渡槽文件</a></li><li id="9c93" class="mi mj jb kh b ki mr km ms kq mt ku mu ky mv lc mn mo mp mq bi translated"><a class="ae le" href="https://www.dartlang.org/tools/pub/get-started" rel="noopener ugc nofollow" target="_blank">开始使用Pub </a></li><li id="89fe" class="mi mj jb kh b ki mr km ms kq mt ku mu ky mv lc mn mo mp mq bi translated"><a class="ae le" href="https://www.youtube.com/watch?v=twr3cDFCeo4" rel="noopener ugc nofollow" target="_blank">Joe Conway在2016年Dart开发者峰会上的演讲</a></li></ol></div></div>    
</body>
</html>