<html>
<head>
<title>Using UUIDs to your new Rails 6 application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在新的Rails 6应用程序中使用UUIDs</h1>
<blockquote>原文：<a href="https://itnext.io/using-uuids-to-your-rails-6-application-6438f4eeafdf?source=collection_archive---------1-----------------------#2020-03-19">https://itnext.io/using-uuids-to-your-rails-6-application-6438f4eeafdf?source=collection_archive---------1-----------------------#2020-03-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="953f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在一个全新的Rails应用程序上发现UUIDs的威力</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e2073be94b0b41defee64e02177578bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yoGcV-hEfvVoa4DvwyCERQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">约书亚·富勒</figcaption></figure><h2 id="667a" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><em class="ls">在我的</em> <a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/why-working-with-uuids-instead-of-ids-is-better-b60d22caf601"> <em class="ls">上篇文章</em> </a> <em class="ls">中，我解释了为什么使用UUIDs比顺序id更好。</em></h2><p id="75d7" class="pw-post-body-paragraph lt lu iq lv b lw lx jr ly lz ma ju mb lf mc md me lj mf mg mh ln mi mj mk ml ij bi translated">现在我们将创建一个新的<strong class="lv ir"> Rails 6 </strong>应用程序，用UUIDs作为主键，用<strong class="lv ir"> PostgreSQL </strong>作为数据库适配器。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mm mn l"/></div></figure></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><h1 id="361d" class="mv kx iq bd ky mw mx my lb mz na nb le jw nc jx li jz nd ka lm kc ne kd lq nf bi translated">将UUID应用到我们的应用中</h1><p id="3426" class="pw-post-body-paragraph lt lu iq lv b lw lx jr ly lz ma ju mb lf mc md me lj mf mg mh ln mi mj mk ml ij bi translated">PostgreSQL可以像数据类型一样存储许多信息。</p><p id="1233" class="pw-post-body-paragraph lt lu iq lv b lw ng jr ly lz nh ju mb lf ni md me lj nj mg mh ln nk mj mk ml ij bi translated"><code class="fe nl nm nn no b">rails new rails_uuid -d=postgresql</code></p><p id="027a" class="pw-post-body-paragraph lt lu iq lv b lw ng jr ly lz nh ju mb lf ni md me lj nj mg mh ln nk mj mk ml ij bi translated">为了能够在PostgreSQL中使用UUID的强大功能，我们需要创建一个迁移。</p><p id="1cd8" class="pw-post-body-paragraph lt lu iq lv b lw ng jr ly lz nh ju mb lf ni md me lj nj mg mh ln nk mj mk ml ij bi translated"><code class="fe nl nm nn no b">rails g migration enable_uuid</code></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np mn l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">PostgresSQL现在知道如何创建UUID类型的表</figcaption></figure><h1 id="797d" class="mv kx iq bd ky mw nq my lb mz nr nb le jw ns jx li jz nt ka lm kc nu kd lq nf bi translated">将UUID设置为默认主键类型</h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np mn l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">在这种配置下，我们的新型号将以UUID作为主键类型</figcaption></figure></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><h1 id="630c" class="mv kx iq bd ky mw mx my lb mz na nb le jw nc jx li jz nd ka lm kc ne kd lq nf bi translated">创建我们的第一个模型</h1><p id="f548" class="pw-post-body-paragraph lt lu iq lv b lw lx jr ly lz ma ju mb lf mc md me lj mf mg mh ln mi mj mk ml ij bi translated">跑<code class="fe nl nm nn no b">rails g model Post title</code></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np mn l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">正如您现在看到的，当我们创建表时，我们需要<strong class="ak">将</strong> <code class="fe nl nm nn no b"><strong class="ak">uuid</strong></code> <strong class="ak">指定为主键</strong>。</figcaption></figure><p id="86af" class="pw-post-body-paragraph lt lu iq lv b lw ng jr ly lz nh ju mb lf ni md me lj nj mg mh ln nk mj mk ml ij bi translated">我们现在运行<code class="fe nl nm nn no b">rails db:migrate</code>，从控制台创建3个帖子。</p><p id="fa06" class="pw-post-body-paragraph lt lu iq lv b lw ng jr ly lz nh ju mb lf ni md me lj nj mg mh ln nk mj mk ml ij bi translated">我们现在创建3个posts并检查主键的类型。</p><pre class="kg kh ki kj gt nv no nw nx aw ny bi"><span id="d8e3" class="kw kx iq no b gy nz oa l ob oc">$ rails console</span><span id="faf7" class="kw kx iq no b gy od oa l ob oc">&gt; Post.create(title: 'first post')</span><span id="99c1" class="kw kx iq no b gy od oa l ob oc">(0.5ms) BEGIN<br/> Post Create (5.2ms) INSERT INTO “posts” (“title”, “created_at”, “updated_at”) VALUES ($1, $2, $3) RETURNING “id” [[“title”, “first post”], [“created_at”, “2020–03–13 20:43:09.901543”], [“updated_at”, “2020–03–13 20:43:09.901543”]]<br/> (2.2ms) COMMIT<br/>=&gt; #&lt;Post id: “10f2b8e9–1fa8–4332–8868–2e11fb3c7ccc”, title: “first post”, created_at: “2020–03–13 20:43:09”, updated_at: “2020–03–13 20:43:09”&gt;</span><span id="6b81" class="kw kx iq no b gy od oa l ob oc">&gt; Post.create(title: 'second post')<br/> (0.5ms) BEGIN<br/> Post Create (0.7ms) INSERT INTO “posts” (“title”, “created_at”, “updated_at”) VALUES ($1, $2, $3) RETURNING “id” [[“title”, “second post”], [“created_at”, “2020–03–13 20:43:14.779885”], [“updated_at”, “2020–03–13 20:43:14.779885”]]<br/> (0.9ms) COMMIT<br/>=&gt; #&lt;Post id: “fdd597db-97af-40df-8009-ea6fba2ee9b8”, title: “second post”, created_at: “2020–03–13 20:43:14”, updated_at: “2020–03–13 20:43:14”&gt;</span><span id="8933" class="kw kx iq no b gy od oa l ob oc">&gt; Post.create(title: 'third post')<br/> (0.5ms) BEGIN<br/> Post Create (0.7ms) INSERT INTO “posts” (“title”, “created_at”, “updated_at”) VALUES ($1, $2, $3) RETURNING “id” [[“title”, “third post”], [“created_at”, “2020–03–13 20:43:21.232768”], [“updated_at”, “2020–03–13 20:43:21.232768”]]<br/> (1.0ms) COMMIT<br/>=&gt; #&lt;Post id: “8485ceca-3a85–41e7-b86e-6b6d93dc4e8b”, title: “third post”, created_at: “2020–03–13 20:43:21”, updated_at: “2020–03–13 20:43:21”&gt;</span></pre><p id="7c30" class="pw-post-body-paragraph lt lu iq lv b lw ng jr ly lz nh ju mb lf ni md me lj nj mg mh ln nk mj mk ml ij bi translated">完善我们的主键列现在是一个<code class="fe nl nm nn no b">uuid</code>类型！</p></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><h1 id="abcc" class="mv kx iq bd ky mw mx my lb mz na nb le jw nc jx li jz nd ka lm kc ne kd lq nf bi translated">订购我们的唱片</h1><p id="c322" class="pw-post-body-paragraph lt lu iq lv b lw lx jr ly lz ma ju mb lf mc md me lj mf mg mh ln mi mj mk ml ij bi translated">我们现在检查我们文章的正确顺序，第三篇文章应该是最新的。</p><pre class="kg kh ki kj gt nv no nw nx aw ny bi"><span id="d81f" class="kw kx iq no b gy nz oa l ob oc">$ rails console</span><span id="707b" class="kw kx iq no b gy od oa l ob oc">&gt; Post.last<br/>=&gt; #&lt;Post id: “fdd597db-97af-40df-8009-ea6fba2ee9b8”, title: “second post”, created_at: “2020–03–13 20:43:14”, updated_at: “2020–03–13 20:43:14”&gt;</span></pre><p id="56dd" class="pw-post-body-paragraph lt lu iq lv b lw ng jr ly lz nh ju mb lf ni md me lj nj mg mh ln nk mj mk ml ij bi translated">如我们所见，最后一个帖子是“第二个帖子”，而不是“第三个帖子”。这是因为<strong class="lv ir">默认情况下ActiveRecord是用主键排序的。</strong>现在我们使用UUID，ActiveRecord按照字母数字顺序排序。</p><p id="42c7" class="pw-post-body-paragraph lt lu iq lv b lw ng jr ly lz nh ju mb lf ni md me lj nj mg mh ln nk mj mk ml ij bi translated">为了解决这个问题，我们需要编辑<em class="oe">app/models/application _ record . Rb</em>文件，并要求ActiveRecord不要按<strong class="lv ir">主键</strong>排序，而是按<strong class="lv ir">创建日期</strong>和<code class="fe nl nm nn no b">created_at</code>列排序。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np mn l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">我们所有的型号现在都将按created_at列进行订购</figcaption></figure><p id="651c" class="pw-post-body-paragraph lt lu iq lv b lw ng jr ly lz nh ju mb lf ni md me lj nj mg mh ln nk mj mk ml ij bi translated">我们将再试一次。</p><pre class="kg kh ki kj gt nv no nw nx aw ny bi"><span id="393c" class="kw kx iq no b gy nz oa l ob oc">&gt; reload!<br/>&gt; Post.last</span><span id="afec" class="kw kx iq no b gy od oa l ob oc">Post Load (3.8ms) SELECT “posts”.* FROM “posts” ORDER BY “posts”.”created_at” DESC LIMIT $1 [[“LIMIT”, 1]]<br/>=&gt; #&lt;Post id: “8485ceca-3a85–41e7-b86e-6b6d93dc4e8b”, title: “third post”, created_at: “2020–03–13 20:43:21”, updated_at: “2020–03–13 20:43:21”&gt;</span></pre><p id="2bf8" class="pw-post-body-paragraph lt lu iq lv b lw ng jr ly lz nh ju mb lf ni md me lj nj mg mh ln nk mj mk ml ij bi translated">祝贺我们现在正确排序我们的记录。</p></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><h1 id="ce36" class="mv kx iq bd ky mw mx my lb mz na nb le jw nc jx li jz nd ka lm kc ne kd lq nf bi translated">与模型的关联</h1><p id="1936" class="pw-post-body-paragraph lt lu iq lv b lw lx jr ly lz ma ju mb lf mc md me lj mf mg mh ln mi mj mk ml ij bi translated">我们现在正在创建属于<code class="fe nl nm nn no b">Post</code>的第二个模型<code class="fe nl nm nn no b">Comment</code>。</p><p id="0d1b" class="pw-post-body-paragraph lt lu iq lv b lw ng jr ly lz nh ju mb lf ni md me lj nj mg mh ln nk mj mk ml ij bi translated">运行<code class="fe nl nm nn no b">rails g model Comment post:belongs_to body:text</code></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np mn l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">您必须指定外键的类型</figcaption></figure><p id="8708" class="pw-post-body-paragraph lt lu iq lv b lw ng jr ly lz nh ju mb lf ni md me lj nj mg mh ln nk mj mk ml ij bi translated">我们现在将验证一切正常。</p><pre class="kg kh ki kj gt nv no nw nx aw ny bi"><span id="df2c" class="kw kx iq no b gy nz oa l ob oc">$ rails db:migrate<br/>$ rails console</span><span id="17f5" class="kw kx iq no b gy od oa l ob oc">&gt; Post.first.comments.create(body: 'bonjour')</span><span id="c5b5" class="kw kx iq no b gy od oa l ob oc">&gt; Post.first.comments<br/> Post Load (2.1ms) SELECT “posts”.* FROM “posts” ORDER BY “posts”.”created_at” ASC LIMIT $1 [[“LIMIT”, 1]]<br/> Comment Load (11.8ms) SELECT “comments”.* FROM “comments” WHERE “comments”.”post_id” = $1 LIMIT $2 [[“post_id”, “10f2b8e9–1fa8–4332–8868–2e11fb3c7ccc”], [“LIMIT”, 11]]<br/>=&gt; #&lt;ActiveRecord::Associations::CollectionProxy [#&lt;Comment id: “a504f964–4678–4c9e-b0fb-46de58cfde5d”, post_id: “10f2b8e9–1fa8–4332–8868–2e11fb3c7ccc”, content: “jhsdbfjhfsbd”, created_at: “2020–03–13 20:54:41”, updated_at: “2020–03–13 20:54:41”&gt;]&gt;</span><span id="c43c" class="kw kx iq no b gy od oa l ob oc">&gt; Comment.last.post<br/> Comment Load (2.3ms) SELECT “comments”.* FROM “comments” ORDER BY “comments”.”created_at” DESC LIMIT $1 [[“LIMIT”, 1]]<br/> Post Load (1.4ms) SELECT “posts”.* FROM “posts” WHERE “posts”.”id” = $1 LIMIT $2 [[“id”, “10f2b8e9–1fa8–4332–8868–2e11fb3c7ccc”], [“LIMIT”, 1]]<br/>=&gt; #&lt;Post id: “10f2b8e9–1fa8–4332–8868–2e11fb3c7ccc”, title: “plop”, created_at: “2020–03–13 20:43:09”, updated_at: “2020–03–13 20:43:09”&gt;</span></pre><h2 id="7895" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">恭喜你，一切都很完美！</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of mn l"/></div></figure></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><p id="ed66" class="pw-post-body-paragraph lt lu iq lv b lw ng jr ly lz nh ju mb lf ni md me lj nj mg mh ln nk mj mk ml ij bi translated">源代码:<a class="ae kv" href="https://github.com/GuillaumeOcculy/rails_uuid" rel="noopener ugc nofollow" target="_blank">https://github.com/GuillaumeOcculy/rails_uuid</a></p><h2 id="535c" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">相关文章:</h2><div class="og oh gp gr oi oj"><a rel="noopener  ugc nofollow" target="_blank" href="/why-working-with-uuids-instead-of-ids-is-better-b60d22caf601"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd ir gy z fp oo fr fs op fu fw ip bi translated">为什么使用UUIDs比使用id更好</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">使用UUIDs而不是IDs有很多好处。</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">itnext.io</p></div></div><div class="os l"><div class="ot l ou ov ow os ox kp oj"/></div></div></a></div></div></div>    
</body>
</html>