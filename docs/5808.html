<html>
<head>
<title>Build the HackerNews Reader with VueJS 3 — Part 3, infinite loading with ES2018 syntax</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用VueJS 3构建HackerNews阅读器—第3部分，使用ES2018语法无限加载</h1>
<blockquote>原文：<a href="https://itnext.io/build-the-hackernews-reader-with-vuejs-3-part-3-infinite-loading-with-es2018-syntax-9b5e2ad55e3d?source=collection_archive---------1-----------------------#2021-05-29">https://itnext.io/build-the-hackernews-reader-with-vuejs-3-part-3-infinite-loading-with-es2018-syntax-9b5e2ad55e3d?source=collection_archive---------1-----------------------#2021-05-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ccd8a6ce37348be31b2817c25b874861.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YdmfTOodubu_9Wc3"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@angelyviviana55?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">王嘉卉·阿塞维多</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="2d71" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">目标</strong></p><p id="21f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">继续上一部分[ <a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/hackernews-reader-with-vue-3-vite-2-and-vuex-4-part-1-247315ceb06a?source=friends_link&amp;sk=5a1871c1fd3495c5527c35f41cfa2e5d"> 1 </a> ][ <a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/build-the-hackernews-reader-with-vuejs-3-part-2-dark-mode-implemented-c4caf7d0c9de?source=friends_link&amp;sk=32a3ec70519f08b9d3f51fc8de8263ac"> 2 </a> ]在这一部分中，我们将通过一些高级技术来实现无限加载功能，以从HackerNews和skeleton gradient animation获得更多帖子，从而提供最佳的用户体验。虽然有Vue插件支持无限加载，但在本教程中，我们将从头开始构建，以便我们可以通过进度深入学习。最后，由于HackerNews API的限制，我们有机会尝试ES2018的新功能<code class="fe lb lc ld le b">await for of</code>和往常一样，我将一步一步地详细解释我们为什么以及如何编码。</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lf"><img src="../Images/6d61960ed5da1af00084dc4c70459eb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ag2UFC8IZLTBEb5Z"/></div></div></figure></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><p id="c890" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">分析</strong></p><p id="eb0f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们需要分析来自HackerNews的API，以起草实现无限加载的基本设计。从<a class="ae kc" href="https://github.com/HackerNews/API" rel="noopener ugc nofollow" target="_blank">官方文档</a>来看，HackerNews API是建立在Firebase之上的，我们最多只能查询500个最近的条目。结果是下面的id列表。</p><figure class="lg lh li lj gt jr"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="648e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，为了对项目进行分页，我们可以如下<code class="fe lb lc ld le b">slice</code>:</p><figure class="lg lh li lj gt jr"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="cfcb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">设计</strong></p><p id="4d97" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下一步，我们设计函数来处理来自API的数据，然后在用户滚动加载时呈现这些数据。在之前的教程中，我们只是一次加载所有的，所以这不会是一个问题。然而，当我们要实现无限加载特性时，这可能会导致一个问题。首先，让我们来看看如何无限地装载物品。我们将这样使用事件<code class="fe lb lc ld le b">scroll</code>:</p><figure class="lg lh li lj gt jr"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="97c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">基本上，上面的代码块将监听事件<code class="fe lb lc ld le b">scroll</code>，每当用户到达页面底部，函数<code class="fe lb lc ld le b">handleScroll</code>将被调用来呈现新的项目。但是，在生产中，由于第三方API的限制，我们需要进行大量的查询。</p><figure class="lg lh li lj gt jr"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="763f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所有这些活动都是异步的，由来自<code class="fe lb lc ld le b">Promise</code>对象的机制处理。所以，即使所有这些项目都没有解决，事件<code class="fe lb lc ld le b">scroll</code>仍然被监听并继续调用<code class="fe lb lc ld le b">handleScroll</code>函数。</p><p id="db7c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">总而言之，有一些技术要求需要实现:</p><ol class=""><li id="68b3" class="lt lu iq kf b kg kh kk kl ko lv ks lw kw lx la ly lz ma mb bi translated">当API结果仍未解析时，防止调用<code class="fe lb lc ld le b">handleScroll</code>的标志</li><li id="1d01" class="lt lu iq kf b kg mc kk md ko me ks mf kw mg la ly lz ma mb bi translated">一个停止<code class="fe lb lc ld le b">scroll</code>事件监听的标志，当没有更多的项目从API加载时</li><li id="7d47" class="lt lu iq kf b kg mc kk md ko me ks mf kw mg la ly lz ma mb bi translated">处理跨主题的分页</li><li id="673e" class="lt lu iq kf b kg mc kk md ko me ks mf kw mg la ly lz ma mb bi translated">一次处理多个异步请求的机制。</li></ol><p id="1f13" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">实施</strong></p><p id="846b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了处理第一个任务，将在全局状态下创建一个<code class="fe lb lc ld le b">boolean</code>变量<code class="fe lb lc ld le b">loading</code>，这样我们就可以跟踪请求何时被初始化，以便在所有数据处理完毕时打开和关闭它。我们还创建了另一个<code class="fe lb lc ld le b">boolean</code>变量<code class="fe lb lc ld le b">endPagination</code>来跟踪对于一个特定的主题是否没有更多的条目要加载。最后，一个<code class="fe lb lc ld le b">int</code>变量<code class="fe lb lc ld le b">page</code>操纵分页。那么我们的全局状态配置会是这样的。</p><figure class="lg lh li lj gt jr"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="6fce" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们将处理API请求。有几种方法可以处理多个异步请求，例如使用<code class="fe lb lc ld le b">Promise.all()</code>，不过，我还是要向您介绍如何利用ES2018的一个非常有用的新功能:<a class="ae kc" href="https://github.com/tc39/proposal-async-iteration" rel="noopener ugc nofollow" target="_blank">异步迭代</a> <code class="fe lb lc ld le b">for await ... of</code></p><p id="dab7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为这个语法相当新，所以我们需要<code class="fe lb lc ld le b">babel</code>来使它在浏览器上工作。</p><p id="1e29" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，安装一些插件和<code class="fe lb lc ld le b">@babel/core</code></p><pre class="lg lh li lj gt mh le mi mj aw mk bi"><span id="14dd" class="ml mm iq le b gy mn mo l mp mq">yarn add -D @babel/core @rollup/plugin-babel @babel/plugin-proposal-async-generator-functions</span></pre><p id="bf05" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建新文件<code class="fe lb lc ld le b">.babelrc</code></p><pre class="lg lh li lj gt mh le mi mj aw mk bi"><span id="4e80" class="ml mm iq le b gy mn mo l mp mq">{</span><span id="fcdc" class="ml mm iq le b gy mr mo l mp mq">"plugins": ["@babel/plugin-proposal-async-generator-functions"]</span><span id="7102" class="ml mm iq le b gy mr mo l mp mq">}</span></pre><p id="31da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后修改<code class="fe lb lc ld le b">vite.config.js</code></p><figure class="lg lh li lj gt jr"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="672f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以在这里阅读更多关于巴别塔变换插件<a class="ae kc" href="https://babeljs.io/docs/en/babel-plugin-proposal-async-generator-functions" rel="noopener ugc nofollow" target="_blank">的内容。然后，我们就可以走了。为了实现这个特性，我们将编写一个<em class="ms">异步函数生成器。</em></a></p><figure class="lg lh li lj gt jr"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="3517" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上述异步函数将生成符合异步可迭代协议的值，然后可以使用<code class="fe lb lc ld le b">for await ... of</code>循环这些值。该机制对于同步请求活动至关重要，这样我们就可以处理事件<code class="fe lb lc ld le b">on</code>，正如我在开始时提到的。你可以从Github repo查看完整的代码<code class="fe lb lc ld le b"><a class="ae kc" href="https://github.com/infantiablue/vhnews/blob/main/src/store/index.js" rel="noopener ugc nofollow" target="_blank">store\index.js</a></code>。</p><p id="4018" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">骨骼装载</strong></p><p id="7b78" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">骨架加载模式并不新鲜，它被广泛采用，以增强用户在加载更多内容时的体验。应用到我们的项目中并不难。所以，我只是简单地写一下它是如何工作的，代码已经在Github repo中了。</p><p id="6299" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们所要做的就是用所需的CSS创建另一个Vue组件，以便设置背景的样式和动画。诀窍是我们需要设置框架文章的数量，如何符合分页系统。为了实现这个目标，我们编写了一个简洁函数来生成一个与<code class="fe lb lc ld le b">v-for</code>一起使用的数字列表</p><figure class="lg lh li lj gt jr"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="a741" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以在回购中查看完整的代码<code class="fe lb lc ld le b">components\Skeleton.vue</code></p><p id="8bb2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">奖金</strong></p><p id="9ad9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有另一个新组件<code class="fe lb lc ld le b">components\Modal.vue</code>为文本帖子创建模态效果，例如<em class="ms"> Ask </em>。这个组件使用了一个新的Vue 3 API，<a class="ae kc" href="https://v3.vuejs.org/guide/teleport.html" rel="noopener ugc nofollow" target="_blank">传送</a>。我会留给你自己去探索。这很容易理解。</p></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><h1 id="d68c" class="mt mm iq bd mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np bi translated">结论</h1><p id="4c4f" class="pw-post-body-paragraph kd ke iq kf b kg nq ki kj kk nr km kn ko ns kq kr ks nt ku kv kw nu ky kz la ij bi translated">在这一部分，我认为最重要的教训是我们如何分析、计划和实现期望的特性。通过提前计划，我们将避免许多错误，并在编码实现阶段节省大量时间。不仅如此，我们还有机会在实际项目中熟悉ES2018语法<code class="fe lb lc ld le b">for await ... of</code>。</p><p id="7611" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae kc" href="http://WIN EPIC PRIZES    1 Profile image Search Tags MY TAGS HOT TAGS  #tech-news   #general-programming   #security   #react   #webdev   #javascript   #google   #data-science   #cloud   #business   #startup   #aws   #machine-learning   #apple   #career   #microsoft   #ai   #cyber   #testing   #python   #nodejs   #azure   #infrastructure   #css   #hardware   #devtools   #kubernetes   #java   #deep-learning   #linux   #open-source   #architecture   #venture-capital   #github   #c   #devops   #sap   #logging   #html   #r   #ios   #containers   #data-privacy   #backend   #sql   #vuejs   #authentication   #angular   #typescript   #docker   #wordpress   #spring   #golang   #iot   #web-design   #google-chrome   #automation   #flutter   #git   #gcp   #crypto   #ruby   #react-native   #graphql   #game-development   #gaming   #serverless   #nlp   #rails   #php   #agile   #cicd   #rust   #big-data   #bots   #mongodb   #swift   #apache   #aspnet   #blockchain   #ecommerce   #tensorflow   #postgresql   #laravel   #firebase   #.net   #vr   #math   #terraform   #apache-spark   #kafka   #ar   #elk   #nextjs   #cryptography   #ibm   #webpack   #mysql   #adobe   #kotlin   #microsoft-sql-server   #oracle   #crawling   #game-design   #accessibility   #red-hat   #bi   #android-development   #bootstrap-css   #firefox   #nocode   #computer-vision   #redis   #gitlab   #blazor   #tailwind-css   #xamarin   #cms   #robotics   #data-analysis   #pytorch   #scala   #gatsby   #openshift   #bluetooth   #seo   #heroku   #django   #ethics   #elixir   #jupyter   #bash   #symfony   #jquery   #salesforce   #safari   #erp   #netlify   #selenium   #powershell   #nginx   #cloudflare   #ibm-cloud   #digitalocean   #mozilla   #embedded   #flask   #jenkins   #ionic   #keras   #auth0   #lightbend   #svelte   #haskell   #chromium   #crm   #hashicorp   #grpc   #mulesoft   #dart   #microsoft-edge   #julia   #perl   #aiops   #deno   #jamstack   #prometheus   #grafana   #vb   #nestjs   #ansible   #scikit   #okta   #google-bigquery   #active-directory   #firmware   #apache-cassandra   #gradle   #emberjs   #chef   #confluent-cloud   #ravendb   #nativescript   #alibaba-cloud   #prisma   #rabbitmq   #neo4j   #couchbase   #faunadb   #apache-flink   #pulumi   #apache-airflow   #clojure   #influxdb   #vite   #bitbucket   #lisp   #algolia   #fastify   #react-query   #puppet   #ballerina   #elm   #preact   #mobile-design   #fastapi   #erlang   #supabase   #alpinejs   #winui   #lua   #dailydev   #harperdb   #apache-hadoop   #apache-activemq   #sinatra   #gis   #web3   #kerberos   #adonisjs   #godot   #devrel   #hotwire     POPULAR UPVOTED DISCUSSED RECENT SHOW MOST VISITED SITES  Find out if a PWA is right for your next app dev project  PROMOTED Remove ads? freeCodeCamp My Developer Journey – How I Went from Making $1,000 to $100,000 a Year Today 11m read time Post image  5 1 Vue.js Examples   Neumorphism ui component set with vuejs Today Post image  4 2 Medium Styling React Components with Material UI Today 3m read time Post image  Product Hunt DevHuntr — A s̶e̶a̶r̶c̶h̶ e̶n̶g̶i̶n̶e̶ huntr for devs Today Post image  DZone What is ETL? Today 9m read time Post image  Medium Technical Failure #1: React hooks dependencies Today 2m read time Post image  Medium Caesar Cipher Solution In JavaScript Today 4m read time Post image  1 DZone How Virtual Fitting Room Technology Works Today 9m read time Post image  1 Medium Javascript Hoisting &amp; TDZ Today 1m read time Post image   Testing with Deno — Part 3 Processing results for CI/CD Today 6m read time Post image  Netflix TechBlog My (Seemingly) Random Walk to Netflix Today 8m read time Post image  TechCrunch Alibaba is making its cloud OS compatible with multiple chip architectures Today 1m read time Post image  DZone AWS Serverless Data Lake: Built Real-time Using Apache Hudi, AWS Glue, and Kinesis Stream Today 4m read time Post image  Red Hat Developer Kubernetes-native Java: Latest and greatest features of Quarkus 2.0 | DevNation Tech Talk Today Post image  redislabs AI for Fraud Detection Mini Summit Today   J4K Conference 2021 Today   DevNation Deep Dive: Argo CD Today   Running Google MoveNet Single Pose models on OpenVINO Today 1m read time   Standalone text engine for iOS Today 1m read time  1  Link Hover Style 142 Today  1  Pagination Style 117 Today   GBI CIO Retail Roundtable Today   Toon Filters And Video Transformation in EbSynth [Part 2] Today   Using Cucumber with Gradle Today 3m read time   Swift Comments Today   Draw a scribbly underline underneath some text in React Today   Data Platform: The New Generation Data Lakes Today 11m read time   Microfrontends in action — how NOT to fail when introducing them Today 8m read time  2  Understand JavaScript Array Methods in 7 minutes Yesterday 13m read time  24 2  What Netflix Should Consider Before Diving into Gaming Today" rel="noopener ugc nofollow" target="_blank">现场试玩</a> <br/> <a class="ae kc" href="https://github.com/infantiablue/vhnews" rel="noopener ugc nofollow" target="_blank"> Github回购</a></p></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><p id="2d43" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="ms">原载于</em><a class="ae kc" href="https://techika.com/2021/05/29/build-hackernews-reader-vuejs-tailwind-p3/" rel="noopener ugc nofollow" target="_blank"><em class="ms"/></a><em class="ms">——</em><a class="ae kc" href="https://techika.com" rel="noopener ugc nofollow" target="_blank"><em class="ms">我的个人博客</em> </a> <em class="ms">。</em></p></div></div>    
</body>
</html>