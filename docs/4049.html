<html>
<head>
<title>Windows CMD and PowerShell color rendering by golang</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">golang的Windows CMD和PowerShell颜色渲染</h1>
<blockquote>原文：<a href="https://itnext.io/windows-cmd-and-powershell-color-rendering-by-golang-54bddc2d25d1?source=collection_archive---------3-----------------------#2020-04-16">https://itnext.io/windows-cmd-and-powershell-color-rendering-by-golang-54bddc2d25d1?source=collection_archive---------3-----------------------#2020-04-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="1242" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/gookit/color" rel="noopener ugc nofollow" target="_blank"> gookit/color </a>是一个命令行颜色库，具有真彩色支持、通用API方法和Windows支持。</p><p id="f0ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本颜色预览:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/b9fcaa94606121ae850758df69ecf33f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8ctTK65gmDOJvrK-.png"/></div></div></figure><p id="1329" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从<a class="ae kl" href="https://github.com/gookit/color/releases/tag/v1.2.4" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> v1.2.4 </strong> </a>开始，256色和RGB色也已经支持在Windows CMD和PowerShell中工作:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ky"><img src="../Images/10961a14812e4ad3e9dd8d1e17e3f44e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*761MYS8Vx0GQxC-Y.jpg"/></div></div></figure><h1 id="5afc" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">如何在CMD和PWSH上工作</h1><p id="56e9" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">go类型定义。(更多请看<a class="ae kl" href="https://github.com/gookit/color/blob/master/color_rgb.go" rel="noopener ugc nofollow" target="_blank">https://github.com/gookit/color/blob/master/color_rgb.go</a>)</p><pre class="kn ko kp kq gt mc md me mf aw mg bi"><span id="c44c" class="mh la iq md b gy mi mj l mk ml"><em class="mm">// RGBColor definition.<br/>//<br/>// The first to third digits represent the color value.<br/>// The last digit represents the foreground(0), background(1), &gt;1 is unset value<br/>//<br/>// Usage:<br/>//     // 0, 1, 2 is R,G,B.<br/>//     // 3th: Fg=0, Bg=1, &gt;1: unset value<br/>//     RGBColor{30,144,255, 0}<br/>//     RGBColor{30,144,255, 1}<br/>//<br/>// NOTICE: now support RGB color on windows CMD, PowerShell<br/></em>type RGBColor [4]uint8<br/><br/><em class="mm">// create a empty RGBColor<br/></em>var emptyRGBColor = RGBColor{3: 99}<br/><br/><em class="mm">// RGB color create.<br/>// Usage:<br/>//     c := RGB(30,144,255)<br/>//     c := RGB(30,144,255, true)<br/>//     c.Print("message")<br/></em>func RGB(r, g, b uint8, isBg ...bool) RGBColor {<br/>   rgb := RGBColor{r, g, b}<br/>   if len(isBg) &gt; 0 &amp;&amp; isBg[0] {<br/>      rgb[3] = AsBg<br/>   }<br/><br/>   return rgb<br/>}<br/><em class="mm">... ...</em></span></pre><p id="9d2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">RGBColor有一些打印API方法:</p><pre class="kn ko kp kq gt mc md me mf aw mg bi"><span id="b2e5" class="mh la iq md b gy mi mj l mk ml"><em class="mm">... ...</em></span><span id="4913" class="mh la iq md b gy mn mj l mk ml"><em class="mm">// Print print message<br/></em>func (c RGBColor) Print(a ...interface{}) {<br/>   doPrintV2(c.String(), fmt.Sprint(a...))<br/>}<br/><br/><em class="mm">// Printf format and print message<br/></em>func (c RGBColor) Printf(format string, a ...interface{}) {<br/>   doPrintV2(c.String(), fmt.Sprintf(format, a...))<br/>}<br/><br/><em class="mm">// Println print message with newline<br/></em>func (c RGBColor) Println(a ...interface{}) {<br/>   doPrintlnV2(c.String(), a)<br/>}</span><span id="4192" class="mh la iq md b gy mn mj l mk ml">...</span></pre><p id="e9bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mm"> doPrintlnV2 </em>方法:</p><pre class="kn ko kp kq gt mc md me mf aw mg bi"><span id="68b3" class="mh la iq md b gy mi mj l mk ml">func doPrintlnV2(code string, args []interface{}) {<br/>   str := formatArgsForPrintln(args)<br/>   if isLikeInCmd {<br/>      renderColorCodeOnCmd(func() {<br/>         _, _ = fmt.Fprintln(output, RenderString(code, str))<br/>      })<br/>   } else {<br/>      _, _ = fmt.Fprintln(output, RenderString(code, str))<br/>   }<br/>}</span></pre><p id="b582" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果它当前在CMD或PowerShell中，它将执行<em class="mm"> renderColorCodeOnCmd </em>方法。</p><p id="84ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">核心代码:</p><pre class="kn ko kp kq gt mc md me mf aw mg bi"><span id="7308" class="mh la iq md b gy mi mj l mk ml"><em class="mm">/*************************************************************<br/> * render full color code on windows(8,16,24bit color)<br/> *************************************************************/<br/><br/>// docs https://docs.microsoft.com/zh-cn/windows/console/getconsolemode#parameters<br/></em>const (<br/>   <em class="mm">// equals to docs page's ENABLE_VIRTUAL_TERMINAL_PROCESSING 0x0004<br/>   </em>EnableVirtualTerminalProcessingMode uint32 = 0x4<br/>)<br/><br/><em class="mm">// EnableVirtualTerminalProcessing Enable virtual terminal processing<br/>//<br/>// ref from github.com/konsorten/go-windows-terminal-sequences<br/>// doc https://docs.microsoft.com/zh-cn/windows/console/console-virtual-terminal-sequences#samples<br/>//<br/>// Usage:<br/>//     err := EnableVirtualTerminalProcessing(syscall.Stdout, true)<br/>//     // support print color text<br/>//     err = EnableVirtualTerminalProcessing(syscall.Stdout, false)<br/></em>func EnableVirtualTerminalProcessing(stream syscall.Handle, enable bool) error {<br/>   var mode uint32<br/>   <em class="mm">// Check if it is currently in the terminal<br/>   </em>err := syscall.GetConsoleMode(syscall.Stdout, &amp;mode)<br/>   if err != nil {<br/>      return err<br/>   }<br/><br/>   if enable {<br/>      mode |= EnableVirtualTerminalProcessingMode<br/>   } else {<br/>      mode &amp;^= EnableVirtualTerminalProcessingMode<br/>   }<br/><br/>   ret, _, err := procSetConsoleMode.Call(uintptr(unsafe.Pointer(stream)), uintptr(mode))<br/>   if ret == 0 {<br/>      return err<br/>   }<br/><br/>   return nil<br/>}<br/><br/><em class="mm">// renderColorCodeOnCmd enable cmd color render.<br/></em>func renderColorCodeOnCmd(fn func()) {<br/>   err := EnableVirtualTerminalProcessing(syscall.Stdout, true)<br/>   <em class="mm">// if is not in terminal, will clear color tag.<br/>   </em>if err != nil {<br/>      <em class="mm">// panic(err)<br/>      </em>fn()<br/>      return<br/>   }<br/><br/>   <em class="mm">// force open color render<br/>   </em>old := ForceOpenColor()<br/>   fn()<br/>   <em class="mm">// revert color setting<br/>   </em>isSupportColor = old<br/><br/>   err = EnableVirtualTerminalProcessing(syscall.Stdout, false)<br/>   if err != nil {<br/>      panic(err)<br/>   }<br/>}</span></pre><h1 id="6ae2" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">更多用法</h1><p id="1689" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">位于<a class="ae kl" href="https://github.com/gookit/color/blob/master/_examples/rgbcolor.go" rel="noopener ugc nofollow" target="_blank">https://github . com/goo kit/color/blob/master/_ examples/RGB color . go</a>的示例文件</p><pre class="kn ko kp kq gt mc md me mf aw mg bi"><span id="9efc" class="mh la iq md b gy mi mj l mk ml">package main<br/><br/>import "github.com/gookit/color"<br/><br/><em class="mm">// go run ./_examples/rgbcolor.go<br/></em>func main() {<br/>   color.RGB(30, 144, 255).Println("message. use RGB number")<br/><br/>   color.HEX("#1976D2").Println("blue-darken")<br/>   color.HEX("#D50000", true).Println("red-accent. use HEX style")<br/><br/>   color.RGBStyleFromString("213,0,0").Println("red-accent. use RGB number")<br/>   <em class="mm">// foreground: eee, background: D50000<br/>   </em>color.HEXStyle("eee", "D50000").Println("deep-purple color")<br/>}</span></pre><div class="mo mp gp gr mq mr"><a href="https://github.com/gookit/color" rel="noopener  ugc nofollow" target="_blank"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd ir gy z fp mw fr fs mx fu fw ip bi translated">谷歌工具包/颜色</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">具有真彩色支持、通用API方法和Windows支持的命令行颜色库。</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">github.com</p></div></div><div class="na l"><div class="nb l nc nd ne na nf kw mr"/></div></div></a></div></div></div>    
</body>
</html>