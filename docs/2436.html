<html>
<head>
<title>Consuming Web APIs with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python消费Web APIs</h1>
<blockquote>原文：<a href="https://itnext.io/consuming-web-apis-with-python-fa9b751d2c75?source=collection_archive---------4-----------------------#2019-05-23">https://itnext.io/consuming-web-apis-with-python-fa9b751d2c75?source=collection_archive---------4-----------------------#2019-05-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5f63" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用Python消费和处理来自开放API的数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/91702a8a24da1b56ae443382e8fba254.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*29LI3cdH-86uJBK_VDYE4w.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.python.org" rel="noopener ugc nofollow" target="_blank">https://www.python.org</a></figcaption></figure><h2 id="c911" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">介绍</h2><p id="e191" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">在本文中，我将介绍一种使用Python 3在开放web上使用API的简单方法，Python 3是一种高度稳定和成熟的语言，具有清晰易读的语法，非常适合快速、轻松地构建web应用服务(或任何其他产品)的原型，并且最大限度地减少了挫折。</p><p id="245d" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">在这个例子中，我们将使用NASA 的免费<a class="ae ky" href="https://api.nasa.gov/index.html" rel="noopener ugc nofollow" target="_blank">开放API，并利用几个类来包装简单的python方法，以下载今天的特色天文图片以及相应的照片信息。</a></p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="c8f6" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">一头扎进去</h2><p id="e227" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">该项目的示例源可在<a class="ae ky" href="https://github.com/kenreilly/consume-api-python-demo" rel="noopener ugc nofollow" target="_blank">此处</a>获得。如果你还没有Python 3，<a class="ae ky" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank">去他们的网站</a>下载你的操作系统版本。</p><p id="906c" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">让我们来看看项目入口文件，<strong class="lx iu"> main.py </strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/3f7664079407c3254bffca032eddfe38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*feRzWWU2_3A-O-PXerP2xQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">主项目文件<strong class="bd lb"> main.py </strong></figcaption></figure><p id="fae9" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">这个文件作为主要的入口点，因此保持得相当干净，以免养成用一堆东西使项目的第一个文件过载的习惯。这里我们有带有几个方法的<strong class="lx iu">示例</strong>类:</p><ul class=""><li id="678e" class="nb nc it lx b ly mo mb mp li nd lm ne lq nf mn ng nh ni nj bi translated"><strong class="lx iu"> static_init() </strong>依次初始化<strong class="lx iu"> API </strong>类</li><li id="ca06" class="nb nc it lx b ly nk mb nl li nm lm nn lq no mn ng nh ni nj bi translated"><strong class="lx iu"> get_todays_image() </strong>获取当天的<em class="np">图片</em></li></ul><p id="0e61" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">这个文件就是这样。如果我们想对此进行扩展，我们只需添加新的方法来包装我们的<strong class="lx iu"> API </strong>类中的各种特性(或者可能是其他特性，比如接受和解析命令行选项)。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><p id="655f" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们要检查的下一个源文件是<strong class="lx iu"> src/api.py </strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/920ebc7eb52e70884caee2525f4ddf2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WAXX4wg_LbyPr4q7407-0A.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd lb"> src/api.py </strong>中<strong class="bd lb"> API </strong>类的内容</figcaption></figure><p id="643f" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">文件<strong class="lx iu"> src/api.py </strong>具有<strong class="lx iu"> API </strong>类，在本例中，它是一个简单的控制器，用于使用NASA open API上的一个端点，如方法<strong class="lx iu"> get_image_of_day()所公开的。</strong>该方法以API端点的基本URL开始，并附加以下查询字符串参数:</p><ul class=""><li id="1872" class="nb nc it lx b ly mo mb mp li nd lm ne lq nf mn ng nh ni nj bi translated"><strong class="lx iu">日期</strong>:指定检索图像的日期(默认为今天)</li><li id="6d1a" class="nb nc it lx b ly nk mb nl li nm lm nn lq no mn ng nh ni nj bi translated"><strong class="lx iu">hd</strong>:API是否应该返回HD分辨率的图像(可以更改)</li><li id="3756" class="nb nc it lx b ly nk mb nl li nm lm nn lq no mn ng nh ni nj bi translated"><strong class="lx iu"> api_key </strong>:在<strong class="lx iu">T3中指定的API key。env  </strong> <em class="np"> </em>(如果未提供，则为in .env.default)</li></ul><p id="949c" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">接下来，调用方法<strong class="lx iu"><em class="np">util . get _ json(</em></strong><em class="np">URL</em><strong class="lx iu"><em class="np">)</em></strong>来检索JSON数据，这些数据将由对指定的<em class="np"> url </em>的GET请求返回。这个<strong class="lx iu"> get_json() </strong>方法是在<strong class="lx iu"> Util </strong>中定义的一个简单的包装器，我们稍后将对此进行研究。</p><p id="2f9b" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">返回的dictionary对象包含一个<em class="np"> url </em>属性，它是一个指向实际图像文件的url，用于使用另一个实用程序类方法<strong class="lx iu">download _ file(</strong><em class="np">URL</em><strong class="lx iu">，</strong> <em class="np"> path </em> <strong class="lx iu"> ) </strong>下载和检索图像，我们也将很快对其进行检查。最后，由API返回的JSON数据的内容也被保存到一个本地文件中，文件的文件名加上一个<em class="np">。json </em>后缀。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><p id="0e6e" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">接下来我们来看看配置文件<strong class="lx iu"> src/config.py </strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/310c03ede1087b1b425062e0d4e7dbdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LSpu6fBUmquK-vscmPxRAA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">配置文件<strong class="bd lb"> src/config.py </strong></figcaption></figure><p id="9c68" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">文件<strong class="lx iu"> src/config.py </strong>负责加载<em class="np">中定义的环境变量。env </em>(或者如果不可用，在默认文件<em class="np"> .env.default </em>)并返回API使用的<em class="np"> NASA_API_KEY </em>的本地值。虽然有相关模块可以实现这一点，但我想展示引入一些在<em class="np">中定义的变量是多么简单。env </em>文件。</p><p id="5c4b" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">这就是配置文件。可以为其他API端点添加附加属性，或者完成其他配置功能，例如根据当前环境动态选择是否检索HD图像。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><p id="52f9" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">该系列的最后一个文件是实用程序文件<strong class="lx iu"> src/util.py </strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/d58d2d88999be762582355564e8bece9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F4DM-UU6eTt2_ujdn71Xqg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd lb"> src/util.py </strong>中定义的<strong class="bd lb">实用程序</strong>类</figcaption></figure><p id="e339" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">在这个<strong class="lx iu"> Util </strong>类中，我们有一些执行各种功能的方法:</p><ul class=""><li id="be4a" class="nb nc it lx b ly mo mb mp li nd lm ne lq nf mn ng nh ni nj bi translated"><strong class="lx iu"> today_str </strong>():返回当前日期，格式为<em class="np">‘YYYY-MM-DD’</em></li><li id="ee39" class="nb nc it lx b ly nk mb nl li nm lm nn lq no mn ng nh ni nj bi translated"><strong class="lx iu">get(</strong><em class="np">URL</em><strong class="lx iu">)</strong>:<strong class="lx iu"/>读取并返回GET请求对<strong class="lx iu"> <em class="np"> url </em> </strong>的响应</li><li id="6847" class="nb nc it lx b ly nk mb nl li nm lm nn lq no mn ng nh ni nj bi translated"><strong class="lx iu">download _ file(</strong><em class="np">URL，path </em> <strong class="lx iu"> ) </strong>:从<strong class="lx iu"> <em class="np"> url </em> </strong>下载一个文件，保存到<strong class="lx iu"> <em class="np"> path </em> </strong></li><li id="14e2" class="nb nc it lx b ly nk mb nl li nm lm nn lq no mn ng nh ni nj bi translated"><strong class="lx iu"> write_json( </strong> <em class="np">数据，路径</em> <strong class="lx iu"> ) </strong>:将字符串<strong class="lx iu"> <em class="np">数据</em> </strong>写到<strong class="lx iu"> <em class="np">路径</em> </strong>的一个文件中</li></ul><p id="cb75" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">正如我们所看到的，这个文件执行了大部分基本的底层工作，比如处理网络请求和文件系统操作。这使得主应用程序逻辑更加清晰和易于维护——例如，我们可以将HTTP请求实现替换为另一个库或其他服务，程序的其余部分将继续正常工作，就像什么都没发生一样，因为从它自己的角度来看，接口仍然按照预期排列。因此，可以安全地执行较低层次的修改，同时保持应用程序结构的其余部分不变(或者同时改进和添加<em class="np">和</em>)。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="6b0e" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h2><p id="086a" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">在这个例子中，我们看了如何使用来自一个API提供者的一个端点(NASA的每日图片)。除了<a class="ae ky" href="https://github.com/n0shake/Public-APIs" rel="noopener ugc nofollow" target="_blank">众多其他API提供商</a>提供从音乐、视频到科学数据的各种功能和内容之外，仅NASA就有更多的终端可用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/e92d0290bc04936cbd17c1576ece72d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p-E5BgThj6yrKvjulArk-g.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">每日一图(上面有JSON数据)</figcaption></figure><p id="9ad1" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我希望你喜欢这篇文章。这个例子的源代码是GitHub 上的<a class="ae ky" href="https://github.com/kenreilly/consume-api-python-demo" rel="noopener ugc nofollow" target="_blank">，欢迎任何评论、建议或其他想法。</a></p><p id="d2a0" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">感谢您的阅读，祝您的下一个python项目好运！</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><blockquote class="nr"><p id="5ae2" class="ns nt it bd nu nv nw nx ny nz oa mn dk translated">肯尼斯·雷利(<a class="ae ky" href="https://twitter.com/8_bit_hacker" rel="noopener ugc nofollow" target="_blank"> 8_bit_hacker </a>)是<a class="ae ky" href="https://lvl-up.tech/" rel="noopener ugc nofollow" target="_blank"> LevelUP </a>的CTO</p></blockquote></div></div>    
</body>
</html>