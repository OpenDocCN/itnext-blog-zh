<html>
<head>
<title>Minimalist Guide to Isolates in Dart/Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Dart/Flutter中隔离物的最简指南</h1>
<blockquote>原文：<a href="https://itnext.io/minimalist-guide-to-isolates-in-dart-flutter-dd5bdee031e?source=collection_archive---------4-----------------------#2022-02-27">https://itnext.io/minimalist-guide-to-isolates-in-dart-flutter-dd5bdee031e?source=collection_archive---------4-----------------------#2022-02-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/739cd7de5bae277b7e7cdb25dc17d513.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xbr7CepGmpR7p5rUV6l0ig.jpeg"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">抱歉，封面太丑了，但我就是控制不住自己去做</figcaption></figure><div class=""/><div class=""><h2 id="5ab1" class="pw-subtitle-paragraph kf jh ji bd b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dk translated">让我们深入探讨Dart/Flutter中的多线程！</h2></div><h2 id="a186" class="kx ky ji bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">众所周知</h2><p id="0e5c" class="pw-post-body-paragraph lt lu ji lv b lw lx kj ly lz ma km mb lg mc md me lk mf mg mh lo mi mj mk ml im bi translated">Dart/Flutter是单线程的，这意味着所有Dart代码都在一个隔离中运行</p><h2 id="e56c" class="kx ky ji bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">但这到底意味着什么呢？</h2><p id="92bd" class="pw-post-body-paragraph lt lu ji lv b lw lx kj ly lz ma km mb lg mc md me lk mf mg mh lo mi mj mk ml im bi translated">当我们运行<code class="fe mm mn mo mp b">main()</code>功能时。实际上，我们负责主要隔离。</p><p id="d220" class="pw-post-body-paragraph lt lu ji lv b lw mq kj ly lz mr km mb lg ms md me lk mt mg mh lo mu mj mk ml im bi translated">主隔离的责任是对事件作出反应。</p><p id="c245" class="pw-post-body-paragraph lt lu ji lv b lw mq kj ly lz mr km mb lg ms md me lk mt mg mh lo mu mj mk ml im bi translated">所以每个任务都是分别运行的，而不是并行的</p><figure class="mw mx my mz gt iv gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/9195c1a96b2981fcc8a707a5da9f85a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:326/format:webp/0*5WHMK7rRnNoG36dN.png"/></div></figure><p id="cc6e" class="pw-post-body-paragraph lt lu ji lv b lw mq kj ly lz mr km mb lg ms md me lk mt mg mh lo mu mj mk ml im bi translated">如果主隔离执行繁重的任务。主隔离区将被封锁。</p><p id="11c0" class="pw-post-body-paragraph lt lu ji lv b lw mq kj ly lz mr km mb lg ms md me lk mt mg mh lo mu mj mk ml im bi translated">它不应该被阻止，因为如果它被阻止，用户界面将会滞后和冻结，用户会抱怨它，你会受到不好的评论，每天晚上都会在床上哭泣，并问自己为什么所有这些都发生在你身上？！！</p><p id="d4e6" class="pw-post-body-paragraph lt lu ji lv b lw mq kj ly lz mr km mb lg ms md me lk mt mg mh lo mu mj mk ml im bi translated">所以如果你不想要那种场景，请考虑使用隔离来完成繁重的任务。这样每个人都会开心。</p><figure class="mw mx my mz gt iv gh gi paragraph-image"><div class="gh gi na"><img src="../Images/8382fc754c2cc5a48b2246e4b882aa1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/0*FEyOPjT6x4hna7aA.png"/></div></figure><p id="5cbe" class="pw-post-body-paragraph lt lu ji lv b lw mq kj ly lz mr km mb lg ms md me lk mt mg mh lo mu mj mk ml im bi translated">如果我们到了孤立点，让我们开始问答</p><h2 id="4d39" class="kx ky ji bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">什么是孤立？</h2><figure class="mw mx my mz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nb"><img src="../Images/57c91051fd0bc5f05d6f75e73c1e7960.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qlDw3XibcidZdhPTPpTyGw.jpeg"/></div></div></figure><ul class=""><li id="31c5" class="nc nd ji lv b lw mq lz mr lg ne lk nf lo ng ml nh ni nj nk bi translated">隔离使你的代码并行(同时)运行。没有分别</li></ul><h2 id="2dab" class="kx ky ji bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">我们为什么需要它？</h2><ul class=""><li id="6fd1" class="nc nd ji lv b lw lx lz ma lg nl lk nm lo nn ml nh ni nj nk bi translated">为了防止主隔离的瓶颈</li></ul><h2 id="73c9" class="kx ky ji bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">何时使用隔离物？</h2><ul class=""><li id="74ad" class="nc nd ji lv b lw lx lz ma lg nl lk nm lo nn ml nh ni nj nk bi translated">执行繁重的任务，如图像处理等。</li></ul><h2 id="dd59" class="kx ky ji bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">为什么我们称之为隔离而不是线程？</h2><ul class=""><li id="4f3d" class="nc nd ji lv b lw lx lz ma lg nl lk nm lo nn ml nh ni nj nk bi translated">主要区别是隔离不像线程那样共享内存。</li></ul><h2 id="f1d7" class="kx ky ji bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">隔离和异步有什么区别？</h2><figure class="mw mx my mz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi no"><img src="../Images/6887131a707dd7ab525e6157766c42af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kT3wPHC7rjQNGX-l.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae np" href="https://stackoverflow.com/questions/59139242/stdasync-does-not-seem-to-really-implement-single-threaded-asynchronous-beha" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/59139242/STD async-do-not-see-to-really-implement-single-threaded-asynchronous-beha</a></figcaption></figure><ul class=""><li id="ed42" class="nc nd ji lv b lw mq lz mr lg ne lk nf lo ng ml nh ni nj nk bi translated">Async只是将一个长的同步任务分割成较小的任务，这有助于保持60 FPS，而不是像隔离那样并行运行</li></ul><figure class="mw mx my mz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nq"><img src="../Images/6a4fc22f91fbf15aee0c6115291f0f12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eKUSvl7o5PORD0KlMrDq5w.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">异步ˌ非同步(asynchronous)</figcaption></figure><figure class="mw mx my mz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nr"><img src="../Images/293f1ed57e951cebcc67a059b95db0be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*55yI-JlQvE0bJxbZZ_DgpA.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">孤立的</figcaption></figure><h2 id="8d08" class="kx ky ji bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">为什么Dart不在隔离区之间共享内存？</h2><ul class=""><li id="d528" class="nc nd ji lv b lw lx lz ma lg nl lk nm lo nn ml nh ni nj nk bi translated"><em class="ns">大多数现代设备都有多核CPU。为了利用所有这些内核，开发人员有时会使用并发运行的共享内存线程。然而，共享状态并发是</em> <a class="ae np" href="https://en.wikipedia.org/wiki/Race_condition#In_software" rel="noopener ugc nofollow" target="_blank"> <em class="ns">易错的</em> </a> <em class="ns">并且会导致复杂的代码。</em></li><li id="395f" class="nc nd ji lv b lw nt lz nu lg nv lk nw lo nx ml nh ni nj nk bi translated"><em class="ns">所有Dart代码都在隔离区内运行，而不是线程。每个隔离都有自己的内存堆，确保任何其他隔离都无法访问某个隔离中的任何状态。因为没有共享内存，你不必担心</em> <a class="ae np" href="https://en.wikipedia.org/wiki/Lock_(computer_science)" rel="noopener ugc nofollow" target="_blank"> <em class="ns">互斥或锁</em> </a> <em class="ns">。</em></li><li id="8f76" class="nc nd ji lv b lw nt lz nu lg nv lk nw lo nx ml nh ni nj nk bi translated"><em class="ns">工人隔离可以执行I/O(例如，读写文件)、设置定时器等等。它有自己的内存，不与主隔离共享任何状态。工作隔离可以阻止，而不会影响其他隔离。</em></li></ul><blockquote class="ny nz oa"><p id="fa26" class="lt lu ns lv b lw mq kj ly lz mr km mb ob ms md me oc mt mg mh od mu mj mk ml im bi translated">描述来自:<a class="ae np" href="https://dart.dev/guides/language/concurrency" rel="noopener ugc nofollow" target="_blank">https://dart.dev/guides/language/concurrency</a></p></blockquote></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><h1 id="c58b" class="ol ky ji bd kz om on oo lc op oq or lf ko os kp lj kr ot ks ln ku ou kv lr ov bi translated">说够了吗？那我们编码吧！</h1><h2 id="a103" class="kx ky ji bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">但是在我们开始之前，我们需要知道一些使用规则</h2><ul class=""><li id="045b" class="nc nd ji lv b lw lx lz ma lg nl lk nm lo nn ml nh ni nj nk bi translated">该函数必须是顶级函数或静态方法</li><li id="3c6b" class="nc nd ji lv b lw nt lz nu lg nv lk nw lo nx ml nh ni nj nk bi translated">您只能将一个参数传递给一个隔离对象(但是不要担心，您可以使用map发送任意多的数据)</li></ul><h2 id="dffe" class="kx ky ji bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">有两种方法可以使用隔离</h2><p id="4eb0" class="pw-post-body-paragraph lt lu ji lv b lw lx kj ly lz ma km mb lg mc md me lk mf mg mh lo mi mj mk ml im bi translated">他们做着几乎相同的事情。只是用法有点不同</p><ul class=""><li id="3b42" class="nc nd ji lv b lw mq lz mr lg ne lk nf lo ng ml nh ni nj nk bi translated"><code class="fe mm mn mo mp b">compute()</code>:简单的方法</li><li id="7f01" class="nc nd ji lv b lw nt lz nu lg nv lk nw lo nx ml nh ni nj nk bi translated"><code class="fe mm mn mo mp b">Isolate.spawn()</code>:高级方式</li></ul><p id="0a19" class="pw-post-body-paragraph lt lu ji lv b lw mq kj ly lz mr km mb lg ms md me lk mt mg mh lo mu mj mk ml im bi translated">现在让我们开始吧！</p><h2 id="29cc" class="kx ky ji bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">计算</h2><p id="8e45" class="pw-post-body-paragraph lt lu ji lv b lw lx kj ly lz ma km mb lg mc md me lk mf mg mh lo mi mj mk ml im bi translated">生成一个隔离并在该隔离上运行回调的函数。</p><figure class="mw mx my mz gt iv"><div class="bz fp l di"><div class="ow ox l"/></div></figure><h2 id="9bf3" class="kx ky ji bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">隔离.产卵</h2><figure class="mw mx my mz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oy"><img src="../Images/2f34ae133f9fe1e2aba481dcc9b39ce6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4aAFqJQZSlMxkzALjLiNJw.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">-图片来自塔达斯佩特拉</figcaption></figure><p id="a08a" class="pw-post-body-paragraph lt lu ji lv b lw mq kj ly lz mr km mb lg ms md me lk mt mg mh lo mu mj mk ml im bi translated"><code class="fe mm mn mo mp b">spawn</code>给了我们比<code class="fe mm mn mo mp b">compute</code>更多的灵活性。</p><p id="fa1c" class="pw-post-body-paragraph lt lu ji lv b lw mq kj ly lz mr km mb lg ms md me lk mt mg mh lo mu mj mk ml im bi translated">我们需要创造一个<code class="fe mm mn mo mp b">ReceivePort()</code>来与其他隔离物交流。</p><p id="902c" class="pw-post-body-paragraph lt lu ji lv b lw mq kj ly lz mr km mb lg ms md me lk mt mg mh lo mu mj mk ml im bi translated">与<a class="ae np" href="https://api.dart.dev/stable/2.16.1/dart-isolate/SendPort-class.html" rel="noopener ugc nofollow" target="_blank">发送端口</a>一起，处理隔离之间的所有通信。</p><blockquote class="ny nz oa"><p id="168b" class="lt lu ns lv b lw mq kj ly lz mr km mb ob ms md me oc mt mg mh od mu mj mk ml im bi translated">一个<a class="ae np" href="https://api.dart.dev/stable/2.16.1/dart-isolate/ReceivePort-class.html" rel="noopener ugc nofollow" target="_blank">接收端口</a>可能有多个<a class="ae np" href="https://api.dart.dev/stable/2.16.1/dart-isolate/SendPort-class.html" rel="noopener ugc nofollow" target="_blank">发送端口</a>。</p></blockquote><ol class=""><li id="f377" class="nc nd ji lv b lw mq lz mr lg ne lk nf lo ng ml oz ni nj nk bi translated">创建接收报告</li><li id="c74d" class="nc nd ji lv b lw nt lz nu lg nv lk nw lo nx ml oz ni nj nk bi translated">产生一个隔离发送数据和端口。</li><li id="f83f" class="nc nd ji lv b lw nt lz nu lg nv lk nw lo nx ml oz ni nj nk bi translated">计算一项繁重的任务</li><li id="0d4e" class="nc nd ji lv b lw nt lz nu lg nv lk nw lo nx ml oz ni nj nk bi translated">使用发送端口发送计算的数据</li><li id="c38b" class="nc nd ji lv b lw nt lz nu lg nv lk nw lo nx ml oz ni nj nk bi translated">使用端口读取计算的数据，并继续您的工作</li></ol><figure class="mw mx my mz gt iv"><div class="bz fp l di"><div class="ow ox l"/></div></figure></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><h1 id="510c" class="ol ky ji bd kz om on oo lc op oq or lf ko os kp lj kr ot ks ln ku ou kv lr ov bi translated">一些值得注意的信息</h1><figure class="mw mx my mz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pa"><img src="../Images/1b82007ff8d872abbb160a605bcd7ee2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t9tA7FVUnhlfzlqbscicaw.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae np" href="https://www.youtube.com/watch?v=SXT7nir1B48" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=SXT7nir1B48</a></figcaption></figure><ul class=""><li id="392d" class="nc nd ji lv b lw mq lz mr lg ne lk nf lo ng ml nh ni nj nk bi translated">繁殖一种隔离物需要大约50-150毫秒</li><li id="9b13" class="nc nd ji lv b lw nt lz nu lg nv lk nw lo nx ml nh ni nj nk bi translated">重复使用隔离以降低启动成本</li><li id="14b7" class="nc nd ji lv b lw nt lz nu lg nv lk nw lo nx ml nh ni nj nk bi translated">每个隔离区占用大约2MB</li><li id="83fe" class="nc nd ji lv b lw nt lz nu lg nv lk nw lo nx ml nh ni nj nk bi translated">从隔离区传递的每个消息都需要消息大小* 2的内存，因为隔离区不共享内存，所以在系统上将有两个副本，因此，如果您有1 GB的文件，并且想要从一个隔离区传递到第二个隔离区，则需要设备上2Gb的内存</li></ul></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><h1 id="320e" class="ol ky ji bd kz om on oo lc op oq or lf ko os kp lj kr ot ks ln ku ou kv lr ov bi translated">参考</h1><figure class="mw mx my mz gt iv"><div class="bz fp l di"><div class="pb ox l"/></div></figure><figure class="mw mx my mz gt iv"><div class="bz fp l di"><div class="pb ox l"/></div></figure><figure class="mw mx my mz gt iv"><div class="bz fp l di"><div class="pb ox l"/></div></figure><div class="is it gp gr iu pc"><a href="https://dev.to/alphamikle/why-should-you-use-isolates-in-flutter-1k5o" rel="noopener  ugc nofollow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd jj gy z fp ph fr fs pi fu fw jh bi translated">为什么要在颤振中使用隔离物？</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">在Flutter中有许多管理状态的方法，但是大多数都是以这样一种方式构建的，即所有的逻辑都被执行…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">开发到</p></div></div><div class="pl l"><div class="pm l pn po pp pl pq ja pc"/></div></div></a></div><div class="is it gp gr iu pc"><a href="https://dart.dev/guides/language/concurrency" rel="noopener  ugc nofollow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd jj gy z fp ph fr fs pi fu fw jh bi translated">Dart中的并发性</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">Dart支持使用async-await、isolates和类(如Future和Stream)进行并发编程。本页给出了…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">dart.dev</p></div></div><div class="pl l"><div class="pr l pn po pp pl pq ja pc"/></div></div></a></div><div class="is it gp gr iu pc"><a href="https://api.flutter.dev/flutter/dart-isolate/Isolate-class.html" rel="noopener  ugc nofollow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd jj gy z fp ph fr fs pi fu fw jh bi translated">隔离类-Dart:隔离库Dart API</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">独立的Dart执行上下文。所有的Dart代码都在一个隔离中运行，代码只能从…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">api.flutter.dev</p></div></div></div></a></div></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><h2 id="f83e" class="kx ky ji bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">感谢您的阅读！</h2><p id="66d4" class="pw-post-body-paragraph lt lu ji lv b lw lx kj ly lz ma km mb lg mc md me lk mf mg mh lo mi mj mk ml im bi translated">我试图尽可能简单地解释。希望你喜欢。</p><p id="d290" class="pw-post-body-paragraph lt lu ji lv b lw mq kj ly lz mr km mb lg ms md me lk mt mg mh lo mu mj mk ml im bi translated">如果你喜欢这篇文章，请点击👏按钮(你知道你可以升到50吗？)</p></div></div>    
</body>
</html>