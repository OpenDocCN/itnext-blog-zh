<html>
<head>
<title>Notes on Migrating Angular Project to Nx Workspace &amp; Angular v12 &amp; Github Pages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于将Angular项目迁移到Nx Workspace &amp; Angular v12 &amp; Github页面的说明</h1>
<blockquote>原文：<a href="https://itnext.io/notes-on-migrating-angular-project-to-nx-workspace-angular-v12-github-pages-235e09f6b8cb?source=collection_archive---------1-----------------------#2021-05-23">https://itnext.io/notes-on-migrating-angular-project-to-nx-workspace-angular-v12-github-pages-235e09f6b8cb?source=collection_archive---------1-----------------------#2021-05-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/39139207d7165a7e978e603a15dae12d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tOhwv_cNyoseNyTK"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/photos/hq96V-dazC4" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/hq96V-dazC4</a></figcaption></figure><p id="4ad8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我接触投资组合网站已经有一段时间了。因此，今天我决定升级这个项目，并在这个过程中利用更好的技术。这些变化背后的原因如下:</p><ul class=""><li id="a8d9" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">Monorepos architect可以轻松扩展和管理</li><li id="bee9" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">Angular Lazyload模块-&gt;更多的项目不会影响现有的性能。</li><li id="fac4" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">快速部署和构建流程+ CI / CD支持</li><li id="6bd6" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">项目间共享库、模型和服务</li><li id="0549" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">JavaScript开发人员友好</li><li id="ffcb" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">更大的</li></ul><p id="5191" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">事不宜迟，这是将现有的Angular项目迁移到Nx Workspace &amp; Angular v12并将其部署到Github页面的过程</p><h1 id="256a" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">将现有Angular升级到最新版本(Angular v 12——在撰写本文时)</h1><p id="6aa7" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">我试图跟踪Nx工作区，并希望通过运行一行代码就可以将现有项目迁移到Nx工作区，但这并没有发生:(</p><p id="b16f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我必须遵循手动迁移流程。我不想将现有的Angular迁移并更新到最新版本。最好先升级，然后再进行迁移。</p><p id="659e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以查看<a class="ae kc" href="https://update.angular.io/" rel="noopener ugc nofollow" target="_blank">角度更新指南</a>进行迁移。然而，只要运行这行代码，它就会告诉你该怎么做。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="a3a6" class="nb lq iq mx b gy nc nd l ne nf">ng update</span></pre><h1 id="6cf1" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">迁移到Nx工作空间</h1><p id="f592" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">升级到Angular的最新版本后，就到了<a class="ae kc" href="https://nx.dev/latest/angular/migration/migration-angular" rel="noopener ugc nofollow" target="_blank">迁移到Nx工作空间</a>的时候了。最佳实践是创建另一个分支来测试手动过程，这样就不会与您当前的分支混淆。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="8f1d" class="nb lq iq mx b gy nc nd l ne nf">git checkout -b nx </span></pre><p id="8f0c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果幸运的话，这个命令有助于将Angular CLI工作空间转换为Nx工作空间。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="d4fc" class="nb lq iq mx b gy nc nd l ne nf">ng add @nrwl/workspace</span></pre><p id="715e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你不幸运——像我一样，你可以一直遵循手动流程。</p><p id="7795" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">第一步:将现有文件夹移动到临时文件夹</strong></p><p id="8e05" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你所需要的就是<strong class="kf ir"> src </strong>文件夹，其他文件如果不需要可以删除。</p><p id="11aa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">第二步:生成一个分支新的Nx工作空间</strong></p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="ebf6" class="nb lq iq mx b gy nc nd l ne nf">npx create-nx-workspace myorg --preset=angular --linter eslint</span></pre><p id="e619" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当提示输入<code class="fe ng nh ni mx b">application name</code>时，输入当前<code class="fe ng nh ni mx b">angular.json</code>文件中的<em class="nj">项目名称</em>。</p><p id="0914" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第三步:复制申请文件</p><p id="a16a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您的应用程序代码自包含在Angular CLI工作区的<code class="fe ng nh ni mx b">src</code>文件夹中。</p><ul class=""><li id="3b7c" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">将Angular CLI项目中的<code class="fe ng nh ni mx b">src</code>文件夹复制到<code class="fe ng nh ni mx b">apps/&lt;app name&gt;</code>文件夹，覆盖现有的<code class="fe ng nh ni mx b">src</code>文件夹。</li><li id="45fa" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">将任何特定于项目的文件，如<code class="fe ng nh ni mx b">browserslist</code>或服务人员配置文件复制到<code class="fe ng nh ni mx b">apps/&lt;app name&gt;</code>文件夹下的相对路径中。</li><li id="9cfe" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">将<code class="fe ng nh ni mx b">assets</code>、<code class="fe ng nh ni mx b">scripts</code>、<code class="fe ng nh ni mx b">styles</code>和特定于构建的配置(如服务人员配置)从您的Angular CLI <code class="fe ng nh ni mx b">angular.json</code>传输到Nx workspace <code class="fe ng nh ni mx b">angular.json</code>文件。</li></ul><p id="7813" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">步骤4:运行并测试新项目</strong></p><p id="0f78" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过运行以下命令来验证您的应用程序是否正常运行:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="acdc" class="nb lq iq mx b gy nc nd l ne nf">ng serve &lt;app name&gt;</span></pre><p id="4318" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后继续检查你的测试&amp;林挺。确保一切正常。如果不是，请遵循<a class="ae kc" href="https://nx.dev/latest/angular/migration/migration-angular" rel="noopener ugc nofollow" target="_blank"> Nx指令</a>。</p><p id="534a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">配置Github动作，将项目部署到Github页面</strong></p><p id="fff1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我已经为Github动作设置了CI/CD。有了这个结构，我必须做一些改变，以适应新的目标输出。现在，我的应用程序将位于:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="23af" class="nb lq iq mx b gy nc nd l ne nf">dist/apps/&lt;app-name&gt;</span></pre><p id="b37d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是Github操作的YAML文件</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="ef1f" class="nb lq iq mx b gy nc nd l ne nf"># .github/workflows/ci.yaml</span><span id="a539" class="nb lq iq mx b gy nk nd l ne nf">name: Pull request or push to Dev Branch</span><span id="4fd2" class="nb lq iq mx b gy nk nd l ne nf">on:<br/>  push:<br/>    branches:<br/>      - dev</span><span id="0703" class="nb lq iq mx b gy nk nd l ne nf">jobs:<br/>  build-and-deploy:<br/>    timeout-minutes: 30<br/>    name: Deploy website and sentry<br/>    runs-on: ubuntu-latest</span><span id="4d6e" class="nb lq iq mx b gy nk nd l ne nf">steps:<br/>      - name: Checkout<br/>        uses: actions/checkout@v1</span><span id="1ba6" class="nb lq iq mx b gy nk nd l ne nf">- uses: actions/setup-node@v1<br/>        with:<br/>          node-version: '14.x'</span><span id="c237" class="nb lq iq mx b gy nk nd l ne nf">- uses: actions/cache@v2<br/>        with:<br/>          path: '**/node_modules'<br/>          key: ${{ runner.os }}-modules-${{ hashFiles('**/yarn.lock') }}</span><span id="1870" class="nb lq iq mx b gy nk nd l ne nf">- name: Install dependencies<br/>        if: steps.yarn-cache.outputs.cache-hit != 'true'<br/>        run: yarn install</span><span id="68a6" class="nb lq iq mx b gy nk nd l ne nf">- name: Build<br/>        run: yarn build</span><span id="6e82" class="nb lq iq mx b gy nk nd l ne nf">- name: Generate 404 files<br/>        run: |<br/>          echo "---" &gt; "./dist/apps/portfolio/404.html"<br/>          echo "permalink: /404.html" &gt;&gt; "./dist/apps/&lt;app-name&gt;/404.html"<br/>          echo "---" &gt;&gt; "./dist/apps/&lt;app-name&gt;/404.html"<br/>          cat "./dist/apps/&lt;app-name&gt;/index.html" &gt;&gt; "./dist/apps/&lt;app-name&gt;/404.html"</span><span id="78cf" class="nb lq iq mx b gy nk nd l ne nf">- name: Deploy<br/>        uses: JamesIves/github-pages-deploy-action@releases/v3<br/>        with:<br/>          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}<br/>          BRANCH: master<br/>          FOLDER: dist/apps/&lt;app-name&gt;</span></pre><p id="e878" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里有一些关于YAML档案的笔记</p><p id="a647" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装依赖项时，使用操作缓存以节省时间。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="5b36" class="nb lq iq mx b gy nc nd l ne nf">- uses: actions/cache@v2<br/>        with:<br/>          path: '**/node_modules'<br/>          key: ${{ runner.os }}-modules-${{ hashFiles('**/yarn.lock') }}</span></pre><p id="4a4d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">确保构建完成后，创建一个与<code class="fe ng nh ni mx b">index.html</code>相同的<code class="fe ng nh ni mx b">404.html</code>文件。否则，如果您直接从URL 手动访问<a class="ae kc" href="https://angular.io/guide/deployment#deploy-to-github-pages" rel="noopener ugc nofollow" target="_blank">页面，它将不会解析路由。</a></p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="42cc" class="nb lq iq mx b gy nc nd l ne nf">- name: Generate 404 files<br/>        run: |<br/>          echo "---" &gt; "./dist/apps/portfolio/404.html"<br/>          echo "permalink: /404.html" &gt;&gt; "./dist/apps/&lt;app-name&gt;/404.html"<br/>          echo "---" &gt;&gt; "./dist/apps/&lt;app-name&gt;/404.html"<br/>          cat "./dist/apps/&lt;app-name&gt;/index.html" &gt;&gt; "./dist/apps/&lt;app-name&gt;/404.html"</span></pre><p id="b857" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在新的设置之后，CI/CD时间显著减少，从大约7分钟减少到不到1分钟。您可以看一下运行示例。</p><div class="nl nm gp gr nn no"><a href="https://github.com/dalenguyen/dalenguyen.github.io/actions/runs/867843285" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">dalen guyen/dalen guyen . github . io</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">个人网站与Github页面和Angular。通过创建……为dalen guyen/dalen guyen . github . io开发做出贡献</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">github.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc jw no"/></div></div></a></div><p id="aa5e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是我的笔记的结尾，希望你会觉得有用。</p></div></div>    
</body>
</html>