<html>
<head>
<title>I Created a “Bot” to Send a Message When the Bus Comes Every Morning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我创造了一个“机器人”,在每天早上公共汽车来的时候发送信息</h1>
<blockquote>原文：<a href="https://itnext.io/i-created-a-bot-to-send-a-message-when-the-bus-comes-every-morning-7469d00a72cf?source=collection_archive---------0-----------------------#2019-07-19">https://itnext.io/i-created-a-bot-to-send-a-message-when-the-bus-comes-every-morning-7469d00a72cf?source=collection_archive---------0-----------------------#2019-07-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/56f0bb0db835cd325c5828e5af36d43d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*VPcWQQlU8Gh6qpRiv1xzng.jpeg"/></div></figure><p id="308c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">嗯，我不确定如何称呼这个过程，所以我决定称它为“机器人”。</p><p id="90c4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">事情是这样的:每天早上，在出门之前，我必须给TTC发信息或者查看谷歌地图，看看公交车什么时候来。</p><p id="5410" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我厌倦了这种平凡的任务，所以我写了一个公交车调度器给我发iMessage通知公交车什么时候来，这样我就可以有时间享受生活了——不仅仅是因为我懒。</p><p id="fa76" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你想试试，这里有你需要的:<strong class="jw ir"> python </strong>和一台<strong class="jw ir"> MacOS </strong>机器。</p><p id="4495" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了成全我的“懒惰”，我还创建了一个python包名:<a class="ae ks" href="https://github.com/dalenguyen/bustracker" rel="noopener ugc nofollow" target="_blank"><strong class="jw ir">bustracker</strong></a>——它将有助于获得公交时刻表的预测。请查看<a class="ae ks" href="http://webservices.nextbus.com/service/publicXMLFeed?command=agencyList" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir">代理列表</strong> </a>查看该包是否支持您的本地总线系统。</p><p id="a3ec" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">入门</strong></p><p id="48f8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">安装bustracker python包</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="4211" class="lc ld iq ky b gy le lf l lg lh">pip install bustracker</span></pre><p id="2580" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">准备信息</strong></p><p id="4e9a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">创建一个<strong class="jw ir"><em class="li">bus _ reminder . py</em></strong>文件来处理公交调度请求</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="1537" class="lc ld iq ky b gy le lf l lg lh"># bus_reminder.py</span><span id="9f57" class="lc ld iq ky b gy lj lf l lg lh">from bustracker import BusTracker</span><span id="6d92" class="lc ld iq ky b gy lj lf l lg lh">agency = 'ttc'<br/>bus = BusTracker(agency)</span><span id="d530" class="lc ld iq ky b gy lj lf l lg lh"># get prediction for bus stops<br/>stops = [<br/>    {'routeTag': 506, 'stopTag': 3292}<br/>]</span><span id="2b3d" class="lc ld iq ky b gy lj lf l lg lh">result = bus.get_predictions(stops)</span><span id="41a4" class="lc ld iq ky b gy lj lf l lg lh">incomings = result['predictions']['direction']['prediction']</span><span id="a1c5" class="lc ld iq ky b gy lj lf l lg lh">bus_name = result['predictions']['routeTag']</span><span id="4177" class="lc ld iq ky b gy lj lf l lg lh">next_buses = ''</span><span id="b6de" class="lc ld iq ky b gy lj lf l lg lh">for bus in incomings:<br/>    next_buses += str(bus['minutes']) + ','</span><span id="9130" class="lc ld iq ky b gy lj lf l lg lh">message = bus_name + ' will come in ' + next_buses + ' minutes'</span></pre><p id="3025" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果您打印该消息，您将得到如下内容</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="137b" class="lc ld iq ky b gy le lf l lg lh">print(message)<br/># 506 will come in 4,7,9,15,21, minutes</span></pre><p id="a307" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">通过iMessage发送信息</strong></p><p id="4f53" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你已经准备好了一条信息，如果你不想通过iMessage发送，你可以找到适合你的。</p><p id="05bf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae ks" href="https://gist.github.com/aktau/8958054" rel="noopener ugc nofollow" target="_blank"> sendiMessage </a>脚本来自<strong class="jw ir"> aktau </strong>。你可以从要点中读出细节。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="bb37" class="lc ld iq ky b gy le lf l lg lh"># bus_reminder.py</span><span id="10b1" class="lc ld iq ky b gy lj lf l lg lh">"""<br/>Start sending bus reminder<br/>"""</span><span id="23a0" class="lc ld iq ky b gy lj lf l lg lh">import subprocess<br/>args = ['<strong class="ky ir">your-phone-number</strong>', message]</span><span id="d225" class="lc ld iq ky b gy lj lf l lg lh">scpt = '/Users/dnguyen/Documents/projects/bus-reminder/sendiMessage.scpt'</span><span id="4f80" class="lc ld iq ky b gy lj lf l lg lh">p = subprocess.Popen(<br/>        ['/usr/bin/osascript', scpt] + [str(arg) for arg in args], <br/>        stdout=subprocess.PIPE, stderr=subprocess.PIPE)</span><span id="d269" class="lc ld iq ky b gy lj lf l lg lh">out, err = p.communicate()</span><span id="e61e" class="lc ld iq ky b gy lj lf l lg lh">if p.returncode:<br/>    print ('ERROR:', err)<br/>else:<br/>    print (out) # 4</span></pre><p id="78df" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">该脚本将调用<strong class="jw ir"> sendiMessage.scpt </strong>将消息发送到您的手机号码。请确定您的Mac上有iMessage，并且您已经使用该号码进行了对话，否则您的信息将不会被发送。</p><p id="1956" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">附表部分</strong></p><p id="82f4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，我想让我的“机器人”在周一到周五的早上7:30给我发消息，这样我就不用这么做了。这简直是一个cron的工作；)</p><p id="cc06" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">开始编辑您的cron作业:<strong class="jw ir"> crontab -e </strong></p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="2fb8" class="lc ld iq ky b gy le lf l lg lh">30 7 * * 1-5 /usr/local/bin/python3 /Users/dnguyen/Documents/projects/bus-reminder/bus_reminder.py # bus reminder</span></pre><p id="1fb4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">从现在开始，我每个工作日都会收到一条信息，显示下一辆公交车什么时候来，这样我就可以“冲”了——我甚至不需要拿出手机，我的Fitbit总是会给我显示这条信息。</p><p id="3945" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">以防你偷懒，这里有来自<a class="ae ks" href="https://github.com/dalenguyen/bus-schedule-autoalert" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir"> github </strong> </a>的完整工作项目。</p><div class="lk ll gp gr lm ln"><a href="https://github.com/dalenguyen/bus-schedule-autoalert" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab fo"><div class="lp ab lq cl cj lr"><h2 class="bd ir gy z fp ls fr fs lt fu fw ip bi translated">dalen guyen/公交-时刻表-自动报警</h2><div class="lu l"><h3 class="bd b gy z fp ls fr fs lt fu fw dk translated">每天早上上班前发送iMessage提醒公交时刻表。-dalen guyen/公交-时刻表-自动报警</h3></div><div class="lv l"><p class="bd b dl z fp ls fr fs lt fu fw dk translated">github.com</p></div></div><div class="lw l"><div class="lx l ly lz ma lw mb js ln"/></div></div></a></div></div></div>    
</body>
</html>