<html>
<head>
<title>How to properly define state in React components</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React组件中正确定义状态</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-properly-define-state-in-react-components-47544eb4c15d?source=collection_archive---------0-----------------------#2018-07-01">https://itnext.io/how-to-properly-define-state-in-react-components-47544eb4c15d?source=collection_archive---------0-----------------------#2018-07-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="90d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您一直在使用React，那么您有100%的机会知道在组件的构造函数中初始化组件状态的模式。然而，这种模式一直存在几个问题，现在多亏了<a class="ae kl" href="https://www.npmjs.com/package/@types/react" rel="noopener ugc nofollow" target="_blank">明确键入——反应</a>，我们才‘被迫’解决这些问题。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/f70743aca138c244fcac9867bf283b65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5d_eDFKTmlTdYafG9dahdw.jpeg"/></div></div></figure></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><p id="8ed9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们开始之前，我只想说我的例子是基于<a class="ae kl" href="https://www.typescriptlang.org/" rel="noopener ugc nofollow" target="_blank"> Typescript </a>的，然而，同样的想法/原则也适用于Javascript。</p><h1 id="8d62" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">通用组件的状态问题</h1><p id="6c36" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">让我们先来看看这个简单的组件，它接收道具(一个超级英雄的名字)并有一个内部状态(超级英雄的生命值)。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="99c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">直到最近，如果您运行这段代码，您不会得到任何编译时错误。然而，在运行时，您会得到一个关于访问null上的属性的错误，因为当我们试图访问<code class="fe mk ml mm mn b">this.state.health</code>时，状态没有被定义。当您忘记在构造函数中初始化组件的状态时，可能会发生这种情况。谢天谢地，最新版本的绝对类型化@types/react，你现在会在编译时抛出一个错误。</p><p id="59ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好，让我们在构造函数中设置状态！</p><h1 id="9bc8" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">使用构造函数有什么问题？</h1><p id="ee1e" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">这是和以前一样的组件，但是现在我们在构造函数中初始化状态。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="73ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此代码有两个问题:</p><ol class=""><li id="84b2" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated">不必要的样板文件——我们正在调用构造函数，再次定义道具的类型并调用super(props)。这一切只是因为我们想初始化状态…</li><li id="ae60" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">我们让状态对突变开放React的第一条规则是我们不谈论突变。React的第二条规则是我们不谈论突变。好吧，我们确实在谈论它，但无论如何都要避免。在这种情况下，我可以执行以下操作而不会出现错误:<code class="fe mk ml mm mn b">this.state.health = 90;</code>事实上，我的组件不会再次呈现，我仍然会看到健康值为100，但是不会抛出错误，因为我们没有保护类的state属性。</li></ol><p id="136b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事实上，从<a class="ae kl" href="http://twitter.com/types/react" rel="noopener ugc nofollow" target="_blank"> @types/react </a> 16.4.3开始，这段代码将抛出以下错误:</p><blockquote class="nc nd ne"><p id="0ff0" class="jn jo nf jp b jq jr js jt ju jv jw jx ng jz ka kb nh kd ke kf ni kh ki kj kk ij bi translated">无法赋值给“state ”,因为它是常数或只读属性</p></blockquote><h1 id="4b41" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">好吧，我服了，有什么办法？</h1><p id="2268" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">幸运的是，在Typescript中，我们可以在类属性上使用<code class="fe mk ml mm mn b">readonly</code>属性。这给了我们一个干净清晰的方法来保护状态对象免受突变(第10行):</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h1 id="1729" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">我知道你在想什么</h1><p id="d429" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">看完上面的例子，你脑子里闪过的第一个念头是:“好看！”。你脑中闪过的第二个想法是:“但是如果我需要用道具中的一些逻辑来初始化我的状态呢？!"。这个问题有一个很好的解决方案:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="a8ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如你在第12行看到的，我们用组件的道具调用了<code class="fe mk ml mm mn b">getInitialHealth</code>(这是一个纯函数)，如果超级英雄的名字是蜘蛛侠，他的生命值是0，如果是其他人，他的生命值将是100。我真的很喜欢这种方法，因为你只是因为实际需要而引用属性，而不是因为构造函数需要它们。</p><h1 id="b5ae" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">我没时间做这个！尽快快速修复！</h1><p id="be23" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">很有可能你现在有一堆失败的项目需要修复。如果你真的时间紧迫(即使这些修复真的很小，并且不需要花很多时间来改变)，有2件事你可以做。要么:</p><p id="6c3d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在引入这些新类型之前，将package.json中的@types/react版本包固定到16.4.2。</p><p id="31eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运筹学</p><p id="8c25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在类中定义state属性，这样编译器“知道”它将在构造函数中设置(第10行):</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h1 id="aef6" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">包裹</h1><p id="4923" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">在Typescript React组件中设置状态的“新”方法非常好，可以保护您的状态对象不发生变化。当然，这对专业开发人员来说可能不是“关键的”(我们都还是人，对吗？)，但对于新开发人员来说，这无疑有助于防止通常很难发现的常见错误。</p><p id="a531" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">过去一年我一直在使用Typescript，每天我都觉得它比以往任何时候都更像是开发Javascript时的“必备工具”。</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><p id="1361" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这篇文章，请在Medium上跟随我，点击几次“拍手”图标来表达你的爱。你也可以在<a class="ae kl" href="https://twitter.com/EyalEizenberg" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和<a class="ae kl" href="https://github.com/eyaleizenberg/" rel="noopener ugc nofollow" target="_blank"> Github </a>上关注我。</p></div></div>    
</body>
</html>