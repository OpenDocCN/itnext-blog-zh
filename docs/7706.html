<html>
<head>
<title>One-Click Deployment: Securely Host Jenkins with Nginx and SSL with Letsencrypt Using Docker Compose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一键式部署:使用Docker Compose通过Nginx安全托管Jenkins，通过Letsencrypt安全托管SSL</h1>
<blockquote>原文：<a href="https://itnext.io/one-click-deployment-securely-host-jenkins-with-nginx-and-ssl-with-letsencrypt-using-docker-1303b06c3369?source=collection_archive---------2-----------------------#2022-12-26">https://itnext.io/one-click-deployment-securely-host-jenkins-with-nginx-and-ssl-with-letsencrypt-using-docker-1303b06c3369?source=collection_archive---------2-----------------------#2022-12-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/df86865d7692017022589de0d580ddea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l1rRLcpdhToFbD6G2raxZA.png"/></div></div></figure><p id="f4aa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您是否希望部署一个具有代理和SSL支持的安全Jenkins实例？不要再看了！在本教程中，我们将指导您使用Letsencrypt和Docker Compose通过Nginx代理和SSL设置Jenkins的过程。无论您是希望实现CI/CD管道自动化的开发人员，还是希望管理基础设施的系统管理员，本教程都能满足您的需求。只需几个简单的步骤，您马上就可以启动并运行一个全功能的Jenkins实例。所以让我们开始吧！</p><h1 id="0f17" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">为什么需要让Jenkins使用Nginx反向代理</h1><p id="97c2" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">有几个原因可能会让Jenkins使用Nginx反向代理。其中一个主要原因是为了提高Jenkins实例的安全性。通过将Jenkins置于Nginx代理之后，您可以为Jenkins服务器增加一层额外的保护。Nginx可以配置为阻止某些类型的流量，如恶意请求或易受攻击的HTTP方法，这有助于防止对Jenkins实例的攻击。此外，使用Nginx反向代理可以让您轻松地为Jenkins实例配置SSL，这对于加密Jenkins服务器和客户端之间的流量至关重要。这有助于保护密码和API密钥等敏感数据不被第三方截获。总的来说，使用Nginx反向代理可以显著提高Jenkins设置的安全性，强烈推荐用于任何生产部署。</p><p id="5486" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">先决条件</strong>:</p><ul class=""><li id="3d4b" class="mc md it kd b ke kf ki kj km me kq mf ku mg ky mh mi mj mk bi translated">Docker和Docker Compose安装在您的机器上</li><li id="b301" class="mc md it kd b ke ml ki mm km mn kq mo ku mp ky mh mi mj mk bi translated">指向服务器IP地址的域名</li></ul><h1 id="33ed" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak">步骤1:为Jenkins和Nginx代理</strong>创建一个目录</h1><p id="18df" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">让我们为Jenkins和Nginx代理文件创建一个目录:</p><pre class="mq mr ms mt gt mu mv mw bn mx my bi"><span id="e5f0" class="mz la it mv b be na nb l nc nd">mkdir jenkins-nginx<br/>cd jenkins-nginx</span></pre><h1 id="bf0f" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">步骤2:创建Docker合成文件</h1><p id="3418" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">接下来，让我们创建一个Docker合成文件来定义Jenkins和Nginx容器:</p><pre class="mq mr ms mt gt mu mv mw bn mx my bi"><span id="7d85" class="mz la it mv b be na nb l nc nd">nano docker-compose.yml</span></pre><p id="6d61" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">将以下内容粘贴到文件中:</p><pre class="mq mr ms mt gt mu mv mw bn mx my bi"><span id="294d" class="mz la it mv b be na nb l nc nd">version: '3.7'<br/><br/>services:<br/>  jenkins:<br/>    image: jenkins/jenkins:lts<br/>    container_name: jenkins<br/>    restart: always<br/>    volumes:<br/>      - jenkins_data:/var/jenkins_home<br/>      - /var/run/docker.sock:/var/run/docker.sock<br/>    environment:<br/>      - VIRTUAL_HOST=${VIRTUAL_HOST}<br/>      - LETSENCRYPT_HOST=${LETSENCRYPT_HOST}<br/>      - LETSENCRYPT_EMAIL=${LETSENCRYPT_EMAIL}<br/>      - VIRTUAL_PORT=8080<br/>    networks:<br/>      - jenkins<br/>  nginx-proxy:<br/>    image: jwilder/nginx-proxy<br/>    container_name: nginx-proxy<br/>    restart: always<br/>    ports:<br/>      - "80:80"<br/>      - "443:443"<br/>    volumes:<br/>      - conf:/etc/nginx/conf.d<br/>      - vhost:/etc/nginx/vhost.d<br/>      - html:/usr/share/nginx/html<br/>      - cert:/etc/nginx/certs<br/>      - /var/run/docker.sock:/tmp/docker.sock:ro<br/>    networks:<br/>      - jenkins<br/>  acme-companion:<br/>    image: jrcs/letsencrypt-nginx-proxy-companion<br/>    container_name: acme-companion<br/>    restart: always<br/>    environment:<br/>      - NGINX_PROXY_CONTAINER=nginx-proxy<br/>      - NGINX_DOCKER_GEN_CONTAINER=nginx-proxy<br/>      - NGINX_DOCKER_GEN_NETWORK=jenkins_default<br/>    volumes:<br/>      - conf:/etc/nginx/conf.d<br/>      - vhost:/etc/nginx/vhost.d<br/>      - html:/usr/share/nginx/html<br/>      - cert:/etc/nginx/certs<br/>      - /var/run/docker.sock:/var/run/docker.sock<br/>    depends_on:<br/>      - nginx-proxy<br/>    networks:<br/>      - jenkins<br/><br/>volumes:<br/>  jenkins_data:<br/>  conf:<br/>  vhost:<br/>  html:<br/>  cert:<br/><br/>networks:<br/>  jenkins:<br/>    driver: bridge</span></pre><p id="39d0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在上面的Docker Compose文件中，我们定义了三个服务:</p><ul class=""><li id="cbab" class="mc md it kd b ke kf ki kj km me kq mf ku mg ky mh mi mj mk bi translated"><strong class="kd iu"> Jenkins </strong>:这是将运行Jenkins服务器的Jenkins容器。</li><li id="adf4" class="mc md it kd b ke ml ki mm km mn kq mo ku mp ky mh mi mj mk bi translated">Nginx代理:这是Nginx代理容器，将充当Jenkins的反向代理。</li><li id="cae2" class="mc md it kd b ke ml ki mm km mn kq mo ku mp ky mh mi mj mk bi translated">Letsencrypt-nginx-proxy-companion:这是一个使用lets encrypt来帮助我们的域生成和更新SSL证书的容器。</li></ul><p id="da9d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们还定义了容器将使用的一些卷和网络。</p><h1 id="c418" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">步骤3:创建一个。环境文件</h1><p id="f399" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">接下来，让我们创建一个。env文件来存储我们的环境变量:</p><pre class="mq mr ms mt gt mu mv mw bn mx my bi"><span id="de2b" class="mz la it mv b be na nb l nc nd">nano .env</span></pre><p id="0453" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">将以下内容粘贴到文件中，用您的实际域名替换<code class="fe ne nf ng mv b">your-domain.com</code>:</p><pre class="mq mr ms mt gt mu mv mw bn mx my bi"><span id="9e19" class="mz la it mv b be na nb l nc nd">VIRTUAL_HOST=your-domain.com<br/>LETSENCRYPT_HOST=your-domain.com<br/>LETSENCRYPT_EMAIL=your@email.com</span></pre><h1 id="87e4" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">步骤4:启动容器</h1><p id="f076" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">现在，我们可以使用以下命令启动Jenkins、Nginx代理和Letsencrypt容器:</p><pre class="mq mr ms mt gt mu mv mw bn mx my bi"><span id="6efa" class="mz la it mv b be na nb l nc nd">docker-compose up -d</span></pre><p id="bc2d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将提取所需的图像并在后台启动容器。您可以使用以下命令检查容器的状态:</p><pre class="mq mr ms mt gt mu mv mw bn mx my bi"><span id="fdf2" class="mz la it mv b be na nb l nc nd">docker-compose ps</span></pre><h1 id="c98b" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">步骤5:完成Jenkins设置</h1><p id="f7f8" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">一旦Jenkins容器启动并运行，您就可以通过在web浏览器中打开您的域名来完成设置。您将看到Jenkins安装向导，它将指导您完成其余的安装过程。</p><p id="f113" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">获取詹金斯管理员密码:</strong></p><pre class="mq mr ms mt gt mu mv mw bn mx my bi"><span id="c899" class="mz la it mv b be na nb l nc nd">docker exec -it jenkins cat /var/jenkins_home/secrets/initialAdminPassword</span></pre><h1 id="50ed" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">结论:</h1><p id="da67" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">在本教程中，我们向您展示了如何使用docker-compose通过Nginx代理和SSL ready通过Letsencrypt轻松部署Jenkins。这种设置允许您使用您的域名轻松访问Jenkins，并确保所有流量都使用SSL加密。我希望本教程对你有所帮助，并且你能够在你的服务器上成功设置Jenkins。</p><p id="fbff" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">【github.com】Github Repo:<a class="ae nh" href="https://github.com/omerkarabacak/one-click-jenkins-deployment" rel="noopener ugc nofollow" target="_blank">omerkarabacak/one-click-Jenkins-deployment</a></p><p id="6002" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">支持媒体和我:)</strong><a class="ae nh" href="https://omerkarabacak.medium.com/membership" rel="noopener">https://omerkarabacak.medium.com/membership</a></p></div></div>    
</body>
</html>