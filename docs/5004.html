<html>
<head>
<title>Rancher 2.5 on your Windows 10 laptop with k3d and k3s and deploy nginx on k8s</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在装有k3d和k3s的Windows 10笔记本电脑上安装Rancher 2.5，并在k8s上部署nginx</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-rancher-2-5-on-your-windows-10-laptop-with-k3d-and-k3s-7404f288342f?source=collection_archive---------1-----------------------#2020-11-15">https://itnext.io/kubernetes-rancher-2-5-on-your-windows-10-laptop-with-k3d-and-k3s-7404f288342f?source=collection_archive---------1-----------------------#2020-11-15</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><figure class="gm go js jt ju jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj jr"><img src="../Images/06c15fe764b26c19885df38af9215a60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eo-cbovcIH9phtMK6yPBKQ.png"/></div></div></figure><p id="b909" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">本文展示了如何在您的Windows 10笔记本电脑上使用Rancher Cluster Manager设置一个最小的Kubernetes dev env，并使用k3d来设置k3s集群。</p><p id="43f2" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><strong class="ke iv"><em class="la">TL；博士安装Docker桌面&amp; Chocolatey并运行最后的要点</em>T4】</strong></p><blockquote class="lb lc ld"><p id="3b98" class="kc kd la ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz in bi translated">这是对<a class="ae lh" href="https://jyeee.medium.com/rancher-2-4-14c31af12b7a" rel="noopener">https://jyeee.medium.com/rancher-2-4-14c31af12b7a</a>的更新，但是使用了Docker和k3d而不是multipass</p></blockquote><h1 id="4375" class="li lj iu bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">先决条件</h1><ul class=""><li id="130a" class="mg mh iu ke b kf mi kj mj kn mk kr ml kv mm kz mn mo mp mq bi translated">带Hyper-V的Windows 10 <strong class="ke iv"> Pro </strong></li><li id="f59d" class="mg mh iu ke b kf mr kj ms kn mt kr mu kv mv kz mn mo mp mq bi translated">Docker桌面(2.5.x)</li></ul><p id="375d" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">说真的，就是这样！我们将使用巧克力来帮助，但除此之外不需要任何其他东西。</p><h1 id="c2c8" class="li lj iu bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">概观</h1><ol class=""><li id="9f12" class="mg mh iu ke b kf mi kj mj kn mk kr ml kv mm kz mw mo mp mq bi translated">启用Hyper-V并检查您的Docker安装</li><li id="4951" class="mg mh iu ke b kf mr kj ms kn mt kr mu kv mv kz mw mo mp mq bi translated">安装Chocolatey来安装kubectl和helm</li><li id="5464" class="mg mh iu ke b kf mr kj ms kn mt kr mu kv mv kz mw mo mp mq bi translated">安装k3d并启动单节点k3s Kubernetes集群</li><li id="0ccc" class="mg mh iu ke b kf mr kj ms kn mt kr mu kv mv kz mw mo mp mq bi translated">使用helm将证书管理器部署到集群中</li><li id="6a21" class="mg mh iu ke b kf mr kj ms kn mt kr mu kv mv kz mw mo mp mq bi translated">通过Rancher部署应用</li></ol><h1 id="855c" class="li lj iu bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">1/5启用Hyper-V并检查Docker安装</h1><p id="e655" class="pw-post-body-paragraph kc kd iu ke b kf mi kh ki kj mj kl km kn mx kp kq kr my kt ku kv mz kx ky kz in bi translated">Hyper-V允许您快速运行运行单节点kubernetes集群的虚拟机。它是Windows 10 Pro的标配。</p><p id="0520" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">如果你以前没有使用过Hyper-V，你可能需要使用这个命令来启用它(在<a class="ae lh" href="https://github.com/kubernetes/minikube/issues/2954" rel="noopener ugc nofollow" target="_blank">https://github.com/kubernetes/minikube/issues/2954</a>了解更多信息)</p><pre class="na nb nc nd gu ne nf ng nh aw ni bi"><span id="9b62" class="nj lj iu nf b gz nk nl l nm nn"><strong class="nf iv">Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V -All</strong></span></pre><p id="da47" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这也是检查docker安装是否良好的好时机</p><pre class="na nb nc nd gu ne nf ng nh aw ni bi"><span id="7538" class="nj lj iu nf b gz nk nl l nm nn"><strong class="nf iv">docker run hello-world</strong></span></pre><figure class="na nb nc nd gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj no"><img src="../Images/0e2bfc27938dc99de3964dc41fe4d2b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dlcZFcMqxJNFovS9RRjCMA.png"/></div></div><figcaption class="np nq gk gi gj nr ns bd b be z dk translated">你好世界！</figcaption></figure><blockquote class="lb lc ld"><p id="f8b3" class="kc kd la ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz in bi translated">有用提示:将Windows终端锁定为任务栏上的第n个项目。然后按Win+Ctrl+Shift+n以管理员身份打开。所以如果你把它作为第一个，它将是Win+Ctrl+Shift+1</p><p id="4231" class="kc kd la ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz in bi translated"><a class="ae lh" href="https://stackoverflow.com/questions/62496779/opening-up-windows-terminal-with-elevated-privileges-from-within-windows-termin" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/62496779/opening-up-windows-terminal-with-elevated-privileges-from-in-windows-termin</a></p></blockquote><h1 id="e708" class="li lj iu bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">2/5安装巧克力来安装头盔和kubectl</h1><p id="66ad" class="pw-post-body-paragraph kc kd iu ke b kf mi kh ki kj mj kl km kn mx kp kq kr my kt ku kv mz kx ky kz in bi translated">Chocolatey是Windows的命令行包管理器，感觉就像macOS中的自制工具。我们在这里安装它是因为Chocolatey提供了Helm &amp; kubectl (Kubernetes CLI)实用程序的简单安装。</p><blockquote class="lb lc ld"><p id="d68a" class="kc kd la ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz in bi translated"><em class="iu">注意:我在桌面上创建了一个工作文件夹</em> <code class="fe nt nu nv nf b"><em class="iu">k3s-rancher</em></code> <em class="iu">来存放未来的kubeconfig文件。</em></p></blockquote><p id="5625" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">我按照这里的说明<a class="ae lh" href="https://chocolatey.org/install#individual" rel="noopener ugc nofollow" target="_blank">https://chocolatey.org/install#individual</a>，并使用这个命令来确认它的安装。</p><pre class="na nb nc nd gu ne nf ng nh aw ni bi"><span id="7596" class="nj lj iu nf b gz nk nl l nm nn">PS C:\Users\jyee\Desktop\k3s-rancher&gt; <strong class="nf iv">choco list --local-only</strong><br/>Chocolatey v0.10.15<br/>chocolatey 0.10.15<br/>1 packages installed.</span></pre><p id="21e0" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">然后用命令安装helm和kubectl</p><pre class="na nb nc nd gu ne nf ng nh aw ni bi"><span id="1721" class="nj lj iu nf b gz nk nl l nm nn"><strong class="nf iv">choco install kubernetes-cli -y<br/>choco install kubernetes-helm -y</strong></span></pre><figure class="na nb nc nd gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj no"><img src="../Images/e0428ae8ed4662092635149fd82d25ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7JpCxoZT35jvcLV4tVuPSg.png"/></div></div></figure><p id="146c" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">下面显示了我们应该安装的所有Chocolatey软件包。</p><pre class="na nb nc nd gu ne nf ng nh aw ni bi"><span id="34ca" class="nj lj iu nf b gz nk nl l nm nn">PS C:\Users\jyee\Desktop\k3d-rancher&gt; <strong class="nf iv">choco list --local-only</strong><br/>Chocolatey v0.10.15<br/>chocolatey 0.10.15<br/>kubernetes-cli 1.19.3<br/>kubernetes-helm 3.4.0<br/>3 packages installed.</span></pre><h1 id="87f9" class="li lj iu bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">3/5安装k3d并启动单节点k3s Kubernetes集群</h1><p id="24ec" class="pw-post-body-paragraph kc kd iu ke b kf mi kh ki kj mj kl km kn mx kp kq kr my kt ku kv mz kx ky kz in bi translated"><a class="ae lh" href="https://k3d.io/" rel="noopener ugc nofollow" target="_blank"> k3d </a>是一种运行<a class="ae lh" href="https://k3s.io/" rel="noopener ugc nofollow" target="_blank"> k3s </a>集群的方式，只需要Docker Desktop作为依赖。k3s是k8s的一个小发行版，可以在Raspberry Pi上运行——但是它和任何k8s发行版一样得到了认证，你可以在生产中运行它。通过从GitHub下载它来获得它，并且为了使指令适用于多个平台(hello macOS ),为了方便起见，我设置了一个别名为<code class="fe nt nu nv nf b">k3d</code>。</p><pre class="na nb nc nd gu ne nf ng nh aw ni bi"><span id="0cd1" class="nj lj iu nf b gz nk nl l nm nn">PS C:\Users\jyee\Desktop\k3d-rancher&gt; <strong class="nf iv">wget </strong><a class="ae lh" href="https://github.com/rancher/k3d/releases/download/v3.2.0/k3d-windows-amd64.exe" rel="noopener ugc nofollow" target="_blank"><strong class="nf iv">https://github.com/rancher/k3d/releases/download/v3.2.0/k3d-windows-amd64.exe</strong></a><strong class="nf iv"> -o k3d-windows-amd64-3.2.0.exe<br/></strong>PS C:\Users\jyee\Desktop\k3d-rancher&gt; ls</span><span id="fa4a" class="nj lj iu nf b gz nw nl l nm nn">Directory: C:\Users\jyee\Desktop\k3d-rancher</span><span id="6ae1" class="nj lj iu nf b gz nw nl l nm nn">Mode                 LastWriteTime         Length Name<br/>----                 -------------         ------ ----<br/>-a----        11/11/2020   9:34 PM       22679552 k3d-windows-amd64-3.2.0.exe</span><span id="8e23" class="nj lj iu nf b gz nw nl l nm nn">PS C:\Users\jyee\Desktop\k3d-rancher&gt; <strong class="nf iv">Set-Alias -Name k3d -Value ~\Desktop\k3d-rancher\k3d-windows-amd64-3.2.0.exe</strong></span></pre><p id="bab8" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">现在在<a class="ae lh" href="https://rancher.localhost." rel="noopener ugc nofollow" target="_blank">https://rancher . localhost</a>上构建集群，在这里我们将使用<code class="fe nt nu nv nf b">.localhost</code> <a class="ae lh" href="https://en.wikipedia.org/wiki/.localhost" rel="noopener ugc nofollow" target="_blank"> DNS魔术</a>来知道将任何请求路由到k3s节点。</p><figure class="na nb nc nd gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj nx"><img src="../Images/94cbae27e87304d1836a646e0728df6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YEPdU_sKnVdhs_Ix0aJitg.png"/></div></div></figure><pre class="na nb nc nd gu ne nf ng nh aw ni bi"><span id="d6bd" class="nj lj iu nf b gz nk nl l nm nn">PS C:\Users\jyee\Desktop\k3d-rancher&gt; <strong class="nf iv">$env:CLUSTER_NAME="k3d-rancher"</strong></span><span id="6610" class="nj lj iu nf b gz nw nl l nm nn">PS C:\Users\jyee\Desktop\k3d-rancher&gt; <strong class="nf iv">$env:RANCHER_SERVER_HOSTNAME="rancher.localhost"</strong></span><span id="623b" class="nj lj iu nf b gz nw nl l nm nn">PS C:\Users\jyee\Desktop\k3d-rancher&gt; <strong class="nf iv">$env:KUBECONFIG_FILE="${env:CLUSTER_NAME}.yaml"</strong></span><span id="ec6b" class="nj lj iu nf b gz nw nl l nm nn">PS C:\Users\jyee\Desktop\k3d-rancher&gt; <strong class="nf iv">k3d cluster create $env:CLUSTER_NAME --api-port 6550 --servers 1 --port 443:443@loadbalancer --wait</strong></span></pre><p id="0ea6" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">一旦你有了一个集群，设置一些env变量、别名和你的kubectl，这样你就可以确认你的集群已经启动并运行，并开始在上面运行应用程序。</p><figure class="na nb nc nd gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ny"><img src="../Images/12aeab7fad4b08db576f0b1d279396da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sPIQeNwtSktwN9JBQTEFYw.png"/></div></div></figure><pre class="na nb nc nd gu ne nf ng nh aw ni bi"><span id="b1b1" class="nj lj iu nf b gz nk nl l nm nn">PS C:\Users\jyee\Desktop\k3d-rancher&gt; <strong class="nf iv">k3d cluster list</strong><br/>NAME          SERVERS   AGENTS   LOADBALANCER<br/>k3d-rancher   1/1       0/0      true</span><span id="570e" class="nj lj iu nf b gz nw nl l nm nn">PS C:\Users\jyee\Desktop\k3d-rancher&gt; <strong class="nf iv">k3d kubeconfig get ${env:CLUSTER_NAME} &gt; $env:KUBECONFIG_FILE</strong></span><span id="13f2" class="nj lj iu nf b gz nw nl l nm nn">PS C:\Users\jyee\Desktop\k3d-rancher&gt; <strong class="nf iv">$env:KUBECONFIG=($env:KUBECONFIG_FILE)</strong></span><span id="8a5c" class="nj lj iu nf b gz nw nl l nm nn">PS C:\Users\jyee\Desktop\k3d-rancher&gt; <strong class="nf iv">kubectl get nodes</strong><br/>NAME                       STATUS   ROLES    AGE    VERSION<br/>k3d-k3d-rancher-server-0   Ready    master   109s   v1.18.9+k3s1</span><span id="769c" class="nj lj iu nf b gz nw nl l nm nn">PS C:\Users\jyee\Desktop\k3d-rancher&gt; <strong class="nf iv">kubectl get pods -A</strong><br/>NAMESPACE       NAME                                       READY   STATUS      RESTARTS   AGE<br/>cert-manager    cert-manager-cainjector-85c559fd6c-g9hxp   1/1     Running     0          104s<br/>...<br/>cattle-system   rancher-d97f554b9-9g88m                    0/1     Running     0          63s</span></pre><h1 id="959f" class="li lj iu bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">4/5使用helm将证书管理器部署到集群中</h1><p id="f38a" class="pw-post-body-paragraph kc kd iu ke b kf mi kh ki kj mj kl km kn mx kp kq kr my kt ku kv mz kx ky kz in bi translated">这些命令安装Rancher，一般遵循这些指令<a class="ae lh" href="https://rancher.com/docs/rancher/v2.x/en/installation/k8s-install/helm-rancher/" rel="noopener ugc nofollow" target="_blank">https://Rancher . com/docs/Rancher/v2 . x/en/installation/k8s-install/helm-Rancher/</a></p><pre class="na nb nc nd gu ne nf ng nh aw ni bi"><span id="2b4f" class="nj lj iu nf b gz nk nl l nm nn"># Install cert-manager with helm<br/><strong class="nf iv">helm repo add jetstack </strong><a class="ae lh" href="https://charts.jetstack.io" rel="noopener ugc nofollow" target="_blank"><strong class="nf iv">https://charts.jetstack.io</strong></a><strong class="nf iv"><br/>helm repo update<br/>kubectl create namespace cert-manager<br/>helm install cert-manager jetstack/cert-manager --namespace cert-manager --version v1.0.4 --set installCRDs=true --wait<br/>kubectl -n cert-manager rollout status deploy/cert-manager<br/>date</strong></span><span id="29d4" class="nj lj iu nf b gz nw nl l nm nn"># Install Rancher<br/><strong class="nf iv">helm repo add rancher-latest </strong><a class="ae lh" href="https://releases.rancher.com/server-charts/latest" rel="noopener ugc nofollow" target="_blank"><strong class="nf iv">https://releases.rancher.com/server-charts/latest</strong></a><strong class="nf iv"><br/>helm repo update<br/>kubectl create namespace cattle-system<br/>helm install rancher rancher-latest/rancher --namespace cattle-system --set hostname=${env:RANCHER_SERVER_HOSTNAME} --wait<br/>kubectl -n cattle-system rollout status deploy/rancher<br/>date</strong></span></pre><p id="559d" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">成功安装后，您会看到这些日志</p><figure class="na nb nc nd gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ny"><img src="../Images/7e98d61ca630b6557046fd5554a33937.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*reBz9fb4yegpic0SLILXUQ.png"/></div></div></figure><p id="77c2" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在您看到行<code class="fe nt nu nv nf b">deployment "rancher" successfully rolled out</code>之后，浏览到<a class="ae lh" href="https://rancher.localhost." rel="noopener ugc nofollow" target="_blank">https://rancher . localhost</a>，在这里我们将使用<code class="fe nt nu nv nf b">.localhost</code> <a class="ae lh" href="https://en.wikipedia.org/wiki/.localhost" rel="noopener ugc nofollow" target="_blank"> DNS魔术</a>来知道路由任何请求到k3s节点。如果你看不到这个屏幕，你可能不得不使用<a class="ae lh" href="https://dev.to/brettimus/this-is-unsafe-and-a-bad-idea-5ej4" rel="noopener ugc nofollow" target="_blank"><em class="la">this is unsafe</em></a>chrome技巧</p><figure class="na nb nc nd gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj nz"><img src="../Images/175959ecefaa245daf79f072d9841c08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fk7N8A99yfT_FL_UfJiDfA.png"/></div></div></figure><p id="253d" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">我保留了默认设置，为<code class="fe nt nu nv nf b">admin</code>用户创建了一个新密码。如果我必须再次登录，我可以使用<code class="fe nt nu nv nf b">admin</code>和这个密码</p><figure class="na nb nc nd gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj oa"><img src="../Images/7ea7a4fbc040b68a668070a72f972283.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vJHWc93GVsWA-_ped8pF4Q.png"/></div></div></figure><p id="88b6" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">使用<code class="fe nt nu nv nf b">rancher.localhost</code>作为你的牧场主安装，以利用。本地主机魔法。在生产中，这个魔术将是一个负载平衡器和通配符证书。</p><figure class="na nb nc nd gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj oa"><img src="../Images/79bdfd519f415eba6b40c07979cf2ea4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ulzdYvTlxtJHT58VPAh8fA.png"/></div></div></figure><figure class="na nb nc nd gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ob"><img src="../Images/6ef8cf9f5f8900c61f220b98b91cb252.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V-HzUyfQlMbPnnnzjNCKhw.png"/></div></div></figure><p id="5a99" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">关于Rancher最好的事情之一是你可以通过点击<strong class="ke iv"> Launch kubectl </strong>按钮在你的浏览器中启动并运行kubectl！</p><figure class="na nb nc nd gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ob"><img src="../Images/3c95dcd3a9c4774ca03aaf796f80f25d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*axb4tD97BkK36TXrZGneNw.png"/></div></div></figure><h1 id="23ca" class="li lj iu bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">5/5通过Rancher部署应用</h1><p id="b6a5" class="pw-post-body-paragraph kc kd iu ke b kf mi kh ki kj mj kl km kn mx kp kq kr my kt ku kv mz kx ky kz in bi translated">我们将使用这里显示的<a class="ae lh" href="https://jyeee.medium.com/rancher-2-4-14c31af12b7a" rel="noopener">相同的过程</a>来部署nginx容器，并通过使用Rancher Cluster Manager UI来公开它。</p><p id="b96b" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">将鼠标悬停在左上角的本地集群上，并转到<strong class="ke iv">默认</strong> Rancher项目。Rancher项目提供了一个名称空间管理层，允许集群管理员轻松实现RBAC和资源限制。</p><figure class="na nb nc nd gu jv gi gj paragraph-image"><div class="gi gj oc"><img src="../Images/7efcfec86efb9f133fcc867856345e2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*iUp-6_8lrYX8kyR4q_8a3w.png"/></div></figure><p id="05ab" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在<strong class="ke iv">默认</strong>项目页面中，您可以看到没有部署任何工作负载。让我们通过单击右上角的蓝色<strong class="ke iv"> Deploy </strong>按钮来部署一个工作负载</p><figure class="na nb nc nd gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj od"><img src="../Images/a3afd860b43ebd9cf6c12cb42412a645.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lgr-4hyJvxHh6GIYY-s7rQ.png"/></div></div></figure><p id="4336" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">使用<code class="fe nt nu nv nf b">nginx:alpine</code>图像，按照此截图显示端口80，点击<strong class="ke iv">启动</strong></p><figure class="na nb nc nd gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj od"><img src="../Images/7cf1eadf4c76a1817c9ce396933eaca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nlMxp4KLmPp6JhVauMtA4Q.png"/></div></div></figure><p id="e5b4" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">您应该看到创建了一个“pod ”,它有一个“nodeport ”,在端口31896上公开了集群中节点上的工作负载(在我看来，k8s有很多术语/复杂性，Rancher可以帮助您直观地理解其中的很多内容)。</p><figure class="na nb nc nd gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj od"><img src="../Images/65743d44d3d12e32652389bcc890417c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_2jLk7SoV7JtwGbDFSCH-w.png"/></div></div></figure><p id="a866" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">换句话说，如果您通过ssh进入其中一个节点，您可以通过端口31896访问它，如下图所示，使用<code class="fe nt nu nv nf b">docker exec</code></p><figure class="na nb nc nd gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj oe"><img src="../Images/112fff8993bfebdb6ba17211f63a124d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GW0G93Qw97dZhrOk8uZMUw.png"/></div></div></figure><p id="f104" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">要在集群之外共享这个服务而不暴露任何节点，可以再次使用非常方便的Rancher GUI来设置入口。点击工作负载右侧的<strong class="ke iv">负载平衡</strong>选项卡，然后点击<strong class="ke iv">添加入口</strong></p><figure class="na nb nc nd gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj of"><img src="../Images/c896b9f8a6f350554db41effbb3c9bb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ycpn_dLvqnCFRhCGxJyO-g.png"/></div></div></figure><p id="d95f" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">我用(注意两张截图)配置了入口</p><ul class=""><li id="a27e" class="mg mh iu ke b kf kg kj kk kn og kr oh kv oi kz mn mo mp mq bi translated">名称:<strong class="ke iv"> demo.rancher.localhost </strong></li><li id="a47f" class="mg mh iu ke b kf mr kj ms kn mt kr mu kv mv kz mn mo mp mq bi translated">指定要使用的主机名(设置请求主机):<strong class="ke iv"> demo.rancher.localhost </strong></li><li id="31ff" class="mg mh iu ke b kf mr kj ms kn mt kr mu kv mv kz mn mo mp mq bi translated">单击减号删除默认工作负载，单击+号添加一个<strong class="ke iv">服务</strong>作为目标后端</li><li id="f0d5" class="mg mh iu ke b kf mr kj ms kn mt kr mu kv mv kz mn mo mp mq bi translated">将目标字段更改为<strong class="ke iv">演示节点端口</strong>，它将自动选择相应的端口</li></ul><figure class="na nb nc nd gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj oj"><img src="../Images/1ed736c4546490bcb726ba8f0572827b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ckEQS-cSk59yk5b-cyKUsQ.png"/></div></div></figure><ul class=""><li id="d616" class="mg mh iu ke b kf kg kj kk kn og kr oh kv oi kz mn mo mp mq bi translated">将证书添加到同一个主机<strong class="ke iv"> demo.rancher.localhost </strong></li></ul><figure class="na nb nc nd gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj oj"><img src="../Images/df2ea13e1d7ce82af288f323ce61e5ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cwqgaqN4OWjbcveZwfoDrQ.png"/></div></div></figure><p id="e929" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">点击保存后，你会看到有一个新的入口，带你去你想去的地方，感谢一些牧场主和DNS魔术！</p><figure class="na nb nc nd gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ok"><img src="../Images/16a95e4ca3b7c8616c91e1bf8e110766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bQJ1oTCR-5FWFTd0NUiB3g.png"/></div></div></figure><p id="3f71" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在生产中，您将希望编写一些部署yamls，并通过CI/CD管道部署它们。但是现在，享受在你的笔记本电脑上有一个开发实验室来探索k8和牧场主来管理它！</p><p id="44dc" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">感谢<a class="ol om ep" href="https://medium.com/u/ce902113ac3a?source=post_page-----7404f288342f--------------------------------" rel="noopener" target="_blank"> Brandon Gulla </a>向我介绍k3d和<a class="ol om ep" href="https://medium.com/u/f4cb33e4a07f?source=post_page-----7404f288342f--------------------------------" rel="noopener" target="_blank"> Thorsten K </a>的k3d演示，它继续激励着我，希望也激励着许多其他开发者！！</p></div><div class="ab cl on oo hy op" role="separator"><span class="oq bw bk or os ot"/><span class="oq bw bk or os ot"/><span class="oq bw bk or os"/></div><div class="in io ip iq ir"><p id="fc7d" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">下面是我用来启动集群和安装Rancher的统一PS1脚本的要点。先决条件是安装Docker和Chocolatey。</p><figure class="na nb nc nd gu jv"><div class="bz fq l di"><div class="ou ov l"/></div></figure></div></div>    
</body>
</html>