<html>
<head>
<title>Angular Prototyping: Firebase Emulator with Cypress</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角度原型:带Cypress的Firebase仿真器</h1>
<blockquote>原文：<a href="https://itnext.io/angular-prototyping-firebase-emulator-with-cypress-9ff6f5b3bf8a?source=collection_archive---------1-----------------------#2022-07-25">https://itnext.io/angular-prototyping-firebase-emulator-with-cypress-9ff6f5b3bf8a?source=collection_archive---------1-----------------------#2022-07-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="21c8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Firebase仿真器和Cypress进行快速开发和测试的角度原型</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ba186e378429df2118d927882dba9e0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nAXb_SB7_5uAS0C3hCRHLA.png"/></div></div></figure><h1 id="0959" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">关于我👋</h1><p id="4584" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我目前是一名软件工程师，在财富100强公司思科工作，和一些业内最好的Angular开发人员一起工作。我在业余时间积极从事由Angular &amp; Firebase提供动力的兼职项目。</p><blockquote class="mf mg mh"><p id="0d66" class="lj lk mi ll b lm mj jr lo lp mk ju lr ml mm lu lv mn mo ly lz mp mq mc md me ij bi translated">🔥<a class="ae mr" href="https://github.com/Everduin94/poc" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir">源代码</strong></a>——或者，每个要点都有一个到其对应文件的链接</p></blockquote><h1 id="a8c9" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">目标🗺️</h1><ul class=""><li id="fc5d" class="ms mt iq ll b lm ln lp lq ls mu lw mv ma mw me mx my mz na bi translated">🦠公司利用Firestore数据进行人工和e2e(赛普拉斯)测试</li><li id="9f1e" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">🧬在Firestore中有效地创建了模拟数据，用于原型制作和测试</li><li id="5d55" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">🧪编辑和删除不会影响实时数据或计入账单</li><li id="60f8" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">🔭方便的存根Firebase请求</li><li id="7ca7" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">🔒在Cypress中使用仿真器进行身份验证</li></ul><p id="91e7" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">原型是指我们利用一些样本或模拟数据来快速测试一个想法。每当我开始一个新项目的时候，我做的第一件事就是设置架构来有效地建立原型。 —不要与<a class="ae mr" href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/Object_prototypes" rel="noopener ugc nofollow" target="_blank"> JavaScript原型</a>混淆🙂</p><p id="2f4d" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">该设置将使我们能够使用认证和Firestore数据进行所有的手动和e2e测试。—这意味着<strong class="ll ir">我们不必为e2e测试创建json fixtures或cypress拦截。</strong></p><p id="0308" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">💵此外，我们不会为在我们的真实环境中的读写操作付费；因为我们用的是模拟器。</p><p id="7a8c" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">这是一篇中级文章，如果你以前从未设置过firebase项目，我推荐这个视频<a class="ae mr" href="https://fireship.io/lessons/firebase-quickstart/" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir"> Firebase快速入门</strong></a><strong class="ll ir"/>by<strong class="ll ir"/>FireShip</p><h1 id="b4d0" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">装置🔧</h1><p id="32fe" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">以下内容仅在利用<strong class="ll ir"> Firebase </strong>时有效。如果你正在使用<em class="mi"> HttpClient </em>参见<a class="ae mr" rel="noopener ugc nofollow" target="_blank" href="/angular-develop-faster-with-prototyping-aafdf3376e6e">角度原型:使用原型开发更快</a>。</p><p id="a42c" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">在使用Angular和Firebase模拟器时。我发现了许多陷阱。为了保持这篇文章的简洁，我在文章末尾添加了一些陷阱。如果你遇到任何问题，去那里寻求帮助。</p><p id="6a99" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">如果<strong class="ll ir">已经有了Firebase &amp;仿真器设置</strong>，<strong class="ll ir"> </strong>跳到<strong class="ll ir">用法。</strong></p><h2 id="0232" class="ng ks iq bd kt nh ni dn kx nj nk dp lb ls nl nm ld lw nn no lf ma np nq lh nr bi translated">要求</h2><ul class=""><li id="a250" class="ms mt iq ll b lm ln lp lq ls mu lw mv ma mw me mx my mz na bi translated">Node.js或更高版本</li><li id="88da" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">Java版本1.8或更高版本</li><li id="1788" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">Firebase CLI 8.14.0或更高版本</li></ul><p id="f377" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">如果你正在进行Angular开发，你可能已经安装了<a class="ae mr" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"><em class="mi">node . js</em></a>。如果您还没有安装openjdk ,请确保在您的机器上安装open JDK<a class="ae mr" href="https://openjdk.java.net/install/" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="9744" class="ng ks iq nt b gy nx ny l nz oa"><strong class="nt ir">npm install -g firebase-tools</strong></span><span id="5b69" class="ng ks iq nt b gy ob ny l nz oa">-- Angular<br/><strong class="nt ir">ng add @angular/fire<br/>firebase init emulators</strong></span><span id="8f6a" class="ng ks iq nt b gy ob ny l nz oa">-- NX<strong class="nt ir"><br/>npm install @angular/fire<br/>ng add @nxtend/firebase<br/>nx generate @nxtend/firebase:firebase-project --project NX-APP<br/>nx run NX-APP:firebase --cmd=init</strong></span></pre><ul class=""><li id="6d64" class="ms mt iq ll b lm mj lp mk ls oc lw od ma oe me mx my mz na bi translated">安装Firebase CLI(<em class="mi">Firebase-tools</em>)</li><li id="faeb" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">对于Angular &amp; Nx项目，下面将安装@angular/fire，添加一个firebase配置，并设置模拟器。设置Firebase &amp;模拟器时，确保<strong class="ll ir">选择Firestore &amp;认证</strong>。</li><li id="5088" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">对于Angular项目，通常只有一个项目，所以设置很简单。对于Nx项目，运行<em class="mi"> init </em>将Angular项目绑定到Firebase项目。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/0da3ce358c0baef9c0cd0358868223d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zpg6NdAJvWq27BiLGhdaMg.png"/></div></div><figcaption class="og oh gj gh gi oi oj bd b be z dk translated">初始化火灾基地</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/de7e5ae6e15a128c8d0e4bb93d35938a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m7AXU91KUGWGr8LPaZc-Jg.png"/></div></div><figcaption class="og oh gj gh gi oi oj bd b be z dk translated">firebase仿真器设置</figcaption></figure><h1 id="f614" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">配置⚙️</h1><p id="503c" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我使用标志<code class="fe ol om on nt b">environment.production</code>来决定是否使用模拟器。在我的另一篇原型文章中，我为内存API使用了一个定制的标志/环境。</p><p id="e502" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">为了使这篇文章简明扼要，我已经创建了一篇单独的配套文章，以防你想知道<a class="ae mr" href="https://erxk.medium.com/nx-setup-a-custom-environment-116342b7815b" rel="noopener"> <strong class="ll ir">如何设置自定义环境</strong> </a>。</p><blockquote class="mf mg mh"><p id="f59b" class="lj lk mi ll b lm mj jr lo lp mk ju lr ml mm lu lv mn mo ly lz mp mq mc md me ij bi translated">❗ <strong class="ll ir">重要:</strong>这些例子用@angular/fire <strong class="ll ir"> v7 </strong>。</p></blockquote><h2 id="661e" class="ng ks iq bd kt nh ni dn kx nj nk dp lb ls nl nm ld lw nn no lf ma np nq lh nr bi translated">设置应用程序</h2><p id="7f21" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在您的<em class="mi">app . module . ts</em>T25】中添加配置。这有点长，但是我想确保导入是清楚的，并且你可以删除你不需要的东西。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oo op l"/></div><figcaption class="og oh gj gh gi oi oj bd b be z dk translated"><a class="ae mr" href="https://github.com/Everduin94/poc/blob/main/apps/demo/src/app/app.module.ts#L39-L66" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><ul class=""><li id="35f8" class="ms mt iq ll b lm mj lp mk ls oc lw od ma oe me mx my mz na bi translated">唯一需要的提供者是<em class="mi"> provideFirebaseApp，</em>你可以删除你不需要的或者改变持久选项、端口、主机等等…</li><li id="6be6" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated"><em class="mi">environment . firebase config</em>是您的标准firebase配置，只是保存到一个环境文件中。</li><li id="66f8" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated"><em class="mi">experimentalForceLongPolling</em>是在Cypress中使用的，因此我们只希望它在dev中启用。</li></ul><blockquote class="mf mg mh"><p id="2407" class="lj lk mi ll b lm mj jr lo lp mk ju lr ml mm lu lv mn mo ly lz mp mq mc md me ij bi translated">💡使用firestore &amp;验证模拟器配置<strong class="ll ir"> firebase应用程序</strong></p></blockquote><h1 id="0da9" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">用途——原型制作和测试🧪</h1><p id="2f80" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">下面是一个基本组件，用于验证我们的模拟器是否正常工作。它从一个名为<code class="fe ol om on nt b">tickets</code>的集合中提取数据，并在结果中循环。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oo op l"/></div><figcaption class="og oh gj gh gi oi oj bd b be z dk translated"><a class="ae mr" href="https://github.com/Everduin94/poc/blob/main/libs/fire/src/lib/fire-ticket/fire-ticket.component.ts" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="468b" class="ng ks iq nt b gy nx ny l nz oa"><strong class="nt ir">firebase emulators:start</strong></span></pre><ul class=""><li id="f93e" class="ms mt iq ll b lm mj lp mk ls oc lw od ma oe me mx my mz na bi translated">导航到<code class="fe ol om on nt b">localhost:4202</code>查看模拟器界面。您应该能够导航到并看到一个空的Firestore实例。如果您的应用程序尚未安装，您可以在此添加模拟数据。</li><li id="36d8" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">我们在应用程序中所做的更改应该反映在模拟器中，并在模拟器UI中可见</li><li id="091a" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">带有JSON的几乎空白的屏幕并不令人兴奋。下面是Firestore模拟器的<strong class="ll ir">生产实例。</strong></li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/a3f5336d720534d3632d080fee03c9cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*sdyvfz5yzOnnkUwyx7XQGw.gif"/></div></div><figcaption class="og oh gj gh gi oi oj bd b be z dk translated">仿真器示例</figcaption></figure><p id="821f" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">上面的例子使用来自模拟器的纯模拟数据</p><ul class=""><li id="884b" class="ms mt iq ll b lm mj lp mk ls oc lw od ma oe me mx my mz na bi translated">💡我们可以快速地<strong class="ll ir">生成和修改模拟数据，用于原型制作</strong>想法、概念证明、新功能、测试错误</li><li id="27aa" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">💵我们的实时环境不收取读写费用</li><li id="c8b4" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">🔥Firebase被方便地模仿，使它更容易用真实数据测试。</li></ul><p id="9f35" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">保存任何更改(替换文件夹名称)<a class="ae mr" href="https://github.com/Everduin94/poc/tree/main/apps/demo/poc-data" rel="noopener ugc nofollow" target="_blank">【示例结果】</a></p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="c934" class="ng ks iq nt b gy nx ny l nz oa">-- Save Mock Data<strong class="nt ir"><br/>firebase emulators:export FOLDER_NAME<br/></strong>-- Start Emulator with Mock Data<strong class="nt ir"><br/>firebase emulators:start --import=FOLDER_NAME</strong></span></pre><p id="7dbe" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">现在，我们可以使用数据集作为基线<strong class="ll ir">轻松地设置/拆除环境。让我们看看如何在e2e测试中利用这些数据。</strong></p><h1 id="3618" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">警告:在玩笑中使用(单元测试)❌</h1><p id="96cc" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我为此创建了一个概念证明，但我选择不将它添加到本文中。复杂性和缺点太多，不值得做(海事组织)。</p><ul class=""><li id="cf3f" class="ms mt iq ll b lm mj lp mk ls oc lw od ma oe me mx my mz na bi translated">我们必须使用node作为jest环境。</li><li id="cd6b" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">我们必须将我们的firebase配置添加到每个测试中</li><li id="6703" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">Firebase模拟器不像内存API那样重置每个测试。</li><li id="618f" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">除了单元测试firebase规则之外，这类事情的文档/支持非常少</li></ul><h1 id="e662" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">在柏树中使用(E2E试验*)🌳</h1><p id="e2fa" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在这个策略之前，我会将数据集保存在开发环境中，我知道这些环境是不能改变的，否则我的测试可能会失败😱。这是一个非常脆弱的方法。将模拟器与Cypress一起使用可以显著改善这个过程</p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="d5d8" class="ng ks iq nt b gy nx ny l nz oa">-- NX<strong class="nt ir"><br/>nx run APP-e2e:e2e --watch</strong></span><span id="e409" class="ng ks iq nt b gy ob ny l nz oa">-- Angular<br/><strong class="nt ir">ng serve<br/>cypress open</strong></span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/067f2e0d880b0c2122c93d350fa8415c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*fIHVxGy4efcfMuu4Frf8Tw.gif"/></div></div><figcaption class="og oh gj gh gi oi oj bd b be z dk translated">柏树试验</figcaption></figure><ul class=""><li id="c0fa" class="ms mt iq ll b lm mj lp mk ls oc lw od ma oe me mx my mz na bi translated">我在所有的E2E测试中都使用这个策略。</li><li id="4f84" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">它使用了<strong class="ll ir"> 0 json fixtures和0 cypress intercepts。</strong></li><li id="8bd6" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">注意，记住<strong class="ll ir">仿真器仅在关机</strong>时清除数据。在CLI中，这很好，因为我们总是从干净的状态运行。但是如果您在本地使用cypress，您可能必须清除您的数据或者编写测试，以回到它们最初的状态。</li></ul><h2 id="1c19" class="ng ks iq bd kt nh ni dn kx nj nk dp lb ls nl nm ld lw nn no lf ma np nq lh nr bi translated">在Cypress中设置Auth</h2><p id="2b7e" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">前面，我们提到使用<code class="fe ol om on nt b">@angular/fire</code>导入很重要，这样提供者才能工作。在这种情况下，由于我们在Angular (在Cypress代码中)的上下文之外<strong class="ll ir">，我们需要使用<code class="fe ol om on nt b">@firebase</code> imports。—在我们<em class="mi">的</em>命令中:</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oo op l"/></div><figcaption class="og oh gj gh gi oi oj bd b be z dk translated"><a class="ae mr" href="https://github.com/Everduin94/poc/blob/main/apps/demo-e2e/src/support/commands.ts" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><ul class=""><li id="4853" class="ms mt iq ll b lm mj lp mk ls oc lw od ma oe me mx my mz na bi translated">这些是我们可以在任何Cypress测试中重用和调用的命令</li><li id="9994" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">当被调用时，<strong class="ll ir">身份验证令牌被持久化到浏览器中，</strong>我们在<em class="mi"> app.module </em>中设置的原始身份验证提供者然后获取令牌。</li><li id="a231" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">也就是说，我们所有的角度验证逻辑仍然有效。即使在Cypress命令中，auth是用<em class="mi"> firebase/auth、</em>而不是<em class="mi"> @angular/fire/auth </em>设置的</li></ul><p id="3566" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">在运行下面的测试之前，请确保我们至少有一个用户。<strong class="ll ir">如果我们没有用户</strong>，我们可以在<code class="fe ol om on nt b">localhost:4202</code>的模拟器ui中创建一个</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/7be9d098411016c65cfed20eb482be64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ofIonA1mKPdI095d2Nl2Tw.png"/></div></div><figcaption class="og oh gj gh gi oi oj bd b be z dk translated">是的，我的用户名为山鸡和水蜜桃</figcaption></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oo op l"/></div><figcaption class="og oh gj gh gi oi oj bd b be z dk translated"><a class="ae mr" href="https://github.com/Everduin94/poc/blob/main/apps/demo-e2e/src/integration/app.spec.ts" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><ul class=""><li id="37ad" class="ms mt iq ll b lm mj lp mk ls oc lw od ma oe me mx my mz na bi translated">为了认证地运行我们的项目，我们调用<code class="fe ol om on nt b">cy.init</code>在Cypress中设置认证提供者。然后我们用模拟器用户的电子邮件/密码呼叫<code class="fe ol om on nt b">cy.login</code></li><li id="c2fb" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">不要忘记运行<code class="fe ol om on nt b">firebase emulators:export FOLDER_NAME</code>来保存您的用户。</li></ul><blockquote class="mf mg mh"><p id="04f1" class="lj lk mi ll b lm mj jr lo lp mk ju lr ml mm lu lv mn mo ly lz mp mq mc md me ij bi translated">⚡tldr——这个设置允许你在<strong class="ll ir">运行Cypress测试</strong>时用<strong class="ll ir"> firebase模拟器用户</strong>登录<strong class="ll ir"/></p></blockquote><h1 id="f3d8" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">结论</h1><p id="d629" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">以下是我遇到的陷阱。促使我首先写这篇文章的巨大动力是所有的陷阱。希望这篇文章能帮助你更快地解决这些问题。</p><p id="ef83" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">*在这种情况下，e2e被广泛使用。由于我们没有触及一个实时的后端，我称之为“功能性”测试。</p><blockquote class="mf mg mh"><p id="3097" class="lj lk mi ll b lm mj jr lo lp mk ju lr ml mm lu lv mn mo ly lz mp mq mc md me ij bi translated">☁️<a class="ae mr" href="https://flotes.app" rel="noopener ugc nofollow" target="_blank">flotes</a>——尝试演示，不需要登录。或者免费报名。Flotes是我记笔记和高效学习的方式，即使在我很忙的时候。</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/8e468f6e74135bbbc2ecbfce7e2db2bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wGqAj2R16w33dIiKDnHEUA.png"/></div></div><figcaption class="og oh gj gh gi oi oj bd b be z dk translated"><a class="ae mr" href="https://flotes.app" rel="noopener ugc nofollow" target="_blank">浮尸</a></figcaption></figure><h1 id="ef62" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">陷阱🪤</h1><h2 id="e285" class="ng ks iq bd kt nh ni dn kx nj nk dp lb ls nl nm ld lw nn no lf ma np nq lh nr bi translated">firebase模拟器:启动挂起</h2><p id="7878" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated"><code class="fe ol om on nt b">firebase emulators:start</code>挂起一分钟，然后关机。</p><p id="82ae" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">为了解决这个问题，我必须确保我有一个兼容的node.js版本和firebase版本。我目前正在使用:</p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="5a4c" class="ng ks iq nt b gy nx ny l nz oa"><strong class="nt ir">firebase:</strong> 10.0.1<br/><strong class="nt ir">npm:</strong> 8.1.2<br/><strong class="nt ir">node:</strong> 16.13.1<br/><strong class="nt ir">openjdk:</strong> 11.0.15</span></pre><h2 id="66b7" class="ng ks iq bd kt nh ni dn kx nj nk dp lb ls nl nm ld lw nn no lf ma np nq lh nr bi translated">firebase error:PERMISSION _ DENIED:没有匹配的allow语句</h2><p id="f83b" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这源于你的火焰法则。当我初始化我的项目时，我没有意识到我的服务器端规则被复制到了我的本地项目中，这是我不想要的。<a class="ae mr" href="https://firebase.google.com/docs/rules" rel="noopener ugc nofollow" target="_blank">文件</a></p><h2 id="c686" class="ng ks iq bd kt nh ni dn kx nj nk dp lb ls nl nm ld lw nn no lf ma np nq lh nr bi translated">角度/火焰v7</h2><p id="3f95" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">角火发布了新的模块化SDK。这意味着你可以像普通的Firebase SDK一样使用Angular Fire，并在其上添加一些RxJS便利操作符。</p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="1add" class="ng ks iq nt b gy nx ny l nz oa"><strong class="nt ir">NullInjectorError: No provider for InjectionToken angularfire2.app.options</strong></span></pre><p id="a4ec" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">AngularFire v7提供了新的模块化SDK和一个兼容层，可以像过去一样使用AngularFire。两者不共享提供者。也就是说，你可能已经通过类似<code class="fe ol om on nt b">provideFirestore</code>的东西设置/提供了你的firebase配置，然后试图使用<code class="fe ol om on nt b">private afs: AngularFirestore</code>。在这种情况下，您需要<strong class="ll ir">导入<em class="mi"> AngularFirestoreModule </em>或将<em class="mi"> AngularFirestore </em>替换为它的</strong> <a class="ae mr" href="https://github.com/angular/angularfire/blob/master/docs/version-7-upgrade.md#alternatives-to-v6-apis" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir"> v7等价的</strong> </a> <strong class="ll ir">。</strong></p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="5f37" class="ng ks iq nt b gy nx ny l nz oa"><strong class="nt ir">Module not found: Error: Can't resolve '@angular/core'</strong></span></pre><p id="2c12" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">您可能在angular应用程序的上下文之外导入了<em class="mi"> @angular/fire/FOLDER </em>。<strong class="ll ir">你必须使用<em class="mi"> firebase/FOLDER </em>导入Angular </strong>之外的东西(例如，在Cypress)</p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="17bb" class="ng ks iq nt b gy nx ny l nz oa"><strong class="nt ir">collectionChanges Doesn't Emit when Empty</strong></span></pre><p id="4f7d" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">像<code class="fe ol om on nt b">collectionChanges</code>这样的方法可能是非常有益的，并在下游项目中使用，但(在国际海事组织看来)基本上是不可用的，因为存在像<a class="ae mr" href="https://github.com/FirebaseExtended/rxfire/issues/55" rel="noopener ugc nofollow" target="_blank">这个</a>和<a class="ae mr" href="https://github.com/dappsnation/akita-ng-fire/issues/238" rel="noopener ugc nofollow" target="_blank">这个(下游)</a>这样的问题</p><p id="fa0e" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">您也可以使用<code class="fe ol om on nt b"><a class="ae mr" href="https://github.com/angular/angularfire/blob/7d471662a10c92c4c340f70540c8a57c2bf71f01/README.md#example-use" rel="noopener ugc nofollow" target="_blank">collectionData</a></code>来获取所有排放。</p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="d407" class="ng ks iq nt b gy nx ny l nz oa"><strong class="nt ir">When using collection(): Expected 0 type arguments but got 1</strong></span></pre><p id="ccce" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">作为替代，你可以使用<code class="fe ol om on nt b">collection(firestore, ‘tickets’) as CollectionReference&lt;Tickets&gt;;</code>。— <a class="ae mr" href="https://github.com/angular/angularfire/issues/3081" rel="noopener ugc nofollow" target="_blank">参见问题</a></p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="2ca9" class="ng ks iq nt b gy nx ny l nz oa"><strong class="nt ir">Cypress won't load firestore data</strong></span></pre><p id="7712" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">您需要启用<em class="mi">experimentalforcelonpolling。</em></p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="24ce" class="ng ks iq nt b gy nx ny l nz oa">provideFirestore(() =&gt; {<br/>  const firestore = initializeFirestore(getApp(), <strong class="nt ir">{<br/>    experimentalForceLongPolling: environment.production ? false : true,<br/>  }</strong>);<br/>  return firestore;<br/>}),</span></pre></div></div>    
</body>
</html>