<html>
<head>
<title>Virtual Kubernetes Clusters In Production</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">生产中的虚拟Kubernetes集群</h1>
<blockquote>原文：<a href="https://itnext.io/virtual-kubernetes-clusters-in-production-ccb09a0825fd?source=collection_archive---------6-----------------------#2020-10-07">https://itnext.io/virtual-kubernetes-clusters-in-production-ccb09a0825fd?source=collection_archive---------6-----------------------#2020-10-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="6c68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虚拟Kubernetes集群不仅可以用于开发环境，还可以以多种方式改进生产系统。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/0028c78f933572edb6a7f82b193b6f0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DpypXXTwqSix39dR"/></div></div></figure><p id="631f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kx" href="https://loft.sh/blog/introduction-into-virtual-clusters-in-kubernetes/" rel="noopener ugc nofollow" target="_blank">虚拟Kubernetes集群(vClusters) </a>的理念是在另一个Kubernetes集群中运行一个全功能集群，以提供高效的抽象，并在共享的底层集群之上直接访问Kubernetes。</p><p id="5133" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经描述了此类虚拟集群用于开发的<a class="ae kx" href="https://loft.sh/blog/virtual-clusters-for-kubernetes-benefits-use-cases/" rel="noopener ugc nofollow" target="_blank">优势和用例，特别是用于</a><a class="ae kx" href="https://loft.sh/blog/kubernetes-virtual-clusters-as-development-environments/" rel="noopener ugc nofollow" target="_blank">云原生开发</a>、<a class="ae kx" href="https://loft.sh/blog/kubernetes-virtual-clusters-for-ci-cd-testing/" rel="noopener ugc nofollow" target="_blank"> CI/CD </a>和<a class="ae kx" href="https://loft.sh/blog/kubernetes-virtual-clusters-for-ai-ml-experiments/" rel="noopener ugc nofollow" target="_blank"> ML/AI实验</a>。然而，由于vClusters与常规的Kubernetes集群和名称空间一样灵活，因此除了开发之外，它们还可以用于许多情况。</p><p id="c5b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我想描述一些我认为虚拟集群最有价值的生产用例。</p><h1 id="eb07" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">用vClusters替代集群以节省成本</h1><p id="27f1" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated"><a class="ae kx" href="https://loft.sh/blog/kubernetes-cost-savings/" rel="noopener ugc nofollow" target="_blank">运行更少的Kubernetes集群通常更便宜</a>，因为更少的集群导致更少的冗余和更高的利用率。此外，集群管理员更容易管理它们。</p><p id="83da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，人们仍然没有在一个集群上运行所有的东西，这是有充分理由的。通常，这是因为您必须运行名称空间中的所有内容，而名称空间在许多情况下不能提供足够的隔离。与名称空间相比，vClusters提高了租户的隔离性，因此有助于实现一种更难的形式<a class="ae kx" href="https://loft.sh/blog/kubernetes-multi-tenancy-best-practices-guide/" rel="noopener ugc nofollow" target="_blank"> Kubernetes多租户</a>。这允许您将应用程序的某些部分集中在一个集群中，这些部分目前由于隔离问题而被分开。(当然，这并不意味着您应该在一个集群上运行所有的东西。)</p><p id="c831" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将不同集群上的应用程序分开的另一个原因是它们需要集群的单独配置。虽然这在名称空间中是不可能的，但是虚拟集群可以灵活地进行不同的配置，例如，甚至可以为虚拟集群使用不同的Kubernetes版本。这又让您可以将应用程序集中在一起，减少集群数量，从而节省成本。</p><p id="d15a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为此，虚拟集群解决方案也可能会引起托管和云提供商的兴趣，他们希望为客户提供灵活的Kubernetes环境，但也可以以较低的价格销售这种vClusters体验，因为并非每个客户都需要实际的物理集群，而只是完全的Kubernetes访问。</p><blockquote class="mb mc md"><p id="86c8" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated"><em class="iq">我写了一篇关于进一步选择</em> <a class="ae kx" href="https://loft.sh/blog/reduce-kubernetes-cost/" rel="noopener ugc nofollow" target="_blank"> <em class="iq">降低你的Kubernetes费用</em> </a> <em class="iq">的专门文章。</em></p></blockquote><h1 id="3fee" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">用vClusters替换命名空间以提高稳定性</h1><p id="74ef" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">当没有必要在集群上分离(部分)应用程序时，名称空间通常被用作运行软件的一种更便宜、更容易的方法。在这些情况下，名称空间可以由虚拟集群代替，因为它们有助于提高系统的安全性，因为它们具有更好的隔离性，并且为应用程序的不同部分提供了更灵活的配置。</p><p id="67cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，虚拟集群集群不仅允许您更频繁地共享集群，而且有助于优化您的生产系统。因此，vClusters通常是“更好的命名空间”。</p><h1 id="1c8d" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">达到更高的可扩展性</h1><p id="e1f7" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">如果您运行具有大量网络流量和负载的非常大的集群，您可能会达到可伸缩性的技术极限。自然，这通常发生在有许多用户或客户的生产用例中。</p><p id="9912" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，您通常需要额外的集群来处理大量的流量。但是，仅仅因为Kubernetes API服务器或集群的etcd达到了极限，运行额外的集群并不一定是最优的。相反，运行多个API服务器或etcds来处理负载可能更有效。</p><p id="25ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于每个虚拟集群都有自己的API服务器和etcd，因此可以使用vClusters实现高效的<a class="ae kx" href="https://loft.sh/use-cases/kubernetes-cluster-sharding" rel="noopener ugc nofollow" target="_blank"> Kubernetes集群分片</a>。这是可能的，因为对虚拟集群的请求通常由虚拟集群本身来处理，这减少了底层集群上的负载，因为只有一些请求由虚拟集群传递和处理。因此，您可以将负载“分散”到不同的虚拟集群上，从而避免物理集群的早期瓶颈问题。</p><p id="8ed0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，有可能突破集群所能处理的流量的技术限制，这样您就可以节省成本并优化系统，只需在合理的情况下添加集群。</p><h1 id="4e06" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">更容易、更便宜地提供托管产品</h1><p id="39b0" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">虽然虚拟集群的第一个生产用例相当普遍，但也有一些更具体的场景非常有用。其中之一是<a class="ae kx" href="https://loft.sh/use-cases/cloud-native-managed-products" rel="noopener ugc nofollow" target="_blank">向您的客户</a>提供被管理产品。</p><p id="f347" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通常有两种主要的技术方法来为您的客户提供软件即服务(SaaS)体验:<a class="ae kx" href="https://blog.scaleway.com/saas-multi-tenant-vs-multi-instance-architectures/" rel="noopener ugc nofollow" target="_blank">多租户和多实例</a>。</p><p id="7247" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您为您的SaaS产品提供一种多租户方法，您运行一个系统实例和一个由不同客户共享的数据库。在这里，vClusters可以通过提供更好的租户隔离和更大的可伸缩性来提高系统效率，再次为您提供帮助。</p><p id="7a36" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用多实例方法，每个客户都有自己的系统和数据库实例。虚拟集群允许您非常容易地做到这一点，因为您可以在虚拟集群中复制您的系统。因此，每个客户都有一个专用的软件实例，但所有实例仍在单个集群上运行，这减少了系统的管理工作量。由于不必为每个客户启动新的集群，新实例的设置也更快，并且整个系统运行更有效，因为底层计算资源可以共享，因此不会空闲运行。</p><p id="405d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总之，无论您想使用哪种体系结构方法，vClusters都有助于向客户提供SaaS产品。</p><h1 id="a337" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">快速轻松地运行交互式演示</h1><p id="c463" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">虚拟Kubernetes集群的最后一个生产用例是<a class="ae kx" href="https://loft.sh/use-cases/live-demos" rel="noopener ugc nofollow" target="_blank">为你的产品</a>制作互动演示。尽管演示并不是真正的生产系统，但是它们的使用和功能更接近于传统的生产场景，而不是开发，这就是为什么我要在这里提到它们。</p><p id="7f01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您销售一个内部产品，您的客户(尤其是B2B客户)通常希望在决定购买之前，甚至在他们自己在基础设施上安装之前，看到一个演示。你的产品的演示版本既可以被销售人员使用，也可以被客户自己使用。</p><p id="1f15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在任何情况下，如果演示总是在相同的干净状态下开始，并且随时可用，也就是说，不必由管理员首先进行调配，这通常是有意义的。这些要求使它们成为虚拟集群的一个非常好的用例:v cluster可以在几秒钟内从头开始启动，而不是在云环境中启动“真正的”集群需要几分钟。如果底层集群正在运行，它们也总是可用的。</p><p id="9dad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，由于许多v cluster只需要一个底层集群，因此几名销售人员(或客户)可以按需独立启动演示，这样就不会有一个演示应用程序在每次演示后都必须重置。当演示结束时，整个演示环境(即vCluster)也可以被删除，这一过程甚至可以通过<a class="ae kx" href="https://loft.sh/docs/self-service/sleep-mode" rel="noopener ugc nofollow" target="_blank">自动删除设置</a>实现自动化。或者，如果在同一阶段再次使用该环境，也可以保留该环境。</p><p id="3171" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总之，由于共享的基础设施和自动清理，在虚拟集群中运行演示是便宜的，并且由于按需可用的独立环境是容易的。这使得在您的销售活动中使用演示更具吸引力，最终将有助于推动销售和收入。</p><h1 id="9151" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">结论</h1><p id="8f9b" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">虚拟集群有很多好处，这使得它们不仅适用于开发场景，还适用于各种生产环境。通过提供更多的隔离和稳定性，或者通过增加集群可伸缩性的限制，它们可以用来从技术上改进您的系统。此外，如果您可以用vClusters替换整个集群，虚拟集群可以有效地降低您的成本。他们还可以帮助您解决如何高效地向客户提供被管理产品和产品演示的实际问题。</p><p id="db25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总的来说，考虑到Kubernetes应用程序的丰富性，我相信在生产过程中还会有更多的虚拟集群用例尚未被探索。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><p id="b79c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">照片由<a class="ae kx" href="https://www.pexels.com/@wolfgang-1002140?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">沃尔夫冈</a>从<a class="ae kx" href="https://www.pexels.com/photo/photo-of-people-watching-a-concert-2747449/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">派克斯</a>拍摄</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><p id="8fcf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="me">最初发布于</em><a class="ae kx" href="https://loft.sh/blog/virtual-kubernetes-clusters-in-production/" rel="noopener ugc nofollow" target="_blank"><em class="me">https://loft . sh</em></a><em class="me">。</em></p></div></div>    
</body>
</html>