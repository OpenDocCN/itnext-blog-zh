<html>
<head>
<title>Micro In Action, Part 1: Getting Started</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Micro在行动，第1部分:入门</h1>
<blockquote>原文：<a href="https://itnext.io/micro-in-action-getting-started-a79916ae3cac?source=collection_archive---------0-----------------------#2020-01-12">https://itnext.io/micro-in-action-getting-started-a79916ae3cac?source=collection_archive---------0-----------------------#2020-01-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/e7c0886bac25ba1a3762633dee4aa00f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hzZg212o5bIc20VBuYq2nw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">微在行动</figcaption></figure><p id="bdc4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">2020.04.02更新:该系列的Micro版本从v1.18.0升级到v2.4.0</p></div><div class="ab cl ld le hx lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="im in io ip iq"><p id="822a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">先说这个系列文章里的<a class="ae lk" href="https://micro.mu/" rel="noopener ugc nofollow" target="_blank">微</a>。</p><p id="db5d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们将逐步建立一个基于微的服务，在这个过程中解释微的特性。我们将从基本概念和主题开始，然后转向高级功能。</p><p id="7dd4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">微操掌握后很厉害，很好用。但是它发展如此之快，导致其文档严重缺失、滞后或过时。</p><p id="771c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">许多功能没有记录在案。很多基础问题都要在Github上咨询或者在Slack上问，反馈很少。</p><p id="627f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">钻研源代码成了唯一实用的学习方法。这对用户非常不友好，也阻碍了Micro被更多人采用。</p><p id="7094" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这也是我开始这一系列文章的原因。希望能帮到你。(注:该系列基于micro v2.24.0)</p></div><div class="ab cl ld le hx lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="im in io ip iq"><h1 id="f0f5" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">那么微观到底是什么呢？</h1><p id="9d72" class="pw-post-body-paragraph kf kg it kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc im bi translated">先来看看它的<a class="ae lk" href="https://micro.mu/" rel="noopener ugc nofollow" target="_blank">网站首页</a>:</p><blockquote class="mo mp mq"><p id="f9ad" class="kf kg mr kh b ki kj kk kl km kn ko kp ms kr ks kt mt kv kw kx mu kz la lb lc im bi translated">构建、共享和协作微服务的最简单方式</p><p id="21ff" class="kf kg mr kh b ki kj kk kl km kn ko kp ms kr ks kt mt kv kw kx mu kz la lb lc im bi translated">Micro powers是一个开放的全球服务平台，开发人员可以在云和其他环境中构建微服务，而不会有管理基础设施的麻烦。</p></blockquote><p id="ad66" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">然后公文第4页的<a class="ae lk" href="https://micro.mu/docs/goals.html" rel="noopener ugc nofollow" target="_blank">声明:</a></p><blockquote class="mo mp mq"><p id="b571" class="kf kg mr kh b ki kj kk kl km kn ko kp ms kr ks kt mt kv kw kx mu kz la lb lc im bi translated">Micro是一个微服务生态系统，专注于提供产品、服务和解决方案，以支持现代软件驱动型企业的创新。</p></blockquote><p id="8a07" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">你明白了吗？我不知道。</p><p id="3f52" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">看完它所有的文档，让我给你一个更直白的定义:</p><p id="f13e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Micro是一套帮助开发者构建和管理微服务的工具。它包含两个部分:</p><ol class=""><li id="95ce" class="mv mw it kh b ki kj km kn kq mx ku my ky mz lc na nb nc nd bi translated"><a class="ae lk" href="https://github.com/micro/go-micro" rel="noopener ugc nofollow" target="_blank"> <strong class="kh iu"> go-micro </strong> </a>:一个Golang微服务开发框架。它是核心。通过利用它，开发人员可以快速构建微服务。这些微服务的典型类型是gRPC。</li><li id="646f" class="mv mw it kh b ki ne km nf kq ng ku nh ky ni lc na nb nc nd bi translated"><a class="ae lk" href="https://github.com/micro/micro" rel="noopener ugc nofollow" target="_blank"> <strong class="kh iu">微</strong> </a>:命令行工具。虽然不是强制的，但是为微开发和管理提供了很多便利。例如，模板项目生成、运行时状态检查和服务调用。这个工具也是基于<strong class="kh iu"> go-micro </strong>。</li></ol><p id="1618" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">另外，<a class="ae lk" href="https://github.com/micro/go-plugins" rel="noopener ugc nofollow" target="_blank"> <strong class="kh iu"> go-plugins </strong> </a>在大多数情况下都是必须的，是一系列的插件。它提供了许多不同的选择，包括服务发现、异步消息传递和传输协议。由于<strong class="kh iu"> go-micro </strong>设计为插件架构，有了这些插件，可以实现非常灵活的组合，满足各种需求。用户可以随时开发自己的插件进行进一步扩展。</p><p id="24ba" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">好吧，为什么官方的定义这么宏大抽象？</p><p id="3be6" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">因为Micro <a class="nj nk ep" href="https://medium.com/u/139d4f55a09a?source=post_page-----a79916ae3cac--------------------------------" rel="noopener" target="_blank"> Asim Aslam </a>的创造者不仅仅是提供工具。他最近的努力旨在<a class="ae lk" href="https://medium.com/microhq/building-a-global-services-network-using-go-quic-and-micro-2c1cf9b89c8?source=collection_home---6------0-----------------------" rel="noopener">建立一个“分布式网络”</a>——尽管在我看来有相当多的重要问题<a class="ae lk" href="https://medium.com/@dche423/looks-very-ambitious-im-a-little-bit-curious-about-micro-network-9c82078016bc" rel="noopener">需要解决，而且可行性值得怀疑。</a></p><p id="b048" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">因此，如果您想要的只是加速组织中微服务的开发和治理，您可以只关注其核心功能。这也是本系列文章关注的地方</p></div><div class="ab cl ld le hx lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="im in io ip iq"><h1 id="5ec4" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">go-micro的设计师</h1><p id="984c" class="pw-post-body-paragraph kf kg it kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc im bi translated">为了方便理解，我们先介绍一下<strong class="kh iu"> go-micro </strong>的架构。</p><p id="82bf" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">go-micro的目标是简化微服务开发和分布式系统构建。实际上，在每个分布式系统中总是需要做一些工作。</p><p id="0a4a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">因此<strong class="kh iu"> go-micro </strong>将这些常见任务抽象成接口。这将开发人员从底层实现细节中解放出来，降低了学习和开发成本。使得非常快速地构建灵活且健壮系统成为可能。</p><figure class="nm nn no np gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nl"><img src="../Images/d0af3403017b0ff7aef392831c48bf96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VdeGqjujc-pfL73JGLI3-w@2x.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">来自<a class="ae lk" href="https://micro.mu/" rel="noopener ugc nofollow" target="_blank">https://micro.mu/</a></figcaption></figure><p id="7fdf" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在这些接口中，<strong class="kh iu">服务</strong>是核心接口。它负责协调其他接口一起工作。我们将在后面深入探讨。</p><p id="5543" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">以下是重要接口的示例:</p><h2 id="748d" class="nq lm it bd ln nr ns dn lr nt nu dp lv kq nv nw lz ku nx ny md ky nz oa mh ob bi translated">服务发现</h2><p id="68b9" class="pw-post-body-paragraph kf kg it kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc im bi translated">服务发现是每个分布式系统都必须解决的问题。<strong class="kh iu"> go-micro </strong>将这个任务抽象成一个接口<code class="fe oc od oe of b">github.com/micro/go-micro/v2/registry/Registry</code>:</p><pre class="nm nn no np gt og of oh oi aw oj bi"><span id="a9ed" class="nq lm it of b gy ok ol l om on">// The registry provides an interface for service discovery<br/>// and an abstraction over varying implementations<br/>// {consul, etcd, zookeeper, ...}<br/>type <strong class="of iu">Registry</strong> interface {<br/>   Init(...Option) error<br/>   Options() Options<br/>   Register(*Service, ...RegisterOption) error<br/>   Deregister(*Service) error<br/>   GetService(string) ([]*Service, error)<br/>   ListServices() ([]*Service, error)<br/>   Watch(...WatchOption) (Watcher, error)<br/>   String() string<br/>}</span></pre><p id="69d3" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">任何实现这个接口的插件都可以扮演服务发现的角色。其实<a class="ae lk" href="https://github.com/micro/go-plugins/tree/master/registry" rel="noopener ugc nofollow" target="_blank">很多实现</a>已经在<strong class="kh iu"> go-plugins </strong>中提供了，包括对etcd/consul/zookeeper等主流产品的支持，以及内存中的轻量级实现。默认实现基于多播DNS (mdns)，不需要任何配置，开箱即用</p><h2 id="e1b2" class="nq lm it bd ln nr ns dn lr nt nu dp lv kq nv nw lz ku nx ny md ky nz oa mh ob bi translated">异步消息传递</h2><p id="b03c" class="pw-post-body-paragraph kf kg it kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc im bi translated">异步消息传递是构建松耦合和健壮系统的关键技术。对应的<strong class="kh iu"> go-micro </strong>接口为:<code class="fe oc od oe of b">github.com/micro/go-micro/v2/broker/Broker</code></p><pre class="nm nn no np gt og of oh oi aw oj bi"><span id="7b02" class="nq lm it of b gy ok ol l om on">// Broker is an interface used for asynchronous messaging.<br/>type <strong class="of iu">Broker</strong> interface {<br/>   Init(...Option) error<br/>   Options() Options<br/>   Address() string<br/>   Connect() error<br/>   Disconnect() error<br/>   Publish(topic string, m *Message, opts ...PublishOption) error<br/>   Subscribe(topic string, h Handler, opts ...SubscribeOption) (Subscriber, error)<br/>   String() string<br/>}</span></pre><p id="e06b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu"> go-plugins </strong>中已经有几个<a class="ae lk" href="https://github.com/micro/go-plugins/tree/master/broker" rel="noopener ugc nofollow" target="_blank">经纪人插件</a>包括RabbitMQ、Kafka、NSQ等。，默认实现基于HTTP，不需要任何配置。</p><h2 id="3f33" class="nq lm it bd ln nr ns dn lr nt nu dp lv kq nv nw lz ku nx ny md ky nz oa mh ob bi translated">多媒体数字信号编解码器</h2><p id="0bda" class="pw-post-body-paragraph kf kg it kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc im bi translated">编解码器接口(<code class="fe oc od oe of b">github.com/micro/go-micro/v2/codec/Codec</code>)定义微服务之间通信的消息编码/解码格式。</p><pre class="nm nn no np gt og of oh oi aw oj bi"><span id="021f" class="nq lm it of b gy ok ol l om on">// Codec encodes/decodes various types of messages used within go-micro.<br/>// ReadHeader and ReadBody are called in pairs to read requests/responses<br/>// from the connection. Close is called when finished with the<br/>// connection. ReadBody may be called with a nil argument to force the<br/>// body to be read and discarded.<br/>type <strong class="of iu">Codec</strong> interface {<br/>   Reader<br/>   Writer<br/>   Close() error<br/>   String() string<br/>}</span></pre><p id="dd7c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">目前支持的包括json / bson / msgpack等。</p><p id="effd" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">除了上面的三个接口，还有许多其他接口:</p><ul class=""><li id="63e2" class="mv mw it kh b ki kj km kn kq mx ku my ky mz lc oo nb nc nd bi translated"><strong class="kh iu">服务器</strong>，定义微服务的服务器</li><li id="4260" class="mv mw it kh b ki ne km nf kq ng ku nh ky ni lc oo nb nc nd bi translated"><strong class="kh iu">传输</strong>，定义传输协议</li><li id="193c" class="mv mw it kh b ki ne km nf kq ng ku nh ky ni lc oo nb nc nd bi translated"><strong class="kh iu">选择器</strong>，抽象服务选择的逻辑。您可以使用这个接口实现各种负载平衡策略</li><li id="c9d4" class="mv mw it kh b ki ne km nf kq ng ku nh ky ni lc oo nb nc nd bi translated"><strong class="kh iu">包装器</strong>，定义了可以包装服务器/客户端请求的中间件</li></ul><p id="2b6e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">如您所见，<strong class="kh iu"> go-micro </strong>在拆分和抽象分布式系统方面做得很好，并提供了丰富的默认实现。如果需要任何扩展功能，开发人员可以很容易地构建一个新的插件，并将其应用到系统中。</p><p id="c0e8" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">有了这个坚实的基础，开发人员可以更专注于业务逻辑开发，而不是专注于繁琐的基础任务。送货效率大大提高</p></div><div class="ab cl ld le hx lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="im in io ip iq"><h1 id="896c" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">用Micro构建gRPC服务</h1><p id="e645" class="pw-post-body-paragraph kf kg it kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc im bi translated">开始使用Micro的最快方法是通过命令行工具<code class="fe oc od oe of b">micro</code>创建一个模板项目。</p><h2 id="73b8" class="nq lm it bd ln nr ns dn lr nt nu dp lv kq nv nw lz ku nx ny md ky nz oa mh ob bi translated">安装微二进制版本2.4.0</h2><p id="56c3" class="pw-post-body-paragraph kf kg it kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc im bi translated">注意:不要使用官方网站提供的脚本<em class="mr"> install.sh，因为它总是安装最新版本，而你需要的是一个特定的稳定版本。</em></p><pre class="nm nn no np gt og of oh oi aw oj bi"><span id="50e1" class="nq lm it of b gy ok ol l om on"><strong class="of iu">GO111MODULE=on</strong>  go get <!-- -->github.com/micro/micro/v2@v2.4.0</span></pre><h2 id="61a0" class="nq lm it bd ln nr ns dn lr nt nu dp lv kq nv nw lz ku nx ny md ky nz oa mh ob bi translated">创建项目</h2><pre class="nm nn no np gt og of oh oi aw oj bi"><span id="4068" class="nq lm it of b gy ok ol l om on">micro new --namespace=com.foo --gopath=false hello</span></pre><p id="b4ed" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">命令的每个部分都有自己的含义:</p><ul class=""><li id="3a8c" class="mv mw it kh b ki kj km kn kq mx ku my ky mz lc oo nb nc nd bi translated"><strong class="kh iu">微新建</strong>，运行<strong class="kh iu">微</strong>命令行工具的<strong class="kh iu">新建</strong>子命令，创建gRPC服务</li><li id="3465" class="mv mw it kh b ki ne km nf kq ng ku nh ky ni lc oo nb nc nd bi translated"><strong class="kh iu">您好</strong>，指定服务名</li><li id="082e" class="mv mw it kh b ki ne km nf kq ng ku nh ky ni lc oo nb nc nd bi translated"><strong class="kh iu"> — namespace=com.foo </strong>，为服务提供一个名称空间</li><li id="22aa" class="mv mw it kh b ki ne km nf kq ng ku nh ky ni lc oo nb nc nd bi translated"><strong class="kh iu"> — gopath=false </strong>，生成代码到当前目录，而不是＄GOPATH(由于Golang支持<a class="ae lk" href="https://blog.golang.org/using-go-modules" rel="noopener ugc nofollow" target="_blank"> Go模块</a>，新项目应该放在＄GOPATH之外)</li></ul><p id="1739" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">支持其他一些论点，我们将在后续文章中解释它们。</p><p id="73c5" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">命令执行后，我们将得到如下屏幕输出:</p><pre class="nm nn no np gt og of oh oi aw oj bi"><span id="3dab" class="nq lm it of b gy ok ol l om on">Creating service com.foo.srv.hello in hello</span><span id="6b86" class="nq lm it of b gy op ol l om on">.<br/>├── main.go<br/>├── generate.go<br/>├── plugin.go<br/>├── handler<br/>│   └── hello.go<br/>├── subscriber<br/>│   └── hello.go<br/>├── proto/hello<br/>│   └── hello.proto<br/>├── Dockerfile<br/>├── Makefile<br/>├── README.md<br/>├── .gitignore<br/>└── go.mod</span><span id="e2ec" class="nq lm it of b gy op ol l om on">download protobuf for micro:</span><span id="ad40" class="nq lm it of b gy op ol l om on">brew install protobuf<br/>go get -u github.com/golang/protobuf/{proto,protoc-gen-go}<br/>go get -u github.com/micro/protoc-gen-micro/v2</span><span id="d608" class="nq lm it of b gy op ol l om on">compile the proto file hello.proto:</span><span id="5b4a" class="nq lm it of b gy op ol l om on">cd hello<br/>protoc --proto_path=.:$GOPATH/src --go_out=. --micro_out=. proto/hello/hello.proto</span></pre><h2 id="4756" class="nq lm it bd ln nr ns dn lr nt nu dp lv kq nv nw lz ku nx ny md ky nz oa mh ob bi translated">安装依赖项</h2><p id="4775" class="pw-post-body-paragraph kf kg it kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc im bi translated">由于Micro使用Protobuf来定义服务接口，所以我们需要先安装Protobuf相关的依赖项。以Mac环境为例:</p><pre class="nm nn no np gt og of oh oi aw oj bi"><span id="660c" class="nq lm it of b gy ok ol l om on"># install protobuf<br/>brew install protobuf</span><span id="06fd" class="nq lm it of b gy op ol l om on"># install protoc-gen-go<br/>go get -u github.com/golang/protobuf/{proto,protoc-gen-go}</span><span id="140b" class="nq lm it of b gy op ol l om on"># install protoc-gen-micro<br/><strong class="of iu">GO111MODULE=on </strong>go get -u <strong class="of iu">github.com/micro/protoc-gen-micro/v2</strong></span></pre><p id="bbf6" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">注意<code class="fe oc od oe of b">protoc-gen-micro</code>不是Protobuf核心的一部分，是微团队开发的Protobuf扩展，专门用来生成微相关代码。你需要通过<code class="fe oc od oe of b">GO111MODULE=on</code>显式启用Go模块，否则你会遇到一个错误(一个已知的<a class="ae lk" href="https://github.com/micro/protoc-gen-micro/issues/66" rel="noopener ugc nofollow" target="_blank">问题</a></p><h2 id="36a3" class="nq lm it bd ln nr ns dn lr nt nu dp lv kq nv nw lz ku nx ny md ky nz oa mh ob bi translated">执行</h2><p id="51df" class="pw-post-body-paragraph kf kg it kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc im bi translated">正如你所看到的，项目中生成了一个<strong class="kh iu"> Makefile </strong>，其中包含了几个常用的任务。所以您可以使用命令<code class="fe oc od oe of b">make</code>来编译和运行项目。</p><p id="664a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">明白了</strong>:您需要先显式安装<strong class="kh iu"> go-micro v2.4.0 </strong>:</p><pre class="nm nn no np gt og of oh oi aw oj bi"><span id="a5d1" class="nq lm it of b gy ok ol l om on">go get github.com/micro/go-micro/v2@v2.4.0</span></pre><p id="8722" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">然后<strong class="kh iu"> go.mod </strong>的内容会改为<strong class="kh iu"> : </strong></p><pre class="nm nn no np gt og of oh oi aw oj bi"><span id="375c" class="nq lm it of b gy ok ol l om on">module hello</span><span id="c2c6" class="nq lm it of b gy op ol l om on">go 1.14</span><span id="e2fb" class="nq lm it of b gy op ol l om on">require github.com/micro/go-micro/v2 v2.4.0</span></pre><p id="838e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">为什么我们必须先安装一个特定的版本？通过这样做，我们希望避免在代码编译期间自动安装最新版本的<strong class="kh iu"> go-micro </strong>。如前所述，Micro进化很快，有时最新版本还不够稳定。</p><p id="e700" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">例如，有6个版本的<strong class="kh iu"> go-micro </strong>在35天内发布。一些版本作为最新版本只存在了几个小时，他们被替换为热修复严重问题。</p><p id="bdfc" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">幸运的是，Go模块可以帮助我们锁定依赖性并确保交付质量。</p><p id="54cc" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">有了以上准备，我们现在可以编译并运行第一个服务了:</p><pre class="nm nn no np gt og of oh oi aw oj bi"><span id="e36f" class="nq lm it of b gy ok ol l om on">make build &amp;&amp; ./hello-service</span></pre><p id="8d59" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们将得到如下屏幕输出:</p><pre class="nm nn no np gt og of oh oi aw oj bi"><span id="c169" class="nq lm it of b gy ok ol l om on">make build &amp;&amp; ./hello-serviceprotoc --proto_path=. --micro_out=Mgithub.com/micro/go-micro/api/proto/api.proto=github.com/micro/go-micro/v2/api/proto:. --go_out=Mgithub.com/micro/go-micro/api/proto/api.proto=github.com/micro/go-micro/v2/api/proto:. proto/hello/hello.protogo build -o hello-service *.go2020-04-02 11:12:47  level=info Starting [service] go.micro.service.hello<br/>2020-04-02 11:12:47  level=info Server [grpc] Listening on [::]:53451<br/>2020-04-02 11:12:47  level=info Broker [eats] Connected to [::]:53453<br/>2020-04-02 11:12:47  level=info Registry [mdns] Registering node: go.micro.service.hello-063d6dae-826b-49f5-9141-df525af8a6b1<br/>2020-04-02 11:12:47  level=info Subscribing to topic: go.micro.service.hello</span></pre><p id="2bce" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">你得到的监听地址和节点uuid可能和我的不同，不要担心，我们稍后解释。</p><p id="e61c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">从屏幕输出可以看到，<code class="fe oc od oe of b">make build</code>首先运行<code class="fe oc od oe of b">protoc</code>，编译<strong class="kh iu">。proto </strong>文件，run <code class="fe oc od oe of b">go build</code>，生成可执行二进制文件<strong class="kh iu"> hello-service。</strong></p><p id="75dc" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">最后，<strong class="kh iu"> hello-service </strong>启动，准备上菜。</p></div><div class="ab cl ld le hx lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="im in io ip iq"><h1 id="243d" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">摘要</h1><p id="9db8" class="pw-post-body-paragraph kf kg it kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc im bi translated">本文介绍了Micro的核心概念和功能，指导用户安装它，创建并运行第一个最简单的gRPC服务。</p><p id="7013" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">本系列的后续文章将深入示例项目的代码，解释micro的更多特性，并尝试改变它的默认行为。</p><p id="8d25" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">未完待续。</p></div><div class="ab cl ld le hx lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="im in io ip iq"><p id="8305" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">另请参见:</p><ul class=""><li id="782a" class="mv mw it kh b ki kj km kn kq mx ku my ky mz lc oo nb nc nd bi translated"><a class="ae lk" rel="noopener ugc nofollow" target="_blank" href="/micro-in-action-part-2-71230f01d6fb"> Micro in Action，第2部分:Bootstrap终极指南</a></li><li id="e3cb" class="mv mw it kh b ki ne km nf kq ng ku nh ky ni lc oo nb nc nd bi translated"><a class="ae lk" rel="noopener ugc nofollow" target="_blank" href="/micro-in-action-part-3-calling-a-service-55d865928f11">微在行动，第3部分:调用服务</a></li><li id="17c6" class="mv mw it kh b ki ne km nf kq ng ku nh ky ni lc oo nb nc nd bi translated"><a class="ae lk" href="https://medium.com/@dche423/micro-in-action-part4-pub-sub-564f3b054ecd" rel="noopener">微在行动，第四部:发布/订阅</a></li><li id="eef5" class="mv mw it kh b ki ne km nf kq ng ku nh ky ni lc oo nb nc nd bi translated"><a class="ae lk" rel="noopener ugc nofollow" target="_blank" href="/micro-in-action-part-5-message-broker-a3decf07f26a"> Micro在行动，第5部分:消息代理</a></li><li id="aeb5" class="mv mw it kh b ki ne km nf kq ng ku nh ky ni lc oo nb nc nd bi translated"><a class="ae lk" rel="noopener ugc nofollow" target="_blank" href="/micro-in-action-part6-service-discovery-f988988e5936">微在行动，第6部分:服务发现</a></li><li id="0e1c" class="mv mw it kh b ki ne km nf kq ng ku nh ky ni lc oo nb nc nd bi translated"><a class="ae lk" rel="noopener ugc nofollow" target="_blank" href="/micro-in-action-7-circuit-breaker-rate-limiter-431ccff6a120">微动作，第7部分:断路器&amp;速率限制器</a></li><li id="49c2" class="mv mw it kh b ki ne km nf kq ng ku nh ky ni lc oo nb nc nd bi translated"><a class="ae lk" rel="noopener ugc nofollow" target="_blank" href="/micro-in-action-coda-distributed-cron-job-a2b577885b24#39d6-3ace13696421">微操作，Coda:分布式Cron作业</a></li><li id="a787" class="mv mw it kh b ki ne km nf kq ng ku nh ky ni lc oo nb nc nd bi translated"><a class="ae lk" href="https://medium.com/@dche423/micro-in-action-1be29b057f2d" rel="noopener">微在行动的索引页</a></li></ul></div></div>    
</body>
</html>