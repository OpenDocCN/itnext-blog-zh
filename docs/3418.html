<html>
<head>
<title>Generation of unique ids in the Database</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据库中唯一id的生成</h1>
<blockquote>原文：<a href="https://itnext.io/generation-unique-ids-in-the-database-a9a7acd0e721?source=collection_archive---------1-----------------------#2019-12-11">https://itnext.io/generation-unique-ids-in-the-database-a9a7acd0e721?source=collection_archive---------1-----------------------#2019-12-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d7f5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一种简单的方法使它们更具可读性和性能</h2></div><p id="ce50" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当后端向数据库发送插入新文档的请求时，可以指定标识符的值(Mongo中的_id字段),也可以将该任务委托给数据库本身。</p><p id="816b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当您不指定id时，数据库会生成如下内容:</p><ul class=""><li id="d735" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated"><strong class="kh ir"><em class="lk">5df 120015 f1d 26010 EC 56 b 01</em></strong><em class="lk">(Id取自MongoDB) </em></li></ul><p id="393e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据我的经验，您会经常在DB客户机、NodeJs日志或浏览器中查看数据库记录。所以，id不会仅仅通过查看就给你任何关于实体的信息。</p><p id="4428" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一种方法是用函数生成id，并给它们一些标准代码，使它们可以识别。</p><h2 id="b9d3" class="ll lm iq bd ln lo lp dn lq lr ls dp lt ko lu lv lw ks lx ly lz kw ma mb mc md bi translated">id一代</h2><p id="b5c7" class="pw-post-body-paragraph kf kg iq kh b ki me jr kk kl mf ju kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">那么，如果您使用以下形式的id会怎么样:</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mj"><img src="../Images/afdecad9c3b3d271526c0d3fb21f35dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*98gIf69j2mugrIRl_x7PGQ.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">id生成代码</figcaption></figure><p id="5197" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，这种方法的好处是，您知道实体<strong class="kh ir">是一个用户</strong>，它是在时间戳<strong class="kh ir"> <em class="lk"> 1575984940089 </em> </strong>创建的，相比之下<strong class="kh ir"><em class="lk">5df 120015 f1 d 26010 EC 56 b 01</em></strong>则没有这些信息。</p><p id="74af" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就“唯一性”而言，时间戳为毫秒级，随机字符串允许62个^ 6种不同的组合(56.800.235.584种组合)。</p><p id="6020" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，对于每种类型的实体，你每毫秒有560亿种选择(听起来很独特😎)</p><h2 id="78a6" class="ll lm iq bd ln lo lp dn lq lr ls dp lt ko lu lv lw ks lx ly lz kw ma mb mc md bi translated">生成id的代码</h2><p id="fac5" class="pw-post-body-paragraph kf kg iq kh b ki me jr kk kl mf ju kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">这是一个javascript实现。</p><pre class="mk ml mm mn gt mz na nb nc aw nd bi"><span id="ff4a" class="ll lm iq na b gy ne nf l ng nh"><strong class="na ir">function</strong> randomStr(strLength) {<br/> <strong class="na ir">const</strong> chars = [ …,'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789' ];<br/> <strong class="na ir">return</strong> [ …Array(strLength) ]<br/> .<strong class="na ir">map</strong>(() =&gt; chars[Math.trunc(Math.random() * chars.length)])<br/> .<strong class="na ir">join</strong>(‘’);<br/>}</span><span id="a252" class="ll lm iq na b gy ni nf l ng nh"><strong class="na ir">function</strong> uid(options = {}) {</span><span id="eb3b" class="ll lm iq na b gy ni nf l ng nh"><strong class="na ir">const</strong> now = <strong class="na ir">String</strong>(Date.now());<br/> <strong class="na ir">const</strong> middlePos = <strong class="na ir">Math</strong>.ceil(now.length / 2);<br/> <strong class="na ir">let</strong> output = `${now.substr(0, middlePos)}-${randomStr(6)}-${now.substr(middlePos)}`;</span><span id="584e" class="ll lm iq na b gy ni nf l ng nh">// We add a 3 letter CODE in front of the id to make it more recognizable<br/> <strong class="na ir">if</strong> (options.prefix) output = `${options.prefix}-${output}`;</span><span id="bfb7" class="ll lm iq na b gy ni nf l ng nh"><strong class="na ir">return</strong> output;</span><span id="9017" class="ll lm iq na b gy ni nf l ng nh">}</span></pre><p id="3fad" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要运行该代码片段:</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">在CodePen中生成UID</figcaption></figure><h2 id="926a" class="ll lm iq bd ln lo lp dn lq lr ls dp lt ko lu lv lw ks lx ly lz kw ma mb mc md bi translated">性能优势</h2><p id="f0f4" class="pw-post-body-paragraph kf kg iq kh b ki me jr kk kl mf ju kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">什么？是的，当您使用在实际插入文档之前运行的函数生成id时，您可以首先在客户机(浏览器)中运行此代码，然后将其作为参数发送到服务器。</p><p id="b560" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为在调用服务器之前就有了id，所以可以“<strong class="kh ir">乐观</strong>”:</p><ul class=""><li id="d8b3" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated">你创建id。</li><li id="2832" class="lb lc iq kh b ki nl kl nm ko nn ks no kw np la lg lh li lj bi translated">您将新实体添加到本地存储中(使用Redux、MobX或仅添加到JS对象中)。</li><li id="d3e6" class="lb lc iq kh b ki nl kl nm ko nn ks no kw np la lg lh li lj bi translated">重新渲染受新实体影响的组件。</li><li id="7878" class="lb lc iq kh b ki nl kl nm ko nn ks no kw np la lg lh li lj bi translated">然后，您将请求发送到服务器。</li><li id="de55" class="lb lc iq kh b ki nl kl nm ko nn ks no kw np la lg lh li lj bi translated">如果服务器报告了任何不一致，那么您就逆转上面的过程(但是99.9%的情况下请求应该成功，因为我们说您是“乐观的”)。</li></ul><p id="1442" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您的用户会认为这种方法就像插入是瞬间完成的一样，并且只有在您首先生成id的情况下这才是可能的(至少您使用了一些临时id，然后与服务器值一致，但是这样做有什么意义呢？)</p><p id="9232" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">希望这对你有帮助。</p><p id="1bed" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">来自智利的欢呼！！🇨🇱</p></div></div>    
</body>
</html>