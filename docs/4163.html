<html>
<head>
<title>Flutter 1.17 — no more Flavors, no more iOS Schemas. Command argument that changes everything</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Flutter 1.17 —不再有味道，不再有iOS模式。改变一切的命令参数</h1>
<blockquote>原文：<a href="https://itnext.io/flutter-1-17-no-more-flavors-no-more-ios-schemas-command-argument-that-solves-everything-8b145ed4285d?source=collection_archive---------0-----------------------#2020-05-08">https://itnext.io/flutter-1-17-no-more-flavors-no-more-ios-schemas-command-argument-that-solves-everything-8b145ed4285d?source=collection_archive---------0-----------------------#2020-05-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><blockquote class="jq jr js"><p id="7aa9" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">就在最近，Flutter 1.17发布了，它带来了很多很酷的功能。你可以在这里了解更多</p></blockquote><div class="ks kt gp gr ku kv"><a href="https://medium.com/flutter/announcing-flutter-1-17-4182d8af7f8e" rel="noopener follow" target="_blank"><div class="kw ab fo"><div class="kx ab ky cl cj kz"><h2 class="bd iu gy z fp la fr fs lb fu fw is bi translated">宣布颤振1.17</h2><div class="lc l"><h3 class="bd b gy z fp la fr fs lb fu fw dk translated">包括更快iOS性能的金属支持、新材料组件、新网络跟踪工具等！</h3></div><div class="ld l"><p class="bd b dl z fp la fr fs lb fu fw dk translated">medium.com</p></div></div><div class="le l"><div class="lf l lg lh li le lj lk kv"/></div></div></a></div><p id="8d62" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">它带来了许多性能改进、新的小部件等等。但是，除此之外，这个版本的Flutter还有一个很小但非常有用的特性:编译时变量。是的，您听到了，从1.17开始，您可以使用预定义的编译时变量构建您的Android和iOS应用程序，这些变量可用于您应用程序的所有层— Dart、iOS和Android。</p><blockquote class="jq jr js"><p id="a0e9" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated"><strong class="jw iu">更新28.05.2020 </strong>:追加<strong class="jw iu"> *相关说明。iOS段落中的xcconfig </strong>限制<strong class="jw iu"> </strong>。</p><p id="71eb" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated"><strong class="jw iu">更新05.08.2020: </strong>增加了与Flutter 1.20兼容的代码示例。更多关于Flutter 1.20的变化，你可以在这里阅读:</p></blockquote><div class="ks kt gp gr ku kv"><a href="https://medium.com/@tatsu.ukraine/what-you-should-know-before-you-upgrade-flutter-in-your-project-with-compile-time-variables-3ec3d2e9ba79" rel="noopener follow" target="_blank"><div class="kw ab fo"><div class="kx ab ky cl cj kz"><h2 class="bd iu gy z fp la fr fs lb fu fw is bi translated">Flutter 1.20:在升级使用编译时变量的项目之前，您应该知道什么</h2><div class="lc l"><h3 class="bd b gy z fp la fr fs lb fu fw dk translated">Flutter 1.20中针对原生层的编译时变量使用的突破性变化以及如何解决它们。</h3></div><div class="ld l"><p class="bd b dl z fp la fr fs lb fu fw dk translated">medium.com</p></div></div><div class="le l"><div class="lo l lg lh li le lj lk kv"/></div></div></a></div><blockquote class="jq jr js"><p id="c1e4" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated"><strong class="jw iu">更新19.05.2021 </strong>:新增兼容Flutter 2.2的代码示例。更多关于Flutter 2.2的变化，你可以在这里阅读:</p></blockquote><div class="ks kt gp gr ku kv"><a href="https://medium.com/@tatsu.ukraine/flutter-2-2-dart-defines-and-breaking-changes-here-we-go-again-ce40cfea74fd" rel="noopener follow" target="_blank"><div class="kw ab fo"><div class="kx ab ky cl cj kz"><h2 class="bd iu gy z fp la fr fs lb fu fw is bi translated">扑2.2，镖定义和突破的变化。又来了…</h2><div class="lc l"><h3 class="bd b gy z fp la fr fs lb fu fw dk translated">如何为Flutter 2.2和新的Dart定义格式准备您的项目</h3></div><div class="ld l"><p class="bd b dl z fp la fr fs lb fu fw dk translated">medium.com</p></div></div><div class="le l"><div class="lp l lg lh li le lj lk kv"/></div></div></a></div><h1 id="8bf9" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">让我们仔细看看</h1><p id="9962" class="pw-post-body-paragraph jt ju it jw b jx mo jz ka kb mp kd ke ll mq kh ki lm mr kl km ln ms kp kq kr im bi translated">如果你正在使用Flutter Web，你可能知道Flutter工具参数<code class="fe mt mu mv mw b">--dart-define</code>。主要是用来启用Skia的颤振网络像这样的<code class="fe mt mu mv mw b">--dart-define=FLUTTER_WEB_USE_SKIA=true</code>。但是您可能不知道，从1.17开始，您可以在那里传递多个自定义的键/值对。</p><p id="73f9" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">例如，如果您使用以下参数运行flutter应用程序</p><p id="5cfa" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated"><code class="fe mt mu mv mw b">flutter run --dart-define=SOME_VAR=SOME_VALUE --dart-define=OTHER_VAR=OTHER_VALUE</code></p><p id="e4c6" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">然后，您可以在Dart代码中获得这些值，如下所示</p><figure class="mx my mz na gt nb"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="2388" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">并在整个项目中使用这个类作为特定于环境的配置。</p><p id="ad5c" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">这意味着现在可以摆脱<a class="ae ne" href="https://pub.dev/packages/environment_config" rel="noopener ugc nofollow" target="_blank"><strong class="jw iu">environment _ config</strong></a><strong class="jw iu">这样的包了。</strong></p><blockquote class="jq jr js"><p id="890a" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">如果你不知道这个包是做什么的，你可以看看这篇文章</p></blockquote><div class="ks kt gp gr ku kv"><a href="https://medium.com/@tatsu.ukraine/configure-your-flutter-environment-in-the-proper-way-b81782c79726" rel="noopener follow" target="_blank"><div class="kw ab fo"><div class="kx ab ky cl cj kz"><h2 class="bd iu gy z fp la fr fs lb fu fw is bi translated">以正确的方式配置你的颤振环境</h2><div class="lc l"><h3 class="bd b gy z fp la fr fs lb fu fw dk translated">摆动多个环境配置，无需复制/粘贴、调整和暴露您的环境凭证…</h3></div><div class="ld l"><p class="bd b dl z fp la fr fs lb fu fw dk translated">medium.com</p></div></div><div class="le l"><div class="nf l lg lh li le lj lk kv"/></div></div></a></div><h1 id="5f6c" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">我能在本地使用这些变量吗？</h1><p id="e115" class="pw-post-body-paragraph jt ju it jw b jx mo jz ka kb mp kd ke ll mq kh ki lm mr kl km ln ms kp kq kr im bi translated">简而言之——是的，你也可以在本机中使用这些变量，但是……有点复杂。</p><p id="c023" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">如果你很好奇Flutter是如何将<strong class="jw iu"> Dart定义</strong>传递到原生层的，可以看看<a class="ae ne" href="https://github.com/flutter/flutter/tree/master/packages/flutter_tools" rel="noopener ugc nofollow" target="_blank"> <strong class="jw iu"> Flutter工具包</strong> </a> <strong class="jw iu">。</strong>对于每个平台，它对待Dart定义的方式略有不同，但是，我将向您展示iOS和Android版本的示例。</p><p id="0917" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">此外，请记住，在Flutter 1.20和Flutter 2.2中，Flutter Tool改变了将Dart定义的格式传递给原生层的方式。</p><p id="9006" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">为此，我创建了一个Flutter项目，它基于<strong class="jw iu"> Dart定义了</strong>变量，为Android和iOS定义了应用名称和应用后缀ID。<code class="fe mt mu mv mw b">master</code>分支兼容颤振2.2，<code class="fe mt mu mv mw b">flutter-1.19</code> —兼容颤振1.19，<code class="fe mt mu mv mw b">flutter-1.17</code> —兼容颤振1.17</p><div class="ks kt gp gr ku kv"><a href="https://github.com/TatsuUkraine/flutter_define_example" rel="noopener  ugc nofollow" target="_blank"><div class="kw ab fo"><div class="kx ab ky cl cj kz"><h2 class="bd iu gy z fp la fr fs lb fu fw is bi translated">tatsu Ukraine/flutter _ define _ example</h2><div class="lc l"><h3 class="bd b gy z fp la fr fs lb fu fw dk translated">新的颤振应用。运行并定义您定义的EXAMPLE_APP_NAME值，如果此参数不是provider，awesomeApp…</h3></div><div class="ld l"><p class="bd b dl z fp la fr fs lb fu fw dk translated">github.com</p></div></div><div class="le l"><div class="ng l lg lh li le lj lk kv"/></div></div></a></div><h1 id="59cf" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">让我们来探索这个应用程序</h1><p id="50c6" class="pw-post-body-paragraph jt ju it jw b jx mo jz ka kb mp kd ke ll mq kh ki lm mr kl km ln ms kp kq kr im bi translated">这个应用程序只使用两个编译时变量，即<code class="fe mt mu mv mw b">DEFINEEXAMPLE_APP_NAME</code> <strong class="jw iu"> </strong>和<strong class="jw iu"> </strong> <code class="fe mt mu mv mw b">DEFINEEXAMPLE_APP_SUFFIX</code> <strong class="jw iu">。</strong>我建议给每个编译时变量添加一个前缀，以避免与Flutter使用的变量冲突。在这个例子中，我使用的是<code class="fe mt mu mv mw b">DEFINEEXAMPLE_*</code> <strong class="jw iu">。</strong></p><h2 id="6dfe" class="nh lr it bd ls ni nj dn lw nk nl dp ma ll nm nn me lm no np mi ln nq nr mm ns bi translated">Dart代码</h2><p id="d13c" class="pw-post-body-paragraph jt ju it jw b jx mo jz ka kb mp kd ke ll mq kh ki lm mr kl km ln ms kp kq kr im bi translated">应用程序非常简单。如果你打开<strong class="jw iu"> main.dart </strong>你会看到它定义了<a class="ae ne" href="https://github.com/TatsuUkraine/flutter_define_example/blob/master/lib/main.dart#L4" rel="noopener ugc nofollow" target="_blank"> <strong class="jw iu"> EnvironmentConfig类</strong> </a>，<a class="ae ne" href="https://github.com/TatsuUkraine/flutter_define_example/blob/master/lib/main.dart#L93" rel="noopener ugc nofollow" target="_blank"> <strong class="jw iu">打印它的值</strong> </a>。</p><figure class="mx my mz na gt nb"><div class="bz fp l di"><div class="nc nd l"/></div></figure><figure class="mx my mz na gt nb gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/717c5d8524348a7257313c1a71680c1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*InOrKjq4z7LB0H-d9DFfxA.png"/></div></figure><p id="ab99" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">你可以注意到我使用了<code class="fe mt mu mv mw b">awesomeApp</code> <strong class="jw iu"> </strong>作为<code class="fe mt mu mv mw b">DEFINEEXAMPLE_APP_NAME</code>的默认值。我们将在所有层中使用这个默认值，包括native。至于<code class="fe mt mu mv mw b">APP_SUFFIX</code>——我们将从<a class="ae ne" href="https://pub.dev/packages/package_info" rel="noopener ugc nofollow" target="_blank"> package_info </a>插件的FutureBuilder小部件中获得一个实际的应用程序ID ( <code class="fe mt mu mv mw b">packageName</code>)。并且如果<code class="fe mt mu mv mw b">DEFINEEXAMPLE_APP_SUFFIX</code> <strong class="jw iu"> </strong>被<strong class="jw iu"> </strong>定义，你会在你的屏幕上看到应用ID。</p><blockquote class="jq jr js"><p id="7d06" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">一个重要的注意事项:确保将环境变量分配给<code class="fe mt mu mv mw b"><em class="it">const</em></code>字段。目前，如果使用非常数变量，Flutter有一个<a class="ae ne" href="https://github.com/flutter/flutter/issues/55870" rel="noopener ugc nofollow" target="_blank">问题</a>。</p></blockquote><p id="1f63" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">当您使用如下命令运行这个应用程序时</p><p id="e223" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated"><code class="fe mt mu mv mw b">flutter run --dart-define=DEFINEEXAMPLE_APP_NAME=awesomeApp1 --dart-define=DEFINEEXAMPLE_APP_SUFFIX=.dev</code></p><p id="e1d7" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">接下来您应该会看到:</p><figure class="mx my mz na gt nb gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi nv"><img src="../Images/7ddea4f4bf14514cad3b6558a97de3cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4tSWt4UNZtoDBO-PNu1Aow.png"/></div></div></figure><p id="cc03" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">您可以注意到，它呈现了从参数传递来的<code class="fe mt mu mv mw b">awesomeApp1</code> <strong class="jw iu">，</strong>，而不是默认的<code class="fe mt mu mv mw b">awesomeApp</code> <strong class="jw iu">。</strong>和<code class="fe mt mu mv mw b">com.example.defineexample.<strong class="jw iu">dev</strong></code> <strong class="jw iu">。</strong>其中<code class="fe mt mu mv mw b">.dev</code> —定义的后缀。</p><h1 id="5bd3" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">Android配置</h1><p id="0398" class="pw-post-body-paragraph jt ju it jw b jx mo jz ka kb mp kd ke ll mq kh ki lm mr kl km ln ms kp kq kr im bi translated">好的，所以要将编译时变量传递到Android中，我们需要使用Flavors</p><figure class="mx my mz na gt nb gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/10354fb51d60a10ed02b2cb583c6d681.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*ahZtDrF7f87T8tp3rkPklw.jpeg"/></div></figure><p id="99b1" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">别担心！没有味道，没有大量的iOS方案，没有多个条目，没有复制/粘贴…嗯，除了不同层的默认值。🤷🏻‍♂</p><p id="b33f" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">因此，对于Android，Flutter Tool将所有Dart定义作为单个字符串值传递，用逗号连接。在你的Gradle的Flutter 1.17中，你会得到一个类似于<code class="fe mt mu mv mw b">DEFINEEXAMPLE_APP_NAME=awesomeApp1,DEFINEEXAMPLE_APP_SUFFIX=.dev</code>的字符串值</p><p id="44e8" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">在颤振1.20值将是这样:<code class="fe mt mu mv mw b">DEFINEEXAMPLE_APP_NAME%3Dawesome1,DEFINEEXAMPLE_APP_SUFFIX%3D.dev</code></p><p id="c29d" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">在Flutter 2.2中，每个变量都用base64编码:<code class="fe mt mu mv mw b">REVGSU5FRVhBTVBMRV9BUFBfTkFNRT1hd2Vzb21lMg==,REVGSU5FRVhBTVBMRV9BUFBfU1VGRklYPS5kZXY=</code></p><p id="a6fd" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">从Flutter 1.19开始，Flutter工具在Dart定义被传递到编译器之前对URI符号进行编码，包括<code class="fe mt mu mv mw b">=</code>这就是为什么在Dart定义项中看到的不是这个符号而是<code class="fe mt mu mv mw b">%3D</code>。</p><p id="ba99" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">在Flutter 2.2中，URL编码被Base64编码所取代。</p><p id="d187" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">所以在使用每个键值对之前，我们需要解析它。完整的代码可以在这里找到<a class="ae ne" href="https://github.com/TatsuUkraine/flutter_define_example/blob/master/android/app/build.gradle" rel="noopener ugc nofollow" target="_blank"/>。用<code class="fe mt mu mv mw b">dart-defines</code>键通过项目属性中的飞镖定义。对于Flutter 1.17，解析逻辑将如下所示:</p><figure class="mx my mz na gt nb"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="6c6f" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">首先，它定义默认值(第1–4行)，然后，将一个字符串从<code class="fe mt mu mv mw b">dart-defines </code>转换成Map，并将结果与默认值合并。</p><p id="ec32" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">对于Flutter 1.20，我们将需要额外解码每个项目，以便我们可以在键值对上正确地分割它(第5行):</p><figure class="mx my mz na gt nb"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="be86" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">而在Flutter 2.2中，我们需要使用Base64解码，而不是URL解码。</p><figure class="mx my mz na gt nb"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="3360" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">现在我们可以定义<code class="fe mt mu mv mw b">resValue</code>和<code class="fe mt mu mv mw b">applicationIdSuffix</code></p><figure class="mx my mz na gt nb gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/efb45494a3c6c42d6c5eb7e8411f5572.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*7HUOuk_ciXohra28vYmt-w.png"/></div></figure><p id="4076" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">在我们定义了字符串资源之后，它可以在您的<a class="ae ne" href="https://github.com/TatsuUkraine/flutter_define_example/blob/master/android/app/src/main/AndroidManifest.xml#L10" rel="noopener ugc nofollow" target="_blank">Android/app/src/main/Android manifest . XML</a>中用于指定应用程序名称。但是基本上你可以在你的项目中的任何地方使用这组值。</p><p id="3334" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">现在，如果您在Android设备上查看您的应用程序，您会注意到应用程序名称已成功定义:</p><figure class="mx my mz na gt nb gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi oc"><img src="../Images/058efe0f56eeb53fb658527e81a41db3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*6ZwTcRBqAwrUldcgLn1Z3A.png"/></div></div></figure><p id="e6f4" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">也称为包名</p><figure class="mx my mz na gt nb gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi od"><img src="../Images/e907ba27417885540246c869d682455f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MeOIzyE6djd0iI4P_ZtlvQ.png"/></div></div></figure><h2 id="168c" class="nh lr it bd ls ni nj dn lw nk nl dp ma ll nm nn me lm no np mi ln nq nr mm ns bi translated">iOS配置</h2><p id="7471" class="pw-post-body-paragraph jt ju it jw b jx mo jz ka kb mp kd ke ll mq kh ki lm mr kl km ln ms kp kq kr im bi translated">在iOS构建过程中，Flutter Tool会创建几个文件，包括<code class="fe mt mu mv mw b">Generated.xcconfig</code>和<code class="fe mt mu mv mw b">flutter_export_environment.sh</code>。它们可以在<strong class="jw iu"> ios/Flutter </strong>中找到。那些文件默认在gitignore中，所以GitHub项目不会包含它们。但是在构建之后，你会发现<strong class="jw iu"> Dart在那些文件中定义了</strong>，对于Flutter 1.17是这样定义的:</p><pre class="mx my mz na gt oe mw of og aw oh bi"><span id="4183" class="nh lr it mw b gy oi oj l ok ol">DART_DEFINES=DEFINEEXAMPLE_APP_NAME=awesomeApp1,DEFINEEXAMPLE_APP_SUFFIX=.dev</span></pre><p id="929e" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">对于Flutter 1.20，它们将用编码值定义，就像在Gradle中一样:</p><pre class="mx my mz na gt oe mw of og aw oh bi"><span id="0fbb" class="nh lr it mw b gy oi oj l ok ol">DART_DEFINES=DEFINEEXAMPLE_APP_NAME%3Dawesome1,DEFINEEXAMPLE_APP_SUFFIX%3D.dev</span></pre><p id="7bfa" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">在Flutter 2.2中，这些值用base64编码:</p><pre class="mx my mz na gt oe mw of og aw oh bi"><span id="0a05" class="nh lr it mw b gy oi oj l ok ol">DART_DEFINES=REVGSU5FRVhBTVBMRV9BUFBfTkFNRT1hd2Vzb21lMg==,REVGSU5FRVhBTVBMRV9BUFBfU1VGRklYPS5kZXZ2</span></pre><p id="e969" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">由于这种格式不能用于plist，为了定义应用程序名称和应用程序ID后缀，我们需要定义新的变量，基于<strong class="jw iu"> Dart定义</strong>。那我们开始吧。</p><h2 id="6185" class="nh lr it bd ls ni nj dn lw nk nl dp ma ll nm nn me lm no np mi ln nq nr mm ns bi translated"><strong class="ak">关于*的重要说明。颤振1.17中的xc config</strong></h2><p id="a244" class="pw-post-body-paragraph jt ju it jw b jx mo jz ka kb mp kd ke ll mq kh ki lm mr kl km ln ms kp kq kr im bi translated">iOS <strong class="jw iu"> *。xcconfig </strong>在变量值方面有一些限制。你可以在这里或者谷歌上找到一个可能的解决方案。但基本上，它将序列<code class="fe mt mu mv mw b">//</code>视为注释分隔符。这意味着你不能像这样指定<code class="fe mt mu mv mw b">API_URL</code><code class="fe mt mu mv mw b">https://example.com</code>，因为<code class="fe mt mu mv mw b">//</code>之后的一切都将被忽略。同时，如果您使用以下参数运行您的构建:</p><pre class="mx my mz na gt oe mw of og aw oh bi"><span id="7fe6" class="nh lr it mw b gy oi oj l ok ol">--dart-define=<!-- -->https://example.com</span></pre><p id="2325" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">颤振工具将创建如下行的<code class="fe mt mu mv mw b">flutter_export_environment.sh</code>文件:</p><pre class="mx my mz na gt oe mw of og aw oh bi"><span id="771a" class="nh lr it mw b gy oi oj l ok ol">...<br/>export "DART_DEFINES=APP_URL=https://<!-- -->example.com<!-- -->"</span></pre><p id="90fd" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">也作<code class="fe mt mu mv mw b">Generated.xcconfig</code>用如下:</p><pre class="mx my mz na gt oe mw of og aw oh bi"><span id="0173" class="nh lr it mw b gy oi oj l ok ol">...<br/>DART_DEFINES=APP_URL=https://<!-- -->example.com</span></pre><p id="5ef3" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">因此，在您的构建<strong class="jw iu">预动作</strong>(您将在下一段中读到它)中，您可以尝试找出一种变通方法，如何获得<code class="fe mt mu mv mw b">DART_DEFINES</code>的实际值，以提供对<code class="fe mt mu mv mw b">API_URL</code>的正确解析。</p><p id="c822" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">对于<strong class="jw iu"> Flutter 1.20和2.2 </strong>，情况将是相似的，因为我们将在解析之前解码值，但是因为Dart定义项将被编码(包括<code class="fe mt mu mv mw b">//</code>)，所以将更容易找出一个解决方法来解析这些项。因为，与Flutter 1.17不同，您将实际接收您的Dart定义值，所以您不需要考虑如何获得这个值来进行解析。</p></div><div class="ab cl om on hx oo" role="separator"><span class="op bw bk oq or os"/><span class="op bw bk oq or os"/><span class="op bw bk oq or"/></div><div class="im in io ip iq"><h2 id="c188" class="nh lr it bd ls ni nj dn lw nk nl dp ma ll nm nn me lm no np mi ln nq nr mm ns bi translated">1.使用默认值创建<a class="ae ne" href="https://github.com/TatsuUkraine/flutter_define_example/blob/master/ios/Flutter/Defineexample-defaults.xcconfig" rel="noopener ugc nofollow" target="_blank">define example-defaults . xcconfig</a>文件:</h2><pre class="mx my mz na gt oe mw of og aw oh bi"><span id="226f" class="nh lr it mw b gy oi oj l ok ol">DEFINEEXAMPLE_APP_NAME=awesomeApp<br/>DEFINEEXAMPLE_APP_SUFFIX=</span></pre><h2 id="f783" class="nh lr it bd ls ni nj dn lw nk nl dp ma ll nm nn me lm no np mi ln nq nr mm ns bi translated">2.在<a class="ae ne" href="https://github.com/TatsuUkraine/flutter_define_example/blob/master/ios/Flutter/Debug.xcconfig" rel="noopener ugc nofollow" target="_blank">调试</a>和<a class="ae ne" href="https://github.com/TatsuUkraine/flutter_define_example/blob/master/ios/Flutter/Release.xcconfig" rel="noopener ugc nofollow" target="_blank">发布</a>配置中导入</h2><p id="75ec" class="pw-post-body-paragraph jt ju it jw b jx mo jz ka kb mp kd ke ll mq kh ki lm mr kl km ln ms kp kq kr im bi translated">此外，让我们导入我们稍后将创建的配置文件:</p><figure class="mx my mz na gt nb"><div class="bz fp l di"><div class="nc nd l"/></div><figcaption class="ot ou gj gh gi ov ow bd b be z dk translated">Debug.xcconfig和Release.xcconfig(基本相同)</figcaption></figure><p id="ab86" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">考虑将<code class="fe mt mu mv mw b">Defineexample.xcconfig</code> <strong class="jw iu"> </strong>放在<code class="fe mt mu mv mw b">Defineexample-defaults.xcconfig</code> <strong class="jw iu">、</strong>之后，这样颤振运行命令的值可以覆盖默认值。</p><h2 id="4cce" class="nh lr it bd ls ni nj dn lw nk nl dp ma ll nm nn me lm no np mi ln nq nr mm ns bi translated">3.编辑plist文件，从<code class="fe mt mu mv mw b">DEFINEEXAMPLE_APP_NAME </code>定义包名，从<code class="fe mt mu mv mw b">DEFINEEXAMPLE_APP_SUFFIX</code>定义后缀</h2><figure class="mx my mz na gt nb gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi ox"><img src="../Images/a72b5e3bb1fab2bed578a430a6c6329c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kQoFW9SEdfipBA2RKHiW6Q.png"/></div></div></figure><p id="2033" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">现在是时候创建<strong class="jw iu"> Defineexample.xcconfig了。</strong>要创建它，我们需要在iOS版本中添加预构建动作。</p><h2 id="a478" class="nh lr it bd ls ni nj dn lw nk nl dp ma ll nm nn me lm no np mi ln nq nr mm ns bi translated">4.编辑架构:</h2><figure class="mx my mz na gt nb gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/5e7ec1112e88f2c3bc10722d4ebe23d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*Fxf3DzlzxJJpRSNAMYIxoA.png"/></div></figure><h2 id="1379" class="nh lr it bd ls ni nj dn lw nk nl dp ma ll nm nn me lm no np mi ln nq nr mm ns bi translated">5.添加预先操作:</h2><figure class="mx my mz na gt nb gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi oz"><img src="../Images/49bf22d67686753c829f60fa81b0e8a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j5I-UylOGk0zLatP3i2txw.png"/></div></div></figure><p id="534f" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">如果您使用Flutter 1.17，请使用以下命令:</p><pre class="mx my mz na gt oe mw of og aw oh bi"><span id="8026" class="nh lr it mw b gy oi oj l ok ol">echo "$DART_DEFINES" | tr ',' '\n' &gt; ${SRCROOT}/Flutter/Defineexample.xcconfig</span></pre><p id="0b3e" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">如果您使用Flutter 1.20，则使用以下命令:</p><figure class="mx my mz na gt nb"><div class="bz fp l di"><div class="nc nd l"/></div></figure><blockquote class="jq jr js"><p id="c19e" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">为什么需要这个bash脚本的解释可以在本文的<a class="ae ne" href="https://medium.com/@tatsu.ukraine/what-you-should-know-before-you-upgrade-flutter-in-your-project-with-compile-time-variables-3ec3d2e9ba79" rel="noopener">中找到。</a></p></blockquote><p id="8780" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">而对于Flutter 2.2，你需要使用base64解码而不是URL解码(第3行):</p><figure class="mx my mz na gt nb"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="185f" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">在构建期间，该命令将创建以下<strong class="jw iu"> Defineexample.xcconfig </strong>文件:</p><pre class="mx my mz na gt oe mw of og aw oh bi"><span id="3689" class="nh lr it mw b gy oi oj l ok ol">DEFINEEXAMPLE_APP_NAME=awesomeApp1<br/>DEFINEEXAMPLE_APP_SUFFIX=.dev</span></pre><blockquote class="jq jr js"><p id="3431" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">你可以选择不同的<strong class="jw iu"> *。xcconfig </strong>文件名，如果你想的话。只要确保它们不会被Flutter工具脚本修改。</p><p id="4441" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">此外，请记住<strong class="jw iu"> *的限制。xcconfig </strong>如果你需要在解析过程中考虑<code class="fe mt mu mv mw b">//</code>。</p></blockquote><p id="f032" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">当应用程序将安装到您的设备上时，您会注意到它有一个名称，我们在构建过程中定义了该名称:</p><figure class="mx my mz na gt nb gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/d4bd7586e3e2e4ffdef3dd51db5afbfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/1*-Qjqcw8Y5MtaqQKNQZlkew.png"/></div></figure><p id="635d" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">也称为包名:</p><figure class="mx my mz na gt nb gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi od"><img src="../Images/13053ccea6dbeceef500b440dd47a22e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k6YoIhcXdoPOpDsjkwbVgA.png"/></div></div></figure><p id="0886" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">与Android一样，现在您可以在项目中的任何地方使用这组值。</p><p id="1ccf" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">差不多就是这样)示例项目可以在这里找到:</p><div class="ks kt gp gr ku kv"><a href="https://github.com/TatsuUkraine/flutter_define_example" rel="noopener  ugc nofollow" target="_blank"><div class="kw ab fo"><div class="kx ab ky cl cj kz"><h2 class="bd iu gy z fp la fr fs lb fu fw is bi translated">tatsu Ukraine/flutter _ define _ example</h2><div class="lc l"><h3 class="bd b gy z fp la fr fs lb fu fw dk translated">新的颤振应用。运行并定义您定义的EXAMPLE_APP_NAME值，如果此参数不是provider，awesomeApp…</h3></div><div class="ld l"><p class="bd b dl z fp la fr fs lb fu fw dk translated">github.com</p></div></div><div class="le l"><div class="ng l lg lh li le lj lk kv"/></div></div></a></div><p id="116e" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated"><code class="fe mt mu mv mw b">master</code>分支中的示例针对颤振2.2，<code class="fe mt mu mv mw b">flutter-1.19</code> —针对颤振1.19，<code class="fe mt mu mv mw b">flutter-1.17</code> —针对颤振1.17。</p><p id="155a" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ll kg kh ki lm kk kl km ln ko kp kq kr im bi translated">感谢您的时间和快乐的编码！</p></div></div>    
</body>
</html>