<html>
<head>
<title>Build your own Kubernetes cluster with 6 Pine64s for less than 400€</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用6个Pine64s构建您自己的Kubernetes集群，价格不到400€</h1>
<blockquote>原文：<a href="https://itnext.io/create-a-kubernetes-cluster-with-pine64-428fc62d72e7?source=collection_archive---------4-----------------------#2018-04-05">https://itnext.io/create-a-kubernetes-cluster-with-pine64-428fc62d72e7?source=collection_archive---------4-----------------------#2018-04-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/dfa432a316e4855987a3a34d07078038.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w9yUZZtjHor0p2onl_sXsA.png"/></div></div></figure><h1 id="5ab6" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">摘要</h1><p id="d5fa" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">当你可以只使用<code class="fe lu lv lw lx b">Google Cloud</code>、<code class="fe lu lv lw lx b">Amazon Web Services</code>或<code class="fe lu lv lw lx b">Microsoft Azure</code>时，为什么有人要用六个Pine64建造一个<code class="fe lu lv lw lx b">Kubernetes (k8s) cluster</code>？</p><p id="4b90" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">当然，答案不是我想创建一个集群作为生产集群使用。更好的想法是创建一个相对便宜的集群来使用k8s，并观察如果集群中的一个节点出现故障，k8s会如何表现。我还想看看这个集群的性能如何。</p><p id="b91d" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">但是说实话，我建造它是因为我想这样做:)</p><p id="e676" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">在本文中，我将向您展示，为什么我选择了Pine64作为计算引擎，我如何一步一步地构建它，以及我所面临的挑战。</p><h1 id="1c17" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">购物单</h1><h2 id="20af" class="md jz iq bd ka me mf dn ke mg mh dp ki lh mi mj km ll mk ml kq lp mm mn ku mo bi translated">计算引擎</h2><p id="9095" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">首先，是的，当然，我们需要一个计算引擎。</p><p id="3051" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">当我在寻找一个合适的计算引擎时，我一直在寻找一个便宜的计算引擎，它有很多64位内核，有很多RAM，快速的网络连接，不消耗太多能源，而且很小。是的，这是不存在的，但我能找到的最好的交易是一个<code class="fe lu lv lw lx b">Pine64</code>。</p><p id="4cc6" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><code class="fe lu lv lw lx b">Pine64</code>和一个<code class="fe lu lv lw lx b">Allwinner A64</code>一起运行，后者有一个<code class="fe lu lv lw lx b">1.152 GHz 64-bit quad-core ARM Cortex-A53</code>和<code class="fe lu lv lw lx b">2GB DDR3 Memory</code>，一个<code class="fe lu lv lw lx b">1000Mbps Ethernet Port</code>和一个<code class="fe lu lv lw lx b">133mm x 80mm x 19mm</code>大小，消耗<code class="fe lu lv lw lx b">2.5 Watt</code>，所有这些都是为了<code class="fe lu lv lw lx b">29$</code>。Pine64没有内置Wi-Fi模块。如果你需要Wi-Fi，你必须花10美元购买Wi-Fi 802.11 BGN/蓝牙4.0模块。但我不需要这个。所以，听起来对我来说很公平。</p><p id="f66e" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">另一个候选人是RaspberryPI 3。最大的缺点是，“只有”1GB内存(Pine64有2GB)，“只有”100Mbps以太网端口(Pine64有1000Mbps)，Raspbian只能在32位上运行。</p><p id="7e38" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">海运是从中国来的，所以需要几个星期才能送到德国，我还得支付一些海关费用，但还是可以的。</p><h2 id="a175" class="md jz iq bd ka me mf dn ke mg mh dp ki lh mi mj km ll mk ml kq lp mm mn ku mo bi translated">其他东西</h2><p id="780e" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">当然，购物清单不止于此。您还必须购买一个<code class="fe lu lv lw lx b">Switch</code>、一个<code class="fe lu lv lw lx b">USB Power Supply with min 2A per Pine64</code>和一个<code class="fe lu lv lw lx b">SD Card</code>、<code class="fe lu lv lw lx b">Micro B USB cable</code>、一个<code class="fe lu lv lw lx b">CAT.7 Ethernet Cable</code>和<code class="fe lu lv lw lx b">30mm M3 Spacer</code>来将所有的Pine64堆叠在一起。我觉得如果想省点空间的话25mm应该也可以。</p><p id="4d9d" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">我在亚马逊上买了所有东西，还从康拉德那里买了垫片。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/4804c8f849c15318dd9bb32b17a41cd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wyr0EcCNpo2Fl8myPTcfkg.png"/></div></div></figure><h1 id="46b3" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">互相支持</h1><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/3cb4fdcfe7bb7b0c06a63e4b1a70f221.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AV1yg18OSuVwsbsjJJM97A.jpeg"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">我觉得一张图描述了1000多个字；)</figcaption></figure><h1 id="053e" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">安装Kubernetes</h1><p id="0e2c" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">安装k8s集群有几个步骤。一个计算引擎将作为<code class="fe lu lv lw lx b">Kubernetes Master</code>运行，其他的将作为<code class="fe lu lv lw lx b">Kubernetes Nodes</code>运行，实际的容器将在这里运行。</p><p id="b110" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">我决定使用一个带有GUI的主操作系统，这样我们可以插入一个监视器，让Kubernetes Dashboard运行。如果你不需要这个，你可以跳过步骤“下载主”。</p><ol class=""><li id="e634" class="mz na iq ky b kz ly ld lz lh nb ll nc lp nd lt ne nf ng nh bi translated"><code class="fe lu lv lw lx b">Download</code> <code class="fe lu lv lw lx b">OS</code>为库伯内特<code class="fe lu lv lw lx b">Master</code>和<code class="fe lu lv lw lx b">Nodes</code></li><li id="c51c" class="mz na iq ky b kz ni ld nj lh nk ll nl lp nm lt ne nf ng nh bi translated"><code class="fe lu lv lw lx b">Install</code>上的<code class="fe lu lv lw lx b">OS</code>和<code class="fe lu lv lw lx b">Master</code>上的<code class="fe lu lv lw lx b">each Node</code></li><li id="82ac" class="mz na iq ky b kz ni ld nj lh nk ll nl lp nm lt ne nf ng nh bi translated"><code class="fe lu lv lw lx b">Install</code>使用<code class="fe lu lv lw lx b">kubeadm</code>打开<code class="fe lu lv lw lx b">Master</code>和<code class="fe lu lv lw lx b">Nodes</code></li><li id="fd07" class="mz na iq ky b kz ni ld nj lh nk ll nl lp nm lt ne nf ng nh bi translated">检查安装</li></ol><h2 id="69ff" class="md jz iq bd ka me mf dn ke mg mh dp ki lh mi mj km ll mk ml kq lp mm mn ku mo bi translated">步骤1:为Kubernetes下载操作系统</h2><blockquote class="nn no np"><p id="43c8" class="kw kx nq ky b kz ly lb lc ld lz lf lg nr ma lj lk ns mb ln lo nt mc lr ls lt ij bi translated"><em class="iq">下载脚本可以在这里找到:</em><a class="ae nu" href="https://github.com/rilleralle/k8s/blob/master/1-k8s-download.sh" rel="noopener ugc nofollow" target="_blank"><em class="iq">https://github . com/rillerale/k8s/blob/master/1-k8s-Download . sh</em></a></p></blockquote><p id="4211" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><strong class="ky ir">主人——徐本图的异性伴侣</strong></p><p id="1b6d" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">去<a class="ae nu" href="http://wiki.pine64.org/index.php/Pine_A64_Software_Release#Ubuntu_Desktop_Image_.5B20161215.5D_built_by_Pine64" rel="noopener ugc nofollow" target="_blank">http://wiki.pine64.org/index.php/Pine_A64_Software_Release</a>T14】下载<code class="fe lu lv lw lx b">DD image (for 8GB micoSD card and above)</code>T29】直接从pine64.org下载。如果此链接不起作用，请访问Pine64网站。</p><p id="0cab" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><strong class="ky ir">节点— Xenial基础映像</strong></p><p id="9304" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">前往<a class="ae nu" href="http://wiki.pine64.org/index.php/Pine_A64_Software_Release#Xenial_Base_Image_.5B20161218-1.5D_by_longsleep" rel="noopener ugc nofollow" target="_blank">http://wiki.pine64.org/index.php/Pine_A64_Software_Release</a>T16】下载<code class="fe lu lv lw lx b">DD image (for 8GB micoSD card and above)</code>T35】直接从pine64.org下载。<code class="fe lu lv lw lx b">Please extract the compressed file</code>。如果此链接不起作用，请访问Pine64网站。</p><h2 id="8360" class="md jz iq bd ka me mf dn ke mg mh dp ki lh mi mj km ll mk ml kq lp mm mn ku mo bi translated">步骤2:使用Mac在主节点和节点上安装操作系统</h2><p id="809a" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我不想在如何使用Mac在SD卡上安装映像的手册上获得任何学分。我刚复制了树莓派的声明。他们写了一个很棒的指南！可以在这里找到:<br/><a class="ae nu" href="https://www.raspberrypi.org/documentation/installation/installing-images/mac.md" rel="noopener ugc nofollow" target="_blank">https://www . raspberrypi . org/documentation/installation/installing-images/MAC . MD</a>。您还可以找到Linux或Windows的操作指南。</p><blockquote class="nn no np"><p id="efca" class="kw kx nq ky b kz ly lb lc ld lz lf lg nr ma lj lk ns mb ln lo nt mc lr ls lt ij bi translated"><em class="iq">请小心使用</em> <code class="fe lu lv lw lx b"><em class="iq">dd</em></code> <em class="iq">工具。如果你选择了错误的磁盘，你可以破坏你的操作系统！</em></p></blockquote><p id="0ea6" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">打开所有SD卡的包装，插入计算机，在一个SD上安装带GUI的操作系统，在其他SD上安装无头版本。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/c5bdbd7581fdd91ed75258ab73430183.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*AeL-cdaBOTK4Ez5YQzlpHQ.png"/></div></figure><blockquote class="nn no np"><p id="af18" class="kw kx nq ky b kz ly lb lc ld lz lf lg nr ma lj lk ns mb ln lo nt mc lr ls lt ij bi translated"><em class="iq"> Snippets文件可以在这里找到:</em><a class="ae nu" href="https://github.com/rilleralle/k8s/blob/master/2-k8s-writeSD.txt" rel="noopener ugc nofollow" target="_blank"><em class="iq">https://github . com/rileralle/k8s/blob/master/2-k8s-writesd . txt</em></a></p></blockquote><p id="70d1" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">我的SD卡位于<strong class="ky ir"> disk2 </strong>下</p><pre class="mq mr ms mt gt nw lx nx ny aw nz bi"><span id="730c" class="md jz iq lx b gy oa ob l oc od">$ diskutil list</span><span id="7e3c" class="md jz iq lx b gy oe ob l oc od">/dev/disk2 (internal, physical):<br/>#:TYPE NAME                 SIZE        IDENTIFIER<br/>0:FDisk_partition_scheme    *31.9 GB    disk2  <br/>1:Windows_FAT_32 BOOT       52.4 MB     disk2s1  <br/>2:Linux                     31.8 GB     disk2s2</span><span id="6f63" class="md jz iq lx b gy oe ob l oc od">$ diskutil unmountDisk /dev/disk2</span><span id="5d53" class="md jz iq lx b gy oe ob l oc od">Unmount of all volumes on disk2 was successful</span><span id="e08d" class="md jz iq lx b gy oe ob l oc od">$ sudo dd bs=1m if=xubuntu-xenial-mate-20161215-longsleep-pine64-8GB.img of=/dev/rdisk2</span><span id="0e3d" class="md jz iq lx b gy oe ob l oc od">Password:  <br/>#Grab a coffee! It will take some time. I had to wait for 5 minutes.</span><span id="0912" class="md jz iq lx b gy oe ob l oc od">7392+0 records in  <br/>7392+0 records out  <br/>7751073792 bytes transferred in 290.547506 secs (26677475 bytes/sec)</span><span id="6cf3" class="md jz iq lx b gy oe ob l oc od">$ sudo diskutil eject /dev/rdisk2</span><span id="2d38" class="md jz iq lx b gy oe ob l oc od">Password:  <br/>Disk /dev/rdisk2 ejected</span></pre><p id="a217" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">瞧，那是主人的SD卡。请对其他SD卡重复上述操作，并使用正确的图像<code class="fe lu lv lw lx b">xenial-pine64-bspkernel-20161218-1.img</code>。</p><p id="83cf" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><strong class="ky ir">配置</strong></p><p id="6783" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">这两个映像的凭据是</p><ul class=""><li id="a3e6" class="mz na iq ky b kz ly ld lz lh nb ll nc lp nd lt of nf ng nh bi translated">用户名:ubuntu</li><li id="239c" class="mz na iq ky b kz ni ld nj lh nk ll nl lp nm lt of nf ng nh bi translated">密码:ubuntu</li></ul><p id="a903" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><strong class="ky ir">设置网络</strong></p><p id="b693" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><strong class="ky ir">更改主机名</strong></p><pre class="mq mr ms mt gt nw lx nx ny aw nz bi"><span id="2197" class="md jz iq lx b gy oa ob l oc od">$hostnamectl set-hostname 'new-hostname'</span></pre><p id="43a9" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">要有创意！</p><p id="77f6" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><strong class="ky ir">设置静态ip地址</strong></p><p id="de92" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">Kubernetes需要主节点和节点的静态ip地址，因为如果ip地址在安装后改变，集群将无法工作。</p><p id="4e83" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">您可以将静态ip地址绑定到接口。所有pines都通过交换机上的以太网连接，因此不需要网关。</p><p id="931d" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">在<code class="fe lu lv lw lx b">/etc/network/interfaces</code>中增加以下几行:</p><pre class="mq mr ms mt gt nw lx nx ny aw nz bi"><span id="edd0" class="md jz iq lx b gy oa ob l oc od">$sudo vi /etc/network/interfaces</span><span id="e1db" class="md jz iq lx b gy oe ob l oc od">auto eth0:0  <br/>allow-hotplug eth0:0  <br/>iface eth0:0 inet static  <br/>    address 192.168.11.1<br/>    netmask 255.255.255.0</span></pre><p id="7d82" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">你可以选择任何地址。我决定对主节点使用192.168.11.1，对节点使用192 . 168 . 11 . 2–6。</p><p id="4add" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><strong class="ky ir">禁用网络管理器</strong></p><p id="e7a1" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">NetworkManager安装在Ubuntu Mate映像上，这可能会导致静态ip地址出现问题。禁用网络管理器。</p><pre class="mq mr ms mt gt nw lx nx ny aw nz bi"><span id="34e4" class="md jz iq lx b gy oa ob l oc od">$ sudo systemctl stop NetworkManager.service<br/>$ sudo systemctl disable NetworkManager.service</span></pre><p id="70a5" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">检查是否可以从主服务器ping节点。</p><p id="82be" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><strong class="ky ir">禁用节点上的交换</strong></p><p id="0b66" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">如果启用了swap，则无法执行kubeadm join。<br/>在操作系统启动时禁用交换。将下面一行添加到/etc/rc.local中的exit 0行之前。</p><pre class="mq mr ms mt gt nw lx nx ny aw nz bi"><span id="2473" class="md jz iq lx b gy oa ob l oc od">$sudo vi /etc/rc.local<br/>....<br/>swapoff -a</span><span id="3b8a" class="md jz iq lx b gy oe ob l oc od">exit 0</span></pre><p id="9fbf" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">重新启动服务器。</p><h2 id="e6dd" class="md jz iq bd ka me mf dn ke mg mh dp ki lh mi mj km ll mk ml kq lp mm mn ku mo bi translated">步骤3:在每个Pine上安装Kubernetes 64</h2><p id="3b27" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">Kubernetes的人写了一个很棒的分步手册，教你如何用kubeadm安装Kubernetes。如果你遵循我的教程，你需要做的就是执行下面的命令。如果有问题，请查看网站。k8s发展这么快。<a class="ae nu" href="https://kubernetes.io/docs/setup/independent/install-kubeadm/" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/docs/setup/independent/install-kube ADM/</a></p><blockquote class="nn no np"><p id="7952" class="kw kx nq ky b kz ly lb lc ld lz lf lg nr ma lj lk ns mb ln lo nt mc lr ls lt ij bi translated"><em class="iq">请注意，以下命令来自0。— 3.需要在</em> <code class="fe lu lv lw lx b"><em class="iq">master</em></code> <em class="iq">和</em> <code class="fe lu lv lw lx b"><em class="iq">every node</em></code> <em class="iq">上执行。</em></p><p id="56d6" class="kw kx nq ky b kz ly lb lc ld lz lf lg nr ma lj lk ns mb ln lo nt mc lr ls lt ij bi translated">请从主节点开始，因为我们需要在主节点上安装一个pod网络，然后才能加入其他节点！</p><p id="7be2" class="kw kx nq ky b kz ly lb lc ld lz lf lg nr ma lj lk ns mb ln lo nt mc lr ls lt ij bi translated"><em class="iq">安装脚本可以在这里找到:</em><a class="ae nu" href="https://github.com/rilleralle/k8s/blob/master/3-k8s-install.sh" rel="noopener ugc nofollow" target="_blank"><em class="iq">https://github . com/rillerale/k8s/blob/master/3-k8s-install . sh</em></a></p></blockquote><p id="10db" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><strong class="ky ir"> 0。SSH到机器或插件键盘和显示器:</strong></p><p id="e120" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><strong class="ky ir"> 1。成为root: </strong></p><pre class="mq mr ms mt gt nw lx nx ny aw nz bi"><span id="023f" class="md jz iq lx b gy oa ob l oc od">sudo su -</span></pre><p id="6a9e" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><strong class="ky ir"> 2。安装docker: </strong></p><pre class="mq mr ms mt gt nw lx nx ny aw nz bi"><span id="7a96" class="md jz iq lx b gy oa ob l oc od">apt-get update  <br/>apt-get install -y docker.io</span></pre><p id="7d47" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><strong class="ky ir"> 3。安装kubelet、kubeadm、kubectl和kubernetes-cni: </strong></p><pre class="mq mr ms mt gt nw lx nx ny aw nz bi"><span id="8849" class="md jz iq lx b gy oa ob l oc od">apt-get update &amp;&amp; apt-get install -y apt-transport-https  <br/>curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -  <br/>cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list  <br/>deb http://apt.kubernetes.io/ kubernetes-xenial main  <br/>EOF  <br/>apt-get update  <br/>apt-get install -y kubelet kubeadm kubectl</span></pre><blockquote class="nn no np"><p id="6382" class="kw kx nq ky b kz ly lb lc ld lz lf lg nr ma lj lk ns mb ln lo nt mc lr ls lt ij bi translated"><em class="iq">请注意，上述命令必须在</em> <code class="fe lu lv lw lx b"><em class="iq">master</em></code> <em class="iq">和</em> <code class="fe lu lv lw lx b"><em class="iq">every node</em></code> <em class="iq">上执行。</em></p><p id="7e10" class="kw kx nq ky b kz ly lb lc ld lz lf lg nr ma lj lk ns mb ln lo nt mc lr ls lt ij bi translated"><em class="iq">用</em> <code class="fe lu lv lw lx b"><em class="iq">a)</em></code> <em class="iq">表示的下一步需要在</em> <code class="fe lu lv lw lx b"><em class="iq">master</em></code> <em class="iq">上执行。</em></p><p id="327e" class="kw kx nq ky b kz ly lb lc ld lz lf lg nr ma lj lk ns mb ln lo nt mc lr ls lt ij bi translated"><em class="iq">其他步骤同</em> <code class="fe lu lv lw lx b"><em class="iq">b)</em></code> <em class="iq">需要在</em> <code class="fe lu lv lw lx b"><em class="iq">nodes</em></code> <em class="iq">上执行。</em></p></blockquote><p id="ea03" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><strong class="ky ir">如果你在主控</strong></p><p id="d46a" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><code class="fe lu lv lw lx b"><strong class="ky ir">4a)</strong></code> <strong class="ky ir">。运行kubeadm init命令:</strong>如果一切正常，您会发现一条成功消息<code class="fe lu lv lw lx b">Your Kubernetes master has initialized successfully!</code>和3条其他指令。我将在接下来的章节中描述<code class="fe lu lv lw lx b">Start your cluster</code>、<code class="fe lu lv lw lx b">Deploy pod network</code>和<code class="fe lu lv lw lx b">Join nodes</code>。</p><pre class="mq mr ms mt gt nw lx nx ny aw nz bi"><span id="0b0b" class="md jz iq lx b gy oa ob l oc od">sudo kubeadm init --pod-network-cidr=10.244.0.0/16</span></pre><p id="1bfe" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">输出如下所示:</p><pre class="mq mr ms mt gt nw lx nx ny aw nz bi"><span id="ba56" class="md jz iq lx b gy oa ob l oc od">Your Kubernetes master has initialized successfully!</span><span id="aef1" class="md jz iq lx b gy oe ob l oc od">To start using your cluster, you need to run (as a regular user):</span><span id="3448" class="md jz iq lx b gy oe ob l oc od">  mkdir -p $HOME/.kube<br/>  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config<br/>  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><span id="ee07" class="md jz iq lx b gy oe ob l oc od">You should now deploy a pod network to the cluster.  <br/>Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:  <br/>  http://kubernetes.io/docs/admin/addons/</span><span id="23ec" class="md jz iq lx b gy oe ob l oc od">You can now join any number of machines by running the following on each node  <br/>as root:</span><span id="f1c1" class="md jz iq lx b gy oe ob l oc od">  kubeadm join --token &lt;token&gt; &lt;master-ip&gt;:&lt;master-port&gt; --discovery-token-ca-cert-hash sha256:&lt;hash&gt;</span></pre><p id="22e2" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><code class="fe lu lv lw lx b"><strong class="ky ir">5a)</strong></code>T60。写下令牌</p><p id="7a86" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">Kubeadm将打印出需要在节点上执行的命令。该命令将如下所示:</p><pre class="mq mr ms mt gt nw lx nx ny aw nz bi"><span id="688c" class="md jz iq lx b gy oa ob l oc od">kubeadm join --token &lt;token&gt; &lt;master-ip&gt;:&lt;master-port&gt;</span></pre><p id="8365" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><code class="fe lu lv lw lx b"><strong class="ky ir">6a)</strong></code>T8。切换到普通用户:</p><pre class="mq mr ms mt gt nw lx nx ny aw nz bi"><span id="bdf7" class="md jz iq lx b gy oa ob l oc od">exit</span></pre><p id="da92" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><code class="fe lu lv lw lx b"><strong class="ky ir">7a)</strong></code> <strong class="ky ir">。将Kubernetes配置复制到主文件夹，这样您就可以在没有参数- kubeconfig: </strong>的情况下使用 <code class="fe lu lv lw lx b"><strong class="ky ir">kubectl</strong></code> <strong class="ky ir"/></p><pre class="mq mr ms mt gt nw lx nx ny aw nz bi"><span id="cade" class="md jz iq lx b gy oa ob l oc od">mkdir -p $HOME/.kube  <br/>sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config  <br/>sudo chown $(id -u):$(id -g) $HOME/.kube/config</span></pre><p id="a8e0" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><code class="fe lu lv lw lx b"><strong class="ky ir">8a)</strong></code> <strong class="ky ir">。部署pod网络:</strong></p><blockquote class="nn no np"><p id="2a1c" class="kw kx nq ky b kz ly lb lc ld lz lf lg nr ma lj lk ns mb ln lo nt mc lr ls lt ij bi translated"><em class="iq">给ARM64装个pod网络很重要！因此，这条语句下载了法兰绒网络，用arm64替换了“正常的”amd64，并创建了pod。</em></p><p id="29f1" class="kw kx nq ky b kz ly lb lc ld lz lf lg nr ma lj lk ns mb ln lo nt mc lr ls lt ij bi translated"><em class="iq"> VXLAN不在Pine64上工作。所以用udp交换vxlan。</em></p></blockquote><pre class="mq mr ms mt gt nw lx nx ny aw nz bi"><span id="b51c" class="md jz iq lx b gy oa ob l oc od">curl -sSL "https://github.com/coreos/flannel/blob/master/Documentation/kube-flannel.yml?raw=true" | sed "s/amd64/arm64/g" | sed "s/vxlan/udp/g" | kubectl create -f -</span></pre><p id="3adc" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><code class="fe lu lv lw lx b"><strong class="ky ir">9a)</strong></code> <strong class="ky ir">。检查安装:</strong></p><p id="3937" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">输入以下命令查看正在运行的窗格:</p><pre class="mq mr ms mt gt nw lx nx ny aw nz bi"><span id="f0f7" class="md jz iq lx b gy oa ob l oc od">sudo kubectl get pods --all-namespaces</span></pre><p id="5d88" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">Kubernetes Dashboard应该默认安装。如果没有，您可以使用以下命令安装它:</p><pre class="mq mr ms mt gt nw lx nx ny aw nz bi"><span id="4121" class="md jz iq lx b gy oa ob l oc od">curl -sSl "https://raw.githubusercontent.com/kubernetes/dashboard/master/src/deploy/recommended/kubernetes-dashboard-arm.yaml" | kubectl create -f -</span></pre><p id="5f24" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><strong class="ky ir">如果你在一个节点上</strong></p><p id="2829" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><code class="fe lu lv lw lx b"><strong class="ky ir">4b)</strong></code> <strong class="ky ir">。成为root: </strong></p><pre class="mq mr ms mt gt nw lx nx ny aw nz bi"><span id="21b9" class="md jz iq lx b gy oa ob l oc od">sudo su -</span></pre><p id="38a9" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated"><code class="fe lu lv lw lx b"><strong class="ky ir">5b)</strong></code> <strong class="ky ir">。将节点加入到客户:</strong></p><p id="0df8" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">执行完<code class="fe lu lv lw lx b">kubeadm init</code>命令后，现在该执行在主机上打印出来的命令了。</p><pre class="mq mr ms mt gt nw lx nx ny aw nz bi"><span id="ef56" class="md jz iq lx b gy oa ob l oc od">kubeadm join --token &lt;token&gt; &lt;master-ip&gt;:&lt;master-port&gt;</span></pre><h2 id="b999" class="md jz iq bd ka me mf dn ke mg mh dp ki lh mi mj km ll mk ml kq lp mm mn ku mo bi translated">步骤4:检查安装</h2><p id="d931" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated"><strong class="ky ir"> SSH to master: </strong>输入以下命令查看正在运行的pod:</p><pre class="mq mr ms mt gt nw lx nx ny aw nz bi"><span id="0d8f" class="md jz iq lx b gy oa ob l oc od">kubectl get nodes</span></pre><p id="160d" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">现在，您应该可以看到所有节点。</p><p id="0dc2" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt ij bi translated">恭喜您，现在您可以自豪地称自己为Kubernetes集群的所有者了！那不是很容易吗？！</p></div></div>    
</body>
</html>