<html>
<head>
<title>ASP.NET Core 3: React Template with Auth</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ASP.NET核心3:使用授权对模板做出反应</h1>
<blockquote>原文：<a href="https://itnext.io/asp-net-core-3-react-template-with-auth-9e0ad49586e5?source=collection_archive---------4-----------------------#2019-03-24">https://itnext.io/asp-net-core-3-react-template-with-auth-9e0ad49586e5?source=collection_archive---------4-----------------------#2019-03-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0cba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://devblogs.microsoft.com/aspnet/asp-net-core-updates-in-net-core-3-0-preview-3/" rel="noopener ugc nofollow" target="_blank">ASP.NET核心</a>预告3于3月6日发布。此版本添加了在使用微软提供的模板创建Angular或React应用程序时包含auth的选项。我无法表达这个功能让我有多开心。作为一个没有深入研究过auth的人，为一个新的应用程序提供一个好的起点是非常有帮助的。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/f1157a16bc9d550aec1db62888ea13c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xaZo9mj0NisRqBehfeDG0Q.png"/></div></div></figure><h1 id="93c0" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">装置</h1><p id="28b4" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">要获得模板的更新版本，请安装。NET Core 3预告。你可以在这里找到安装者<a class="ae kl" href="https://dotnet.microsoft.com/download/dotnet-core/3.0" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="9479" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">项目创建</h1><p id="678a" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">使用。NET CLI在命令提示符下，在要创建项目的目录中运行以下命令。</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="9853" class="mg kz iq mc b gy mh mi l mj mk">dotnet new react --auth Individual</span></pre><p id="a66f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">项目构建完成后，您应该能够使用下面的命令来运行应用程序。</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="2cd4" class="mg kz iq mc b gy mh mi l mj mk">dotnet run</span></pre><h1 id="f5d9" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">预览版3的问题</h1><p id="ae0c" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我做了上面的操作，导致了下面的错误。</p><blockquote class="ml mm mn"><p id="cef3" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><em class="iq">微软。AspNetCore.SpaServices:信息:</em></p><p id="bbfc" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><em class="iq">编译失败。</em></p><p id="9417" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated">信息:微软。AspNetCore.SpaServices[0] </p><p id="5e64" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><em class="iq">。/src/components/API-authorization/API authorization constants . js</em></p></blockquote><p id="c576" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">似乎Preview 3附带的React模板存在一些问题。要修复上述错误，请打开client app/src/components/API-authorization目录中的<strong class="jp ir">API authorization constants . js</strong>文件，并进行以下更改。</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="2143" class="mg kz iq mc b gy mh mi l mj mk">Before: ApiAuthorizationPrefix = prefix, After: ApiAuthorizationPrefix: prefix,</span></pre><p id="2dfe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">修复后，您将看到以下错误。</p><blockquote class="ml mm mn"><p id="95aa" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><em class="iq">。/src/components/API-authorization/API authorization routes . js<br/>找不到模块:无法解析。/components/API-authorization/log in ' in ' \ client app \ src \ components \ API-authorization '</em></p></blockquote><p id="8c4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个修复有点复杂。我在微软提供的<a class="ae kl" href="https://github.com/dotnet/core/blob/master/release-notes/3.0/preview/3.0.0-preview-known-issues.md" rel="noopener ugc nofollow" target="_blank">已知问题页面</a>中找到了变通方法。</p><p id="62d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，删除<strong class="jp ir">API authorizationroutes . js</strong>文件，该文件与上一个修复程序位于同一目录。然后用下面的内容替换ClientApp/src目录中的<strong class="jp ir"> App.js </strong>的内容。</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="e1bc" class="mg kz iq mc b gy mh mi l mj mk">import React, { Component } from 'react'; import { Route } from 'react-router'; import { Layout } from './components/Layout'; import { Home } from './components/Home'; import { FetchData } from './components/FetchData'; import { Counter } from './components/Counter'; import { Login } from './components/api-authorization/Login' import { Logout } from './components/api-authorization/Logout' import AuthorizeRoute from './components/api-authorization/AuthorizeRoute'; import { ApplicationPaths, LoginActions, LogoutActions } from './components/api-authorization/ApiAuthorizationConstants'; export default class App extends Component { static displayName = App.name; render () { return ( &lt;Layout&gt; &lt;Route exact path='/' component={Home} /&gt; &lt;Route path='/counter' component={Counter} /&gt; &lt;AuthorizeRoute path='/fetch-data' component={FetchData} /&gt; &lt;Route path={ApplicationPaths.Login} render={() =&gt; loginAction(LoginActions.Login)} /&gt; &lt;Route path={ApplicationPaths.LoginFailed} render={() =&gt; loginAction(LoginActions.LoginFailed)} /&gt; &lt;Route path={ApplicationPaths.LoginCallback} render={() =&gt; loginAction(LoginActions.LoginCallback)} /&gt; &lt;Route path={ApplicationPaths.Profile} render={() =&gt; loginAction(LoginActions.Profile)} /&gt; &lt;Route path={ApplicationPaths.Register} render={() =&gt; loginAction(LoginActions.Register)} /&gt; &lt;Route path={ApplicationPaths.LogOut} render={() =&gt; logoutAction(LogoutActions.Logout)} /&gt; &lt;Route path={ApplicationPaths.LogOutCallback} render={() =&gt; logoutAction(LogoutActions.LogoutCallback)} /&gt; &lt;Route path={ApplicationPaths.LoggedOut} render={() =&gt; logoutAction(LogoutActions.LoggedOut)} /&gt; &lt;/Layout&gt; ); } } function loginAction(name){ return (&lt;Login action={name}&gt;&lt;/Login&gt;); } function logoutAction(name) { return (&lt;Logout action={name}&gt;&lt;/Logout&gt;); }</span></pre><p id="16c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过以上修复，网站将加载，您应该会看到如下内容。</p><p id="c39d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当你尝试注册时，你会得到以下错误。</p><blockquote class="ml mm mn"><p id="f86f" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><em class="iq"> MissingMethodException:找不到方法:“Microsoft。EntityFrameworkCore . metadata . builders . index builder Microsoft。EntityFrameworkCore . metadata . builders . entitytypebuilder ` 1。HasIndex(系统。linq . expressions . expression ` 1&lt;系统。Func`2 &lt;！0，系统。&gt;对象&gt;)’。</em></p><p id="0526" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><em class="iq">身份服务器4。entity framework . extensions . modelbuilderextensions+&lt;&gt;c _ _ display class 2 _ 0。&lt;ConfigurePersistedGrantContext&gt;b _ _ 0(EntityTypeBuilder&lt;PersistedGrant&gt;grant)</em></p></blockquote><p id="2888" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">再次已知问题页面来拯救。打开你的<strong class="jp ir"> csproj </strong>文件，替换下面的包引用。</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="4559" class="mg kz iq mc b gy mh mi l mj mk">Before: &lt;PackageReference Include="Microsoft.AspNetCore.Identity.EntityFrameworkCore" Version="3.0.0-preview3-19153-02" /&gt; &lt;PackageReference Include="Microsoft.EntityFrameworkCore.Sqlite" Version="3.0.0-preview3.19153.1" /&gt; &lt;PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="3.0.0-preview3.19153.1" /&gt; After: &lt;PackageReference Include="Microsoft.AspNetCore.Identity.EntityFrameworkCore" Version="3.0.0-preview-18579-0056" /&gt; &lt;PackageReference Include="Microsoft.EntityFrameworkCore.Sqlite" Version="3.0.0-preview.19080.1" /&gt; &lt;PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="3.0.0-preview.19080.1" /&gt; &lt;PackageReference Include="Microsoft.EntityFrameworkCore.Relational" Version="3.0.0-preview.19080.1" /&gt; &lt;PackageReference Include="Microsoft.EntityFrameworkCore" Version="3.0.0-preview.19080.1" /&gt;</span></pre><p id="82d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并添加下面这段XML。</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="57ac" class="mg kz iq mc b gy mh mi l mj mk">&lt;PropertyGroup&gt; &lt;NoWarn&gt;$(NoWarn);NU1605&lt;/NoWarn&gt; &lt;/PropertyGroup&gt;</span></pre><h1 id="052a" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">包扎</h1><p id="e8d9" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">经过上述调整后，一切都正常了。我相信到预览版4时，体验会更好。尽管我遇到了一些问题，但让一个基本的新项目进行下去，我还是非常兴奋。谢谢你，ASP.NET团队，在微软给这些模板添加认证将会非常有帮助。另外，请注意，Angular template还获得了一个auth选项(目前看来这是一个更流畅的体验)。</p></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><p id="4e2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mo">原载于2019年3月24日</em><a class="ae kl" href="https://elanderson.net/2019/03/asp-net-core-3-react-template-with-auth/" rel="noopener ugc nofollow" target="_blank"><em class="mo">elanderson.net</em></a><em class="mo">。</em></p></div></div>    
</body>
</html>