<html>
<head>
<title>Creating a Scroll-Based Progress Bar in Vue</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Vue中创建基于滚动的进度条</h1>
<blockquote>原文：<a href="https://itnext.io/creating-a-scroll-based-progress-bar-in-vue-42979cd34773?source=collection_archive---------8-----------------------#2019-02-11">https://itnext.io/creating-a-scroll-based-progress-bar-in-vue-42979cd34773?source=collection_archive---------8-----------------------#2019-02-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/fea9ebd383d898fb6ef5558721c81871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x5dKxB24pmPAprVlm4cLcA.png"/></div></div></figure><p id="b1a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有时候，我们需要一种方式来向用户展示他们从一篇文章中读到了多少。最好的方法是显示一个进度条，以百分比显示。</p><p id="55a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要做到这一点，我们必须知道他们已经滚动了多少文章(或任何东西)，然后用这个来计算完成的百分比。我们还需要一个组件向用户显示该百分比。</p><p id="9b69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你对学习如何构建这个感兴趣，可以在<a class="ae kw" href="https://codepen.io/tahazsh/pen/ZwxeGx" rel="noopener ugc nofollow" target="_blank"> CodePen </a>上查看下面的演示，然后继续阅读，看看如何构建它。</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="lb lc l"/></div></figure><h1 id="675a" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">步骤1:创建App.vue</h1><p id="ae80" class="pw-post-body-paragraph jy jz iq ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">我们将使用<a class="ae kw" href="https://medium.com/@Taha_Shashtari/test-out-your-vue-component-ideas-in-no-time-with-instant-prototyping-5fdf22688c08" rel="noopener"> Vue CLI 3的即时原型</a>来运行这个项目。因此创建<code class="fe mg mh mi mj b">App.vue</code>，并将以下内容放入<code class="fe mg mh mi mj b">&lt;template&gt;</code>部分:</p><pre class="kx ky kz la gt mk mj ml mm aw mn bi"><span id="33d4" class="mo le iq mj b gy mp mq l mr ms">&lt;template&gt;<br/>  &lt;div id="app"&gt;<br/>    &lt;div class="card"&gt;<br/>      &lt;progress-bar :value="progress"/&gt;<br/>      &lt;div class="text-section"&gt;<br/>        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Cupiditate architecto voluptatum, laboriosam quisquam quod minus molestias. Rem ut quidem, corrupti nihil molestiae deserunt, iusto velit unde atque mollitia, eum ad maiores exercitationem. Soluta harum sit cupiditate eos, commodi itaque nihil, beatae dolorem ducimus, repudiandae, vero quo corporis sed laborum at maxime dicta dolores perferendis! Possimus repellat velit iste quod recusandae suscipit vitae ex soluta nostrum animi saepe eius itaque, voluptas, sapiente minima quo culpa explicabo necessitatibus distinctio. Veritatis amet tempora, consectetur molestias optio eveniet laudantium, tenetur aspernatur nobis ratione sit hic in impedit quod deserunt recusandae atque, ipsam molestiae sequi!<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span></pre><p id="544b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在这里显示一个带有一些文本的卡片元素。我们还在它上面显示进度条组件(我们还没有创建它)。</p><p id="3c8d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe mg mh mi mj b">&lt;script&gt;</code>部分，输入以下内容:</p><pre class="kx ky kz la gt mk mj ml mm aw mn bi"><span id="0db4" class="mo le iq mj b gy mp mq l mr ms">&lt;script&gt;<br/><strong class="mj ir">import</strong> ProgressBar <strong class="mj ir">from</strong> './ProgressBar'<br/><br/><strong class="mj ir">export</strong> <strong class="mj ir">default</strong> {<br/>  components: { ProgressBar },<br/>  data () {<br/>    <strong class="mj ir">return</strong> {<br/>      progress: 0<br/>    }<br/>  }<br/>}<br/>&lt;/script&gt;</span></pre><p id="4b03" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将使用<code class="fe mg mh mi mj b">progress</code>数据属性来存储到目前为止用户已经滚动了多少。它将来自<code class="fe mg mh mi mj b">0-1</code>。</p><p id="56d0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们转到<code class="fe mg mh mi mj b">&lt;style&gt;</code>部分:</p><pre class="kx ky kz la gt mk mj ml mm aw mn bi"><span id="d03e" class="mo le iq mj b gy mp mq l mr ms">&lt;<strong class="mj ir">style</strong>&gt;<br/>* {<br/>  box-sizing: border-box;<br/>}<br/><br/><strong class="mj ir">body</strong> {<br/>  margin: 0;<br/>  padding: 1px 0 0;<br/>  width: 100vw;<br/>  height: 100vh;<br/>  background: #6B5CA5;<br/>}<br/><br/><strong class="mj ir">html</strong> {<br/>  padding: 0;<br/>  margin: 0;<br/>}<br/><br/>.card {<br/>  border-radius: 3px;<br/>  font-family: 'Avenir', Helvetica, Arial, sans-serif;<br/>  -webkit-font-smoothing: antialiased;<br/>  -moz-osx-font-smoothing: grayscale;<br/>  line-height: 1.5;<br/>  font-size: 18px;<br/>  color: #444;<br/>  width: 300px;<br/>  margin: 10px auto;<br/>  height: 150px;<br/>  margin-top: 10px;<br/>  display: flex;<br/>  flex-direction: column;<br/>  background: #FFFFFF;<br/>  box-shadow: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);<br/>}<br/><br/>.text-section {<br/>  height: 100%;<br/>  max-height: 100%;<br/>  padding: 0 10px 10px;<br/>  overflow: scroll;<br/>  -webkit-overflow-scrolling: touch;<br/>}<br/>&lt;/<strong class="mj ir">style</strong>&gt;</span></pre><h1 id="4f7d" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">步骤2:创建ProgressBar.vue</h1><p id="8abd" class="pw-post-body-paragraph jy jz iq ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">创建<code class="fe mg mh mi mj b">ProgressBar.vue</code>并将其放入<code class="fe mg mh mi mj b">&lt;template&gt;</code>:</p><pre class="kx ky kz la gt mk mj ml mm aw mn bi"><span id="1658" class="mo le iq mj b gy mp mq l mr ms">&lt;template&gt;<br/>  &lt;div class="progress-bar"&gt;<br/>    &lt;div class="filled-bar"&gt;&lt;/div&gt;<br/>    &lt;span class="percentage-text"&gt;<br/>      Progress: {{ percentageText }}<br/>    &lt;/span&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span></pre><p id="9a2a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该组件由三部分组成:</p><ul class=""><li id="7467" class="mt mu iq ka b kb kc kf kg kj mv kn mw kr mx kv my mz na nb bi translated"><code class="fe mg mh mi mj b">.progress-bar</code>是进度条的容器——我们在这里指定进度条的宽度和高度。</li><li id="8fdb" class="mt mu iq ka b kb nc kf nd kj ne kn nf kr ng kv my mz na nb bi translated"><code class="fe mg mh mi mj b">.filled-bar</code>将具有与其容器相同的宽度和高度，但是它将被填充一种背景颜色。</li><li id="d5c4" class="mt mu iq ka b kb nc kf nd kj ne kn nf kr ng kv my mz na nb bi translated"><code class="fe mg mh mi mj b">.percentage-text</code>显示当前滚动百分比。</li></ul><p id="3b5e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mg mh mi mj b">.filled-bar</code>和<code class="fe mg mh mi mj b">.percentage-text</code>将<em class="nh">绝对定位</em>。而且，显然，<code class="fe mg mh mi mj b">.percentage-text</code>应该有更高的<code class="fe mg mh mi mj b">z-index</code>才能出现在<code class="fe mg mh mi mj b">.filled-bar</code>之上。</p><p id="f0d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如上所述，<code class="fe mg mh mi mj b">.filled-bar</code>将与其容器具有相同的宽度。这意味着我们将使用它的位置来反映当前的滚动百分比。因此，当用户在最顶端时(还没有滚动)，我们将把填充栏完全移出进度条容器(从左侧)。当用户向下滚动时，我们将向右移动填充栏，逐渐进入进度条容器。</p><p id="64cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是当然，用户不应该看到填充栏的外部。所以我们要给容器(<code class="fe mg mh mi mj b">.progress-bar</code>)加上<code class="fe mg mh mi mj b">overflow: hidden</code>。</p><p id="acb5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，让我们编写<code class="fe mg mh mi mj b">&lt;script&gt;</code>部分:</p><pre class="kx ky kz la gt mk mj ml mm aw mn bi"><span id="6ade" class="mo le iq mj b gy mp mq l mr ms">&lt;script&gt;<br/><strong class="mj ir">export</strong> <strong class="mj ir">default</strong> {<br/>  props: {<br/>    value: {<br/>      type: Number,<br/>      default: 0<br/>    }<br/>  },<br/><br/>  computed: {<br/>    percentageText () {<br/>      <strong class="mj ir">return</strong> `${Math.round(<strong class="mj ir">this</strong>.value * 100)}%`<br/>    }<br/>  }<br/>}<br/>&lt;/script&gt;</span></pre><p id="ce60" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意我们是如何通过<code class="fe mg mh mi mj b">value</code> prop接受当前进度值的。</p><p id="dc57" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如您在computed部分看到的，我们使用了那个<code class="fe mg mh mi mj b">value</code>来获得格式化文本形式的百分比值。所以，举个例子，如果<code class="fe mg mh mi mj b">value</code>是<code class="fe mg mh mi mj b">0.05</code>，它应该输出<code class="fe mg mh mi mj b">5%</code>。</p><p id="89e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，让我们添加样式:</p><pre class="kx ky kz la gt mk mj ml mm aw mn bi"><span id="c207" class="mo le iq mj b gy mp mq l mr ms">&lt;<strong class="mj ir">style</strong> <strong class="mj ir">scoped</strong>&gt;<br/>.progress-bar {<br/>  position: relative;<br/>  height: 30px;<br/>  width: 100%;<br/>  border-bottom: 1px solid #f0f0f0;<br/>  display: flex;<br/>  justify-content: center;<br/>  align-items: center;<br/>  overflow: hidden;<br/>  border-radius: 3px 3px 0 0;<br/>}<br/><br/>.percentage-text {<br/>  position: absolute;<br/>  top: 50%;<br/>  left: 50%;<br/>  z-index: 2;<br/>  font-size: 14px;<br/>  transform: translate3d(-50%, -50%, 0);<br/>}<br/><br/>.filled-bar {<br/>  position: absolute;<br/>  top: 0;<br/>  left: 0;<br/>  z-index: 2;<br/>  height: 100%;<br/>  width: 100%;<br/>  background: #eef0ff;<br/>}<br/>&lt;/<strong class="mj ir">style</strong>&gt;</span></pre><p id="721c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，如果您在浏览器中查看您的工作，您会看到类似这样的内容:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/2950a652727373651936c6c2cff84d41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FZMDfyjisqm8f3DB.png"/></div></div></figure><p id="d0a6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还有两件事要做:</p><ol class=""><li id="0057" class="mt mu iq ka b kb kc kf kg kj mv kn mw kr mx kv nj mz na nb bi translated">根据当前进度值更新填充栏位置(<code class="fe mg mh mi mj b">value</code> prop)。</li><li id="2375" class="mt mu iq ka b kb nc kf nd kj ne kn nf kr ng kv nj mz na nb bi translated">计算用户滚动时的滚动百分比。我们将通过<code class="fe mg mh mi mj b">value</code> prop把这个值传递给进度条。</li></ol><h1 id="267e" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">步骤3:更新填充栏的位置</h1><p id="a251" class="pw-post-body-paragraph jy jz iq ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">我们将使用<code class="fe mg mh mi mj b">transform: translate3d(x, y, z)</code> CSS属性来改变填充栏的位置。</p><p id="0949" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里需要注意两件事。首先，我们将只需要更新<code class="fe mg mh mi mj b">x</code>值并保持另外两个值为0。其次，出于性能原因，我们将使用<code class="fe mg mh mi mj b">translate3d</code>而不是<code class="fe mg mh mi mj b">translateX</code>——让GPU来处理。</p><p id="b8c7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在当<code class="fe mg mh mi mj b">x</code>为0时，填充栏会出现在原来的位置(用户会看到进度被完全填充)。要将其完全移动到左侧(容器外部)，我们应该将其设置为<code class="fe mg mh mi mj b">-100%</code>。这意味着，<code class="fe mg mh mi mj b">x</code>将来自<code class="fe mg mh mi mj b">0%-100%</code>。</p><p id="9203" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以在填充栏上使用<code class="fe mg mh mi mj b">transform</code>,只需将它绑定到它的样式属性:</p><pre class="kx ky kz la gt mk mj ml mm aw mn bi"><span id="6e3a" class="mo le iq mj b gy mp mq l mr ms">&lt;div<br/>  class="filled-bar"<br/>  :style="{ transform: `translate3d(-${(1 - value) * 100}%, 0, 0)` }"<br/>&gt;&lt;/div&gt;</span></pre><p id="886d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以通过更改<code class="fe mg mh mi mj b">value</code>属性的默认值来测试进度条是否正常工作。试着设置成<code class="fe mg mh mi mj b">0.5</code>，应该会看到这样的:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/edf3b8be5805f005d235dfb117b4a7f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2vSYoWksodSeUwVC.png"/></div></div></figure><h1 id="4a11" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">步骤4:计算当前滚动百分比</h1><p id="8b43" class="pw-post-body-paragraph jy jz iq ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">为了得到这个值，我们必须首先监听<code class="fe mg mh mi mj b">.text-section</code>上的<code class="fe mg mh mi mj b">@scroll</code>事件，然后用当前滚动位置(以像素为单位)除以文本部分的全高。</p><p id="7152" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，在<code class="fe mg mh mi mj b">App.vue</code>中，将<code class="fe mg mh mi mj b">@scroll</code>和<code class="fe mg mh mi mj b">ref</code>添加到<code class="fe mg mh mi mj b">.text-section</code>中，就像这样:</p><pre class="kx ky kz la gt mk mj ml mm aw mn bi"><span id="4614" class="mo le iq mj b gy mp mq l mr ms">&lt;div<br/>  class="text-section"<br/>  ref="text"<br/>  @scroll="onScroll"<br/>&gt;</span></pre><p id="dc44" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要添加<code class="fe mg mh mi mj b">ref</code>来访问元素的滚动位置和高度值。</p><p id="818a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，实现<code class="fe mg mh mi mj b">onScroll</code>方法:</p><pre class="kx ky kz la gt mk mj ml mm aw mn bi"><span id="21a7" class="mo le iq mj b gy mp mq l mr ms">methods: {<br/>  onScroll () {<br/>    <strong class="mj ir">const</strong> progress = <strong class="mj ir">this</strong>.$refs.text.scrollTop / (<strong class="mj ir">this</strong>.$refs.text.scrollHeight - <strong class="mj ir">this</strong>.$refs.text.clientHeight)<br/>    <strong class="mj ir">if</strong> (progress &gt; 1) {<br/>      <strong class="mj ir">this</strong>.progress = 1<br/>    } <strong class="mj ir">else</strong> <strong class="mj ir">if</strong> (progress &lt; 0) {<br/>      <strong class="mj ir">this</strong>.progress = 0<br/>    } <strong class="mj ir">else</strong> {<br/>      <strong class="mj ir">this</strong>.progress = progress<br/>    }<br/>  }<br/>}</span></pre><p id="5892" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为手机上的动量滚动，我们确保进度值不高于<code class="fe mg mh mi mj b">1</code>或低于<code class="fe mg mh mi mj b">0</code>——否则，进度条看起来会坏掉。</p><p id="fa18" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以，当用户滚动时，我们更新<code class="fe mg mh mi mj b">App.vue</code>中的<code class="fe mg mh mi mj b">progress</code>值；然后，将它传递给进度条组件(通过<code class="fe mg mh mi mj b">value</code>)，进度条组件将更新填充的进度条位置，并重新生成格式化的百分比文本。</p></div></div>    
</body>
</html>