<html>
<head>
<title>Prometheus: yet-another-cloudwatch-exporter — collecting AWS CloudWatch metrics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">普罗米修斯:另一个云观察出口商——收集AWS云观察指标</h1>
<blockquote>原文：<a href="https://itnext.io/prometheus-yet-another-cloudwatch-exporter-collecting-aws-cloudwatch-metrics-806bd34818a8?source=collection_archive---------1-----------------------#2020-07-23">https://itnext.io/prometheus-yet-another-cloudwatch-exporter-collecting-aws-cloudwatch-metrics-806bd34818a8?source=collection_archive---------1-----------------------#2020-07-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/d235a50d0380c3ecc187042a9cd58ae4.png" data-original-src="https://miro.medium.com/v2/resize:fit:260/format:webp/0*bFhCISppbVvbT-jH.png"/></div></figure><p id="0b22" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">目前，为了从AWS CloudWatch收集指标，我们正在使用AWS自己的<code class="fe ks kt ku kv b"><a class="ae kw" href="https://github.com/prometheus/cloudwatch_exporter" rel="noopener ugc nofollow" target="_blank">cloudwatch-exporter</a></code>，请参见<a class="ae kw" href="https://rtfm.co.ua/prometheus-cloudwatch-exporter-sbor-metrik-iz-aws-i-grafiki-v-grafana/" rel="noopener ugc nofollow" target="_blank">Prometheus:cloud watch exporter—сборметииикиатикиииатвGrafana</a>帖子(Rus 中的<em class="kx">)，但它有一些不足之处:</em></p><ul class=""><li id="07cb" class="ky kz iq jw b jx jy kb kc kf la kj lb kn lc kr ld le lf lg bi translated">它是用Java编写的，所以使用监控主机的CPU/内存</li><li id="0071" class="ky kz iq jw b jx lh kb li kf lj kj lk kn ll kr ld le lf lg bi translated">不会从资源中抓取AWS标签</li><li id="fd57" class="ky kz iq jw b jx lh kb li kf lj kj lk kn ll kr ld le lf lg bi translated">使用<code class="fe ks kt ku kv b"><a class="ae kw" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_GetMetricStatistics.html" rel="noopener ugc nofollow" target="_blank">GetMetricStatistics</a></code>方法获取数据</li><li id="17f9" class="ky kz iq jw b jx lh kb li kf lj kj lk kn ll kr ld le lf lg bi translated">只能从一个AWS区域收集指标，例如<em class="kx">美国东部-1 </em>或<em class="kx">欧盟西部-2 </em></li></ul><p id="1a36" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了缓解这些问题，让我们尝试使用<code class="fe ks kt ku kv b"><a class="ae kw" href="https://github.com/ivx/yet-another-cloudwatch-exporter" rel="noopener ugc nofollow" target="_blank">yet-another-cloudwatch-exporter</a></code>来代替。</p><h1 id="eab7" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">AWS CloudWatch —差距</h1><h2 id="0dc3" class="mk ln iq bd lo ml mm dn ls mn mo dp lw kf mp mq ma kj mr ms me kn mt mu mi mv bi translated">标签</h2><p id="1182" class="pw-post-body-paragraph ju jv iq jw b jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn na kp kq kr ij bi translated">让“默认”导出器不舒服的第一件事是，它不会从AWS中的资源获取标签。</p><p id="0fc9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">例如，应用程序负载平衡器指标将返回唯一这样的标签:</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nb"><img src="../Images/702571458246fb0f6bb36280b3486386.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uG9ve-dpiD6YDup2.png"/></div></div></figure><p id="9683" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">但是，如果您在AWS控制台中检查它，您会发现那里有更多的标签:</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nb"><img src="../Images/c11f170a4f967658c9f5c678fee52979.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KbXKsOokJUgG2c-R.png"/></div></div></figure><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nk"><img src="../Images/72d12cf259eb84ed4895738b92820cdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AZzsgR7sqg0J5RWc.png"/></div></div></figure><p id="ed77" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">目前还没有办法使用Grafana的标签。</p><h2 id="dc36" class="mk ln iq bd lo ml mm dn ls mn mo dp lw kf mp mq ma kj mr ms me kn mt mu mi mv bi translated"><code class="fe ks kt ku kv b">GetMetricStatistics</code> vs <code class="fe ks kt ku kv b">GetMetricData</code></h2><p id="b294" class="pw-post-body-paragraph ju jv iq jw b jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn na kp kq kr ij bi translated">默认导出器的另一个问题是用于收集数据的API方法— <code class="fe ks kt ku kv b"><a class="ae kw" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_GetMetricStatistics.html" rel="noopener ugc nofollow" target="_blank">GetMetricStatistics</a></code>。</p><p id="e50e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">两年前出现了一个问题<a class="ae kw" href="https://github.com/prometheus/cloudwatch_exporter/issues/134" rel="noopener ugc nofollow" target="_blank">通过使用GetMetricData api而不是GetMetricStatistics API来降低API操作的成本</a> —但它仍然没有得到应用。</p><p id="02cc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因此，<code class="fe ks kt ku kv b"><a class="ae kw" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_GetMetricStatistics.html" rel="noopener ugc nofollow" target="_blank">GetMetricStatistics</a></code>的问题是它如何收集指标——对于每个指标，您的<code class="fe ks kt ku kv b">cloudwatch-exporter</code>将导致一个专用的API调用。</p><p id="4e3e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">例如，如果您有100个EC2实例，每个实例有10个指标，那么<code class="fe ks kt ku kv b">cloudwatch-exporter</code>将每60秒执行1000次，这将为您带来巨大的开销:</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nl"><img src="../Images/bfaca2f1095fb1d030f5739b6f1658dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Kj3fghmBKXY5QOWb.png"/></div></div></figure><p id="0a62" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">与AWS <code class="fe ks kt ku kv b">cloudwatch-exporter</code>不同，<code class="fe ks kt ku kv b">yet-another-cloudwatch-exporter</code>使用<code class="fe ks kt ku kv b"><a class="ae kw" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_GetMetricData.html" rel="noopener ugc nofollow" target="_blank">GetMetricData</a></code> API调用，这允许我们在一次API调用中获得多达500个指标。</p><h1 id="b9d1" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">跑步<code class="fe ks kt ku kv b">yet-another-cloudwatch-exporter</code></h1><p id="25fa" class="pw-post-body-paragraph ju jv iq jw b jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn na kp kq kr ij bi translated">让我们试着旋转它并得到数据。</p><p id="2f31" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为导出者创建一个带有AWS凭证的新文件，我们将其命名为<em class="kx"> alb-cred </em>:</p><pre class="nc nd ne nf gt nm kv nn no aw np bi"><span id="c1b6" class="mk ln iq kv b gy nq nr l ns nt">[default]<br/>aws_region = us-east-2<br/>aws_access_key_id = AKI***D4Q<br/>aws_secret_access_key = QUC***BTI</span></pre><p id="9caa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">或者，您可以使用<a class="ae kw" href="https://rtfm.co.ua/en/aws-iam-users-keys-rotation-ec2-iam-roles-and-jenkins/" rel="noopener ugc nofollow" target="_blank"> AWS EC2实例概要文件</a>，但是它的策略必须具有以下权限:</p><pre class="nc nd ne nf gt nm kv nn no aw np bi"><span id="4de8" class="mk ln iq kv b gy nq nr l ns nt">{<br/>    "Version": "2012-10-17",<br/>    "Statement": [<br/>        {<br/>            "Sid": "CloudWatchExporterPolicy",<br/>            "Effect": "Allow",<br/>            "Action": [<br/>                "tag:GetResources",<br/>                "cloudwatch:ListTagsForResource",<br/>                "cloudwatch:GetMetricData",<br/>                "cloudwatch:ListMetrics"<br/>            ],<br/>            "Resource": "*"<br/>        }<br/>    ]<br/>}</span></pre><p id="9208" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，用导出器的设置创建一个文件:</p><pre class="nc nd ne nf gt nm kv nn no aw np bi"><span id="3fa3" class="mk ln iq kv b gy nq nr l ns nt">discovery:<br/>  jobs:<br/>  - regions:<br/>      - us-east-2<br/>    type: elb<br/>    enableMetricData: true<br/>    metrics:<br/>      - name: ActiveConnectionCount<br/>        statistics:<br/>        - Sum<br/>        period: 300<br/>        length: 600</span></pre><p id="1dda" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">并使用Docker运行它:</p><pre class="nc nd ne nf gt nm kv nn no aw np bi"><span id="551e" class="mk ln iq kv b gy nq nr l ns nt">$ docker run -ti -p 5000:5000 -v /home/setevoy/Temp/alb-cred:/exporter/.aws/credentials -v /home/setevoy/Temp/config.yaml:/tmp/config.yml quay.io/invisionag/yet-another-cloudwatch-exporter:v0.19.1-alpha<br/>{“level”:”info”,”msg”:”Parse config..”,”time”:”2020–07–21T10:59:49Z”}<br/>{“level”:”info”,”msg”:”Startup completed”,”time”:”2020–07–21T10:59:49Z”}</span></pre><p id="153a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查指标:</p><pre class="nc nd ne nf gt nm kv nn no aw np bi"><span id="5947" class="mk ln iq kv b gy nq nr l ns nt">$ curl localhost:5000/metrics<br/>HELP aws_elb_info Help is not implemented yet.<br/>TYPE aws_elb_info gauge<br/>aws_elb_info{name=”arn:aws:elasticloadbalancing:us-east-2:534***385:loadbalancer/app/fea06ba9-eksstage1mealplan-a584/***”,tag_Env=””,tag_Name=””,tag_Stack=””,tag_ingress_k8s_aws_cluster=”bttrm-eks-stage-1",tag_ingress_k8s_<br/>aws_resource=”LoadBalancer”,tag_ingress_k8s_aws_stack=”eks-stage-1-mealplan-api-ns/mealplan-api-ingress”,tag_kubernetes_io_cluster_bttrm_eks_dev_0=””,tag_kubernetes_io_cluster_bttrm_eks_dev_1=””,tag_kubernetes_io_cluster_bttrm_eks_prod_0=<br/>“”,tag_kubernetes_io_cluster_bttrm_eks_prod_1=””,tag_kubernetes_io_cluster_bttrm_eks_stage_1=”owned”,tag_kubernetes_io_cluster_eksctl_bttrm_eks_production_1=””,tag_kubernetes_io_ingress_name=”mealplan-api-ingress”,tag_kubernetes_io_namesp<br/>ace=”eks-stage-1-mealplan-api-ns”,tag_kubernetes_io_service_name=””} 0<br/>…</span></pre><p id="f19d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在您可以看到，每个指标都附加了所有AWS标记。</p><h2 id="891b" class="mk ln iq bd lo ml mm dn ls mn mo dp lw kf mp mq ma kj mr ms me kn mt mu mi mv bi translated"><code class="fe ks kt ku kv b">yet-another-cloudwatch-exporter</code>配置</h2><h2 id="df6e" class="mk ln iq bd lo ml mm dn ls mn mo dp lw kf mp mq ma kj mr ms me kn mt mu mi mv bi translated"><code class="fe ks kt ku kv b">exportedTagsOnMetrics</code></h2><p id="0948" class="pw-post-body-paragraph ju jv iq jw b jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn na kp kq kr ij bi translated">如果您不需要所有的标签——您可以使用<code class="fe ks kt ku kv b">exportedTagsOnMetrics</code>来限制哪些标签将被附加到指标上。</p><p id="5a21" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">例如，让我们只留下下面的标签:</p><pre class="nc nd ne nf gt nm kv nn no aw np bi"><span id="71cb" class="mk ln iq kv b gy nq nr l ns nt">discovery:<br/>  exportedTagsOnMetrics:<br/>    alb:<br/>      - Name<br/>      - kubernetes.io/service-name<br/>      - ingress.k8s.aws/cluster<br/>      - kubernetes.io/namespace<br/>...</span></pre><h2 id="4ba8" class="mk ln iq bd lo ml mm dn ls mn mo dp lw kf mp mq ma kj mr ms me kn mt mu mi mv bi translated"><code class="fe ks kt ku kv b">SeacrhTags</code></h2><p id="8c81" class="pw-post-body-paragraph ju jv iq jw b jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn na kp kq kr ij bi translated">此外，您可以设置一个限制来指定导出器将从哪些资源获取度量——类似于AWS <code class="fe ks kt ku kv b">cloudwatch-exporter</code>中的<code class="fe ks kt ku kv b"><a class="ae kw" href="https://github.com/prometheus/cloudwatch_exporter#configuration" rel="noopener ugc nofollow" target="_blank">tag_selections</a></code>。</p><p id="9c1b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">比方说，我们想从唯一的"<em class="kx">Bt trm-eks-prod-1</em>" eks cluster中获取指标。</p><p id="2d38" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后您可以指定<em class="kx">" ingress . k8s . AWS/cluster</em>"作为标记键，指定"<em class="kx"> bttrm-eks-prod-1 </em>"作为它的值:</p><pre class="nc nd ne nf gt nm kv nn no aw np bi"><span id="7542" class="mk ln iq kv b gy nq nr l ns nt">discovery:<br/>  exportedTagsOnMetrics:<br/>    alb:<br/>      - Name<br/>      - kubernetes.io/service-name<br/>      - ingress.k8s.aws/cluster<br/>      - kubernetes.io/namespace<br/>  jobs:<br/>  - type: alb<br/>    regions:<br/>      - us-east-2<br/>    searchTags:<br/>      - Key: ingress.k8s.aws/cluster<br/>        Value: bttrm-eks-prod-1<br/>    metrics:<br/>      - name: UnHealthyHostCount<br/>        statistics: [Maximum]<br/>        period: 60<br/>        length: 600<br/>      - name: ActiveConnectionCount<br/>        statistics: [Sum] <br/>        period: 300<br/>        length: 600</span></pre><p id="931b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">重启并检查它:</p><pre class="nc nd ne nf gt nm kv nn no aw np bi"><span id="d31a" class="mk ln iq kv b gy nq nr l ns nt">$ curl localhost:5000/metrics<br/>HELP aws_alb_active_connection_count_sum Help is not implemented yet.<br/>TYPE aws_alb_active_connection_count_sum gauge<br/>aws_alb_active_connection_count_sum{dimension_LoadBalancer=”app/bcf678a9-eksprod1bttrmapps-447a/***”,name=”arn:aws:elasticloadbalancing:us-east-2:534***385:loadbalancer/app/bcf678a9-eksprod1bttrmapps-***”,region=”us-east-2",tag_Name=””,tag_ingress_k8s_aws_cluster=”bttrm-eks-prod-1",tag_kubernetes_io_namespace=”eks-prod-1-bttrm-apps-ns”,tag_kubernetes_io_service_name=””} 112<br/>…<br/>aws_alb_tg_un_healthy_host_count_maximum{dimension_LoadBalancer=”app/bcf678a9-eksprod1bttrmapps-447a/***”,dimension_TargetGroup=”targetgroup/bcf678a9–9b32ce4accea2525b4d/e0f341421a33a453",name=”arn:aws:elasticloadbalancing:us-east-2:534***385:targetgroup/bcf678a9–9b32ce4accea2525b4d/e0f341421a33a453",region=”us-east-2",tag_Name=””,tag_ingress_k8s_aws_cluster=”bttrm-eks-prod-1",tag_kubernetes_io_namespace=”eks-prod-1-bttrm-apps-ns”,tag_kubernetes_io_service_name=”bttrm-apps-backend-svc”} 0<br/>…</span></pre><p id="4910" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，我们从唯一的一个EKS集群中获取指标，并且指标只包含选定的标签。</p><h2 id="0897" class="mk ln iq bd lo ml mm dn ls mn mo dp lw kf mp mq ma kj mr ms me kn mt mu mi mv bi translated">与普罗米修斯一起奔跑</h2><p id="3112" class="pw-post-body-paragraph ju jv iq jw b jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn na kp kq kr ij bi translated">我们在Docker Compose下运行我们的Prometheus堆栈，所以让我们添加YACE导出器:</p><pre class="nc nd ne nf gt nm kv nn no aw np bi"><span id="887d" class="mk ln iq kv b gy nq nr l ns nt">...<br/>  yace-clouwatch-exporter:<br/>    image: quay.io/invisionag/yet-another-cloudwatch-exporter:v0.19.1-alpha<br/>    networks:<br/>      - prometheus<br/>    ports:<br/>      - 5000:5000<br/>    volumes:<br/>      - /etc/prometheus/prometheus-yace-cloudwatch-exporter.yaml:/tmp/config.yml:ro<br/>    restart: unless-stopped</span></pre><p id="1fa1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在向Prometheus服务器配置添加一个新目标:</p><pre class="nc nd ne nf gt nm kv nn no aw np bi"><span id="60f4" class="mk ln iq kv b gy nq nr l ns nt">...<br/>scrape_configs:<br/><br/>  - job_name: 'yace-clouwatch-exporter'<br/>    metrics_path: '/metrics'<br/>    static_configs:<br/>      - targets: ['yace-clouwatch-exporter:5000']<br/>...</span></pre><p id="0df7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">重启普罗米修斯，检查目标:</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nu"><img src="../Images/ba8876eda412f713ec05a233cb30e9c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*j7WaBnG-0VrTfHzw.png"/></div></div></figure><p id="b3a4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">指标:</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/c3b767f553cdb4181081fd3e5c9f616e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/0*IrwUjTXZbua591X8.png"/></div></figure><h1 id="9f17" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">Grafana图</h1><p id="098e" class="pw-post-body-paragraph ju jv iq jw b jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn na kp kq kr ij bi translated">现在，我们能够在Grafana中使用这些指标，并且能够选择环境，例如<em class="kx">开发</em>、<em class="kx">阶段</em>、<em class="kx">生产</em>(参见<a class="ae kw" href="https://rtfm.co.ua/grafana-sozdanie-dashboard/" rel="noopener ugc nofollow" target="_blank"> Grafana: создание仪表板</a>、<em class="kx"> Rus </em>):</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nw"><img src="../Images/c84415a164d8691bb3bc52a0b4ab670b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*F_n7iuLRoi4oxRyD.png"/></div></div></figure><p id="30fa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里的<code class="fe ks kt ku kv b">$env</code>变量是从我们的标签<code class="fe ks kt ku kv b">ekscluster</code>中创建的，该标签在从CloudFormation创建集群的过程中附加到每个集群上(参见<a class="ae kw" href="https://rtfm.co.ua/en/aws-elastic-kubernetes-service-a-cluster-creation-automation-part-1-cloudformation/" rel="noopener ugc nofollow" target="_blank">AWS Elastic Kubernetes Service:a cluster creation automation，part 1–cloud formation</a>):</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/568826a999f4407bf3ad2833bd0f7003.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/0*c32kW19nugkq8MqS.png"/></div></figure><p id="4834" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">完成了。</p><h1 id="22d1" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">有用的链接</h1><ul class=""><li id="4e0f" class="ky kz iq jw b jx mw kb mx kf ny kj nz kn oa kr ld le lf lg bi translated"><a class="ae kw" href="https://sysdig.com/blog/improving-prometheus-cloudwatch-exporter/" rel="noopener ugc nofollow" target="_blank">改进亚马逊云观察的普罗米修斯出口器</a></li><li id="4aea" class="ky kz iq jw b jx lh kb li kf lj kj lk kn ll kr ld le lf lg bi translated"><a class="ae kw" href="https://sysdig.com/blog/monitor-aws-lambda-prometheus/" rel="noopener ugc nofollow" target="_blank">用Prometheus和Sysdig监控AWS Lambda</a></li></ul></div><div class="ab cl ob oc hu od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="ij ik il im in"><p id="d0d7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="kx">最初发布于</em> <a class="ae kw" href="https://rtfm.co.ua/en/prometheus-yet-another-cloudwatch-exporter-collecting-aws-cloudwatch-metrics/" rel="noopener ugc nofollow" target="_blank"> <em class="kx"> RTFM: Linux、DevOps和系统管理</em> </a> <em class="kx">。</em></p></div></div>    
</body>
</html>