<html>
<head>
<title>Top 6 Threat Detection Tools for Containers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">集装箱的6大威胁检测工具</h1>
<blockquote>原文：<a href="https://itnext.io/top-6-threat-detection-tools-for-containers-3dd80b77777e?source=collection_archive---------2-----------------------#2022-08-08">https://itnext.io/top-6-threat-detection-tools-for-containers-3dd80b77777e?source=collection_archive---------2-----------------------#2022-08-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1a0e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">保护容器化云原生应用威胁的基本要素</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1658d7f25f6b5313adf2343f0ffa7005.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wPF_H25R41fp4ySYixIgdw.jpeg"/></div></div></figure><p id="7e28" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如今，容器化的解决方案是云原生应用程序开发领域事实上的标准。像Docker、Containers、CRI-O和Kubernetes这样的工具正在流行。数百万开发和架构团队选择基于容器的解决方案来构建他们的产品。所有知名的云提供商都有大量的服务，并且基于Kubernetes、Docker和其他容器编排平台。</p><p id="bfa4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">工具和平台是威胁检测基础的重要组成部分。有许多开源工具包含许多威胁检测选项。下面我列出了一些提供逻辑的工具:</p><ul class=""><li id="9b8c" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">静态图像漏洞扫描</li><li id="5f48" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">配置验证</li><li id="b001" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">秘密扫描</li></ul><blockquote class="me mf mg"><p id="c74a" class="ku kv mh kw b kx ky ju kz la lb jx lc mi le lf lg mj li lj lk mk lm ln lo lp im bi translated"><a class="ae ml" href="https://dzone.com/refcardz/threat-detection-for-containers" rel="noopener ugc nofollow" target="_blank">容器威胁检测参考卡</a>包含关于保护容器化云原生应用威胁的扩展指南。</p></blockquote><h1 id="7845" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">克莱尔</h1><p id="ba06" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated"><a class="ae ml" href="https://github.com/quay/clair" rel="noopener ugc nofollow" target="_blank"> Clair </a>是一款静态安全扫描工具。它基于<a class="ae ml" href="https://github.com/opencontainers/image-spec/blob/main/spec.md" rel="noopener ugc nofollow" target="_blank">开放集装箱倡议(OCI) </a>格式。Clair根据所有已知的威胁和漏洞信息源(如CVE追踪器、Redhat security Data和Debian Security Bug Tracker)对图像进行验证和索引。此外，Clair提供了一个用于开发集成目的的API。它允许您创建您的潜水员来扩展和定制Clair功能。Clair有几个<a class="ae ml" href="https://quay.github.io/clair/reference/indexer.html" rel="noopener ugc nofollow" target="_blank">索引器</a>、<a class="ae ml" href="https://quay.github.io/clair/reference/matcher.html" rel="noopener ugc nofollow" target="_blank">匹配器</a>、<a class="ae ml" href="https://quay.github.io/clair/reference/notifier.html" rel="noopener ugc nofollow" target="_blank">通知器</a>或组合模型。最简单快捷的开始方式是组合模式。这样，它在单个进程中运行。</p><p id="86b1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于组合模式，您需要一个负载平衡器或Kubernetes入口和一个数据库，如上图所示。</p><h1 id="7b60" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">琐碎</h1><p id="4d59" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">Trivy是一款基于CVE威胁数据库的安全集装箱扫描仪。它还可以扫描错误配置、秘密和软件依赖性。Trivy使用几种扫描源，如:</p><ul class=""><li id="2cd2" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">容器图像</li><li id="86ef" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">文件系统和存储</li><li id="c8b3" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">库伯内特星团</li></ul><p id="6905" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用npm、apt-get、brew和其他包管理器，Trivy可以安装在您的PC上或Kubernetes节点中。</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="89da" class="no mn it nk b gy np nq l nr ns">apt-get install trivy</span><span id="4c20" class="no mn it nk b gy nt nq l nr ns">yum install trivy</span><span id="7fd7" class="no mn it nk b gy nt nq l nr ns">brew install aquasecurity/trivy/trivy</span></pre><p id="90ab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要执行图像扫描，您可以执行以下命令</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="5f1a" class="no mn it nk b gy np nq l nr ns">$ trivy image app-backend:1.9-test</span></pre><h1 id="26bf" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">秘密扫描仪</h1><p id="535a" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">主要目标<a class="ae ml" href="https://github.com/deepfence/SecretScanner" rel="noopener ugc nofollow" target="_blank"> Secret Scanner </a>是查看容器映像、作为代码文件的基础设施、硬编码和默认机密的JSON日志文件、密码、AWS访问id、AWS秘密访问密钥、Google OAuth密钥、SSH密钥和令牌。</p><p id="c809" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要独立运行SecretScanner，您应该执行以下操作:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="2431" class="no mn it nk b gy np nq l nr ns">docker run -it — rm — name=deepfence-secretscanner -v $(pwd):/home/deepfence/output -v /var/run/docker.sock:/var/run/docker.sock deepfenceio/deepfence_secret_scanner:latest -image-name node:8.11</span></pre><h1 id="8bb1" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">OpenSCAP</h1><p id="145f" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated"><a class="ae ml" href="https://github.com/OpenSCAP/openscap" rel="noopener ugc nofollow" target="_blank"> OpenSCAP </a>是一个包含复杂安全审计选项的工具。它允许您扫描、编辑和导出SCAP文档。SCAP(安全内容自动化协议)为基于Linux的基础设施提供并描述了安全符合性检查。</p><p id="57c8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Open SCAP由以下组件和工具组成:</p><ul class=""><li id="71e3" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated"><strong class="kw iu"> OpenSCAP Base </strong> —用于漏洞和配置扫描</li><li id="4615" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><strong class="kw iu"> oscap-docker </strong> —用于合规性扫描</li><li id="bf55" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><strong class="kw iu"> SCAP工作台</strong> —一个图形实用程序，便于执行典型的oscap任务</li><li id="2121" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><strong class="kw iu"> OpenSCAP守护进程</strong> —在后台运行的服务</li><li id="e3e0" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><strong class="kw iu">SCAP mony</strong>—为用户的基础设施保留SCAP结果的中间件</li></ul><p id="29f4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面您可以看到一个如何运行SCAP内容验证流程的示例。</p><p id="ec07" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">oscap ds sds-validate scap-ds.xml</p><h1 id="b9fb" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">库贝长凳</h1><p id="55ae" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated"><a class="ae ml" href="https://github.com/aquasecurity/kube-bench" rel="noopener ugc nofollow" target="_blank"> Kube-bench </a>是最强大的开源工具之一，用于检测Kuberenetes集群的威胁和安全问题。其安全检查基于<a class="ae ml" href="https://www.cisecurity.org/benchmark/kubernetes/" rel="noopener ugc nofollow" target="_blank"> CIS Kubernetes基准</a>。</p><p id="ff5a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要配置kube-bench，您可以使用YAML文件。我已经列出了YAML的档案。您可以使用它对单个pod运行验证过程。</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="099f" class="no mn it nk b gy np nq l nr ns">---<br/>apiVersion: batch/v1<br/>kind: Job<br/>metadata:<br/>  name: kube-bench<br/>spec:<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: kube-bench<br/>    spec:<br/>      hostPID: true<br/>      containers:<br/>        - name: kube-bench<br/>          image: docker.io/aquasec/kube-bench:v0.6.8<br/>          command: ["kube-bench"]<br/>          volumeMounts:<br/>            - name: var-lib-etcd<br/>              mountPath: /var/lib/etcd<br/>              readOnly: true<br/>            - name: var-lib-kubelet<br/>              mountPath: /var/lib/kubelet<br/>              readOnly: true<br/>            - name: var-lib-kube-scheduler<br/>              mountPath: /var/lib/kube-scheduler<br/>              readOnly: true<br/>            - name: usr-bin<br/>              mountPath: /usr/local/mount-from-host/bin<br/>              readOnly: true<br/>            - name: etc-cni-netd<br/>              mountPath: /etc/cni/net.d/<br/>              readOnly: true<br/>            - name: opt-cni-bin<br/>              mountPath: /opt/cni/bin/<br/>              readOnly: true<br/>…<br/>      restartPolicy: Never<br/>      volumes:<br/>        - name: var-lib-etcd<br/>          hostPath:<br/>            path: "/var/lib/etcd"<br/>        - name: var-lib-kubelet<br/>          hostPath:<br/>            path: "/var/lib/kubelet"<br/>…</span></pre><p id="7139" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们将这个文档保存到job.yaml文件中，并使用apply命令运行它:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="5c41" class="no mn it nk b gy np nq l nr ns">$ kubectl apply -f job.yaml</span></pre><p id="0598" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我得把文件剪掉一点。你可以在这里找到完整版本<a class="ae ml" href="https://github.com/aquasecurity/kube-bench/blob/main/job.yaml" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="8f1e" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">威胁映射器</h1><p id="154b" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">威胁映射器是针对云原生应用的复杂安全解决方案。它会扫描您的基础架构群集组件，查找威胁和漏洞。它包含:</p><ul class=""><li id="3065" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">秘密扫描</li><li id="597e" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">生成<a class="ae ml" href="https://github.com/opensbom-generator/spdx-sbom-generator" rel="noopener ugc nofollow" target="_blank">软件物料清单</a> (SBOM)</li><li id="2267" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">基础设施安全和威胁可视化</li></ul><p id="fd65" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我们进入工具描述之前，我将给出什么是软件材料清单(SBOM)的概述。</p><p id="b9a5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">SBOM是包含您的应用程序的所有开源和第三方工具和组件的组合。SBOM包含所有组件的许可信息。这些信息对于快速识别安全风险非常重要。</p><p id="7448" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">威胁扫描程序包含以下组件:</p><ul class=""><li id="d53f" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">管理控制台—是一种UI工具，可构建安全基础架构概述并提供漏洞和威胁报告。</li><li id="35de" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">传感器代理—是一种扫描集群节点并收集安全遥测数据的工具。传感器代理向管理控制台报告遥测数据。</li></ul><p id="f1f3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">例如，要将传感器代理安装到AKS集群，您需要执行以下操作:</p><p id="820b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">掌舵回购添加深围栏<a class="ae ml" href="https://deepfence-helm-charts.s3.amazonaws.com/threatmapper" rel="noopener ugc nofollow" target="_blank">https://deepfence-helm-charts.s3.amazonaws.com/threatmapper</a></p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="c62f" class="no mn it nk b gy np nq l nr ns">helm repo add deepfence <a class="ae ml" href="https://deepfence-helm-charts.s3.amazonaws.com/threatmapper" rel="noopener ugc nofollow" target="_blank">https://deepfence-helm-charts.s3.amazonaws.com/threatmapper</a><br/>helm show readme deepfence/deepfence-agent<br/>helm show values deepfence/deepfence-agent<br/> <br/># helm v2<br/>helm install deepfence/deepfence-agent \<br/>    --name=deepfence-agent \<br/>    --set managementConsoleUrl=x.x.x.x \<br/>    --set deepfenceKey=C8TtyEtNB0gBo1wGhpeAZICNSAaGWw71BSdS2kLELY0<br/> <br/># helm v3<br/>helm install deepfence-agent deepfence/deepfence-agent \<br/>    --set managementConsoleUrl=x.x.x.x \<br/>    --set deepfenceKey=C8TtyEtNB0gBo1wGhpeAZICNSAaGWw71BSdS2kLELY0</span></pre><p id="4bb6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要在AKS集群中安装管理控制台，可以使用以下命令:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="ec5b" class="no mn it nk b gy np nq l nr ns">helm repo add deepfence https://deepfence-helm-charts.s3.amazonaws.com/threatmapper</span><span id="c0f3" class="no mn it nk b gy nt nq l nr ns">helm install deepfence-console deepfence/deepfence-console</span></pre><p id="1727" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">安装会将helm软件包直接下载并安装到集群命名空间中。它使用两个简单的命令，允许您将它包含在IaC进程中。</p><h1 id="3fce" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">集装箱的威胁检测</h1><p id="3a94" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">“随着容器采用的指数级增长，对于团队来说，确保适当的安全和威胁管理基础设施<strong class="kw iu">和</strong>实践到位比以往任何时候都更加重要。该参考卡对集装箱化环境的威胁检测进行了全面的检查，涵盖了几个重点领域，如通用云安全架构和Kubernetes强化指南。”</p><p id="0ac4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae ml" href="https://dzone.com/refcardz/threat-detection-for-containers" rel="noopener ugc nofollow" target="_blank">和这张Refcard </a>的核心是容器威胁检测的基础，包括资源限制、静态图像漏洞扫描、配置验证等概念。</p></div></div>    
</body>
</html>