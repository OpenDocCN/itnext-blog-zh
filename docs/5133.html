<html>
<head>
<title>React-static PWA — Tutorial Part III</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">react-静态PWA —教程第三部分</h1>
<blockquote>原文：<a href="https://itnext.io/react-static-pwa-tutorial-part-iii-ed91e0fa1d10?source=collection_archive---------9-----------------------#2020-12-17">https://itnext.io/react-static-pwa-tutorial-part-iii-ed91e0fa1d10?source=collection_archive---------9-----------------------#2020-12-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7ccf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 03反应-静态-PWA </strong></p><p id="a972" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于我们现在有一个应用程序和持续部署，我们希望通过添加PWA功能来改进我们的应用程序。这将增加功能，使我们的网站可以通过浏览器(Chrome、Safari、Firefox等)安装，并像本地应用程序一样使用，有自己的应用程序图标和快捷方式。</p><p id="c585" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<a class="ae kl" href="https://app-bootstrap-tutorial.web.app/" rel="noopener ugc nofollow" target="_blank">app-bootstrap-tutorial . web . app</a>查看当前状态</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/9bddf266c93e9cd5a4c8418d9d8b0552.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FxMQzl9NSEMnpyaec8dWUA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">Android设备上的应用程序</figcaption></figure><h1 id="1dfa" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">基本功能</h1><p id="13e3" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">首先，我们需要一个PWA清单来描述我们的应用程序，并告诉操作系统/浏览器名称、显示行为、图标和其他类似快捷方式的东西。</p><p id="ac24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将在公共目录中创建一个基本的manifest.json。</p><pre class="kn ko kp kq gt mf mg mh mi aw mj bi"><span id="24ae" class="mk ld iq mg b gy ml mm l mn mo">{<br/>    "short_name": "the app",<br/>    "name": "the-app-tutorial",<br/>    "description": "App to display PWA capabilities with react-static and grommet",<br/>    "start_url": "/",<br/>    "background_color": "#000000",<br/>    "display": "standalone",<br/>    "scope": "/",<br/>    "theme_color": "#000000",<br/>    "shortcuts": [],<br/>    "icons": []<br/>  }</span></pre><p id="597e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还需要更新src文件夹中的App.js:</p><pre class="kn ko kp kq gt mf mg mh mi aw mj bi"><span id="3976" class="mk ld iq mg b gy ml mm l mn mo">// replace the following line with the one below<br/>// import { Root, Routes } from "react-static";<br/>import { Head, Root, Routes } from "react-static";</span><span id="c997" class="mk ld iq mg b gy mp mm l mn mo">// ...<br/>function App() {<br/>  return (<br/>    &lt;Root&gt;<br/>        // only add it when we build our app for production<br/>        {process.env.NODE_ENV === "production" &amp;&amp; (<br/>         &lt;Head&gt;<br/>             &lt;link rel="manifest" href="/manifest.json"&gt;&lt;/link&gt;<br/>             &lt;script src="/init-sw.js"&gt;&lt;/script&gt;<br/>        &lt;/Head&gt;<br/>      )}</span><span id="045b" class="mk ld iq mg b gy mp mm l mn mo">// ...</span></pre><p id="6993" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所见，我们还需要创建另一个文件:公共目录中的init-sw.js。</p><pre class="kn ko kp kq gt mf mg mh mi aw mj bi"><span id="e21d" class="mk ld iq mg b gy ml mm l mn mo">if ("serviceWorker" in navigator) {<br/>  window.addEventListener("load", function () {<br/>    // the sw.js will be created by workbox<br/>    navigator.serviceWorker.register("/sw.js");<br/>  });<br/>}</span></pre><p id="69a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还需要将<a class="ae kl" href="https://developers.google.com/web/tools/workbox/" rel="noopener ugc nofollow" target="_blank">工具箱</a>添加到我们的应用程序中，并让它创建我们的服务人员，就像前面提到的代码片段一样。</p><p id="863d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">服务人员将简单地缓存我们的资源，如html页面，以加快页面速度。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mq"><img src="../Images/4da2e9c22b7f0534f313646267e85902.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qgjM2ufb-1D65OR8.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">失效而重新验证缓存策略—图片由<a class="ae kl" href="https://developers.google.com/web/tools/workbox/images/modules/workbox-strategies/stale-while-revalidate.png" rel="noopener ugc nofollow" target="_blank">工具箱</a>提供</figcaption></figure><pre class="kn ko kp kq gt mf mg mh mi aw mj bi"><span id="a654" class="mk ld iq mg b gy ml mm l mn mo">$ npm install --save-dev workbox-cli<br/># or <br/>$ yarn add -D workbox-cli</span></pre><p id="5748" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们需要为workbox创建配置，存储在名为workbox-config.js的根目录中。</p><pre class="kn ko kp kq gt mf mg mh mi aw mj bi"><span id="00d3" class="mk ld iq mg b gy ml mm l mn mo">module.exports = {<br/>  globDirectory: "dist/",<br/>  globPatterns: ["**/*.{html,json,js,txt,xml,css}"],<br/>  swDest: "dist/sw.js",<br/>};</span></pre><p id="d70b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们需要更新package.json中的构建目标:</p><pre class="kn ko kp kq gt mf mg mh mi aw mj bi"><span id="ac32" class="mk ld iq mg b gy ml mm l mn mo">    //...<br/>    // replace<br/>    "build": "react-static build"<br/>    // with<br/>    "build": "react-static build &amp;&amp; workbox generateSW"<br/>    //...</span></pre><p id="99a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您现在用...</p><pre class="kn ko kp kq gt mf mg mh mi aw mj bi"><span id="9c8e" class="mk ld iq mg b gy ml mm l mn mo">$ npm run build<br/># or<br/>$ yarn build</span></pre><p id="ac8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">...它将在您的dist文件夹中生成一个服务人员文件(sw.js)。</p><h1 id="683d" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">赏心悦目</h1><p id="0013" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">到目前为止，我们的应用程序甚至没有一个图标，如果我们已经有了一个图标或图标的想法，那就太好了。</p><p id="f5b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不幸的是，我们需要准备我们的原始图标用于某些操作系统，如Android，并使其可屏蔽。有一个很棒的工具叫做<a class="ae kl" href="https://maskable.app/" rel="noopener ugc nofollow" target="_blank"> maskable.app </a>，其编辑功能位于<a class="ae kl" href="https://maskable.app/editor" rel="noopener ugc nofollow" target="_blank"> Maskable.app编辑器</a>。在那里你可以上传你的图标，并使它符合你的需要。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mr"><img src="../Images/1f19cebfb78e93f4355dde060e5594b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kicuvZ9aUKOWnDO0JWgtYg.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">运行中的Maskable.app编辑器</figcaption></figure><p id="2b70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有了saanitized图标，我们希望它能适用于各种不同的操作系统/浏览器偏好。我使用了文章<a class="ae kl" rel="noopener ugc nofollow" target="_blank" href="/pwa-splash-screen-and-icon-generator-a74ebb8a130"> PWA闪屏和图标生成器</a>中很好介绍的<a class="ae kl" href="https://www.npmjs.com/package/pwa-asset-generator" rel="noopener ugc nofollow" target="_blank"> pwa-asset-generator </a>。</p><p id="085a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的公共目录中，我们创建了一个icons文件夹，其中包含我们的可屏蔽图标，我将其命名为app_icon.png。</p><pre class="kn ko kp kq gt mf mg mh mi aw mj bi"><span id="315e" class="mk ld iq mg b gy ml mm l mn mo">$ cd public<br/>$ npx pwa-asset-generator ./icons/app_icon.png ./icons --background "#fff" --scrape false<br/>getSplashScreenMetaData Skipped scraping - using static data<br/>saveImages Initialising puppeteer to take screenshots 🤖<br/>getShellHtml Generating shell html with provided image source<br/>getShellHtml Providing shell html as page content<br/>saveImages Saved image apple-splash-2048-2732 🙌<br/>saveImages Saved image apple-splash-2160-1620 🙌<br/>saveImages Saved image apple-splash-1792-828 🙌<br/>saveImages Saved image apple-splash-828-1792 🙌<br/>saveImages Saved image apple-splash-1284-2778 🙌<br/>saveImages Saved image apple-splash-2732-2048 🙌<br/>saveImages Saved image apple-splash-1668-2388 🙌<br/>saveImages Saved image apple-splash-1242-2208 🙌<br/>saveImages Saved image apple-splash-2532-1170 🙌<br/>saveImages Saved image apple-splash-750-1334 🙌<br/>saveImages Saved image apple-splash-2224-1668 🙌<br/>saveImages Saved image manifest-icon-192 🙌<br/>saveImages Saved image apple-splash-2688-1242 🙌<br/>saveImages Saved image apple-splash-1334-750 🙌<br/>saveImages Saved image apple-splash-1620-2160 🙌<br/>saveImages Saved image apple-splash-1536-2048 🙌<br/>saveImages Saved image manifest-icon-512 🙌<br/>saveImages Saved image apple-splash-1242-2688 🙌<br/>saveImages Saved image apple-icon-180 🙌<br/>saveImages Saved image apple-splash-1668-2224 🙌<br/>saveImages Saved image apple-splash-1170-2532 🙌<br/>saveImages Saved image apple-splash-1136-640 🙌<br/>saveImages Saved image apple-splash-640-1136 🙌<br/>saveImages Saved image apple-splash-2778-1284 🙌<br/>saveImages Saved image apple-splash-2048-1536 🙌<br/>saveImages Saved image apple-splash-2208-1242 🙌<br/>saveImages Saved image apple-splash-2436-1125 🙌<br/>saveImages Saved image apple-splash-1125-2436 🙌<br/>saveImages Saved image apple-splash-2388-1668 🙌<br/>cli Web App Manifest file is not specified, printing out the content to console instead 🤔<br/>cli Below is the icons content for your manifest.json file. You can copy/paste it manually 🙌</span><span id="8ce2" class="mk ld iq mg b gy mp mm l mn mo">[<br/>  {<br/>    "src": "/icons/manifest-icon-192.png",<br/>    "sizes": "192x192",<br/>    "type": "image/png",<br/>    "purpose": "maskable any"<br/>  },<br/>  {<br/>    "src": "/icons/manifest-icon-512.png",<br/>    "sizes": "512x512",<br/>    "type": "image/png",<br/>    "purpose": "maskable any"<br/>  }<br/>]</span><span id="b247" class="mk ld iq mg b gy mp mm l mn mo">cli Index html file is not specified, printing out the content to console instead 🤔<br/>cli Below is the iOS meta tags content for your index.html file. You can copy/paste it manually 🙌</span><span id="bf15" class="mk ld iq mg b gy mp mm l mn mo">&lt;link rel="apple-touch-icon" href="/icons/apple-icon-180.png" /&gt;</span><span id="1048" class="mk ld iq mg b gy mp mm l mn mo">&lt;meta name="apple-mobile-web-app-capable" content="yes" /&gt;</span><span id="6882" class="mk ld iq mg b gy mp mm l mn mo">&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-2048-2732.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-2732-2048.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-1668-2388.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-2388-1668.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-1536-2048.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-2048-1536.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-1668-2224.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-2224-1668.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-1620-2160.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-2160-1620.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-1284-2778.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-2778-1284.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-1170-2532.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-2532-1170.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-1125-2436.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-2436-1125.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-1242-2688.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-2688-1242.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-828-1792.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-1792-828.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-1242-2208.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-2208-1242.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-750-1334.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-1334-750.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-640-1136.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" /&gt;<br/>&lt;link rel="apple-touch-startup-image" href="/icons/apple-splash-1136-640.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" /&gt;</span></pre><p id="4493" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我们所看到的，它成功地生成了各种大小的图标，并生成了要插入manifest.json和App.js的代码。您可以直接在Github上签出包含所有必要更改的代码。</p><h2 id="f4cf" class="mk ld iq bd le ms mt dn li mu mv dp lm jy mw mx lq kc my mz lu kg na nb ly nc bi translated">密码</h2><p id="8929" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">代码可以在Github<a class="ae kl" href="https://github.com/chrkaatz/static-app-tutorial" rel="noopener ugc nofollow" target="_blank">https://github.com/chrkaatz/static-app-tutorial</a>找到，每个教程步骤都有各自的提交和标签与之关联。这个贴着<a class="ae kl" href="https://github.com/chrkaatz/static-app-tutorial/releases/tag/03-React-Static-PWA" rel="noopener ugc nofollow" target="_blank">03-反应-静态-PWA </a>的标签。</p><h2 id="8dea" class="mk ld iq bd le ms mt dn li mu mv dp lm jy mw mx lq kc my mz lu kg na nb ly nc bi translated">辅导的</h2><ol class=""><li id="e9e4" class="nd ne iq jp b jq ma ju mb jy nf kc ng kg nh kk ni nj nk nl bi translated"><a class="ae kl" href="https://chrkaatz.medium.com/bootstrap-your-app-with-react-static-and-grommet-fac9c137cc31?source=friends_link&amp;sk=32ee9122d2d5e919792826be3a2bdbf8" rel="noopener">第一部分——用react-static和grommet引导您的应用程序</a></li><li id="a3ab" class="nd ne iq jp b jq nm ju nn jy no kc np kg nq kk ni nj nk nl bi translated"><a class="ae kl" href="https://github.com/chrkaatz/static-app-tutorial/releases/tag/03-React-Static-PWA" rel="noopener ugc nofollow" target="_blank">第二部分—React-静态应用部署和CI </a></li><li id="bac6" class="nd ne iq jp b jq nm ju nn jy no kc np kg nq kk ni nj nk nl bi translated"><a class="ae kl" href="https://chrkaatz.medium.com/react-static-pwa-tutorial-part-iii-ed91e0fa1d10" rel="noopener"> <strong class="jp ir">第三部分—反应-静态PWA </strong> </a></li><li id="85eb" class="nd ne iq jp b jq nm ju nn jy no kc np kg nq kk ni nj nk nl bi translated"><a class="ae kl" href="https://chrkaatz.medium.com/react-static-app-testing-with-cypress-tutorial-part-iv-ad1ad4612fc1" rel="noopener">第四部分——使用Cypress进行反应静态app测试</a></li></ol></div></div>    
</body>
</html>