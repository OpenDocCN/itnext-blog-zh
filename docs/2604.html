<html>
<head>
<title>Kubernetes Ingress-Nginx Troubleshooting made Easy with kubectl plugins</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">kubernetes Ingress——ku bectl插件简化了Nginx故障排除</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-ingress-nginx-troubleshooting-made-easy-with-kubectl-plugins-dbc8fdff35fd?source=collection_archive---------0-----------------------#2019-06-23">https://itnext.io/kubernetes-ingress-nginx-troubleshooting-made-easy-with-kubectl-plugins-dbc8fdff35fd?source=collection_archive---------0-----------------------#2019-06-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="8e2f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">随着部署规模越来越大，网络问题越来越难解决。</p><p id="5b3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本指南将提供使用<em class="kl"> ingress-nginx </em> kubectl插件通过ingress控制器调试应用程序访问的基本信息。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/7a408ccca7850335301073745988db90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6dos1e9cp8hqBGzV"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">由<a class="ae lc" href="https://unsplash.com/@borisworkshop?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">鲍里斯·斯莫克罗维奇</a>在<a class="ae lc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="c691" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从Kubernetes 1.12开始，可以为kubectl编写定制插件。ingress社区，具体来说是<a class="ae lc" href="https://github.com/alexkursell" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> alexkursell </strong> </a>在创建一个插件来帮助我们轻松调试Ingress问题方面做了大量工作。</p><p id="ef17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本教程中，我们将使用<em class="kl"> minikube </em>，但是所有的故障排除示例都可以在任何具有<em class="kl"> ingress-nginx </em>部署(0.23.0+)的Kubernetes集群(1.12+)上执行。</p><h2 id="bb98" class="ld le iq bd lf lg lh dn li lj lk dp ll jy lm ln lo kc lp lq lr kg ls lt lu lv bi translated">要求</h2><p id="123d" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">为了开始使用本指南，必须安装以下软件:</p><ul class=""><li id="3d61" class="mb mc iq jp b jq jr ju jv jy md kc me kg mf kk mg mh mi mj bi translated"><a class="ae lc" href="https://www.virtualbox.org/wiki/Downloads" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> VirtualBox </strong> </a></li><li id="0b43" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated"><a class="ae lc" href="https://kubernetes.io/docs/tasks/tools/install-minikube/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Minikube </strong> </a></li><li id="9a7c" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated"><a class="ae lc" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/#install-kubectl" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Kubectl </strong> </a></li><li id="79e4" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated"><strong class="jp ir">必须在BIOS中启用VT-x/AMD-v虚拟化</strong></li><li id="ac0d" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated"><strong class="jp ir">首次运行时的互联网连接</strong></li></ul><p id="317d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注:如果你是第一次使用<em class="kl"> ingress-nginx </em>控制器，我推荐查看我的教程<a class="ae lc" href="https://medium.com/@awkwardferny/getting-started-with-kubernetes-ingress-nginx-on-minikube-d75e58f52b6c" rel="noopener"><strong class="jp ir">Minikube</strong></a>上的Kubernetes Ingress-Nginx入门。</p><h2 id="2714" class="ld le iq bd lf lg lh dn li lj lk dp ll jy lm ln lo kc lp lq lr kg ls lt lu lv bi translated">装置</h2><p id="f185" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated"><em class="kl"> ingress-nginx </em>插件可以通过<strong class="jp ir"> <em class="kl"> krew </em> </strong>安装，这是一个kubectl插件依赖管理器。为了安装<em class="kl">扳手</em>，只需遵循<a class="ae lc" href="https://github.com/kubernetes-sigs/krew" rel="noopener ugc nofollow" target="_blank">https://github.com/kubernetes-sigs/krew</a>中提供的安装指南。</p><p id="44a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦您安装了<em class="kl"> krew </em>，您就可以通过执行以下操作来获取信息并安装<strong class="jp ir"><em class="kl">ingress-nginx</em></strong>插件:</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="54bf" class="ld le iq mq b gy mu mv l mw mx"><strong class="mq ir">$ kubectl krew info ingress-nginx</strong></span><span id="8e56" class="ld le iq mq b gy my mv l mw mx">NAME: ingress-nginx<br/>URI: <a class="ae lc" href="https://github.com/kubernetes/ingress-nginx/releases/download/nginx-0.24.0/kubectl-ingress_nginx-darwin-amd64.tar.gz" rel="noopener ugc nofollow" target="_blank">https://github.com/kubernetes/ingress-nginx/releases/download/nginx-0.24.0/kubectl-ingress_nginx-darwin-amd64.tar.gz</a><br/>SHA256: 34e999ddc4e1926bbd7f4bdbb5fc40d6c3a5b2ffd711131e4f62e2d24cb2a179<br/>DESCRIPTION:<br/>The official kubectl plugin for ingress-nginx.</span><span id="d4b1" class="ld le iq mq b gy my mv l mw mx">VERSION: 0.24.0</span><span id="1e19" class="ld le iq mq b gy my mv l mw mx"><strong class="mq ir">$ kubectl krew install ingress-nginx</strong></span><span id="ee33" class="ld le iq mq b gy my mv l mw mx">Updated the local copy of plugin index.<br/>Installing plugin: ingress-nginx<br/>Installed plugin: ingress-nginx</span></pre><p id="0511" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更多关于<em class="kl"> krew </em>和kubectl插件的一般信息，请查看<a class="ae lc" href="https://youtu.be/83ITOTsXsHU" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">为所有人编写kubectl插件:开发、打包和分发</strong> </a> <strong class="jp ir"> </strong>来自KubeCon Europe 2019。</p><h2 id="7dc5" class="ld le iq bd lf lg lh dn li lj lk dp ll jy lm ln lo kc lp lq lr kg ls lt lu lv bi translated">使用</h2><p id="4c40" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">首先，您必须创建一个<em class="kl"> minikube </em>集群并启用入口控制器。我们还可以验证是否生成了<em class="kl"> ingress-nginx </em> pods。</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="b4d8" class="ld le iq mq b gy mu mv l mw mx"><strong class="mq ir">$ minikube start</strong></span><span id="f1b3" class="ld le iq mq b gy my mv l mw mx">😄  minikube v1.0.1 on darwin (amd64)<br/>🤹  Downloading Kubernetes v1.14.1 images in the background ...<br/>🔥  Creating virtualbox VM (CPUs=2, Memory=2048MB, Disk=20000MB) ...<br/>📶  "minikube" IP address is 192.168.99.100<br/>🐳  Configuring Docker as the container runtime ...<br/>🐳  Version of container runtime is 18.06.3-ce<br/>⌛  Waiting for image downloads to complete ...<br/>✨  Preparing Kubernetes environment ...<br/>🚜  Pulling images required by Kubernetes v1.14.1 ...<br/>🚀  Launching Kubernetes v1.14.1 using kubeadm ...<br/>⌛  Waiting for pods: apiserver proxy etcd scheduler controller dns<br/>🔑  Configuring cluster permissions ...<br/>🤔  Verifying component health .....<br/>💗  kubectl is now configured to use "minikube"<br/>🏄  Done! Thank you for using minikube!</span><span id="f919" class="ld le iq mq b gy my mv l mw mx"><strong class="mq ir">$ minikube addons enable ingress</strong></span><span id="e1e2" class="ld le iq mq b gy my mv l mw mx">✅  ingress was successfully enabled</span><span id="fe0b" class="ld le iq mq b gy my mv l mw mx"><strong class="mq ir">$ kubectl get pods -n kube-system | grep ingress</strong></span><span id="b65b" class="ld le iq mq b gy my mv l mw mx">nginx-ingress-controller-586cdc477c-74vlb   1/1     Running   0          97s</span></pre><p id="839a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们可以通过直接从kubectl运行<em class="kl"> ingress-nginx </em>命令来排除故障。</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="4ef2" class="ld le iq mq b gy mu mv l mw mx"><strong class="mq ir">$ kubectl ingress-nginx --help</strong></span><span id="a638" class="ld le iq mq b gy my mv l mw mx">....<br/>Available Commands:<br/>backends  Inspect the dynamic backend information of an ingress-nginx instance<br/>certs     Output the certificate data stored in an ingress-nginx pod<br/>conf      Inspect the generated nginx.conf<br/>exec      Execute a command inside an ingress-nginx pod<br/>general   Inspect the other dynamic ingress-nginx information<br/>help      Help about any command<br/>info      Show information about the ingress-nginx service<br/>ingresses Provide a short summary of all of the ingress definitions<br/>lint      Inspect kubernetes resources for possible issues<br/>logs      Get the kubernetes logs for an ingress-nginx pod<br/>ssh       ssh into a running ingress-nginx pod<br/>...</span></pre><h2 id="fcb6" class="ld le iq bd lf lg lh dn li lj lk dp ll jy lm ln lo kc lp lq lr kg ls lt lu lv bi translated">添加用于测试的入口资源</h2><p id="e7a1" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">让我们快速创建一个在本教程中使用的应用程序、服务和入口。</p><p id="7689" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">部署应用</strong></p><p id="137d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们使用部署来部署我们的应用程序单元(容器)。关于部署的更多信息可以在<a class="ae lc" href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="fb81" class="ld le iq mq b gy mu mv l mw mx"><strong class="mq ir">$ echo "<br/>apiVersion: extensions/v1beta1<br/>kind: Deployment<br/>metadata:<br/>  name: meow<br/>spec:<br/>  replicas: 2<br/>  selector:<br/>    matchLabels:<br/>      app: meow<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: meow<br/>    spec:<br/>      containers:<br/>      - name: meow<br/>        image: gcr.io/kubernetes-e2e-test-images/echoserver:2.1<br/>        ports:<br/>        - containerPort: 8080<br/>" | kubectl apply -f -</strong></span><span id="f90a" class="ld le iq mq b gy my mv l mw mx">deployment.extensions/meow created</span></pre><p id="af7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">通过服务公开pod</strong></p><p id="4ce3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里，我们在集群的内部IP上公开应用程序。更多关于服务的信息，请看这里。</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="099e" class="ld le iq mq b gy mu mv l mw mx"><strong class="mq ir">$ echo "<br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: meow-svc<br/>spec:<br/>  ports:<br/>  - port: 80<br/>    targetPort: 8080<br/>    protocol: TCP<br/>    name: http<br/>  selector:<br/>    app: meow<br/>" | kubectl apply -f -</strong></span><span id="a77e" class="ld le iq mq b gy my mv l mw mx">service/meow-svc created</span></pre><p id="a35b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">创建入口资源</strong></p><p id="39bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这允许我们通过<em class="kl"> /meow </em>路径访问服务<em class="kl"> meow-svc </em>。由于我们使用的是minikube，<em class="kl">cats.com</em>是我们的虚拟主机，所以我们必须通过<em class="kl">主机</em>头来访问应用程序。</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="0ec1" class="ld le iq mq b gy mu mv l mw mx"><strong class="mq ir">$ echo "<br/>apiVersion: extensions/v1beta1<br/>kind: Ingress<br/>metadata:<br/>  name: meow-ingress<br/>  namespace: default<br/>spec:<br/>  rules:<br/>  - host: cats.com<br/>    http:<br/>      paths:<br/>      - backend:<br/>          serviceName: meow-svc<br/>          servicePort: 80<br/>        path: /meow<br/>" | kubectl apply -f -</strong></span><span id="f540" class="ld le iq mq b gy my mv l mw mx">ingress.extensions/meow-ingress created</span><span id="7c6d" class="ld le iq mq b gy my mv l mw mx"><strong class="mq ir">$ curl $(minikube ip)/meow -H "host: cats.com"</strong></span><span id="1bdb" class="ld le iq mq b gy my mv l mw mx">....<br/>Request Information:<br/>client_address=172.17.0.7<br/>method=GET<br/>real path=/meow<br/>query=<br/>request_version=1.1<br/>request_scheme=http<br/>request_uri=http://cats.com:8080/meow<br/>....</span></pre></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><h1 id="1669" class="ng le iq bd lf nh ni nj li nk nl nm ll nn no np lo nq nr ns lr nt nu nv lu nw bi translated">排除故障</h1><p id="d858" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">现在让我们开始一些调试工作🐛。我们可以采取一些步骤来解决常见的入侵问题。</p><h2 id="91c4" class="ld le iq bd lf lg lh dn li lj lk dp ll jy lm ln lo kc lp lq lr kg ls lt lu lv bi translated">验证部署、进入和后端</h2><p id="3270" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">通过验证部署、进入和后端，我们可以看到我们实际上是否设置正确。</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="9539" class="ld le iq mq b gy mu mv l mw mx"><strong class="mq ir">$ kubectl ingress-nginx ingresses -n default</strong></span><span id="5564" class="ld le iq mq b gy my mv l mw mx">INGRESS_NAME HOST+PATH ADDRESSES TLS SERVICE SERVICE_PORT ENDPOINTS<br/>meow-ingress  cats.com/meow  10.0.2.15  NO  meow-svc  80  2</span><span id="de77" class="ld le iq mq b gy my mv l mw mx"><strong class="mq ir">$ kubectl ingress-nginx backends -n kube-system --list</strong></span><span id="9d58" class="ld le iq mq b gy my mv l mw mx">default-meow-svc-80<br/>upstream-default-backend</span><span id="cf1a" class="ld le iq mq b gy my mv l mw mx"><strong class="mq ir">$ kubectl ingress-nginx backends -n kube-system --backend upstream-default-meow-svc-80</strong></span><span id="46dc" class="ld le iq mq b gy my mv l mw mx">{<br/>  "endpoints": [<br/>    {<br/>      "address": "172.17.0.8",<br/>      "port": "8080"<br/>    },<br/>    {<br/>      "address": "172.17.0.9",<br/>      "port": "8080"<br/>    }<br/>  ],<br/>  "name": "default-meow-svc-80",<br/>  "noServer": false,<br/>  "port": 80,<br/>  ....</span><span id="5d60" class="ld le iq mq b gy my mv l mw mx"><strong class="mq ir">$ kubectl ingress-nginx lint -n default</strong></span><span id="f1fc" class="ld le iq mq b gy my mv l mw mx">Checking ingresses...<br/>Checking deployments...</span></pre><p id="8e3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，通过检查入口资源，我们可以看到我们是否正确地配置了入口。我们还可以验证特定的后端配置是否正确。</p><p id="2426" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们可以执行lint，检查是否存在任何潜在的配置问题。</p><p id="7d23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:</strong>对于后端命令，如果您的ingress-nginx部署未命名为<em class="kl"> nginx-ingress-controller，您将需要传递名称空间以及<strong class="jp ir"> - <em class="kl">部署</em> </strong>标志。</em></p><h2 id="ef30" class="ld le iq bd lf lg lh dn li lj lk dp ll jy lm ln lo kc lp lq lr kg ls lt lu lv bi translated">检查日志</h2><p id="7575" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">如果存在特定问题，并且我们知道服务和入口资源配置正确，我们应该继续查看日志。日志将给出处理入口资源问题的细节。</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="5d62" class="ld le iq mq b gy mu mv l mw mx"><strong class="mq ir">$ curl $(minikube ip)/meow -H "host: cats.com"</strong></span><span id="ea5f" class="ld le iq mq b gy my mv l mw mx">....<br/>Request Information:<br/>client_address=172.17.0.7<br/>method=GET<br/>real path=/meow<br/>query=<br/>request_version=1.1<br/>request_scheme=http<br/>request_uri=http://cats.com:8080/meow<br/>....</span><span id="2165" class="ld le iq mq b gy my mv l mw mx"><strong class="mq ir">$ kubectl ingress-nginx logs -n kube-system</strong></span><span id="6d5d" class="ld le iq mq b gy my mv l mw mx">....<br/>I0623 04:49:34.058860       6 controller.go:172] Configuration changes detected, backend reload required.</span><span id="0812" class="ld le iq mq b gy my mv l mw mx">I0623 04:49:34.061302       6 event.go:221] Event(v1.ObjectReference{Kind:"Ingress", Namespace:"default", Name:"meow-ingress", UID:"4bb59ae1-9572-11e9-b459-080027ab110d", APIVersion:"extensions/v1beta1", ResourceVersion:"1333", FieldPath:""}): type: 'Normal' reason: 'CREATE' Ingress default/meow-ingress</span><span id="08fb" class="ld le iq mq b gy my mv l mw mx">I0623 04:49:34.226892       6 controller.go:190] Backend successfully reloaded.</span><span id="f8b0" class="ld le iq mq b gy my mv l mw mx">I0623 04:50:01.122763       6 status.go:388] updating Ingress default/meow-ingress status from [] to [{10.0.2.15 }]</span><span id="0f65" class="ld le iq mq b gy my mv l mw mx">192.168.99.1 - [192.168.99.1] - - [23/Jun/2019:05:13:17 +0000] "GET /meow HTTP/1.1" 200 638 "-" "curl/7.54.0" 76 0.001 [default-meow-svc-80] 172.17.0.8:8080 638 0.001 200 176c54287bf24c650c132e6ff3b7aed8</span></pre><p id="32b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这基本上与检查<em class="kl">入口-nginx </em>吊舱输出的日志功能相同。</p><p id="3155" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们发送一个curl，然后检查日志，看看是否一切正常。正如您所看到的，有关于后端成功加载的信息，以及curl通过的信息。我们可以使用这些日志来确保我们的入口被正确加载，以及查看流量是否通过。</p><h2 id="3a77" class="ld le iq bd lf lg lh dn li lj lk dp ll jy lm ln lo kc lp lq lr kg ls lt lu lv bi translated">检查NGINX配置</h2><p id="5725" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我们可以检查nginx配置，看看是否所有的指令和路径都配置正确。我们可以使用<a class="ae lc" href="http://nginx.org/en/docs/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> nginx文档</strong> </a>来看看指令和变量是做什么的。</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="794b" class="ld le iq mq b gy mu mv l mw mx"><strong class="mq ir">$ kubectl ingress-nginx conf -n kube-system</strong></span><span id="ba2c" class="ld le iq mq b gy my mv l mw mx"># Configuration checksum: 4909015860030157750<br/># setup custom paths that do not require root access<br/>pid /tmp/nginx.pid;<br/>load_module /etc/nginx/modules/ngx_http_modsecurity_module.so;<br/>daemon off;<br/>worker_processes 2;<br/>worker_rlimit_nofile 523264;<br/>worker_shutdown_timeout 10s ;<br/>....</span><span id="3caa" class="ld le iq mq b gy my mv l mw mx"><strong class="mq ir">$ kubectl ingress-nginx conf -n kube-system --host cats.com</strong></span><span id="8d00" class="ld le iq mq b gy my mv l mw mx">server {<br/>  server_name cats.com ;<br/>  listen 80;<br/>  set $proxy_upstream_name "-";<br/>  location /meow {<br/>    set $namespace      "default";<br/>    set $ingress_name   "meow-ingress";<br/>    set $service_name   "meow-svc";<br/>    set $service_port   "80";<br/>    set $location_path  "/meow";<br/>  rewrite_by_lua_block {<br/>    balancer.rewrite()<br/>  }<br/>  header_filter_by_lua_block {}<br/>  body_filter_by_lua_block {}<br/>  log_by_lua_block {<br/>    balancer.log()<br/>    monitor.call()<br/>  }<br/>  port_in_redirect off;<br/>  set $proxy_upstream_name    "default-meow-svc-80";<br/>  set $proxy_host             $proxy_upstream_name;<br/>  client_max_body_size                    1m;<br/>  ....</span></pre><h2 id="3450" class="ld le iq bd lf lg lh dn li lj lk dp ll jy lm ln lo kc lp lq lr kg ls lt lu lv bi translated">使用入口控制器盒运行命令</h2><p id="edd9" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">如果我们希望解决任何具体问题，我们总是可以在pod中运行命令。</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="82c6" class="ld le iq mq b gy mu mv l mw mx"><strong class="mq ir">$ kubectl ingress-nginx exec -n kube-system -- curl http://127.0.0.1/meow -H "host: cats.com"</strong></span><span id="d34b" class="ld le iq mq b gy my mv l mw mx">....<br/>Server values:<br/>server_version=nginx: 1.12.2 - lua: 10010<br/>Request Information:<br/>client_address=172.17.0.7<br/>method=GET<br/>real path=/meow<br/>query=<br/>request_version=1.1<br/>request_scheme=http<br/>request_uri=http://cats.com:8080/meow<br/>....</span></pre><p id="8a2a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这与<em class="kl">执行</em>到<em class="kl">入口-nginx </em>吊舱的功能基本相同。上面你可以看到，我们正在测试我们的应用程序是否可以从我们的入口pod访问。</p></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><p id="07a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读，希望你喜欢！😸</p><p id="8982" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要了解更多关于<em class="kl"> ingress-nginx </em> kubectl插件的信息，你可以查看它的<a class="ae lc" href="https://kubernetes.github.io/ingress-nginx/kubectl-plugin/" rel="noopener ugc nofollow" target="_blank">官方文档</a>。</p><p id="337d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要了解更多关于解决入口问题的信息，你可以查看丹尼尔·马丁斯的【痛苦(较少)NGINX入口】一文。这是一篇写得非常好的文章。</p></div></div>    
</body>
</html>