<html>
<head>
<title>PHP Microservice Framework Swoft: Use Database Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PHP微服务框架Swoft:使用数据库第1部分</h1>
<blockquote>原文：<a href="https://itnext.io/php-microservice-framework-swoft-use-database-part-1-137cb861e30a?source=collection_archive---------2-----------------------#2019-10-22">https://itnext.io/php-microservice-framework-swoft-use-database-part-1-137cb861e30a?source=collection_archive---------2-----------------------#2019-10-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3e94a6f3f07f36a5f3b09b8b40486574.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7R6OP5qvnrZvJKfUc1Vq5A.jpeg"/></div></div></figure><p id="50c1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们要学习的这篇文章是:如何安装和运行Swoft数据库。</p><blockquote class="kw kx ky"><p id="c840" class="jy jz kz ka b kb kc kd ke kf kg kh ki la kk kl km lb ko kp kq lc ks kt ku kv ij bi translated"><em class="iq">本文是关于Swoft数据库ORM的系列文章之一。来了解一下Swoft吧！</em></p></blockquote><h1 id="4ee1" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">什么是Swoft？</h1><p id="7d91" class="pw-post-body-paragraph jy jz iq ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">Swoft是一个PHP高性能微服务协程框架。已经出版多年，已经成为php的不二之选。它可以像Go一样，内置协同web服务器和通用协同客户端，驻留在内存中，独立于传统的PHP-FPM。还有类似的Go语言操作，类似于Spring Cloud框架的灵活注解。</p><p id="b91f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Swoft通过三年的积累和方向探索，将Swoft打造成PHP界的春天云，是PHP高性能框架和微服务管理的不二之选。</p><h1 id="10ea" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">开源代码库</h1><div class="mg mh gp gr mi mj"><a href="https://github.com/swoft-cloud/swoft" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd ir gy z fp mo fr fs mp fu fw ip bi translated">软件云/软件</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">PHP微服务协程框架Swoft是一个基于Swoole扩展的PHP微服务协程框架…</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">github.com</p></div></div><div class="ms l"><div class="mt l mu mv mw ms mx jw mj"/></div></div></a></div><h1 id="bbe4" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">安装</h1><p id="1e04" class="pw-post-body-paragraph jy jz iq ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">这里我们使用composer来安装db组件</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="4c9b" class="nh le iq nd b gy ni nj l nk nl">composer require swoft/db</span></pre><p id="96aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Swoft数据库基于PDO扩展驱动，请确保有mysqld和PDO扩展。</p><h1 id="7385" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">配置</h1><p id="8c8f" class="pw-post-body-paragraph jy jz iq ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">数据库的配置放在<code class="fe nm nn no nd b">app\bean.php</code>文件中，您可以将配置的db看作一个<code class="fe nm nn no nd b">bean</code>对象。</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="cecd" class="nh le iq nd b gy ni nj l nk nl">return [<br/>    'db'         =&gt; [<br/>       'class'     =&gt; Database::class,<br/>       'dsn'       =&gt; 'mysql:dbname=test;host=127.0.0.1',<br/>       'username'  =&gt; 'root',<br/>       'password'  =&gt; '123456',<br/>       'charset'   =&gt; 'utf8mb4',<br/>    ],<br/>];</span></pre><p id="a773" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">配置类似于<code class="fe nm nn no nd b">yii2</code>对象属性注入方法的配置，可以用<code class="fe nm nn no nd b">\bean('db')</code>得到当前配置的<code class="fe nm nn no nd b">Database</code>对象</p><ul class=""><li id="469f" class="np nq iq ka b kb kc kf kg kj nr kn ns kr nt kv nu nv nw nx bi translated"><code class="fe nm nn no nd b">class</code>指定用于当前bean容器的类。当然，您也可以指定自己的数据库类实现。</li><li id="a42e" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv nu nv nw nx bi translated"><code class="fe nm nn no nd b">dsn</code>PDO需要使用的连接配置信息</li><li id="d6c5" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv nu nv nw nx bi translated"><code class="fe nm nn no nd b">username</code>数据登录用户名</li><li id="2ce5" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv nu nv nw nx bi translated"><code class="fe nm nn no nd b">password</code>数据库登录密码</li><li id="442b" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv nu nv nw nx bi translated"><code class="fe nm nn no nd b">charset</code>数据库字符集</li></ul><p id="4de3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果要配置主从/集群，请参考<a class="ae od" href="https://www.swoft.org/docs/2.x/en/db/setting.html" rel="noopener ugc nofollow" target="_blank"> Swoft数据库D </a> oc</p><h1 id="7313" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">简单易用</h1><h1 id="5f31" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">挑选</h1><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="f3f5" class="nh le iq nd b gy ni nj l nk nl">/**<br/> * @Controller()<br/> */<br/>class UserController {<br/><br/>    /**<br/>     * Displays a list of all users of the application<br/>     *<br/>     * @RequestMapping()<br/>     * @return array<br/>     */<br/>    public function index()<br/>    {<br/>        $users = DB::select('select * from users where active = ?', [1]);<br/><br/>        return (array)users;<br/>    }<br/>}</span></pre><p id="e49f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe nm nn no nd b">select</code>方法总是会返回一个数组，数组中的每个结果都是一个数组，结果值可以这样访问:</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="9a9b" class="nh le iq nd b gy ni nj l nk nl">foreach ($users as $user) {<br/>    echo $user['name'];<br/>}</span></pre><h1 id="3759" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">交易</h1><p id="19b4" class="pw-post-body-paragraph jy jz iq ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">您可以使用DB的transaction方法在数据库事务中运行一组操作。如果在事务关闭时发生异常，事务将被回滚。如果事务关闭closure执行成功，事务将被自动提交。一旦使用了事务，您就不再需要担心手动回滚或提交问题:</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="148f" class="nh le iq nd b gy ni nj l nk nl">DB::transaction(function () {<br/>    DB::table('users')-&gt;update(['status' =&gt; 1]);</span><span id="4a23" class="nh le iq nd b gy oe nj l nk nl">    DB::table('posts')-&gt;delete();<br/>});</span></pre><h1 id="86bc" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">开源代码库</h1><div class="mg mh gp gr mi mj"><a href="https://github.com/swoft-cloud/swoft" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd ir gy z fp mo fr fs mp fu fw ip bi translated">软件云/软件</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">PHP微服务协程框架Swoft是一个基于Swoole扩展的PHP微服务协程框架…</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">github.com</p></div></div><div class="ms l"><div class="mt l mu mv mw ms mx jw mj"/></div></div></a></div></div></div>    
</body>
</html>