<html>
<head>
<title>The Flatten Maven plugin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">扁平化Maven插件</h1>
<blockquote>原文：<a href="https://itnext.io/maven-flatten-plugin-7cd464065b74?source=collection_archive---------6-----------------------#2022-01-30">https://itnext.io/maven-flatten-plugin-7cd464065b74?source=collection_archive---------6-----------------------#2022-01-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/2c697a2a5012bd68a241085d980add32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7KUdsYN8-FbZNBIjtW0Ilw.jpeg"/></div></div></figure><p id="ff4f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一位Apache Maven提交者最近写了关于Maven 5 的计划。我认为以下是最重要的变化之一:</p><blockquote class="kx ky kz"><p id="1b4d" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated"><em class="iq">总之，我们需要区分两种POM类型:</em></p><p id="edaa" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated"><em class="iq"> *存储在项目源代码控制中的</em>构建<em class="iq"> POM，它在构建时使用v5模式，要求新的Maven版本能够使用与新模式相关联的新特性，</em></p><p id="31b8" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">* <em class="iq">消费者</em>POM，它在良好的旧v4模式中发布到Maven Central，因此每个过去或未来的构建工具都可以像往常一样使用预构建的工件作为它们的依赖项。</p></blockquote><p id="b3a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一个重要的二分法，我忽略了很长时间:</p><ul class=""><li id="a2e9" class="le lf iq ka b kb kc kf kg kj lg kn lh kr li kv lj lk ll lm bi translated">POM的消费者需要一些数据，<em class="la">例如</em>，在他们的依赖列表中有项目的用户</li><li id="faee" class="le lf iq ka b kb ln kf lo kj lp kn lq kr lr kv lj lk ll lm bi translated">二进制(ies)生成器需要其他数据</li></ul><p id="0738" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还有其他的担忧。例如，变量对于项目开发人员利用DRY是有意义的。对于消费者来说，这是一个额外的间接层，使得理解POM更加困难。</p><p id="2aa4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在Reddit上，用户pmarschall提到他们已经在<a class="ae kw" href="https://www.mojohaus.org/flatten-maven-plugin/" rel="noopener ugc nofollow" target="_blank"> Maven Flatten插件</a>的帮助下分离了Maven当前版本中的关注点。它引起了我的兴趣，我想尝试一下。为此，我使用了Spring宠物诊所项目— commit <a class="ae kw" href="https://github.com/spring-projects/spring-petclinic" rel="noopener ugc nofollow" target="_blank"> a7439c7 </a>。</p><p id="c170" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用法非常简单。只需在<code class="fe ls lt lu lv b">plugins</code>部分添加以下代码片段:</p><pre class="lw lx ly lz gt ma lv mb mc aw md bi"><span id="7180" class="me mf iq lv b gy mg mh l mi mj">&lt;plugin&gt;<br/>    &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;<br/>    &lt;artifactId&gt;flatten-maven-plugin&lt;/artifactId&gt;<br/>    &lt;version&gt;1.2.5&lt;/version&gt;<br/>    &lt;configuration&gt;<br/>    &lt;/configuration&gt;<br/>    &lt;executions&gt;<br/>        &lt;execution&gt;<br/>            &lt;id&gt;flatten&lt;/id&gt;<br/>            &lt;phase&gt;process-resources&lt;/phase&gt;<br/>            &lt;goals&gt;<br/>                &lt;goal&gt;flatten&lt;/goal&gt;<br/>            &lt;/goals&gt;<br/>        &lt;/execution&gt;<br/>        &lt;execution&gt;<br/>            &lt;id&gt;flatten.clean&lt;/id&gt;<br/>            &lt;phase&gt;clean&lt;/phase&gt;<br/>            &lt;goals&gt;<br/>                &lt;goal&gt;clean&lt;/goal&gt;<br/>            &lt;/goals&gt;<br/>        &lt;/execution&gt;<br/>    &lt;/executions&gt;<br/>&lt;/plugin&gt;</span></pre><p id="d1de" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，如果您执行Maven <code class="fe ls lt lu lv b">process-resources</code>阶段，插件将创建一个POM的缩短版本，命名为<code class="fe ls lt lu lv b">.flattened-pom.xml</code>。与初始的POM相比，除了坐标之外，展平的POM只有三个部分:<code class="fe ls lt lu lv b">licenses</code>、<code class="fe ls lt lu lv b">dependencies</code>和<code class="fe ls lt lu lv b">repositories</code>。此外，Maven已经解析了所有变量。如果您运行<code class="fe ls lt lu lv b">install</code>阶段，然后检查您的本地Maven库，您会注意到POM与扁平化的POM匹配，而不是主POM。如果想生成展平的POM，但不想替换主POM，使用<code class="fe ls lt lu lv b">-DupdatePomFile=false</code>。</p><p id="7593" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认情况下，插件只保留了<code class="fe ls lt lu lv b">licenses</code>、<code class="fe ls lt lu lv b">dependencies</code>和<code class="fe ls lt lu lv b">repositories</code>部分。您可以通过POM配置保留和不保留哪些部分。比如插件去掉了<code class="fe ls lt lu lv b">name</code>，但是需要的话可以轻松保留。只需添加相关配置:</p><pre class="lw lx ly lz gt ma lv mb mc aw md bi"><span id="780f" class="me mf iq lv b gy mg mh l mi mj">&lt;configuration&gt;<br/>    &lt;pomElements&gt;<br/>        &lt;name&gt;keep&lt;/name&gt;<br/>    &lt;/pomElements&gt;<br/>&lt;/configuration&gt;</span></pre><p id="8d58" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面的方法给了你最大的灵活性。然而，插件的开发者已经考虑了哪些配置包是有意义的，并提供了开箱即用的配置包。以下是描述它们的文档摘录:</p><ul class=""><li id="6e9b" class="le lf iq ka b kb kc kf kg kj lg kn lh kr li kv lj lk ll lm bi translated"><code class="fe ls lt lu lv b">oss</code>:对于希望保留除<code class="fe ls lt lu lv b">repositories</code>和<code class="fe ls lt lu lv b">pluginRepositories</code>之外的所有<code class="fe ls lt lu lv b">FlattenDescriptor</code>可选POM元素的开源软件项目。</li><li id="a6fc" class="le lf iq ka b kb ln kf lo kj lp kn lq kr lr kv lj lk ll lm bi translated"><code class="fe ls lt lu lv b">ossrh</code>:保留OSS存储库托管所需的所有<code class="fe ls lt lu lv b">FlattenDescriptor</code>可选POM元素。</li><li id="a188" class="le lf iq ka b kb ln kf lo kj lp kn lq kr lr kv lj lk ll lm bi translated"><code class="fe ls lt lu lv b">bom</code>:与<code class="fe ls lt lu lv b">ossrh</code>相似，但增加了<code class="fe ls lt lu lv b">dependencyManagement</code>和<code class="fe ls lt lu lv b">properties</code>。特别是，它将保持dependencyManagement不变，而不解决父影响和导入范围的依赖关系。如果您的POM代表一个BOM，并且您不想按原样部署它(删除父对象和解析版本变量等),这将非常有用。).</li><li id="44c0" class="le lf iq ka b kb ln kf lo kj lp kn lq kr lr kv lj lk ll lm bi translated"><code class="fe ls lt lu lv b">defaults</code>:默认模式，删除除<code class="fe ls lt lu lv b">repositories</code>外的所有<code class="fe ls lt lu lv b">FlattenDescriptor</code>可选POM元素。</li><li id="d979" class="le lf iq ka b kb ln kf lo kj lp kn lq kr lr kv lj lk ll lm bi translated"><code class="fe ls lt lu lv b">clean</code>:删除所有<code class="fe ls lt lu lv b">FlattenDescriptor</code>可选的POM元素。</li><li id="4cf0" class="le lf iq ka b kb ln kf lo kj lp kn lq kr lr kv lj lk ll lm bi translated"><code class="fe ls lt lu lv b">fatjar</code>:删除所有<code class="fe ls lt lu lv b">FlattenDescriptor</code>可选POM元素和所有<code class="fe ls lt lu lv b">dependencies</code>。</li><li id="6a97" class="le lf iq ka b kb ln kf lo kj lp kn lq kr lr kv lj lk ll lm bi translated"><code class="fe ls lt lu lv b">resolveCiFriendliesOnly</code>:仅解析变量revision、sha1和changelist。保留其他所有东西。请参阅Maven CI Friendly了解更多详细信息。</li></ul><h1 id="e70a" class="mk mf iq bd ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng bi translated">结论</h1><p id="5a01" class="pw-post-body-paragraph jy jz iq ka b kb nh kd ke kf ni kh ki kj nj kl km kn nk kp kq kr nl kt ku kv ij bi translated">Maven Flatten插件将构建POM和消费者POM分开。不需要等到Maven 5发布。这是免费的，所以如果你是一个图书馆提供商，你可能应该考虑使用它。</p><p id="289e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">更进一步:</strong></p><ul class=""><li id="d2c2" class="le lf iq ka b kb kc kf kg kj lg kn lh kr li kv lj lk ll lm bi translated"><a class="ae kw" href="https://www.javaadvent.com/2021/12/from-maven-3-to-maven-5.html" rel="noopener ugc nofollow" target="_blank">从Maven 3到Maven 5 </a></li><li id="cc75" class="le lf iq ka b kb ln kf lo kj lp kn lq kr lr kv lj lk ll lm bi translated"><a class="ae kw" href="https://www.mojohaus.org/flatten-maven-plugin/" rel="noopener ugc nofollow" target="_blank">展平Maven插件</a></li><li id="d014" class="le lf iq ka b kb ln kf lo kj lp kn lq kr lr kv lj lk ll lm bi translated"><a class="ae kw" href="https://www.mojohaus.org/flatten-maven-plugin/flatten-mojo.html" rel="noopener ugc nofollow" target="_blank">扁平化Mojo描述和配置</a></li></ul></div><div class="ab cl nm nn hu no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ij ik il im in"><p id="2ed7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="la">原载于</em> <a class="ae kw" href="https://blog.frankel.ch/maven-flatten-plugin/" rel="noopener ugc nofollow" target="_blank"> <em class="la">一个Java怪胎</em></a><em class="la">2022年1月30日</em></p></div></div>    
</body>
</html>