<html>
<head>
<title>How to undo a commit in git</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在git中撤销提交</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-undo-a-commit-in-git-2c7d49deabe0?source=collection_archive---------1-----------------------#2020-01-15">https://itnext.io/how-to-undo-a-commit-in-git-2c7d49deabe0?source=collection_archive---------1-----------------------#2020-01-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/4ccee08dfe626fe22cf2c85e027a512e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LhLwb5QUsDKgRlISP6l0zg.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">吉姆·威尔逊在<a class="ae kf" href="https://unsplash.com/s/photos/revert?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="b77c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">许多开发人员在git中努力撤销提交。有时，人们会不小心做出不应该出现在树中的更改。我想向您展示如何在本地或远程撤销这些更改。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="3bea" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">基本上，一个文件可以有三种不同的状态。可以是<em class="ll">未跟踪</em>、<em class="ll">未分级</em>或<em class="ll">分级</em>。<strong class="ki iu">未跟踪的</strong>文件从未被添加到树中，这意味着它们是全新的。<strong class="ki iu">未暂存</strong>文件是已经在树中但已经被修改的文件。这些修改后的变更可以添加到下一个状态文件中，即<em class="ll">暂存的</em>文件。<strong class="ki iu">暂存的</strong>文件是那些进入下一次提交的文件。如果您在存储库中键入git status，您也可以看到这三种状态。</p><figure class="lm ln lo lp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi gj"><img src="../Images/6b9acc067a3c3bf44f2537b894ec5327.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pfu3cMSI7ei63lozRKaQIA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">git状态—不同的文件状态</figcaption></figure><h1 id="8d37" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">从暂存文件中删除新文件</h1><p id="1982" class="pw-post-body-paragraph kg kh it ki b kj mo kl km kn mp kp kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">暂存文件是那些将进入您下一次提交的文件。如果您不小心将文件添加到了<em class="ll">暂存的</em>区域，您可以通过键入<code class="fe mt mu mv mw b">git restore --staged &lt;file&gt;</code>来撤销此操作，因此在这种情况下，它将是<code class="fe mt mu mv mw b">git restore --staged lib.c</code>。文件<code class="fe mt mu mv mw b">lib.c</code>将被再次移动到<em class="ll">未跟踪区域</em>，因为它是一个全新的文件。您所做的更改将仍然存在。如果您不再需要所做的更改，您可以删除该文件。</p><h1 id="dba1" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">从暂存文件中删除现有文件</h1><p id="d77f" class="pw-post-body-paragraph kg kh it ki b kj mo kl km kn mp kp kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">如果文件已经在树中，您可以保留所做的更改，或者将其重置为上次提交。<code class="fe mt mu mv mw b">git restore --staged &lt;file&gt;</code>将再次将文件从<em class="ll">暂存</em>移动到<em class="ll">未暂存</em>区域。如果您想要将文件重置为最新提交，您首先必须<em class="ll">卸载</em>您的文件，即从<em class="ll">暂存</em>区域中移除它——然后您可以通过键入<code class="fe mt mu mv mw b">git restore &lt;file&gt;</code>将文件恢复为最新提交。</p><p id="1e54" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">好的—在未跟踪/未暂存区和暂存区之间移动文件很容易。但是，如果您已经提交了文件，并且需要撤销最近的提交，该怎么办呢？让我们看看如何解决这个问题。</p><h1 id="c45d" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">撤消提交</h1><p id="8b05" class="pw-post-body-paragraph kg kh it ki b kj mo kl km kn mp kp kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">因此，让我们假设您想要撤销最近的提交，但是想要保留您的更改。您在工作树中的提交基本上如下所示:</p><figure class="lm ln lo lp gt ju gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/edde597a521796195f9c0ee8e8fe48cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*eLRYTJRgF4pqsxSV1oDInw.png"/></div></figure><p id="32a5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以你现在的实际提交是“添加superDuper.d”。现在，您希望撤销该提交，但保留更改。这些更改将从提交移动到<em class="ll">未暂存/未跟踪</em>区域。<code class="fe mt mu mv mw b">git reset HEAD^</code>会将你的树重置为你当前所在的树之前的提交。<code class="fe mt mu mv mw b">HEAD^</code>是<code class="fe mt mu mv mw b">HEAD-1</code>的简称。<code class="fe mt mu mv mw b">HEAD</code>是您的工作目录现在实际所在的位置。</p><p id="87f8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您想放弃提交而不保留更改，请将<code class="fe mt mu mv mw b">--hard</code>添加到命令:<code class="fe mt mu mv mw b">git reset --hard HEAD^</code>。小心，这个<strong class="ki iu">会删除</strong>提交中所做的更改。</p><h2 id="ef50" class="my lr it bd ls mz na dn lw nb nc dp ma kr nd ne me kv nf ng mi kz nh ni mm nj bi translated">恢复远程提交</h2><p id="14ae" class="pw-post-body-paragraph kg kh it ki b kj mo kl km kn mp kp kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">git工具箱中最不需要的东西是<code class="fe mt mu mv mw b">revert</code>。恢复意味着撤销最后一次提交。这里的问题是，树已经和你的遥控器同步了。所以<em class="ll">仅仅是</em>移除提交并不那么容易。我们要做的是撤销我们在单独的提交中所做的事情。<code class="fe mt mu mv mw b">git revert HEAD</code>正是这样做的。它接受您最近的提交，并恢复所做的所有更改，并将这些恢复的更改提交到它自己的提交中。所以让我们检查一下我们当前的git历史。</p><figure class="lm ln lo lp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nk"><img src="../Images/8110495fb899c609008c83fa81d179cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Akvd2KG2NAidMzGJ_XoRGA.png"/></div></div></figure><p id="dac1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以现在我们想恢复最近一次提交，在这里我们添加了<em class="ll"> database.md </em>文件。如果我们键入<code class="fe mt mu mv mw b">git revert HEAD</code>,它会恢复最近一次提交的内容。虽然我们的树看起来像这样:</p><figure class="lm ln lo lp gt ju gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/7dc472d46071071790adf43a6bd150e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*GBaZhV4eeH7HJ-qjttYWyQ.png"/></div></figure><p id="13c0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，您可以将所做的更改推送到远程设备，并且您成功地恢复了最近的提交。</p><h2 id="63b8" class="my lr it bd ls mz na dn lw nb nc dp ma kr nd ne me kv nf ng mi kz nh ni mm nj bi translated">进一步阅读</h2><p id="e30c" class="pw-post-body-paragraph kg kh it ki b kj mo kl km kn mp kp kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">如果你想了解更多关于git的知识，以及如何在命令行中提高你的git技能，请查看我的关于<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/become-a-git-terminal-pro-ab6d1955606f">成为Git Terminal Pro的文章。</a></p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h2 id="f766" class="my lr it bd ls mz na dn lw nb nc dp ma kr nd ne me kv nf ng mi kz nh ni mm nj bi translated">感谢阅读！</h2></div></div>    
</body>
</html>