# 语言的表现并不重要。

> 原文：<https://itnext.io/the-performance-of-languages-doesnt-matter-4037800288bd?source=collection_archive---------2----------------------->

最近热议的一个话题是 Rust 是否比 C++快，这个话题取代了之前关于 C++是否比 C 快的讨论，有时甚至 Java 也会被提及。

![](img/d64b7d1de71fa99cd27eaa84ba1e131f.png)

# 什么是性能？

很明显:一段特定的代码运行得有多快。就微观基准而言，这确实是我们所关注的。执行一段完美优化的代码需要多少个 CPU 周期？

但是一旦我们稍微缩小，我们就需要意识到我们所做的假设。例如，我们能否向微优化的代码提供数据，让它以接近全速的速度运行，还是周围的代码会让它变慢？即使我们对延迟(或 W)而不是吞吐量感兴趣，我们也可能处于多线程、多进程甚至多虚拟机环境中，这可能会完全控制我们的延迟。

语言的微观基准的最后一部分是编译器和虚拟机的质量。当在微观层面上比较编译语言和大多数 JIT 语言时，唯一的区别是强制对代码进行额外的“检查”。例如，边界检查(数组、整数)会导致运行时损失，但是没有这些检查的代码不是等价的代码。因此，有许多 JavaScript 代码可以 JIT 编译成最佳的二进制代码，就像 C++会产生的一样。

一种完全不同且更有用的查看性能的方法是通过制定面向用户的 SLO 的高级方法。只要满足了这些目标，我们就可以放心地宣称代码“足够快”。

# 你能多快写出快速代码？

或者换个说法，如果你写的是完全可读的高级代码，这个代码会有多快。此外，您需要自己编写多少性能关键型代码？你也可以把这看作是把你的全部精力分成*【初始编码】*和*【优化】*。

在这种背景下，我们开始看到分化。脚本语言突然引入了一个障碍。快速代码必须包含在预编译的模块中，一般用 c 语言编写。

然而，脚本语言并不是唯一引入障碍的语言。以下是其他一些导致运行时间损失的特性，这些特性无法完全优化:

*   函数式语言中的不可变数据
*   需要运行时检查的安全特性
*   自动化内存管理

可用工具的质量对轻松编写快速代码也有很大的影响。例如，对于编译语言，PGO 通常会带来 20%的性能提升。

但是我们不要忘记等式的另一边。所以我们可以推理我们写的代码有多快，但是我们写这个代码有多快呢？

## 机会成本

在商业中，一切都是金钱，虽然计算工程师的机会成本可能不容易，但这是你应该考虑的事情。你的工作效率越高，基准成本(你需要花多少钱来留住这个员工)和机会成本(这个员工提供了多少价值)之间的差异就越大。

这使得讨论我们编写快速代码的速度变得非常棘手，因为这变成了一个动态问题。优化决策来自两个主要因素:

*   减少资源占用带来的节约值得花费 X 天的机会成本
*   该产品不符合其 SLA，这阻碍了新功能的交付

这意味着您很容易处于这样一种情况，用脚本语言编写所有代码永远不会触发这两种情况。如果产品发展迅速，节约资源的机会就很难体现出来。通过增加资源占用量，可以更容易、更经济地解决不满足 SLA 的问题。

# 架构驱动性能。

在微观层面上，识别糟糕的性能模式已经成为基本编程能力的一部分。例如，通过 LeetCode 这样的网站，知道何时使用散列图或二分搜索法已经被灌输给软件工程师，这已经成为找工作的必要条件。

识别建筑中的相同模式更具挑战性:

*   更高水平的噪声使得对性能的推理更加困难
*   职责划分自然会导致效率低下，但这可能是必要的
*   了解第三方组件的详细性能特征具有挑战性

但与此同时，架构将胜过任何微观层面的性能提升。例如，假设您正在多次处理输入数据，并且可以提高处理速度或只处理一次输入。在这种情况下，微优化可能会带来 5-10%的速度提升，但如果完全去除重复的工作，可能会带来 80%甚至更高的速度提升。

如果您在线部署您的软件，并且需要动态伸缩，所有这些都会变得更加复杂。

# 那么语言的表现重要吗？

您的代码库中会有一些组件，您可以并且应该对它们的极限进行优化。例如，解析和验证输入，加密和哈希等核心数字功能，任何特定领域的数学密集型代码(人工智能、图形……)。但是这些是你自己写的，还是你把这个头疼的问题交给了图书馆？

更重要的是，相对于其他事情，你花了多少时间来编码实现呢？在我的项目中，编码部分占总时间的 0.5%-10%。所以在元层面上，编码的效率是我最不担心的。

此外，在公司层面上，尤其是如果你的公司很小的话，为一门特定的语言找到人才的能力应该比其他任何考虑都重要。

除非你做的是低延迟交易，在这种情况下，什么都不重要，因为节省的一个 CPU 周期可以转化为一大笔钱。

# 感谢您的阅读

感谢您阅读这篇文章。你喜欢吗？

我也在 YouTube 上发布视频。你有问题吗？在[推特](https://twitter.com/SimonToth83)或 [LinkedIn](https://www.linkedin.com/in/simontoth) 上联系我。