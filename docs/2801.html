<html>
<head>
<title>Who watches the watchmen? Mutation testing in action</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谁看着守望者？突变测试正在进行</h1>
<blockquote>原文：<a href="https://itnext.io/who-watches-the-watchmen-mutation-testing-in-action-4c56e014631?source=collection_archive---------6-----------------------#2019-08-05">https://itnext.io/who-watches-the-watchmen-mutation-testing-in-action-4c56e014631?source=collection_archive---------6-----------------------#2019-08-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="241b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">测试有效性测量。在此处或在<a class="ae kl" href="https://dev.to/noriste/who-watches-the-watchmen-mutation-testing-in-action-3889" rel="noopener ugc nofollow" target="_blank"> dev.to </a>上阅读。<br/>冠军的荣誉归于<a class="ae kl" href="http://goldbergyoni.com" rel="noopener ugc nofollow" target="_blank">约尼·戈德堡</a>。我喜欢它，因为它的谐音和<a class="ae kl" href="https://it.wikipedia.org/wiki/Watchmen" rel="noopener ugc nofollow" target="_blank">令人惊叹的漫画小说</a>浮现在我的脑海里。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/2eeac42459c501b6e1c1e73897d3eeca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X-5Qqsi-NdgeSCPvOERbwg.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">由<a class="ae kl" href="https://unsplash.com/@heftiba" rel="noopener ugc nofollow" target="_blank"> Toa Heftiba </a>在<a class="ae kl" href="https://unsplash.com" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="4355" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，你正在开发一个新函数，它需要大量的单元测试(比如我的<a class="ae kl" href="https://github.com/NoriSte/bitcoin-address-soft-regex-validation" rel="noopener ugc nofollow" target="_blank">比特币地址正则表达式验证</a>)。告诉我:你如何判断你的测试的有效性？你确定你在用所有必要的极限情况测试每一个特性吗？是什么让你如此自信？<br/>我知道答案:<a class="ae kl" href="https://www.wikiwand.com/en/Code_coverage" rel="noopener ugc nofollow" target="_blank">代码覆盖</a>和经验。</p><p id="9038" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">两个考虑因素:</p><ul class=""><li id="4d83" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">代码覆盖率并不能衡量测试的有效性。代码覆盖可以帮助你找到未测试的案例，它在这方面做得很好。但是它不能告诉你任何关于你的代码质量的信息。您可以在源代码中留下大量的bug，代码覆盖率只能帮助您通过所有这些bug，而不能解决它们。你可以争辩说错误必须通过测试来发现，但是…</li><li id="8465" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">测试需要经验，当你开始做测试时，你不会写出最好的测试。你获得的经验越多，你脑海中就会出现越多的疑问，问自己“我确定这些测试真的在测试我的功能吗？”</li></ul><p id="e2f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">别担心，这是一条已经走过的路。你获得的经验越多，你就越知道你的代码并不完美，这就是你开始测试的原因…你测试的越多，你就越想确定你的测试是有效的。</p><p id="6312" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">引用我一个同事的话(嗨<a class="ae kl" href="https://www.linkedin.com/in/fcracker79/" rel="noopener ugc nofollow" target="_blank">米尔科</a>👋有时我引入突变来对我的测试有信心。</p><h1 id="fc73" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">突变测试</h1><p id="7924" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">检查您的测试是否有效非常简单:在您的代码中放置一些bug并启动测试。如果测试没有失败，它们对捕获bug是无用的。这是变异测试！你改变了源代码(这个新的和被窃听的源代码被称为“一个突变体”)，并且你启动了针对它的测试套件。</p><p id="e071" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事实上，<a class="ae kl" href="https://en.wikipedia.org/wiki/Mutation_testing" rel="noopener ugc nofollow" target="_blank">突变测试</a>的主要目标是:</p><ul class=""><li id="3cd6" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">识别弱测试的代码片段(突变体不会被杀死的代码片段)</li><li id="b8df" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">识别弱测试(那些从不杀死突变体的测试)</li></ul><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/66c73d83f09c58b7e584d52b4360cd35.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*6_NfmllVraVSeocoNCkvlQ.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">变异测试过程。</figcaption></figure><p id="56b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你认为我们在谈论一些测试怪胎…请便😊</p><h2 id="1746" class="mv ls iq bd lt mw mx dn lx my mz dp mb jy na nb mf kc nc nd mj kg ne nf mn ng bi translated">一个例子</h2><p id="4ffd" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">我选择用我的一个旧包来玩突变测试:<a class="ae kl" href="https://github.com/NoriSte/typescript-is-type" rel="noopener ugc nofollow" target="_blank"> Typescript是Type </a>。整个包非常小，低于源代码</p><pre class="kn ko kp kq gt nh ni nj nk aw nl bi"><span id="0fad" class="mv ls iq ni b gy nm nn l no np">module.exports = {<br/>  /**<br/>   * Perform a runtime check about an instance type. It returns true if all the specified keys are<br/>   * different from undefined<br/>   * <a class="ae kl" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {*} instance The instance to be checked<br/>   * <a class="ae kl" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {string|string[]} keys The keys that must be defined while checking the instance type<br/>   */<br/>  is(instance, keys) {<br/>    if (instance === undefined || instance === null) {<br/>      return false;<br/>    }<br/>    if(!Array.isArray(keys)) {<br/>      keys = [keys];<br/>    }</span><span id="b7fe" class="mv ls iq ni b gy nq nn l no np">    for(let i = 0, n = keys.length; i &lt; n; i++) {<br/>      if(instance[keys[0]] === undefined) {<br/>        return false;<br/>      }<br/>    }<br/>    return true;<br/>  }<br/>}</span></pre><p id="52ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你看到那只巨大的虫子了吗？</p><p id="6b94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我安装了<a class="ae kl" href="https://stryker-mutator.io" rel="noopener ugc nofollow" target="_blank"> Stryker </a>,它管理我的源代码变异和自动启动测试套件的所有过程。</p><p id="db1f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意:Stryker的安装<a class="ae kl" href="https://stryker-mutator.io/stryker/quickstart" rel="noopener ugc nofollow" target="_blank">非常简单</a>，然后你只需要通过<a class="ae kl" href="https://github.com/stryker-mutator/stryker/tree/master/packages/core#mutate-string" rel="noopener ugc nofollow" target="_blank"> Stryker配置</a>添加你想让它变异的文件。在我的例子中，它只是<em class="lq"> mutate: ["index.js"] </em>。</p><p id="de9a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有一次用<em class="lq"> npx启动Styker运行</em>我发现了一个惊喜，一个变异人居然活了下来</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nr"><img src="../Images/1b80174858fb4f3400536fe955150d60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J9Og9sjKXJkxyokjdPS0GA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">一个幸存的变异人。</figcaption></figure><p id="a951" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Stryker告诉我，如果它用<em class="lq"> i &lt; = n </em>突变了<em class="lq"> i &lt; n </em>，从测试的角度来看没有任何变化。测试并没有杀死这种突变体(测试通过了两种情况:I<em class="lq">I&lt;n</em>或<em class="lq"> i &lt; = n </em>突变)。怎么可能呢？循环条件怎么可能不影响测试呢？🤔因为一只巨大的虫子！看一下<em class="lq">实例【keys[0]】</em>！它没有使用<em class="lq"> i </em>变量！！！</p><p id="89e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，倒楣的事情发生了，我们来分析一下:</p><ul class=""><li id="082a" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">代码覆盖率并没有帮助找到bug，因为正如我在文章开始时所说的，它不能检查代码的质量，它只是检查测试是否通过了所有的代码行</li><li id="eb26" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">毕竟，我的测试不是很好。在源代码和测试中都可能出现错误</li></ul><h1 id="4b13" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">我是怎么修好的</h1><p id="a52c" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">变异测试的主题不是源代码，而是测试本身。如果我的测试允许一个像发现的那样的巨大错误，我需要改进它们。</p><p id="0248" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我添加了更多的测试和期望来真正测试缺失的特性(检查所有的键，而不仅仅是第一个键)。不改变源代码，我现在有一些失败的测试，正如所料！然后，我修复了错误，测试通过了，完美！我再次运行Stryker，现在一切正常</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ns"><img src="../Images/b85a870a90cfe2bd85e1da5cd4cae478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hkz_e7l78ux1RlwWjNn8WA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">没有幸存的变种人了。</figcaption></figure><p id="0051" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">突变测试寿命长😊</p><h1 id="caf7" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">结论</h1><p id="265f" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">你测试的越多，你就越需要知道你的测试是否有效。Stryker还不完美(例如:你现在不能忽略一些行，比如一些各种各样的<em class="lq"> console.log </em>)但是它是一个很好的工具，可以捕捉bug，提高你的测试信心，让你的代码得到更好的测试。</p><p id="389f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我是在跟随<a class="ae kl" href="http://goldbergyoni.com" rel="noopener ugc nofollow" target="_blank"> Yoni Goldberg </a>看他的<a class="ae kl" href="https://youtu.be/-2zP494wdUY" rel="noopener ugc nofollow" target="_blank">Advanced node . js Testing:beyond unit&amp;integration tests(2019)</a>视频时发现突变测试这个话题的，看看他的内容😉</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nt nu l"/></div></figure></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><p id="dd4a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你好👋我是Stefano Magni，我是一名热情的JavaScript开发人员和Cypress大使。<br/>我喜欢创造高质量的产品，测试和自动化一切，学习和分享我的知识，帮助别人，在会议上发言和面对新的挑战。<br/>我为意大利比特币初创公司<a class="ae kl" href="https://conio.com/it/?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"> Conio </a>工作。<br/>你可以在<a class="ae kl" href="https://twitter.com/NoriSte?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae kl" href="https://github.com/NoriSte?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"> GitHub </a>、<a class="ae kl" href="https://www.linkedin.com/in/noriste/?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上找到我。你可以找到我所有的<a class="ae kl" href="https://github.com/NoriSte/all-my-contributions?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank">最近的贡献/演讲等。这里</a>。</p></div></div>    
</body>
</html>