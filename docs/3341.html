<html>
<head>
<title>Use GitHub Actions for validated builds</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对已验证的构建使用GitHub操作</h1>
<blockquote>原文：<a href="https://itnext.io/use-github-actions-for-validated-builds-31b3289b46cc?source=collection_archive---------5-----------------------#2019-11-25">https://itnext.io/use-github-actions-for-validated-builds-31b3289b46cc?source=collection_archive---------5-----------------------#2019-11-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="8f26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> GitHub动作</a>为GitOps管道提供了一种非常简单的方式，因为你不需要额外的CI/CD工具。您可以简单地创建或使用现有的GitHub actions，并将其配置为在特定分支更新时运行。</p><p id="bc6d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以确保每个构建(即容器映像)都能以最安全的方式得到验证，code公证人公证是强制性的。</p><p id="8972" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们通过简单的步骤来集成code公证人:</p><h1 id="affc" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">创建GitHub秘密</h1><p id="bb34" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">你可以从在你的资源库中添加<a class="ae kl" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank"> Dockerhub </a>和<a class="ae kl" href="https://www.codenotary.io" rel="noopener ugc nofollow" target="_blank">code公证人</a>的GitHub秘密开始。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/2196a28c08bcbd3d05fd8ea6c7cca03c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yRq6tuazk6UDDCCV.png"/></div></div></figure><p id="b1ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您还没有免费的code公证员帐户来设置公证流程，请从这个帐户开始:</p><h1 id="2f64" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">创建您的工作流程</h1><p id="08f1" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">GitHub动作是使用工作流定义的，工作流可以作为文件创建在您的库中，位于<strong class="jp ir">下。github/workflows </strong>或使用UI和操作菜单。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/390ba84a317e97e6a66036574f3714a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/0*RfUQRkGaj8Av2HhW.png"/></div></figure><h1 id="b533" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">工作流程</h1><p id="cfe4" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">每当检测到主分支中的新提交时，将触发以下工作流，构建容器映像，公证该映像并将其推送到<a class="ae kl" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank">Dockerhub.com</a>。</p><p id="f0c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请确保用您的帐户存储库替换容器映像路径。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/0793568e3e2796f60df4e3f796005f04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NPwXXnLfHTdS8HZu.png"/></div></div></figure><pre class="lq lr ls lt gt mc md me mf aw mg bi"><span id="6e59" class="mh kn iq md b gy mi mj l mk ml"># Define when the Actions should be triggered<br/>on:<br/>  push:<br/>    branches:<br/>      - master<br/>    tags:<br/>      - "**"<br/># Name of the Workflow<br/>name: "Continuous Deployment"<br/><br/># Different Jobs<br/>jobs:<br/>  build:<br/>    name: "Build and deploy"<br/>    runs-on: ubuntu-latest # Define the build docker image<br/><br/>    env:<br/>      DOCKER_IMAGE: dzlabsch/build-notarize-docker-action # define Docker Repo<br/><br/>    steps:<br/># Checkout the Git repo<br/>      - name: "Checkout"<br/>        uses: actions/checkout@v1.0.0  <br/><br/># Build the container image as latest<br/>      - name: "Build Docker image"<br/>        run: $(which docker) build --tag ${DOCKER_IMAGE}:latest .<br/><br/># Download and verify CodeNotary vcn<br/>      - name: "Download vcn"<br/>        run: |<br/>             curl -L -o /tmp/vcn https://github.com/vchain-us/vcn/releases/download/v0.7.3/vcn-v0.7.3-linux-amd64-static<br/>             CHECKSUM=$(sha256sum /tmp/vcn | cut -d " " -f 1)<br/>             echo $CHECKSUM<br/>             curl -s https://api.codenotary.io/authenticate/$CHECKSUM?org=vchain.us | grep -q :0<br/>             chmod +x /tmp/vcn<br/>     <br/># Notarize the container image using your GitHub secrets<br/>      - name: "Notarize Docker Image"<br/>        run: |<br/>             VCN_USER=${{ secrets.CODENOTARY_USER }}  VCN_PASSWORD=${{ secrets.CODENOTARY_PASS }} /tmp/vcn login<br/>             VCN_NOTARIZATION_PASSWORD=${{ secrets.CODENOTARY_PASS }} /tmp/vcn n -p --attr GitHub="${GITHUB_SHA:0:7}" docker://${DOCKER_IMAGE}:latest <br/><br/># Log into Dockerhub or your container registry<br/>      - name: "Docker Login"<br/>        if: "'refs/heads/master' == github.ref || startsWith(github.ref, 'refs/tags/')"<br/>        run: echo ${{ secrets.DOCKER_PASSWORD }} | $(which docker) login --password-stdin --username ${{ secrets.DOCKER_USERNAME }}<br/><br/># Push the container image to the container repository<br/>      - name: "Push Docker image (latest)"<br/>        if: "'refs/heads/master' == github.ref || startsWith(github.ref, 'refs/tags/')"<br/>        run: $(which docker) push ${DOCKER_IMAGE}:latest<br/><br/># Logout Docker registry<br/>      - name: "Docker Logout"<br/>        if: "'refs/heads/master' == github.ref || startsWith(github.ref, 'refs/tags/')"<br/>        run: $(which docker) logout</span></pre><h1 id="0014" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">检查工作流程</h1><p id="8083" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">当您将下一个变更提交到主分支时，GitHub动作工作流应该会被自动触发。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/f20409f3ab99f1d8b5285fe4253022da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FdAKALhhBhyPpeaB.png"/></div></div></figure><p id="50c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您单击工作流程的标题时，您还可以查看不同步骤的详细信息。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mm"><img src="../Images/459ffbe22f681eda2586e475ebea2ff5.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/0*xgwdg_Tzg2JL43WY.png"/></div></div></figure><p id="5bf1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以打开每个工作单来查看详细信息:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/855cc30d25d8c60d774c38ae9b6a451f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/0*Aq0woYyQPC4yTPqR.png"/></div></figure><h1 id="22d9" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">验证容器图像</h1><p id="4ce4" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">下载并使用该经过公证的容器图像的每个人都可以使用<a class="ae kl" href="https://github.com/vchain-us/vcn" rel="noopener ugc nofollow" target="_blank">code公证人vcn</a>(<strong class="jp ir"><em class="mo">vcn authenticated docker://image</em></strong>)来检查其真实性。</p><p id="a761" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它也可以很容易地集成到您的部署过程中。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="7257" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mo">原载于2019年11月25日</em><a class="ae kl" href="https://www.codenotary.io/use-github-actions-for-validated-builds/" rel="noopener ugc nofollow" target="_blank"><em class="mo">https://www . code公证人. io </em> </a> <em class="mo">。</em></p></div></div>    
</body>
</html>