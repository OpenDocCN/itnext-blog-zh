<html>
<head>
<title>Deploying Next.js App to Firebase Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Next.js应用程序部署到Firebase函数</h1>
<blockquote>原文：<a href="https://itnext.io/deploying-next-js-app-to-firebase-functions-eb473791d79e?source=collection_archive---------0-----------------------#2020-03-24">https://itnext.io/deploying-next-js-app-to-firebase-functions-eb473791d79e?source=collection_archive---------0-----------------------#2020-03-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/465efe4813f81520355c0365b175b79e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VEXMXDkq01cyq8GTpdcRLA.png"/></div></div></figure><div class=""/><p id="58fc" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">先说重点:什么是<a class="ae kw" href="https://nextjs.org" rel="noopener ugc nofollow" target="_blank"> Next.js </a>？</p><blockquote class="kx ky kz"><p id="8812" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">基于React、Webpack和Babel构建的服务器端通用JavaScript webapps的小型框架。</p></blockquote><p id="ca6e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它开箱即用，具有预先配置的功能，如路由、静态优化、服务器端呈现、代码分割、CSS-in-JS支持、热重装和API routes à la <a class="ae kw" href="https://expressjs.com" rel="noopener ugc nofollow" target="_blank"> Express.js </a>，</p><p id="5a3d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">部署到<a class="ae kw" href="https://zeit.co" rel="noopener ugc nofollow" target="_blank"> ZEIT Now </a>非常容易，但我想探索将我的应用程序部署到Firebase功能的可能性，以便为数据库、分析、广告和托管提供一个中心共同点。</p><p id="2a80" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">鉴于Next.js和Firebase的受欢迎程度，并没有人们想象的那么多来源。我找到了以下几个很棒的:</p><ul class=""><li id="6196" class="le lf jb ka b kb kc kf kg kj lg kn lh kr li kv lj lk ll lm bi translated"><a class="ae kw" href="https://github.com/jthegedus/firebase-gcp-examples/tree/master/functions-nextjs" rel="noopener ugc nofollow" target="_blank">https://github . com/jthegedus/firebase-GCP-examples/tree/master/functions-nextjs</a></li><li id="090d" class="le lf jb ka b kb ln kf lo kj lp kn lq kr lr kv lj lk ll lm bi translated"><a class="ae kw" href="https://codeburst.io/next-js-on-cloud-functions-for-firebase-with-firebase-hosting-7911465298f2" rel="noopener" target="_blank">https://code burst . io/next-js-on-cloud-functions-for-firebase-with-firebase-hosting-7911465298 F2</a></li><li id="282f" class="le lf jb ka b kb ln kf lo kj lp kn lq kr lr kv lj lk ll lm bi translated"><a class="ae kw" href="https://github.com/zeit/next.js/tree/canary/examples/with-firebase-hosting" rel="noopener ugc nofollow" target="_blank">https://github . com/zeit/next . js/tree/canary/examples/with-firebase-hosting</a></li></ul><p id="fa69" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我之所以想写这篇文章，是因为我想提供一种快速部署现有项目的方法，跳过深入的解释。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="b15c" class="lz ma jb bd mb mc md dn me mf mg dp mh kj mi mj mk kn ml mm mn kr mo mp mq mr bi translated">步骤1:配置Firebase</h2><p id="b983" class="pw-post-body-paragraph jy jz jb ka b kb ms kd ke kf mt kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated">转到Firebase控制台，创建一个新项目。请记住，您需要采用<em class="la"> Blaze </em>计划，以便能够从您的云功能加载外部网络资源。</p><p id="8ece" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后打开终端，转到您的项目文件夹，并在其中初始化Firebase:</p><figure class="mx my mz na gt is"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="c475" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">只选择<em class="la">托管</em>功能，然后继续使用默认值。一旦<code class="fe nd ne nf ng b">firebase</code>完成其操作，删除<code class="fe nd ne nf ng b">public/index.html</code>:它会干扰路由。</p><p id="f9c4" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，编辑<code class="fe nd ne nf ng b">firebase.json</code>到此:</p><figure class="mx my mz na gt is"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="ae32" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它告诉Firebase hosting重写所有对我们将要定义的<code class="fe nd ne nf ng b">nextjs-server</code>函数的请求。</p><h2 id="79e2" class="lz ma jb bd mb mc md dn me mf mg dp mh kj mi mj mk kn ml mm mn kr mo mp mq mr bi translated">步骤2:配置服务器代码</h2><p id="0b2f" class="pw-post-body-paragraph jy jz jb ka b kb ms kd ke kf mt kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated">首先，让我们安装依赖项:</p><figure class="mx my mz na gt is"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="ea92" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，您可以在<code class="fe nd ne nf ng b">src/server/index.js</code>中创建服务器代码:</p><figure class="mx my mz na gt is"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="eb9f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，您告诉Babel如何通过创建<code class="fe nd ne nf ng b">src/server/.babelrc</code>文件从<code class="fe nd ne nf ng b">index.js</code>源生成Node.js服务器代码:</p><figure class="mx my mz na gt is"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h2 id="db5e" class="lz ma jb bd mb mc md dn me mf mg dp mh kj mi mj mk kn ml mm mn kr mo mp mq mr bi translated">步骤3:移动Next.js应用程序代码</h2><p id="e614" class="pw-post-body-paragraph jy jz jb ka b kb ms kd ke kf mt kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated">把你所有的应用程序代码放在<code class="fe nd ne nf ng b">src/client</code>文件夹里。你还必须移动<code class="fe nd ne nf ng b">next.config.js</code>和<code class="fe nd ne nf ng b">tsconfig.json</code>，如果你有的话。</p><p id="ada1" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">编辑<code class="fe nd ne nf ng b">src/client=next.config.js</code>以更改分发路径:</p><figure class="mx my mz na gt is"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="a40a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">更新<code class="fe nd ne nf ng b">package.json</code>以便在Firebase服务器上使用正确的入口点和正确的Node.js版本:</p><figure class="mx my mz na gt is"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h2 id="be75" class="lz ma jb bd mb mc md dn me mf mg dp mh kj mi mj mk kn ml mm mn kr mo mp mq mr bi translated">步骤4:配置构建脚本</h2><p id="17ce" class="pw-post-body-paragraph jy jz jb ka b kb ms kd ke kf mt kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated">在<code class="fe nd ne nf ng b">package.json</code>中插入一些有用的脚本来开发你的应用程序:</p><figure class="mx my mz na gt is"><div class="bz fp l di"><div class="nb nc l"/></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated">如果您启动“npm run dev ”,您将获得一个带有热重装的本地部署服务器。</figcaption></figure><p id="536a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">另一批脚本可以专门用于构建:</p><figure class="mx my mz na gt is"><div class="bz fp l di"><div class="nb nc l"/></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated">如果您启动“npm run build ”,您将在dist/中获得一个产品包。</figcaption></figure><p id="9793" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以启动一个Firebase本地服务器来调试您的云功能:</p><figure class="mx my mz na gt is"><div class="bz fp l di"><div class="nb nc l"/></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated">如果你启动“npm run serve ”,你将得到一个本地Firebase服务器。</figcaption></figure><p id="0db3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，将发布版本上传到Firebase的部署脚本:</p><figure class="mx my mz na gt is"><div class="bz fp l di"><div class="nb nc l"/></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated">如果您启动“npm运行部署”,您将构建并上传到Firebase。</figcaption></figure><h2 id="de3b" class="lz ma jb bd mb mc md dn me mf mg dp mh kj mi mj mk kn ml mm mn kr mo mp mq mr bi translated">笔记</h2><p id="ebb5" class="pw-post-body-paragraph jy jz jb ka b kb ms kd ke kf mt kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated">你可以在<a class="ae kw" href="https://github.com/muccy/next-js-to-firebase-article" rel="noopener ugc nofollow" target="_blank"> Github </a>上看到整个项目。</p></div></div>    
</body>
</html>