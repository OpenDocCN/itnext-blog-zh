<html>
<head>
<title>Ambassador and Istio: Edge proxy and service mesh</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">大使和Istio:边缘代理和服务网格</h1>
<blockquote>原文：<a href="https://itnext.io/ambassador-and-istio-edge-proxy-and-service-mesh-814aac9f23df?source=collection_archive---------3-----------------------#2018-01-23">https://itnext.io/ambassador-and-istio-edge-proxy-and-service-mesh-814aac9f23df?source=collection_archive---------3-----------------------#2018-01-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0d3c1a225e266c2392c236afc5ee4136.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SEYbDEKtqgCpEr4D2IVrmw.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/photos/CyFBmFEsytU?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">马里乌斯·马萨拉尔</a>在<a class="ae kc" href="https://unsplash.com/search/photos/network?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="0fe5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae kc" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fitnext.io%2Fambassador-and-istio-edge-proxy-and-service-mesh-814aac9f23df" rel="noopener ugc nofollow" target="_blank"> <em class="lb">点击这里在LinkedIn上分享这篇文章</em> </a></p><p id="4463" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">大使是一个用于微服务的Kubernetes-native API网关。Ambassador部署在您的网络边缘，将传入流量路由到您的内部服务(也称为“南北”流量)。<a class="ae kc" href="https://istio.io/" rel="noopener ugc nofollow" target="_blank"> Istio </a>是一个面向微服务的服务网格，旨在为服务到服务的流量(也称为“东西”流量)增加L7可观察性、路由和弹性。Istio和Ambassador都是用<a class="ae kc" href="https://www.envoyproxy.io/" rel="noopener ugc nofollow" target="_blank">特使</a>建造的。</p><p id="2633" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">大使和Istio可以一起部署在Kubernetes。在此配置中，来自集群外部的传入流量首先通过Ambassador进行路由，然后再将流量路由到Istio。Ambassador处理认证、边缘路由、TLS终止和其他传统的边缘功能。</p><p id="8375" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这使得运营商可以两全其美:高性能、现代化的边缘服务(Ambassador)与最先进的服务网络(Istio)相结合。Istio的基本<a class="ae kc" href="https://istio.io/docs/tasks/traffic-management/ingress.html" rel="noopener ugc nofollow" target="_blank"> ingress控制器</a>，ingress控制器非常有限，不支持认证或Ambassador的许多其他功能。</p><h1 id="6218" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">让大使与Istio合作</h1><p id="8e82" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">让大使与Istio合作很简单。在这个例子中，我们将使用来自Istio的<code class="fe mf mg mh mi b">bookinfo</code>示例应用程序。</p><ol class=""><li id="77d6" class="mj mk iq kf b kg kh kk kl ko ml ks mm kw mn la mo mp mq mr bi translated">按照默认说明在Kubernetes上安装Istio。</li><li id="4e4a" class="mj mk iq kf b kg ms kk mt ko mu ks mv kw mw la mo mp mq mr bi translated">接下来，按照<a class="ae kc" href="https://istio.io/docs/guides/bookinfo.html" rel="noopener ugc nofollow" target="_blank">说明</a>安装Bookinfo示例应用程序。</li><li id="bdb3" class="mj mk iq kf b kg ms kk mt ko mu ks mv kw mw la mo mp mq mr bi translated">验证示例应用程序是否按预期运行。</li></ol><p id="d365" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">默认情况下，Bookinfo应用程序使用Istio入口。要使用大使，我们需要:</p><ol class=""><li id="d6a3" class="mj mk iq kf b kg kh kk kl ko ml ks mm kw mn la mo mp mq mr bi translated">安装大使。参见<a class="ae kc" href="https://www.getambassador.io/user-guide/getting-started" rel="noopener ugc nofollow" target="_blank">快速入门</a>指南。</li><li id="f62f" class="mj mk iq kf b kg ms kk mt ko mu ks mv kw mw la mo mp mq mr bi translated">更新<code class="fe mf mg mh mi b">bookinfo.yaml</code>清单以包含必要的大使注释。见下文。</li></ol><pre class="mx my mz na gt nb mi nc nd aw ne bi"><span id="bad1" class="nf ld iq mi b gy ng nh l ni nj">apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: productpage<br/>  labels:<br/>    app: productpage<br/>  annotations:<br/>    getambassador.io/config: |<br/>      ---<br/>      apiVersion: ambassador/v0<br/>      kind: Mapping<br/>      name: productpage_mapping<br/>      prefix: /productpage/<br/>      rewrite: /productpage<br/>      service: productpage:9080<br/>spec:<br/>  ports:<br/>  - port: 9080<br/>    name: http<br/>  selector:<br/>    app: productpage</span></pre><p id="cfbe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3.或者，通过键入<code class="fe mf mg mh mi b">kubectl delete ingress gateway</code>从<code class="fe mf mg mh mi b">bookinfo.yaml</code>清单中删除入口控制器。</p><p id="33b1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">4.去<code class="fe mf mg mh mi b">$AMBASSADOR_IP/productpage/</code>测试大使。你可以通过输入<code class="fe mf mg mh mi b">kubectl get services ambassador</code>获得大使的实际IP地址。</p><h1 id="b72a" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">自动边车注射</h1><p id="1d94" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">新版本的Istio支持Kubernetes初始化器自动注入Istio sidecar 。使用Ambassador，您不需要插入Istio sidecar——Ambassador的特使实例会自动路由到适当的服务。如果您使用自动边车注射，您需要配置Istio，使其不为Ambassador pods自动注射边车。有几种方法可以做到这一点，在文档中有<a class="ae kc" href="https://istio.io/docs/setup/kubernetes/sidecar-injection.html#configuration-options" rel="noopener ugc nofollow" target="_blank">的解释。</a></p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><p id="b1eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇文章最初出现在<a class="ae kc" href="https://www.getambassador.io/user-guide/with-istio" rel="noopener ugc nofollow" target="_blank">大使文档</a>中。<a class="ae kc" href="https://www.getambassador.io" rel="noopener ugc nofollow" target="_blank"> Ambassador </a>是一个开源的Kubernetes-native API网关，构建在<a class="ae kc" href="https://www.envoyproxy.io/" rel="noopener ugc nofollow" target="_blank">特使代理</a>之上。</p></div></div>    
</body>
</html>