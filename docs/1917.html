<html>
<head>
<title>Redis 5.X under the hood: 1 — Redis-Server up and running</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Redis 5。幕后x:1—Redis-服务器启动并运行</h1>
<blockquote>原文：<a href="https://itnext.io/redis-5-x-under-the-hood-1-downloading-and-installing-redis-locally-3373fe67a154?source=collection_archive---------1-----------------------#2019-02-23">https://itnext.io/redis-5-x-under-the-hood-1-downloading-and-installing-redis-locally-3373fe67a154?source=collection_archive---------1-----------------------#2019-02-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/c73f924f301bd2287b3ba10870133e48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1I9XZSUbS-F54R6NNXGkBQ.jpeg"/></div></div></figure><p id="efd6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Redis是远程字典服务器的缩写，自从最初使用强大而快速的键值存储以来，它已经走过了漫长的道路。它以其<a class="ae kz" href="https://redis.io/topics/benchmarks" rel="noopener ugc nofollow" target="_blank">高性能</a>、多样化的数据类型、高可用和可扩展的架构越来越受到关注。</p><p id="eeea" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">它在<a class="ae kz" href="https://db-engines.com/en/ranking" rel="noopener ugc nofollow" target="_blank">数据库引擎完整排名</a>的前10个数据库中排名第7，是前10名中唯一的键值。最近，<a class="ae kz" href="https://www.prnewswire.com/news-releases/redis-labs-delivers-the-fastest-multi-model-database-on-intel-optane-dc-persistent-memory-300775789.html" rel="noopener ugc nofollow" target="_blank">还将</a>认证为多模型数据库，支持针对单个后端的多个数据模型。</p><p id="2b30" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">作为<a class="ae kz" href="https://www.meetup.com/en-AU/Redis-Porto/" rel="noopener ugc nofollow" target="_blank">meetup组织者</a>，我们决定记录这一相互学习的旅程，以更好地了解核心Redis 5及其顶级扩展如何工作，讨论这一新版本中的新功能，因此阅读这一系列文章并参加我们一般会议的人可以就它适合和不适合的不同用例做出明智的决定。</p><p id="1beb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们的旅程将从头开始，从设置本地实例到让多主集群运行在云上不同的可用性区域。到本系列结束时，您应该对在类似生产的环境中运行Redis有了深入的了解。</p><p id="fcaa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">本文档将在每篇文章发布时更新，以跟踪系列文章，其结构如下:</p><p id="12c0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">第1篇— <a class="ae kz" href="https://medium.com/@fcosta_oliveira/redis-5-x-under-the-hood-1-downloading-and-installing-redis-locally-3373fe67a154" rel="noopener">本地下载安装Redis</a>，包括Redis本地服务器的安装和基本操作，如启动和关闭Redis服务器，用redis-cli连接Redis，获取服务器信息，了解一些关键的默认配置，如数据持久化。</p><p id="b39d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">第2篇文章<a class="ae kz" href="https://medium.com/@fcosta_oliveira/redis-5-x-under-the-hood-2-intro-to-redis-commands-and-data-structures-part-1-41f05501cb52" rel="noopener">Redis命令和数据结构介绍——第1部分</a>，讲述了为什么在使用Redis时需要考虑如何存储、访问和转换数据，同时还讨论了STRING数据类型。</p><h1 id="8b58" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">1 —在本地下载和安装Redis</h1><p id="d82b" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">如果可能的话，使用最新版本的Redis是最佳实践之一。最新的Redis主版本(5.0.0)于2018年10月17日在GitHub上发布。在这个系列中，我们将采用2018年12月12日推出的最新稳定版本(5.0.3)。</p><h2 id="f55e" class="md lb it bd lc me mf dn lg mg mh dp lk km mi mj lo kq mk ml ls ku mm mn lw mo bi translated">1.1 —使用哪种操作系统:</h2><p id="5dc7" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">Linux和OS X是Redis开发和测试较多的两个操作系统，我们<strong class="kd iu">推荐使用Linux部署</strong>。</p><p id="6f49" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">关于Windows操作系统没有官方支持，但是微软开发并维护了一个<a class="ae kz" href="https://github.com/MSOpenTech/redis" rel="noopener ugc nofollow" target="_blank"> Win-64的Redis </a>端口。</p><h2 id="c766" class="md lb it bd lc me mf dn lg mg mh dp lk km mi mj lo kq mk ml ls ku mm mn lw mo bi translated">1.2 —启动和运行:</h2><p id="d85e" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">我们推荐两种在您的机器上启动和运行Redis的方法:</p><h2 id="6f1a" class="md lb it bd lc me mf dn lg mg mh dp lk km mi mj lo kq mk ml ls ku mm mn lw mo bi translated">1.2.1 —选项1 —使用docker运行(最简单的方式):</h2><p id="d780" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">如果你的机器上有docker，这是设置测试环境的最简单的方式:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="b807" class="md lb it mu b gy my mz l na nb">docker run -p 6379:6379 --name redis5-under-the-hood -d redis:<a class="ae kz" href="https://github.com/docker-library/redis/blob/7be79f51e29a009fefdc218c8479d340b8c4a5e1/5.0/Dockerfile" rel="noopener ugc nofollow" target="_blank">5.0.3</a><br/>sudo apt install redis-tools<br/>redis-cli <br/>127.0.0.1:6379&gt;</span></pre><h2 id="c1b6" class="md lb it bd lc me mf dn lg mg mh dp lk km mi mj lo kq mk ml ls ku mm mn lw mo bi translated">1.2.2 —选项2 —建立Redis:</h2><p id="64e2" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">如果您想构建Redis，只需在终端上执行以下命令:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="1e51" class="md lb it mu b gy my mz l na nb">wget <a class="ae kz" href="http://download.redis.io/releases/redis-5.0.3.tar.gz" rel="noopener ugc nofollow" target="_blank">http://download.redis.io/releases/redis-5.0.3.tar.gz</a><br/>tar xvzf redis-5.0.3.tar.gz<br/>cd redis-5.0.3<br/>make<br/>make test<br/>sudo make install</span></pre><p id="436c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果一切顺利，在最后一个命令之后，将出现以下消息:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="c065" class="md lb it mu b gy my mz l na nb">Hint: It's a good idea to run 'make test' ;)</span><span id="0296" class="md lb it mu b gy nc mz l na nb"><strong class="mu iu">INSTALL</strong> <strong class="mu iu">install<br/>INSTALL</strong> <strong class="mu iu">install<br/>INSTALL</strong> <strong class="mu iu">install<br/>INSTALL</strong> <strong class="mu iu">install<br/>INSTALL</strong> <strong class="mu iu">install</strong></span></pre><p id="fc58" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要使用内置的默认配置运行Redis进行测试(并让它在后台运行),只需输入:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="20ee" class="md lb it mu b gy my mz l na nb">redis-server &amp;</span></pre><h2 id="0df7" class="md lb it bd lc me mf dn lg mg mh dp lk km mi mj lo kq mk ml ls ku mm mn lw mo bi translated">1.3 —通过Redis配置文件配置Redis:</h2><p id="9e82" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">正如在前面的步骤中所看到的，Redis能够使用内置的默认配置在没有配置文件的情况下启动，但是，这种设置仅推荐用于测试和开发目的。</p><p id="954b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">配置Redis的正确方法是提供一个Redis配置文件，通常称为<code class="fe nd ne nf mu b"><a class="ae kz" href="http://download.redis.io/redis-stable/redis.conf" rel="noopener ugc nofollow" target="_blank">redis.conf</a></code>。在那里，您应该能够配置:</p><ul class=""><li id="8583" class="ng nh it kd b ke kf ki kj km ni kq nj ku nk ky nl nm nn no bi translated">包括设置</li><li id="1c76" class="ng nh it kd b ke np ki nq km nr kq ns ku nt ky nl nm nn no bi translated">网络设置</li><li id="24df" class="ng nh it kd b ke np ki nq km nr kq ns ku nt ky nl nm nn no bi translated">常规设置</li><li id="d956" class="ng nh it kd b ke np ki nq km nr kq ns ku nt ky nl nm nn no bi translated">快照设置</li><li id="8775" class="ng nh it kd b ke np ki nq km nr kq ns ku nt ky nl nm nn no bi translated">复制设置</li><li id="dfda" class="ng nh it kd b ke np ki nq km nr kq ns ku nt ky nl nm nn no bi translated">安全设置</li><li id="e282" class="ng nh it kd b ke np ki nq km nr kq ns ku nt ky nl nm nn no bi translated">限制设置</li><li id="7a1c" class="ng nh it kd b ke np ki nq km nr kq ns ku nt ky nl nm nn no bi translated">Lua脚本设置</li><li id="1b11" class="ng nh it kd b ke np ki nq km nr kq ns ku nt ky nl nm nn no bi translated">聚类设置</li><li id="9223" class="ng nh it kd b ke np ki nq km nr kq ns ku nt ky nl nm nn no bi translated">其他高级设置</li></ul><p id="9bba" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">以下链接应提供更多关于配置文件结构方式的详细信息<a class="ae kz" href="https://redis.io/topics/config" rel="noopener ugc nofollow" target="_blank">https://redis.io/topics/config</a>。</p><p id="f16d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所有这些设置将在后续文章中讨论。现在，让我们保留文件<code class="fe nd ne nf mu b"><a class="ae kz" href="http://download.redis.io/redis-stable/redis.conf" rel="noopener ugc nofollow" target="_blank">redis.conf</a></code>的默认设置，看看如何使用docker或构建的Redis运行Redis。为此，我们必须使用一个额外的<strong class="kd iu"> </strong>参数/ <strong class="kd iu">路径/to/redis.conf </strong>(配置文件的路径)来运行它。</p><h2 id="deed" class="md lb it bd lc me mf dn lg mg mh dp lk km mi mj lo kq mk ml ls ku mm mn lw mo bi translated">1.3.1 —选项1.1 —使用带有redis.conf文件的docker运行:</h2><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="1135" class="md lb it mu b gy my mz l na nb">docker run -v <strong class="mu iu">/path/to</strong><strong class="mu iu">/redis.conf</strong>:/usr/local/etc/redis/redis.conf --name redis5-under-the-hood-redis-conf -d redis:<a class="ae kz" href="https://github.com/docker-library/redis/blob/7be79f51e29a009fefdc218c8479d340b8c4a5e1/5.0/Dockerfile" rel="noopener ugc nofollow" target="_blank">5.0.3</a> redis-server /usr/local/etc/redis/redis.conf</span></pre><h2 id="8c66" class="md lb it bd lc me mf dn lg mg mh dp lk km mi mj lo kq mk ml ls ku mm mn lw mo bi translated">1.3.1 —选项2.1 —使用redis.conf文件运行构建的Redis:</h2><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="f302" class="md lb it mu b gy my mz l na nb">redis-server <strong class="mu iu">/path/to</strong><strong class="mu iu">/redis.conf </strong>&amp;</span></pre><p id="1733" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe nd ne nf mu b"><a class="ae kz" href="http://download.redis.io/redis-stable/redis.conf" rel="noopener ugc nofollow" target="_blank">redis.conf</a></code>中的所有选项也支持作为使用命令行的选项，名称完全相同。例如，如果我们希望Redis接受端口9999上的连接，而不是默认的6379，我们应该这样做:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="f3b0" class="md lb it mu b gy my mz l na nb">redis-server <strong class="mu iu">/path/to</strong><strong class="mu iu">/redis.conf </strong>--port 9999 <!-- -->&amp;</span></pre><p id="9035" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请记住，<strong class="kd iu">如果你传递一个</strong> <code class="fe nd ne nf mu b"><a class="ae kz" href="http://download.redis.io/redis-stable/redis.conf" rel="noopener ugc nofollow" target="_blank"><strong class="kd iu">redis.conf</strong></a></code> <strong class="kd iu">文件，它应该总是第一个参数。</strong></p><h2 id="c870" class="md lb it bd lc me mf dn lg mg mh dp lk km mi mj lo kq mk ml ls ku mm mn lw mo bi translated">1.4 —初步了解Redis如何保存数据:</h2><p id="d41c" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">既然我们已经建立并运行了一个测试Redis服务器，让我们快速地向您介绍Redis如何持久化数据。我们将用一整篇文章来讨论Redis中数据持久化的优点和缺点，以及实现数据持久化的几种方法，但是现在，让我们向您介绍一下这个主题。</p><p id="4759" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe nd ne nf mu b"><a class="ae kz" href="http://download.redis.io/redis-stable/redis.conf" rel="noopener ugc nofollow" target="_blank"><strong class="kd iu">redis.conf</strong></a></code> <strong class="kd iu">上启用的数据持久性的默认方法是</strong>通过将数据库快照到本地磁盘，它以指定的时间间隔执行数据集的时间点快照，默认方式如下:</p><ul class=""><li id="0a49" class="ng nh it kd b ke kf ki kj km ni kq nj ku nk ky nl nm nn no bi translated"><strong class="kd iu">900秒(15分钟)后，如果至少有一个键发生变化</strong></li><li id="b3fb" class="ng nh it kd b ke np ki nq km nr kq ns ku nt ky nl nm nn no bi translated"><strong class="kd iu">300秒(5分钟)后，如果至少10个键发生变化</strong></li><li id="10f8" class="ng nh it kd b ke np ki nq km nr kq ns ku nt ky nl nm nn no bi translated"><strong class="kd iu">60秒后，如果至少10000个键发生变化</strong></li></ul><p id="a3d8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果在发生事故的情况下，几分钟的数据丢失是不可接受的 ，Redis快照<strong class="kd iu"> <em class="nu">不能提供良好的耐久性保证，因此它的使用仅限于丢失最近数据不是很重要的应用。</em></strong></p><p id="7e60" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Lyft 下面这个redisconf 2018演讲链接:<a class="ae kz" href="https://www.slideshare.net/RedisLabs/redisconf18-2000-instances-and-beyond" rel="noopener ugc nofollow" target="_blank">https://www . slide share . net/redis labs/redis conf 18-2000-instances-and-beyond</a>。</p><p id="a297" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Redis提供了一种更高级的持久性模式，称为仅附加文件，通常简称为AOF，它记录服务器收到的每个写操作。我们将在后面讨论利弊。现在，请记住这两种模式都有利弊。</p><h2 id="05c2" class="md lb it bd lc me mf dn lg mg mh dp lk km mi mj lo kq mk ml ls ku mm mn lw mo bi translated">1.5 —停止Redis:</h2><p id="6f6a" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">要停止Redis，最优雅的方法是执行<a class="ae kz" href="https://redis.io/commands/SHUTDOWN" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> shutdown </strong> </a>命令。</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="d5cf" class="md lb it mu b gy my mz l na nb">redis-cli<br/>127.0.0.1:6379&gt; shutdown</span></pre><p id="840d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果启用了持久性，这个命令可以确保Redis被关闭而不会丢失任何数据。</p><h2 id="d304" class="md lb it bd lc me mf dn lg mg mh dp lk km mi mj lo kq mk ml ls ku mm mn lw mo bi translated">1.6 —后续步骤:</h2><p id="8778" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">现在我们已经有了一个正常运行的Redis本地服务器，我们可以开始研究hood了。我们的下一篇文章将是对Redis命令和数据结构 的<strong class="kd iu">，让您对可用的数据类型有一个基本的了解，以及它们如何在实际例子中有用。</strong></p></div></div>    
</body>
</html>