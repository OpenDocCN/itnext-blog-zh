<html>
<head>
<title>Building RESTful web API service using Golang, chi, and MySQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Golang、chi和MySQL构建RESTful web API服务</h1>
<blockquote>原文：<a href="https://itnext.io/building-restful-web-api-service-using-golang-chi-mysql-d85f427dee54?source=collection_archive---------2-----------------------#2018-07-10">https://itnext.io/building-restful-web-api-service-using-golang-chi-mysql-d85f427dee54?source=collection_archive---------2-----------------------#2018-07-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0d65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用go创建您的第一个REST API</p><p id="f4e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我目前的办公室，我使用微服务架构工作，Golang最受欢迎的是创建微服务。今天我将为博客文章构建一个简单的crud API web服务。写这篇文章的原因是为了帮助初学者构建自己的REST API。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/dee4c62be00d5c9e8657346ba73d0afc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PxEdB3KWXXHmh1FlXMk_mg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">来源:谷歌</figcaption></figure><p id="964b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个API中，我们将使用<code class="fe lb lc ld le b">dep</code>作为依赖管理器，<code class="fe lb lc ld le b">Mysql</code>作为数据库工作，<code class="fe lb lc ld le b">chi</code>包用于路由。将包管理器添加到您的项目中是一个很好的做法。我们将使用chi包进行路由，因为它有中间件和一些好的特性。你可以去翻翻他们的<a class="ae lf" href="https://godoc.org/github.com/go-chi/chi" rel="noopener ugc nofollow" target="_blank"> doc </a>。</p><p id="0e31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在通用CRUD应用程序中，API如下:</p><ol class=""><li id="b49c" class="lg lh iq jp b jq jr ju jv jy li kc lj kg lk kk ll lm ln lo bi translated">职位/职位</li><li id="db98" class="lg lh iq jp b jq lp ju lq jy lr kc ls kg lt kk ll lm ln lo bi translated">获取/帖子</li><li id="c0a5" class="lg lh iq jp b jq lp ju lq jy lr kc ls kg lt kk ll lm ln lo bi translated">GET /posts/{id}</li><li id="aa76" class="lg lh iq jp b jq lp ju lq jy lr kc ls kg lt kk ll lm ln lo bi translated">上传/发布/{id}</li><li id="cb8f" class="lg lh iq jp b jq lp ju lq jy lr kc ls kg lt kk ll lm ln lo bi translated">删除/帖子/{id}</li></ol><p id="feac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lu">开始之前，确保您的$GOPATH工作正常。</em>然后转到$GOPATH/src，做一个名为<strong class="jp ir"> wiki </strong>的目录。如果您的计算机中之前没有安装dep软件包，请使用-</p><pre class="km kn ko kp gt lv le lw lx aw ly bi"><span id="6fb2" class="lz ma iq le b gy mb mc l md me">$ go get -u github.com/golang/dep/cmd/dep</span></pre><p id="1ef0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">成功安装dep后，进入<code class="fe lb lc ld le b">wiki</code>目录，初始化dep，并在那里安装另一个包。</p><pre class="km kn ko kp gt lv le lw lx aw ly bi"><span id="25ae" class="lz ma iq le b gy mb mc l md me">$ dep init<br/>$ dep ensure -add github.com/go-chi/chi github.com/go-sql-driver/mysql</span></pre><p id="e4a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在在wiki目录中创建<em class="lu"> main.go </em>。<strong class="jp ir">在main.go中导入chi和SQL包</strong>如下图。<strong class="jp ir">创建所有路由器和数据库连接凭证</strong>。我已经把我自己的你可以根据你的来改变它。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="cf7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很漂亮啊！。好吧，让我们建立一个与数据库的连接，并初始化路由器和中间件。这里，我们将使用恢复中间件。因为任何一个请求失败，你的app都不会死，不用重启app就可以再次请求。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="98ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不要担心catch函数，我稍后会定义这个函数。dbSource最完整的形式是<code class="fe lb lc ld le b">username:password@protocol(address)/dbname?param=value</code></p><p id="b5ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们将创建一个基本的<code class="fe lb lc ld le b">POST</code>模型，用于发送和检索数据。在go中，一个结构通常可以作为你的模型模式。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="5b01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过添加json标签，我们可以将我们的结构编组到JSON。这一分钟，我们将从终端或第三方app在MySQL DB上创建<code class="fe lb lc ld le b">go-mysql-crud database</code>和<code class="fe lb lc ld le b">posts</code>表。我大多用sequel pro。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mf mg l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">数据库创建</figcaption></figure><p id="595f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你还记得我们之前创建的路由和句柄函数吗？是时候实施这些措施了。当有人使用带有<strong class="jp ir">标题和内容</strong> json数据的<strong class="jp ir"> POST </strong>方法请求<strong class="jp ir">/POST</strong>时，就会执行<strong class="jp ir"> CreatePost </strong>函数。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="a500" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的代码中，我们使用了<strong class="jp ir"> json。NewDecoder </strong>从参数‘r’中捕获<strong class="jp ir"> POST数据</strong>，并将其解码到我们的struct post模型中。然后准备我们的插入查询，并在此之后执行查询。</p><p id="1045" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> title=？意味着我们有动态标题数据要执行，我们将从post变量中检索它。不要忘记关闭您的查询。最后，我们使用<strong class="jp ir">respondwithJSON</strong>func<strong class="jp ir">将消息以JSON格式发送给客户端。</strong>我们将很快实施。</strong></p><p id="b218" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们实现<code class="fe lb lc ld le b">UpdatePost</code>和<code class="fe lb lc ld le b">DeletePost</code>函数。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="e48e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了捕捉id，我使用了<code class="fe lb lc ld le b">chi.URLParam</code>。尝试实施<em class="lu">全贴</em>和<em class="lu">细节贴</em>。如果你需要帮助，请访问我的<a class="ae lf" href="https://github.com/s1s1ty/go-mysql-crud/blob/master/main.go" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">github repo</strong></a><strong class="jp ir">。你可以在那边找到完整的代码。</strong></p><p id="837a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在该写主函数和一些辅助函数了。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="bebf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行这个例子将在端口8005上启动一个服务器，并且可以在<a class="ae lf" href="http://localhost:8005" rel="noopener ugc nofollow" target="_blank"> http://localhost:8005 </a>上访问。(Logger函数在终端上打印您的每个请求的日志，它在下面的helper.go文件中实现。)</p><p id="8ba6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将拆分main.go到helper.go来包含我们的helper函数。也可以拆分路由器，将路由器功能移到router.go。</p><h2 id="c296" class="lz ma iq bd mh mi mj dn mk ml mm dp mn jy mo mp mq kc mr ms mt kg mu mv mw mx bi translated">助手，去吧</h2><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="a083" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我认为你很聪明，能理解上面的代码；) .</p><p id="b127" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，我们现在可以运行代码了吗？在我的<strong class="jp ir"> github repo </strong>中，我包含了一个<a class="ae lf" href="https://github.com/s1s1ty/go-mysql-crud/blob/v1/makefile" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> makefile </strong> </a>，它可以帮助我们节省每次构建应用程序的时间。</p><p id="53ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果在代码目录中包含makefile，那么运行</p><pre class="km kn ko kp gt lv le lw lx aw ly bi"><span id="c7ac" class="lz ma iq le b gy mb mc l md me">make run</span></pre><p id="d56e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你没有，那就去建造主建筑</p><pre class="km kn ko kp gt lv le lw lx aw ly bi"><span id="aab6" class="lz ma iq le b gy mb mc l md me">go build .</span></pre><p id="7252" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它将在您的目录中创建一个二进制文件，并运行这个命令<code class="fe lb lc ld le b">$./wiki</code>，因为我们的目录名是wiki。到目前为止，我们的应用程序正在运行并服务于8005端口。</p><p id="db1c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要测试API，请打开postman并按顺序运行这些路由。比如说-</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi my"><img src="../Images/9b2239a21b2facf02eee913841f6272b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7PSfEHd-SGwQ4s_9Paucjg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">用于创建帖子</figcaption></figure><p id="83d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">易！我们已经完成了世俗的任务。同样，你可以从<a class="ae lf" href="https://github.com/s1s1ty/go-mysql-crud\" rel="noopener ugc nofollow" target="_blank"> github repo </a>找到完整的源代码。我还在那里添加了docker和docker-compose文件。</p><p id="78eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的下一个教程中，我将讨论如何美化我们的代码。</p><div class="mz na gp gr nb nc"><a href="https://medium.com/@shaonshaonty/beautify-your-golang-project-f795b4b453aa" rel="noopener follow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd ir gy z fp nh fr fs ni fu fw ip bi translated">美化您的Golang项目</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">组织你的golang项目和代码</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">medium.com</p></div></div><div class="nl l"><div class="nm l nn no np nl nq kv nc"/></div></div></a></div><p id="45e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你注意到任何错误，请在下面的评论框里给我留言。</p><p id="9cce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">如果你觉得这篇文章有帮助，请关注我的</strong><a class="ae lf" href="https://github.com/s1s1ty" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="lu">github/s1s1 ty</em></strong></a></p></div></div>    
</body>
</html>