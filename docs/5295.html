<html>
<head>
<title>Linux: setlocale: LC_ALL: cannot change locale (en_US.utf8) and Cyrillic symbols</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Linux: setlocale: LC_ALL:不能改变语言环境(en_US.utf8)和西里尔符号</h1>
<blockquote>原文：<a href="https://itnext.io/linux-setlocale-lc-all-cannot-change-locale-en-us-utf8-and-cyrillic-symbols-2d846fe3c166?source=collection_archive---------0-----------------------#2021-02-04">https://itnext.io/linux-setlocale-lc-all-cannot-change-locale-en-us-utf8-and-cyrillic-symbols-2d846fe3c166?source=collection_archive---------0-----------------------#2021-02-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/a6a587a35a2ba7e3d3526e8877c48ba0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*M8WP_RFKNaqRLSujd9Ik3w.png"/></div></figure><p id="3678" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Locales是一组环境变量，用于确定如何显示数据和时间(例如，一周的第一天)、符号编码(例如，如何显示西里尔符号)、执行<code class="fe ks kt ku kv b">ls</code>命令时的默认文件顺序等等。</p><p id="3fcc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这些变量是:</p><ul class=""><li id="37e9" class="kw kx iq jw b jx jy kb kc kf ky kj kz kn la kr lb lc ld le bi translated"><code class="fe ks kt ku kv b">LANG</code>:在没有其他与语言环境相关的环境变量的情况下，确定默认语言环境</li><li id="67e8" class="kw kx iq jw b jx lf kb lg kf lh kj li kn lj kr lb lc ld le bi translated"><code class="fe ks kt ku kv b">LANGUAGE</code>:后备消息翻译语言列表</li><li id="5319" class="kw kx iq jw b jx lf kb lg kf lh kj li kn lj kr lb lc ld le bi translated"><code class="fe ks kt ku kv b">LC_CTYPE</code>:字符分类和大小写转换</li><li id="3312" class="kw kx iq jw b jx lf kb lg kf lh kj li kn lj kr lb lc ld le bi translated"><code class="fe ks kt ku kv b">LC_NUMERIC</code>:数字格式</li><li id="da4f" class="kw kx iq jw b jx lf kb lg kf lh kj li kn lj kr lb lc ld le bi translated"><code class="fe ks kt ku kv b">LC_TIME</code>:日期和时间格式</li><li id="3e48" class="kw kx iq jw b jx lf kb lg kf lh kj li kn lj kr lb lc ld le bi translated"><code class="fe ks kt ku kv b">LC_COLLATE</code>:整理(排序)顺序</li><li id="c28e" class="kw kx iq jw b jx lf kb lg kf lh kj li kn lj kr lb lc ld le bi translated"><code class="fe ks kt ku kv b">LC_MONETARY</code>:货币格式</li><li id="6674" class="kw kx iq jw b jx lf kb lg kf lh kj li kn lj kr lb lc ld le bi translated"><code class="fe ks kt ku kv b">LC_MESSAGES</code>:互动文字和回应的格式</li><li id="a2ca" class="kw kx iq jw b jx lf kb lg kf lh kj li kn lj kr lb lc ld le bi translated"><code class="fe ks kt ku kv b">LC_PAPER</code>:区域默认纸张尺寸</li><li id="0319" class="kw kx iq jw b jx lf kb lg kf lh kj li kn lj kr lb lc ld le bi translated"><code class="fe ks kt ku kv b">LC_NAME</code>:名称格式</li><li id="4d5a" class="kw kx iq jw b jx lf kb lg kf lh kj li kn lj kr lb lc ld le bi translated"><code class="fe ks kt ku kv b">LC_ADDRESS</code>:用于街道或邮政地址格式化的约定</li><li id="441d" class="kw kx iq jw b jx lf kb lg kf lh kj li kn lj kr lb lc ld le bi translated"><code class="fe ks kt ku kv b">LC_TELEPHONE</code>:用于表示电话号码的惯例</li><li id="9e65" class="kw kx iq jw b jx lf kb lg kf lh kj li kn lj kr lb lc ld le bi translated"><code class="fe ks kt ku kv b">LC_MEASUREMENT</code>:区域内使用的默认测量系统</li><li id="6656" class="kw kx iq jw b jx lf kb lg kf lh kj li kn lj kr lb lc ld le bi translated"><code class="fe ks kt ku kv b">LC_IDENTIFICATION</code>:关于地区信息的元数据</li><li id="6010" class="kw kx iq jw b jx lf kb lg kf lh kj li kn lj kr lb lc ld le bi translated"><code class="fe ks kt ku kv b">LC_RESPONSE</code>:决定如何以本地语言显示响应(例如是和否)(不是由Debian GNU/Linux使用，而是由Ubuntu使用)</li><li id="55e1" class="kw kx iq jw b jx lf kb lg kf lh kj li kn lj kr lb lc ld le bi translated"><code class="fe ks kt ku kv b">LC_ALL</code>:覆盖所有其他语言环境变量(语言除外)</li></ul><h1 id="8fcc" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">区域设置和西里尔符号</h1><p id="f072" class="pw-post-body-paragraph ju jv iq jw b jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr ij bi translated">例如，在我的Arch Linux上运行KDE Konsole中的<code class="fe ks kt ku kv b"><a class="ae mn" href="https://vifm.info/manual.shtml" rel="noopener ugc nofollow" target="_blank">vifm</a></code>工具时，西里尔符号无法正确显示:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mo"><img src="../Images/b4bcce3333ba1ddb1c10260c25db8853.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gly-tX7g0FS3R22d.png"/></div></div></figure><p id="98bf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">并且从<code class="fe ks kt ku kv b"><a class="ae mn" href="https://vifm.info/manual.shtml" rel="noopener ugc nofollow" target="_blank">vifm</a></code>端子退出后产生错误信息:</p><pre class="mp mq mr ms gt mx kv my mz aw na bi"><span id="2a8c" class="nb ll iq kv b gy nc nd l ne nf">$ vifm<br/>/bin/bash: warning: setlocale: LC_ALL: cannot change locale (en_US.utf8)</span></pre><h1 id="a747" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">生成区域设置</h1><p id="63fe" class="pw-post-body-paragraph ju jv iq jw b jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr ij bi translated">检查<code class="fe ks kt ku kv b">/usr/lib/locale/</code>已经生成的语言环境必须存储在哪里——现在这里什么也没有:</p><pre class="mp mq mr ms gt mx kv my mz aw na bi"><span id="16c1" class="nb ll iq kv b gy nc nd l ne nf">$ ll /usr/lib/locale/<br/>total 0</span></pre><p id="97bc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">或者您可以通过调用<code class="fe ks kt ku kv b">locale -a</code>显示系统中现在可用的语言环境来进行检查:</p><pre class="mp mq mr ms gt mx kv my mz aw na bi"><span id="c0be" class="nb ll iq kv b gy nc nd l ne nf">$ locale -a<br/>C<br/>POSIX</span></pre><p id="14d0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，要添加一个新的区域设置，编辑<code class="fe ks kt ku kv b">locales.gen</code> -查找<code class="fe ks kt ku kv b">en_US.UTF-8</code>:</p><pre class="mp mq mr ms gt mx kv my mz aw na bi"><span id="baa0" class="nb ll iq kv b gy nc nd l ne nf">$ cat /etc/locale.gen | grep en_US.UTF-8<br/>en_US.UTF-8 UTF-8<br/>en_US.UTF-8 UTF-8</span></pre><p id="627b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">取消对<code class="fe ks kt ku kv b">en_US.UTF-8 UTF-8</code>字符串的注释，并运行语言环境生成器:</p><pre class="mp mq mr ms gt mx kv my mz aw na bi"><span id="21f2" class="nb ll iq kv b gy nc nd l ne nf">$ sudo locale-gen<br/>/bin/sh: warning: setlocale: LC_ALL: cannot change locale (en_US.utf8)<br/>Generating locales…<br/>en_US.UTF-8… done<br/>Generation complete.</span></pre><p id="f753" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">再次检查目录:</p><pre class="mp mq mr ms gt mx kv my mz aw na bi"><span id="43bb" class="nb ll iq kv b gy nc nd l ne nf">$ file /usr/lib/locale/locale-archive<br/>/usr/lib/locale/locale-archive: locale archive 11 strings</span></pre><p id="426d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">和<code class="fe ks kt ku kv b">locale -a</code>:</p><pre class="mp mq mr ms gt mx kv my mz aw na bi"><span id="4c9a" class="nb ll iq kv b gy nc nd l ne nf">$ locale -a<br/>C<br/>en_US.utf8<br/>POSIX</span></pre><p id="d8b2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">或者使用<code class="fe ks kt ku kv b">localedef</code>实用程序:</p><pre class="mp mq mr ms gt mx kv my mz aw na bi"><span id="03ef" class="nb ll iq kv b gy nc nd l ne nf">$ localedef — list-archive<br/>en_US.utf8</span></pre><p id="00a1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">又跑了一次<code class="fe ks kt ku kv b">vifm</code>:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mo"><img src="../Images/fe818d55414c5e75421c13fd5abef62a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IYUVconvlPyFoPHQ.png"/></div></div></figure><h1 id="16ba" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">区域设置参数</h1><p id="0d4b" class="pw-post-body-paragraph ju jv iq jw b jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr ij bi translated">您可以通过调用<code class="fe ks kt ku kv b">locale -k</code>来检查特定地区的各种参数:</p><pre class="mp mq mr ms gt mx kv my mz aw na bi"><span id="714b" class="nb ll iq kv b gy nc nd l ne nf">$ locale -k LC_TIME<br/>abday=”Sun;Mon;Tue;Wed;Thu;Fri;Sat”<br/>day=”Sunday;Monday;Tuesday;Wednesday;Thursday;Friday;Saturday”<br/>…<br/>first_weekday=1<br/>first_workday=2</span></pre><p id="6387" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在<code class="fe ks kt ku kv b">locale-gen</code>期间使用的<code class="fe ks kt ku kv b">/usr/share/i18n/locales/</code>目录中的相应文件中描述了语言环境。例如，对于<em class="ng"> en_US </em>，其<code class="fe ks kt ku kv b">LC_TIME</code>区域设置描述为:</p><pre class="mp mq mr ms gt mx kv my mz aw na bi"><span id="0de6" class="nb ll iq kv b gy nc nd l ne nf">LC_TIME<br/>abday   "Sun";"Mon";"Tue";"Wed";"Thu";"Fri";"Sat"<br/>day     "Sunday";/<br/>        "Monday";/<br/>        "Tuesday";/<br/>        "Wednesday";/<br/>        "Thursday";/<br/>        "Friday";/<br/>        "Saturday"<br/><br/>week 7;19971130;1<br/>abmon   "Jan";"Feb";/<br/>        "Mar";"Apr";/<br/>        "May";"Jun";/<br/>        "Jul";"Aug";/<br/>        "Sep";"Oct";/<br/>        "Nov";"Dec"<br/>mon     "January";/<br/>        "February";/<br/>        "March";/<br/>        "April";/<br/>        "May";/<br/>        "June";/<br/>        "July";/<br/>        "August";/<br/>        "September";/<br/>        "October";/<br/>        "November";/<br/>        "December"<br/>% Appropriate date and time representation (%c)<br/>d_t_fmt "%a %d %b %Y %r %Z"<br/>%<br/>% Appropriate date representation (%x)<br/>d_fmt   "%m//%d//%Y"<br/>%<br/>% Appropriate time representation (%X)<br/>t_fmt   "%r"<br/>%<br/>% Appropriate AM/PM time representation (%r)<br/>t_fmt_ampm "%I:%M:%S %p"<br/>%<br/>% Appropriate date and time representation for date(1).  This is<br/>% different from d_t_fmt for historical reasons and has been different<br/>% since 2000 when date_fmt was added as a GNU extension.  At the end<br/>% of 2018 it was adjusted to use 12H time (bug 24046) instead of 24H.<br/>date_fmt "%a %b %e %r %Z %Y"<br/>%<br/>% Strings for AM/PM<br/>%<br/>am_pm   "AM";"PM"<br/>END LC_TIME</span></pre><p id="eece" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对于<em class="ng"> ru_RU </em>其<code class="fe ks kt ku kv b">LC_TIME</code>设置了<code class="fe ks kt ku kv b">first_weekday</code>选项，参见<a class="ae mn" href="https://man7.org/linux/man-pages/man5/locale.5.html" rel="noopener ugc nofollow" target="_blank"> man 5 locale </a>，它指定了一周的第一天——星期一(列表中的第二天):</p><pre class="mp mq mr ms gt mx kv my mz aw na bi"><span id="5bd5" class="nb ll iq kv b gy nc nd l ne nf">...<br/>week 7;19971130;1<br/>first_weekday 2<br/>END LC_TIME<br/>...</span></pre><p id="9f8e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要将星期一设置为一周的第一天，请将<code class="fe ks kt ku kv b">LC_TIME</code>设置为<em class="ng"> ru_RU。UTF-8 </em>在<code class="fe ks kt ku kv b">/etc/locale.conf</code>档。首先在<code class="fe ks kt ku kv b">/etc/locale.gen</code>中取消注释，然后执行<code class="fe ks kt ku kv b">locale-gen</code>:</p><pre class="mp mq mr ms gt mx kv my mz aw na bi"><span id="3bdd" class="nb ll iq kv b gy nc nd l ne nf">LANG=en_US.UTF-8<br/>LC_TIME=ru_RU.UTF-8</span></pre><p id="ce89" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">或使用<code class="fe ks kt ku kv b">localectl</code>工具:</p><pre class="mp mq mr ms gt mx kv my mz aw na bi"><span id="6705" class="nb ll iq kv b gy nc nd l ne nf">$ localectl set-locale LC_TIME=ru_RU.UTF-8</span></pre><h1 id="5d0f" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">有用的链接</h1><ul class=""><li id="5479" class="kw kx iq jw b jx mi kb mj kf nh kj ni kn nj kr lb lc ld le bi translated">拱门维基上的<a class="ae mn" href="https://wiki.archlinux.org/index.php/Locale" rel="noopener ugc nofollow" target="_blank">区域设置</a></li><li id="f459" class="kw kx iq jw b jx lf kb lg kf lh kj li kn lj kr lb lc ld le bi translated"><a class="ae mn" href="https://linuxhint.com/locales_debian/" rel="noopener ugc nofollow" target="_blank">了解Debian GNU/Linux上的语言环境</a></li></ul></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><p id="79e9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="ng">最初发布于</em> <a class="ae mn" href="https://rtfm.co.ua/en/linux-setlocale-lc_all-cannot-change-locale-en_us-utf8-and-cyrillic-symbols/" rel="noopener ugc nofollow" target="_blank"> <em class="ng"> RTFM: Linux、DevOps和系统管理</em> </a> <em class="ng">。</em></p></div></div>    
</body>
</html>