<html>
<head>
<title>Async Forms: Avoiding jQuery callback hell</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">异步表单:避免jQuery回调地狱</h1>
<blockquote>原文：<a href="https://itnext.io/dealing-with-jquery-callback-hell-e37d621a1c5?source=collection_archive---------4-----------------------#2019-08-01">https://itnext.io/dealing-with-jquery-callback-hell-e37d621a1c5?source=collection_archive---------4-----------------------#2019-08-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e9c56d5bb947696166e22ee39f196303.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*amnSDw8kRq1WPxdoY_cyiQ.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://ancient-strengthening-technique-novel.fandom.com/wiki/Hell_Icefire_Phoenix" rel="noopener ugc nofollow" target="_blank">图片来源</a></figcaption></figure><p id="531f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">唉，jQuery还没死。曾经受人喜爱的最先进的图书馆，现在感觉像是开发人员屁股上的一根大刺。不管怎样，有数以千计的项目仍然在使用它，而我目前不幸地在其中一个项目上工作。</p><p id="a983" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以，我有一张登记表。以下是我需要做的:</p><ol class=""><li id="d0b9" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">验证所有信息在服务器端都是正确的</li><li id="4d0b" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">触发2FA协议，通过Twilio收集和验证用户的电话</li><li id="746d" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">令牌化条带卡详细信息并设置订阅</li><li id="1423" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">注册用户</li><li id="ecf9" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">如果以上一切正常，登录用户并重定向到他们的个人资料</li></ol><p id="3e25" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当然，所有这些都是一个没有任何步骤或会话存储的整体表单。为了火上浇油，整个事情是一个基于插件的架构，其中各个部分由各种插件注入，这些插件可以被启用和/或禁用。</p><p id="6a2d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">遗憾的是，试图用原生jQuery(甚至是普通的DOM)事件处理程序来完成所有这些工作实在是太难了。</p><p id="2f9b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">a)没有办法确保在表单发送到服务器之前执行验证处理程序，或者确保成功处理程序不会过早或过晚触发，</p><p id="b8ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">b)对于处理程序中的承诺，你无能为力——例如，如果你需要与服务器对话并等待其响应，然后再继续处理下一个处理程序，即事件处理程序是同步的，你所能做的就是返回<code class="fe lp lq lr ls b">true</code>或<code class="fe lp lq lr ls b">false</code>。</p><p id="1bb4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">c)很难处理错误，因为回调返回值的二进制性质。</p><p id="7276" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那你是做什么的？</p><p id="da6b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们可以这样做(我在这里使用RequireJS)会怎么样？</p><figure class="lt lu lv lw gt jr"><div class="bz fp l di"><div class="lx ly l"/></div></figure><p id="f240" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的例子中，我们有一个页面，它有一个表单和两个AMD模块，它们在不同的时间被加载，但是它们都想在表单的实例上注册它们的处理程序。我们的构造函数包装了<code class="fe lp lq lr ls b">form</code>，并允许我们注册<code class="fe lp lq lr ls b">onSubmit</code>、<code class="fe lp lq lr ls b">onSend</code>、<code class="fe lp lq lr ls b">onSuccess</code>和<code class="fe lp lq lr ls b">onError</code>处理程序。我们希望所有的<code class="fe lp lq lr ls b">onSubmit</code>处理程序都是异步的，我们希望它们都在数据被发送到服务器之前运行。一旦所有的<code class="fe lp lq lr ls b">onSubmit</code>处理程序成功解析，也就是说，当我们验证了所有的表单数据，标记了我们的条纹卡输入，执行了我们的2FA，我们就可以将数据发送到服务器。<code class="fe lp lq lr ls b">onSend</code>处理程序负责与服务器对话。一旦所有这些都异步完成，我们就可以执行我们的<code class="fe lp lq lr ls b">onSuccess</code>处理程序，即告诉用户数据已经发送，并将他们重定向到另一个页面。如果有错误，我们希望用<code class="fe lp lq lr ls b">onError</code>处理程序优雅地处理它们。</p><p id="822a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们创建我们的<code class="fe lp lq lr ls b">ajax/Form</code>模块，它将利用jQuery <code class="fe lp lq lr ls b">Deferrable</code>来实现我们想要的:</p><figure class="lt lu lv lw gt jr"><div class="bz fp l di"><div class="lx ly l"/></div></figure><p id="0f3c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就是这样。我希望您下次在碰壁试图获取遗留jQuery代码时可以尝试一下用异步逻辑提交复杂表单。</p></div></div>    
</body>
</html>