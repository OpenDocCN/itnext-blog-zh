<html>
<head>
<title>Avoiding rogue Node.js packages with good version dependencies in package.json</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在package.json中避免具有良好版本依赖性的流氓Node.js包</h1>
<blockquote>原文：<a href="https://itnext.io/avoiding-rogue-node-js-packages-with-good-version-dependencies-in-package-json-f586b9ec6e98?source=collection_archive---------2-----------------------#2022-01-25">https://itnext.io/avoiding-rogue-node-js-packages-with-good-version-dependencies-in-package-json-f586b9ec6e98?source=collection_archive---------2-----------------------#2022-01-25</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="99b6" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">不精确的依赖项声明为不安全的代码打开了大门</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/1dfba5eb020acf81adc5a3dd77cfe257.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bQX6MBUpVJv29U3T.jpg"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">图片由作者提供，Node.js徽标由Node.js Foundation提供</figcaption></figure><p id="eb63" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">到目前为止，Node.js应用程序中的大范围故障已经多次是由包含恶意软件的Node.js包引起的。如果坏代码进入我们的应用程序，会带来什么样的麻烦？这些坏代码拥有与您的应用程序相同的权限。如果坏代码不是立即显而易见的，而是窃取数据的隐形恶意软件，该怎么办？</p><p id="bd10" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">作为软件专业人员，我们的职责是确保我们的应用程序有尽可能少的问题。我们编写单元测试，我们雇佣一个质量工程师团队来关注产品质量，我们有错误报告系统，这样我们的客户可以通知我们问题，理想情况下，我们负责任地通过修复相关的错误来处理所有这样的报告。</p><p id="ead0" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">但是，有一天我们输入“<em class="lv"> npm安装&amp; &amp; npm更新</em>”时，我们的应用程序突然不能工作了。如果我们幸运的话，问题会很明显。有时问题是隐藏的，一些第三方软件包涉嫌窃取数据，或运行加密货币挖掘代码。</p><p id="ef09" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">当前的例子是，在2022年1月初，一名不满的软件包维护者更新了两个软件包——<em class="lv">colors</em>和<em class="lv">faker</em>——以包含恶意软件，导致应用程序明显行为不端，并包含关于亚伦·施瓦茨的消息。开发商之前已经</p><p id="a5d5" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><a class="ae lw" href="http://web.archive.org/web/20210704022108/https://github.com/Marak/faker.js/issues/1046" rel="noopener ugc nofollow" target="_blank">写</a>关于"<em class="lv">财富500强</em>"从开源程序员那里拿走免费工作，并且不支持他们。有问题的软件包被广泛使用，行为不端的更新代码引起了广泛的问题。</p><p id="81b6" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这不是第一次通过npm注册表中的包传播广泛的问题。而且，问题不仅限于Node.js包。例如，由于Log4J库包含安全漏洞，我们的Java开发人员面临着一个普遍的问题。在过去的一年中，白宫至少两次警告开源软件(</p><p id="837c" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><a class="ae lw" href="https://www.reuters.com/technology/white-house-warns-companies-step-up-cybersecurity-2021-06-03/" rel="noopener ugc nofollow" target="_blank">2021年6月</a>)，并已开始与软件行业合作改善开源软件的安全性(<a class="ae lw" href="https://www.bleepingcomputer.com/news/security/white-house-reminds-tech-giants-open-source-is-a-national-security-issue/" rel="noopener ugc nofollow" target="_blank">2022年1月</a>)。</p><p id="0d54" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">Node.js生态系统中的几个例子是:</p><ul class=""><li id="f41e" class="lx ly iu lb b lc ld lf lg li lz lm ma lq mb lu mc md me mf bi translated">【2022年1月<em class="lv">colors</em>和<em class="lv"> faker </em>的开发者将明显的恶意软件引入这些软件包，如上所述</li><li id="1c47" class="lx ly iu lb b lc mg lf mh li mi lm mj lq mk lu mc md me mf bi translated">【2021年12月—Discord使用的一个恶意npm包正在窃取Discord用户的凭据。</li><li id="4a32" class="lx ly iu lb b lc mg lf mh li mi lm mj lq mk lu mc md me mf bi translated"><a class="ae lw" href="https://thehackernews.com/2021/10/malicious-npm-packages-caught-running.html" rel="noopener ugc nofollow" target="_blank">2021年10月</a>发现三个恶意npm包正在运行加密货币挖掘代码。</li><li id="bf88" class="lx ly iu lb b lc mg lf mh li mi lm mj lq mk lu mc md me mf bi translated"><a class="ae lw" href="https://thehackernews.com/2021/09/critical-bug-reported-in-npm-package.html" rel="noopener ugc nofollow" target="_blank">2021年9月</a>一个广泛使用的软件包中报告了一个严重的安全漏洞。</li><li id="5803" class="lx ly iu lb b lc mg lf mh li mi lm mj lq mk lu mc md me mf bi translated"><a class="ae lw" href="https://blog.npmjs.org/post/141577284765/kik-left-pad-and-npm" rel="noopener ugc nofollow" target="_blank">2016年3月</a>一个包开发者陷入了一场关于他的一个包的名称纠纷，一气之下从npm库中删除了他所有的包。其中之一，<em class="lv"> left-pad </em>，被广泛使用，导致了各种各样的应用程序中断。</li></ul><p id="53d2" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这清楚地表明，npm包存储库对来自有意或无意地具有严重问题或恶意软件的包的问题是开放的。问题是——我们如何避免这些问题？</p><p id="1fe1" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">每种情况下的一个常见问题是<code class="fe ml mm mn mo b">package.json</code>中列出的包依赖关系。为了方便起见,<code class="fe ml mm mn mo b">dependencies</code>字段为我们提供了允许使用一系列包版本的选项。假设似乎是大多数包开发者是诚实的，如果版本N没问题，那么版本N+1也没问题。</p><p id="1117" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">使用<em class="lv">颜色</em>和<em class="lv">伪造者</em>以及<em class="lv">左键盘</em>的经验表明，这不是一个安全的假设。</p><p id="6ed0" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">仔细测试你的应用程序是很重要的，在某种程度上也可以测试第三方软件包。但是，重要的是不仅要测试它，还要注意包依赖关系中的版本号。</p><p id="b2f3" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">原则是——在用版本N测试你的应用程序后，那是你测试用的版本，你不允许应用程序用在不同的版本上，直到你用那个版本测试。</p><p id="43a7" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><code class="fe ml mm mn mo b">package.json</code>中的<code class="fe ml mm mn mo b">dependencies</code>字段是我们声明包依赖的方式。这是将代码自动组装到工作项目中的一个很好的方法，依赖项字段给了我们很大的灵活性。例如，我们可以直接从HTTP URL加载包，完全绕过npm这样的中央存储库。</p><p id="52c1" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">但是考虑这些npm包依赖版本说明符:<code class="fe ml mm mn mo b">&gt;version</code>、<code class="fe ml mm mn mo b">&gt;=version</code>、<code class="fe ml mm mn mo b">~version</code>、<code class="fe ml mm mn mo b">^version</code>、<code class="fe ml mm mn mo b">1.2.x</code>、<code class="fe ml mm mn mo b">*</code>和空字符串</p><p id="bb82" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这种类型的依赖声明允许安装您没有测试过的包版本。假设您根据依赖关系的<code class="fe ml mm mn mo b">version</code>版本测试了您的应用程序。这是不是意味着<code class="fe ml mm mn mo b">version + 1</code>也可以工作，你可以允许你的应用程序使用它，即使你还没有对那个版本进行测试？</p><p id="0a65" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这些说明符是一种便利，在大多数包中，破坏性的改变或恶意软件的引入不会发生。我们可以指定<code class="fe ml mm mn mo b">1.2.x</code>，并且知道我们的应用程序将自动更新到<code class="fe ml mm mn mo b">1.2</code>系列发布中的最新版本。在大多数情况下，这很有效，我们可以继续生活。直到有一天一个心怀不满的开发者发布了包含恶意软件的版本<code class="fe ml mm mn mo b">1.2.42</code>。</p><p id="9970" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">任何不精确的包依赖都容易出现这种问题。</p><p id="17d5" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">解决方法是在依赖项中明确使用精确的版本号。这意味着使用<code class="fe ml mm mn mo b">version</code>而不是类似<code class="fe ml mm mn mo b">&gt;version</code>的东西。</p><p id="e274" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我想我们对此都有责任，我确定。下面是我创建的应用程序之一的<code class="fe ml mm mn mo b">dependencies</code>:</p><pre class="kk kl km kn gu mp mo mq mr aw ms bi"><span id="9158" class="mt mu iu mo b gz mv mw l mx my">"dependencies": {<br/>    "archiver": "^5.3.x",<br/>    "cheerio": "1.0.0-rc.10",<br/>    "chokidar": "^3.5.2",<br/>    "commander": "^8.3.x",<br/>    "globfs": "^0.3.3",<br/>    "js-yaml": "^4.1.x",<br/>    "mime": "^3.x",<br/>    "sprintf-js": "^1.1.2",<br/>    "text-statistics": "0.1.1",<br/>    "unzipper": "^0.10.x",<br/>    "uuid": "^8.3.x",<br/>    "xmldom": "^0.6.x"<br/>}</span></pre><p id="a3de" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">很明显，我刚刚给了自己一个任务来清理这个。这是10个使用不精确版本号的依赖项。这些包裹中的任何一个都可能成为问题。对于每一个版本，可能会发布一个包含重大变化的更新，但我不会看到，因为我没有对该版本进行测试。</p><p id="0251" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">以这种方式声明依赖关系，我们试图避免什么？这是为了降低我们的管理费用。这是10个包，我必须以某种方式跟踪它们的状态，然后不时更新。每次都必须检查每个包的更新。更重要的是，我们如何自动得到安全漏洞的警告？</p><p id="41e7" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">一些可用的工具包括</p><ul class=""><li id="5f30" class="lx ly iu lb b lc ld lf lg li lz lm ma lq mb lu mc md me mf bi translated"><code class="fe ml mm mn mo b">npm audit</code>命令查询已知安全漏洞的数据库——例如<code class="fe ml mm mn mo b">xmldom</code>有一个已知的漏洞，但没有已知的修复</li><li id="b4c7" class="lx ly iu lb b lc mg lf mh li mi lm mj lq mk lu mc md me mf bi translated"><code class="fe ml mm mn mo b"><a class="ae lw" href="https://www.npmjs.com/package/npm-check-updates" rel="noopener ugc nofollow" target="_blank">npm-check-updates</a></code>列出有可用更新的依赖项</li><li id="448c" class="lx ly iu lb b lc mg lf mh li mi lm mj lq mk lu mc md me mf bi translated"><code class="fe ml mm mn mo b"><a class="ae lw" href="https://www.npmjs.com/package/npm-check" rel="noopener ugc nofollow" target="_blank">npm-check</a></code>还列出了更新可用的依赖项。这不仅扫描了<code class="fe ml mm mn mo b">package.json</code>，还扫描了<code class="fe ml mm mn mo b">require</code>和<code class="fe ml mm mn mo b">import</code>语句中引用的源代码。</li><li id="a3a1" class="lx ly iu lb b lc mg lf mh li mi lm mj lq mk lu mc md me mf bi translated"><code class="fe ml mm mn mo b">npm list --depth 0</code>命令列出了您的应用程序直接依赖的包</li><li id="1f23" class="lx ly iu lb b lc mg lf mh li mi lm mj lq mk lu mc md me mf bi translated"><code class="fe ml mm mn mo b">npm outdated</code>命令列出了有可用更新的软件包</li><li id="d1f7" class="lx ly iu lb b lc mg lf mh li mi lm mj lq mk lu mc md me mf bi translated"><code class="fe ml mm mn mo b">npm cache clean --force</code>清除npm缓存，这在进行更新时很有用</li></ul><p id="1b7d" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我们只能控制<code class="fe ml mm mn mo b">package.json</code>中列出的直接依赖项。这里提出的问题可能来自嵌套依赖，其中我们依赖的一个包依赖于一个损坏的包。这意味着让中间包的维护者对更新他们的依赖感兴趣。</p><h1 id="3791" class="mz mu iu bd na nb nc nd ne nf ng nh ni ka nj kb nk kd nl ke nm kg nn kh no np bi translated">关于作者</h1><p id="76a1" class="pw-post-body-paragraph kz la iu lb b lc nq jv le lf nr jy lh li ns lk ll lm nt lo lp lq nu ls lt lu in bi translated"><a class="ae lw" href="https://davidherron.com" rel="noopener ugc nofollow" target="_blank"><strong class="lb iv"><em class="lv">David Herron</em></strong></a><em class="lv">:David Herron是一名作家和软件工程师，专注于技术的明智使用。他对太阳能、风能和电动汽车等清洁能源技术特别感兴趣。David在硅谷从事了近30年的软件工作，从电子邮件系统到视频流，再到Java编程语言，他已经出版了几本关于Node.js编程和电动汽车的书籍。</em>在<code class="fe ml mm mn mo b">https://davidherron.com</code>了解更多关于大卫·赫伦的信息</p></div><div class="ab cl nv nw hy nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="in io ip iq ir"><p id="5e75" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><em class="lv">原载于【https://techsparx.com】<a class="ae lw" href="https://techsparx.com/nodejs/install/pinned-versions.html" rel="noopener ugc nofollow" target="_blank"><em class="lv"/></a><em class="lv">。</em></em></p></div></div>    
</body>
</html>