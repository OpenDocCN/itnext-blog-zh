<html>
<head>
<title>React testing: Unit vs Functional</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反应测试:单元与功能</h1>
<blockquote>原文：<a href="https://itnext.io/testing-react-components-ad8ec1df1ea2?source=collection_archive---------4-----------------------#2018-05-15">https://itnext.io/testing-react-components-ad8ec1df1ea2?source=collection_archive---------4-----------------------#2018-05-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1967487332016c5658dd5ede98b3fde3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hhLsfVTOfqZKCvio33Jejg.jpeg"/></div></div></figure><p id="25e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">测试非常重要。你只意识到当你不测试你的代码时，它会变成一大段代码，随时都有可能崩溃。随着代码开始编写测试也很重要，这样你就不会错过代码的任何部分。在这篇文章中，我们将讨论测试react组件以及<a class="ae kw" href="https://en.wikipedia.org/wiki/Unit_testing" rel="noopener ugc nofollow" target="_blank">单元测试</a>和<a class="ae kw" href="https://en.wikipedia.org/wiki/Functional_testing" rel="noopener ugc nofollow" target="_blank">功能测试</a>。</p><p id="2d3e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在这个<a class="ae kw" href="https://github.com/ErrorPro/react-testings" rel="noopener ugc nofollow" target="_blank">回购</a>里找到所有的代码。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="c132" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">功能样式代码</strong></p><p id="37bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我们说测试时，我们的意思是一个单元对于相同的输入返回相同的输出。但是我们怎么能确定它总是一样的呢？这就是<a class="ae kw" href="https://en.wikipedia.org/wiki/Functional_programming" rel="noopener ugc nofollow" target="_blank"> FP </a>帮助我们的地方。FP说每个函数都应该是纯的，但是纯函数是什么意思呢？你可以在<a class="ae kw" href="https://en.wikipedia.org/wiki/Pure_function" rel="noopener ugc nofollow" target="_blank">维基百科</a>上阅读，但这是一个简短的解释:</p><ol class=""><li id="0270" class="le lf iq ka b kb kc kf kg kj lg kn lh kr li kv lj lk ll lm bi translated">为相同的输入返回相同的输出。</li><li id="c58f" class="le lf iq ka b kb ln kf lo kj lp kn lq kr lr kv lj lk ll lm bi translated">返回值不能依赖于任何隐藏信息或内部状态。</li><li id="99fb" class="le lf iq ka b kb ln kf lo kj lp kn lq kr lr kv lj lk ll lm bi translated">没有副作用。副作用通常是网络请求、一些突变或可变对象。</li><li id="c8b0" class="le lf iq ka b kb ln kf lo kj lp kn lq kr lr kv lj lk ll lm bi translated">没有全局变量。函数不能依赖全局变量。</li><li id="d825" class="le lf iq ka b kb ln kf lo kj lp kn lq kr lr kv lj lk ll lm bi translated">不要覆盖参数。参数是不可变的。</li><li id="9ee4" class="le lf iq ka b kb ln kf lo kj lp kn lq kr lr kv lj lk ll lm bi translated">容易测试。不需要嘲笑或提供任何东西。一个函数需要的只是参数。</li></ol><p id="1ae1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">纯函数的基本例子是:</p><figure class="ls lt lu lv gt jr"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="3919" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是,“纯”react组件是什么样子的呢？这只是一个观点。转储组件。它只应该呈现道具，没有状态。这是一个<a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/how-to-structure-your-react-app-98c48e102aad">解释</a>如何将你的组件拆分为dump和smart。</p><figure class="ls lt lu lv gt jr"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="6616" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个组件总是为相同的属性呈现相同的html。</p><p id="b39c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">设置</strong></p><p id="bf29" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有一些工具可以帮助你测试你的代码。作为一名测试人员，我使用<a class="ae kw" href="https://facebook.github.io/jest/" rel="noopener ugc nofollow" target="_blank"> Jest </a>,因为它可以开箱即用。为了测试react组件，我们将使用<a class="ae kw" href="https://facebook.github.io/jest/docs/en/snapshot-testing.html" rel="noopener ugc nofollow" target="_blank"> Jest快照</a>和<a class="ae kw" href="https://reactjs.org/docs/test-renderer.html" rel="noopener ugc nofollow" target="_blank"> react-test-renderer </a>。Jest snapshot比较两个组件的输出，一个来自以前的运行(如果以前运行过)，另一个来自当前的运行。当我们第一次运行测试时，Jest会将组件的输出存储到一个文件中，稍后jest会将该“快照”与组件现在呈现的内容进行比较。React-renderer需要渲染组件并从中获取JSON，jest获取JSON并将其用作快照。</p><p id="88bf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">设置起来很简单，你需要做的就是在这里写<a class="ae kw" href="https://facebook.github.io/jest/docs/en/tutorial-react.html" rel="noopener ugc nofollow" target="_blank"/>(1个命令)。</p><p id="6ec2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">单元测试</strong></p><p id="8d0b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在单元测试中，一切都是一个单元。我们不测试任何功能，不测试任何数据，我们测试的一切都是有回报的。对于一个组件，它是HTML代码，对于一个函数，它可能是一切:函数，对象，布尔，字符串等等。</p><p id="c7df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们为小而纯的函数编写一个测试:</p><figure class="ls lt lu lv gt jr"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="0c6a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果2和2作为参数传递，sum函数总是返回4。相同的参数不可能得到不同的结果。</p><p id="6b07" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们为转储组件编写一个单元测试。</p><figure class="ls lt lu lv gt jr"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="bc4f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就是这样。单元测试只检查组件是否被正确呈现。它不检查是否调用了onClick函数。它给了我们什么？</p><ol class=""><li id="cf33" class="le lf iq ka b kb kc kf kg kj lg kn lh kr li kv lj lk ll lm bi translated">向我们保证一个组件的渲染和以前一样。</li><li id="327c" class="le lf iq ka b kb ln kf lo kj lp kn lq kr lr kv lj lk ll lm bi translated">组件被正确呈现。</li></ol><p id="693c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于4行代码来说还不错，但是我们能得到更多吗？我们可以。这就是功能测试帮助我们的地方。</p><p id="55d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">功能测试</strong></p><p id="5202" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们的函数有自己的状态呢？如果我们需要测试一个onClick函数被调用时传递了一些参数，该怎么办？假设我们有一个按钮，它以标签的形式显示点击次数，每当我们点击它时，它就会调用一个函数，这个函数以当前的点击次数作为道具传递。</p><figure class="ls lt lu lv gt jr"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="7906" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在这里可以测试的是:</p><ol class=""><li id="49eb" class="le lf iq ka b kb kc kf kg kj lg kn lh kr li kv lj lk ll lm bi translated">组件被正确呈现。</li><li id="8afb" class="le lf iq ka b kb ln kf lo kj lp kn lq kr lr kv lj lk ll lm bi translated">当组件被呈现时，计数器等于0。</li><li id="8867" class="le lf iq ka b kb ln kf lo kj lp kn lq kr lr kv lj lk ll lm bi translated">当我们点击按钮时，它只调用onChange函数。</li><li id="d0dc" class="le lf iq ka b kb ln kf lo kj lp kn lq kr lr kv lj lk ll lm bi translated">当我们点击按钮时，它会更新自己的状态，并用计数器调用onClick函数。</li></ol><p id="c2cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们从第一个开始:</p><figure class="ls lt lu lv gt jr"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="b4fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">很简单。</p><p id="eed6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第二，我们需要访问组件的状态。我们可以使用<code class="fe ly lz ma mb b">renderer.create</code>函数的一个实例来实现。</p><figure class="ls lt lu lv gt jr"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="0ae3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了测试第三个，我们需要使用<code class="fe ly lz ma mb b">jest.fn</code>作为模拟函数，稍后我们需要检查它是否被调用。</p><figure class="ls lt lu lv gt jr"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="fa7d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后一个但不是最不重要的。这里我们需要模拟点击按钮，我们可以用两种方法来实现:使用<a class="ae kw" href="https://reactjs.org/docs/test-utils.html" rel="noopener ugc nofollow" target="_blank">反应测试工具</a>或者使用<a class="ae kw" href="https://github.com/airbnb/enzyme" rel="noopener ugc nofollow" target="_blank">酶</a>。我更喜欢用第二种，因为它更简单，更直观。使用Enzyme，您还可以设置组件的上下文、属性，通过类名或标签(如JQuery)查找元素。只需<a class="ae kw" href="https://github.com/airbnb/enzyme#installation" rel="noopener ugc nofollow" target="_blank"> 1命令</a>即可设置。</p><figure class="ls lt lu lv gt jr"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="8839" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">结论</strong></p><p id="77a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们知道了react世界中单元测试和函数的区别。编写单元测试更快，但是它不会让你觉得你的组件工作正常。它只是向你保证一个组件被渲染，它看起来和它之前的渲染没有什么不同。如果你根本没有传递onClick函数，当用户试图点击你的组件时，你的组件可能会崩溃。功能测试很难写，因为你需要理解你在测试什么，但是它能给你更多。理想情况下，一起编写单元测试和功能测试会让你的应用程序没有bug，让你的用户满意。任何测试都是好的，如果它存在；)</p><p id="8e6d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下一步是什么？测试简单的react组件很容易，但是我们有relay、redux、react-intl、material-ui theme和其他组件吗？我们将在下一篇文章中讨论测试复杂的react组件。很快。</p></div></div>    
</body>
</html>