<html>
<head>
<title>Increase Node JS Server Performance by Serving Smaller, Faster Pre-Compressed Brotli &amp; Gzipped Files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过提供更小、更快的预压缩Brotli和Gzipped文件，提高Node JS服务器的性能</h1>
<blockquote>原文：<a href="https://itnext.io/increase-node-js-server-performance-by-serving-smaller-faster-pre-compressed-brotli-gzipped-499c8da37f6c?source=collection_archive---------0-----------------------#2019-12-03">https://itnext.io/increase-node-js-server-performance-by-serving-smaller-faster-pre-compressed-brotli-gzipped-499c8da37f6c?source=collection_archive---------0-----------------------#2019-12-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="001c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用一个简单的NodeJS脚本通过Brotli &amp; Gzip压缩您的生产资产。为您的JavaScript应用程序提供(或不提供)Webpack 4的后构建步骤。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/90d8bceab78e1897c35ed7b8b12a2ab4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2sk7iklY5NczdtVrFLYr9Q.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图为:静止的服务器</figcaption></figure><h2 id="b852" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">谁不喜欢毫不费力的性能提升呢？</h2><p id="d11c" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">尤其是不需要<strong class="lw iu"> 10，000行代码</strong>和<strong class="lw iu"> </strong>小时的<strong class="lw iu">重构……</strong>的性能提升更不用说<strong class="lw iu"> 9杯咖啡</strong>需要<strong class="lw iu"> </strong>来识别那10，000行新代码中的哪一行导致你的应用程序<strong class="lw iu">在你眼前燃烧</strong>。</p><blockquote class="mn mo mp"><p id="9a3b" class="lu lv mq lw b lx mr ju lz ma ms jx mc mt mu me mf mv mw mh mi mx my mk ml mm im bi translated">相信我，这是常有的事。</p></blockquote><p id="a9e6" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated">在我们进入代码之前，理解<strong class="lw iu">为什么压缩是必要的</strong>以及它能为你(和你的用户)做什么是很重要的。</p><h1 id="2db2" class="mz kz it bd la na nb nc ld nd ne nf lg jz ng ka lk kc nh kd lo kf ni kg ls nj bi translated">为什么压缩你的文件？</h1><p id="6ef2" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi nk translated">随着一个应用程序的平均规模每年都在增长<a class="ae nt" href="https://royal.pingdom.com/webpages-are-getting-larger-every-year-and-heres-why-it-matters/" rel="noopener ugc nofollow" target="_blank"/>，压缩网络上的文件变得越来越重要。更大的应用捆绑包<strong class="lw iu">需要浏览器</strong>在解析源代码和资产方面做更多的工作，随着应用变得越来越复杂，浏览器需要更长的时间来为用户呈现内容。</p><p id="b80d" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated">通过提供压缩文件，您可以<strong class="lw iu">减少向客户端(您用户的浏览器)的数据传输</strong>，显著减少花费在<strong class="lw iu">下载</strong> &amp; <strong class="lw iu">处理</strong>要显示的资源上的时间。压缩可以将资源的大小减少<strong class="lw iu">到</strong> <a class="ae nt" href="https://www.thinkwithgoogle.com/marketing-resources/data-measurement/mobile-page-speed-new-industry-benchmarks/" rel="noopener ugc nofollow" target="_blank"> <strong class="lw iu"> 72% </strong> </a>。</p><h1 id="5825" class="mz kz it bd la na nb nc ld nd ne nf lg jz ng ka lk kc nh kd lo kf ni kg ls nj bi translated">压缩在网络上的工作原理</h1><p id="3d60" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">超过80%的网站使用压缩。几乎所有的现代<strong class="lw iu">浏览器</strong>和网络<strong class="lw iu">服务器</strong>，都支持gzip。<strong class="lw iu"> Chrome </strong>、<strong class="lw iu"> Safari </strong>、<strong class="lw iu"> Firefox </strong>、<strong class="lw iu"> Edge </strong>都支持Brotli，包括他们的移动同行，虽然<strong class="lw iu">不是</strong> Opera Mini。</p><blockquote class="mn mo mp"><p id="b84b" class="lu lv mq lw b lx mr ju lz ma ms jx mc mt mu me mf mv mw mh mi mx my mk ml mm im bi translated">然而，不支持Brotli的浏览器可以使用其他压缩算法。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/60cea002c2e23d25afbebafbb00b88e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qmxB4DLFWprKTFqPuiQc2w.png"/></div></div></figure><div class="nv nw gp gr nx ny"><a href="https://caniuse.com/#search=gzip" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">我能用吗...HTML5、CSS3等的支持表</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">“我可以使用吗”提供了最新的浏览器支持表，以支持桌面和移动设备上的前端web技术…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">caniuse.com</p></div></div></div></a></div><p id="c6fd" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated">支持压缩的浏览器用<strong class="lw iu"> Accept-Encoding HTTP头</strong>指定它期望的压缩标准，它使用这个头作为如何<strong class="lw iu">解码</strong>资源的指令。然后由服务器使用<strong class="lw iu">内容编码HTTP头</strong>来提供压缩资源。然后，浏览器<strong class="lw iu">将内容解压缩为原始的未压缩版本</strong>，然后在浏览器中呈现。</p><h1 id="4b9f" class="mz kz it bd la na nb nc ld nd ne nf lg jz ng ka lk kc nh kd lo kf ni kg ls nj bi translated">动态与静态压缩</h1><p id="62ad" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">您是使用<strong class="lw iu">动态</strong>还是<strong class="lw iu">静态</strong>压缩取决于您的需求。</p><h2 id="e108" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">动态的</h2><p id="c174" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">动态压缩包括响应对资源的请求，按需压缩数据<strong class="lw iu"/>。因此，对于经常变化或频繁修改的资源，它通常是首选。<strong class="lw iu">动态。</strong>例如，应用程序生成的<strong class="lw iu"> </strong>资源<strong class="lw iu">将被视为<strong class="lw iu">动态</strong>。</strong></p><p id="b658" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated"><strong class="lw iu">然而</strong>，压缩是一项CPU密集型任务，每次压缩都会产生<strong class="lw iu">性能成本</strong>。可以指定压缩级别。例如，Gzip的级别1–9，级别1意味着<strong class="lw iu">更快的压缩</strong>，但是代价是它会导致<strong class="lw iu">比级别9更大的文件大小</strong>。因此，对于您的生产资产，<strong class="lw iu">选择静态压缩可能是有利的，这就是我们将使用预压缩脚本</strong>所做的事情。</p><h2 id="74a0" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">静态</h2><p id="48cb" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">静态压缩包括预先压缩每个文件<strong class="lw iu"/>，并在请求原始文件时交付此<strong class="lw iu">预压缩</strong>版本。</p><p id="f1e9" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated">例如，静态压缩的完美候选是在开发的<strong class="lw iu">构建</strong>阶段生成的文件和资产，例如<strong class="lw iu"> JavaScript </strong>、<strong class="lw iu"> CSS </strong>、<strong class="lw iu"> HTML </strong>和<strong class="lw iu">图像</strong>。这将<strong class="lw iu"> CPU密集型</strong>任务留给了负责<strong class="lw iu">构建</strong>生产资产的机器，不需要密集的服务器级处理。</p><p id="db76" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated">由于压缩的<strong class="lw iu">好处，静态压缩<strong class="lw iu">减少了处理资源时浏览器和服务器之间的延迟</strong>，此外<strong class="lw iu">避免了按需压缩每个文件的速度损失</strong>。</strong></p><h2 id="c0d2" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">什么是Gzip(。gz)？</h2><p id="4ce3" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">gzip文件是一种压缩数据格式<strong class="lw iu">的文件，是gzip实用程序的结果。</strong></p><blockquote class="oh"><p id="d3a6" class="oi oj it bd ok ol om on oo op oq mm dk translated">Gzip是一个单文件/流无损数据压缩实用程序，生成的压缩文件通常有<a class="ae nt" href="https://www.gzip.org" rel="noopener ugc nofollow" target="_blank">后缀。gz </a></p></blockquote><h2 id="b9aa" class="ky kz it bd la lb or dn ld le os dp lg lh ot lj lk ll ou ln lo lp ov lr ls lt bi translated">什么是Brotli(。br)？</h2><p id="61d6" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">Brotli的压缩比可与目前最好的通用压缩方法相媲美。</p><blockquote class="oh"><p id="b866" class="oi oj it bd ok ol om on oo op oq mm dk translated">Brotli是一种通用的无损压缩算法，它压缩带有后缀<strong class="ak">的数据<a class="ae nt" href="https://github.com/google/brotli" rel="noopener ugc nofollow" target="_blank">。br </a></strong> </p></blockquote><p id="f3a5" class="pw-post-body-paragraph lu lv it lw b lx ow ju lz ma ox jx mc lh oy me mf ll oz mh mi lp pa mk ml mm im bi translated"><a class="ae nt" href="https://certsimple.com/blog/nginx-brotli" rel="noopener ugc nofollow" target="_blank">性能指标评测</a>展示了与gzip相当的优势。<strong class="lw iu"> Javascript文件通常比</strong>小14%，<strong class="lw iu"> HTML文件通常比</strong>小21%，此外<strong class="lw iu">CSS文件的文件大小也减少了17%。</strong></p></div><div class="ab cl pb pc hx pd" role="separator"><span class="pe bw bk pf pg ph"/><span class="pe bw bk pf pg ph"/><span class="pe bw bk pf pg"/></div><div class="im in io ip iq"><h1 id="696b" class="mz kz it bd la na pi nc ld nd pj nf lg jz pk ka lk kc pl kd lo kf pm kg ls nj bi translated">如何压缩资源(创建compress.js)</h1><p id="4ea9" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">我们将两者都生成<strong class="lw iu">。br和。gz文件</strong>以获得最广泛的兼容性，因为并非所有浏览器都支持Brotli。我们将创建一个可以用作<strong class="lw iu">后期构建</strong>步骤的<strong class="lw iu"> NodeJS脚本</strong>。</p><h2 id="3a19" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">属国</h2><p id="2e89" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">我们将依靠<code class="fe pn po pp pq b">brotli</code>和<code class="fe pn po pp pq b">zlib</code>来处理压缩。我们还将使用<strong class="lw iu">内置的</strong> <code class="fe pn po pp pq b">fs</code>模块来处理文件，并确定<strong class="lw iu">哪些文件</strong>需要压缩。</p><div class="nv nw gp gr nx ny"><a href="https://www.npmjs.com/package/zlib" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">zlib</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">node-zlib——node . js缓冲区的简单同步放气/充气。使用npm安装zlib。var Buffer =…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">www.npmjs.com</p></div></div><div class="pr l"><div class="ps l pt pu pv pr pw ks ny"/></div></div></a></div><div class="nv nw gp gr nx ny"><a href="https://www.npmjs.com/package/brotli" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">布罗特利</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">Brotli.js是Brotli压缩算法(用于WOFF2字体格式)到JavaScript的端口。的…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">www.npmjs.com</p></div></div><div class="pr l"><div class="px l pt pu pv pr pw ks ny"/></div></div></a></div><h2 id="7be0" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">首先，我们需要从节点包管理器安装依赖项</h2><pre class="kj kk kl km gt py pq pz qa aw qb bi"><span id="933a" class="ky kz it pq b gy qc qd l qe qf"><strong class="pq iu">$</strong> npm install zlib brotli --save-dev</span></pre><p id="4c9c" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated">这将把依赖项作为开发依赖项添加到我们的<code class="fe pn po pp pq b">package.json</code>中。</p><h2 id="3dee" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">接下来，我们创建新的JavaScript文件。</h2><p id="b768" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">让我们称我们的剧本为<code class="fe pn po pp pq b">compress.js</code>。</p><p id="e3b0" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated">所以…</p><pre class="kj kk kl km gt py pq pz qa aw qb bi"><span id="8f58" class="ky kz it pq b gy qc qd l qe qf"><strong class="pq iu">$</strong> touch compress.js</span></pre><p id="aa01" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated">或者使用GUI来创建文件。</p><h1 id="2485" class="mz kz it bd la na nb nc ld nd ne nf lg jz ng ka lk kc nh kd lo kf ni kg ls nj bi translated">内部压缩. js</h1><h2 id="68bf" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">导入依赖项</h2><p id="201a" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">首先，我们需要在文件的顶部导入依赖项。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="qg qh l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">属国</figcaption></figure><h2 id="44ff" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">压缩配置</h2><p id="3750" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">我们还需要为brotli 指定<strong class="lw iu">配置。我们将使用<strong class="lw iu">级别10 </strong>来实现这些目的，因为我们需要更高的压缩率，我们并不太关心压缩所花费的时间，因为这是一个构建步骤，将在本地<strong class="lw iu">运行</strong>。</strong></p><p id="8985" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated">如果你对<strong class="lw iu">比较压缩/解压缩速度</strong>感兴趣，考虑到不同的压缩级别，那么你可以看看下面的<strong class="lw iu">挤压压缩基准</strong>。</p><div class="nv nw gp gr nx ny"><a href="https://quixdb.github.io/squash-benchmark/#results-table" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">挤压压缩基准</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">好吧，好吧，我是在发布网址之前写这篇文章的，所以与其说是“常见问题”，不如说是“我认为…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">quixdb.github.io</p></div></div></div></a></div><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="qg qh l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">布罗特利构型</figcaption></figure><blockquote class="mn mo mp"><p id="e435" class="lu lv mq lw b lx mr ju lz ma ms jx mc mt mu me mf mv mw mh mi mx my mk ml mm im bi translated">出于这些目的，我们将让zlib (gzip)配置为空，它默认使用<strong class="lw iu">级别6</strong>(可能值为1–9)。</p></blockquote><h2 id="7953" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">指定要包含的目录</h2><p id="94cd" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">让我们指定需要压缩的目录。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="qg qh l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">指定要包含的目录</figcaption></figure><p id="b842" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated">我们需要遍历每个目录和文件。我们使用<code class="fe pn po pp pq b">forEach</code>和<code class="fe pn po pp pq b">fs.readdirSync</code>来获得一个文件数组。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="qg qh l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">遍历目录</figcaption></figure><p id="e3a1" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated">我们还需要一种方法来检查文件是否适合压缩。我们可以通过检查扩展来做到这一点，看看它是否是一个<strong class="lw iu"> HTML(。html)、</strong> <strong class="lw iu"> CSS(。css)或JS(。js)文件</strong>。我们可以使用字符串方法<code class="fe pn po pp pq b">endsWith</code>来检查字符串的结尾。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="qg qh l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">遍历目录时检查文件扩展名</figcaption></figure><h2 id="2132" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">现在压缩</h2><p id="1fc2" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">对于每个符合上述<code class="fe pn po pp pq b">endsWith</code>检查的文件，我们用<strong class="lw iu"> Brotli </strong>压缩，将config对象作为参数传递。我们阅读了通过<code class="fe pn po pp pq b">fs.readFileSync</code>传给Brotli的文件。然后我们写出结果。br文件到相同的名称+的。br分机。</p><p id="f0c1" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated">对于<strong class="lw iu"> zlib </strong> (gzip)，我们需要创建一个<code class="fe pn po pp pq b">readStream</code>和一个<code class="fe pn po pp pq b">writeStream</code>，因为我们<a class="ae nt" href="https://www.sitepoint.com/basics-node-js-streams/" rel="noopener ugc nofollow" target="_blank"> <strong class="lw iu">用来自<code class="fe pn po pp pq b">zlib</code>模块的返回值<code class="fe pn po pp pq b">createGzip()</code>来管道<code class="fe pn po pp pq b">readStream</code>的内容，其中<code class="fe pn po pp pq b">pipe</code>为我们处理流。然后，我们使用产生的流通过。gz扩展。</strong></a></p><p id="0ab6" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated">在这个例子中，我们<strong class="lw iu">通过对控制台的‘error’事件回调打印错误</strong>，但是如果你愿意，你可以用不同的方式处理它们。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="qg qh l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">主压缩代码</figcaption></figure><p id="fc10" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated">你可以在下面看到完整的脚本…</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="qg qh l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">完整compress.js文件</figcaption></figure><h2 id="8bd7" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">执行文件</h2><p id="d459" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">这就像在你的npm项目脚本中添加<code class="fe pn po pp pq b">node compress.js</code>作为<strong class="lw iu">构建步骤一样简单。</strong></p><pre class="kj kk kl km gt py pq pz qa aw qb bi"><span id="2ae1" class="ky kz it pq b gy qc qd l qe qf">"scripts": {</span><span id="30c0" class="ky kz it pq b gy qi qd l qe qf">    "compress": "node compress.js"</span><span id="e7c3" class="ky kz it pq b gy qi qd l qe qf">...</span></pre><p id="aa6e" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated">然后您可以使用<code class="fe pn po pp pq b"><strong class="lw iu">$</strong> npm run compress</code>执行脚本🚀。</p><p id="ccfd" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated">让我们看看<code class="fe pn po pp pq b">main.js</code>(我拥有的一个生产构建文件)的结果，以确定最终的文件大小。咱们<code class="fe pn po pp pq b"><strong class="lw iu">$ </strong>du -h ./server/main.js</code>吧。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi qj"><img src="../Images/408ffe1e165bfb69aea682904d93f869.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/1*W5Eg4sl1y4MubVbHbFDVRg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">原始文件</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi qj"><img src="../Images/981028d86110d316d854f8da7f199cbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/1*W9JgUSZ0oRNIjsnhL4Wn3g.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">gzipped文件</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi qj"><img src="../Images/1168da54d63288c0a58ff898ff533724.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/1*oeE4bVDv2psWY-Atyb6zew.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">布罗特利的档案</figcaption></figure><p id="7685" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated">如您所见，这是一笔<strong class="lw iu">巨大的节省。</strong>特别是与<strong class="lw iu"> Brotli </strong>。压缩后的资源减少了85%!</p></div><div class="ab cl pb pc hx pd" role="separator"><span class="pe bw bk pf pg ph"/><span class="pe bw bk pf pg ph"/><span class="pe bw bk pf pg"/></div><div class="im in io ip iq"><h1 id="8faf" class="mz kz it bd la na pi nc ld nd pj nf lg jz pk ka lk kc pl kd lo kf pm kg ls nj bi translated">使用Webpack</h1><p id="8b57" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">用Webpack创建同样的效果就像包含插件<code class="fe pn po pp pq b">compression-webpack-plugin</code>和<code class="fe pn po pp pq b">brotli-webpack-plugin</code>一样简单。</p><h2 id="095b" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">将依赖项作为开发依赖项安装。</h2><pre class="kj kk kl km gt py pq pz qa aw qb bi"><span id="a3cb" class="ky kz it pq b gy qc qd l qe qf"><strong class="pq iu">$</strong> npm i compression-webpack-plugin brotli-webpack-plugin --save-dev</span></pre><div class="nv nw gp gr nx ny"><a href="https://www.npmjs.com/package/compression-webpack-plugin" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">压缩-web pack-插件</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">准备资产的压缩版本，通过内容编码为它们服务。该模块最少需要节点…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">www.npmjs.com</p></div></div><div class="pr l"><div class="qk l pt pu pv pr pw ks ny"/></div></div></a></div><div class="nv nw gp gr nx ny"><a href="https://www.npmjs.com/package/brotli-webpack-plugin" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">brot Li-web pack-插件</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">此插件使用Brotli压缩算法压缩资源，使用zlib、iltorb或brotli.js库提供…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">www.npmjs.com</p></div></div><div class="pr l"><div class="ql l pt pu pv pr pw ks ny"/></div></div></a></div><p id="b3c7" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated">这将使我们能够将插件包含到我们的<code class="fe pn po pp pq b">webpack.config.js</code>文件中。</p><h2 id="c2a6" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">Webpack配置</h2><p id="e903" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">要注意的价值观是…</p><p id="da4e" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated"><strong class="lw iu">阈值</strong></p><ul class=""><li id="6924" class="qm qn it lw b lx mr ma ms lh qo ll qp lp qq mm qr qs qt qu bi translated">仅处理大于此大小的资产。以字节表示</li></ul><p id="d713" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated"><strong class="lw iu">测试</strong></p><ul class=""><li id="caf9" class="qm qn it lw b lx mr ma ms lh qo ll qp lp qq mm qr qs qt qu bi translated">指定要包含的扩展名(通过正则表达式测试)。</li></ul><p id="6261" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated"><strong class="lw iu">最小比率</strong></p><ul class=""><li id="451e" class="qm qn it lw b lx mr ma ms lh qo ll qp lp qq mm qr qs qt qu bi translated">仅处理压缩率高于此比率的资产。</li></ul><p id="eb58" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated"><strong class="lw iu">级别</strong></p><ul class=""><li id="726a" class="qm qn it lw b lx mr ma ms lh qo ll qp lp qq mm qr qs qt qu bi translated">指定压缩级别。</li></ul><p id="52c4" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated">我们还没有指定压缩级别，因此我们将使用默认的进行演示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="qg qh l"/></div></figure><p id="a452" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mu me mf ll mw mh mi lp my mk ml mm im bi translated">这里是一个使用压缩插件的Angular项目的示例<code class="fe pn po pp pq b">webpack.config.js</code>文件，以查看它在<strong class="lw iu">完整上下文</strong>中的用法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="qg qh l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">完整的webpack.config.js</figcaption></figure><h2 id="ebfc" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">就是这样！</h2><p id="9021" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">快速轻松地提升应用性能，改善用户体验。</p><h1 id="dc22" class="mz kz it bd la na nb nc ld nd ne nf lg jz ng ka lk kc nh kd lo kf ni kg ls nj bi translated">一些有用的资源</h1><div class="nv nw gp gr nx ny"><a href="https://www.opencpu.org/posts/brotli-benchmarks/" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">压缩基准:brotli、gzip、xz、bz2</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">2015年11月27日Brotli是一种新的压缩算法，针对web进行了优化，尤其是小型文本文档…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">www.opencpu.org</p></div></div><div class="pr l"><div class="qv l pt pu pv pr pw ks ny"/></div></div></a></div><div class="nv nw gp gr nx ny"><a href="https://github.com/google/brotli" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">谷歌/brotli</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">Brotli压缩格式。在GitHub上创建一个帐户，为google/brotli的发展做出贡献。</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">github.com</p></div></div><div class="pr l"><div class="qw l pt pu pv pr pw ks ny"/></div></div></a></div><div class="nv nw gp gr nx ny"><a href="https://tools.keycdn.com/brotli-test" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">Brotli测试-验证Brotli压缩支持| KeyCDN工具</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">测试服务器是否支持Brotli压缩。Brotli算法是Gzip的后继者，它允许更好的…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">tools.keycdn.com</p></div></div><div class="pr l"><div class="qx l pt pu pv pr pw ks ny"/></div></div></a></div><div class="nv nw gp gr nx ny"><a href="https://blog.cloudflare.com/results-experimenting-brotli/" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">Brotli用于动态web内容的试验结果</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">压缩是CloudFlare提升网站性能的最重要工具之一。压缩内容…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">blog.cloudflare.com</p></div></div><div class="pr l"><div class="qy l pt pu pv pr pw ks ny"/></div></div></a></div><h2 id="4e5b" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">如果您有任何问题，或任何与这里讨论的任何内容相关的问题，请随时评论或留言，我会尽全力帮助您！</h2></div></div>    
</body>
</html>