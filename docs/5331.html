<html>
<head>
<title>Low-Hanging Fruits of Web Security</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">网络安全唾手可得的成果</h1>
<blockquote>原文：<a href="https://itnext.io/low-hanging-fruits-of-web-security-58a1016944bb?source=collection_archive---------2-----------------------#2021-02-11">https://itnext.io/low-hanging-fruits-of-web-security-58a1016944bb?source=collection_archive---------2-----------------------#2021-02-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="ec54" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">我谈到了在您的web应用程序中实现公共标题来增加其安全性。</p></blockquote><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/15f6844aca291e38bb5770b8d28970b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RAEYj2tuGoZDgpmzR9aswQ.jpeg"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">马丁·奥尔森在<a class="ae lf" href="https://unsplash.com/s/photos/fence?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h2 id="8904" class="lg lh iq bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">头球</h2><ol class=""><li id="039f" class="mc md iq jt b ju me jy mf lp mg lt mh lx mi ko mj mk ml mm bi translated"><code class="fe mn mo mp mq b">Access-Control-Allow-Origin</code>:定义可以访问您的内容的域。<a class="ae lf" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin" rel="noopener ugc nofollow" target="_blank"> MDN链接</a>。</li><li id="de6c" class="mc md iq jt b ju mr jy ms lp mt lt mu lx mv ko mj mk ml mm bi translated"><code class="fe mn mo mp mq b">Permissions-Policy</code>:定义您的web应用程序可以请求的权限。<a class="ae lf" href="https://w3c.github.io/webappsec-permissions-policy/#permissions-policy-http-header-field" rel="noopener ugc nofollow" target="_blank"> W3C链接</a>。</li><li id="fe6d" class="mc md iq jt b ju mr jy ms lp mt lt mu lx mv ko mj mk ml mm bi translated"><code class="fe mn mo mp mq b">Referrer-Policy</code>:定义当你从链接A转到链接B时，你与链接B共享多少关于链接A的信息。</li><li id="b36a" class="mc md iq jt b ju mr jy ms lp mt lt mu lx mv ko mj mk ml mm bi translated"><code class="fe mn mo mp mq b">Strict-Transport-Security</code>:定义在访问您的web应用程序时<code class="fe mn mo mp mq b">https://</code>是否应该是强制的。<a class="ae lf" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security" rel="noopener ugc nofollow" target="_blank"> MDN链接</a>。</li><li id="d438" class="mc md iq jt b ju mr jy ms lp mt lt mu lx mv ko mj mk ml mm bi translated"><code class="fe mn mo mp mq b">X-Content-Type-Options</code>:强制内容为定义的类型。<a class="ae lf" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options" rel="noopener ugc nofollow" target="_blank"> MDN链接</a>。</li><li id="c60e" class="mc md iq jt b ju mr jy ms lp mt lt mu lx mv ko mj mk ml mm bi translated"><code class="fe mn mo mp mq b">X-Frame-Options</code>:定义您的web应用程序是否可以在<code class="fe mn mo mp mq b">iframe</code>或其他嵌入元素中加载。<a class="ae lf" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options" rel="noopener ugc nofollow" target="_blank"> MDN链接</a>。</li><li id="9969" class="mc md iq jt b ju mr jy ms lp mt lt mu lx mv ko mj mk ml mm bi translated"><code class="fe mn mo mp mq b">X-XSS-Protection</code>:定义跨站脚本过滤级别。<a class="ae lf" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-XSS-Protection" rel="noopener ugc nofollow" target="_blank"> MDN链接</a>。</li></ol><h2 id="5021" class="lg lh iq bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">例子</h2><p id="8d75" class="pw-post-body-paragraph jq jr iq jt b ju me jw jx jy mf ka kb lp mw ke kf lt mx ki kj lx my km kn ko ij bi translated">假设你有一个托管在https://example.com的网络应用:</p><pre class="kq kr ks kt gt mz mq na nb aw nc bi"><span id="bd29" class="lg lh iq mq b gy nd ne l nf ng">const HEADERS = [<br/>  {<br/>    key: 'Access-Control-Allow-Origin',<br/>    value: '<a class="ae lf" href="https://example.com'" rel="noopener ugc nofollow" target="_blank">https://example.com'</a><br/>  },<br/>  {<br/>    key: 'Permissions-Policy',<br/>    value: 'autoplay=(), camera=(), fullscreen=(), geolocation=(), microphone=()'<br/>  },<br/>  {<br/>    key: 'Referrer-Policy',<br/>    value: 'no-referrer'<br/>  },<br/>  {<br/>    key: 'Strict-Transport-Security',<br/>    value: 'max-age=63072000; includeSubDomains; preload'<br/>  },<br/>  {<br/>    key: 'X-Content-Type-Options',<br/>    value: 'nosniff'<br/>  },<br/>  {<br/>    key: 'X-Frame-Options',<br/>    value: 'DENY'<br/>  },<br/>  {<br/>    key: 'X-XSS-protection',<br/>    value: '1; mode=block'<br/>  }<br/>]</span></pre><p id="17a4" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lt kh ki kj lx kl km kn ko ij bi translated">在Vercel上部署的Next.js应用程序中，您可以像这样设置<code class="fe mn mo mp mq b">next.config.js</code>中的头:</p><pre class="kq kr ks kt gt mz mq na nb aw nc bi"><span id="e034" class="lg lh iq mq b gy nd ne l nf ng">// next.config.js</span><span id="d23a" class="lg lh iq mq b gy nh ne l nf ng">const headers = async () =&gt; [<br/>  {<br/>    source: '/(.*)',<br/>    headers: // Paste HEADERS here<br/>  }<br/>];</span><span id="2223" class="lg lh iq mq b gy nh ne l nf ng">module.exports = {<br/>  headers<br/>};</span></pre><p id="f0ac" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lt kh ki kj lx kl km kn ko ij bi translated">在Firebase主机上部署的spa上，您可以像这样设置<code class="fe mn mo mp mq b">firebase.json</code>中的头:</p><pre class="kq kr ks kt gt mz mq na nb aw nc bi"><span id="ec62" class="lg lh iq mq b gy nd ne l nf ng">// firebase.json</span><span id="8e6d" class="lg lh iq mq b gy nh ne l nf ng">{<br/>  "hosting": {<br/>    "headers": [<br/>      {<br/>        "source": "**",<br/>        "headers": // Paste HEADERS here<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="d0fc" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lt kh ki kj lx kl km kn ko ij bi translated">您可能希望更改<code class="fe mn mo mp mq b">Access-Control-Allow-Origin</code>标题的值，以允许<a class="ae lf" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="noopener ugc nofollow" target="_blank"> CORS </a>。</p><p id="c336" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lt kh ki kj lx kl km kn ko ij bi translated">您可能还想根据您想要请求的权限来更改<code class="fe mn mo mp mq b">Permissions-Policy</code>头的值。</p><h2 id="8582" class="lg lh iq bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">CSP:安全报头之王</h2><p id="dae8" class="pw-post-body-paragraph jq jr iq jt b ju me jw jx jy mf ka kb lp mw ke kf lt mx ki kj lx my km kn ko ij bi translated"><code class="fe mn mo mp mq b">Content-Security-Policy</code> ( <a class="ae lf" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" rel="noopener ugc nofollow" target="_blank"> MDN link </a>)是一个非常强大的头，因为它结合了各种策略，允许您以细粒度的方式定义web应用的安全策略。第一次尝试很难做对，所以它不应该被列入上面的“低挂水果”清单——但是你不应该跳过它。它保证访问者在你的网络应用上有一个安全的时间。</p><p id="d4b7" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lt kh ki kj lx kl km kn ko ij bi translated">要为您的web应用程序构建最紧密的CSP，建议从锁定的策略开始，并在进行过程中打开它们。Chrome对CSP违规的描述非常详细，因此很容易知道下一步要开放哪个策略。测试你的web应用的所有特性以确保没有违规是很重要的。每次对任何策略进行更改时都使用新的匿名窗口，以确保您没有使用缓存的结果。</p><p id="1876" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lt kh ki kj lx kl km kn ko ij bi translated">通常在开发过程中禁用CSP以允许工具正常工作。您可以在开发过程中使用环境变量来禁用CSP。下面是一个使用Google字体的Next.js应用程序的CSP头配置示例(注意环境变量<code class="fe mn mo mp mq b">NEXT_PUBLIC_IS_PRODUCTION</code>的用法):</p><pre class="kq kr ks kt gt mz mq na nb aw nc bi"><span id="278c" class="lg lh iq mq b gy nd ne l nf ng">// next.config.js</span><span id="b6e2" class="lg lh iq mq b gy nh ne l nf ng">const HEADERS = [</span><span id="1ad3" class="lg lh iq mq b gy nh ne l nf ng">  ...,</span><span id="ad9d" class="lg lh iq mq b gy nh ne l nf ng">  {<br/>    key: 'Content-Security-Policy',<br/>    value: process.env.NEXT_PUBLIC_IS_PRODUCTION === 'true' ? "connect-src 'self'; default-src 'self'; font-src <a class="ae lf" href="https://fonts.gstatic.com" rel="noopener ugc nofollow" target="_blank">https://fonts.gstatic.com</a>; img-src 'self' data:; manifest-src 'self'; object-src 'none'; script-src 'self'; style-src 'self' <a class="ae lf" href="https://fonts.googleapis.com" rel="noopener ugc nofollow" target="_blank">https://fonts.googleapis.com</a> 'unsafe-inline'; upgrade-insecure-requests;" : ''<br/>  },</span><span id="be36" class="lg lh iq mq b gy nh ne l nf ng">  ...</span><span id="edff" class="lg lh iq mq b gy nh ne l nf ng">]</span></pre><p id="66e0" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lt kh ki kj lx kl km kn ko ij bi translated">您可以使用Google的<a class="ae lf" href="https://csp-evaluator.withgoogle.com" rel="noopener ugc nofollow" target="_blank"> CSP评估工具</a>来评估您的政策的严格程度。</p><h2 id="36ca" class="lg lh iq bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">量化结果</h2><p id="beb6" class="pw-post-body-paragraph jq jr iq jt b ju me jw jx jy mf ka kb lp mw ke kf lt mx ki kj lx my km kn ko ij bi translated"><a class="ae lf" href="https://observatory.mozilla.org" rel="noopener ugc nofollow" target="_blank"> Mozilla Observatory </a>之于Web安全，正如<a class="ae lf" href="https://developers.google.com/web/tools/lighthouse" rel="noopener ugc nofollow" target="_blank"> Lighthouse </a>之于Web性能。它会对您的web应用程序的安全性进行评级，并提供改进评级的建议。它还集成了像<a class="ae lf" href="https://securityheaders.com" rel="noopener ugc nofollow" target="_blank">安全头</a>这样的第三方扫描器，所以你可以有多种意见。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ni"><img src="../Images/17f5f3b54895c990a299080786116f1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f2ZIsJENnZRypbIzZpCY3w.png"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated"><a class="ae lf" href="https://observatory.mozilla.org" rel="noopener ugc nofollow" target="_blank"> Mozilla Observatory </a>的安全评分<a class="ae lf" href="https://shareby.cam" rel="noopener ugc nofollow" target="_blank">由Cam </a>分享</figcaption></figure></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><p id="a612" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lt kh ki kj lx kl km kn ko ij bi translated">我是否能够帮助您提高web应用的安全分数？在我的推特上告诉我。干杯！</p></div></div>    
</body>
</html>