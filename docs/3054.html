<html>
<head>
<title>'timeRange' — RxJS custom function that emits a set of values in specified timeouts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">' timeRange' — RxJS自定义函数，在指定的超时时间内发出一组值</h1>
<blockquote>原文：<a href="https://itnext.io/timerange-rxjs-custom-function-that-emits-a-set-of-values-in-specified-timeouts-bd6dd07974ce?source=collection_archive---------6-----------------------#2019-09-23">https://itnext.io/timerange-rxjs-custom-function-that-emits-a-set-of-values-in-specified-timeouts-bd6dd07974ce?source=collection_archive---------6-----------------------#2019-09-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="a5ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">为什么，如何，在哪里对于喜欢RxJS的人:-) </em></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/69d2257aea74f930b95c5d201d1286e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7hyHYXeUNMhJBjV2Q1N6yA.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">定制RxJS(图片由<a class="ae lc" href="https://unsplash.com/@sneakyelbow?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">鬼祟肘</a>拍摄)</figcaption></figure><pre class="kn ko kp kq gt ld le lf lg aw lh bi"><span id="ed6b" class="li lj iq le b gy lk ll l lm ln"><strong class="le ir">Prerequisites: I assume you know RxJS and have some practice with it. If you are new to it or want to learn some advanced topics - watch my video-course "</strong><a class="ae lc" href="https://www.udemy.com/course/hands-on-rxjs-for-web-development/" rel="noopener ugc nofollow" target="_blank"><strong class="le ir">Hands-on RxJS for Web development</strong></a><strong class="le ir">" on Udemy.</strong></span></pre><h1 id="2cd4" class="lo lj iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">为什么</h1><p id="a322" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">在我的开发实践中，我经常会遇到必须在指定的超时时间内发出一些值的情况。</p><p id="cd09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如:</p><ol class=""><li id="9c33" class="mq mr iq jp b jq jr ju jv jy ms kc mt kg mu kk mv mw mx my bi translated">要显示然后隐藏一些闪屏消息:</li></ol><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/e79262c21343f56427ee40735f593879.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*2jn_yYTMGcpyLqeDxAG3CA.gif"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">管理启动画面消息显示/隐藏超时</figcaption></figure><p id="f29b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.做一些好看的动画</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/6143137f7658be47f2119ca9f8bf20ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/1*2klU0Bnmad1gZWWD3U20Wg.gif"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">管理外观超时</figcaption></figure><p id="53ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.或者甚至只是发出单元测试的值(是的，我知道<a class="ae lc" href="https://github.com/ReactiveX/rxjs/blob/master/docs_app/content/guide/testing/marble-testing.md" rel="noopener ugc nofollow" target="_blank">弹珠</a>，但是有时我只是想检查最终值，句号:)</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nb"><img src="../Images/8e154883b510571d5cda1ff649e224cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fJ1bCfDzLkr74GNhIt1bcQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">带有去抖功能的自动完成的简单代码——要求提供带有要测试的特定时序的值</figcaption></figure><p id="fe97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么如何实现呢？好，让我们回顾一些场景:</p><h1 id="6810" class="lo lj iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">如何实施？</h1><h2 id="65c2" class="li lj iq bd lp nc nd dn lt ne nf dp lx jy ng nh mb kc ni nj mf kg nk nl mj nm bi translated">丑陋的方式</h2><p id="737a" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">好的，最简单的方法——运行许多<em class="kl"> setTimeout的</em>，就像这样:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nn"><img src="../Images/3ac0c39da20b6d161dcdc97aa38f19ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FVkmaCdDDeU9eMhNtd_pCA.png"/></div></div></figure><p id="d4e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，还不错，但如果我想在不同的延迟中显示更多的元素呢？</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi no"><img src="../Images/5fbf95c6f8001c83f684690cbb16cda6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_aM-J9WdnCjrJbP3VAQ0pg.png"/></div></div></figure><p id="a5ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看起来又老又丑。我们能做得更好吗？</p><h2 id="5de2" class="li lj iq bd lp nc nd dn lt ne nf dp lx jy ng nh mb kc ni nj mf kg nk nl mj nm bi translated">丑陋的方式，第2部分</h2><p id="7133" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">现在让我们使用RxJS并尝试实现它:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi np"><img src="../Images/c35af5d060a42497f85e5571b7aae148.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tib9DxYqHvMl2FXCK_WPEw.png"/></div></div></figure><p id="49c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该代码不允许绝对延迟(当下一次发射相对于开始/订阅时刻延迟时)。</p><p id="53a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了实现绝对延迟方法(所有延迟都是针对订阅/开始时刻指定的)，我们可以使用<a class="ae lc" href="https://rxjs.dev/api/operators/mergeMap" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="kl">merge map</em></strong></a>而不是<a class="ae lc" href="https://rxjs.dev/api/operators/concatMap" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="kl">concat map</em></strong></a>:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi np"><img src="../Images/0bc487ed42b43847cfb42706bb8fb6ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rz_4cWxC16LU7EqrEN1kGg.png"/></div></div></figure><p id="81f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看起来有很多代码，延迟也是硬编码的。我们可以做得更好。所以让我们更进一步！</p><h2 id="a5dd" class="li lj iq bd lp nc nd dn lt ne nf dp lx jy ng nh mb kc ni nj mf kg nk nl mj nm bi translated">编辑选择方法</h2><p id="db54" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">好的，我们已经知道硬编码值/延迟是不可重用的，我们也希望能够以<em class="kl">相对</em>(相对于以前的排放延迟)和<em class="kl">非相对/绝对</em>(相对于订阅时刻延迟)的方式进行调度。考虑到以上所有因素，我实现了一个定制的<strong class="jp ir">时间范围</strong>函数。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nq"><img src="../Images/495468d459226403da59d6864cfeca0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PUxyK_cCYZO50x2ZIy1wUA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">自定义<strong class="bd lp">时间范围</strong>功能。</figcaption></figure><p id="ac9a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">好处:</strong></p><ol class=""><li id="1db5" class="mq mr iq jp b jq jr ju jv jy ms kc mt kg mu kk mv mw mx my bi translated">看起来又漂亮又紧凑。</li><li id="ed66" class="mq mr iq jp b jq nr ju ns jy nt kc nu kg nv kk mv mw mx my bi translated">允许指定绝对和相对延迟。</li></ol><p id="131c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好，现在让我们展示我之前提到的三个用例。</p><h1 id="807a" class="lo lj iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated"><em class="nw">在哪里使用</em></h1><p id="6aa6" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated"><strong class="jp ir"> #1闪屏消息控制示例</strong></p><p id="ac8e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里是它的实现代码:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nx"><img src="../Images/3c70dcfeb783fee2f908335bf238a10a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LgFQcOH27DNM1x4UTYIxqw.png"/></div></div></figure><p id="b663" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在这里做什么？</p><ol class=""><li id="e9d4" class="mq mr iq jp b jq jr ju jv jy ms kc mt kg mu kk mv mw mx my bi translated">发射延迟为1000和2000的两个值(值在这里不起任何作用，实际上只有计时重要)</li><li id="1f35" class="mq mr iq jp b jq nr ju ns jy nt kc nu kg nv kk mv mw mx my bi translated">第一个值将显示带有消息的splash元素。</li><li id="1a9c" class="mq mr iq jp b jq nr ju ns jy nt kc nu kg nv kk mv mw mx my bi translated">第二次将隐藏它(使用<em class="kl">. class list . toggle(' show ')</em>)</li></ol><p id="f318" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它是这样工作的:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/e79262c21343f56427ee40735f593879.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*2jn_yYTMGcpyLqeDxAG3CA.gif"/></div></figure><p id="8dcf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在这里的一个密码栏里玩<a class="ae lc" href="https://codepen.io/kievsash/pen/ZEzVWKa?editors=0010" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="9b7b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> #2动画一些元素后续出现</strong></p><p id="5c98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代码如下:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nx"><img src="../Images/5675be0e5a0aa385e17ed7b714cbe5d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JIRhdrg4jCWsR7G_r6BQkQ.png"/></div></div></figure><p id="6104" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们只是抓取一组元素，然后在每个可观测的发射范围内用指定的超时时间逐一显示它们。</p><p id="9288" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果如下:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/6143137f7658be47f2119ca9f8bf20ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/1*2klU0Bnmad1gZWWD3U20Wg.gif"/></div></figure><p id="6e6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在这里查看代码<a class="ae lc" href="https://codepen.io/kievsash/pen/YzKdqzd?editors=0110" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="5d95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> #3模拟时间范围内单元测试代码的输入参数。</strong></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nb"><img src="../Images/521e032a9507f3a256804810b0126ccb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zE7VK8Cvu3HBxxUJmfETiQ.png"/></div></div></figure><p id="4330" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">工作原理:</p><ol class=""><li id="e513" class="mq mr iq jp b jq jr ju jv jy ms kc mt kg mu kk mv mw mx my bi translated">我们用一个异步返回值' 42 '的函数模拟ajax.get(模拟网络请求)</li><li id="8fe8" class="mq mr iq jp b jq nr ju ns jy nt kc nu kg nv kk mv mw mx my bi translated">则se去抖时间= 15ms。</li><li id="e5c7" class="mq mr iq jp b jq nr ju ns jy nt kc nu kg nv kk mv mw mx my bi translated">之后，调用<em class="kl"> getSearchResult </em>并模仿<em class="kl">输入$ </em>作为参数并订阅(以开始该过程)。</li><li id="dbb4" class="mq mr iq jp b jq nr ju ns jy nt kc nu kg nv kk mv mw mx my bi translated"><em class="kl">输入$ </em>将发出三个值，延时分别为1毫秒、5毫秒、30毫秒。由于debounceTime设置为15ms，因此只有第二个和第三个值会导致调用网络请求(在我们的例子中是Ajax . get)；</li></ol><p id="ef69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">和结果:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ny"><img src="../Images/e9a2b7b2a620f661ef5ca520c533d990.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6cEnFwnKvIVv7tm9jiqGPw.png"/></div></div></figure><p id="b344" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代码和测试可以在<a class="ae lc" href="https://codepen.io/kievsash/pen/ePoRxg?editors=0010" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><a href="http://eepurl.com/gHF0av"><div class="gh gi nz"><img src="../Images/e39daa364c50029b206bdc057d2b3487.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*33AyiLH06Tzu-9KxL1hZjg.png"/></div></a></figure><h2 id="027a" class="li lj iq bd lp nc nd dn lt ne nf dp lx jy ng nh mb kc ni nj mf kg nk nl mj nm bi translated">结论</h2><p id="b77e" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">我在我的<a class="ae lc" href="https://github.com/kievsash/rxjs-toolbox" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="kl">rxjs-toolbox</em></strong></a>lib中添加了<strong class="jp ir"> <em class="kl"> timeRange </em> </strong>函数。暂时还不大。你可以在这里了解更多:<a class="ae lc" href="https://blog.angularindepth.com/rxjs-recipes-forkjoin-with-the-progress-of-completion-for-bulk-network-requests-in-angular-5d585a77cce1" rel="noopener ugc nofollow" target="_blank"><em class="kl">【fork join】完成进度</em> </a></p><p id="161e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有自己感兴趣的RxJS解决方案？请在评论中提及它们！</p><p id="e65d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你喜欢这篇文章吗？然后<a class="ae lc" href="https://clicktotweet.com/fEdKA" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">发推特说说吧</strong> </a> <strong class="jp ir"> </strong>和<strong class="jp ir"> </strong>关注我<a class="ae lc" href="https://twitter.com/El_Extremal" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">推特</strong> </a> <strong class="jp ir"> </strong>🤓<strong class="jp ir">！</strong></p><p id="90b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">想进一步了解RxJS？试试我的视频课程“<a class="ae lc" href="https://www.udemy.com/course/hands-on-rxjs-for-web-development/" rel="noopener ugc nofollow" target="_blank">动手RxJS </a>”。它既包含初学者的全部内容，也包含更高级的主题。</p><p id="a7a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">干杯。</p></div></div>    
</body>
</html>