<html>
<head>
<title>Get an Office Editor into your OutSystems apps with WOPI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用WOPI让Office编辑器进入您的外部系统应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/get-an-office-editor-into-your-outsystems-apps-with-wopi-2f8657612260?source=collection_archive---------3-----------------------#2022-08-05">https://itnext.io/get-an-office-editor-into-your-outsystems-apps-with-wopi-2f8657612260?source=collection_archive---------3-----------------------#2022-08-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="726c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您正在构建以文档为中心的应用程序，在某个时候，您可能会遇到这样的情况:您不仅想查看文档，还想创建或编辑文档。直接在浏览器中，没有媒体中断。微软WOPI协议和兼容WOPI的办公套件使这成为可能。</p><p id="8331" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，一个用例是合同的自动生成(例如，通过Adobe文档生成)作为具有最终调整的草稿。</p><p id="b7d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文附有我在OutSystems Forge上发表的OutSystems中WOPI协议的参考实现。(见下文)。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/d06c485279a186f86579aa8bad7377c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6dse0TQ6msVSbLgwfEWfUA.png"/></div></div></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="cec0" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">外部系统</h1><p id="3681" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">OutSystems是一个低代码应用程序平台。支持整个应用程序开发生命周期的可视化开发环境。低代码意味着您仍然可以使用自定义代码，无论是前端的JavaScript还是服务器端的C#。</p><div class="mh mi gp gr mj mk"><a href="https://www.outsystems.com" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd ir gy z fp mp fr fs mq fu fw ip bi translated">低代码高性能软件开发|外部系统</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">OutSystems为有远见的组织创建高性能、低代码和云本地开发平台</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">www.outsystems.com</p></div></div><div class="mt l"><div class="mu l mv mw mx mt my kv mk"/></div></div></a></div><h1 id="56d7" class="le lf iq bd lg lh mz lj lk ll na ln lo lp nb lr ls lt nc lv lw lx nd lz ma mb bi translated">WOPI — Web应用开放平台接口</h1><p id="c188" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">Web应用开放平台接口是微软的协议规范。它定义了一组将Office for Web与您的应用程序集成的操作。换句话说，WOPI允许Office for Web读取和编辑由您的服务提供的文档。</p><p id="a104" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Office for Web是指基于浏览器的Microsoft Office套件版本(Word、Excel、PowerPoint、OneNote)。Office for Web可以作为Microsoft 365或Office 365订阅的一部分在(Microsoft)云中提供，也可以使用<a class="ae ne" href="https://docs.microsoft.com/en-us/officeonlineserver/office-online-server-overview" rel="noopener ugc nofollow" target="_blank">Microsoft Office Online Server</a>自行托管。</p><p id="480d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">也就是说——WOPI不仅限于Office for the Web，也已经被其他Office供应商采用，如</p><ul class=""><li id="24db" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated"><a class="ae ne" href="https://www.libreoffice.org/" rel="noopener ugc nofollow" target="_blank">图书馆</a>在线由文献基金会提供。完整的开源办公套件。</li><li id="0e1a" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><a class="ae ne" href="https://www.collaboraoffice.com/" rel="noopener ugc nofollow" target="_blank">Collabora</a>Online——一款基于LibreOffice的企业级办公套件。</li><li id="2cde" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><a class="ae ne" href="https://www.onlyoffice.com/" rel="noopener ugc nofollow" target="_blank"> ONLYOFFICE </a> —完全支持微软OFFICE文档格式(OOXML)的完整办公套件。</li></ul><p id="18bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过WOPI协议读取和编辑文件的办公套件被称为<strong class="jp ir"> WOPI客户端</strong>，而服务于这些文档的应用服务被称为<strong class="jp ir"> WOPI主机</strong>。</p><blockquote class="nt nu nv"><p id="c23f" class="jn jo nw jp b jq jr js jt ju jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj kk ij bi translated">如果您需要一个查看器来在浏览器中显示文档，那么集成WOPI客户机也很有用。所有WOPI客户端都支持文档的简化阅读模式——不仅支持Office文档，还支持常见的PDF格式。</p></blockquote><div class="mh mi gp gr mj mk"><a href="https://docs.microsoft.com/en-us/microsoft-365/cloud-storage-partner-program/online/" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd ir gy z fp mp fr fs mq fu fw ip bi translated">使用WOPI协议与Office for web集成</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">您可以使用Web应用程序开放平台接口(WOPI)协议将Office for Web与您的…</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">docs.microsoft.com</p></div></div><div class="mt l"><div class="oa l mv mw mx mt my kv mk"/></div></div></a></div></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="ab2e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于这个参考实现，我使用ONLYOFFICE作为WOPI客户端。ONLYOFFICE符合WOPI规范，尽管它没有提供与Office for Web相同的功能集。我使用它仅仅是因为它比微软的替代品更容易安装:</p><ul class=""><li id="3761" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated">Office for Web Cloud service要求您成为<a class="ae ne" href="https://developer.microsoft.com/en-us/office/cloud-storage-partner-program" rel="noopener ugc nofollow" target="_blank"> Office 365云存储合作伙伴计划</a>的成员。只有当您作为ISV构建SaaS产品时，与Office for Web Cloud service集成才适用。</li><li id="003f" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><a class="ae ne" href="https://docs.microsoft.com/en-us/officeonlineserver/plan-office-online-server" rel="noopener ugc nofollow" target="_blank"> Office Online Server </a>(自托管)要求您有权下载该软件，并且在使用之前需要一些准备工作。</li></ul><blockquote class="nt nu nv"><p id="f57a" class="jn jo nw jp b jq jr js jt ju jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj kk ij bi translated">总之。如果你知道如何与ONLYOFFICE集成，那么你可以选择其他选项。</p></blockquote></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="7ba2" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">ONLYOFFICE</h1><p id="b0aa" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">ONLYOFFICE by Ascensio System SIA公司提供了一个功能强大的办公套件，它包括文本文档、电子表格和演示文稿的在线编辑器，与Microsoft Office和OpenDocument文件格式高度兼容。ONLYOFFICE为用户提供了多种编辑工具和协作功能，确保更好的团队工作流程，并在您的web解决方案中无缝处理复杂的格式和对象。</p><div class="mh mi gp gr mj mk"><a href="https://www.onlyoffice.com/" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd ir gy z fp mp fr fs mq fu fw ip bi translated">商务在线办公应用程序</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">ONLYOFFICE提供与MS Office格式高度兼容的安全在线办公套件。将它连接到您的网络…</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">www.onlyoffice.com</p></div></div><div class="mt l"><div class="ob l mv mw mx mt my kv mk"/></div></div></a></div></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="2836" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">整体情况</h1><p id="8212" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">为了让ONLYOFFICE从我们的应用程序中呈现文档，我们需要以下构建块:</p><ul class=""><li id="6a5e" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated"><strong class="jp ir"> WOPI主机</strong> —主机是一个公开的REST API，具有服务和保存文件的操作。在外部系统中，这是一组暴露的REST端点。</li><li id="f0b5" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><strong class="jp ir"> WOPI客户端</strong>—only office的运行实例。为此，我们将使用官方的ONLYOFFICE docker图像。</li><li id="cf4f" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><strong class="jp ir"> WOPI主机页面</strong> —连接主机和客户端的网页。</li></ul></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="c30c" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">设置开发环境</h1><p id="109e" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">在我们逐步完成OutSystems参考实现之前，我们必须确保您有一个正在运行的开发/试用环境。这是你需要的。</p><ul class=""><li id="8543" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated"><a class="ae ne" href="https://www.outsystems.com" rel="noopener ugc nofollow" target="_blank">外部系统</a>——一个<a class="ae ne" href="https://www.outsystems.com/PartnerSignup/GetStarted.aspx?PartnerId=bdbab3cf-076f-49e2-91ac-a9157081eace&amp;utm_source=ISD%20FENIQS%20GmbH&amp;utm_medium=partner&amp;utm_campaign=partner-personal-environment&amp;utm_content=personal-environment" rel="noopener ugc nofollow" target="_blank">个人环境</a>就足够了。</li><li id="23df" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><a class="ae ne" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker桌面</a> —用于运行ONLYOFFICE的实例。</li><li id="d0f4" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><a class="ae ne" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码</a>带有<a class="ae ne" href="https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-docker" rel="noopener ugc nofollow" target="_blank"> Docker扩展</a>——我们将更改ONLYOFFICE的一些配置设置。</li></ul></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="5f9b" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">仅运行OFFICE Docker桌面</h1><p id="583a" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">要运行ONLYOFFICE docker容器，首先创建一些本地目录，例如</p><ul class=""><li id="0c05" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated">C:\dev\onlyoffice\logs</li><li id="c98b" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated">C:\dev\onlyoffice\data</li><li id="0799" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated">C:\dev\onlyoffice\lib</li><li id="4ae2" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated">C:\dev\onlyoffice\db</li></ul><p id="e617" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些目录将在我们的容器中用作挂载卷来持久存储数据。然后运行以下命令。</p><pre class="km kn ko kp gt oc od oe of aw og bi"><span id="b146" class="oh lf iq od b gy oi oj l ok ol">docker run -it -d -p 80:80 --restart=always \<br/>  -v C:\dev\onlyoffice\logs:/var/log/onlyoffice \<br/>  -v C:\dev\onlyoffice\data:/var/www/onlyoffice\data \<br/>  -v C:\dev\onlyoffice\lib:/var/lib/onlyoffice \<br/>  -v C:\dev\onlyoffice\db:/var/lib/postgresql onlyoffice/documentserver</span></pre><p id="ffec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将启动在端口80上运行的容器。在我的机器上，onlyoffice完全启动大约需要1分钟。尝试浏览到<a class="ae ne" href="http://localhost." rel="noopener ugc nofollow" target="_blank"> http://localhost上的起始页。您应该会看到以下屏幕。</a></p><blockquote class="nt nu nv"><p id="8787" class="jn jo nw jp b jq jr js jt ju jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj kk ij bi translated">在撰写本文时，ONLYOFFICE的最新版本是7.1。</p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi om"><img src="../Images/b281ea3bd5f351687124fd86ee37cbb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tNRNakZY3YTzxPoxomW8-g.png"/></div></div><figcaption class="on oo gj gh gi op oq bd b be z dk translated">ONLYOFFICE欢迎页面</figcaption></figure><p id="62d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关于在Docker中运行ONLYOFFICE的更多信息可以在ONLYOFFICE帮助中心找到。</p><div class="mh mi gp gr mj mk"><a href="https://helpcenter.onlyoffice.com/installation/docs-developer-install-docker.aspx" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd ir gy z fp mp fr fs mq fu fw ip bi translated">仅在本地服务器上安装Docker的OFFICE文档-仅OFFICE</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">sudo docker run-I-t-d-p 443:443-restart = always \-v/app/only office/DocumentServer/Data:/var/www/only office/Data…</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">helpcenter.onlyoffice.com</p></div></div></div></a></div></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="ebca" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">仅启用OFFICE WOPI支持</h1><p id="e2d6" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">默认情况下，WOPI支持是禁用的，所以我们需要首先激活它并设置一些附加配置。启动安装了Docker扩展的Visual Studio代码，并在</p><pre class="km kn ko kp gt oc od oe of aw og bi"><span id="5935" class="oh lf iq od b gy oi oj l ok ol">/etc/onlyoffice/documentserver/local.json</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi or"><img src="../Images/0e56f5d134db0ded16afc70bd7db9e46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*SVenuIlXdPzoNXbLrXxJvQ.png"/></div></figure><blockquote class="nt nu nv"><p id="f700" class="jn jo nw jp b jq jr js jt ju jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj kk ij bi translated">local.json文件是同一目录中default.json配置文件的替代文件。default.json包含ONLYOFFICE的所有可用配置选项。</p></blockquote><p id="902a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<strong class="jp ir">服务</strong>中添加一个新对象<strong class="jp ir"> ipfilter </strong></p><p id="0a80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该设置告诉OPENOFFICE接受来自任何地址的请求。根据您使用的版本，这可能已经设置好了。</p><pre class="km kn ko kp gt oc od oe of aw og bi"><span id="e2d0" class="oh lf iq od b gy oi oj l ok ol">{<br/>  "services": {<br/>    "ipfilter": {<br/>      "rules": [<br/>        {<br/>          "address": "*",<br/>          "allowed": true<br/>        }<br/>      ],<br/>      "useforrequest": true,<br/>      "errorcode": 403<br/>    }<br/>    ...</span></pre><p id="6869" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<strong class="jp ir">服务</strong>-&gt;-<strong class="jp ir">共同创作</strong>内添加新对象<strong class="jp ir">自动组装</strong></p><p id="7b57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">配置OPENOFFICE将文档中的更改立即发送回WOPI主机。</p><pre class="km kn ko kp gt oc od oe of aw og bi"><span id="48d6" class="oh lf iq od b gy oi oj l ok ol">{<br/>  "services": {<br/>    "CoAuthoring": {<br/>      "autoAssembly": {<br/>        "enable": true,<br/>        "interval": "0m",<br/>        "step": "0m"<br/>      }<br/>    ...</span></pre><blockquote class="nt nu nv"><p id="c710" class="jn jo nw jp b jq jr js jt ju jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj kk ij bi translated">如果没有此设置，您可能会在本地编辑的文件和WOPI主机存储的文件之间产生版本不匹配的风险。</p></blockquote><p id="079a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并直接在根<strong class="jp ir"> local.json </strong>文件中添加一个新的<strong class="jp ir"> wopi </strong>对象</p><p id="edc4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这使得WOPI集成成为可能😒</p><pre class="km kn ko kp gt oc od oe of aw og bi"><span id="df94" class="oh lf iq od b gy oi oj l ok ol">{<br/>  "wopi": {<br/>    "enable": true<br/>  }<br/>  ...</span></pre><p id="ec0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关于启用WOPI支持的更多信息可以在ONLYOFFICE文档中找到</p><div class="mh mi gp gr mj mk"><a href="https://api.onlyoffice.com/editors/wopi/" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd ir gy z fp mp fr fs mq fu fw ip bi translated">概观</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">从6.4版开始，只有OFFICE Docs提供对Web应用程序开放平台接口协议的支持…</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">api.onlyoffice.com</p></div></div></div></a></div><p id="6264" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过打开终端会话并执行以下命令来重新启动ONLYOFFICE</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi os"><img src="../Images/888cd330b5efc08868d83e7add105f5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uLUale5lkaVVmjXy2OiQuA.png"/></div></div><figcaption class="on oo gj gh gi op oq bd b be z dk translated">连接到集装箱码头</figcaption></figure><pre class="km kn ko kp gt oc od oe of aw og bi"><span id="5420" class="oh lf iq od b gy oi oj l ok ol">sudo supervisorctl restart all</span></pre></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="8473" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">外部系统参考实施</h1><p id="d500" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">您可以从Forge下载参考实现应用程序。此处提供</p><div class="mh mi gp gr mj mk"><a href="https://www.outsystems.com/forge/component-overview/13569/wopi-reference-implementation" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd ir gy z fp mp fr fs mq fu fw ip bi translated">WOPI参考实现</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">这是一个WOPI主机和WOPI主机页面的参考实现。WOPI协议允许集成办公室…</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">www.outsystems.com</p></div></div><div class="mt l"><div class="ot l mv mw mx mt my kv mk"/></div></div></a></div></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="a55d" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">应用模块</h1><p id="6074" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">参考实现由几个模块组成，应该为您自己的解决方案提供一个适应和扩展的起点。</p><ul class=""><li id="aba0" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated"><strong class="jp ir"> DocumentStore_CS </strong> —使用外部系统实体存储文档的文档存储提供者的简单实现。</li></ul><blockquote class="nt nu nv"><p id="8b7f" class="jn jo nw jp b jq jr js jt ju jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj kk ij bi translated">在实际实现中，您可能希望将文档存储转移到AWS S3这样的替代方案中。</p></blockquote><ul class=""><li id="96d0" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated"><strong class="jp ir"> DocumentStoreUtil_EXT </strong> —解析文件名的扩展模块。只有一个操作可以提取文档的扩展名并根据扩展名确定MIME类型。</li><li id="0976" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><strong class="jp ir"> WOPI_API </strong> —是WOPI主机的实现。包含几个REST端点来获取、更新、锁定和解锁文档。</li><li id="8690" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><strong class="jp ir"> WOPIUtil_EXT </strong> —一个扩展，带有一个验证Office随每个请求发送的“证明”的动作。</li></ul><blockquote class="nt nu nv"><p id="e9a7" class="jn jo nw jp b jq jr js jt ju jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj kk ij bi translated">证据允许WOPI主机(我们的OutSystems REST API)验证请求是否是由WOPI客户机发送的。</p></blockquote><ul class=""><li id="57ba" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated"><strong class="jp ir"> WOPI_LIB </strong> —这个库包含一个在WOPI主机页面上使用的UI小部件。</li><li id="9c34" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><strong class="jp ir">WOPIDemo</strong>——一个小的演示应用程序，将所有的部分整合在一起。</li></ul></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="7123" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">配置应用程序</h1><p id="0c13" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">在运行应用程序之前，需要设置一些配置设置。WOPI_API模块为此公开了一些站点属性。</p><ul class=""><li id="c1c1" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated"><strong class="jp ir"> WOPI_ClientBaseUrl </strong> —是指向您唯一的OFFICE Wopi端点的完整Url。当在Docker桌面本地运行时，这必须设置为<strong class="jp ir">http://localhost/hosting/wopi</strong>。</li><li id="194a" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><strong class="jp ir"> WOPI_HostBaseUrl </strong> —是您的环境的WOPI REST端点的完整Url。应该是你的外部系统环境的<strong class="jp ir">https://&lt;DNS&gt;/WOPI _ API/rest</strong></li></ul><p id="82e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来打开浏览器，进入<a class="ae ne" href="http://localhost/hosting/discovery" rel="noopener ugc nofollow" target="_blank">http://localhost/hosting/discovery</a></p><p id="c6bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">discovery xml文档向您展示了ONLYOFFICE的功能。它告诉您可以对各种文件类型进行什么样的查看或编辑。</p><p id="4cce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">滚动到文档的校对键元素并复制</p><ul class=""><li id="752a" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated"><strong class="jp ir">值</strong>至<strong class="jp ir"> WOPI_Key </strong></li><li id="e2ae" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><strong class="jp ir">模数</strong>至<strong class="jp ir">WOPI _模数</strong></li><li id="905a" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><strong class="jp ir">指数</strong>至<strong class="jp ir">WOPI _指数</strong></li><li id="a77b" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><strong class="jp ir">旧值</strong>至<strong class="jp ir"> WOPI_KeyOld </strong></li><li id="12ce" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><strong class="jp ir">旧模数</strong>至<strong class="jp ir"> WOPI_ModulusOld </strong></li><li id="8ade" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><strong class="jp ir">旧指数</strong>到<strong class="jp ir">旧指数</strong></li></ul><p id="c585" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些值用于验证从ONLYOFFICE到REST端点的每个请求。关于验证密钥验证的更多信息，请点击此处</p><div class="mh mi gp gr mj mk"><a href="https://docs.microsoft.com/en-us/microsoft-365/cloud-storage-partner-program/online/scenarios/proofkeys" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd ir gy z fp mp fr fs mq fu fw ip bi translated">使用验证密钥验证请求来自Office for web</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">当处理来自Office for web的WOPI请求时，您可能希望验证这些请求来自…</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">docs.microsoft.com</p></div></div><div class="mt l"><div class="ou l mv mw mx mt my kv mk"/></div></div></a></div><blockquote class="nt nu nv"><p id="3179" class="jn jo nw jp b jq jr js jt ju jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj kk ij bi translated">在这里，我们静态地将验证的关键元素复制到我们的环境中。当使用Office for Web和/或如果您希望经常更改您的密钥(您应该做什么)，那么您应该按计划查询发现文档，提取proof-key元素并将其缓存在实体中。</p></blockquote></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="9ad1" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">试验</h1><p id="7398" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">启动演示应用程序，并使用<strong class="jp ir">上传文档</strong>按钮上传office文档。然后单击文档的名称，在ONLYOFFICE中打开它。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ov"><img src="../Images/e941974791c9506944f8d509b7533da3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4We5zlVYYHypQZ26MvYnZg.png"/></div></div><figcaption class="on oo gj gh gi op oq bd b be z dk translated">演示应用程序</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ow"><img src="../Images/ad9c9c20d3f4a6647eba6c835e8e2714.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3G46isQyu3wVdzC0w5T6MA.png"/></div></div><figcaption class="on oo gj gh gi op oq bd b be z dk translated">编辑模式下的Word文档</figcaption></figure><p id="bbb0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编辑您上传的文档。注意顶部菜单中的<strong class="jp ir">保存</strong>图标。每当您停止只写时，OFFICE执行一次保存并将文件发送到WOPI <strong class="jp ir"> PutFile </strong>端点。</p><p id="6111" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您单击文档名称时，您会被重定向到另一个屏幕，即WOPI主页面。主页包含一个全屏IFRAME hosting ONLYOFFICE。主页面使用WOPI源URL和访问代码对此IFRAME进行表单POST操作。</p><p id="2a89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">WOPI源URL告诉ONLYOFFICE从该URL获取文档——这是我们在WOPI_API模块中的REST端点。访问代码识别用户，并直接转发给我们的API。</p><blockquote class="nt nu nv"><p id="4bb6" class="jn jo nw jp b jq jr js jt ju jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj kk ij bi translated">因此，只有OFFICE连接到我们的外部系统环境，用户的浏览器是ONLYOFFICE和外部系统之间的连接。OutSystems本身从不直接与ONLYOFFICE连接，这也解释了为什么您可以在本地运行和使用ONLYOFFICE。</p></blockquote><p id="344d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看看一些重要的实现。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="37c0" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">WOPI REST端点</h1><p id="934a" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">打开<strong class="jp ir"> WOPI_API </strong>模块，进入逻辑页签，展开暴露的WOPI REST服务。</p><ul class=""><li id="b4fb" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated"><strong class="jp ir"> CheckFileInfo </strong> —每当ONLYOFFICE需要加载文档时，首先查询该端点。端点返回关于文档本身的基本配置数据和信息。</li></ul><div class="mh mi gp gr mj mk"><a href="https://docs.microsoft.com/en-us/microsoft-365/cloud-storage-partner-program/rest/files/checkfileinfo" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd ir gy z fp mp fr fs mq fu fw ip bi translated">CheckFileInfo</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">CheckFileInfo操作返回有关文件、用户对该文件的权限以及常规…</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">docs.microsoft.com</p></div></div><div class="mt l"><div class="ox l mv mw mx mt my kv mk"/></div></div></a></div><ul class=""><li id="59e1" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated"><strong class="jp ir"> GetFile </strong> —该端点返回文档的实际二进制数据。</li></ul><div class="mh mi gp gr mj mk"><a href="https://docs.microsoft.com/en-us/microsoft-365/cloud-storage-partner-program/rest/files/getfile" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd ir gy z fp mp fr fs mq fu fw ip bi translated">获取文件</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">了解GetFile操作如何从主机检索文件。</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">docs.microsoft.com</p></div></div><div class="mt l"><div class="oy l mv mw mx mt my kv mk"/></div></div></a></div><ul class=""><li id="1edf" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated"><strong class="jp ir"> PutFile </strong> —每当保存文档时，该操作接收二进制数据。</li></ul><div class="mh mi gp gr mj mk"><a href="https://docs.microsoft.com/en-us/microsoft-365/cloud-storage-partner-program/rest/files/putfile" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd ir gy z fp mp fr fs mq fu fw ip bi translated">PutFile</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">PutFile操作更新文件的二进制内容。PutFile操作更新文件的二进制内容。WOPI…</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">docs.microsoft.com</p></div></div><div class="mt l"><div class="oz l mv mw mx mt my kv mk"/></div></div></a></div><ul class=""><li id="6e1c" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated"><strong class="jp ir">文件操作</strong> —主要用于锁定和解锁一张单据。</li></ul><div class="mh mi gp gr mj mk"><a href="https://docs.microsoft.com/en-us/microsoft-365/cloud-storage-partner-program/rest/files/lock" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd ir gy z fp mp fr fs mq fu fw ip bi translated">锁</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">锁定操作锁定一个文件，以便由请求锁定的WOPI客户端应用程序实例进行编辑。锁…</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">docs.microsoft.com</p></div></div><div class="mt l"><div class="pa l mv mw mx mt my kv mk"/></div></div></a></div><div class="mh mi gp gr mj mk"><a href="https://docs.microsoft.com/en-us/microsoft-365/cloud-storage-partner-program/rest/files/getlock" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd ir gy z fp mp fr fs mq fu fw ip bi translated">GetLock</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">GetLock操作检索文件上的锁。GetLock操作检索文件上的锁。这次行动…</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">docs.microsoft.com</p></div></div><div class="mt l"><div class="pb l mv mw mx mt my kv mk"/></div></div></a></div><div class="mh mi gp gr mj mk"><a href="https://docs.microsoft.com/en-us/microsoft-365/cloud-storage-partner-program/rest/files/refreshlock" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd ir gy z fp mp fr fs mq fu fw ip bi translated">刷新锁</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">RefreshLock操作刷新文件上的锁。RefreshLock操作通过…刷新文件上的锁</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">docs.microsoft.com</p></div></div><div class="mt l"><div class="pc l mv mw mx mt my kv mk"/></div></div></a></div><div class="mh mi gp gr mj mk"><a href="https://docs.microsoft.com/en-us/microsoft-365/cloud-storage-partner-program/rest/files/unlock" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd ir gy z fp mp fr fs mq fu fw ip bi translated">开启</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">解锁操作解除对文件的锁定。解锁操作解除对文件的锁定。WOPI客户端…</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">docs.microsoft.com</p></div></div><div class="mt l"><div class="pd l mv mw mx mt my kv mk"/></div></div></a></div><blockquote class="nt nu nv"><p id="d9bf" class="jn jo nw jp b jq jr js jt ju jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj kk ij bi translated">参考实现以最小实现为特色。如果您查看WOPI参考，您会注意到Office for Web有许多由WOPI协议提供的附加功能。</p></blockquote><p id="5ba0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">on认证</strong>流程执行以下操作</p><ul class=""><li id="dd2c" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated">从请求中检索证明标头</li><li id="3af4" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated">验证证据—由<strong class="jp ir"> WOPIUtil_EXT </strong>模块提供</li><li id="6478" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated">解析并验证请求的访问令牌</li><li id="7fa3" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated">执行访问令牌中给定用户的登录。(来自<strong class="jp ir">系统</strong>)。</li></ul></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="780b" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">文档存储</h1><p id="9c70" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">参考实现包含一个使用实体的简单文档存储— <strong class="jp ir"> DocumentStore_CS </strong>。就个人而言，我建议将文档存储在一个<strong class="jp ir">对象存储</strong>中。例子有</p><ul class=""><li id="c074" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated"><a class="ae ne" href="https://aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank"> AWS简易存储</a> (S3)</li><li id="76a6" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><a class="ae ne" href="https://min.io/" rel="noopener ugc nofollow" target="_blank"> MinIO </a> —完全兼容S3的对象存储</li></ul><p id="fe45" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一些存储供应商有自己的(或多或少)兼容S3选项。</p><p id="4af7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了二进制数据，文档存储还保存文件的附加信息，如文档的扩展名和锁定状态。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="3032" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">WOPI主页</h1><p id="371a" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">现在是最有趣的部分。WOPI主机页面。在Service Studio中打开<strong class="jp ir"> WOPIDemo </strong> Reactive Web、<strong class="jp ir"> WOPI_LIB </strong>和<strong class="jp ir"> WOPI_API </strong>模块。</p><p id="4330" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<strong class="jp ir"> WOPIDemo演示</strong>屏幕中，当您点击名称链接时，您会被重定向到另一个屏幕<strong class="jp ir">主机页面</strong>。那个<strong class="jp ir"> HostPage </strong>屏幕以<strong class="jp ir"> DocumentId </strong>作为输入参数。我们暂时跳过动作参数。</p><p id="c2d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">主机页面有一个数据动作<strong class="jp ir"> GetResourceAccess </strong>，它执行来自<strong class="jp ir"> WOPI_API </strong>模块<strong class="jp ir">WOPI _ GetDefaultHostPageConfig</strong>的服务器动作。</p><p id="8cd8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">WOPI _ GetDefaultHostPageConfig</strong>将另外两个服务器动作合并成一个调用</p><ul class=""><li id="be8b" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated">WOPI _ GetDocumentAccessCode—这一个创建了一个访问代码，REST端点需要这个代码来识别用户。接入码交给ONLYOFFICE。但是！ONLYOFFICE对访问代码不做任何处理，而是将它包含在对我们的API的每个请求中。</li></ul><blockquote class="nt nu nv"><p id="75fd" class="jn jo nw jp b jq jr js jt ju jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj kk ij bi translated"><strong class="jp ir">这里还有一个提醒</strong>:这个实现包含一个非常基本的访问令牌创建和验证。在实际场景中，您应该创建一个签名的JSON Web令牌，并验证每个请求的签名。</p></blockquote><ul class=""><li id="2077" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated"><strong class="jp ir">WOPI _ GetDocumentActionUrl</strong>—它构造了一个Url，用于让ONLYOFFICE知道要打开什么应用程序(Word、Excel、Powerpoint)以及以什么模式打开(查看或编辑)。</li></ul><p id="74bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了构造操作URL，服务器操作首先从文档存储中检索文档细节。然后，它查询静态实体<strong class="jp ir"> DocType </strong>中的<strong class="jp ir"> WOPI_API </strong>来确定给定文档扩展的默认应用程序和模式。</p><blockquote class="nt nu nv"><p id="65e5" class="jn jo nw jp b jq jr js jt ju jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj kk ij bi translated">我只在静态实体中包含了一些支持的文件类型扩展。检查发现模板以了解更多支持的文件类型，并添加它们。</p></blockquote><p id="1c93" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了访问代码和动作URL之外，还有一个生存时间返回给<strong class="jp ir">主机页面</strong>。按照WOPI规范的建议，这被设置为10小时(毫秒)。</p><p id="c30d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到<strong class="jp ir">主机页面</strong>的widget树。请注意，它包含了来自<strong class="jp ir"> WOPI_LIB </strong>的ONLYOFFICE小部件。有必要将其包装在IF中，并将条件设置为<strong class="jp ir"> GetResourceAccess。IsDataFetched </strong>。这可以防止在检索必要的数据之前呈现小部件。</p><p id="1b76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">小部件本身呈现一个表单和一个IFRAME，并在<strong class="jp ir"> OnReady </strong>事件处理程序中向表单提交访问代码、ttl和动作URL。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="7c5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您的阅读。我希望你喜欢它，并且我已经很好地解释了重要的部分。如果没有，请告诉我😊</p><p id="a04c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">仅使用OFFICE时，我遇到了一些问题。在保存操作和ONLYOFFICE识别更新版本之间有相当大的延迟。这有时会导致版本不匹配的消息。此外，还有一个低闲置过期设置。“过期信息”很烦人，但我找不到增加它的设置。它在他们的开发者论坛上问了一个问题。</p><p id="49e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但无论如何，如果您无法访问Office Online服务器，这是一个可行的替代方案。</p><p id="4f7b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您在启动和运行时遇到困难，请使用OutSystems论坛获得帮助。非常欢迎对如何改进这篇文章提出建议。通过我的<a class="ae ne" href="https://www.outsystems.com/profile/0qginuc0j5/overview" rel="noopener ugc nofollow" target="_blank"> OutSystems Profile </a>给我发消息，或者直接在medium上回复。低编码快乐！</p></div></div>    
</body>
</html>