<html>
<head>
<title>iOS to MySQL: Using a GraphQL API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS到MySQL:使用GraphQL API</h1>
<blockquote>原文：<a href="https://itnext.io/ios-to-mysql-via-aurora-serverless-cluster-part-1-graphql-api-57cd547d631d?source=collection_archive---------1-----------------------#2019-05-25">https://itnext.io/ios-to-mysql-via-aurora-serverless-cluster-part-1-graphql-api-57cd547d631d?source=collection_archive---------1-----------------------#2019-05-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/251ef671aa759814ad2403c8d0d3e3e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3SS7XA8oEY6JpMa23KmzsQ.png"/></div></div></figure><p id="fc19" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我们将展示用于<a class="ae kw" href="https://docs.aws.amazon.com/en_pv/AmazonRDS/latest/AuroraUserGuide/aurora-serverless.html" rel="noopener ugc nofollow" target="_blank"> Aurora无服务器</a> MySQL数据库的全新<a class="ae kw" href="https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/data-api.html" rel="noopener ugc nofollow" target="_blank">内置数据API </a>特性。使用这个API，你可以通过带有<a class="ae kw" href="https://aws.amazon.com/api-gateway/" rel="noopener ugc nofollow" target="_blank">亚马逊API网关</a> + <a class="ae kw" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>的REST API，或者带有<a class="ae kw" href="https://aws.amazon.com/appsync/" rel="noopener ugc nofollow" target="_blank"> AWS AppSync </a>的GraphQL API，访问基于web服务的应用程序Aurora Serverless。</p><p id="215d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们回顾一下<strong class="ka ir">为什么</strong>您希望将数据API用于Aurora无服务器集群…</p><blockquote class="kx ky kz"><p id="4c1e" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">在Aurora MySQL数据库上启用数据API后，客户端不再需要<strong class="ka ir">保持与数据库集群的持久连接</strong>，它<strong class="ka ir">提供了安全的HTTP端点</strong>以及与AWS SDKs的集成。您可以使用端点来执行SQL语句，就像您使用MySQL本地协议一样，但是不需要管理连接。数据API有点像杰里米·戴利和其他人在这个<a class="ae kw" href="https://github.com/jeremydaly/serverless-mysql" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>中解决的那样，适用于无服务器和有服务器集群。</p></blockquote><p id="8a3f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我们将使用AWS AppSync通过GraphQL API将iOS应用程序连接到无服务器MySQL数据库。</p><blockquote class="le"><p id="0a2e" class="lf lg iq bd lh li lj lk ll lm ln kv dk translated">注意:这是一个全面的博客，提供了从数据库创建到客户机实现的几乎每个步骤。如果这个解决方案对您不起作用，请告诉我，我会解决它。</p></blockquote><p id="79f5" class="pw-post-body-paragraph jy jz iq ka b kb lo kd ke kf lp kh ki kj lq kl km kn lr kp kq kr ls kt ku kv ij bi translated">在我之前的<a class="ae kw" href="https://read.acloud.guru/getting-started-with-the-amazon-aurora-serverless-data-api-6b84e466b109" rel="noopener ugc nofollow" target="_blank">文章</a>和<a class="ae kw" href="https://youtu.be/b_BzV1G1iRs" rel="noopener ugc nofollow" target="_blank">视频</a>中，我介绍了<strong class="ka ir">使用数据API创建</strong>Aurora无服务器MySQL数据库的三种方法和<strong class="ka ir">将</strong>连接到无服务器MySQL数据库的四种方法。对于本文，我们将使用Amazon RDS控制台来创建数据库，启用数据API，并使用查询编辑器来定义表和执行一些基本的crud操作。</p><p id="7a58" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是我们将要建造的:</p><blockquote class="kx ky kz"><p id="3cd1" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">启用了数据API的Amazon Aurora无服务器集群和<strong class="ka ir"> MySQL数据库</strong></p><p id="866c" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">带有AWS AppSync的新<strong class="ka ir"> GraphQL API </strong>与上述数据库接口</p><p id="e423" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">一个<strong class="ka ir"> iOS Swift应用</strong>通过GraphQL API以“API_Key模式”与我们的无服务器MySQL数据库进行交互。</p></blockquote><h1 id="9d56" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">开始—步骤1</h1><h2 id="9e39" class="mr lu iq bd lv ms mt dn lz mu mv dp md kj mw mx mh kn my mz ml kr na nb mp nc bi translated">创建集群</h2><p id="b487" class="pw-post-body-paragraph jy jz iq ka b kb nd kd ke kf ne kh ki kj nf kl km kn ng kp kq kr nh kt ku kv ij bi translated">RDS控制台是部署资源的快捷方式，按照以下说明只需几分钟即可完成:</p><p id="e63a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">通过RDS控制台</strong>创建新的Aurora无服务器集群:</p><ol class=""><li id="70f6" class="ni nj iq ka b kb kc kf kg kj nk kn nl kr nm kv nn no np nq bi translated">启动亚马逊RDS控制台。</li><li id="6b8f" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated">选择<strong class="ka ir">创建数据库</strong>。</li><li id="c289" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated">选择<strong class="ka ir">简易创建。</strong></li><li id="c9f1" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated">选择引擎类型:<strong class="ka ir">亚马逊极光。</strong></li><li id="267d" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated">精选版:兼容MySQL 5.6的亚马逊Aurora。</li><li id="bf80" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated">选择数据库实例大小:<strong class="ka ir">无服务器</strong></li><li id="7883" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated">保留所有默认值并选择<strong class="ka ir">创建数据库。</strong></li></ol><figure class="nx ny nz oa gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/8d850b4aea6840d6b4b4f84796b12bc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*OVuVuYPpY23YK0sOtsSEjw.gif"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk translated">通过RDS控制台创建Aurora无服务器集群的屏幕截图</figcaption></figure><p id="2478" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建新的Aurora无服务器MySQL数据库时，应该已经启用了数据API。如果没有，或者如果您想验证，请按照以下步骤操作。</p><p id="e09b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">验证数据库已启用数据API</strong></p><p id="1b79" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将验证新创建的Aurora无服务器数据库的数据API是否已启用。</p><ol class=""><li id="abca" class="ni nj iq ka b kb kc kf kg kj nk kn nl kr nm kv nn no np nq bi translated">启动<a class="ae kw" href="https://console.aws.amazon.com/rds/home?region=us-east-1#databases:" rel="noopener ugc nofollow" target="_blank"> RDS管理控制台</a></li><li id="d7e6" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated"><strong class="ka ir">从左侧面板中选择数据库</strong>。</li><li id="9bd1" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated">在数据库标识符下选择您的数据库。</li><li id="630c" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated">选择右上角的<strong class="ka ir">修改</strong>按钮。</li><li id="4efb" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated"><strong class="ka ir">网络&amp;安全部分下的数据API </strong>应显示一个复选标记，表明该数据库的数据API已启用。</li><li id="ffa8" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated">选择<strong class="ka ir">继续</strong>。</li><li id="c95a" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated">如有变更，选择修改计划下的<strong class="ka ir">立即应用</strong>。</li><li id="69e5" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated">选择<strong class="ka ir">修改集群</strong>单选按钮。</li></ol><figure class="nx ny nz oa gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/d1c07c3d46ad3c529bb3e100bcf585a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*DncoCkuY-n-MsDE8cdpywA.gif"/></div></div></figure><h1 id="6543" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">准备数据</h1><p id="0587" class="pw-post-body-paragraph jy jz iq ka b kb nd kd ke kf ne kh ki kj nf kl km kn ng kp kq kr nh kt ku kv ij bi translated">我们将使用RDS控制台中的<a class="ae kw" href="https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/query-editor.html#query-editor.running" rel="noopener ugc nofollow" target="_blank">查询编辑器</a>来创建我们的数据库、表，并插入一些数据来开始。第一次使用查询编辑器时，它会要求您提供主用户和密码形式的集群凭证。作为对提供这些凭证的响应，RDS将创建一个新的<strong class="ka ir"> AWS机密</strong>来存储这些凭证，并在您通过查询编辑器连接到数据库时检索这些主用户/通行证。</p><blockquote class="kx ky kz"><p id="e8c2" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">注意:<a class="ae kw" href="https://aws.amazon.com/secrets-manager/" rel="noopener ugc nofollow" target="_blank"> AWS Secrets Manager </a>是从AWS CLI、SDK、AppSync和其他基于web的应用程序连接到支持Data API的无服务器集群的一个必要条件。这是防止将连接字符串传递给每个sql语句的好方法。</p></blockquote><h2 id="3fe7" class="mr lu iq bd lv ms mt dn lz mu mv dp md kj mw mx mh kn my mz ml kr na nb mp nc bi translated">创建数据库和表格</h2><ul class=""><li id="27f5" class="ni nj iq ka b kb nd kf ne kj of kn og kr oh kv oi no np nq bi translated">启动亚马逊<a class="ae kw" href="https://console.aws.amazon.com/rds/home?region=us-east-1" rel="noopener ugc nofollow" target="_blank"> RDS管理控制台</a></li><li id="5b80" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv oi no np nq bi translated">选择<strong class="ka ir">查询编辑器</strong></li><li id="65f5" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv oi no np nq bi translated">在<strong class="ka ir">连接数据库</strong>窗口中，选择您的集群，提供您的主用户、主密码和数据库名称(可选)。</li><li id="a049" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv oi no np nq bi translated">选择<strong class="ka ir">连接到数据库。</strong></li></ul><p id="e56f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在查询编辑器窗口中，运行以下命令:</p><p id="bbb0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">创建一个名为<em class="la"> AWSAlerts </em>的新数据库</strong>。</p><pre class="nx ny nz oa gt oj ok ol om aw on bi"><span id="0d03" class="mr lu iq ok b gy oo op l oq or">CREATE DATABASE AWSAlerts;</span></pre><p id="ff6f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建一个名为My<em class="la">AWS service</em>T17】的<strong class="ka ir">新表。我添加了“My ”,因为名称AWSService作为保留名称在某处发生了冲突。</strong></p><pre class="nx ny nz oa gt oj ok ol om aw on bi"><span id="d3e2" class="mr lu iq ok b gy oo op l oq or">USE AWSAlerts;<br/>CREATE TABLE MyAWSService (<br/>    id MEDIUMINT NOT NULL PRIMARY KEY,<br/>    shortName varchar(50),<br/>    longName varchar(50),<br/>    description TEXT,<br/>    serviceRegionName varchar(50) NOT NULL,<br/>    feedUrl varchar(50),<br/>    imageUrl varchar(50)<br/>);</span></pre><blockquote class="kx ky kz"><p id="86be" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">什么是AWSAlerts？这是我正在做的一个附带项目，它监视AWS服务健康仪表板，并通知订户所有AWS服务或网络事件的新的、更新的或已解决的仪表板事件。MyAWSService表将存储每个唯一服务和地区的属性，以及它们的RSS提要URL、服务图标和关于该服务的其他详细信息。</p></blockquote><h1 id="771b" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">下载演示iOS项目</h1><pre class="nx ny nz oa gt oj ok ol om aw on bi"><span id="20c9" class="mr lu iq ok b gy oo op l oq or">$ git clone <a class="ae kw" href="https://github.com/mobilequickie/iOS-RDS-Demo.git" rel="noopener ugc nofollow" target="_blank">https://github.com/mobilequickie/iOS-RDS-Demo.git</a></span><span id="47c6" class="mr lu iq ok b gy os op l oq or">$ cd iOS-RDS-Demo/</span></pre><h1 id="11aa" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">创建GraphQL API</h1><p id="2a6e" class="pw-post-body-paragraph jy jz iq ka b kb nd kd ke kf ne kh ki kj nf kl km kn ng kp kq kr nh kt ku kv ij bi translated">现在我们有了一个数据库、一个<em class="la"> AWSService </em>表和一个基本示例iOS应用程序，让我们使用AWS Amplify CLI创建一个GraphQL API。</p><p id="f7f1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Amplify CLI —安装CLI <br/> 如果您之前没有安装AWS Amplify CLI，请在继续下一步之前运行以下两个命令来安装和配置CLI。如果您已经安装了<strong class="ka ir"> AWS CLI </strong>并配置了配置文件，Amplify CLI将使用这些凭证，因此只需安装CLI，不需要<em class="la"> amplify configure </em>。</p><pre class="nx ny nz oa gt oj ok ol om aw on bi"><span id="7ddb" class="mr lu iq ok b gy oo op l oq or">$ npm install -g @aws-amplify/cli<br/>$ amplify configure</span></pre><p id="a996" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Amplify CLI — Init <br/> </strong>在您刚才克隆的iOS项目文件夹的根目录下启动Mac终端，并将其cd到您的Xcode项目根目录下:</p><pre class="nx ny nz oa gt oj ok ol om aw on bi"><span id="cec8" class="mr lu iq ok b gy oo op l oq or">$ cd iOS-RDS-Demo/</span></pre><p id="985a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将从本地项目根文件夹开始工作，以便Amplify CLI可以在提供后端资源时更新iOS项目。CLI将创建我们的API，授予iOS应用程序调用API的权限，并配置我们的iOS客户端通过iOS的AWS SDK连接到这些后端资源。</p><p id="6fe6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">放大CLI—初始化</strong></p><p id="33cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从项目根文件夹中，运行:</p><pre class="nx ny nz oa gt oj ok ol om aw on bi"><span id="84b4" class="mr lu iq ok b gy oo op l oq or">$ amplify init</span></pre><p id="79da" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">放大CLI —添加API </strong></p><pre class="nx ny nz oa gt oj ok ol om aw on bi"><span id="3777" class="mr lu iq ok b gy oo op l oq or">$ amplify add api<br/>? Please select from one of the below mentioned services <strong class="ok ir">GraphQL</strong><br/>? Provide API name: <strong class="ok ir">iosdemo</strong><br/>? Choose an authorization type for the API <strong class="ok ir">API key</strong><br/>? Do you have an annotated GraphQL schema? <strong class="ok ir">No</strong><br/>? Do you want a guided schema creation? <strong class="ok ir">Yes</strong><br/>? What best describes your project: <strong class="ok ir">Single object with fields (e.g., “Todo” with ID, name, description)</strong><br/>? Do you want to edit the schema now? <strong class="ok ir">Yes</strong><br/>Please edit the file in your editor: <strong class="ok ir">/Users/denhills/Desktop/iOS-RDS-Demo/amplify/backend/api/iosdemo/schema.graphql</strong></span></pre><p id="5c7e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">粘贴以下定义，因为这是创建GraphQL模式的最低要求。我们不想设置更多的东西，因为我们将使用一个插件来构建基于MySQL表列定义的模式。</p><pre class="nx ny nz oa gt oj ok ol om aw on bi"><span id="1165" class="mr lu iq ok b gy oo op l oq or">schema {<br/> query: Query<br/>}</span></pre><p id="6c4b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">保存模式并返回到终端，然后按enter键继续。</p><pre class="nx ny nz oa gt oj ok ol om aw on bi"><span id="7087" class="mr lu iq ok b gy oo op l oq or">? Press enter to continue</span></pre><p id="6458" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">放大CLI —添加MySQL数据库作为GraphQL数据源</strong></p><p id="a96b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这就是我们将Aurora无服务器MySQL数据库‘AWS alerts’作为数据源添加到GraphQL API的地方。Amplify CLI提供了一个插件，它将基于您的<strong class="ka ir">数据库表列定义</strong>生成GraphQL模式、解析器、变异、查询和订阅。让我们现在运行这个插件。</p><pre class="nx ny nz oa gt oj ok ol om aw on bi"><span id="929c" class="mr lu iq ok b gy oo op l oq or">$ <!-- -->amplify api add-graphql-datasource<br/>? Provide the region in which your cluster is located: <strong class="ok ir">us-east-1</strong><br/>? Select the Aurora Serverless cluster that will be used as the data source for your API: <strong class="ok ir">my-serverless-cluster-rdsauroraserverlesscluster-SAMPLE</strong><br/>✔ Fetched Aurora Serverless cluster.<br/>? Select the database to use as the datasource: <strong class="ok ir">AWSAlerts</strong><br/>Successfully added the Aurora Serverless datasource locally</span></pre><p id="9bd0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">放大CLI —推送</p><pre class="nx ny nz oa gt oj ok ol om aw on bi"><span id="fd27" class="mr lu iq ok b gy oo op l oq or">$ <!-- -->amplify push<br/>? Do you want to generate code for your newly created GraphQL API <strong class="ok ir">Yes</strong><br/>? Enter the file name pattern of graphql queries, mutations and subscriptions <strong class="ok ir">graphql/**/*.graphql</strong><br/>? Do you want to generate/update all possible GraphQL operations - queries, mutations and subscriptions <strong class="ok ir">Yes</strong><br/>? Enter maximum statement depth [increase from default if your schema is deeply nested] <strong class="ok ir">2</strong><br/>? Enter the file name for the generated code <strong class="ok ir">API.swift</strong><br/>⠏ Updating resources in the cloud. This may take a few minutes...</span></pre><p id="8894" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们已经将API连接到数据库，我们可以从AWS AppSync控制台尝试一些CRUD操作，以确保在转移到iOS客户端之前一切正常。</p><blockquote class="kx ky kz"><p id="22d2" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">1.启动<a class="ae kw" href="https://console.aws.amazon.com/appsync/home" rel="noopener ugc nofollow" target="_blank"> AppSync控制台</a>。</p><p id="12ff" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">2.选择左侧的<strong class="ka ir">查询</strong>功能。</p><p id="43f3" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">3.粘贴以下GraphQL <strong class="ka ir">突变</strong>以在AWSAlerts数据库的MyAWSService表中创建一个新的AWS服务。选择play按钮，您应该会看到字段列表和返回的id。</p></blockquote><pre class="nx ny nz oa gt oj ok ol om aw on bi"><span id="5f16" class="mr lu iq ok b gy oo op l oq or">mutation CreateAWSService {<br/>  createAWSService(createAWSServiceInput: {<br/>    id: 1<br/>    shortName: "EC2",<br/>    longName: "Amazon Elastic Compute Cloud",<br/>    serviceRegionName: "ec2-us-east-1",<br/>    feedUrl: "",<br/>    imageUrl: "ec2"<br/>  }) {<br/>    shortName<br/>    longName<br/>    serviceRegionName<br/>    feedUrl<br/>    imageUrl<br/>  }<br/>}</span></pre><blockquote class="kx ky kz"><p id="32eb" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">4.通过在突变的正下方粘贴以下内容来添加一个查询。选择play并选择这个查询，您应该看到为您在前面的变化中创建的至少一个服务返回的id、longName和shortName。</p></blockquote><pre class="nx ny nz oa gt oj ok ol om aw on bi"><span id="72ca" class="mr lu iq ok b gy oo op l oq or">query ListAWSServices {<br/>  listAWSServices {<br/>    id<br/>    longName<br/>    shortName<br/>  }<br/>}</span></pre><figure class="nx ny nz oa gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ot"><img src="../Images/cd41d1c68c59466c86c138f86ebccd08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p8vc0xSHXDrmZMHLH7jgRw.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk translated">AppSync控制台中的变异和查询测试如下所示</figcaption></figure><p id="e7eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们已经将模式、突变、查询、订阅和解析器连接到我们的无服务器Aurora数据库，作为GraphQL API的数据源，我们现在可以开始使用我们的移动客户端和生成的API.swift代码来与这个结构化数据进行交互！</p><h1 id="9534" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">iOS客户端</h1><p id="e078" class="pw-post-body-paragraph jy jz iq ka b kb nd kd ke kf ne kh ki kj nf kl km kn ng kp kq kr nh kt ku kv ij bi translated">在您的Xcode项目文件夹中，您现在应该有一个在您添加类别时由Amplify CLI自动生成的<code class="fe ou ov ow ok b">awsconfiguration.json</code>文件。此外，CLI <em class="la"> codegen </em>特性创建了一个<em class="la"> API.swift </em>文件，该文件定义了GraphQL突变、查询和订阅，以便我们直接从iOS应用程序中调用它们。首先，我们需要为iOS安装AWS SDK。</p><h2 id="c312" class="mr lu iq bd lv ms mt dn lz mu mv dp md kj mw mx mh kn my mz ml kr na nb mp nc bi translated">iOS客户端—第1部分</h2><p id="4574" class="pw-post-body-paragraph jy jz iq ka b kb nd kd ke kf ne kh ki kj nf kl km kn ng kp kq kr nh kt ku kv ij bi translated">为iOS添加AWS SDK(cocoa pods)</p><p id="5ec1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了配置应用程序，我们将使用<a class="ae kw" href="https://cocoapods.org/" rel="noopener ugc nofollow" target="_blank"> Cocoapods </a>来安装用于iOS和AWS AppSync客户端依赖项的AWS SDK。在根项目文件夹中，运行以下命令来初始化Cocoapods。</p><pre class="nx ny nz oa gt oj ok ol om aw on bi"><span id="bdf6" class="mr lu iq ok b gy oo op l oq or">pod init</span></pre><p id="fb27" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将创建一个新的<code class="fe ou ov ow ok b">Podfile</code>。在您喜欢的编辑器中打开<code class="fe ou ov ow ok b">Podfile</code>,并为AWSAppSync SDK添加以下依赖项:</p><pre class="nx ny nz oa gt oj ok ol om aw on bi"><span id="3770" class="mr lu iq ok b gy oo op l oq or">target 'RDSDemo' do<br/>  use_frameworks!</span><span id="5d8b" class="mr lu iq ok b gy os op l oq or">  # Pods for ios-amplify-app<br/>  pod 'AWSAppSync', ' ~&gt; 2.10.0'<br/>  <br/>end</span></pre><p id="0aab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过运行以下命令安装AppSync iOS SDK:</p><pre class="nx ny nz oa gt oj ok ol om aw on bi"><span id="bbbe" class="mr lu iq ok b gy oo op l oq or">$ pod install --repo-update</span></pre><h2 id="69dc" class="mr lu iq bd lv ms mt dn lz mu mv dp md kj mw mx mh kn my mz ml kr na nb mp nc bi translated">iOS客户端—第2部分</h2><p id="ed08" class="pw-post-body-paragraph jy jz iq ka b kb nd kd ke kf ne kh ki kj nf kl km kn ng kp kq kr nh kt ku kv ij bi translated">将<code class="fe ou ov ow ok b">awsconfiguration.json</code>和<code class="fe ou ov ow ok b">API.swift</code>文件集成到Xcode项目中。</p><p id="f8ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要配置我们的iOS Swift应用程序，以了解我们的新AWS Amplify项目。我们通过引用Xcode项目文件夹根目录下自动生成的<code class="fe ou ov ow ok b">awsconfiguration.json</code>和<code class="fe ou ov ow ok b">API.Swift</code>文件来实现这一点。</p><p id="2d22" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用启动Xcode。xcworkspace从现在开始，因为我们使用Cocoapods。</p><pre class="nx ny nz oa gt oj ok ol om aw on bi"><span id="a706" class="mr lu iq ok b gy oo op l oq or">$ open RDSDemo.xcworkspace<strong class="ok ir">/</strong></span></pre><p id="4e39" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在Xcode中，右击项目文件夹，选择<code class="fe ou ov ow ok b">"Add Files to ..."</code>，将<code class="fe ou ov ow ok b">awsconfiguration.json</code>和<code class="fe ou ov ow ok b">API.swift</code>文件添加到项目中。当出现“选项”对话框时，请执行以下操作:</p><ul class=""><li id="2990" class="ni nj iq ka b kb kc kf kg kj nk kn nl kr nm kv oi no np nq bi translated">清除“需要时复制项目”复选框。</li><li id="f8c5" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv oi no np nq bi translated">选择创建组，然后选择下一步。</li></ul><p id="5e69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">构建项目(Command-B)以确保我们没有任何编译错误。</p><h2 id="ec3b" class="mr lu iq bd lv ms mt dn lz mu mv dp md kj mw mx mh kn my mz ml kr na nb mp nc bi translated">iOS客户端—第3部分</h2><p id="8381" class="pw-post-body-paragraph jy jz iq ka b kb nd kd ke kf ne kh ki kj nf kl km kn ng kp kq kr nh kt ku kv ij bi translated">实现<em class="la">awsapsync客户端。</em>这是使用“API_Key授权”时的基本客户端配置。这对于连接到AWS服务的iOS应用程序来说并不常见。对于演示来说，这是最简单的方法。通常，您会通过Amazon Cognito用户池或其他社交身份提供者添加auth，甚至通过Amazon Cognito身份池添加未经认证的访问。</p><p id="2726" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将以下四个编号的代码片段添加到您的<em class="la">awsservicestableviewcontroller . swift</em>类:</p><figure class="nx ny nz oa gt jr"><div class="bz fp l di"><div class="ox oy l"/></div></figure><h2 id="345a" class="mr lu iq bd lv ms mt dn lz mu mv dp md kj mw mx mh kn my mz ml kr na nb mp nc bi translated">iOS客户端—第4部分</h2><p id="66f4" class="pw-post-body-paragraph jy jz iq ka b kb nd kd ke kf ne kh ki kj nf kl km kn ng kp kq kr nh kt ku kv ij bi translated">添加GraphQL <strong class="ka ir">突变</strong> —在MyAWSService表中创建一个新的AWS服务</p><ol class=""><li id="5dc7" class="ni nj iq ka b kb kc kf kg kj nk kn nl kr nm kv nn no np nq bi translated">将以下突变函数添加到您的<em class="la">awsservicestableviewcontroller . swift</em>类中:</li></ol><figure class="nx ny nz oa gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oz"><img src="../Images/c24693e7bb3987085b859447c1267510.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qdHJhPT5tQANdIPL8jSplQ.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk translated"><a class="ae kw" href="https://gist.github.com/mobilequickie/ac74137dcf60ab6569804d205ef38a93" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/mobile quickie/AC 74137 DCF 60 ab 6569804d 205 ef 38 a 93</a></figcaption></figure><p id="5176" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.在<em class="la"> viewDidLoad() </em>中添加对createServiceMutation()的调用</p><pre class="nx ny nz oa gt oj ok ol om aw on bi"><span id="eb62" class="mr lu iq ok b gy oo op l oq or">createServiceMutation()</span></pre><h2 id="9d40" class="mr lu iq bd lv ms mt dn lz mu mv dp md kj mw mx mh kn my mz ml kr na nb mp nc bi translated">iOS客户端—第5部分</h2><p id="68d0" class="pw-post-body-paragraph jy jz iq ka b kb nd kd ke kf ne kh ki kj nf kl km kn ng kp kq kr nh kt ku kv ij bi translated">添加一个GraphQL <strong class="ka ir">查询</strong> —列出MyAWSService表中的所有AWS服务</p><ol class=""><li id="9507" class="ni nj iq ka b kb kc kf kg kj nk kn nl kr nm kv nn no np nq bi translated">向您的<em class="la">awsservicestableviewcontroller . swift</em>类添加以下查询函数:</li></ol><figure class="nx ny nz oa gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pa"><img src="../Images/7e460615fafcbbd584bb822b2f915379.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_bCayA_3V76dNIX7QnUdrw.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk translated"><a class="ae kw" href="https://gist.github.com/mobilequickie/9f8b74d399540d5264f71d45b315c5ba" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/mobile quickie/9 F8 b 74d 399540d 5264 f 71d 45 b 315 C5 ba</a></figcaption></figure><p id="dde2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.在<em class="la"> viewDidLoad() </em>中添加对getServicesQuery()的调用，并注释掉变异</p><pre class="nx ny nz oa gt oj ok ol om aw on bi"><span id="9c0e" class="mr lu iq ok b gy oo op l oq or">getServicesQuery()</span></pre><p id="8cb4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.将<strong class="ka ir"> awsServices </strong>类变量添加到AWSServicesTableViewController</p><pre class="nx ny nz oa gt oj ok ol om aw on bi"><span id="1389" class="mr lu iq ok b gy oo op l oq or"><strong class="ok ir">// </strong>class level variable<strong class="ok ir"><br/></strong>var awsServices: [ListAwsServicesQuery.Data.ListAwsService] = []</span></pre><p id="d2b4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">4.注释掉硬编码的<em class="la"> var awsServices = […] </em>，因为我们现在从查询结果中动态加载这个变量。</p><h2 id="3b10" class="mr lu iq bd lv ms mt dn lz mu mv dp md kj mw mx mh kn my mz ml kr na nb mp nc bi translated">iOS客户端—第6部分</h2><p id="2d66" class="pw-post-body-paragraph jy jz iq ka b kb nd kd ke kf ne kh ki kj nf kl km kn ng kp kq kr nh kt ku kv ij bi translated">构建并运行应用程序。</p><p id="268c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您之前克隆的starter iOS应用程序选择了几个服务图标(如下所示)。table视图将显示您添加到MyAWSService表中的AWS服务的完整列表。客户端被设置为首先显示缓存的列表，然后从服务器获取最新的列表。您可以启动应用程序，查看结果，然后通过AppSync控制台或RDS控制台返回以更新表格，然后再次启动应用程序。你会看到应用程序立即显示缓存的结果，然后一秒钟后，视图将更新最新提取的数据。</p><figure class="nx ny nz oa gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pb"><img src="../Images/0ac45272c254bf76df9e6cc2a9fb70a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cXLyjkc7rZgAk9CLN_j1zQ.png"/></div></div></figure><h1 id="7cb8" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">最后的想法</h1><p id="38c4" class="pw-post-body-paragraph jy jz iq ka b kb nd kd ke kf ne kh ki kj nf kl km kn ng kp kq kr nh kt ku kv ij bi translated">在本文中，我们创建了一个Aurora无服务器MySQL数据库，并启用了Data API特性，这样我们就可以通过GraphQL API从iOS应用程序与我们的数据库进行交互。您可能会想，支持数据API的数据库有什么好处呢？好吧，下面是我对数据API的三大好处:<strong class="ka ir"> 1 </strong>。您不再需要创建连接池或使用特定于语言的驱动程序来建立连接、进行身份验证和调用SQL语句。<strong class="ka ir"> 2 </strong>。sql语句的响应总是JSON ( <strong class="ka ir"> mysql </strong>查询输出以表格形式显示为行和列)<strong class="ka ir"> 3 </strong>。对数据库的调用是通过HTTPS的直接sql语句，而不是包装/复杂的请求。</p><p id="37ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">支持数据API的无服务器MySQL数据库现在是一个“数据层”抽象，其中底层的NoSQL或SQL引擎是不相关的。就像<strong class="ka ir"> Parse </strong>对<strong class="ka ir">核心数据</strong>和<a class="ae kw" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>的抽象一样。我敢打赌，我们很快就会看到内置的数据浏览器，你可以在其中以基于网络的表格格式处理数据。我对此非常兴奋，但是请让我知道你的想法。</p></div></div>    
</body>
</html>