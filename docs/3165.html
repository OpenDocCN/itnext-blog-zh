<html>
<head>
<title>PHP Microservice Framework Swoft: WebSocket Server Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PHP微服务框架Swoft: WebSocket服务器第1部分</h1>
<blockquote>原文：<a href="https://itnext.io/php-microservice-framework-swoft-websocket-server-part-1-e28632501db8?source=collection_archive---------3-----------------------#2019-10-15">https://itnext.io/php-microservice-framework-swoft-websocket-server-part-1-e28632501db8?source=collection_archive---------3-----------------------#2019-10-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0191dd32621835a91d010137a124911b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sLozPxSmmqXY5Bz9V0ZiDg.jpeg"/></div></div></figure><p id="176a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们要学习的这篇文章是:如何安装和运行swoft websocket服务器。</p><blockquote class="kw kx ky"><p id="ae34" class="jy jz kz ka b kb kc kd ke kf kg kh ki la kk kl km lb ko kp kq lc ks kt ku kv ij bi translated"><em class="iq">本文是Swoft HTTP Server系列文章之一。来了解一下Swoft吧！</em></p></blockquote><h1 id="b31a" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">什么是Swoft？</h1><p id="9b9d" class="pw-post-body-paragraph jy jz iq ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">Swoft是一个PHP高性能微服务协程框架。已经出版多年，已经成为php的不二之选。它可以像Go一样，内置协同web服务器和通用协同客户端，驻留在内存中，独立于传统的PHP-FPM。还有类似的Go语言操作，类似于Spring Cloud框架的灵活注解。</p><p id="8b82" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Swoft通过三年的积累和方向探索，将Swoft打造成PHP界的春天云，是PHP高性能框架和微服务管理的不二之选。</p><h1 id="39e2" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">开源代码库</h1><div class="mg mh gp gr mi mj"><a href="https://github.com/swoft-cloud/swoft" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd ir gy z fp mo fr fs mp fu fw ip bi translated">软件云/软件</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">PHP微服务协程框架Swoft是一个基于Swoole扩展的PHP微服务协程框架…</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">github.com</p></div></div><div class="ms l"><div class="mt l mu mv mw ms mx jw mj"/></div></div></a></div><h1 id="c287" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">创建新项目</h1><p id="08dc" class="pw-post-body-paragraph jy jz iq ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">使用<code class="fe my mz na nb b">swoft-cli</code>工具为Websocket创建新项目。</p><pre class="nc nd ne nf gt ng nb nh ni aw nj bi"><span id="e3e2" class="nk le iq nb b gy nl nm l nn no">php swoftcli.phar create:app --type ws swoft-ws-app<br/>cd swoft-ws-app<br/>composer install</span></pre><h1 id="1229" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">启动服务器</h1><p id="8727" class="pw-post-body-paragraph jy jz iq ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">用<code class="fe my mz na nb b">php bin/swoft ws:start</code>命令启动Websocket服务器，可以看到下图:</p><pre class="nc nd ne nf gt ng nb nh ni aw nj bi"><span id="618f" class="nk le iq nb b gy nl nm l nn no">$ php bin/swoft ws:start</span><span id="d425" class="nk le iq nb b gy np nm l nn no">                                      Information Panel<br/>  ********************************************************************<br/>  * WebSocket | Listen: 0.0.0.0:18308, type: TCP, mode: Process, worker: 8<br/>********************************************************************</span></pre><blockquote class="kw kx ky"><p id="c8d0" class="jy jz kz ka b kb kc kd ke kf kg kh ki la kk kl km lb ko kp kq lc ks kt ku kv ij bi translated"><em class="iq">web socket服务器的端口是</em>T2</p></blockquote><h1 id="4247" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">创建一个模块</h1><p id="741d" class="pw-post-body-paragraph jy jz iq ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">使用<code class="fe my mz na nb b">swoft-cli</code>工具创建新的websocket模块。</p><pre class="nc nd ne nf gt ng nb nh ni aw nj bi"><span id="3d58" class="nk le iq nb b gy nl nm l nn no">php swoftcli.phar gen:ws-mod echo --prefix /echo</span></pre><p id="7c05" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回送模块(<code class="fe my mz na nb b">app/WebSocket/EchoModule.php</code>)的代码如下:</p><pre class="nc nd ne nf gt ng nb nh ni aw nj bi"><span id="4495" class="nk le iq nb b gy nl nm l nn no">&lt;?php declare(strict_types=1);</span><span id="bdb5" class="nk le iq nb b gy np nm l nn no">namespace App\WebSocket;</span><span id="85aa" class="nk le iq nb b gy np nm l nn no">use Swoft\Http\Message\Request;<br/>use Swoft\Http\Message\Response;<br/>use Swoft\WebSocket\Server\Annotation\Mapping\WsModule;<br/>use Swoft\WebSocket\Server\Annotation\Mapping\OnOpen;<br/>use Swoft\WebSocket\Server\Annotation\Mapping\OnHandshake;<br/>use Swoft\WebSocket\Server\Annotation\Mapping\OnMessage;<br/>use Swoole\WebSocket\Server;</span><span id="4156" class="nk le iq nb b gy np nm l nn no">/**<br/> * Class EchoModule - This is an module for handle websocket<br/> *<br/> * @WsModule("/echo")<br/> */<br/>class EchoModule<br/>{<br/>    /**<br/>     * @OnHandshake()<br/>     * @param Request $request<br/>     * @param Response $response<br/>     * @return array<br/>     */<br/>    public function checkHandshake(Request $request, Response $response): array<br/>    {<br/>        // some validate logic ...<br/>        return [true, $response];<br/>    }</span><span id="99d4" class="nk le iq nb b gy np nm l nn no">    /**<br/>     * @OnOpen()<br/>     * @param Server $server<br/>     * @param Request $request<br/>     * @param int $fd<br/>     * @return mixed<br/>     */<br/>    public function onOpen(Server $server, Request $request, int $fd)<br/>    {<br/>        $server-&gt;push($fd, 'hello, welcome! :)');<br/>    }<br/>    <br/>    /**<br/>     * @OnMessage()<br/>     * @param Server $server<br/>     * @param Frame  $frame<br/>     */<br/>    public function onMessage(Server $server, Frame $frame): void<br/>    {<br/>        $server-&gt;push($frame-&gt;fd, 'Recv: ' . $frame-&gt;data);<br/>    }<br/>}</span></pre><h1 id="c247" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">访问Websocket服务器</h1><p id="b0a6" class="pw-post-body-paragraph jy jz iq ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">这里使用<code class="fe my mz na nb b">swoft-devtool</code>连接WebSocket服务器。</p><p id="ccf9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用<code class="fe my mz na nb b">swoft-devtool</code>组件中的<code class="fe my mz na nb b">php bin/swoft dclient:ws /echo</code>命令连接WebSocket服务器，可以看到如下连接成功消息。</p><pre class="nc nd ne nf gt ng nb nh ni aw nj bi"><span id="9bd6" class="nk le iq nb b gy nl nm l nn no">Begin connecting to websocket server: 127.0.0.1:18308 path: /echo<br/>Success connect to websocket server. Now, you can send message<br/>INTERACTIVE<br/>================================================================================<br/>server&gt; ?Opened, welcome #1!<br/>client&gt; hi<br/>server&gt; Recv: hi<br/>client&gt;</span></pre><h1 id="0b4f" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">开源代码库</h1><div class="mg mh gp gr mi mj"><a href="https://github.com/swoft-cloud/swoft" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd ir gy z fp mo fr fs mp fu fw ip bi translated">软件云/软件</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">PHP微服务协程框架Swoft是一个基于Swoole扩展的PHP微服务协程框架…</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">github.com</p></div></div><div class="ms l"><div class="mt l mu mv mw ms mx jw mj"/></div></div></a></div></div></div>    
</body>
</html>