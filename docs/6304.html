<html>
<head>
<title>The Easy Way to Install Kubernetes 1.22 and containerd</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">安装Kubernetes 1.22和containerd的简单方法</h1>
<blockquote>原文：<a href="https://itnext.io/the-easy-way-to-install-kubernetes-1-22-and-containerd-fec2d07912bd?source=collection_archive---------1-----------------------#2021-10-13">https://itnext.io/the-easy-way-to-install-kubernetes-1-22-and-containerd-fec2d07912bd?source=collection_archive---------1-----------------------#2021-10-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d58247299e5a599502bd7c519dd1b306.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NWOLATkhfTwH-g_F.png"/></div></div></figure><p id="3c79" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">KubeKey 是一个轻量级的交钥匙安装程序，支持Kubernetes、KubeSphere和相关附加组件的安装。KubeKey用Go编写，使您能够在几分钟内建立一个Kubernetes集群。在这篇博客中，我们将用KubeKey的一个命令<a class="ae kw" href="https://kubesphere.io/blogs/install-kubernetes-containerd/" rel="noopener ugc nofollow" target="_blank">安装Kubernetes 1.22和containerd </a>。</p><h1 id="6530" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">步骤1:准备一台Linux机器</h1><p id="6af8" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">要开始一体化安装，您只需根据以下硬件和操作系统要求准备一台主机。</p><h1 id="ac6c" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">硬件建议</h1><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ma"><img src="../Images/e2e98a5558f33a475b5013f5bea5be51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uc77AwbTlGWMWgKM9YUYpg.png"/></div></div></figure><h1 id="1bd7" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">节点要求</h1><ul class=""><li id="3ff9" class="mf mg iq ka b kb lv kf lw kj mh kn mi kr mj kv mk ml mm mn bi translated">可以通过<code class="fe mo mp mq mr b">SSH</code>访问该节点。</li><li id="f2fe" class="mf mg iq ka b kb ms kf mt kj mu kn mv kr mw kv mk ml mm mn bi translated">应该使用<code class="fe mo mp mq mr b">sudo</code> / <code class="fe mo mp mq mr b">curl</code> / <code class="fe mo mp mq mr b">openssl</code>。</li></ul><h1 id="b6a9" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">依赖性要求</h1><p id="78d7" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">KubeKey可以一起安装Kubernetes和KubeSphere。根据要安装的Kubernetes版本，需要安装的依赖项可能会有所不同。您可以参考下面的列表，看看是否需要提前在您的节点上安装相关的依赖项。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/4190749f0fd8c6bc8cbe83fa46bef9f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mj52X2NFd6_iW9FK7dTM2g.png"/></div></div></figure><h1 id="1bfa" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">网络和DNS要求</h1><ul class=""><li id="0d75" class="mf mg iq ka b kb lv kf lw kj mh kn mi kr mj kv mk ml mm mn bi translated">确保<code class="fe mo mp mq mr b">/etc/resolv.conf</code>的DNS地址可用。否则，可能会导致群集中的DNS出现一些问题。</li><li id="f440" class="mf mg iq ka b kb ms kf mt kj mu kn mv kr mw kv mk ml mm mn bi translated">如果您的网络配置使用防火墙规则或安全组，您必须确保基础架构组件可以通过特定端口相互通信。建议您关闭防火墙。更多信息，参见<a class="ae kw" href="https://kubesphere.io/installing-on-linux/introduction/port-firewall/" rel="noopener ugc nofollow" target="_blank">端口要求</a>。</li><li id="e0a1" class="mf mg iq ka b kb ms kf mt kj mu kn mv kr mw kv mk ml mm mn bi translated">支持CNI插件:印花布和法兰绒。其他(如纤毛和库贝-OVN)也可能工作，但请注意，他们还没有完全测试。</li></ul><h1 id="e765" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">第二步:下载KubeKey</h1><p id="bfea" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">执行以下步骤下载KubeKey。</p><ul class=""><li id="8a8d" class="mf mg iq ka b kb kc kf kg kj my kn mz kr na kv mk ml mm mn bi translated"><a class="ae kw" href="https://kubesphere.io/blogs/install-kubernetes-containerd/#" rel="noopener ugc nofollow" target="_blank">与GitHub/Google API的良好网络连接</a></li></ul><p id="f244" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从其<a class="ae kw" href="https://github.com/kubesphere/kubekey/releases" rel="noopener ugc nofollow" target="_blank"> GitHub发布页面</a>下载KubeKey或运行以下命令:</p><pre class="mb mc md me gt nb mr nc nd aw ne bi"><span id="b066" class="nf ky iq mr b gy ng nh l ni nj">curl -L <a class="ae kw" href="https://github.com/kubesphere/kubekey/releases/download/v1.2.0-alpha.4/kubekey-v1.2.0-alpha.4-linux-amd64.tar.gz" rel="noopener ugc nofollow" target="_blank">https://github.com/kubesphere/kubekey/releases/download/v1.2.0-alpha.4/kubekey-v1.2.0-alpha.4-linux-amd64.tar.gz</a> &gt; installer.tar.gz &amp;&amp; tar -zxf installer.tar.gz</span></pre><ul class=""><li id="8f2e" class="mf mg iq ka b kb kc kf kg kj my kn mz kr na kv mk ml mm mn bi translated"><a class="ae kw" href="https://kubesphere.io/blogs/install-kubernetes-containerd/#" rel="noopener ugc nofollow" target="_blank">与GitHub/Google API的网络连接不良</a></li></ul><p id="dd86" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先运行以下命令，确保从正确的区域下载KubeKey。</p><pre class="mb mc md me gt nb mr nc nd aw ne bi"><span id="0177" class="nf ky iq mr b gy ng nh l ni nj">export KKZONE=cn</span></pre><p id="b03d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行以下命令下载KubeKey:</p><pre class="mb mc md me gt nb mr nc nd aw ne bi"><span id="43d3" class="nf ky iq mr b gy ng nh l ni nj">curl -L <a class="ae kw" href="https://github.com/kubesphere/kubekey/releases/download/v1.2.0-alpha.4/kubekey-v1.2.0-alpha.4-linux-amd64.tar.gz" rel="noopener ugc nofollow" target="_blank">https://github.com/kubesphere/kubekey/releases/download/v1.2.0-alpha.4/kubekey-v1.2.0-alpha.4-linux-amd64.tar.gz</a> &gt; installer.tar.gz &amp;&amp; tar -zxf installer.tar.gz</span></pre><p id="59ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nk">注:</em></p><p id="5716" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nk">下载KubeKey后，如果您将它转移到一台与Googleapis的网络连接不良的新机器上，您必须再次运行</em> <code class="fe mo mp mq mr b"><em class="nk">export KKZONE=cn</em></code> <em class="nk">才能继续以下步骤。</em></p><p id="40e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使<code class="fe mo mp mq mr b">kk</code>可执行:</p><pre class="mb mc md me gt nb mr nc nd aw ne bi"><span id="95a8" class="nf ky iq mr b gy ng nh l ni nj">chmod +x kk</span></pre><h1 id="779b" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">步骤3:开始安装</h1><p id="a425" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">对于一体化安装，您只需运行一个命令。</p><pre class="mb mc md me gt nb mr nc nd aw ne bi"><span id="5f2d" class="nf ky iq mr b gy ng nh l ni nj">./kk create cluster --with-kubernetes v1.22.1 --container-manager containerd</span></pre><p id="281f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nk">注:</em></p><ul class=""><li id="4e3d" class="mf mg iq ka b kb kc kf kg kj my kn mz kr na kv mk ml mm mn bi translated"><em class="nk">支持的Kubernetes版本:v1.19.8、v1.20.4、v1.21.4、v1.22.1。如果未指定Kubernetes版本，KubeKey默认安装Kubernetes v1.21.5。有关受支持的Kubernetes版本的更多信息，请参见</em> <a class="ae kw" href="https://github.com/kubesphere/kubekey/blob/master/docs/kubernetes-versions.md" rel="noopener ugc nofollow" target="_blank"> <em class="nk">支持矩阵</em> </a> <em class="nk">。</em></li><li id="98a1" class="mf mg iq ka b kb ms kf mt kj mu kn mv kr mw kv mk ml mm mn bi translated"><em class="nk">对于一体化安装，您不需要更改任何配置。</em></li><li id="4600" class="mf mg iq ka b kb ms kf mt kj mu kn mv kr mw kv mk ml mm mn bi translated"><em class="nk"> KubeKey支持AMD64和ARM64。</em></li></ul><p id="ecc9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行该命令后，您将看到一个环境检查表。详见<a class="ae kw" href="https://kubesphere.io/blogs/install-kubernetes-containerd/#node-requirements" rel="noopener ugc nofollow" target="_blank">节点要求</a>和<a class="ae kw" href="https://kubesphere.io/blogs/install-kubernetes-containerd/#dependency-requirements" rel="noopener ugc nofollow" target="_blank">依赖要求</a>。键入<code class="fe mo mp mq mr b">yes</code>继续。</p><h1 id="3b10" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">步骤4:验证安装</h1><p id="1222" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">如果显示以下信息，则Kubernetes安装成功。</p><pre class="mb mc md me gt nb mr nc nd aw ne bi"><span id="a89b" class="nf ky iq mr b gy ng nh l ni nj">INFO[00:40:00 CST] Congratulations! Installation is successful.</span></pre><p id="6244" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行以下命令来检查容器运行时和Kubernetes版本。</p><pre class="mb mc md me gt nb mr nc nd aw ne bi"><span id="4c98" class="nf ky iq mr b gy ng nh l ni nj">kubectl get node -o wide</span><span id="88da" class="nf ky iq mr b gy nl nh l ni nj">NAME         STATUS   ROLES                         AGE   VERSION   <br/>i-mxtuejcj   Ready    control-plane,master,worker   45s   v1.22.1</span><span id="7e03" class="nf ky iq mr b gy nl nh l ni nj"><br/>INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                <br/>192.168.6.2   &lt;none&gt;        CentOS Linux 7 (Core)<br/></span><span id="9361" class="nf ky iq mr b gy nl nh l ni nj">KERNEL-VERSION           CONTAINER-RUNTIME<br/>3.10.0-1160.el7.x86_64   containerd://1.4.9</span></pre><p id="e0d3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行以下命令检查Pod状态。</p><pre class="mb mc md me gt nb mr nc nd aw ne bi"><span id="179a" class="nf ky iq mr b gy ng nh l ni nj">kubectl get pod --all-namespaces</span><span id="e1a8" class="nf ky iq mr b gy nl nh l ni nj">NAMESPACE     NAME             READY   STATUS    RESTARTS    AGE<br/>kube-system   calico-kube<br/>             -controllers<br/>             -75ddb95444<br/>             -6vgcm             1/1     Running   0          39s<br/>kube-system   calico<br/>             -node-knhhs        1/1     Running   0          39s<br/>kube-system   coredns<br/>             -5495dd7c88<br/>             -6w5gt             1/1     Running   0          48s<br/>kube-system   coredns<br/>             -5495dd7c88<br/>             -982kj             1/1     Running   0          48s<br/>kube-system   kube<br/>             -apiserver<br/>             -i-mxtuejcj        1/1     Running   0          56s<br/>kube-system   kube<br/>             -controller<br/>             -manager<br/>             -i-mxtuejcj        1/1     Running   0          56s<br/>kube-system   kube<br/>             -proxy-6vlsj       1/1     Running   0          48s<br/>kube-system   kube<br/>             -scheduler<br/>             -i-mxtuejcj        1/1     Running   0          64s<br/>kube-system   nodelocaldns<br/>             -7zqp2             1/1     Running   0          48s</span></pre><p id="a53d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">恭喜你！您已经安装了一个带有containerd的单节点Kubernetes集群。有关KubeKey的高级用法，请参见<a class="ae kw" href="https://kubesphere.io/docs/installing-on-linux/introduction/intro/" rel="noopener ugc nofollow" target="_blank">在Linux上安装—概述</a>了解更多信息。</p><h1 id="c634" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">关于KubeSphere</h1><p id="52ab" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">KubeSphere是一个基于Kubernetes的开源容器平台，其核心是应用程序。它提供全栈It自动化操作和简化的开发运维工作流。</p><p id="8ace" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://kubesphere.io/" rel="noopener ugc nofollow" target="_blank"> KubeSphere </a>已被全球数千家企业采用，如<strong class="ka ir"> Aqara、新浪、奔来、中国太平、华夏银行、国药控股、微众银行、Geko Cloud、VNG公司、Radore </strong>。KubeSphere为运维提供向导界面和各种企业级功能，包括Kubernetes资源管理、<a class="ae kw" href="https://kubesphere.io/devops/" rel="noopener ugc nofollow" target="_blank">、DevOps (CI/CD) </a>、应用生命周期管理、服务网格、多租户管理、<a class="ae kw" href="https://kubesphere.io/observability/" rel="noopener ugc nofollow" target="_blank">监控</a>、日志记录、警报、通知、存储和网络管理以及GPU支持。有了KubeSphere，企业能够快速建立一个强大且功能丰富的容器平台。</p><p id="af43" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">欲了解更多信息，请访问<a class="ae kw" href="https://kubesphere.io/" rel="noopener ugc nofollow" target="_blank"> https://kubesphere.io </a></p></div></div>    
</body>
</html>