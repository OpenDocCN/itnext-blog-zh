<html>
<head>
<title>Building a Kubernetes Hybrid Cloud with Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Terraform构建Kubernetes混合云</h1>
<blockquote>原文：<a href="https://itnext.io/building-a-kubernetes-hybrid-cloud-with-terraform-fe15164b35fb?source=collection_archive---------5-----------------------#2018-12-20">https://itnext.io/building-a-kubernetes-hybrid-cloud-with-terraform-fe15164b35fb?source=collection_archive---------5-----------------------#2018-12-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3699" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我正在接受新的挑战；如何构建混合云？市场上对“混合云”有大量的讨论，但它真正意味着什么呢？对我来说，这意味着将多个云解决方案作为单一资源池加以利用。就像俗话说的“<a class="ae kl" href="https://dictionary.cambridge.org/us/dictionary/english/horses-for-courses" rel="noopener ugc nofollow" target="_blank">马换课程</a>”，不同的云有不同的优势。本文并不打算给出哪种云比其他任何云更好或更便宜的意见，但可能一个云提供商有更偏好的地理位置，可能他们对特定的实例大小有更便宜的费率，可能他们有其他提供商没有的服务(即大数据或机器学习)。我还包括提供“<a class="ae kl" href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-145.pdf" rel="noopener ugc nofollow" target="_blank">云服务</a>的<strong class="jp ir">私人数据中心</strong>，因为它们也有独特的功能。</p><p id="376b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我的目标是构建一个基于kubernetes的混合云。为什么？对我来说，这是最开放、最灵活的方式。有许多技术可以帮助您构建混合云；他们中的大多数人都非常固执己见。例如:<a class="ae kl" href="https://aws.amazon.com/vmware/" rel="noopener ugc nofollow" target="_blank"> VMware有带AWS的混合产品</a>，<a class="ae kl" href="https://www.nutanix.com/products/xi-cloud-services/" rel="noopener ugc nofollow" target="_blank"> Nutanix有Xi </a>，<a class="ae kl" href="https://azure.microsoft.com/en-us/overview/azure-stack/" rel="noopener ugc nofollow" target="_blank">微软有Azure和AzureStack </a>。我不太喜欢这些解决方案，因为它们将你锁定在一个特定的超级用户中，并将你限制在他们选择的云提供商中。Kubernetes正迅速成为容器编排的首选(容器的超级管理器，以过度简化it)。<a class="ae kl" href="https://landscape.cncf.io/cncf=member&amp;grouping=landscape&amp;landscape=cloud,platform,kubernetes-certified-service-provider" rel="noopener ugc nofollow" target="_blank">每个主要的云提供商和基础设施提供商</a>都在跳上Kubernetes的列车。这将为您的混合云提供一个单一的通用框架，以及一种一致的方式来部署和管理应用程序，而不管云是什么。</p><p id="4b49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">我在建造什么？</strong></p><p id="b974" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用AWS和Google云平台，使用他们的本地托管Kubernetes服务(EKS和GKE)创建一个混合云。使用VPN进行基本的IP连接，并使用<a class="ae kl" href="http://istio.io" rel="noopener ugc nofollow" target="_blank"> Istio </a>创建“<a class="ae kl" href="https://istio.io/docs/concepts/what-is-istio/#what-is-a-service-mesh" rel="noopener ugc nofollow" target="_blank">服务网格</a>”。</p><p id="95a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我如何构建它？</p><p id="8ac9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用terraform，我可以按需设置整个环境。这意味着我要在每个云中创建一个新的VPC，在两者之间创建一个VPN，部署Kubernetes master (EKS &amp; GKE)，并在每个云中启动worker节点。然后我安装Istio作为“服务网格”。这基本上允许您的两个kubernetes集群充当单个资源池(也称为混合云)，同时具有遥测和可见性。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/f81273931b163fe35085d966b81de34b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iRZEOdSFF1O_yGjQR9S44Q.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">逻辑基础结构图</figcaption></figure><p id="4d73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">我在跑什么？</strong></p><p id="821d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我正在使用一个名为<a class="ae kl" href="https://istio.io/docs/examples/bookinfo/" rel="noopener ugc nofollow" target="_blank"> Bookinfo </a>的示例应用程序，它是一个基于容器的多层应用程序。reviews层运行在两个云上，并在“Reviews层”的每个版本之间进行负载均衡。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lc"><img src="../Images/46f6fb6925ad0ccaf62ccc4c10d76987.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*79AWCaEUqgD4KIBl3fK0mg.png"/></div></div></figure><p id="268c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ld le lf lg b">Disclaimer: This is not a production grade system. There are limitations and lack of proper redundancy.</code></p><p id="b54b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ld le lf lg b">Warning: This will cost you money on each cloud.</code></p><p id="6f9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想亲自尝试，请查看我的<a class="ae kl" href="https://github.com/magic7s/k8s-hybrid-cloud" rel="noopener ugc nofollow" target="_blank"> github repo </a>。</p><pre class="kn ko kp kq gt lh lg li lj aw lk bi"><span id="4a88" class="ll lm iq lg b gy ln lo l lp lq">git clone <a class="ae kl" href="https://github.com/magic7s/k8s-hybrid-cloud.git" rel="noopener ugc nofollow" target="_blank">https://github.com/magic7s/k8s-hybrid-cloud.git</a></span><span id="2048" class="ll lm iq lg b gy lr lo l lp lq"># Checkout the README.md file for prerequisites needed to run.<br/># You need kubectl, helm, aws-iam-authenticator, and gcloud <br/># installed locally. Plus a customer terraform provider.</span><span id="39ce" class="ll lm iq lg b gy lr lo l lp lq">terraform init<br/>terraform apply<br/>#-- An error will be thrown. See bug https://github.com/magic7s/k8s-hybrid-cloud/issues/3<br/>terrafom apply<br/>cd sample_app<br/>./install_bookinfo.sh</span></pre></div></div>    
</body>
</html>