<html>
<head>
<title>Istio the Easy Way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">这是最简单的方法</h1>
<blockquote>原文：<a href="https://itnext.io/istio-the-easy-way-8ddcea6f947d?source=collection_archive---------7-----------------------#2019-04-23">https://itnext.io/istio-the-easy-way-8ddcea6f947d?source=collection_archive---------7-----------------------#2019-04-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jn jo jp jq gh gi paragraph-image"><div class="ab gu cl jr"><img src="../Images/a54200d52d5bec7910d1e578d1148d4e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*C9RN4BVl_62tQDsyOGcweA.png"/></div></figure><p id="a3f2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我目前正在为<a class="ae ks" href="https://www.manning.com" rel="noopener ugc nofollow" target="_blank">曼宁出版社</a>写一本书，书名为<a class="ae ks" href="https://www.manning.com/books/istio-in-action" rel="noopener ugc nofollow" target="_blank"> Istio in Action </a>，这本书的目标是帮助人们了解并从<a class="ae ks" href="https://istio.io" rel="noopener ugc nofollow" target="_blank"> Istio </a>中获得最大利益，这是一个开源服务网格。我正试图将我从社区中获得的知识和经验，以及那些已经踏上服务网格采用之旅的其他人的知识和经验，汇集到服务网格社区的其他人身上。</p><p id="48bd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在那些成功采用Istio的组织中，一个有趣的观察结果似乎是正确的，那就是他们倾向于在转向更广泛的问题之前专注于解决一组特定的和集中的问题。换句话说，他们倾向于渐进地采用Istio，并展示特定问题的价值，而不是全身心投入并采用Istio能做的一切。</p><p id="cac9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">例如，组织可能需要加密入口网关和终端服务之间的流量。或者，他们可能正在进行更紧迫的指标收集和跟踪工作。逐步采用Istio可以为这些用例带来很多价值，而不会陷入复杂性，也不会将一大群利益相关者带入一个可能会拖上几个月甚至几年的过程。</p><h1 id="9433" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">服务网格入门</h1><p id="cb52" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">在这一点上，如果你想快速开始使用任何服务网格(<a class="ae ks" href="https://istio.io" rel="noopener ugc nofollow" target="_blank"> Istio </a>、<a class="ae ks" href="https://linkerd.io" rel="noopener ugc nofollow" target="_blank"> Linkerd </a>、<a class="ae ks" href="https://aws.amazon.com/app-mesh/" rel="noopener ugc nofollow" target="_blank"> AWS AppMesh </a>等)，你应该看看Solo.io的一个开源项目，名为<a class="ae ks" href="https://supergloo.solo.io" rel="noopener ugc nofollow" target="_blank"> SuperGloo </a>。有了SuperGloo，你可以用一组统一的命令<a class="ae ks" href="https://supergloo.solo.io/mesh/tutorials/istio/tutorials-1-trafficshifting/" rel="noopener ugc nofollow" target="_blank">快速引导一个网格</a>，并根据需要探索和比较/对比它们。这样做的一个很好的例子是<a class="ae ks" href="https://t.co/Gs1Sk2kE5x" rel="noopener ugc nofollow" target="_blank"> Shopify最近的Istio vs Linkerd perf基准测试文章</a>，由<a class="ae ks" href="https://supergloo.solo.io" rel="noopener ugc nofollow" target="_blank"> SuperGloo </a>促成。例如，要使用SuperGloo安装Istio:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="6cfb" class="mf ku iq mb b gy mg mh l mi mj">$ supergloo install istio --name istio</span></pre><p id="e5e7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">或者安装Linkerd:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="41c6" class="mf ku iq mb b gy mg mh l mi mj">$ supergloo install linkerd --name linkerd</span></pre><h1 id="e905" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">增量组织</h1><p id="ac40" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">为了逐步采用Istio，我们可以使用以下预定义的Istio概要文件。例如，要开始安装Istio 的<a class="ae ks" href="https://github.com/istioinaction/book-source-code/tree/update-to-latest-istio/istio-1.1/install" rel="noopener ugc nofollow" target="_blank">基本、最小安装，请运行以下命令:</a></p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="396b" class="mf ku iq mb b gy mg mh l mi mj">$ kubectl create ns istio-system<br/>$ kubectl apply -f kubectl apply -f \<br/>https://raw.githubusercontent.com/istioinaction/book-source-code/update-to-latest-istio/istio-1.1/install/10-istio-minimal.yaml</span></pre><p id="32ef" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这种最小安装将只安装两个组件:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="c135" class="mf ku iq mb b gy mg mh l mi mj">$ kubectl get pod -n istio-system</span><span id="2bb5" class="mf ku iq mb b gy mk mh l mi mj">NAME READY STATUS RESTARTS</span><span id="6901" class="mf ku iq mb b gy mk mh l mi mj">istio-ingressgateway-744b97db5b-wd55k 1/1 Running 0</span><span id="0d02" class="mf ku iq mb b gy mk mh l mi mj">istio-pilot-6f58c66f4d-9bsbd 1/1 Running 0</span></pre><p id="e386" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">有了这两个组件，您就可以创建一个服务网格，<a class="ae ks" href="https://istio.io/docs/tasks/telemetry/metrics/" rel="noopener ugc nofollow" target="_blank">收集重要的网络指标</a>(请求/秒、延迟、错误率等)，增加弹性，如<a class="ae ks" href="https://istio.io/docs/tasks/traffic-management/circuit-breaking/" rel="noopener ugc nofollow" target="_blank">重试、超时和断路器</a>，以及为流量整形提供<a class="ae ks" href="https://istio.io/docs/tasks/traffic-management/request-routing/" rel="noopener ugc nofollow" target="_blank">请求级控制。您可以使用<code class="fe ml mm mn mb b">istioctl</code> CLI来插入适当的sidecar代理，它们构成了网格的数据平面。例如，从Istio引导</a><a class="ae ks" href="https://github.com/istio/istio/tree/master/samples/helloworld" rel="noopener ugc nofollow" target="_blank"> hello-world示例</a></p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="cdda" class="mf ku iq mb b gy mg mh l mi mj">$ kubectl apply -f &lt;(istioctl kube-inject -f \<br/> samples/helloworld/helloworld.yaml)</span></pre><p id="b2ca" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">仅通过这两个Istio组件，您就可以获得许多开箱即用的功能。</p><p id="b29e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当你准备好了，你可以采用Istio的“中等”配置文件。例如，<a class="ae ks" href="https://github.com/istioinaction/book-source-code/tree/update-to-latest-istio/istio-1.1/install" rel="noopener ugc nofollow" target="_blank">使用下面的概要文件</a>，我们可以介绍Istio Citadel的安全性:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="323c" class="mf ku iq mb b gy mg mh l mi mj">$ kubectl apply -f \<br/>https://raw.githubusercontent.com/istioinaction/book-source-code/update-to-latest-istio/istio-1.1/install/40-istio-medium.yaml</span></pre><p id="1a94" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这次安装中，您可以看到我们添加了两个新组件:Istio Citadel和Istio sidecar注射器。</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="0b26" class="mf ku iq mb b gy mg mh l mi mj">$ kubectl get pod -n istio-system</span><span id="6484" class="mf ku iq mb b gy mk mh l mi mj">NAME READY STATUS RESTARTS</span><span id="fcd4" class="mf ku iq mb b gy mk mh l mi mj">istio-citadel-5589dfdf7b-k6jhl 1/1 Running 0</span><span id="c75a" class="mf ku iq mb b gy mk mh l mi mj">istio-ingressgateway-744b97db5b-wd55k 1/1 Running 0</span><span id="7814" class="mf ku iq mb b gy mk mh l mi mj">istio-pilot-59f5795597-pdzqt 2/2 Running 0</span><span id="48bb" class="mf ku iq mb b gy mk mh l mi mj">istio-sidecar-injector-6f6f78645f-snpgn 1/1 Running 0</span></pre><p id="6574" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您现在可以利用<a class="ae ks" href="https://istio.io/docs/setup/kubernetes/additional-setup/sidecar-injection/#automatic-sidecar-injection" rel="noopener ugc nofollow" target="_blank">自动边车注射</a>、<a class="ae ks" href="https://istio.io/help/ops/security/end-user-auth/" rel="noopener ugc nofollow" target="_blank"> JWT验证</a>和<a class="ae ks" href="https://istio.io/docs/tasks/security/mutual-tls/" rel="noopener ugc nofollow" target="_blank">透明mTLS </a>。有了这样一个细长的控制平面，我们可以利用我们需要的功能，而不会陷入复杂性。</p><h1 id="c13b" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">将Istio与您的环境集成</h1><p id="86b1" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">在这一点上你有一个细长的Istio控制平面，你可能想集成(或<a class="ae ks" href="https://gloo.solo.io" rel="noopener ugc nofollow" target="_blank"> gloo </a>？)到Istio服务网格的真实环境。例如，您可能希望将您的安装与<a class="ae ks" href="https://prometheus.io" rel="noopener ugc nofollow" target="_blank"> Prometheus </a>的<em class="mo">集成在一起(一个Prometheus开箱即用Istio的例子，但是您必须对其配置进行逆向工程以获得正确的作业设置)。此时，我们可以利用SuperGloo来帮助“Gloo”我们的环境。例如，<a class="ae ks" href="https://supergloo.solo.io/mesh/tutorials/istio/tutorials-3-prometheus-metrics/" rel="noopener ugc nofollow" target="_blank">如果我们想要配置我们自己的Prometheus服务器</a>，名为<code class="fe ml mm mn mb b">prometheus-server</code>，位于<code class="fe ml mm mn mb b">prometheus-test</code>名称空间中，我们可以像这样利用SuperGloo:</em></p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="7e18" class="mf ku iq mb b gy mg mh l mi mj">$ supergloo set mesh stats<strong class="mb ir">\ </strong> <br/> --target-mesh supergloo-system.istio <strong class="mb ir">\ </strong> <br/> --prometheus-configmap prometheus-test.prometheus-server</span></pre><p id="321d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这将<a class="ae ks" href="https://supergloo.solo.io/mesh/tutorials/istio/tutorials-3-prometheus-metrics/" rel="noopener ugc nofollow" target="_blank">在Prometheus configmap </a>中设置正确的作业，以抓取您的Istio的数据平面和控制平面。不要再试图挖掘正确的配置来为Istio安装设置您的抓取作业。</p><p id="dc1f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">与Istio的另一个相当常见的集成是<a class="ae ks" href="https://supergloo.solo.io/mesh/tutorials/istio/tutorials-2-root-cert/" rel="noopener ugc nofollow" target="_blank">建立您自己的根CA，Istio可以使用它来签署证书</a>，它将证书分发给sidecar代理以建立MTL。使用SuperGloo，您可以运行以下命令来自动完成这项工作:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="e8d1" class="mf ku iq mb b gy mg mh l mi mj">$ supergloo set mesh rootcert \<br/> --target-mesh supergloo-system.istio <strong class="mb ir">\ </strong> <br/> --tls-secret supergloo-system.my-root-ca</span></pre><p id="378d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">即使您没有使用SuperGloo安装您的Istio，SuperGloo也可以自动发现一个Istio安装并“做正确的事情”。为了<a class="ae ks" href="https://supergloo.solo.io/installation/" rel="noopener ugc nofollow" target="_blank">安装SuperGloo </a>并开始使用其工具来<a class="ae ks" href="https://supergloo.solo.io/mesh/tutorials/istio/" rel="noopener ugc nofollow" target="_blank">简化Istio与您的环境的集成</a> ( <a class="ae ks" href="https://supergloo.solo.io/mesh/tutorials/istio/tutorials-3-prometheus-metrics/" rel="noopener ugc nofollow" target="_blank">就像配置您的Prometheus服务器</a>)，请查看<a class="ae ks" href="https://supergloo.solo.io" rel="noopener ugc nofollow" target="_blank"> SuperGloo文档</a>。</p><p id="2a69" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对于《Istio in Action》这本书，我正在编写一套用于采用Istio的资料。你可以在GitHub 上看到其余的。要自己生成它们，您可以在股票Istio舵图中调整这些不同的设置:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="8085" class="mf ku iq mb b gy mg mh l mi mj">helm template $ISTIO_RELEASE/install/kubernetes/helm/istio \<br/> --name istio \ <br/> --namespace istio-system \ <br/> --set gateways.enabled=true \ <br/> --set security.enabled=false \ <br/> --set global.mtls.enabled=false \ <br/> --set galley.enabled=false \ <br/> --set global.useMCP=false \ <br/> --set sidecarInjectorWebhook.enabled=false \ <br/> --set mixer.enabled=false \ <br/> --set mixer.policy.enabled=false \ <br/> --set mixer.telemetry.enabled=false \ <br/> --set prometheus.enabled=false \ <br/> --set grafana.enabled=false \ <br/> --set tracing.enabled=false \ <br/> --set kiali.enabled=false \ <br/> --set pilot.sidecar=false</span></pre><h1 id="5592" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">追踪</h1><p id="795c" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">在接下来的博客中，我们将看到如何以类似的方式采用其他服务网格，例如<a class="ae ks" href="https://linkerd.io" rel="noopener ugc nofollow" target="_blank"> Linkerd </a>和<a class="ae ks" href="https://aws.amazon.com/app-mesh/" rel="noopener ugc nofollow" target="_blank"> AWS应用网格</a>。要了解更多关于<a class="ae ks" href="http://www.solo.io" rel="noopener ugc nofollow" target="_blank"> Solo.io的信息，请访问我们的网站</a>或通过电子邮件联系@solo.io。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="0c81" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="mo">原载于2019年4月23日</em><a class="ae ks" href="https://medium.com/solo-io/istio-the-easy-way-de66e6eba4a1" rel="noopener"><em class="mo">https://medium.com</em></a><em class="mo">。</em></p></div></div>    
</body>
</html>