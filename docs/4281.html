<html>
<head>
<title>End to End Guide: Launch Wordpress Website With Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">端到端指南:用Kubernetes启动Wordpress网站</h1>
<blockquote>原文：<a href="https://itnext.io/end-to-end-guide-launch-wordpress-website-with-kubernetes-4e8788f5ee41?source=collection_archive---------1-----------------------#2020-05-29">https://itnext.io/end-to-end-guide-launch-wordpress-website-with-kubernetes-4e8788f5ee41?source=collection_archive---------1-----------------------#2020-05-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fdfa" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用Google Kubernetes引擎和Wordpress创建我的第一个个人网站时，我从不同的渠道学到了很多东西。为了社区的利益，记录这些知识是值得的。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/29c88076eefdb5f3aaa32df5cae8cc5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GaGI8DAlKRfKQZjAsFbfUw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://microlearninghub.com/" rel="noopener ugc nofollow" target="_blank">https://microlearninghub.com/</a></figcaption></figure><p id="1f37" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用Kubernetes、Google Cloud和Wordpress实现一个端到端的网站涉及到许多移动部分。如果你在建立你的Wordpress网站时需要帮助，请随时拨打imarunrk@gmail.com<a class="ae kv" href="mailto:imarunrk@gmail.com" rel="noopener ugc nofollow" target="_blank">的电话联系我</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3687d87d4c96cc101aa10c3edf39267c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Hm7BjiTEN3gk7xjlBPVaw.png"/></div></div></figure><ul class=""><li id="20b5" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">购买域名</li><li id="d2df" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">设置一个免费的谷歌云账户</li><li id="08af" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">推出谷歌Kubernetes引擎</li><li id="12e4" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">将Wordpress部署到Kubernetes</li><li id="9826" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">为入口负载平衡器生成HTTPs证书和静态IP</li><li id="18ef" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">创建一个Google DNS配置，将静态IP和名称服务器配置与域进行映射</li><li id="8923" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">设置负载平衡器以仅允许HTTPs流量，并将HTTP流量重定向到HTTPs</li></ul><h2 id="4f66" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">购买域名</h2><p id="a6e4" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">有许多网站购买域名。我在GoDaddy (microlearninghub.com)购物。不管你在哪里购买域名，你几乎要经历相同的步骤。我们必须根据购买的域名设置名称服务器(NS)和数字签名(DS)记录。</p><blockquote class="ne nf ng"><p id="dc7e" class="kw kx nh ky b kz la jr lb lc ld ju le ni lg lh li nj lk ll lm nk lo lp lq lr ij bi translated">提示:对于DS记录更新，GoDaddy希望我们以额外的费用为该域名购买附加产品(DNSSEC和高级域名系统)。当你与其他网站比较购买成本时，考虑任何额外的附加购买。</p></blockquote><p id="37eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">HTTPs安装需要DS记录。要用GoDaddy购买这些附加产品，请访问<a class="ae kv" href="https://dcc.godaddy.com/domains?showAdvanceListView=true&amp;prog_id=PROG_ID" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">域控制中心</strong> </a> <strong class="ky ir"> &gt; &gt; </strong>选择合适的域，&gt; &gt;点击更多&gt; &gt;点击附加产品</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/b68676fb3bcf9e9a832c6b057e5baefe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*97syJK1cc4C0AbOyscBLCw.jpeg"/></div></div></figure><p id="d0bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将把我们带到升级页面，然后转到DNS部分购买附加产品DNSSEC &amp;高级DNS。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/357dfb2119e97e6ec2c0887065f80fc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YE3IJyzMeGtHu2dinU084Q.png"/></div></div></figure><h2 id="2175" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">谷歌云静态IP和DNS配置</h2><p id="25da" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">任何人都可以使用Gmail id创建一个谷歌云帐户，并激活300美元的免费信用，以购买谷歌云平台产品，并免费试用一年。在这里 阅读更多关于如何得到这个<a class="ae kv" href="https://cloud.google.com/free" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">的内容。在你的电脑上安装谷歌云软件开发套件的下一步。只是一个<a class="ae kv" href="https://cloud.google.com/sdk/docs/quickstart-windows" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">”。exe" </strong> </a>为windows PC安装。其他操作系统请在此处阅读<a class="ae kv" href="https://cloud.google.com/sdk/docs/quickstarts" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"/></a>。</strong></a></p><p id="5470" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦您安装了正确的google帐户和SDK，让我们通过执行以下命令来创建一个静态IP。</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="501c" class="mg mh iq no b gy ns nt l nu nv">#Create IP, microlearninghub-ip our choice of name</span><span id="42de" class="mg mh iq no b gy nw nt l nu nv"><strong class="no ir"><em class="nh">gcloud compute addresses create microlearninghub-ip --global</em></strong></span><span id="a10c" class="mg mh iq no b gy nw nt l nu nv">#This will read and show us the created IP</span><span id="ed63" class="mg mh iq no b gy nw nt l nu nv"><strong class="no ir"><em class="nh">gcloud compute addresses describe microlearninghub-ip  --global</em></strong></span></pre><p id="d29e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">进入谷歌云<a class="ae kv" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">控制台</strong></a><strong class="ky ir"/><em class="nh">网络服务&gt; &gt;云DNS </em>然后点击<em class="nh">创建区域</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/ac2641dbf1457ad0ed6e73e5c46984af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fZWynZGraj0AqhlrTSsdjg.jpeg"/></div></div></figure><p id="f248" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">给你选择的区域起一个名字，保持区域类型为公共，用你购买的域名填充DNS名称，保持DNSSEC“开”，可选地给出一个描述，然后点击创建。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/6bf3569c2199016651e51c96ffd6dc27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B3s63Pesg0nJpCKSPqcf6A.png"/></div></div></figure><p id="a87a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您的DNS区域将被创建。单击“<em class="nh">添加记录集</em>”将“A”记录添加到分区，并将其与创建的静态IP进行映射。应该有一个“A”记录到域和每个子域。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/ec9ee2080611ccaffea123d42537ec2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WqtIlaHepyRAGMmkzl6zTQ.jpeg"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/af71bd9d8a26f70d059df91cc52528b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uO6llupCkNuBZ4TPxEp_Ng.jpeg"/></div></div></figure><p id="cc33" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">看一下自动创建的NS记录，手动创建A，以及下面截图中DS记录的“<em class="nh">注册设置</em>”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/27bfe1349251e5840f9f80de9ac4f26d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w57xp47ZUjSOz5ZnD3wnrg.jpeg"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/19b4c0b437407149ccf41f1f75ad6dc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wg9BM7s7uh4Gh89F8j7bnQ.jpeg"/></div></div></figure><p id="273d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在您有了NS和DS记录，我们必须将其映射到GoDaddy门户中的域配置中。访问GoDaddy <a class="ae kv" href="https://dcc.godaddy.com/domains?showAdvanceListView=true&amp;prog_id=PROG_ID" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">域控制中心</strong> </a> <strong class="ky ir"> </strong>更新DS和NS记录。DS和NS记录的值应该从我们刚刚创建的google cloud“托管区域”中复制。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/eb73b26a9731ddb380c08e29c8ba04fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YhV2YN1uR79736T7_G-fOQ.jpeg"/></div></div></figure><p id="053f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有一个工具可以检查我们是否正确地完成了所有的配置。给所有这些配置15分钟的思考时间。</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="b659" class="mg mh iq no b gy ns nt l nu nv">Visit the below link, input you domain name and press enter to see if every thing is green.</span><span id="b23f" class="mg mh iq no b gy nw nt l nu nv"><a class="ae kv" href="https://dnssec-analyzer.verisignlabs.com/microlearninghub.com" rel="noopener ugc nofollow" target="_blank">https://dnssec-analyzer.verisignlabs.com/</a></span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/b4617d345c5d06388cb3daed65d2b205.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gTwIO70Yqha2EYEE43wdYA.png"/></div></div></figure><h2 id="b012" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">创建GKE集群并部署Wordpress </h2><p id="0d41" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">我们将使用Google Kubernetes引擎来部署Wordpress并创建我们的博客文章。在GKE建立一个集群非常简单。转到顶部中间的搜索栏并键入GKE，或者转到左上角的菜单并导航到计算部分下的Kubernetes Engine，然后单击集群。您将进入“GKE集群”页面，并可以在那里创建一个集群。</p><blockquote class="ne nf ng"><p id="c9c1" class="kw kx nh ky b kz la jr lb lc ld ju le ni lg lh li nj lk ll lm nk lo lp lq lr ij bi translated">提示:大多数默认选项对于托管Wordpress网站是有意义的。您可以改变的一件事是节点的数量。我们应该有一个单节点集群，以保持免费信用慢慢燃烧。默认值为3。</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/f7578be08a865173f79b3abef74305c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r11dOY-iLD-lN9YNc6TrTA.jpeg"/></div></div></figure><p id="af29" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦集群启动并运行，现在我们必须在您的本地PC上设置"<em class="nh"> kubectl </em>"集群配置。如果你还没有安装kubectl，每个操作系统都有自己的方法。更多关于那个<a class="ae kv" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" rel="noopener ugc nofollow" target="_blank"> <em class="nh">的阅读这里</em> </a>。一旦您安装了<em class="nh"> kubectl </em>，现在我们必须连接到为您的本地创建的集群。只需通过单击下图所示的连接按钮复制命令，并在本地终端中运行它。这使得您的本地<em class="nh"> kubectl </em> config指向刚刚创建的GKE集群。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2ea633e8a2992e8bb92d30e5af4c24ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6fiatgPV7MemIW3LZA3pPQ.jpeg"/></div></div></figure><p id="1665" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，让我们安装WordPress。谷歌云让这件事变得非常简单。有一个点击部署<a class="ae kv" href="https://console.cloud.google.com/marketplace/details/google/wordpress" rel="noopener ugc nofollow" target="_blank">选项</a>，帮助你点击部署WordPress到现有的GKE集群。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/1c9056dd65c5e9263c1581b8b3565b5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PNcbWh4fW7b2A__YEgvanw.jpeg"/></div></div></figure><p id="eeb9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击配置将要求我们选择需要安装WordPress的GKE集群和名称空间。</p><blockquote class="ne nf ng"><p id="b41d" class="kw kx nh ky b kz la jr lb lc ld ju le ni lg lh li nj lk ll lm nk lo lp lq lr ij bi translated">提示:将WordPress安装在一个单独的名称空间中，这样您就可以很好地管理它。如果尚未创建，您可以在同一个屏幕上创建它。</p><p id="44e7" class="kw kx nh ky b kz la jr lb lc ld ju le ni lg lh li nj lk ll lm nk lo lp lq lr ij bi translated">提示:<strong class="ky ir">永远不要</strong>启用公共ip，因为我们稍后会用适当的HTTPs来设置它。</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/fb4b245c763d8498c2886fbb70e59b44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cFcolPyJ1O_SdYlgOSQtHQ.jpeg"/></div></div></figure><p id="b7dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">单击部署后，需要几分钟时间来完成设置。</p><h2 id="27d0" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">HTTPs证书和入口负载平衡器</h2><p id="ac8f" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">下一步是创建HTTPs证书。那简单，用<strong class="ky ir"><em class="nh">“kubectl apply-f cert . YAML”</em></strong>运行下面的YAML。别忘了更换你的域名。</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="47d2" class="mg mh iq no b gy ns nt l nu nv">apiVersion: networking.gke.io/v1beta1</span><span id="bad8" class="mg mh iq no b gy nw nt l nu nv">kind: ManagedCertificate</span><span id="a179" class="mg mh iq no b gy nw nt l nu nv">metadata:</span><span id="d8df" class="mg mh iq no b gy nw nt l nu nv">   name: micro-learning-hub-certificate</span><span id="f7b0" class="mg mh iq no b gy nw nt l nu nv">   namespace: micro-learning-hub-ns</span><span id="cc6c" class="mg mh iq no b gy nw nt l nu nv">spec:</span><span id="8e5f" class="mg mh iq no b gy nw nt l nu nv">   domains:</span><span id="6063" class="mg mh iq no b gy nw nt l nu nv">   - yourdomainhere.com</span></pre><p id="0756" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们必须更新WordPress部署创建的服务对象。这是因为服务是使用“ClusterIP”创建的，我们必须将其更改为“NodePort ”,以使用入口公开相同的内容。因此，我们将删除并重新创建该服务。</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="87e5" class="mg mh iq no b gy ns nt l nu nv">Kubectl delete scv micro-learning-hub-wordpress-wordpress-svc --namespace micro-learning-hub-wordpress</span></pre><p id="74e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用上述命令删除时，请正确选择服务名和名称空间。这将是你在安装WordPress时使用的名称空间。转到您的Kubernetes引擎部分，点击左侧菜单中的“服务和入口”,浏览服务列表并识别您的服务名称。服务名将以“wordpress-svc”结尾。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/da373d464c57778016fe4f6ce9607f70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fvxrYNsRVxP59nDrvPA0TA.png"/></div></div></figure><p id="3a44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">删除服务前，复制服务YAML进行修改。为此，单击已确定的服务并转到YAML选项卡。将JSON复制到“kube CTL . kubernetes . io/last-applied-configuration:”下。我们可以在任何在线转换器中把JSON改成YAML。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/525a2bd4a5b866fa45d4bb95e045dae2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G9kv358dNHxDeVhwY5Yihw.jpeg"/></div></div></figure><p id="7691" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从YAML，只有一个变化。将“类型”从“群集IP”更改为“节点端口”。运行<strong class="ky ir"><em class="nh">“ku bectl apply-f SVC . YAML”</em></strong>。</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="8737" class="mg mh iq no b gy ns nt l nu nv">---</span><span id="1f3d" class="mg mh iq no b gy nw nt l nu nv">apiVersion: v1</span><span id="760f" class="mg mh iq no b gy nw nt l nu nv">kind: Service</span><span id="5151" class="mg mh iq no b gy nw nt l nu nv">metadata:</span><span id="601b" class="mg mh iq no b gy nw nt l nu nv">   annotations: {}</span><span id="8c1d" class="mg mh iq no b gy nw nt l nu nv">   labels:</span><span id="12e2" class="mg mh iq no b gy nw nt l nu nv">     app.kubernetes.io/component: wordpress-webserver</span><span id="7a54" class="mg mh iq no b gy nw nt l nu nv">     app.kubernetes.io/name: micro-learning-hub-wordpress</span><span id="5c40" class="mg mh iq no b gy nw nt l nu nv">name: micro-learning-hub-wordpress-wordpress-svc</span><span id="e486" class="mg mh iq no b gy nw nt l nu nv">namespace: micro-learning-hub-ns</span><span id="002c" class="mg mh iq no b gy nw nt l nu nv">ownerReferences:</span><span id="4e5a" class="mg mh iq no b gy nw nt l nu nv">- apiVersion: app.k8s.io/v1beta1</span><span id="b082" class="mg mh iq no b gy nw nt l nu nv">  blockOwnerDeletion: true</span><span id="79b0" class="mg mh iq no b gy nw nt l nu nv">  kind: Application</span><span id="e1eb" class="mg mh iq no b gy nw nt l nu nv">  name: micro-learning-hub-wordpress</span><span id="4b99" class="mg mh iq no b gy nw nt l nu nv">  uid: 3045c7e9-bf0f-43d0-b10e-7466fac4e6ef</span><span id="9201" class="mg mh iq no b gy nw nt l nu nv">spec:</span><span id="48b5" class="mg mh iq no b gy nw nt l nu nv">  ports:</span><span id="daa3" class="mg mh iq no b gy nw nt l nu nv">  - name: http</span><span id="1315" class="mg mh iq no b gy nw nt l nu nv">    port: 80</span><span id="f8b2" class="mg mh iq no b gy nw nt l nu nv">    targetPort: http</span><span id="f50e" class="mg mh iq no b gy nw nt l nu nv">  selector:</span><span id="f9af" class="mg mh iq no b gy nw nt l nu nv">    app.kubernetes.io/component: wordpress-webserver</span><span id="b54e" class="mg mh iq no b gy nw nt l nu nv">    app.kubernetes.io/name: micro-learning-hub-wordpress</span><span id="300c" class="mg mh iq no b gy nw nt l nu nv">type: NodePort</span></pre><p id="0ba8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后创建一个入口负载平衡器。在你进入YAML时，要确定几件事。</p><blockquote class="ne nf ng"><p id="93f2" class="kw kx nh ky b kz la jr lb lc ld ju le ni lg lh li nj lk ll lm nk lo lp lq lr ij bi translated">在“注释”下，使用您之前创建的IP名称作为"kubernetes.io/ingress.global-static-ip-name"的值。</p><p id="61ff" class="kw kx nh ky b kz la jr lb lc ld ju le ni lg lh li nj lk ll lm nk lo lp lq lr ij bi translated">在“注释”下，使用创建的HTTPs证书的名称作为"networking.gke.io/managed-certificates"的值。</p><p id="dfe0" class="kw kx nh ky b kz la jr lb lc ld ju le ni lg lh li nj lk ll lm nk lo lp lq lr ij bi translated">在“注释”下添加“kubernetes . io/ingress . allow-http:“false”以仅允许HTTPs流量</p><p id="fa5b" class="kw kx nh ky b kz la jr lb lc ld ju le ni lg lh li nj lk ll lm nk lo lp lq lr ij bi translated">将spec下的“主机名”替换为您的主机名</p><p id="8a05" class="kw kx nh ky b kz la jr lb lc ld ju le ni lg lh li nj lk ll lm nk lo lp lq lr ij bi translated">将“serviceName”替换为您在上述服务中使用的名称。</p></blockquote><p id="c39b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">只需运行下面的YAML(<strong class="ky ir"><em class="nh">" kubectl apply-f ingress . YAML ")</em></strong>)加上上面的改动。</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="78f4" class="mg mh iq no b gy ns nt l nu nv">apiVersion: extensions/v1beta1</span><span id="e78a" class="mg mh iq no b gy nw nt l nu nv">kind: Ingress</span><span id="1991" class="mg mh iq no b gy nw nt l nu nv">metadata:</span><span id="e2a9" class="mg mh iq no b gy nw nt l nu nv">  name: micro-learning-hub-ingress</span><span id="9efb" class="mg mh iq no b gy nw nt l nu nv">  namespace: micro-learning-hub-ns</span><span id="59e1" class="mg mh iq no b gy nw nt l nu nv">  annotations:</span><span id="20f4" class="mg mh iq no b gy nw nt l nu nv">    kubernetes.io/ingress.global-static-ip-name: micro-learning-hub-ip</span><span id="9008" class="mg mh iq no b gy nw nt l nu nv">    networking.gke.io/managed-certificates: micro-learning-hub-certificate</span><span id="d223" class="mg mh iq no b gy nw nt l nu nv">    kubernetes.io/ingress.allow-http: "false"</span><span id="a532" class="mg mh iq no b gy nw nt l nu nv">spec:</span><span id="27f8" class="mg mh iq no b gy nw nt l nu nv">  rules:</span><span id="2a4d" class="mg mh iq no b gy nw nt l nu nv">  - host: microlearninghub.com</span><span id="5bd7" class="mg mh iq no b gy nw nt l nu nv">    http:</span><span id="768b" class="mg mh iq no b gy nw nt l nu nv">      paths:</span><span id="5dcf" class="mg mh iq no b gy nw nt l nu nv">      - backend:</span><span id="6ab0" class="mg mh iq no b gy nw nt l nu nv">        serviceName: micro-learning-hub-wordpress-wordpress-svc</span><span id="b8f9" class="mg mh iq no b gy nw nt l nu nv">        servicePort: 80</span></pre><p id="cb69" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一切都完成了，点击你的域名，看看WordPress网站启动并运行。要访问Wordpress管理页面，查看Kubernetes引擎&gt;&gt;应用&gt;&gt;你的WordPress应用详情下的凭证。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/33078590ecc7f517b7f2de528b4bfb52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zm13J2fIH_fOKOTtw5qeDQ.png"/></div></div></figure><h2 id="7b8b" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">将HTTP流量重定向到HTTPs</h2><p id="0f19" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">我们必须创建一个额外的负载平衡器来将HTTP流量重定向到HTTPs</p><blockquote class="ne nf ng"><p id="a98a" class="kw kx nh ky b kz la jr lb lc ld ju le ni lg lh li nj lk ll lm nk lo lp lq lr ij bi translated">即<a class="ae kv" href="http://microlearninghub.com/" rel="noopener ugc nofollow" target="_blank">http://microlearninghub.com/</a>到<a class="ae kv" href="https://microlearninghub.com/" rel="noopener ugc nofollow" target="_blank">https://microlearninghub.com/</a></p></blockquote><p id="3260" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">命名您的负载平衡器</strong></p><ol class=""><li id="e3a8" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr oh ly lz ma bi translated">转到谷歌云控制台的负载平衡页面。<br/> <a class="ae kv" href="https://console.cloud.google.com/networking/loadbalancing/add" rel="noopener ugc nofollow" target="_blank">转到负载平衡页面</a></li><li id="9890" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oh ly lz ma bi translated">在<strong class="ky ir"> HTTP(S)负载均衡</strong>下，点击<strong class="ky ir">开始配置</strong>。</li><li id="0fb8" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oh ly lz ma bi translated">选择<strong class="ky ir">从互联网到我的虚拟机</strong>。</li><li id="d9c3" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oh ly lz ma bi translated">对于负载均衡器的<strong class="ky ir">名称</strong>，输入<code class="fe oi oj ok no b">web-map-http</code>。</li><li id="41b1" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oh ly lz ma bi translated">保持窗口打开以继续。</li></ol><p id="5e23" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">配置主机和路径规则</strong></p><p id="e9b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">主机和路径规则配置负载平衡器的URL映射资源。</p><ol class=""><li id="06bd" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr oh ly lz ma bi translated">在屏幕的左栏中，点击<strong class="ky ir">主机和路径规则</strong>。</li><li id="c38e" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oh ly lz ma bi translated">选择<strong class="ky ir">高级主机和路径规则(URL重定向，URL重写)</strong>。</li><li id="dedd" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oh ly lz ma bi translated">在<strong class="ky ir">动作</strong>下，选择<strong class="ky ir">将客户端重定向到不同的主机/路径</strong>。</li><li id="4cf2" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oh ly lz ma bi translated">在<strong class="ky ir">路径重定向</strong>下，选择<strong class="ky ir">前缀重定向</strong>。</li><li id="e3f6" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oh ly lz ma bi translated">在<strong class="ky ir">重定向响应代码</strong>下，选择<strong class="ky ir"> 301 —永久移动</strong>。</li><li id="4f7d" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oh ly lz ma bi translated">在<strong class="ky ir"> HTTPS重定向</strong>下，选择<strong class="ky ir">启用</strong>。</li><li id="04f4" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oh ly lz ma bi translated">点击<strong class="ky ir">完成</strong>。</li></ol><p id="9934" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">配置前端</strong></p><ol class=""><li id="1b72" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr oh ly lz ma bi translated">在左侧面板中，点击<strong class="ky ir">前端配置</strong>。</li><li id="bc60" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oh ly lz ma bi translated">在<strong class="ky ir">名称</strong>字段，输入<code class="fe oi oj ok no b">http-content-rule</code>。</li><li id="9883" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oh ly lz ma bi translated">在<strong class="ky ir">协议</strong>字段中，选择<code class="fe oi oj ok no b">HTTP</code>。</li><li id="fc60" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oh ly lz ma bi translated">保持窗口打开以继续。</li></ol><p id="0935" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">配置IPv4转发规则</strong></p><ol class=""><li id="bd57" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr oh ly lz ma bi translated">将<strong class="ky ir"> IP版本</strong>设置为<code class="fe oi oj ok no b">IPv4</code>。</li><li id="bd08" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oh ly lz ma bi translated">一个<strong class="ky ir"> IP地址</strong>，选择我们为该域创建的IP。</li><li id="c952" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oh ly lz ma bi translated">确保<strong class="ky ir">端口</strong>设置为<code class="fe oi oj ok no b">80</code>，以允许HTTP流量。</li><li id="1b65" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oh ly lz ma bi translated">点击<strong class="ky ir">完成</strong>。</li><li id="5fca" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oh ly lz ma bi translated">保持窗口打开以继续。</li></ol><p id="263b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">审核并最终确定</strong></p><ol class=""><li id="f9e6" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr oh ly lz ma bi translated">在左侧面板中，点击<strong class="ky ir">审核并最终确定</strong>。</li><li id="3db5" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oh ly lz ma bi translated">将您的设置与您想要创建的内容进行比较。</li><li id="09c3" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oh ly lz ma bi translated">如果一切正常，单击<strong class="ky ir"> Create </strong>创建您的HTTP负载平衡器。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/89419ae700a04fa52d31082b06bd47ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FrLo8Kr1N8LDMZbgymdF-A.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/c0ad1ad0b0fb1b38342fe09af09897de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OYKh3kIeF3p7RTpZId7Dmw.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/9993cde82205a7497988bc2040a91d2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lAfe6dPz-Kgy9_v_HM0c8g.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/b7380fa0d5a3791712f2710705eb2203.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xd-g_lGs4R0dF8Jur7TujQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/2904d9bcd9e508b1864f3bfa878f93cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GUk50abCTIUi8JB1Qy8FTg.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/f202c9756e5f2417901bcba7e92f084f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ftLcE13ErhW4RDnfIkVixg.jpeg"/></div></div></figure><p id="0f84" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">都做好了，你的网站应该完全上线运行了:)玩WordPress设计你的个人网站，摇滚。🏄</p><p id="9c15" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你在建立你的Wordpress网站时需要帮助，请随时拨打<a class="ae kv" href="mailto:imarunrk@gmail.com" rel="noopener ugc nofollow" target="_blank">imarunrk@gmail.com</a>联系我🚀</p></div></div>    
</body>
</html>