<html>
<head>
<title>Multiple processes in one container</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个容器中的多个进程</h1>
<blockquote>原文：<a href="https://itnext.io/multiple-processes-in-one-container-73d5fa91d5cf?source=collection_archive---------8-----------------------#2019-09-16">https://itnext.io/multiple-processes-in-one-container-73d5fa91d5cf?source=collection_archive---------8-----------------------#2019-09-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/aed99f56a596965d8a164338117301ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*i06nj_QLEbpViWzT"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">保罗·德拉古纳斯在<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><div class=""/><p id="a328" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我经常需要在一个容器中包含多个进程。例如，一个用于开发目的的Kafka实例或一个Elasticsearch实例——如果你在微服务架构中开发服务，你就知道我的问题了！—但最新版本的Kafka或Elasticsearch需要一个Zookeeper实例才能启动。非常令人沮丧的是，你需要一个docker-compose只是为了做一个测试！</p><p id="16e5" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在大多数情况下，你不需要一个集群来测试你的工作，只需要一个代理(例如)，所以我创建了一个包含Zookeeper和Kafka(版本2.12-2.3.0)的docker映像，这个容器启动了一个管理进程生命的<em class="lb">主管</em><a class="ae jd" href="http://supervisord.org/" rel="noopener ugc nofollow" target="_blank">http://supervisord.org/</a>的实例。</p><p id="e25b" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我将一步一步地告诉你如何做:</p><p id="1150" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从https://kafka.apache.org/,<a class="ae jd" href="https://kafka.apache.org/](https://kafka.apache.org/)," rel="noopener ugc nofollow" target="_blank">下载卡夫卡的稳定版本</a>然后:</p><figure class="lc ld le lf gt is"><div class="bz fp l di"><div class="lg lh l"/></div></figure><ul class=""><li id="b0de" class="li lj jg kf b kg kh kk kl ko lk ks ll kw lm la ln lo lp lq bi translated">在第一行中，我想使用<em class="lb"> adoptopenjdk </em>作为基础映像，因为它是基于debian的(我想使用<strong class="kf jh"> apt </strong>)并且已经安装了有效的openjdk</li><li id="10b7" class="li lj jg kf b kg lr kk ls ko lt ks lu kw lv la ln lo lp lq bi translated">将<em class="lb"> start.sh </em>文件复制到根目录下(详情如下)</li><li id="330f" class="li lj jg kf b kg lr kk ls ko lt ks lu kw lv la ln lo lp lq bi translated">需要一个<em class="lb"> apt更新</em>来同步软件包管理器库</li><li id="a12e" class="li lj jg kf b kg lr kk ls ko lt ks lu kw lv la ln lo lp lq bi translated">然后安装supervisor并添加Kafka的副本，并复制下面的<em class="lb"> supervisor.conf </em>文件</li></ul><p id="e964" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb"> start.sh </em>管理用于配置KAFKA广告url的环境变量<em class="lb">KAFKA _ ADVERTISED _ listeners</em>。</p><figure class="lc ld le lf gt is"><div class="bz fp l di"><div class="lg lh l"/></div></figure><p id="34dc" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<em class="lb"> start.sh </em>结束时，它启动<em class="lb">监管守护进程</em>，配置如下:</p><figure class="lc ld le lf gt is"><div class="bz fp l di"><div class="lg lh l"/></div></figure><p id="ee1a" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">主管启动动物园管理员和一个卡夫卡经纪人:仅此而已。<br/>容器现在运行的是Zookeeper和Kafka的有效实例，你可以绑定标准端口来与Kafka和Zookeeper交互。</p><h2 id="6719" class="lw lx jg bd ly lz ma dn mb mc md dp me ko mf mg mh ks mi mj mk kw ml mm mn mo bi translated">建设</h2><pre class="lc ld le lf gt mp mq mr ms aw mt bi"><span id="810d" class="lw lx jg mq b gy mu mv l mw mx"><em class="lb">docker build -t paspaola/kafka-one-container .</em></span></pre><h2 id="7021" class="lw lx jg bd ly lz ma dn mb mc md dp me ko mf mg mh ks mi mj mk kw ml mm mn mo bi translated">奔跑</h2><pre class="lc ld le lf gt mp mq mr ms aw mt bi"><span id="6dbd" class="lw lx jg mq b gy mu mv l mw mx"><em class="lb">docker run -it -p2181:2181 -p9092:9092 -e KAFKA_ADVERTISED_LISTNERS=</em><strong class="mq jh"><em class="lb">{your-host-address}</em></strong><em class="lb">” paspaola/kafka-one-container</em></span></pre><h2 id="a267" class="lw lx jg bd ly lz ma dn mb mc md dp me ko mf mg mh ks mi mj mk kw ml mm mn mo bi translated">贮藏室ˌ仓库</h2><p id="27d1" class="pw-post-body-paragraph kd ke jg kf b kg my ki kj kk mz km kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated"><a class="ae jd" href="https://github.com/paspao/kafka-in-one-container](https://github.com/paspao/kafka-in-one-container)" rel="noopener ugc nofollow" target="_blank">https://github.com/paspao/kafka-in-one-container</a></p></div></div>    
</body>
</html>