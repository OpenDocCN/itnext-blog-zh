<html>
<head>
<title>Auto Data Sync Across Devices Using ObjectBox</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用ObjectBox跨设备自动同步数据</h1>
<blockquote>原文：<a href="https://itnext.io/auto-sync-across-devices-using-objectbox-566af10b0047?source=collection_archive---------3-----------------------#2022-03-20">https://itnext.io/auto-sync-across-devices-using-objectbox-566af10b0047?source=collection_archive---------3-----------------------#2022-03-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/e004b872b27190eadb70334a6fa2aa96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bdrIkr5JvsQ7k49d-8vU3w.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="a488" class="pw-subtitle-paragraph kb jd je bd b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dk translated">数据同步是一个很酷但很难实现的功能，尤其是对物联网来说很有必要。那么我们来看看在Flutter中实现起来有多容易！</h2></div><p id="742a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在我之前的文章中，我提到过ObjectBox很酷，因为它不仅速度快，而且还有一个<strong class="kv jf">数据同步特性</strong></p><div class="is it gp gr iu lp"><a rel="noopener  ugc nofollow" target="_blank" href="/the-fastest-local-database-in-dart-flutter-a65ff5b29fee"><div class="lq ab fo"><div class="lr ab ls cl cj lt"><h2 class="bd jf gy z fp lu fr fs lv fu fw jd bi translated">Dart/Flutter中最快的本地数据库</h2><div class="lw l"><h3 class="bd b gy z fp lu fr fs lv fu fw dk translated">ObjectBox凭借其性能和自动同步选项改变了游戏规则</h3></div><div class="lx l"><p class="bd b dl z fp lu fr fs lv fu fw dk translated">itnext.io</p></div></div><div class="ly l"><div class="lz l ma mb mc ly md ja lp"/></div></div></a></div><h2 id="bb9a" class="me mf je bd mg mh mi dn mj mk ml dp mm lc mn mo mp lg mq mr ms lk mt mu mv mw bi translated">现在，让我们看看这个特性有多酷！</h2><h1 id="57e9" class="mx mf je bd mg my mz na mj nb nc nd mm kk ne kl mp kn nf ko ms kq ng kr mv nh bi translated">动机</h1><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ni"><img src="../Images/8c95e8813b7d508e39c97058ddad5930.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*dFErulVa5U_DXCE8eFdMfg.gif"/></div></div></figure><blockquote class="nn no np"><p id="c96e" class="kt ku nq kv b kw kx kf ky kz la ki lb nr ld le lf ns lh li lj nt ll lm ln lo im bi translated">Y <!-- -->你可以得到文章的项目底！</p></blockquote></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><p id="01ca" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在开始编写代码之前，</p><h2 id="dcd0" class="me mf je bd mg mh mi dn mj mk ml dp mm lc mn mo mp lg mq mr ms lk mt mu mv mw bi translated">我想说一下背后的逻辑！</h2><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/c796f776dba3fabea365d003a0dde259.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rUVbNC2IT2lCJF0ot1EOBw.png"/></div></div></figure><p id="e6c7" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">正如你所看到的，ObjectBox有一个非常简洁的架构。</p><p id="5ae0" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">简单地说，我有两部分(客户端和服务器)</p><p id="dc73" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">客户端有一个同步队列。它使用ObjectBox Sync协议与服务器通信，并使用WebSockets推送和提取更改。</p><p id="2e63" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">当设备断开连接时，同步客户端将<strong class="kv jf">定期尝试在后台重新连接</strong>，直到重新连接。</p><p id="6a94" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">如果连接成功，将发送排队的数据，一旦同步目标确认接收，数据将从队列中删除。</p><p id="d06a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在服务器端，服务器施展魔法，同步所有的更改，并将每个更改发送到他们需要的设备上！这使得所有设备同步！</p></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h2 id="6052" class="me mf je bd mg mh mi dn mj mk ml dp mm lc mn mo mp lg mq mr ms lk mt mu mv mw bi translated">现在，让我们开始我们的场景和代码！</h2><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oc"><img src="../Images/ab78d1e2e0ffccce5b99307e979e7230.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CIj8MO828tORzG-s.gif"/></div></div><figcaption class="od oe gj gh gi of og bd b be z dk translated">边缘到云到边缘</figcaption></figure><p id="4f78" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在此场景中，我们将使用边缘到云功能。<br/>这意味着我们将有一台本地服务器和两台设备需要同步。</p><h2 id="daca" class="me mf je bd mg mh mi dn mj mk ml dp mm lc mn mo mp lg mq mr ms lk mt mu mv mw bi translated">让我们从客户端开始吧！</h2><h1 id="ea74" class="mx mf je bd mg my mz na mj nb nc nd mm kk ne kl mp kn nf ko ms kq ng kr mv nh bi translated"><strong class="ak">同步客户端</strong></h1><p id="9653" class="pw-post-body-paragraph kt ku je kv b kw oh kf ky kz oi ki lb lc oj le lf lg ok li lj lk ol lm ln lo im bi translated">在客户端，你只需要3个步骤来同步你的应用程序！</p><h2 id="8290" class="me mf je bd mg mh mi dn mj mk ml dp mm lc mn mo mp lg mq mr ms lk mt mu mv mw bi translated">1- <strong class="ak">将您的依赖关系更改为同步</strong></h2><pre class="nj nk nl nm gt om on oo op aw oq bi"><span id="d8de" class="me mf je on b gy or os l ot ou">dependencies:<br/>  ...<br/>  objectbox_flutter_libs: any <strong class="on jf">// remove</strong><br/>  objectbox_<strong class="on jf">sync</strong>_flutter_libs: any <strong class="on jf">// add</strong></span></pre><h2 id="2e67" class="me mf je bd mg mh mi dn mj mk ml dp mm lc mn mo mp lg mq mr ms lk mt mu mv mw bi translated">2-给你的模型添加S <code class="fe ov ow ox on b">ync()</code>注释</h2><pre class="nj nk nl nm gt om on oo op aw oq bi"><span id="cff8" class="me mf je on b gy or os l ot ou">@Entity()<br/><strong class="on jf">@Sync()</strong><br/>class User {<br/>  int id = 0;<br/>  final String name;</span><span id="b344" class="me mf je on b gy oy os l ot ou">  User(this.name);<br/>}</span></pre><h2 id="f9b8" class="me mf je bd mg mh mi dn mj mk ml dp mm lc mn mo mp lg mq mr ms lk mt mu mv mw bi translated">3-启动你的同步客户端到WebSocket！</h2><pre class="nj nk nl nm gt om on oo op aw oq bi"><span id="94b5" class="me mf je on b gy or os l ot ou">if (Sync.isAvailable()) {<br/>  Sync.client(<br/>    store,<br/>    Platform.isAndroid ?<br/>           'ws://10.0.2.2:9999' :<br/>           'ws://127.0.0.1:9999',<br/>    SyncCredentials.none(),<br/>  ).start();<br/>}</span></pre><p id="bccd" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">就是这样！！你可以走了！</p><p id="f5ef" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">但是等等，这还不行！如你所知，我们还需要一个同步服务器。<br/>不用担心！这也太简单了！！</p></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="577f" class="mx mf je bd mg my oz na mj nb pa nd mm kk pb kl mp kn pc ko ms kq pd kr mv nh bi translated"><strong class="ak">同步服务器</strong></h1><p id="a293" class="pw-post-body-paragraph kt ku je kv b kw oh kf ky kz oi ki lb lc oj le lf lg ok li lj lk ol lm ln lo im bi translated">你也需要3个步骤来完成</p><h2 id="d9be" class="me mf je bd mg mh mi dn mj mk ml dp mm lc mn mo mp lg mq mr ms lk mt mu mv mw bi translated">1-从这里的<a class="ae pe" href="https://objectbox.io/sync/" rel="noopener ugc nofollow" target="_blank">向对象箱发送一个请求</a></h2><p id="2d8b" class="pw-post-body-paragraph kt ku je kv b kw oh kf ky kz oi ki lb lc oj le lf lg ok li lj lk ol lm ln lo im bi translated">他们会给你一个文件来运行安装说明</p><p id="8349" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在Linux上，仅仅在我的控制台上运行一个命令就足够了，但是如果你是Windows用户，我猜你需要在docker上使用它。</p><p id="bee8" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">不要担心，这方面有很好的文档，ObjectBox团队也会帮助你！</p><h2 id="b2e0" class="me mf je bd mg mh mi dn mj mk ml dp mm lc mn mo mp lg mq mr ms lk mt mu mv mw bi translated">2-用你的<code class="fe ov ow ox on b">objectbox-model.json</code>运行文件</h2><p id="46a3" class="pw-post-body-paragraph kt ku je kv b kw oh kf ky kz oi ki lb lc oj le lf lg ok li lj lk ol lm ln lo im bi translated">注意:<code class="fe ov ow ox on b">objectbox-model.json</code>是dart自动生成的文件，请从项目的<code class="fe ov ow ox on b">/lib</code>文件夹中获取</p><pre class="nj nk nl nm gt om on oo op aw oq bi"><span id="4621" class="me mf je on b gy or os l ot ou">./sync-server --model=objectbox-model.json --unsecured-no-authentication</span></pre><h2 id="ba3e" class="me mf je bd mg mh mi dn mj mk ml dp mm lc mn mo mp lg mq mr ms lk mt mu mv mw bi translated">3-喝杯咖啡放松一下，因为你已经做完了！</h2><p id="1a26" class="pw-post-body-paragraph kt ku je kv b kw oh kf ky kz oi ki lb lc oj le lf lg ok li lj lk ol lm ln lo im bi translated">现在，您可以运行您的设备并进行测试！</p><p id="e358" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">要同时运行所有设备，运行这个命令，看看有什么神奇的！</p><pre class="nj nk nl nm gt om on oo op aw oq bi"><span id="36b6" class="me mf je on b gy or os l ot ou">flutter run -d all // runs all active devices</span></pre></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="750e" class="mx mf je bd mg my oz na mj nb pa nd mm kk pb kl mp kn pc ko ms kq pd kr mv nh bi translated">完整示例项目</h1><div class="is it gp gr iu lp"><a href="https://github.com/iisprey/objectbox-example" rel="noopener  ugc nofollow" target="_blank"><div class="lq ab fo"><div class="lr ab ls cl cj lt"><h2 class="bd jf gy z fp lu fr fs lv fu fw jd bi translated">GitHub-IIS prey/object box-示例</h2><div class="lw l"><h3 class="bd b gy z fp lu fr fs lv fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="lx l"><p class="bd b dl z fp lu fr fs lv fu fw dk translated">github.com</p></div></div><div class="ly l"><div class="pf l ma mb mc ly md ja lp"/></div></div></a></div><h2 id="6921" class="me mf je bd mg mh mi dn mj mk ml dp mm lc mn mo mp lg mq mr ms lk mt mu mv mw bi translated">警告</h2><p id="8b6b" class="pw-post-body-paragraph kt ku je kv b kw oh kf ky kz oi ki lb lc oj le lf lg ok li lj lk ol lm ln lo im bi translated">自动同步在GenyMotion上无法正常工作，所以请使用真实设备或Android Studio的模拟器！(或者ios(模拟器)也是如此)</p></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="04af" class="mx mf je bd mg my oz na mj nb pa nd mm kk pb kl mp kn pc ko ms kq pd kr mv nh bi translated">感谢您的阅读！</h1><p id="374b" class="pw-post-body-paragraph kt ku je kv b kw oh kf ky kz oi ki lb lc oj le lf lg ok li lj lk ol lm ln lo im bi translated">我试图尽可能简单地解释。希望你喜欢。</p><p id="975e" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">如果你喜欢这篇文章，请点击👏按钮(你知道你可以升到50吗？)</p></div></div>    
</body>
</html>