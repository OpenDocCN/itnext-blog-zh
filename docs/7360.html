<html>
<head>
<title>Install and configure MySQL Server and MySQL InnoDB Cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">安装和配置MySQL服务器和MySQL InnoDB集群</h1>
<blockquote>原文：<a href="https://itnext.io/install-and-configure-mysql-server-and-mysql-innodb-cluster-c2777cc25b29?source=collection_archive---------3-----------------------#2022-08-31">https://itnext.io/install-and-configure-mysql-server-and-mysql-innodb-cluster-c2777cc25b29?source=collection_archive---------3-----------------------#2022-08-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7278137548911d2efe6b80b42e9c1836.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dU4B5Jg2opVXRmGhiBYXdQ.png"/></div></div></figure><p id="0f13" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://github.com/garutilorenzo/ansible-role-linux-mysql" rel="noopener ugc nofollow" target="_blank">该角色</a>将使用<a class="ae kw" href="https://dev.mysql.com/doc/refman/8.0/en/mysql-innodb-cluster-introduction.html" rel="noopener ugc nofollow" target="_blank"> MySQL InnoDB集群</a>或<a class="ae kw" href="https://dev.mysql.com/doc/mysql-replication-excerpt/5.6/en/replication-gtids.html" rel="noopener ugc nofollow" target="_blank"> GTID复制</a>安装和配置MySQL服务器或高可用性模式下的MySQL</p><h1 id="0f99" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">角色变量</h1><p id="39d2" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">角色接受<a class="ae kw" href="https://garutilorenzo.github.io/ansible-role-linux-mysql/#role-variables" rel="noopener ugc nofollow" target="_blank">这个</a>变量</p><h1 id="6442" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">流浪起来，建立测试基础设施</h1><p id="c393" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">为了测试这个角色，我们使用了<a class="ae kw" href="https://www.vagrantup.com/" rel="noopener ugc nofollow" target="_blank">vagger</a>和<a class="ae kw" href="https://www.virtualbox.org/" rel="noopener ugc nofollow" target="_blank"> Virtualbox </a>，但是如果您愿意，您也可以使用自己的虚拟机或裸机。</p><p id="0d49" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第一步是下载<a class="ae kw" href="https://github.com/garutilorenzo/ansible-role-linux-mysql" rel="noopener ugc nofollow" target="_blank">这个</a> repo并刷新所有虚拟机。但是首先在这个流浪者文件中，将你的公共ssh密钥粘贴到变量<em class="ma"> CHANGE_ME </em>中。您还可以通过更改NNODES变量来调整部署的虚拟机数量(在本例中，我们将使用5个节点)。现在，我们准备好调配机器了:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="6c08" class="mk ky iq mg b gy ml mm l mn mo">git clone <a class="ae kw" href="https://github.com/garutilorenzo/ansible-role-linux-mysql.git" rel="noopener ugc nofollow" target="_blank">https://github.com/garutilorenzo/ansible-role-linux-mysql.git</a></span><span id="6ebf" class="mk ky iq mg b gy mp mm l mn mo">cd ansible-role-linux-mysql/</span><span id="9b0e" class="mk ky iq mg b gy mp mm l mn mo">vagrant up<br/>Bringing machine 'my-ubuntu-0' up with 'virtualbox' provider...<br/>Bringing machine 'my-ubuntu-1' up with 'virtualbox' provider...<br/>Bringing machine 'my-ubuntu-2' up with 'virtualbox' provider...<br/>Bringing machine 'my-ubuntu-3' up with 'virtualbox' provider...<br/>Bringing machine 'my-ubuntu-4' up with 'virtualbox' provider...</span><span id="bc07" class="mk ky iq mg b gy mp mm l mn mo">[...]<br/>[...]</span><span id="d09e" class="mk ky iq mg b gy mp mm l mn mo">my-ubuntu-4: Inserting generated public key within guest...<br/>==&gt; my-ubuntu-4: Machine booted and ready!<br/>==&gt; my-ubuntu-4: Checking for guest additions in VM...<br/>    my-ubuntu-4: The guest additions on this VM do not match the installed version of<br/>    my-ubuntu-4: VirtualBox! In most cases this is fine, but in rare cases it can<br/>    my-ubuntu-4: prevent things such as shared folders from working properly. If you see<br/>    my-ubuntu-4: shared folder errors, please make sure the guest additions within the<br/>    my-ubuntu-4: virtual machine match the version of VirtualBox you have installed on<br/>    my-ubuntu-4: your host and reload your VM.<br/>    my-ubuntu-4:<br/>    my-ubuntu-4: Guest Additions Version: 6.0.0 r127566<br/>    my-ubuntu-4: VirtualBox Version: 6.1<br/>==&gt; my-ubuntu-4: Setting hostname...<br/>==&gt; my-ubuntu-4: Configuring and enabling network interfaces...<br/>==&gt; my-ubuntu-4: Mounting shared folders...<br/>    my-ubuntu-4: /vagrant =&gt; C:/Users/Lorenzo Garuti/workspaces/simple-ubuntu<br/>==&gt; my-ubuntu-4: Running provisioner: shell...<br/>    my-ubuntu-4: Running: inline script<br/>==&gt; my-ubuntu-4: Running provisioner: shell...<br/>    my-ubuntu-4: Running: inline script<br/>    my-ubuntu-4: hello from node 5</span></pre><h1 id="4687" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">可行的设置和飞行前检查</h1><p id="9189" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">现在，如果您没有安装Ansible，请安装ansible并满足所有要求:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="85f3" class="mk ky iq mg b gy ml mm l mn mo">apt-get install python3 python3-pip uuidgen openssl<br/>pip3 install pipenv</span><span id="6986" class="mk ky iq mg b gy mp mm l mn mo">pipenv shell<br/>pip install -r requirements.txt</span></pre><p id="2c2b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在安装了Ansible，我们可以直接从GitHub下载角色:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="7074" class="mk ky iq mg b gy ml mm l mn mo">ansible-galaxy install git+https://github.com/garutilorenzo/ansible-role-linux-mysql.git</span></pre><p id="43bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装Ansible和角色后，我们可以设置我们的清单文件(hosts.ini):</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="fc1f" class="mk ky iq mg b gy ml mm l mn mo">[mysql]<br/>my-ubuntu-0 ansible_host=192.168.25.110<br/>my-ubuntu-1 ansible_host=192.168.25.111<br/>my-ubuntu-2 ansible_host=192.168.25.112<br/>my-ubuntu-3 ansible_host=192.168.25.113<br/>my-ubuntu-4 ansible_host=192.168.25.114</span></pre><p id="62c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">和vars.yml文件:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="0794" class="mk ky iq mg b gy ml mm l mn mo">---<br/><br/>disable_firewall: yes<br/>disable_selinux: yes<br/>mysql_resolv_mode: hosts<br/>mysql_subnet: 192.168.25.0/24<br/>mysql_listen_all_interfaces: yes<br/><br/>mysql_root_pw: '&lt;CHANGE_ME&gt;' # &lt;- openssl rand -base64 32 | sed 's/=//'<br/>mysql_replication_mode: 'InnoDB Cluster'<br/>mysql_gr_name: '&lt;CHANGE_ME&gt;' # &lt;- uuidgen<br/>mysql_gr_vcu: '&lt;CHANGE_ME&gt;' #  &lt;- uuidgen<br/>mysql_innodb_cluster_name: 'cluster_lab'</span></pre><p id="20b9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注意</strong> mysql_gr_name和mysql_gr_vcu是不同的uuid，所以运行两次uuidgen。对于此var，我们将在高可用性模式下部署MySQL和MySQL InnoDB集群，该集群将从现有的<a class="ae kw" href="https://dev.mysql.com/doc/refman/8.0/en/group-replication.html" rel="noopener ugc nofollow" target="_blank">组复制</a>配置中创建。</p><p id="da9f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">继续安装之前的最后一步是创建site.yml文件:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="a602" class="mk ky iq mg b gy ml mm l mn mo">---<br/>- hosts: mysql<br/>  become: yes<br/>  remote_user: vagrant<br/>  roles: <br/>    - role: ansible-role-linux-mysql<br/>  vars_files:<br/>    - vars.yml</span></pre><h1 id="705d" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">部署MySQL InnoDB集群</h1><p id="7185" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我们终于可以使用ansible部署MySQL InnoDB集群了:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="13e4" class="mk ky iq mg b gy ml mm l mn mo">export ANSIBLE_HOST_KEY_CHECKING=False # Ansible skip ssh-key validation</span><span id="db18" class="mk ky iq mg b gy mp mm l mn mo">ansible-playbook -i hosts.ini site.yml -e mysql_bootstrap_host=my-ubuntu-0</span><span id="24d0" class="mk ky iq mg b gy mp mm l mn mo">TASK [ansible-role-linux-mysql : render mysql.conf.d/mysqld.cnf] *******************************************************************************************<br/>ok: [my-ubuntu-0]<br/>ok: [my-ubuntu-2]<br/>ok: [my-ubuntu-1]<br/>ok: [my-ubuntu-3]<br/>ok: [my-ubuntu-4]</span><span id="cf70" class="mk ky iq mg b gy mp mm l mn mo">TASK [ansible-role-linux-mysql : render mysql.conf.d/gtid.cnf] *********************************************************************************************<br/>ok: [my-ubuntu-1]<br/>ok: [my-ubuntu-0]<br/>ok: [my-ubuntu-3]<br/>ok: [my-ubuntu-2]<br/>ok: [my-ubuntu-4]</span><span id="3ae0" class="mk ky iq mg b gy mp mm l mn mo">TASK [ansible-role-linux-mysql : ansible.builtin.fail] *****************************************************************************************************<br/>skipping: [my-ubuntu-0]<br/>skipping: [my-ubuntu-1]<br/>skipping: [my-ubuntu-2]<br/>skipping: [my-ubuntu-3]<br/>skipping: [my-ubuntu-4]</span><span id="976b" class="mk ky iq mg b gy mp mm l mn mo">TASK [ansible-role-linux-mysql : ansible.builtin.fail] *****************************************************************************************************<br/>skipping: [my-ubuntu-0]<br/>skipping: [my-ubuntu-1]<br/>skipping: [my-ubuntu-2]<br/>skipping: [my-ubuntu-3]<br/>skipping: [my-ubuntu-4]</span><span id="26ce" class="mk ky iq mg b gy mp mm l mn mo">TASK [ansible-role-linux-mysql : render innodb_cluster.cnf] ************************************************************************************************<br/>ok: [my-ubuntu-0]<br/>ok: [my-ubuntu-1]<br/>ok: [my-ubuntu-3]<br/>ok: [my-ubuntu-2]<br/>ok: [my-ubuntu-4]</span><span id="2625" class="mk ky iq mg b gy mp mm l mn mo">RUNNING HANDLER [ansible-role-linux-mysql : reload systemd] ************************************************************************************************<br/>ok: [my-ubuntu-3]<br/>ok: [my-ubuntu-0]<br/>ok: [my-ubuntu-2]<br/>ok: [my-ubuntu-4]<br/>ok: [my-ubuntu-1]</span><span id="a7fa" class="mk ky iq mg b gy mp mm l mn mo">PLAY RECAP *************************************************************************************************************************************************<br/>my-ubuntu-0               : ok=69   changed=27   unreachable=0    failed=0    skipped=12   rescued=0    ignored=0   <br/>my-ubuntu-1               : ok=71   changed=28   unreachable=0    failed=0    skipped=10   rescued=0    ignored=0   <br/>my-ubuntu-2               : ok=71   changed=28   unreachable=0    failed=0    skipped=10   rescued=0    ignored=0   <br/>my-ubuntu-3               : ok=71   changed=28   unreachable=0    failed=0    skipped=10   rescued=0    ignored=0   <br/>my-ubuntu-4               : ok=71   changed=28   unreachable=0    failed=0    skipped=10   rescued=0    ignored=0</span></pre><p id="2b73" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在已经安装了集群，但是我们必须保留一些配置。由于该集群是一个新集群，Ansible已经在<a class="ae kw" href="https://dev.mysql.com/doc/refman/8.0/en/group-replication-bootstrap.html" rel="noopener ugc nofollow" target="_blank">引导</a>模式下启动了组复制。这意味着第一个实例(在本例中为my-ubuntu-0)的te值<em class="ma">group _ replication _ bootstrap _ group</em>在设置为<em class="ma">，而<em class="ma">group _ replication _ group _ seeds</em>设置为空值。随着Ansible的第二次运行，这些变量将被设置为正确的值:</em></p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="d6ce" class="mk ky iq mg b gy ml mm l mn mo">ansible-playbook -i hosts.ini site.yml</span><span id="8d66" class="mk ky iq mg b gy mp mm l mn mo">TASK [ansible-role-linux-mysql : ansible.builtin.fail] *****************************************************************************************************<br/>skipping: [my-ubuntu-0]<br/>skipping: [my-ubuntu-1]<br/>skipping: [my-ubuntu-2]<br/>skipping: [my-ubuntu-3]<br/>skipping: [my-ubuntu-4]</span><span id="81ee" class="mk ky iq mg b gy mp mm l mn mo">TASK [ansible-role-linux-mysql : ansible.builtin.fail] *****************************************************************************************************<br/>skipping: [my-ubuntu-0]<br/>skipping: [my-ubuntu-1]<br/>skipping: [my-ubuntu-2]<br/>skipping: [my-ubuntu-3]<br/>skipping: [my-ubuntu-4]</span><span id="dae6" class="mk ky iq mg b gy mp mm l mn mo">TASK [ansible-role-linux-mysql : render innodb_cluster.cnf] ************************************************************************************************<br/>ok: [my-ubuntu-2]<br/>ok: [my-ubuntu-4]<br/>ok: [my-ubuntu-1]<br/>ok: [my-ubuntu-3]<br/>changed: [my-ubuntu-0]</span><span id="90ed" class="mk ky iq mg b gy mp mm l mn mo">PLAY RECAP *************************************************************************************************************************************************<br/>my-ubuntu-0               : ok=30   changed=1    unreachable=0    failed=0    skipped=18   rescued=0    ignored=0   <br/>my-ubuntu-1               : ok=30   changed=0    unreachable=0    failed=0    skipped=18   rescued=0    ignored=0   <br/>my-ubuntu-2               : ok=30   changed=0    unreachable=0    failed=0    skipped=18   rescued=0    ignored=0   <br/>my-ubuntu-3               : ok=30   changed=0    unreachable=0    failed=0    skipped=18   rescued=0    ignored=0   <br/>my-ubuntu-4               : ok=30   changed=0    unreachable=0    failed=0    skipped=18   rescued=0    ignored=0</span></pre><p id="0dbe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本指南中，mysqlsh用于在MySQL InnoDB集群上进行操作。在这里，你可以找到更多关于mysqlsh的信息。</p><p id="a1e4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们终于可以检查我们的集群了:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="b85c" class="mk ky iq mg b gy ml mm l mn mo">root@my-ubuntu-0:~# mysqlsh root@my-ubuntu-0<br/>Please provide the password for 'root@my-ubuntu-0': ******************************************<br/>MySQL  localhost:33060+ ssl  JS &gt; clu = dba.getCluster()<br/>MySQL  localhost:33060+ ssl  JS &gt; clu.status()<br/>{<br/>    "clusterName": "cluster_lab", <br/>    "defaultReplicaSet": {<br/>        "name": "default", <br/>        "primary": "my-ubuntu-0:3306", <br/>        "ssl": "DISABLED", <br/>        "status": "OK", <br/>        "statusText": "Cluster is ONLINE and can tolerate up to 2 failures.", <br/>        "topology": {<br/>            "my-ubuntu-0:3306": {<br/>                "address": "my-ubuntu-0:3306", <br/>                "memberRole": "PRIMARY", <br/>                "mode": "R/W", <br/>                "readReplicas": {}, <br/>                "replicationLag": "applier_queue_applied", <br/>                "role": "HA", <br/>                "status": "ONLINE", <br/>                "version": "8.0.30"<br/>            }, <br/>            "my-ubuntu-1:3306": {<br/>                "address": "my-ubuntu-1:3306", <br/>                "memberRole": "SECONDARY", <br/>                "mode": "R/O", <br/>                "readReplicas": {}, <br/>                "replicationLag": "applier_queue_applied", <br/>                "role": "HA", <br/>                "status": "ONLINE", <br/>                "version": "8.0.30"<br/>            }, <br/>            "my-ubuntu-2:3306": {<br/>                "address": "my-ubuntu-2:3306", <br/>                "memberRole": "SECONDARY", <br/>                "mode": "R/O", <br/>                "readReplicas": {}, <br/>                "replicationLag": "applier_queue_applied", <br/>                "role": "HA", <br/>                "status": "ONLINE", <br/>                "version": "8.0.30"<br/>            }, <br/>            "my-ubuntu-3:3306": {<br/>                "address": "my-ubuntu-3:3306", <br/>                "memberRole": "SECONDARY", <br/>                "mode": "R/O", <br/>                "readReplicas": {}, <br/>                "replicationLag": "applier_queue_applied", <br/>                "role": "HA", <br/>                "status": "ONLINE", <br/>                "version": "8.0.30"<br/>            }, <br/>            "my-ubuntu-4:3306": {<br/>                "address": "my-ubuntu-4:3306", <br/>                "memberRole": "SECONDARY", <br/>                "mode": "R/O", <br/>                "readReplicas": {}, <br/>                "replicationLag": "applier_queue_applied", <br/>                "role": "HA", <br/>                "status": "ONLINE", <br/>                "version": "8.0.30"<br/>            }<br/>        }, <br/>        "topologyMode": "Single-Primary"<br/>    }, <br/>    "groupInformationSourceMember": "my-ubuntu-0:3306"<br/>}</span></pre><h1 id="0f58" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">集群高可用性检查</h1><p id="24b8" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">为了测试集群，我们可以使用一个示例Docker组合堆栈，该示例使用:</p><ul class=""><li id="27ec" class="mq mr iq ka b kb kc kf kg kj ms kn mt kr mu kv mv mw mx my bi translated">Wordpress作为前端</li><li id="cee2" class="mq mr iq ka b kb mz kf na kj nb kn nc kr nd kv mv mw mx my bi translated">mysqlrouter 将WP连接到MySQL</li></ul><p id="95a0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要运行该测试，您必须安装<a class="ae kw" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank">对接器</a>和<a class="ae kw" href="https://docs.docker.com/compose/install/" rel="noopener ugc nofollow" target="_blank">对接器组合</a>。</p><h2 id="69ec" class="mk ky iq bd kz ne nf dn ld ng nh dp lh kj ni nj ll kn nk nl lp kr nm nn lt no bi translated">用户和数据库创建</h2><p id="2516" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我们需要为wordpress创建一个数据库和一个用户，为此我们必须找到主服务器(检查集群状态，并使用-&gt; "mode": "R/W "找到节点)</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="1f16" class="mk ky iq mg b gy ml mm l mn mo">root@my-ubuntu-0:~# mysqlsh root@localhost<br/>Please provide the password for 'root@localhost': ******************************************</span><span id="5830" class="mk ky iq mg b gy mp mm l mn mo">MySQL  localhost:33060+ ssl  JS &gt; \sql # &lt;- SWITCH TO SQL MODE<br/>Switching to SQL mode... Commands end with ;</span><span id="18f9" class="mk ky iq mg b gy mp mm l mn mo">create database wordpress;<br/>create user 'wordpress'@'%' identified by 'wordpress';<br/>grant all on wordpress.* TO 'wordpress'@'%';<br/>flush privileges;</span></pre><h2 id="2693" class="mk ky iq bd kz ne nf dn ld ng nh dp lh kj ni nj ll kn nk nl lp kr nm nn lt no bi translated">示例Dokcer合成堆栈</h2><p id="3175" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">示例堆栈可以在<a class="ae kw" href="https://garutilorenzo.github.io/ansible-role-linux-mysql/examples/" rel="noopener ugc nofollow" target="_blank">示例</a>文件夹中找到，这是合成文件:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="beb8" class="mk ky iq mg b gy ml mm l mn mo">version: '3.4'<br/>services:<br/>  wordpress:<br/>    image: wordpress:latest<br/>    ports:<br/>      - 80:80<br/>    restart: always<br/>    environment:<br/>      - WORDPRESS_DB_HOST=mysqlrouter:6446<br/>      - WORDPRESS_DB_USER=wordpress<br/>      - WORDPRESS_DB_PASSWORD=wordpress<br/>      - WORDPRESS_DB_NAME=wordpress</span><span id="7e2d" class="mk ky iq mg b gy mp mm l mn mo">mysqlrouter:<br/>    image: garutilorenzo/mysqlrouter:8.0.30<br/>    volumes:<br/>      - type: volume<br/>        source: mysqlrouter<br/>        target: /app/mysqlrouter/<br/>        volume:<br/>          nocopy: true<br/>    environment:<br/>     - MYSQL_HOST=my-ubuntu-0<br/>     - MYSQL_PORT=3306<br/>     - MYSQL_USER=root<br/>     - MYSQL_PASSWORD=&lt;CHANGE_ME&gt; # &lt;- the same password in the vars.yml file<br/>     - MYSQL_ROUTER_ACCOUNT=mysql_router_user<br/>     - MYSQL_ROUTER_PASSWORD=&lt;CHANGE_ME&gt; # &lt;- openssl rand -base64 32 | sed 's/=//'<br/>    extra_hosts:<br/>      my-ubuntu-0: 192.168.25.110<br/>      my-ubuntu-1: 192.168.25.111<br/>      my-ubuntu-2: 192.168.25.112<br/>      my-ubuntu-3: 192.168.25.113<br/>      my-ubuntu-4: 192.168.25.114</span><span id="5656" class="mk ky iq mg b gy mp mm l mn mo">volumes:<br/> mysqlrouter:</span></pre><p id="c1b4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们可以启动堆栈并检查日志了:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="191b" class="mk ky iq mg b gy ml mm l mn mo">docker-compose -f mysql-router-compose.yml up -d<br/>docker-compose -f mysql-router-compose.yml logs mysqlrouter</span><span id="2355" class="mk ky iq mg b gy mp mm l mn mo">examples-mysqlrouter-1  | Succesfully contacted mysql server at my-ubuntu-0. Checking for cluster state.<br/>examples-mysqlrouter-1  | Check if config exist<br/>examples-mysqlrouter-1  | bootstrap mysqlrouter with account mysql_router_user<br/>examples-mysqlrouter-1  | Succesfully contacted mysql server at my-ubuntu-0. Trying to bootstrap.<br/>examples-mysqlrouter-1  | Please enter MySQL password for root: <br/>examples-mysqlrouter-1  | # Bootstrapping MySQL Router instance at '/app/mysqlrouter'...<br/>examples-mysqlrouter-1  | <br/>examples-mysqlrouter-1  | Please enter MySQL password for mysql_router_user: <br/>examples-mysqlrouter-1  | - Creating account(s) (only those that are needed, if any)<br/>examples-mysqlrouter-1  | - Verifying account (using it to run SQL queries that would be run by Router)<br/>examples-mysqlrouter-1  | - Storing account in keyring<br/>examples-mysqlrouter-1  | - Adjusting permissions of generated files<br/>examples-mysqlrouter-1  | - Creating configuration /app/mysqlrouter/mysqlrouter.conf<br/>examples-mysqlrouter-1  | <br/>examples-mysqlrouter-1  | # MySQL Router configured for the InnoDB Cluster 'cluster_lab'<br/>examples-mysqlrouter-1  | <br/>examples-mysqlrouter-1  | After this MySQL Router has been started with the generated configuration<br/>examples-mysqlrouter-1  | <br/>examples-mysqlrouter-1  |     $ mysqlrouter -c /app/mysqlrouter/mysqlrouter.conf<br/>examples-mysqlrouter-1  | <br/>examples-mysqlrouter-1  | InnoDB Cluster 'cluster_lab' can be reached by connecting to:<br/>examples-mysqlrouter-1  | <br/>examples-mysqlrouter-1  | ## MySQL Classic protocol<br/>examples-mysqlrouter-1  | <br/>examples-mysqlrouter-1  | - Read/Write Connections: localhost:6446<br/>examples-mysqlrouter-1  | - Read/Only Connections:  localhost:6447<br/>examples-mysqlrouter-1  | <br/>examples-mysqlrouter-1  | ## MySQL X protocol<br/>examples-mysqlrouter-1  | <br/>examples-mysqlrouter-1  | - Read/Write Connections: localhost:6448<br/>examples-mysqlrouter-1  | - Read/Only Connections:  localhost:6449<br/>examples-mysqlrouter-1  | <br/>examples-mysqlrouter-1  | Starting mysql-router.<br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 io INFO [7f794f1e0bc0] starting 4 io-threads, using backend 'linux_epoll'<br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 http_server INFO [7f794f1e0bc0] listening on 0.0.0.0:8443<br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 metadata_cache_plugin INFO [7f794a606700] Starting Metadata Cache<br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 metadata_cache INFO [7f794a606700] Connections using ssl_mode 'PREFERRED'<br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 metadata_cache INFO [7f7948602700] Starting metadata cache refresh thread<br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 routing INFO [7f790e7fc700] [routing:bootstrap_rw] started: routing strategy = first-available<br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 routing INFO [7f790e7fc700] Start accepting connections for routing routing:bootstrap_rw listening on 6446<br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 routing INFO [7f790dffb700] [routing:bootstrap_x_ro] started: routing strategy = round-robin-with-fallback<br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 routing INFO [7f790dffb700] Start accepting connections for routing routing:bootstrap_x_ro listening on 6449<br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 routing INFO [7f790effd700] [routing:bootstrap_ro] started: routing strategy = round-robin-with-fallback<br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 routing INFO [7f790effd700] Start accepting connections for routing routing:bootstrap_ro listening on 6447<br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 metadata_cache INFO [7f7948602700] Connected with metadata server running on my-ubuntu-2:3306<br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 routing INFO [7f790d7fa700] [routing:bootstrap_x_rw] started: routing strategy = first-available<br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 routing INFO [7f790d7fa700] Start accepting connections for routing routing:bootstrap_x_rw listening on 6448<br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 metadata_cache INFO [7f7948602700] Potential changes detected in cluster 'cluster_lab' after metadata refresh<br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 metadata_cache INFO [7f7948602700] Metadata for cluster 'cluster_lab' has 5 member(s), single-primary: (view_id=0)<br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 metadata_cache INFO [7f7948602700]     my-ubuntu-2:3306 / 33060 - mode=RO <br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 metadata_cache INFO [7f7948602700]     my-ubuntu-1:3306 / 33060 - mode=RO <br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 metadata_cache INFO [7f7948602700]     my-ubuntu-0:3306 / 33060 - mode=RW <br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 metadata_cache INFO [7f7948602700]     my-ubuntu-3:3306 / 33060 - mode=RO <br/>examples-mysqlrouter-1  | 2022-08-30 12:03:57 metadata_cache INFO [7f7948602700]     my-ubuntu-4:3306 / 33060 - mode=RO</span></pre><h2 id="8671" class="mk ky iq bd kz ne nf dn ld ng nh dp lh kj ni nj ll kn nk nl lp kr nm nn lt no bi translated">测试前端</h2><p id="5bf0" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">现在如果你试图访问本地主机，你可以看到Wordpress安装页面:</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi np"><img src="../Images/7575c6518f58fff20ac374e6c1992677.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*g2AWnw0KECZ2rJ3WdnxVww.png"/></div></figure><p id="4f48" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装并配置WP，现在我们已经准备好一些<a class="ae kw" href="https://netflix.github.io/chaosmonkey/" rel="noopener ugc nofollow" target="_blank">混沌猴</a></p><h2 id="23b9" class="mk ky iq bd kz ne nf dn ld ng nh dp lh kj ni nj ll kn nk nl lp kr nm nn lt no bi translated">模拟灾难</h2><p id="fe19" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">为了测试WP的可达性，我们可以开始这个简单的测试:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="7581" class="mk ky iq mg b gy ml mm l mn mo">while true; do curl -s -o /dev/null -w "%{http_code}" http://localhost; echo; sleep 1; done<br/>200<br/>200</span></pre><p id="1ab7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在关闭RW节点(在本例中是my-ubuntu-0):</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="05e8" class="mk ky iq mg b gy ml mm l mn mo">root@my-ubuntu-0:~# sudo halt -p<br/>Connection to 192.168.25.110 closed by remote host.<br/>Connection to 192.168.25.110 closed.</span></pre><p id="41e9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并检查测试脚本的输出:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="3499" class="mk ky iq mg b gy ml mm l mn mo">while true; do curl -s -o /dev/null -w "%{http_code}" <a class="ae kw" href="http://localhost" rel="noopener ugc nofollow" target="_blank">http://localhost</a>; echo; sleep 1; done<br/>200<br/>500 # &lt;- my-ubuntu-0 shutdown and MySQL primary switch<br/>200<br/>200</span></pre><p id="f497" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们从第二个节点检查群集状态，我们看到该群集仍然<em class="ma">在线</em>，并且可以再容忍一个故障:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="c348" class="mk ky iq mg b gy ml mm l mn mo">root@my-ubuntu-1:~# mysqlsh root@localhost<br/>Please provide the password for 'root@localhost': ******************************************</span><span id="dbe4" class="mk ky iq mg b gy mp mm l mn mo">MySQL  localhost:33060+ ssl  JS &gt; clu = dba.getCluster()<br/>MySQL  localhost:33060+ ssl  JS &gt; clu.status()<br/>{<br/>    "clusterName": "cluster_lab", <br/>    "defaultReplicaSet": {<br/>        "name": "default", <br/>        "primary": "my-ubuntu-2:3306", <br/>        "ssl": "DISABLED", <br/>        "status": "OK_PARTIAL", <br/>        "statusText": "Cluster is ONLINE and can tolerate up to ONE failure. 1 member is not active.", <br/>        "topology": {<br/>            "my-ubuntu-0:3306": {<br/>                "address": "my-ubuntu-0:3306", <br/>                "memberRole": "SECONDARY", <br/>                "mode": "n/a", <br/>                "readReplicas": {}, <br/>                "role": "HA", <br/>                "shellConnectError": "MySQL Error 2003: Could not open connection to 'my-ubuntu-0:3306': Can't connect to MySQL server on 'my-ubuntu-0:3306' (110)", <br/>                "status": "(MISSING)"<br/>            }, <br/>            "my-ubuntu-1:3306": {<br/>                "address": "my-ubuntu-1:3306", <br/>                "memberRole": "SECONDARY", <br/>                "mode": "R/O", <br/>                "readReplicas": {}, <br/>                "replicationLag": "applier_queue_applied", <br/>                "role": "HA", <br/>                "status": "ONLINE", <br/>                "version": "8.0.30"<br/>            }, <br/>            "my-ubuntu-2:3306": {<br/>                "address": "my-ubuntu-2:3306", <br/>                "memberRole": "PRIMARY", <br/>                "mode": "R/W", <br/>                "readReplicas": {}, <br/>                "replicationLag": "applier_queue_applied", <br/>                "role": "HA", <br/>                "status": "ONLINE", <br/>                "version": "8.0.30"<br/>            }, <br/>            "my-ubuntu-3:3306": {<br/>                "address": "my-ubuntu-3:3306", <br/>                "memberRole": "SECONDARY", <br/>                "mode": "R/O", <br/>                "readReplicas": {}, <br/>                "replicationLag": "applier_queue_applied", <br/>                "role": "HA", <br/>                "status": "ONLINE", <br/>                "version": "8.0.30"<br/>            }, <br/>            "my-ubuntu-4:3306": {<br/>                "address": "my-ubuntu-4:3306", <br/>                "memberRole": "SECONDARY", <br/>                "mode": "R/O", <br/>                "readReplicas": {}, <br/>                "replicationLag": "applier_queue_applied", <br/>                "role": "HA", <br/>                "status": "ONLINE", <br/>                "version": "8.0.30"<br/>            }<br/>        }, <br/>        "topologyMode": "Single-Primary"<br/>    }, <br/>    "groupInformationSourceMember": "my-ubuntu-2:3306"<br/>}<br/> MySQL  localhost:33060+ ssl  JS &gt;</span></pre><p id="295f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您检查WP在<a class="ae kw" href="http://localhost" rel="noopener ugc nofollow" target="_blank"> localhost </a>仍然可用，那么主节点现在是<em class="ma"> my-ubuntu-2 </em>节点。现在，如果我们再次启动<em class="ma"> my-ubuntu-0 </em>节点，该节点将重新加入集群，并从其他节点获取更新:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="f190" class="mk ky iq mg b gy ml mm l mn mo">root@my-ubuntu-1:~# mysqlsh root@localhost<br/>Please provide the password for 'root@localhost': ******************************************</span><span id="affc" class="mk ky iq mg b gy mp mm l mn mo">MySQL  localhost:33060+ ssl  JS &gt; clu = dba.getCluster()<br/>MySQL  localhost:33060+ ssl  JS &gt; clu.status()<br/>{<br/>    "clusterName": "cluster_lab", <br/>    "defaultReplicaSet": {<br/>        "name": "default", <br/>        "primary": "my-ubuntu-2:3306", <br/>        "ssl": "DISABLED", <br/>        "status": "OK", <br/>        "statusText": "Cluster is ONLINE and can tolerate up to 2 failures.", <br/>        "topology": {<br/>            "my-ubuntu-0:3306": {<br/>                "address": "my-ubuntu-0:3306", <br/>                "memberRole": "SECONDARY", <br/>                "mode": "R/O", <br/>                "readReplicas": {}, <br/>                "replicationLag": "applier_queue_applied", <br/>                "role": "HA", <br/>                "status": "ONLINE", <br/>                "version": "8.0.30"<br/>            }, <br/>            "my-ubuntu-1:3306": {<br/>                "address": "my-ubuntu-1:3306", <br/>                "memberRole": "SECONDARY", <br/>                "mode": "R/O", <br/>                "readReplicas": {}, <br/>                "replicationLag": "applier_queue_applied", <br/>                "role": "HA", <br/>                "status": "ONLINE", <br/>                "version": "8.0.30"<br/>            }, <br/>            "my-ubuntu-2:3306": {<br/>                "address": "my-ubuntu-2:3306", <br/>                "memberRole": "PRIMARY", <br/>                "mode": "R/W", <br/>                "readReplicas": {}, <br/>                "replicationLag": "applier_queue_applied", <br/>                "role": "HA", <br/>                "status": "ONLINE", <br/>                "version": "8.0.30"<br/>            }, <br/>            "my-ubuntu-3:3306": {<br/>                "address": "my-ubuntu-3:3306", <br/>                "memberRole": "SECONDARY", <br/>                "mode": "R/O", <br/>                "readReplicas": {}, <br/>                "replicationLag": "applier_queue_applied", <br/>                "role": "HA", <br/>                "status": "ONLINE", <br/>                "version": "8.0.30"<br/>            }, <br/>            "my-ubuntu-4:3306": {<br/>                "address": "my-ubuntu-4:3306", <br/>                "memberRole": "SECONDARY", <br/>                "mode": "R/O", <br/>                "readReplicas": {}, <br/>                "replicationLag": "applier_queue_applied", <br/>                "role": "HA", <br/>                "status": "ONLINE", <br/>                "version": "8.0.30"<br/>            }<br/>        }, <br/>        "topologyMode": "Single-Primary"<br/>    }, <br/>    "groupInformationSourceMember": "my-ubuntu-2:3306"<br/>}</span></pre><h1 id="4c2f" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">从完全中断中恢复</h1><p id="ce23" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">如果由于任何原因，所有服务器都停止运行，集群必须从<a class="ae kw" href="https://dev.mysql.com/doc/mysql-shell/8.0/en/troubleshooting-innodb-cluster.html" rel="noopener ugc nofollow" target="_blank">完全中断</a>中恢复。</p><p id="68d1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为此，我们必须连接到一个实例，编辑/etc/MySQL/MySQL . conf . d/innodb _ cluster . CNF，并将<em class="ma">group _ replication _ bootstrap _ group</em>设置为上的<em class="ma">，并注释<em class="ma">group _ replication _ group _ seeds</em>。我们现在必须重启MySQL:</em></p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="45e7" class="mk ky iq mg b gy ml mm l mn mo">vagrant@my-ubuntu-0:~$<br/>vi /etc/mysql/mysql.conf.d/innodb_cluster.cnf</span><span id="b771" class="mk ky iq mg b gy mp mm l mn mo">group_replication_bootstrap_group=on<br/>#group_replication_group_seeds=my-ubuntu-0:33061,my-ubuntu-1:33061,my-ubuntu-2:33061,my-ubuntu-3:33061,my-ubuntu-4:33061</span><span id="0bfc" class="mk ky iq mg b gy mp mm l mn mo">systemctl restart mysqld</span></pre><p id="3564" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于所有其他(四个)成员，我们必须启动组复制:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="da31" class="mk ky iq mg b gy ml mm l mn mo">vagrant@my-ubuntu-4:~$ mysqlsh root@localhost<br/>Please provide the password for 'root@localhost': ******************************************</span><span id="046e" class="mk ky iq mg b gy mp mm l mn mo">MySQL  localhost:33060+ ssl  JS &gt; \sql # &lt;- SWITCH TO SQL MODE<br/>Switching to SQL mode... Commands end with ;<br/>MySQL  localhost:33060+ ssl  SQL &gt; start group_replication;<br/>Query OK, 0 rows affected (1.7095 sec)</span></pre><p id="7078" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果群集上的流量较低或不存在，群集将处于在线状态:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="1b4e" class="mk ky iq mg b gy ml mm l mn mo">MySQL  localhost:33060+ ssl  SQL &gt; \js<br/>Switching to JavaScript mode...<br/>MySQL  localhost:33060+ ssl  JS &gt; clu = dba.getCluster()<br/>MySQL  localhost:33060+ ssl  JS &gt; clu.status()<br/>{<br/>    "clusterName": "cluster_lab", <br/>    "defaultReplicaSet": {<br/>        "name": "default", <br/>        "primary": "my-ubuntu-0:3306", <br/>        "ssl": "DISABLED", <br/>        "status": "OK", <br/>        "statusText": "Cluster is ONLINE and can tolerate up to 2 failures.", <br/>        "topology": {<br/>            "my-ubuntu-0:3306": {<br/>                "address": "my-ubuntu-0:3306", <br/>                "memberRole": "PRIMARY", <br/>                "mode": "R/W", <br/>                "readReplicas": {}, <br/>                "replicationLag": "applier_queue_applied", <br/>                "role": "HA", <br/>                "status": "ONLINE", <br/>                "version": "8.0.30"<br/>            }, <br/>            "my-ubuntu-1:3306": {<br/>                "address": "my-ubuntu-1:3306", <br/>                "memberRole": "SECONDARY", <br/>                "mode": "R/O", <br/>                "readReplicas": {}, <br/>                "replicationLag": "applier_queue_applied", <br/>                "role": "HA", <br/>                "status": "ONLINE", <br/>                "version": "8.0.30"<br/>            }, <br/>            "my-ubuntu-2:3306": {<br/>                "address": "my-ubuntu-2:3306", <br/>                "memberRole": "SECONDARY", <br/>                "mode": "R/O", <br/>                "readReplicas": {}, <br/>                "replicationLag": "applier_queue_applied", <br/>                "role": "HA", <br/>                "status": "ONLINE", <br/>                "version": "8.0.30"<br/>            }, <br/>            "my-ubuntu-3:3306": {<br/>                "address": "my-ubuntu-3:3306", <br/>                "memberRole": "SECONDARY", <br/>                "mode": "R/O", <br/>                "readReplicas": {}, <br/>                "replicationLag": "applier_queue_applied", <br/>                "role": "HA", <br/>                "status": "ONLINE", <br/>                "version": "8.0.30"<br/>            }, <br/>            "my-ubuntu-4:3306": {<br/>                "address": "my-ubuntu-4:3306", <br/>                "memberRole": "SECONDARY", <br/>                "mode": "R/O", <br/>                "readReplicas": {}, <br/>                "replicationLag": "applier_queue_applied", <br/>                "role": "HA", <br/>                "status": "ONLINE", <br/>                "version": "8.0.30"<br/>            }<br/>        }, <br/>        "topologyMode": "Single-Primary"<br/>    }, <br/>    "groupInformationSourceMember": "my-ubuntu-0:3306"<br/>}</span></pre><p id="0243" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果集群在<a class="ae kw" href="https://dev.mysql.com/doc/mysql-shell/8.0/en/troubleshooting-innodb-cluster.html" rel="noopener ugc nofollow" target="_blank">完全中断</a>时具有高流量。你可能需要运行mysqlsh:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="8c50" class="mk ky iq mg b gy ml mm l mn mo">MySQL  localhost:33060+ ssl  JS &gt; var clu = dba.rebootClusterFromCompleteOutage();</span></pre><h1 id="5769" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">打扫</h1><p id="d668" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">完成后，您最终可以使用以下命令销毁集群:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="6299" class="mk ky iq mg b gy ml mm l mn mo">vagrant destroy</span><span id="529f" class="mk ky iq mg b gy mp mm l mn mo">my-ubuntu-4: Are you sure you want to destroy the 'my-ubuntu-4' VM? [y/N] y<br/>==&gt; my-ubuntu-4: Forcing shutdown of VM...<br/>==&gt; my-ubuntu-4: Destroying VM and associated drives...<br/>    my-ubuntu-3: Are you sure you want to destroy the 'my-ubuntu-3' VM? [y/N] y<br/>==&gt; my-ubuntu-3: Forcing shutdown of VM...<br/>==&gt; my-ubuntu-3: Destroying VM and associated drives...<br/>    my-ubuntu-2: Are you sure you want to destroy the 'my-ubuntu-2' VM? [y/N] y<br/>==&gt; my-ubuntu-2: Forcing shutdown of VM...<br/>==&gt; my-ubuntu-2: Destroying VM and associated drives...<br/>    my-ubuntu-1: Are you sure you want to destroy the 'my-ubuntu-1' VM? [y/N] y<br/>==&gt; my-ubuntu-1: Forcing shutdown of VM...<br/>==&gt; my-ubuntu-1: Destroying VM and associated drives...<br/>    my-ubuntu-0: Are you sure you want to destroy the 'my-ubuntu-0' VM? [y/N] y<br/>==&gt; my-ubuntu-0: Forcing shutdown of VM...<br/>==&gt; my-ubuntu-0: Destroying VM and associated drives...</span></pre></div></div>    
</body>
</html>