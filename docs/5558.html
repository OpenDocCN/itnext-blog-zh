<html>
<head>
<title>Tips for running Kubernetes cluster on Raspberry Pi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Raspberry Pi上运行Kubernetes集群的技巧</h1>
<blockquote>原文：<a href="https://itnext.io/tips-for-running-kubernetes-cluster-on-raspberry-pi-6c86487c6cf?source=collection_archive---------0-----------------------#2021-04-04">https://itnext.io/tips-for-running-kubernetes-cluster-on-raspberry-pi-6c86487c6cf?source=collection_archive---------0-----------------------#2021-04-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7b5d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">你以前不知道，知道或者不关心的事情。</h2></div><p id="e0d4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在成功收到我之前关于在Raspberry Pi上构建Kubernetes集群的文章之后(如果你想要完全自动化的构建，请看一下，代码附后)。我决定跟进我从那时起学到和发现的一些事情，以节省你的时间和精力，谁知道呢，甚至可能说服你自己旋转。</p><h1 id="6628" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">温度控制</h1><p id="9180" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">树莓派有过热的趋势——就像每个计算设备一样——工作负载越多，产生的热量就越多。不幸的是，您在盒子里得到的只是主板本身，但在开始时对我有用的是第三方散热器的慷慨放置，它工作得很好，直到我决定向池中添加一些更重的应用程序。</p><p id="e0de" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">经过一番研究后，我发现了皮莫罗尼公司提供的<a class="ae le" href="https://shop.pimoroni.com/products/fan-shim" rel="noopener ugc nofollow" target="_blank">风扇垫片</a>，它适合我的部署和集群结构，不需要我安装额外的分离器，也不需要我让Pi塔更高。</p><p id="5bb9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了管理粉丝，你可以从我以前的文章中反转<a class="ae le" href="https://github.com/lukaszraczylo/rpi-home-cluster-setup/blob/master/step2/roles/common/tasks/fan-support.yml" rel="noopener ugc nofollow" target="_blank">工程师代码</a>，或者简单地使用它，让它为你做好一切。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/87ce213fed587b379f63a6e8921e3e2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mdIMi2umDoqUj58u"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">信用:<em class="ms">加雷思·哈勒菲克里</em></figcaption></figure><p id="94fa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">风扇是伟大的，他们绝对做的工作，特别是当混合散热器，虽然还有另一件事，我已经错过了，而指望他们太多，从来没有注意到，直到我在提到的垫片上启用彩色led状态。温度上升，所以塔底的Pi在煮塔顶的Pi。</p><p id="b022" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将节点水平放置后，温度下降了10摄氏度(<em class="mt">！</em>)没有任何额外的改动。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mu"><img src="../Images/9c32fedc34c0230fb52fc7d83b6a956f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mWUJB-1gp_zKfxUE"/></div></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mv"><img src="../Images/ccaa74a9bae4ad21ba8e8eaba7c923c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6YrggYva2Fs4o6MMzv0UeA.png"/></div></div></figure></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="60ae" class="lf lg it bd lh li nd lk ll lm ne lo lp jz nf ka lr kc ng kd lt kf nh kg lv lw bi translated">储存和寿命</h1><p id="33e2" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">根据定义，从存储卡运行Raspberry Pi可能是自找麻烦。幸运的是，在将近一年的时间里，我在上面运行Kubernetes没有遇到任何问题，但是通过适当的配置，您可以预计主节点的写入速度大约为30kb/s，工作节点的写入速度大约为5kb/s。</p><p id="0d8b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将NFS用于存储本身——有备用的英特尔NUC，它作为网络存储工作得非常好，因此我能够限制节点存储卡上的写入。使用<a class="ae le" href="https://github.com/azlux/log2ram" rel="noopener ugc nofollow" target="_blank"> log2ram </a>可能会进一步限制灾难的可能性，这与我使用的大存储卡有关，应该可以让一切正常运行相当长一段时间，不会出现进一步的问题。</p><p id="4607" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在卡片上注明——我使用<em class="mt"> SanDisk Extreme Pro 128GB、A2、UHS-I、U3、V30 </em>有几个原因——一个是“你有更多的可用空间，更少的卡损坏的机会”,第二个是——SanDisk的<a class="ae le" href="https://kb.sandisk.com/app/answers/detail/a_id/22478/~/product-warranty-table" rel="noopener ugc nofollow" target="_blank">终身保修</a>,在整个集群出现故障的情况下，它应该可以为我节省足够多的两个额外的覆盆子Pi。为了避免潜在故障期间的任何延迟，请始终准备一张备用卡，因为您永远不知道何时会需要它。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="7192" class="lf lg it bd lh li nd lk ll lm ne lo lp jz nf ka lr kc ng kd lt kf nh kg lv lw bi translated">建立工作关系网</h1><p id="393d" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">群集节点往往会相互进行大量通信，为了保持一切正常运行，您不希望这种通信受到限制，同时保持网络的其余部分免受额外流量的影响。在我看来，使用额外的千兆位交换机(无论是管理的还是非管理的)是必须的，尤其是在Pi不断与NFS服务器联系的情况下。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi ni"><img src="../Images/ee2bb059c8d8479f6c8554bddb7580ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rr3DUm_zPZW22rsTebMVaw.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">空闲群集网络流量</figcaption></figure><p id="7bc7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将集群直接连接到您的家庭wifi路由器(特别是如果您使用互联网服务提供商提供的“库存”路由器)可能会带来麻烦，因为它们通常是规格的低端产品，并针对“普通”用户进行了优化。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi nj"><img src="../Images/35863c721f3097e2181a41f49972c0a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gIWrJpSNJoXWQuU-gQ31uA.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">主动集群网络利用</figcaption></figure><p id="f9c3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你对网络感兴趣——可以看看我的另一篇文章，其中我详细描述了<a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/i-made-my-internet-fast-finally-cb97f55361d9">我的家庭网络设置</a>。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="443c" class="lf lg it bd lh li nd lk ll lm ne lo lp jz nf ka lr kc ng kd lt kf nh kg lv lw bi translated"><strong class="ak">动力</strong></h1><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi nk"><img src="../Images/ebcbf7f32fd729abd848f1296bdaf197.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gkjNjL9fqkXH8c44.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">通过<a class="ae le" href="https://raspi.tv/2019/how-much-power-does-the-pi4b-use-power-measurements" rel="noopener ugc nofollow" target="_blank"> raspi.tv </a>使用Raspberry Pi电源</figcaption></figure><p id="be2d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于树莓皮使用接近没有电力和插头的溢价，我已经决定使用多插座的电源砖。我选择的工具是<a class="nl nm ep" href="https://medium.com/u/8405206298c2?source=post_page-----6c86487c6cf--------------------------------" rel="noopener" target="_blank"> RAVPower官方</a> 60W brick(亚马逊链接:<a class="ae le" href="https://www.amazon.co.uk/gp/product/B07MJ9ZMDM/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&amp;psc=1" rel="noopener ugc nofollow" target="_blank">点击</a>)，它完成了这项工作，没有对当前的六个Raspberry Pi设置造成任何电源故障，因为只有一个“输入”，它不仅很小，而且比带有多个插头的标准延长线更容易连接到UPS。一个额外的建议是使用尽可能短的优质电源线以避免中断，并关闭你的树莓Pi上的WiFi，因为它会消耗一点点额外的能量。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="02cc" class="lf lg it bd lh li nd lk ll lm ne lo lp jz nf ka lr kc ng kd lt kf nh kg lv lw bi translated">Pi超频</h1><p id="61c7" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">⚠️超频你的树莓派可以作废你的保修！</p><p id="96d6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在强制性免责声明之后，我决定谈谈圆周率调优的话题。是的——这是可能的，而且比你想象的要容易。您可以在引导过程中简单地更改rPI使用的<code class="fe nn no np nq b">/boot/userconfig.txt</code>文件的值(并由<code class="fe nn no np nq b">/boot/config.txt</code>包含)来完成所有这些工作。</p><pre class="md me mf mg gt nr nq ns nt aw nu bi"><span id="68b6" class="nv lg it nq b gy nw nx l ny nz">#uncomment to overclock the arm. 700 MHz is the default.<br/>over_voltage=2<br/>arm_freq=1750</span></pre><p id="df41" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以在<a class="ae le" href="https://magpi.raspberrypi.org/articles/how-to-overclock-raspberry-pi-4" rel="noopener ugc nofollow" target="_blank">这篇文章</a>和<a class="ae le" href="https://www.raspberrypi.org/documentation/configuration/config-txt/overclocking.md" rel="noopener ugc nofollow" target="_blank">官方参考</a>中找到更多关于超频本身的信息，尽管如果你事先至少为你的设置准备几个散热器和风扇，你的Pi很可能会很感激。</p></div></div>    
</body>
</html>