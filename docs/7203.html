<html>
<head>
<title>Git Partial Staging</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Git部分登台</h1>
<blockquote>原文：<a href="https://itnext.io/git-partial-staging-17714642cb1e?source=collection_archive---------3-----------------------#2022-07-13">https://itnext.io/git-partial-staging-17714642cb1e?source=collection_archive---------3-----------------------#2022-07-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3512" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何部分暂存文件</h2></div><p id="c1a9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我经常遇到这样的情况，我改变了一个文件中的多个位置，但只想提交其中的一个。一个例子是Node.js项目中的<code class="fe le lf lg lh b">package.json</code>文件，它包含不同的部分:项目信息和版本、预定义的命令、依赖项，甚至是linter规则。人们可能希望提交依赖关系中的更改，而不是预定义命令中的更改。</p><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi li"><img src="../Images/a4c3cec3e3d75cbe19355c27113a0b31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9vHwMhwrEPUX6MWHD9bosQ.png"/></div></div></figure><h1 id="f258" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">引入互动舞台</h1><p id="607d" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">让我们假设在<code class="fe le lf lg lh b">package.json</code>文件中有两组变更。让我们来看看它们:</p><pre class="lj lk ll lm gt mr lh ms mt aw mu bi"><span id="9572" class="mv lv it lh b gy mw mx l my mz">git diff package.json</span></pre><p id="3176" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">输出如下所示:</p><pre class="lj lk ll lm gt mr lh ms mt aw mu bi"><span id="5098" class="mv lv it lh b gy mw mx l my mz"><strong class="lh iu">diff --git a/package.json b/package.json</strong> <br/><strong class="lh iu">index 465ef44..ee478bb 100644</strong> <br/><strong class="lh iu">--- a/package.json</strong> <br/><strong class="lh iu">+++ b/package.json</strong> <br/>@@ -1,6 +1,6 @@ <br/> { <br/>   "name": "@rxjsx/rxjsx", <br/>-  "version": "1.0.0", <br/>+  "version": "1.0.1", <br/>   "description": "RxJS Extensions", <br/>   "main": "lib/index.js", <br/>   "types": "lib/index.d.ts", <br/>@@ -38,7 +38,7 @@ <br/>     "jest": "^26.6.3", <br/>     "jest-junit": "^13.0.0", <br/>     "prettier": "^2.2.1", <br/>-    "rxjs": "^7.5.5", <br/>+    "rxjs": "^7.5.6", <br/>     "ts-jest": "^26.5.6", <br/>     "typescript": "^4.2.4" <br/>   }</span></pre><p id="c7de" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，我们在文件开头的版本中进行了更改，在中间的依赖项中也进行了更改。我们希望进行依赖关系的变更，但还不是版本变更。为此，我们使用交互式添加:</p><pre class="lj lk ll lm gt mr lh ms mt aw mu bi"><span id="4556" class="mv lv it lh b gy mw mx l my mz">git add -i</span></pre><p id="c439" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">终端中会打印出以下文本:</p><pre class="lj lk ll lm gt mr lh ms mt aw mu bi"><span id="9fdd" class="mv lv it lh b gy mw mx l my mz"><strong class="lh iu">staged     unstaged path</strong> <br/>  1:    unchanged        +9/-9 package-lock.json <br/>  2:    unchanged        +2/-2 package.json <br/> <br/><strong class="lh iu">*** Commands ***</strong> <br/>  1: <strong class="lh iu">s</strong>tatus       2: <strong class="lh iu">u</strong>pdate       3: <strong class="lh iu">r</strong>evert       4: <strong class="lh iu">a</strong>dd untracked <br/>  5: <strong class="lh iu">p</strong>atch        6: <strong class="lh iu">d</strong>iff         7: <strong class="lh iu">q</strong>uit         8: <strong class="lh iu">h</strong>elp <br/><strong class="lh iu">What now</strong>&gt;</span></pre><p id="1f2b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">显示<code class="fe le lf lg lh b">package-lock.json</code>和<code class="fe le lf lg lh b">package.json</code>有变化。下面列出了可用的命令。让我们键入<code class="fe le lf lg lh b">p</code>作为补丁并按回车键:</p><pre class="lj lk ll lm gt mr lh ms mt aw mu bi"><span id="e613" class="mv lv it lh b gy mw mx l my mz"><strong class="lh iu">What now</strong>&gt; p <br/><strong class="lh iu">           staged     unstaged path</strong> <br/>  1:    unchanged        +9/-9 package-lock.json <br/>  2:    unchanged        +2/-2 package.json<br/><strong class="lh iu">Patch update</strong>&gt;&gt;</span></pre><p id="9842" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">键入2，表示我们希望在<code class="fe le lf lg lh b">package.json</code>进行部分分段:</p><pre class="lj lk ll lm gt mr lh ms mt aw mu bi"><span id="772f" class="mv lv it lh b gy mw mx l my mz"><strong class="lh iu">Patch update</strong>&gt;&gt; 2  <br/><strong class="lh iu">           staged     unstaged path</strong> <br/>  1:    unchanged        +9/-9 package-lock.json <br/>* 2:    unchanged        +2/-2 package.json <br/><strong class="lh iu">Patch update</strong>&gt;&gt;</span></pre><p id="d0ef" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">按回车键，表示这就是全部，我们到此结束:</p><pre class="lj lk ll lm gt mr lh ms mt aw mu bi"><span id="dbf8" class="mv lv it lh b gy mw mx l my mz"><strong class="lh iu">Patch update</strong>&gt;&gt;  <br/><strong class="lh iu">diff --git a/package.json b/package.json</strong> <br/><strong class="lh iu">index 465ef44..ee478bb 100644</strong> <br/><strong class="lh iu">--- a/package.json</strong> <br/><strong class="lh iu">+++ b/package.json</strong> <br/>@@ -1,6 +1,6 @@ <br/> { <br/>   "name": "@rxjsx/rxjsx", <br/>-  "version": "1.0.0", <br/>+  "version": "1.0.1", <br/>   "description": "RxJS Extensions", <br/>   "main": "lib/index.js", <br/>   "types": "lib/index.d.ts", <br/><strong class="lh iu">(1/2) Stage this hunk [y,n,q,a,d,j,J,g,/,e,?]? </strong>n</span></pre><p id="0ccd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在它显示了第一个“大块”变更，并询问如何处理它。我们不想上演它，所以我们进入<code class="fe le lf lg lh b">n</code>:</p><pre class="lj lk ll lm gt mr lh ms mt aw mu bi"><span id="8670" class="mv lv it lh b gy mw mx l my mz">@@ -38,7 +38,7 @@ <br/>     "jest": "^26.6.3", <br/>     "jest-junit": "^13.0.0", <br/>     "prettier": "^2.2.1", <br/>-    "rxjs": "^7.5.5", <br/>+    "rxjs": "^7.5.6", <br/>     "ts-jest": "^26.5.6", <br/>     "typescript": "^4.2.4" <br/>   } <br/><strong class="lh iu">(2/2) Stage this hunk [y,n,q,a,d,K,g,/,e,?]? </strong>y</span></pre><p id="ec8b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在它显示了第二块，我们可以在这里输入<code class="fe le lf lg lh b">y</code>。这样，部分转移将结束，交互式转移将返回到命令:</p><pre class="lj lk ll lm gt mr lh ms mt aw mu bi"><span id="2ea5" class="mv lv it lh b gy mw mx l my mz"><strong class="lh iu">*** Commands ***</strong> <br/>  1: <strong class="lh iu">s</strong>tatus       2: <strong class="lh iu">u</strong>pdate       3: <strong class="lh iu">r</strong>evert       4: <strong class="lh iu">a</strong>dd untracked <br/>  5: <strong class="lh iu">p</strong>atch        6: <strong class="lh iu">d</strong>iff         7: <strong class="lh iu">q</strong>uit         8: <strong class="lh iu">h</strong>elp <br/><strong class="lh iu">What now</strong>&gt; q</span></pre><p id="f4f5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们通过输入<code class="fe le lf lg lh b">q</code>并按回车键来退出。然后做一个git状态:</p><pre class="lj lk ll lm gt mr lh ms mt aw mu bi"><span id="27b8" class="mv lv it lh b gy mw mx l my mz">git status</span></pre><p id="4de9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">输出如下所示:</p><pre class="lj lk ll lm gt mr lh ms mt aw mu bi"><span id="abad" class="mv lv it lh b gy mw mx l my mz">On branch master <br/>Your branch is up to date with 'origin/master'. <br/> <br/>Changes to be committed: <br/>  (use "git restore --staged &lt;file&gt;..." to unstage) <br/>        modified:   package.json <br/> <br/>Changes not staged for commit: <br/>  (use "git add &lt;file&gt;..." to update what will be committed) <br/>  (use "git restore &lt;file&gt;..." to discard changes in working directory) <br/>        modified:   package-lock.json <br/>        modified:   package.json</span></pre><p id="5992" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">文件<code class="fe le lf lg lh b">package.json</code>显示为已暂存和未暂存。这是因为它是部分暂存的，而有些部分不是为提交而暂存的。您可以继续并提交更改。</p><h1 id="1011" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">最后的话</h1><p id="da8b" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">我每周在git、GitHub和GitLab上写文章。</p><ul class=""><li id="8b89" class="na nb it kk b kl km ko kp kr nc kv nd kz ne ld nf ng nh ni bi translated"><a class="ae nj" href="https://medium.com/subscribe/@aerabi" rel="noopener">订阅</a>my Medium publishes，以便在新的Git周刊发布时获得通知。</li><li id="dd1f" class="na nb it kk b kl nk ko nl kr nm kv nn kz no ld nf ng nh ni bi translated">关注Twitter上的<a class="ae nj" href="https://twitter.com/MohammadAliEN" rel="noopener ugc nofollow" target="_blank">我</a>获取git上的每周文章和每日推文。</li></ul></div></div>    
</body>
</html>