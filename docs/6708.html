<html>
<head>
<title>Azure Static Web Apps, Blazor, Authentication and Visual Studio 2022</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure静态Web应用、Blazor、认证和Visual Studio 2022</h1>
<blockquote>原文：<a href="https://itnext.io/azure-static-web-apps-blazor-authentication-and-visual-studio-2022-40364cc543b7?source=collection_archive---------1-----------------------#2022-02-05">https://itnext.io/azure-static-web-apps-blazor-authentication-and-visual-studio-2022-40364cc543b7?source=collection_archive---------1-----------------------#2022-02-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="9d12" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Azure Static Web Apps是一种非常简单的方式来创建一个安全的<a class="ae kl" href="https://docs.microsoft.com/en-us/aspnet/core/blazor/" rel="noopener ugc nofollow" target="_blank"> Blazor Web Assembly </a>应用程序，其后端API基于<a class="ae kl" href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview" rel="noopener ugc nofollow" target="_blank"> Azure函数</a>。我将指导您使用Visual Studio 2022在本地工作站上完成所有设置和运行。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/0b1172b8e39b01375a203c8dbb6ce796.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*z2kJtj6ZJCIAAv6Ky6wVdw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Azure应用服务</figcaption></figure><blockquote class="ky kz la"><p id="fe8e" class="jn jo lb jp b jq jr js jt ju jv jw jx lc jz ka kb ld kd ke kf le kh ki kj kk ij bi translated">我有一个<a class="ae kl" href="https://github.com/scottkuhl/StaticBlazorAuth" rel="noopener ugc nofollow" target="_blank">公开回购</a>正在运行，但我建议你自己走一遍，这样你可以更好地理解它。</p></blockquote><p id="1b35" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您将需要以下内容来完成这些步骤:</p><ol class=""><li id="2895" class="lf lg iq jp b jq jr ju jv jy lh kc li kg lj kk lk ll lm ln bi translated">Visual Studio 2022安装在您的工作站上，具有Azure开发和ASP.NET以及web开发工作负载。</li><li id="fd4f" class="lf lg iq jp b jq lo ju lp jy lq kc lr kg ls kk lk ll lm ln bi translated">GitHub账户。</li><li id="de7b" class="lf lg iq jp b jq lo ju lp jy lq kc lr kg ls kk lk ll lm ln bi translated"><a class="ae kl" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>安装在您的工作站上。</li><li id="109b" class="lf lg iq jp b jq lo ju lp jy lq kc lr kg ls kk lk ll lm ln bi translated">将您的解决方案部署到web的Azure帐户。</li></ol><h1 id="cb79" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">起始模板</h1><p id="b68d" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">微软有一个GitHub库，你可以用它来快速启动和运行Blazor和Azure静态Web应用。</p><ol class=""><li id="074f" class="lf lg iq jp b jq jr ju jv jy lh kc li kg lj kk lk ll lm ln bi translated"><strong class="jp ir">使用</strong> <a class="ae kl" href="https://github.com/staticwebdev/blazor-starter" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Blazor Starter模板</strong> </a> <strong class="jp ir">创建自己的GitHub资源库。</strong></li><li id="75fb" class="lf lg iq jp b jq lo ju lp jy lq kc lr kg ls kk lk ll lm ln bi translated"><strong class="jp ir">遵循回购中的入门步骤。</strong></li></ol><h1 id="80ab" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">Azure静态Web应用程序CLI</h1><p id="0a1a" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">自述文件建议将API项目和客户端都设置为启动项目。当您运行应用程序并通过端口5000访问站点时，它将一直工作，直到您尝试对用户进行身份验证。为此，我们需要运行上面的CLI作为代理监听端口4280。</p><p id="cebe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3。通过运行</strong>来全局安装Azure静态Web Apps CLI</p><pre class="kn ko kp kq gt mw mx my mz aw na bi"><span id="88f5" class="nb lu iq mx b gy nc nd l ne nf">npm install -g @azure/static-web-apps-cli</span></pre><h1 id="cd3f" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">配置项目</h1><p id="e9c2" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">让我们更新客户端项目设置，以便在正确的端口上打开浏览器。</p><p id="aec6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 4。更新客户端launchSettings.json文件，改为在端口4280上启动浏览器。</strong></p><pre class="kn ko kp kq gt mw mx my mz aw na bi"><span id="e794" class="nb lu iq mx b gy nc nd l ne nf">"BlazorApp.Client": {<br/>  "commandName": "Project",<br/>  "dotnetRunMessages": true,<br/>  "launchBrowser": true,<br/>  "<strong class="mx ir">launchUrl": "http://localhost:4280/",</strong><br/>  "inspectUri": "{wsProtocol}://{url.hostname}:{url.port}/_framework/debug/ws-proxy?browser={browserInspectUri}",<br/>  "applicationUrl": "http://localhost:5000",<br/>  "environmentVariables": {<br/>    "ASPNETCORE_ENVIRONMENT": "Development"<br/>  }<br/>}</span></pre><h1 id="10fd" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">配置Visual Studio</h1><p id="43b5" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">您可以手动运行CLI，但我们可以使用Visual Studio简化这一过程。</p><p id="d643" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 5。安装</strong> <a class="ae kl" href="https://marketplace.visualstudio.com/items?itemName=MadsKristensen.CommandTaskRunner64" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">命令任务运行器(64位)</strong> </a> <strong class="jp ir">扩展。</strong></p><p id="1d7e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 6。将名为StaticWebApp.cmd的文件添加到您的解决方案文件夹中，并在其中包含以下命令。</strong></p><pre class="kn ko kp kq gt mw mx my mz aw na bi"><span id="10b2" class="nb lu iq mx b gy nc nd l ne nf">swa start http://localhost:5000 --devserver-timeout=6000000</span></pre><p id="60d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">(超时以毫秒为单位，设置超时是为了在项目打开和首次启动之间留出足够的时间。可以随意调整。)</p><p id="ff32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">7 .<strong class="jp ir">。在Visual Studio中打开任务运行器资源管理器窗口。找到您的StaticWebApp命令，并将其设置为在项目打开时打开。</strong></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ng"><img src="../Images/12233682eb66dcc7db35b1bd20b1d9c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l0QxbvWlU_EtXDrA1z-n9Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">任务运行器浏览器</figcaption></figure><p id="32a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者，您可以手动将commands.json文件添加到解决方案文件夹中，并包括以下内容:</p><pre class="kn ko kp kq gt mw mx my mz aw na bi"><span id="825c" class="nb lu iq mx b gy nc nd l ne nf">{<br/>  "commands": {<br/>    "StaticWebApp": {<br/>      "fileName": "cmd.exe",<br/>      "workingDirectory": ".",<br/>      "arguments": "/c StaticWebApp.cmd"<br/>    }<br/>  }<br/>, "-vs-binding":{"ProjectOpened":["StaticWebApp"]}<br/>}</span></pre><p id="6d79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，当您打开项目并让它在后台运行时，将会启动SWA CLI。</p><p id="4f3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，只需点击开始按钮，您就可以使用身份验证来使用Visual Studio和Azure静态Web应用程序了。</p><h1 id="90ba" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">添加身份验证代码</h1><p id="9e1e" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">在本地运行应用程序时，您不需要管理任何用户或角色。CLI为开发和测试的登录提供了一个模拟界面。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nl"><img src="../Images/c78b3daf1ccf9bd19c147b856335f4a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xuh1x3ZbIQK0E1QEw_L7kw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">模拟安全提供者UI</figcaption></figure><p id="f154" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本视频将指导您更新用户界面，以添加登录页面、保护用户界面和API。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nm nn l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">如何使用Azure Static Web Apps视频保护您的C# API</figcaption></figure><h2 id="c80b" class="nb lu iq bd lv no np dn lz nq nr dp md jy ns nt mh kc nu nv ml kg nw nx mp ny bi translated">可选项:Windows终端</h2><p id="9fe3" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">该功能应用程序将启动一个终端窗口，在您停止调试后，该窗口将保持打开状态。解决这个问题的一种方法是将Windows终端中的设置更改为在进程退出、失败或崩溃时关闭。你可以在默认&gt;高级下找到这个设置。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/aeda33acf43b026b57de78dc64d3ef0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*QZe4nUNyqo1TYVRs0-eDow.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Windows终端设置</figcaption></figure><h1 id="4548" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated"><strong class="ak">总结</strong></h1><p id="9c09" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">我的目标是让您的Blazor Azure静态Web应用程序在Visual Studio中本地启动和运行，并通过身份验证和单击运行，尽可能减少摩擦。希望这能给你一个开发体验，就像Azure静态Web应用的部署体验一样简单。</p></div></div>    
</body>
</html>