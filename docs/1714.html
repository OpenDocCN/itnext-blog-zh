<html>
<head>
<title>Run tests on CircleCI with parallelisation for RSpec, Minitest, Cypress</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在CircleCI上对RSpec、Minitest、Cypress进行并行化测试</h1>
<blockquote>原文：<a href="https://itnext.io/run-tests-on-circleci-with-parallelisation-for-rspec-minitest-cypress-fd7d3649858e?source=collection_archive---------8-----------------------#2019-01-08">https://itnext.io/run-tests-on-circleci-with-parallelisation-for-rspec-minitest-cypress-fd7d3649858e?source=collection_archive---------8-----------------------#2019-01-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="9811" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">也许您使用CircleCI parallelisation在多个CI节点上运行您的测试套件，但是您注意到一些CI节点比其他节点花费更多的时间来完成测试。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/40135006029c2fcd61bbaccf9d31c16c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*l2OJXZkRF70yFJ84.jpg"/></div></div></figure><p id="5c55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当你的测试有随机时间时，这可能发生。通常，E2E(端到端)测试的执行时间更随机，因为浏览器必须等待一些元素加载到网站上，或者您的应用程序可能依赖于外部API，处理请求的持续时间不同。其他原因可能是启动一个并行CI节点的延迟。</p><h1 id="fca1" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">默认CircleCI测试套件拆分</h1><p id="d87e" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">下面是一个使用默认CircleCI并行化运行测试的例子。如您所见，整个CI构建在29分37秒内完成。测试是在15个并行CI节点上执行的，其中一些节点运行了14分钟，最慢的一个运行了近30分钟。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ma"><img src="../Images/30cdcab86f39470e71a2012f3bdec924.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XI9-onYfepEUedpx.png"/></div></div></figure><p id="4279" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们能够在CI节点之间自动平衡测试套件的划分，使所有CI节点在相似的时间内工作，那么我们就可以得到更短的CI构建。</p><h1 id="2fef" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">动态测试套件拆分</h1><p id="db57" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">我们可以使用<a class="ae mb" href="https://knapsackpro.com/?utm_source=medium&amp;utm_medium=blog_post&amp;utm_campaign=improve-circleci-parallelisation-for-rspec-minitest-cypress" rel="noopener ugc nofollow" target="_blank">backpackage Pro</a>跨CI节点动态地分割测试。例如，我们可以在Ruby中为RSpec或Minitest拆分测试。如果您使用Cypress test runner运行E2E测试，那么您也可以拆分Javascript测试。</p><p id="d069" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是添加<a class="ae mb" href="https://knapsackpro.com/?utm_source=medium&amp;utm_medium=blog_post&amp;utm_campaign=improve-circleci-parallelisation-for-rspec-minitest-cypress" rel="noopener ugc nofollow" target="_blank">背包Pro队列模式</a>后的图。背包Pro队列模式使您的测试在CI节点间保持自动平衡，以便允许所有CI节点在相似的时间内完成工作。如您所见，CI构建花费了22分50秒，而不是将近30分钟。这意味着<strong class="jp ir">我们每个CI构建节省了7分钟</strong>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mc"><img src="../Images/b95ec33ea05283dcd3f309b3f3ae233d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PQyihYzwCkSvt5qO.png"/></div></div></figure><p id="a5b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您的团队每天运行20个CI构建时，您每天可以节省2小时20分钟。一个月节省了超过46个小时。</p><p id="f043" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下面的视频中，我展示了动态测试套件拆分还能解决哪些问题。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="fbe1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你也可以在<a class="ae mb" href="https://knapsackpro.com/?utm_source=medium&amp;utm_medium=blog_post&amp;utm_campaign=improve-circleci-parallelisation-for-rspec-minitest-cypress" rel="noopener ugc nofollow" target="_blank">backpack Pro</a>上阅读更多关于它的内容，并在那里看到对更多测试跑步者的支持。</p><h1 id="e7a7" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">其他提示</h1><p id="7035" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">如果你对<a class="ae mb" href="https://docs.knapsackpro.com/2018/run-javascript-e2e-tests-faster-with-cypress-on-parallel-ci-nodes" rel="noopener ugc nofollow" target="_blank"> Cypress测试套件拆分</a>很好奇。</p><p id="8739" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想用Chrome headless 运行你的<a class="ae mb" href="https://docs.knapsackpro.com/2017/circleci-2-0-capybara-feature-specs-selenium-webdriver-with-chrome-headless" rel="noopener ugc nofollow" target="_blank"> CircleCI 2.0测试。</a></p><p id="1453" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Tech详细说明了如何在加载动态测试文件的情况下在<a class="ae mb" href="https://docs.knapsackpro.com/2018/how-to-run-tests-in-minitest-continuously-with-dynamic-test-files-loading" rel="noopener ugc nofollow" target="_blank"> Minitest中连续运行测试</a>。</p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><p id="fcd3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">【docs.knapsackpro.com】最初发表于<a class="ae mb" href="https://docs.knapsackpro.com/2018/improve-circleci-parallelisation-for-rspec-minitest-cypress" rel="noopener ugc nofollow" target="_blank"><em class="mm"/></a><em class="mm">。</em></p></div></div>    
</body>
</html>