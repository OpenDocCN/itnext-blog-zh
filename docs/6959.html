<html>
<head>
<title>Integrating Compliance for Kubernetes Pipeline</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes管道整合合规性</h1>
<blockquote>原文：<a href="https://itnext.io/integrating-compliance-for-kubernetes-pipeline-c538415401c5?source=collection_archive---------2-----------------------#2022-04-26">https://itnext.io/integrating-compliance-for-kubernetes-pipeline-c538415401c5?source=collection_archive---------2-----------------------#2022-04-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/74b8898ce63bbb53aa14d4d8425284f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*476SqXxj2Q7TG2Fo"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/photos/63Sg6s3EocE" rel="noopener ugc nofollow" target="_blank">图片</a>由<a class="ae kc" href="https://unsplash.com/@flyd2069?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">在Unsplash上放飞:D </a></figcaption></figure><p id="694d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们与云无关的数字世界中，安全性是一个至关重要的方面，无论是《财富》500强公司还是正在发展壮大的小型服务提供商。</p><p id="e908" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当部署依赖于基于云的环境时，安全性的重要性就提高了。所有公司在部署应用程序或将功能集成到现有应用程序时，都广泛依赖于<a class="ae kc" href="https://en.wikipedia.org/wiki/Microservices" rel="noopener ugc nofollow" target="_blank">微服务</a>。由于其无与伦比的声誉，Kubernetes是走向市场的领导者。</p><p id="c745" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Kubernetes是管理容器化应用程序的头号开源编排平台。当它第一次出现时，它彻底改变了DevOps团队创建、管理和操作基于容器的应用程序的方法。</p><p id="606a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Kubernetes的一个独一无二的特点是，Kubernetes是一个不断发展的项目，一直在进行改进。Kubernetes团队已经在准备他们最新的解决方案和方法来解决已经暴露出来的安全漏洞，并将在他们的下一个版本中提供给我们。</p><p id="cffa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了充分利用这一工具的多功能性，在构建过程中保持明智是很重要的，了解这一点以便能够最好地利用它。这就是我们将在本文中讨论的内容。</p><p id="e9ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当构建一个CI/CD管道来部署容器和映像时，<a class="ae kc" href="https://www.armosec.io/blog/kubernetes-security-best-practices/" rel="noopener ugc nofollow" target="_blank"> Kubernetes安全最佳实践</a>在Kubernetes的三个不同级别上出现:集群级、节点级和底层主机操作系统级。扫描和修补容器映像以检测漏洞并报告它们至关重要:</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/639c2c9ca3009ff7fbda9c2d85d1a4ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/0*sJWPehyvM42V-UqV"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">作者图片</figcaption></figure><p id="7442" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">注意:</strong>保持K8s最新，提高安全性。</p><p id="cd3b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们一个一个地解开关卡，探索最佳实践以及如何处理K8s的情况。</p><h1 id="4e33" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">应用层安全性</h1><p id="d297" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">这个级别是开发人员要考虑的，也是安全的最高层。通过应用程序的容器化实现了资源和数据的相互隔离，但这还不足以保证服务的安全。</p><p id="2133" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">应用程序级别的一些最佳安全实践如下</p><h1 id="c17e" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">设置API服务器访问权限和使用机密</h1><p id="fa54" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">Kubernetes API服务器为控制Kubernetes提供了一个强大的REST API。这个API的写权限相当于群集中每台机器的根访问权限。</p><p id="8370" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Kubectl是这个API的CLI客户机。可以通过向kubectl发出请求来管理资源和工作负载。默认情况下，这个API服务器会监听<em class="mj">不安全端口</em>:端口8080。对该端口的请求将<em class="mj">绕过认证和授权检查</em>。</p><p id="8a5b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你让这个端口打开，<em class="mj">任何获得运行你主人的主机的访问权的人都将完全控制你的整个集群</em>。</p><p id="c493" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">解决方案</strong>:确保未设置不安全绑定地址，并且所有敏感数据(如连接到应用程序API的密码或令牌)都存储在Kubernetes <a class="ae kc" href="https://kubernetes.io/docs/concepts/configuration/secret/" rel="noopener ugc nofollow" target="_blank"> Secrets </a>中。</p><h1 id="c32e" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">通过RBAC的出入控制</h1><p id="6d11" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">基于角色的访问控制(<a class="ae kc" href="https://www.upguard.com/blog/rbac" rel="noopener ugc nofollow" target="_blank"> RBAC </a>)是一种基于角色来管理资源访问的方法，它帮助您定义谁可以访问Kubernetes API，拥有什么样的权限。</p><p id="75b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">随着不安全端口8080的关闭，只能通过安全加密的TLS连接来访问API。您可能希望进一步限制已知的、经过身份验证的用户对API的访问。</p><p id="0bf6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">解法:</strong> set — anonymous-auth=false。选择特定于命名空间的权限，而不是群集范围的权限。</p><p id="8b74" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">只要我们利用RBAC的功能，我们就可以跳过上述步骤，允许匿名访问。RBAC <a class="ae kc" href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#default-roles-and-role-bindings" rel="noopener ugc nofollow" target="_blank">默认</a>设置会处理好的。</p><h1 id="325b" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">分散硬化</h1><p id="3742" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">默认情况下，Docker容器作为'<strong class="kf ir">根用户</strong>运行，这有时会导致安全问题。限制用户访问可能是保护K8s集群中部署的应用程序的最佳方式。</p><p id="3143" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">解决方案:</strong>在部署YAML文件中为pod定义指定运行方式用户/运行方式组。</p><h1 id="7f89" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">集群级安全性</h1><p id="e4dc" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">这是中层和中心层，K8s集群和它们的组件在这里相互作用。</p><h1 id="6508" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">配置和限制etcd</h1><p id="69aa" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">Kubernetes将配置和状态信息存储在名为etcd的分布式键值存储中。获得etcd读/写权限的人可以控制K8s集群。</p><p id="0aa0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">解决方案:</strong>通过设置—证书文件和—密钥文件建立HTTPS连接etcd。</p><p id="93cb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">到etcd的流量应该加密。确保访问etcd需要将身份验证设置应用到-client-cert-auth = true。</p><p id="c76f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过指定-etcd-cert file和-etcd-keyfile，并设置许多其他的<a class="ae kc" href="https://etcd.io/docs/" rel="noopener ugc nofollow" target="_blank">配置</a>，确保API服务器能够向etcd识别自身。</p><h1 id="b0df" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">扫描和限制容器图像</h1><p id="6daf" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">软件通过容器映像导入K8s集群。当配置错误或使用过时的软件时，就会出现安全漏洞。利用容器映像扫描器来检查映像中包含的包有助于报告包中的已知漏洞。</p><p id="6d5c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">解决方案:</strong>使用AlwaysPullImages准入控制器确保使用最新版本。</p><p id="fd39" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用语义版本控制标记图像。</p><p id="ce18" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用集装箱扫描仪。</p><h1 id="2899" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">配置准入控制器</h1><p id="c8ca" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">Kubernetes准入控制器是一个高级插件，用于控制和管理集群的使用。利用准入控制器可以提供对安全性的更好的控制。</p><p id="0734" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">解决方案:</strong>定义对API服务器节点的访问限制，设计定制的网络策略。</p><p id="3f3f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">实施动态准入控制，以确保仅部署成功扫描的映像。</p><h1 id="bcb1" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">主机级安全性</h1><p id="a985" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">这是实际安装Kubernetes的层。</p><h1 id="3803" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">限制特权访问</h1><p id="34af" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">应该限制通过应用程序单元的远程执行，并且不应该将主机级操作系统暴露给ssh。</p><p id="000b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">解决方案:</strong>设置IAM策略来限制对K8s资源的访问。</p><h1 id="0c48" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">限制管理员的修改权限</h1><p id="1ce5" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">在主机级别安装新软件和更新它们应该受到限制，因为这可能成为黑客安装恶意软件的后门。</p><p id="2421" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">解决方案:</strong>只允许系统管理员执行sudo/yum安装。</p><h1 id="7b49" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">结论</h1><p id="f47d" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">当设计和开发针对最终用户或大公司的复杂和高级系统时，安全性应该是核心。构建复杂应用程序或系统最有效的方法是使用微服务和Kubernetes作为容器化的部署引擎。</p><p id="2b55" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">作为开发人员和架构师，我们有责任通过避免任何可能成为整个生态系统的安全威胁或漏洞的弱点，来确保我们拥有最好、最安全的产品和应用程序。</p><p id="87f0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本文提供了在CI/CD管道中构建容器化应用程序时要记住的最佳实践。</p></div></div>    
</body>
</html>