<html>
<head>
<title>How to use Azure Go SDK to manage Azure Data Explorer clusters</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Azure Go SDK管理Azure Data Explorer集群</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-use-azure-go-sdk-to-manage-azure-data-explorer-clusters-5109cddac7a0?source=collection_archive---------3-----------------------#2020-07-30">https://itnext.io/how-to-use-azure-go-sdk-to-manage-azure-data-explorer-clusters-5109cddac7a0?source=collection_archive---------3-----------------------#2020-07-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5b4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" rel="noopener ugc nofollow" target="_blank" href="/getting-started-with-azure-data-explorer-using-the-go-sdk-807c50bc8105">使用Go SDK开始使用Azure Data Explorer</a>介绍了如何使用<a class="ae kl" href="https://github.com/Azure/azure-kusto-go" rel="noopener ugc nofollow" target="_blank"> Azure Data Explorer Go SDK </a>从Azure Data Explorer接收和查询数据。在这篇博客中，你将<a class="ae kl" href="https://docs.microsoft.com/azure/developer/go/?WT.mc_id=dzone-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure Go SDK </a>来管理Azure Data Explorer集群和数据库。</p><p id="6588" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://docs.microsoft.com/azure/data-explorer/?WT.mc_id=dzone-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure Data Explorer </a>(也称为<strong class="jp ir"> Kusto </strong>)是一种快速、可扩展的数据探索服务，用于分析来自任何数据源(如网站、应用程序、物联网设备等)的大量不同数据。这些数据可用于诊断、监控、报告、机器学习和其他分析功能。</p><p id="c0be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想知道，我们在这里谈论的是两个不同的SDK。这篇博客中涉及的是用于资源管理的(也称为控制平面SDK ),我在<a class="ae kl" href="https://dev.to/azure/getting-started-with-azure-data-explorer-using-the-go-sdk-30jm" rel="noopener ugc nofollow" target="_blank">其他帖子</a>中使用的是用于与Azure Data Explorer服务本身交互的数据平面SDK(摄取、查询等)。)</p><p id="07aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">涵盖哪些内容？</strong></p><p id="297f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用一个简单的CLI应用程序作为示例来演示如何使用Go SDK。我们将首先试用该应用程序，并了解如何:</p><ul class=""><li id="711d" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">创建并列出Azure数据资源管理器群集</li><li id="884c" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">创建并列出集群中的数据库</li><li id="1ae0" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">删除数据库和集群</li></ul><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi la"><img src="../Images/1aecf7decdf6f38ff5d503b5d1275280.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KNhG1seGFQo1sltDd5qTAA.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">示例CLI应用程序:<em class="lq"> goadx </em></figcaption></figure><p id="1e86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦完成，我们将遍历示例代码来理解发生了什么</p><blockquote class="lr ls lt"><p id="5507" class="jn jo lu jp b jq jr js jt ju jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj kk ij bi translated"><em class="iq">代码可在GitHub</em><a class="ae kl" href="https://github.com/abhirockzz/azure-go-sdk-for-dataexplorer" rel="noopener ugc nofollow" target="_blank">【https://github.com/abhirockzz/azure-go-sdk-for-dataexplorer】T21</a>上找到</p></blockquote><p id="464f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，这个基于CLI的示例只是为了展示如何使用Azure Go SDK(在Azure Data Explorer的上下文中)作为更大应用程序的一部分。它不应该取代/替代可用于管理Azure数据浏览器资源的<a class="ae kl" href="https://docs.microsoft.com/azure/data-explorer/create-cluster-database-cli?WT.mc_id=dzone-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure CLI</a></p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="0ea1" class="mf mg iq bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">先决条件</h1><p id="0347" class="pw-post-body-paragraph jn jo iq jp b jq nd js jt ju ne jw jx jy nf ka kb kc ng ke kf kg nh ki kj kk ij bi translated"><a class="ae kl" href="https://golang.org/dl/" rel="noopener ugc nofollow" target="_blank">安装Go 1.13或以上</a></p><p id="9699" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你需要一个<a class="ae kl" href="https://docs.microsoft.com/azure/?WT.mc_id=dzone-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">微软Azure账户</a>。去报名参加一个免费的吧！</p><p id="c00f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装Azure CLI 如果你还没有的话(应该很快！)</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="3282" class="mf mg iq bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">运行CLI应用程序</h1><p id="f8f3" class="pw-post-body-paragraph jn jo iq jp b jq nd js jt ju ne jw jx jy nf ka kb kc ng ke kf kg nh ki kj kk ij bi translated">获取代码并构建它:</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="2f1a" class="nn mg iq nj b gy no np l nq nr">git clone https://github.com/abhirockzz/azure-go-sdk-for-dataexplorer<br/>cd azure-go-sdk-for-dataexplorer<br/>go build -o goadx</span><span id="f837" class="nn mg iq nj b gy ns np l nq nr">//to confirm<br/>chmod a+x goadx &amp;&amp; ./goadx</span></pre><p id="490e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要查看单个命令的详细信息，例如集群创建:</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="6152" class="nn mg iq nj b gy no np l nq nr">./goadx cluster create --help</span><span id="ccc0" class="nn mg iq nj b gy ns np l nq nr">//output</span><span id="b247" class="nn mg iq nj b gy ns np l nq nr">Creates 1 instance of compute type DevNoSLAStandardD11V2 in Basic tier</span><span id="a12c" class="nn mg iq nj b gy ns np l nq nr">Usage:<br/>  goadx cluster create [flags]</span><span id="db1b" class="nn mg iq nj b gy ns np l nq nr">Flags:<br/>  -h, --help          help for create<br/>      --loc string    ADX cluster location<br/>      --name string   ADX cluster name</span><span id="8f68" class="nn mg iq nj b gy ns np l nq nr">Global Flags:<br/>      --rg string    Azure resource group<br/>      --sub string   Azure subscription</span></pre><h2 id="9381" class="nn mg iq bd mh nt nu dn ml nv nw dp mp jy nx ny mt kc nz oa mx kg ob oc nb od bi translated">创建集群前还有几个步骤…</h2><p id="a95c" class="pw-post-body-paragraph jn jo iq jp b jq nd js jt ju ne jw jx jy nf ka kb kc ng ke kf kg nh ki kj kk ij bi translated"><strong class="jp ir">创建一个资源组…</strong></p><p id="a368" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">…使用<a class="ae kl" href="https://docs.microsoft.com/cli/azure/group?view=azure-cli-latest&amp;WT.mc_id=dzone-blog-abhishgu#az-group-create" rel="noopener ugc nofollow" target="_blank"> az组创建</a> CLI命令</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="fc01" class="nn mg iq nj b gy no np l nq nr">az group create -l &lt;region&gt; -n &lt;name&gt;</span><span id="5881" class="nn mg iq nj b gy ns np l nq nr">e.g. az group create -l southeastasia -n my-adx-rg</span></pre><p id="df75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要一个<a class="ae kl" href="https://docs.microsoft.com/azure/active-directory/develop/app-objects-and-service-principals?WT.mc_id=dzone-blog-abhishgu#service-principal-object" rel="noopener ugc nofollow" target="_blank">服务主体</a>让Go SDK通过Azure Data Explorer服务进行身份验证，以执行集群和数据库操作。</p><p id="7faa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">创建服务主体… </strong></p><p id="4f6b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">…使用<a class="ae kl" href="https://docs.microsoft.com/cli/azure/ad/sp?view=azure-cli-latest&amp;WT.mc_id=dzone-blog-abhishgu#az-ad-sp-create-for-rbac" rel="noopener ugc nofollow" target="_blank"> az ad sp create-for-rbac </a></p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="61d0" class="nn mg iq nj b gy no np l nq nr">az ad sp create-for-rbac -n "test-datax-sp"</span></pre><p id="a8f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您将得到这样的JSON响应</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="a7b1" class="nn mg iq nj b gy no np l nq nr">{<br/>  "appId": "fe7280c7-5705-4789-b17f-71a472340429",<br/>  "displayName": "test-datax-sp",<br/>  "name": "http://test-datax-sp",<br/>  "password": "29c719dd-f2b3-46de-b71c-4004fb6116ee",<br/>  "tenant": "42f988bf-86f1-42af-91ab-2d7cd011db42"<br/>}</span></pre><p id="6532" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将服务主体详细信息设置为环境变量。在代码演练过程中，您将看到为什么需要这些特定的变量</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="9bc2" class="nn mg iq nj b gy no np l nq nr">export AZURE_CLIENT_ID="&lt;appId&gt;"<br/>export AZURE_CLIENT_SECRET="&lt;password&gt;"<br/>export AZURE_TENANT_ID="&lt;tenant&gt;"</span></pre><p id="8764" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你都准备好了！</p><h2 id="4384" class="nn mg iq bd mh nt nu dn ml nv nw dp mp jy nx ny mt kc nz oa mx kg ob oc nb od bi translated">创建Azure数据浏览器群集</h2><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="0517" class="nn mg iq nj b gy no np l nq nr">./goadx cluster create --name &lt;name of the cluster you want to create&gt; --loc &lt;azure region for the cluster&gt; --rg &lt;name of the resource group&gt; --sub &lt;azure subscription id&gt;</span></pre><p id="3ad1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如:</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="87b0" class="nn mg iq nj b gy no np l nq nr">./goadx cluster create --name MyAdxCluster --loc "Southeast Asia" --rg my-adx-rg --sub 9a42a42f-ae42-4242-b6a7-eea0ea42d342</span></pre><p id="6f8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将使用<code class="fe oe of og nj b">DevNoSLAStandardD11V2</code>虚拟机创建一个实例集群</p><blockquote class="lr ls lt"><p id="7990" class="jn jo lu jp b jq jr js jt ju jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj kk ij bi translated"><em class="iq">为了简单/易用，这是硬编码的</em></p></blockquote><p id="2c58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">集群创建需要一些时间，这段时间内的代码块。请耐心等待；)喝点咖啡，看看Twitter，或者做任何让你忙碌大约10-15分钟的事情。创建集群后，您将看到以下消息:</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="154e" class="nn mg iq nj b gy no np l nq nr">created cluster MyAdxCluster with ID /subscriptions/9a42a42f-ae42-4242-b6a7-eea0ea42d342/resourceGroups/my-adx-rg/providers/Microsoft.Kusto/Clusters/MyAdxCluster and type Microsoft.Kusto/Clusters</span></pre><h2 id="abdf" class="nn mg iq bd mh nt nu dn ml nv nw dp mp jy nx ny mt kc nz oa mx kg ob oc nb od bi translated">列出所有的集群</h2><p id="18dd" class="pw-post-body-paragraph jn jo iq jp b jq nd js jt ju ne jw jx jy nf ka kb kc ng ke kf kg nh ki kj kk ij bi translated">您刚刚创建了一个集群，让我们确保您可以获得它的信息(包括您的资源组中可能已经有的任何其他集群)</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="fbc6" class="nn mg iq nj b gy no np l nq nr">./goadx cluster list --rg &lt;name of the resource group&gt; --sub &lt;azure subscription id&gt;</span></pre><p id="e652" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="eaad" class="nn mg iq nj b gy no np l nq nr">./goadx cluster list --rg my-adx-rg --sub 9a42a42f-ae42-4242-b6a7-eea0ea42d342</span></pre><p id="7563" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您将得到如下表格输出:</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="e540" class="nn mg iq nj b gy no np l nq nr">+---------------+---------+----------------+-----------+-------------------------------------------------------+<br/>|     NAME      |  STATE  |    LOCATION    | INSTANCES |                          URI                          |<br/>+---------------+---------+----------------+-----------+-------------------------------------------------------+<br/>| MyAdxCluster | Running | Southeast Asia |         1 | https://MyAdxCluster.southeastasia.kusto.windows.net |<br/>+---------------+---------+----------------+-----------+-------------------------------------------------------+</span></pre><h2 id="c9f1" class="nn mg iq bd mh nt nu dn ml nv nw dp mp jy nx ny mt kc nz oa mx kg ob oc nb od bi translated">有了集群，就该创建数据库了</h2><p id="4c9a" class="pw-post-body-paragraph jn jo iq jp b jq nd js jt ju ne jw jx jy nf ka kb kc ng ke kf kg nh ki kj kk ij bi translated">在集群中创建数据库</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="dbe9" class="nn mg iq nj b gy no np l nq nr">./goadx db create --name &lt;name of the database you want to create&gt; --cluster &lt;nname of the adx cluster&gt; --loc &lt;azure region&gt; --rg &lt;resource group name&gt; --sub &lt;azure subscription id&gt;</span></pre><p id="7577" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="79d1" class="nn mg iq nj b gy no np l nq nr">./goadx db create --name testadxdb --cluster MyAdxCluster --loc "Southeast Asia" --rg my-adx-rg --sub 9a42a42f-ae42-4242-b6a7-eea0ea42d342</span></pre><p id="bfa5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应该不会花太长时间。创建数据库后，您将看到以下消息:</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="d1f7" class="nn mg iq nj b gy no np l nq nr">created DB MyAdxCluster/testadxdb with ID /subscriptions/9a42a42f-ae42-4242-b6a7-eea0ea42d342/resourceGroups/my-adx-rg/providers/Microsoft.Kusto/Clusters/MyAdxCluster/Databases/testadxdb and type Microsoft.Kusto/Clusters/Databases</span></pre><h2 id="4f28" class="nn mg iq bd mh nt nu dn ml nv nw dp mp jy nx ny mt kc nz oa mx kg ob oc nb od bi translated">要检查您刚刚创建的数据库…</h2><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="be55" class="nn mg iq nj b gy no np l nq nr">./goadx db list --cluster &lt;name of the adx cluster&gt; --rg &lt;resource group name&gt; --sub &lt;azure subscription id&gt;</span></pre><p id="300d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="d017" class="nn mg iq nj b gy no np l nq nr">./goadx db list --cluster MyAdxCluster --rg my-adx-rg --sub 9a42a42f-ae42-4242-b6a7-eea0ea42d342</span></pre><p id="b54c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您将得到如下表格输出:</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="2f56" class="nn mg iq nj b gy no np l nq nr">+---------------------------+-----------+----------------+------------------------------------+<br/>|           NAME            |   STATE   |    LOCATION    |                TYPE                |<br/>+---------------------------+-----------+----------------+------------------------------------+<br/>| MyAdxCluster/testadxdb     | Succeeded | Southeast Asia | Microsoft.Kusto/Clusters/Databases |<br/>+---------------------------+-----------+----------------+------------------------------------+</span></pre><p id="c380" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以继续进一步试验，并创建更多的集群和/或数据库</p><h2 id="8e87" class="nn mg iq bd mh nt nu dn ml nv nw dp mp jy nx ny mt kc nz oa mx kg ob oc nb od bi translated">是时候清理了…</h2><p id="79da" class="pw-post-body-paragraph jn jo iq jp b jq nd js jt ju ne jw jx jy nf ka kb kc ng ke kf kg nh ki kj kk ij bi translated">您可以直接删除集群，如下所示:</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="d27e" class="nn mg iq nj b gy no np l nq nr">./goadx cluster delete --name &lt;name of adx cluster&gt; --rg &lt;resource group name&gt; --sub &lt;azure subcription id&gt;</span></pre><p id="6b30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如:</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="f093" class="nn mg iq nj b gy no np l nq nr">./goadx cluster delete --name MyAdxCluster --rg my-adx-rg --sub 9a42a42f-ae42-4242-b6a7-eea0ea42d342</span></pre><p id="48f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该会看到一条确认消息，表明集群已被删除:</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="6708" class="nn mg iq nj b gy no np l nq nr">deleted ADX cluster MyAdxCluster from resource group my-adx-rg</span></pre><p id="a3e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者您可以直接删除数据库本身</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="e50f" class="nn mg iq nj b gy no np l nq nr">./goadx db delete --name &lt;database name&gt; --cluster &lt;adx cluster name&gt; --rg &lt;resource group name&gt; --sub &lt;azure subscription id&gt;</span></pre><p id="3a31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="c894" class="nn mg iq nj b gy no np l nq nr">./goadx db delete --name testadxdb --cluster MyAdxCluster --rg my-adx-rg --sub 9a42a42f-ae42-4242-b6a7-eea0ea42d342</span></pre><p id="83b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该会看到一条确认消息，表明数据库已被删除:</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="9a73" class="nn mg iq nj b gy no np l nq nr">deleted DB testadxdb from cluster MyAdxCluster</span></pre><p id="8aa4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，现在你<em class="lu">能做什么</em>了，是时候看看<em class="lu">如何</em>完成了！</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="46ce" class="mf mg iq bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">代码遍历</h1><p id="6192" class="pw-post-body-paragraph jn jo iq jp b jq nd js jt ju ne jw jx jy nf ka kb kc ng ke kf kg nh ki kj kk ij bi translated">概括地说，应用程序由两部分组成:</p><ul class=""><li id="e4bb" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">Azure Data Explorer操作(创建、读取、删除)——是<code class="fe oe of og nj b"><a class="ae kl" href="https://github.com/abhirockzz/azure-go-sdk-for-dataexplorer/tree/master/ops" rel="noopener ugc nofollow" target="_blank">ops</a></code> <a class="ae kl" href="https://github.com/abhirockzz/azure-go-sdk-for-dataexplorer/tree/master/ops" rel="noopener ugc nofollow" target="_blank">包</a>的一部分</li><li id="ddae" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">CLI命令—是<code class="fe oe of og nj b"><a class="ae kl" href="https://github.com/abhirockzz/azure-go-sdk-for-dataexplorer/tree/master/cli" rel="noopener ugc nofollow" target="_blank">cli</a></code> <a class="ae kl" href="https://github.com/abhirockzz/azure-go-sdk-for-dataexplorer/tree/master/cli" rel="noopener ugc nofollow" target="_blank">包</a>的一部分</li></ul><p id="9168" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">老实说，CLI并不重要(至少在博客的上下文中是如此)。它使用<a class="ae kl" href="https://github.com/spf13/cobra" rel="noopener ugc nofollow" target="_blank"> Cobra </a>包来实现集群和集群(顶层)命令以及子命令— <code class="fe oe of og nj b">create</code>、<code class="fe oe of og nj b">list</code>和<code class="fe oe of og nj b">delete</code>。如果你感兴趣，看看下面的内容:</p><ul class=""><li id="afc3" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated"><a class="ae kl" href="https://github.com/abhirockzz/azure-go-sdk-for-dataexplorer/blob/master/cli/root.go" rel="noopener ugc nofollow" target="_blank"> root.go </a> —定义CLI入口点的root命令</li><li id="e951" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated"><a class="ae kl" href="https://github.com/abhirockzz/azure-go-sdk-for-dataexplorer/blob/master/cli/cluster.go" rel="noopener ugc nofollow" target="_blank"> cluster.go </a> —定义并执行集群操作的子命令</li><li id="9dc5" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated"><a class="ae kl" href="https://github.com/abhirockzz/azure-go-sdk-for-dataexplorer/blob/master/cli/db.go" rel="noopener ugc nofollow" target="_blank"> db.go </a> —定义并实现数据库操作的子命令</li></ul><p id="c3f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">CLI部分简单地调用Azure Data Explorer资源上的CRUD操作，这是重要的部分。所以，让我们仔细检查一下</p><h2 id="f4df" class="nn mg iq bd mh nt nu dn ml nv nw dp mp jy nx ny mt kc nz oa mx kg ob oc nb od bi translated">证明</h2><p id="d6f4" class="pw-post-body-paragraph jn jo iq jp b jq nd js jt ju ne jw jx jy nf ka kb kc ng ke kf kg nh ki kj kk ij bi translated">这在<a class="ae kl" href="https://github.com/abhirockzz/azure-go-sdk-for-dataexplorer/blob/master/ops/client.go" rel="noopener ugc nofollow" target="_blank"> ops/client.go </a>中处理。为了获得客户端组件的句柄来执行所需的操作，我们需要进行身份验证。例如，为了获得<code class="fe oe of og nj b"><a class="ae kl" href="https://godoc.org/github.com/Azure/azure-sdk-for-go/services/kusto/mgmt/2020-02-15/kusto#ClustersClient" rel="noopener ugc nofollow" target="_blank">kusto.ClustersClient</a></code>:</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="9869" class="nn mg iq nj b gy no np l nq nr">func getClustersClient(subscription string) kusto.ClustersClient {<br/>    client := kusto.NewClustersClient(subscription)<br/>    authR, err := auth.<strong class="nj ir">NewAuthorizerFromEnvironment</strong>()<br/>    if err != nil {<br/>        log.Fatal(err)<br/>    }<br/>    client.Authorizer = authR</span><span id="b597" class="nn mg iq nj b gy ns np l nq nr">    return client<br/>}</span></pre><p id="6359" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">需要注意的是<a class="ae kl" href="https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#NewAuthorizerFromEnvironment" rel="noopener ugc nofollow" target="_blank"> auth。newauthorizerfromeenvironment()</a>寻找一组预定义的环境变量—这是<a class="ae kl" href="https://docs.microsoft.com/en-us/azure/developer/go/azure-sdk-authorization#use-environment-based-authentication" rel="noopener ugc nofollow" target="_blank">基于用户环境的认证</a></p><h2 id="23fb" class="nn mg iq bd mh nt nu dn ml nv nw dp mp jy nx ny mt kc nz oa mx kg ob oc nb od bi translated">集群操作</h2><p id="8a1b" class="pw-post-body-paragraph jn jo iq jp b jq nd js jt ju ne jw jx jy nf ka kb kc ng ke kf kg nh ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/abhirockzz/azure-go-sdk-for-dataexplorer/blob/master/ops/cluster.go" rel="noopener ugc nofollow" target="_blank"> ops/cluster.go </a>是处理集群创建、列表和删除的地方。以下是create的代码片段:</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="4870" class="nn mg iq nj b gy no np l nq nr">func CreateCluster(sub, clusterName, location, rgName string) {<br/>    ...<br/>    result, err := client.<strong class="nj ir">CreateOrUpdate</strong>(ctx, rgName, clusterName, kusto.Cluster{Location: &amp;location, Sku: &amp;kusto.AzureSku{Name: kusto.DevNoSLAStandardD11V2, Capacity: &amp;numInstances, Tier: kusto.Basic}})<br/>    err = result.<strong class="nj ir">WaitForCompletionRef</strong>(context.Background(), client.Client)<br/>    r, err := result.<strong class="nj ir">Result</strong>(client)<br/>    ...<br/>}</span></pre><p id="d82e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://godoc.org/github.com/Azure/azure-sdk-for-go/services/kusto/mgmt/2020-02-15/kusto#ClustersClient.CreateOrUpdate" rel="noopener ugc nofollow" target="_blank"> CreateOrUpdate </a>用于启动集群创建。因为这是一个长时间运行的op，它返回一个我们等待的<code class="fe oe of og nj b"><a class="ae kl" href="https://godoc.org/github.com/Azure/azure-sdk-for-go/services/kusto/mgmt/2020-02-15/kusto#ClustersCreateOrUpdateFuture" rel="noopener ugc nofollow" target="_blank">ClustersCreateOrUpdateFuture</a></code>(使用<code class="fe oe of og nj b"><a class="ae kl" href="https://godoc.org/github.com/Azure/go-autorest/autorest/azure#Future.WaitForCompletionRef" rel="noopener ugc nofollow" target="_blank">WaitForCompletionRef</a></code></p><blockquote class="lr ls lt"><p id="2f98" class="jn jo lu jp b jq jr js jt ju jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj kk ij bi translated"><em class="iq">请注意，我使用了</em> <code class="fe oe of og nj b"><em class="iq">context.Background()</em></code> <em class="iq">，您可以使用不同的上下文，例如，带有超时或可取消的上下文。</em></p></blockquote><p id="a445" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦这是一个，我们检查<code class="fe oe of og nj b"><a class="ae kl" href="https://godoc.org/github.com/Azure/azure-sdk-for-go/services/kusto/mgmt/2020-02-15/kusto#ClustersCreateOrUpdateFuture.Result" rel="noopener ugc nofollow" target="_blank">Result</a></code>的未来</p><p id="2e68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">列出一个资源组中的所有集群非常简单，可以使用<code class="fe oe of og nj b"><a class="ae kl" href="https://godoc.org/github.com/Azure/azure-sdk-for-go/services/kusto/mgmt/2020-02-15/kusto#ClustersClient.ListByResourceGroup" rel="noopener ugc nofollow" target="_blank">ListByResourceGroup</a></code>来完成</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="f180" class="nn mg iq nj b gy no np l nq nr">func ListClusters(sub, rgName string) kusto.ClusterListResult {<br/>    ctx := context.Background()</span><span id="ea4a" class="nn mg iq nj b gy ns np l nq nr">    result, err := getClustersClient(sub).<strong class="nj ir">ListByResourceGroup</strong>(ctx, rgName)<br/>    if err != nil {<br/>        log.Fatal(err.Error())<br/>    }<br/>    return result<br/>}</span></pre><p id="cb55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe oe of og nj b">Delete</code>与<code class="fe oe of og nj b">Create</code>相似，也是一个长时间运行的操作。这是相同的练习-启动删除(<a class="ae kl" href="https://godoc.org/github.com/Azure/azure-sdk-for-go/services/kusto/mgmt/2020-02-15/kusto#ClustersClient.Delete" rel="noopener ugc nofollow" target="_blank">使用Delete </a>)，等待它完成，然后确认结果</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="2a0b" class="nn mg iq nj b gy no np l nq nr">func DeleteCluster(sub, clusterName, rgName string) {<br/>    ...<br/>    result, err := client.<strong class="nj ir">Delete</strong>(ctx, rgName, clusterName)<br/>    err = result.<strong class="nj ir">WaitForCompletionRef</strong>(context.Background(), client.Client)<br/>    r, err := result.<strong class="nj ir">Result</strong>(client)<br/>    ...<br/>}</span></pre><h2 id="b37e" class="nn mg iq bd mh nt nu dn ml nv nw dp mp jy nx ny mt kc nz oa mx kg ob oc nb od bi translated">数据库操作</h2><p id="f9a9" class="pw-post-body-paragraph jn jo iq jp b jq nd js jt ju ne jw jx jy nf ka kb kc ng ke kf kg nh ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/abhirockzz/azure-go-sdk-for-dataexplorer/blob/master/ops/db.go" rel="noopener ugc nofollow" target="_blank"> ops/db.go </a>是处理数据库创建、列表和删除的地方。以下是create的代码片段:</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="5784" class="nn mg iq nj b gy no np l nq nr">func CreateDatabase(sub, rgName, clusterName, location, dbName string) {<br/>    ...<br/>    future, err := client.<strong class="nj ir">CreateOrUpdate</strong>(ctx, rgName, clusterName, dbName, kusto.ReadWriteDatabase{Kind: kusto.KindReadWrite, Location: &amp;location})<br/>    err = future.<strong class="nj ir">WaitForCompletionRef</strong>(context.Background(), client.Client)</span><span id="9b8b" class="nn mg iq nj b gy ns np l nq nr">    r, err := future.<strong class="nj ir">Result</strong>(client)<br/>    kdb, _ := r.Value.AsReadWriteDatabase()<br/>    ...<br/>}</span></pre><p id="5059" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">列表很简单，由<code class="fe oe of og nj b"><a class="ae kl" href="https://godoc.org/github.com/Azure/azure-sdk-for-go/services/kusto/mgmt/2020-02-15/kusto#DatabasesClient.ListByCluster" rel="noopener ugc nofollow" target="_blank">ListByCluster</a></code>负责</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="a353" class="nn mg iq nj b gy no np l nq nr">func ListDBs(sub, rgName, clusterName string) kusto.DatabaseListResult {<br/>    ctx := context.Background()<br/>    result, err := getDBClient(sub).<strong class="nj ir">ListByCluster</strong>(ctx, rgName, clusterName)<br/>    if err != nil {<br/>        log.Fatal("failed to get databases in cluster", err)<br/>    }<br/>    return result<br/>}</span></pre><p id="f131" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，使用<code class="fe oe of og nj b"><a class="ae kl" href="https://godoc.org/github.com/Azure/azure-sdk-for-go/services/kusto/mgmt/2020-02-15/kusto#DatabasesClient.Delete" rel="noopener ugc nofollow" target="_blank">Delete</a></code>处理删除</p><pre class="lb lc ld le gt ni nj nk nl aw nm bi"><span id="3036" class="nn mg iq nj b gy no np l nq nr">func DeleteDB(sub, rgName, clusterName, dbName string) {<br/>    ...<br/>    future, err := getDBClient(sub).<strong class="nj ir">Delete</strong>(ctx, rgName, clusterName, dbName)<br/>    err = future.<strong class="nj ir">WaitForCompletionRef</strong>(context.Background(), client.Client)<br/>    r, err := future.<strong class="nj ir">Result</strong>(client)<br/>    ...<br/>}</span></pre><p id="b731" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代码演练到此结束！</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="2260" class="mf mg iq bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">结论</h1><p id="e6d3" class="pw-post-body-paragraph jn jo iq jp b jq nd js jt ju ne jw jx jy nf ka kb kc ng ke kf kg nh ki kj kk ij bi translated">希望这有助于演示如何使用Azure Go SDK来处理Azure Data Explorer资源。可以查看<a class="ae kl" href="https://docs.microsoft.com/azure/data-explorer/create-cluster-database-python?WT.mc_id=dzone-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> Python </a>、<a class="ae kl" href="https://docs.microsoft.com/azure/data-explorer/create-cluster-database-csharp?WT.mc_id=dzone-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">的文档。NET </a>等例子。探索愉快！</p></div></div>    
</body>
</html>