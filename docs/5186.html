<html>
<head>
<title>Angular and legacy JavaScript integrations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular和遗留JavaScript集成</h1>
<blockquote>原文：<a href="https://itnext.io/angular-and-legacy-javascript-integrations-f0e9d47a58fc?source=collection_archive---------0-----------------------#2021-01-05">https://itnext.io/angular-and-legacy-javascript-integrations-f0e9d47a58fc?source=collection_archive---------0-----------------------#2021-01-05</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="d561" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">如何让你的Angular SPAs与传统图书馆“好好”交流</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/58f33b48c59f42376baf2e5a313349a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*g5fWBbFJWCitTefjBkLmWw.gif"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">呆伯特(<a class="ae kw" href="https://dilbert.com/strip/2006-12-08" rel="noopener ugc nofollow" target="_blank">https://dilbert.com/strip/2006-12-08</a>)</figcaption></figure><p id="dc35" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">大多数提供某些常用功能的系统也提供某种集成。让我们说图形和图表库，记录在老平原遗留JavaScript ( &lt; ES5), with old styled HTML &amp;<script>代码)，只是包括一个条形图。或者一些允许访问者购买活动门票的网站，没有API，没有web组件，只有一段带有“&lt;em class="lt"&gt;在你的代码上插入这个脚本&lt;/em&gt;”的代码，它导入一个Javascript文件，一个CSS文件并嵌入一个iframe。你可能已经看过这个了，如果你还没看过，你会看的(相信我…)&lt;/root&gt;</script></p><p id="56c5" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">大多数时候，这种集成是为非开发人员设计的，<em class="lt">“包含这些代码，它就会工作”</em>，神奇。</p><p id="08a1" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">但是，如果你必须让这种整合与你的Angular SPA一起工作呢？</p><p id="4f99" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">我最近与iFrame resizer库作斗争，不得不添加一些第三方代码块，包括一个iFrame、一个js文件和一个CSS文件到Angular组件。"<em class="lt">为了改进UX，把这个脚本添加到你的HTML的头部… </em>"然后就有了iframe resizer。顺便说一句，iframes绝对不可能改进UX，iframes只是看起来像一个张贴在屏幕上的帖子。<br/>简而言之，我阅读了相关文件，但没有一条建议对我有效。</p><p id="644b" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">所以我是这样做的:</p><h2 id="aa80" class="lu lv ir bd lw lx ly dn lz ma mb dp mc lg md me mf lk mg mh mi lo mj mk ml mm bi translated">动态加载所有外部所需文件</h2><p id="472c" class="pw-post-body-paragraph kx ky ir kz b la mn js lc ld mo jv lf lg mp li lj lk mq lm ln lo mr lq lr ls ik bi translated">这将向DOM添加所需的脚本和css，但不是通过将代码粘贴到组件的模板上。我们将为此使用一个服务:</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="ms mt l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated"><a class="ae kw" href="https://gist.github.com/jsanta/9c845b6be5bc2118d0a1415f2c3c569f" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/jsanta/9 c 845 b 6 be 5b c 2118 d0a 1415 F2 C3 c 569 f</a></figcaption></figure><p id="a4d0" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">该服务获取脚本或CSS文件的URL，并将其附加到HTML DOM中。将它作为提供者包含在app.module.ts文件中，这样您就可以拥有服务的单个实例，并且避免在已经加载文件的情况下加载它们。</p><h2 id="c25f" class="lu lv ir bd lw lx ly dn lz ma mb dp mc lg md me mf lk mg mh mi lo mj mk ml mm bi translated">声明一个全局变量来包装脚本</h2><p id="c0f9" class="pw-post-body-paragraph kx ky ir kz b la mn js lc ld mo jv lf lg mp li lj lk mq lm ln lo mr lq lr ls ik bi translated">在您的组件上，您需要为您试图包含的第三方脚本声明一个包装器。希望您了解这个脚本的内部，这样您就可以定义一个允许自动完成代码的接口。正如我们通常不做的那样，我们将只使用<em class="lt"> any </em>类型。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="ms mt l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated"><a class="ae kw" href="https://gist.github.com/jsanta/231bb5c65a1faf7571c846dfc49a3263" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/jsanta/231 bb 5c 65 a1 faf 7571 c 846 DFC 49 a 3263</a></figcaption></figure><p id="fcf4" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">为什么是全球？在我工作的公司，我们有一些动态表单验证是这样加载的。我们在Safari上遇到了一些问题，将脚本对象变量声明为<em class="lt">全局</em>解决了这个问题。</p><p id="fb5d" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">最后…</p><h2 id="e820" class="lu lv ir bd lw lx ly dn lz ma mb dp mc lg md me mf lk mg mh mi lo mj mk ml mm bi translated">按照建议使用第三方脚本</h2><p id="d346" class="pw-post-body-paragraph kx ky ir kz b la mn js lc ld mo jv lf lg mp li lj lk mq lm ln lo mr lq lr ls ik bi translated">现在，您可以使用文档中显示的脚本了(在确保加载了脚本之后，必须包含代码，这在第34行和第36行之间。例如:</p><pre class="kh ki kj kk gu mu mv mw mx aw my bi"><span id="85ea" class="lu lv ir mv b gz mz na l nb nc">// ...</span><span id="cb3b" class="lu lv ir mv b gz nd na l nb nc">    Promise.all(scriptArray).then(_ =&gt; {<br/>      console.log('All scripts loaded');</span><span id="ac82" class="lu lv ir mv b gz nd na l nb nc">      // These are not real methods, just placed them <br/>      // for illustrative purposes<br/>      externalLibrary.loadData(this.data);<br/>      externalLibrary.renderChart('barchart', 'chart-container');<br/>      otherExternalLibrary.validateRoles();</span><span id="1de7" class="lu lv ir mv b gz nd na l nb nc">   )};</span><span id="bba4" class="lu lv ir mv b gz nd na l nb nc">// ...</span></pre><p id="bffd" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">顺便说一句，不要只是在GISTs上复制粘贴代码，我想我遗漏了几个右括号:)</p><h2 id="9d7a" class="lu lv ir bd lw lx ly dn lz ma mb dp mc lg md me mf lk mg mh mi lo mj mk ml mm bi translated">jQuery呢？</h2><p id="0846" class="pw-post-body-paragraph kx ky ir kz b la mn js lc ld mo jv lf lg mp li lj lk mq lm ln lo mr lq lr ls ik bi translated">是的，仍然有人在使用<em class="lt"> jQuery </em>。<em class="lt"> jQuery </em>是另一个故事，曾经尝试过这样加载，但失败了。所以最终发现jQuery工作的唯一方式是将其添加到<em class="lt"> polyfills.ts </em>文件的最后几行，如下所示:</p><pre class="kh ki kj kk gu mu mv mw mx aw my bi"><span id="0f40" class="lu lv ir mv b gz mz na l nb nc">import * as jQuery from 'jquery';<br/>window['$'] = jQuery;</span></pre><p id="ac0a" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">你应该可以像往常一样使用$了。</p><p id="1fc7" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">希望有帮助。</p></div></div>    
</body>
</html>