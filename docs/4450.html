<html>
<head>
<title>Building a Social Network: Part II</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建社交网络:第二部分</h1>
<blockquote>原文：<a href="https://itnext.io/building-a-social-network-part-ii-1e6883ba27f6?source=collection_archive---------3-----------------------#2020-07-03">https://itnext.io/building-a-social-network-part-ii-1e6883ba27f6?source=collection_archive---------3-----------------------#2020-07-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cab4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用公共数据模型创建Dart包</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4271e125ca13395835b3379919dede4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*9afpiEW_ig6wnXCeNR1sLA.gif"/></div></div></figure><h2 id="3be9" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">介绍</h2><p id="4dc3" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi mj translated"><span class="l mk ml mm bm mn mo mp mq mr di">在本系列的</span><a class="ae ms" rel="noopener ugc nofollow" target="_blank" href="/building-a-social-network-part-i-25856fc693e1">上一篇文章</a>中，我们查看了带有内置安全和隐私特性的社交网络演示的底层SQL模式。在本文中，我们将研究该应用程序自底向上设计的下一个阶段:数据模型库。</p><p id="3223" class="pw-post-body-paragraph lq lr it ls b lt mt ju lv lw mu jx ly ld mv ma mb lh mw md me ll mx mg mh mi im bi translated">通过在一个公共库中定义模型，可以在一个方便的位置维护数据模型和底层DB模式之间的完整性，允许将来构建任意数量的组件，并具有编译时类型安全性以提高可靠性。</p><p id="8c2e" class="pw-post-body-paragraph lq lr it ls b lt mt ju lv lw mu jx ly ld mv ma mb lh mw md me ll mx mg mh mi im bi translated">数据模型反映了预期的模式，并为JSON序列化和其他特性提供了方便的方法。额外的哈希层用于避免以可读的明文形式发送密码。</p><p id="889a" class="pw-post-body-paragraph lq lr it ls b lt mt ju lv lw mu jx ly ld mv ma mb lh mw md me ll mx mg mh mi im bi translated">之所以选择Dart，是因为它具有强大的功能集，并且是Flutter中应用程序的开发语言，这对于快速构建具有高性能UX的跨平台客户端应用程序非常有用。</p><blockquote class="my mz na"><p id="7807" class="lq lr nb ls b lt mt ju lv lw mu jx ly nc mv ma mb nd mw md me ne mx mg mh mi im bi translated"><em class="it">本系列文章的项目源代码可从GitHub </em>  <em class="it">上的</em> <a class="ae ms" href="https://github.com/kenreilly/social-network-demo" rel="noopener ugc nofollow" target="_blank"> <em class="it">处获得。</em></a></p></blockquote></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="06c5" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">包装定义</h2><p id="59e8" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">核心库的Dart包在<code class="fe nm nn no np b"><strong class="ls iu">core/pubspec.yaml:</strong></code>中定义</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="c568" class="pw-post-body-paragraph lq lr it ls b lt mt ju lv lw mu jx ly ld mv ma mb lh mw md me ll mx mg mh mi im bi translated">这就创建了一个简单的包，通过添加<code class="fe nm nn no np b">core</code>包作为依赖项，可以轻松地将其导入API、客户端应用程序、实用程序和维护功能，或者社交网络的任何其他组件。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="7df4" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">核心</h2><p id="cea8" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">项目中主要的导出源文件是<code class="fe nm nn no np b"><strong class="ls iu">core/lib/core.dart:</strong></code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="85b1" class="pw-post-body-paragraph lq lr it ls b lt mt ju lv lw mu jx ly ld mv ma mb lh mw md me ll mx mg mh mi im bi translated">该文件定义了<code class="fe nm nn no np b">core</code>库，并导出数据模型和实用程序类，供软件的其他部分使用，例如认证请求模型、数据模型和密码散列实用程序。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="b852" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">可序列化</h2><p id="94bd" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">数据模型基类在<code class="fe nm nn no np b"><strong class="ls iu">core/lib/types/serializable.dart</strong>:</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="0f04" class="pw-post-body-paragraph lq lr it ls b lt mt ju lv lw mu jx ly ld mv ma mb lh mw md me ll mx mg mh mi im bi translated">数据模型扩展了这个<code class="fe nm nn no np b">Serializable</code>类，每个都为<a class="ae ms" href="https://en.wikipedia.org/wiki/Serialization" rel="noopener ugc nofollow" target="_blank">序列化</a>实现了fromMap和toJson。这允许系统组件以函数方式对可序列化对象进行操作，而不需要在编译时或运行时了解每种类型的属性。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="0d74" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">AuthRequest</h2><p id="3805" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">接下来让我们来看看<code class="fe nm nn no np b"><strong class="ls iu">core/lib/models/auth-request.dart:</strong></code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="77a0" class="pw-post-body-paragraph lq lr it ls b lt mt ju lv lw mu jx ly ld mv ma mb lh mw md me ll mx mg mh mi im bi translated">这个类提供了一个方便的包装器，用于发出身份验证请求，带有电子邮件和散列密码的属性，以及一个用于创建新请求的<code class="fe nm nn no np b">create</code>方法，以及<code class="fe nm nn no np b">fromMap</code>和<code class="fe nm nn no np b">toJson</code>的实现，允许请求被序列化以进行网络传输。</p><p id="5f67" class="pw-post-body-paragraph lq lr it ls b lt mt ju lv lw mu jx ly ld mv ma mb lh mw md me ll mx mg mh mi im bi translated">这通过提供API和所有支持的客户端应用程序理解的公共接口简化了未来的开发，这改善了从开发人员体验到安全性的一切，同时减少了未来必须编写的代码量。可以在编译时而不是运行时发现错误，并且可以开发高度可靠的测试和验证程序来确保始终达到产品质量。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="13de" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">用户图像</h2><p id="d8e2" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">接下来是<code class="fe nm nn no np b"><strong class="ls iu">core/lib/models/image.dart</strong>:</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="e9e0" class="pw-post-body-paragraph lq lr it ls b lt mt ju lv lw mu jx ly ld mv ma mb lh mw md me ll mx mg mh mi im bi translated">图像可以是JPG、PNG或GIF文件，并且具有唯一的ID和一个标志来指示它当前是否被设置为个人资料照片。<code class="fe nm nn no np b">ext</code>访问器返回一个典型的文件名字符串，该字符串可用于将图像数据存储在本地文件、云存储服务或其他位置。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="b42c" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">用户</h2><p id="57f7" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">用户类别位于<code class="fe nm nn no np b">core/lib/models/user.dart:</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="3c51" class="pw-post-body-paragraph lq lr it ls b lt mt ju lv lw mu jx ly ld mv ma mb lh mw md me ll mx mg mh mi im bi translated">这个文件包含一个基类<code class="fe nm nn no np b">User</code>以及<code class="fe nm nn no np b">AuthenticatedUser </code>和<code class="fe nm nn no np b">NewUser</code>，用于处理认证和创建新的用户帐户。以这种方式使用一组公共的类可以最大限度地减少身份验证和帐户创建代码中出现错误的可能性。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="bd34" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">邮政</h2><p id="da1f" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">发布数据的公共类在<code class="fe nm nn no np b"><strong class="ls iu">core/lib/models/post.dart</strong>:</code>中</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="0087" class="pw-post-body-paragraph lq lr it ls b lt mt ju lv lw mu jx ly ld mv ma mb lh mw md me ll mx mg mh mi im bi translated"><code class="fe nm nn no np b">Post</code>类表示一个社交网络帖子，带有id、相关用户、内容和一个<code class="fe nm nn no np b">fromJSON </code>，用于从数据库记录中创建一个<code class="fe nm nn no np b">Post</code>实例。类<code class="fe nm nn no np b">NewPost</code>定义了创建新帖子所需的参数，客户端应用程序将使用这些参数通过API发布内容。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="73b7" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">房间</h2><p id="2fbf" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">聊天室数据模型在<code class="fe nm nn no np b"><strong class="ls iu">core/lib/models/room.dart:</strong></code>中</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="4f41" class="pw-post-body-paragraph lq lr it ls b lt mt ju lv lw mu jx ly ld mv ma mb lh mw md me ll mx mg mh mi im bi translated">Room和NewRoom类将用于创建、列出和连接聊天室。格式与其他数据模型类相同。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="9514" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">测试</h2><p id="05bb" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated"><code class="fe nm nn no np b">core</code>包包括一个TDD的基本框架，以及一个测试模型类，用于验证序列化是否如预期的那样工作。测试模型位于<code class="fe nm nn no np b"><strong class="ls iu">core/lib/models/post.dart:</strong></code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="0229" class="pw-post-body-paragraph lq lr it ls b lt mt ju lv lw mu jx ly ld mv ma mb lh mw md me ll mx mg mh mi im bi translated"><code class="fe nm nn no np b">TestModel</code>类扩展了<code class="fe nm nn no np b">Serializable</code>的一些属性和方法，用于测试基本类型的基本序列化，并通过自定义实现<code class="fe nm nn no np b">==</code>相等<a class="ae ms" href="https://en.wikipedia.org/wiki/Operator_overloading" rel="noopener ugc nofollow" target="_blank">操作符</a>来检查相等性。</p><p id="ba3e" class="pw-post-body-paragraph lq lr it ls b lt mt ju lv lw mu jx ly ld mv ma mb lh mw md me ll mx mg mh mi im bi translated">测试本身位于<code class="fe nm nn no np b"><strong class="ls iu">core/test/test-runner.dart:</strong></code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="84c7" class="pw-post-body-paragraph lq lr it ls b lt mt ju lv lw mu jx ly ld mv ma mb lh mw md me ll mx mg mh mi im bi translated">通过从头开始创建一个TestModel来测试序列化，然后根据第一个模型的属性创建另一个模型，使用前一个模型的<code class="fe nm nn no np b">data</code>访问器创建另一个模型，通过JSON序列化方法传递前一个模型来创建另一个模型。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="bca0" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">结论</h2><p id="95fd" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">这个包作为API和UI的一个公共库，在处理进出数据库的数据时，以一种确保现在和将来维护的兼容性和可靠性的方式来构建。</p><p id="c425" class="pw-post-body-paragraph lq lr it ls b lt mt ju lv lw mu jx ly ld mv ma mb lh mw md me ll mx mg mh mi im bi translated">即将推出的是本系列的第三部分，其中导入了这个包，并在REST API中使用它来实现创建帐户、添加关注者和发布内容(包括图片)的端点。</p><p id="fa00" class="pw-post-body-paragraph lq lr it ls b lt mt ju lv lw mu jx ly ld mv ma mb lh mw md me ll mx mg mh mi im bi translated">感谢阅读！</p><p id="7a6d" class="pw-post-body-paragraph lq lr it ls b lt mt ju lv lw mu jx ly ld mv ma mb lh mw md me ll mx mg mh mi im bi translated"><strong class="ls iu"><em class="nb">~</em></strong><a class="ae ms" href="https://twitter.com/8_bit_hacker" rel="noopener ugc nofollow" target="_blank"><strong class="ls iu"><em class="nb">8 _ bit _ hacker</em></strong></a></p></div></div>    
</body>
</html>