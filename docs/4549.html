<html>
<head>
<title>Security Zones in OpenShift worker nodes — Part IV — User Restrictions and Recap</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OpenShift工作节点中的安全区域—第四部分—用户限制和概述</h1>
<blockquote>原文：<a href="https://itnext.io/security-zones-in-openshift-worker-nodes-part-iv-user-restrictions-and-recap-5ec0ba7bdaf9?source=collection_archive---------6-----------------------#2020-07-21">https://itnext.io/security-zones-in-openshift-worker-nodes-part-iv-user-restrictions-and-recap-5ec0ba7bdaf9?source=collection_archive---------6-----------------------#2020-07-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/e600efd63d782f932c16c5a601be0272.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*vWhaP0lqJkB6OBPZx09JpA.jpeg"/></div></figure><p id="60fa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是关于如何在你的OpenShift workers中配置安全区域的最后一篇文章。您应该已经完成了前面的配置步骤:</p><div class="ks kt gp gr ku kv"><a href="https://medium.com/@luis.ariz/security-zones-in-openshift-worker-nodes-part-ii-grouping-workers-8e97f1d601ba" rel="noopener follow" target="_blank"><div class="kw ab fo"><div class="kx ab ky cl cj kz"><h2 class="bd ir gy z fp la fr fs lb fu fw ip bi translated">OpenShift工人节点中的安全区域—第二部分—工人分组</h2><div class="lc l"><h3 class="bd b gy z fp la fr fs lb fu fw dk translated">这是本系列的第二部分，我们将配置两组不同的工作人员。</h3></div><div class="ld l"><p class="bd b dl z fp la fr fs lb fu fw dk translated">medium.com</p></div></div><div class="le l"><div class="lf l lg lh li le lj js kv"/></div></div></a></div><div class="ks kt gp gr ku kv"><a href="https://medium.com/@luis.ariz/security-zones-in-openshift-worker-nodes-part-iii-network-configuration-3a887854a4d" rel="noopener follow" target="_blank"><div class="kw ab fo"><div class="kx ab ky cl cj kz"><h2 class="bd ir gy z fp la fr fs lb fu fw ip bi translated">OpenShift工作节点中的安全区域—第三部分—网络配置</h2><div class="lc l"><h3 class="bd b gy z fp la fr fs lb fu fw dk translated">在本帖中，我们将重点讨论在我们的安全系统中分离入站和出站流量所需的网络配置…</h3></div><div class="ld l"><p class="bd b dl z fp la fr fs lb fu fw dk translated">medium.com</p></div></div><div class="le l"><div class="lk l lg lh li le lj js kv"/></div></div></a></div><p id="a457" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这一次，我们将配置RBAC和其他限制，只允许我们的OpenShift集群用户的一个子集能够使用安全区域。</p><h1 id="c8a2" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">概观</h1><p id="78c2" class="pw-post-body-paragraph ju jv iq jw b jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr ij bi translated">现在一切都正常了。我们可以说我们已经做到了，但前提是我们完全信任我们的OpenShift用户，因为任何用户都可以选择何时在安全区域部署工作负载。</p><p id="8ee4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们不想那样。作为集群管理员，我们希望设置某些名称空间，附加到一些用户/组，允许他们在安全区域中创建新的应用程序，而其余的用户/名称空间将不能使用它。这意味着唯一能够创建新名称空间的人是集群管理员(我们需要为其他用户禁用该选项)</p><p id="4a86" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我将创建两组用户:</p><ul class=""><li id="055f" class="mo mp iq jw b jx jy kb kc kf mq kj mr kn ms kr mt mu mv mw bi translated">普通用户</li><li id="e405" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">安全区域用户</li></ul><p id="5043" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">普通用户将只能使用普通区域，而安全区域用户将被允许使用两个区域(或者只使用一个区域，如我们将看到的那样，通过配置名称空间默认节点选择器)。如果您想要设置为不受信任的用户创建区域的用例，您将需要以相反的方式配置权限，以便新的(不受信任的)用户组只能使用新的区域，而其余的用户可以同时使用这两个区域，并且还需要在名称空间中配置默认的nodeSelector，这样用户就不需要将它包含在对象定义中来防止部署失败。</p><p id="e764" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">阻止使用安全区域</strong></p><p id="763f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们如何“允许”某人使用安全区域？通过在它们的名称空间中包含公差。因为我们不允许用户自己创建名称空间，所以集群管理员将知道何时包含对名称空间的容忍，以及如何将名称空间绑定到用户组，但是我们需要防止用户配置他们自己的容忍，否则，他们可能会包含使用安全区域的容忍，即使他们不应该这样做。</p><p id="f9f3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">名称空间中有一个特殊的注释(【scheduler.alpha.kubernetes.io/tolerationsWhitelist】)列出了该名称空间上的用户可以配置的有效容差。如果用户试图配置未在此列出的任何其他容差，他将得到一个错误。我们将使用该注释。</p><p id="c512" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">有一件事你必须考虑到。当您创建一个POD时，即使您没有设置任何容差，您也可以在对象定义中找到其中的两个配置:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="0d0a" class="nm lm iq ni b gy nn no l np nq">...<br/>tolerations:<br/>    - key: node.kubernetes.io/not-ready<br/>      operator: Exists<br/>      effect: NoExecute<br/>      tolerationSeconds: 300<br/>    - key: node.kubernetes.io/unreachable<br/>      operator: Exists<br/>      effect: NoExecute<br/>      tolerationSeconds: 300<br/>...</span></pre><p id="f592" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果我们设置了<em class="nc"> tolerationsWhitelist </em>注释，我们需要记住这一点，并将那些“默认”公差包括在允许的公差列表中，否则当您试图创建新的PODs时，您会发现这个错误，因为您试图使用不允许的公差(尽管您没有在对象上指定它们):</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="e4ed" class="nm lm iq ni b gy nn no l np nq">pod tolerations (possibly merged with namespace default tolerations) conflict with its namespace whitelist</span></pre><p id="4281" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因为我们不希望用户配置任何其他容差，所以我们只在注释中包括那些默认容差，不再包括，这将使他们无法使用所需的容差来使用安全区域，并且因为集群管理员将是唯一创建名称空间的人，所以这可以预先配置，用户将无法修改它。</p><p id="c9e2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">阻止网络策略修改</strong></p><p id="fa4b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">请记住，除了容差之外，还必须在名称空间级别执行其他配置，例如防止SDN内部连接的网络策略</p><p id="1386" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这种配置不同于前一种配置，前一种配置包含在用户不能修改的名称空间对象的注释中，它是链接到用户可以管理的名称空间的附加对象。</p><p id="e988" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">但是，如果集群管理员在名称空间中设置了一些网络策略，而用户随后删除了它们，会发生什么情况呢？我们应该防止用户修改网络策略，以确保这种情况不会发生。</p><p id="0340" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这将通过删除用户在NetworkPolicy对象上的权限来完成。我将创建一个新的RBAC角色，按照我从一开始就遵循的尽可能少使用默认OpenShift配置的策略，删除这些权限，而不是从默认角色中删除它们。</p><p id="2b87" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">在名称空间中包含默认注释和网络策略</strong></p><p id="3cbd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">每次创建命名空间时，都要进行一些配置:</p><ol class=""><li id="1a9a" class="mo mp iq jw b jx jy kb kc kf mq kj mr kn ms kr nr mu mv mw bi translated">使用所需角色授予用户/组访问权限</li><li id="d2cd" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr nr mu mv mw bi translated">创建<em class="nc">容忍白名单</em>注释，以防止来自用户的不必要的容忍配置</li><li id="06a4" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr nr mu mv mw bi translated">创建默认网络策略</li></ol><p id="03cf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对于第2点和第3点，我们可以执行一个配置，这将使集群管理员的工作稍微轻松一些。我们将在默认的新命名空间模板中包含一些<em class="nc">容忍白名单</em>和默认网络策略，因此每次clusteradmin创建新的命名空间时，这些配置将自动包含在配置中。</p><p id="6c9e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Multus网络是在Network Operator中逐个配置的，所以我们不能将它们包含在这个模板中，也许有一天将Multus网络附加到名称空间会是一种更容易支持的方法，但现在就是这样做的。</p><p id="35fe" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">变更概要</strong></p><p id="52b6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">总之，我们需要:</p><ul class=""><li id="738e" class="mo mp iq jw b jx jy kb kc kf mq kj mr kn ms kr mt mu mv mw bi translated">创建两个新用户组，并在其中包含用户</li><li id="e493" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">删除用户创建自己的命名空间/项目的权限</li><li id="bcef" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">创建一个新的群集角色，在该角色中，我们删除用户修改容差的权限，并删除用户修改网络策略的权限</li><li id="2c17" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">修改默认命名空间创建模板以包含默认网络策略</li></ul><h1 id="0750" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated"><strong class="ak"> OpenShift配置(限制区域使用)</strong></h1><p id="01d8" class="pw-post-body-paragraph ju jv iq jw b jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr ij bi translated">让我们从新组开始。</p><p id="df14" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">1-用户组</strong></p><p id="9d04" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我的OpenShift集群中已经配置了一些用户(用户1到用户10)。我将添加两个新组，一个使用OC CLI，另一个使用描述符(您可以使用CLI或Web控制台来创建它)。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="7560" class="nm lm iq ni b gy nn no l np nq">oc adm groups new regularusers user1 user2 user3 user4 user5</span></pre><p id="5d96" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">第二组:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="669b" class="nm lm iq ni b gy nn no l np nq">apiVersion: user.openshift.io/v1<br/>kind: Group<br/>metadata:<br/>  name: securezoneusers<br/>users:<br/>  - user6<br/>  - user7 <br/>  - user8<br/>  - user9 <br/>  - user10</span></pre><p id="8c5b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">2-删除名称空间创建权限</strong></p><p id="b28c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以通过运行以下命令来删除项目自行设置程序权限:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="e712" class="nm lm iq ni b gy nn no l np nq">$ oc patch clusterrolebinding.rbac self-provisioners -p '{"subjects": null}'</span></pre><p id="8c7e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">编辑<code class="fe ns nt nu ni b"><strong class="jw ir">self-provisioners</strong></code>集群角色绑定以防止角色自动更新。自动更新会将群集角色重置为默认状态。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="a040" class="nm lm iq ni b gy nn no l np nq">$ oc patch clusterrolebinding.rbac self-provisioners -p ‘{ “metadata”: { “annotations”: { “rbac.authorization.kubernetes.io/autoupdate”: “false” } } }’</span></pre><p id="50c9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">3-创建一个新的群集角色，我们将在其中删除用户修改网络策略的权限</strong></p><p id="a5da" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我不会从头开始创建一个角色，我会得到一个默认的，复制它，最后修改它。在我的例子中，最佳匹配是“编辑”角色，所以我将它“导出”到一个文件中(注意不再支持<em class="nc"> oc export </em>命令，我们将不得不手动删除一些键)</p><p id="64ee" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我用编辑角色对象的内容创建了一个“editrestricted.yaml”文件:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="b4eb" class="nm lm iq ni b gy nn no l np nq">oc get clusterrole edit -o yaml &gt; editrestricted.yaml</span></pre><p id="72aa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">一旦有了文件，您需要对其进行一些更改:</p><ul class=""><li id="cef1" class="mo mp iq jw b jx jy kb kc kf mq kj mr kn ms kr mt mu mv mw bi translated">更改对象的名称。我将角色的名称更改为editrestricted</li><li id="a74b" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">不仅要删除<em class="nc"> autoupdate </em>键，还要删除所有元数据(不包括对象名称),因为否则，您会发现由于对象的自动升级，角色修改不会被应用。你会得到这样的东西:</li></ul><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="92b1" class="nm lm iq ni b gy nn no l np nq">apiVersion: rbac.authorization.k8s.io/v1<br/>kind: ClusterRole<br/>metadata:<br/> name: editrestricted<br/>rules:<br/>- apiGroups:<br/>...</span></pre><ul class=""><li id="ccbb" class="mo mp iq jw b jx jy kb kc kf mq kj mr kn ms kr mt mu mv mw bi translated">删除所有出现“networkpolicies”的地方。在我的例子中，有5次出现，其中4次出现在键中，而networkpolicies是列表中的一个额外资源，因此我们只需要删除它，但是有一次出现在networkpolicies是唯一资源的情况下(检查下面)，在这种情况下，您需要删除完整的条目(您的键中不能有空的资源列表)</li></ul><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="bc81" class="nm lm iq ni b gy nn no l np nq">...<br/>- verbs:<br/>      - create<br/>      - delete<br/>      - deletecollection<br/>      - get<br/>      - list<br/>      - patch<br/>      - update<br/>      - watch<br/>    apiGroups:<br/>      - extensions<br/>      - networking.k8s.io<br/>    resources:<br/>      - networkpolicies<br/>  - verbs:<br/> ...</span></pre><p id="76dd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">完成所有这些修改后，您就可以创建对象了，在本例中，我将使用OC CLI:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="67c5" class="nm lm iq ni b gy nn no l np nq">oc create -f editrestricted.yaml</span></pre><p id="70c6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">4-修改默认命名空间创建模板，包括白名单容忍和默认网络策略</strong></p><p id="e0ad" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">作为集群管理员，您可以修改默认项目模板，以便使用您的自定义需求创建新项目。</p><p id="2985" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了在默认模板中执行修改，我们需要用配置创建一个新对象，然后在指向它的项目集群配置对象中配置<em class="nc"> projectRequestTemplate </em>键。</p><p id="437d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们用项目模板生成一个文件:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="04fa" class="nm lm iq ni b gy nn no l np nq">$ oc adm create-bootstrap-project-template -o yaml &gt; projecttemplate.yaml</span></pre><p id="09a2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后，我们在该文件中包含我们想要的配置。如您所见，如果您打开文件，模板是一个对象列表，当一个新项目被创建时，它将被创建。</p><p id="ce34" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">将有一个“项目”对象，我们将在其中包含注释，以防止来自用户的容差配置(请记住在此包含PODs使用的两个默认容差):</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="c802" class="nm lm iq ni b gy nn no l np nq">scheduler.alpha.kubernetes.io/tolerationsWhitelist: '[{"operator": "Exists", "effect": "NoExecute", "tolerationSeconds": 300, "key": "node.kubernetes.io/not-ready"},{"operator": "Exists", "effect": "NoExecute", "tolerationSeconds": 300, "key": "node.kubernetes.io/unreachable"}]'</span></pre><p id="07ad" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们还包括其他网络策略对象。在我们的示例中，有两个策略允许项目内POD流量和来自监控系统的访问(请记住，其他网络策略必须在项目创建后进行配置，具体取决于该项目是要创建“常规应用程序”还是“安全区域应用程序”)。</p><p id="77cb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">模板对象的第一部分(我们执行配置的地方)如下所示:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="be2a" class="nm lm iq ni b gy nn no l np nq">apiVersion: template.openshift.io/v1<br/>kind: Template<br/>metadata:<br/>  creationTimestamp: null<br/>  name: project-request<br/>objects:<br/><strong class="ni ir">- apiVersion: networking.k8s.io/v1<br/>  kind: NetworkPolicy<br/>  metadata:<br/>    name: allow-from-same-namespace<br/>  spec:<br/>    podSelector:<br/>    ingress:<br/>    - from:<br/>      - podSelector: {}<br/>- apiVersion: networking.k8s.io/v1<br/>  kind: NetworkPolicy<br/>  metadata:<br/>    name: allow-from-openshift-monitoring<br/>  spec:<br/>    ingress:<br/>    - from:<br/>      - namespaceSelector:<br/>          matchLabels:<br/>            network.openshift.io/policy-group: monitoring<br/>    podSelector: {}<br/>    policyTypes:<br/>    - Ingress<br/>- apiVersion: networking.k8s.io/v1<br/>  kind: NetworkPolicy<br/>  metadata:<br/>    name: allow-from-openshift-ingress<br/>  spec:<br/>    ingress:<br/>    - from:<br/>      - namespaceSelector:<br/>          matchLabels:<br/>            network.openshift.io/policy-group: ingress<br/>    podSelector: {}<br/>    policyTypes:<br/>    - Ingress<br/></strong>- apiVersion: project.openshift.io/v1<br/>  kind: Project<br/>  metadata:<br/>    annotations:<br/>      openshift.io/description: ${PROJECT_DESCRIPTION}<br/>      openshift.io/display-name: ${PROJECT_DISPLAYNAME}<br/>      openshift.io/requester: ${PROJECT_REQUESTING_USER}<br/><strong class="ni ir">      scheduler.alpha.kubernetes.io/tolerationsWhitelist: '[{"operator": "Exists", "effect": "NoExecute", "tolerationSeconds": 300, "key": "node.kubernetes.io/not-ready"},{"operator": "Exists", "effect": "NoExecute", "tolerationSeconds": 300, "key": "node.kubernetes.io/unreachable"}]'</strong><br/>    creationTimestamp: null<br/>    name: ${PROJECT_NAME}<br/>  spec: {}<br/>  status: {}<br/>...</span></pre><p id="77b2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们已经准备好了对象，现在需要在“openshift-config”名称空间下创建它:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="2b49" class="nm lm iq ni b gy nn no l np nq">$ oc create -f projecttemplate.yaml -n openshift-config</span></pre><p id="c2ed" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">一旦在OpenShift集群中创建了对象，我们仍然需要在项目集群配置中引用它:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="e7f8" class="nm lm iq ni b gy nn no l np nq">oc edit project.config.openshift.io/cluster</span></pre><p id="d0d1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们在<em class="nc">规范</em>中包含了我们已经配置好的项目请求模板名称:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="de57" class="nm lm iq ni b gy nn no l np nq">...<br/>spec:<br/>  projectRequestTemplate:<br/>    name: project-request</span></pre><p id="bc3c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">完成，现在每次创建新项目时，命名空间都将包含注释，并且将创建两个网络策略。</p><p id="f6dd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">请记住，还有其他配置没有包含在默认模板中，例如，标签<em class="nc"> securityzone= secure </em>，以及只有在允许名称空间使用安全区域的情况下才必须包含的默认容差。</p><h1 id="9710" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated"><strong class="ak">配置测试(限制区域使用)</strong></h1><p id="5a69" class="pw-post-body-paragraph ju jv iq jw b jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr ij bi translated">作为集群管理员，我将创建两个名称空间，并将它们附加到我们创建的不同用户组:</p><ul class=""><li id="4ea2" class="mo mp iq jw b jx jy kb kc kf mq kj mr kn ms kr mt mu mv mw bi translated">"<em class="nc">RBAC-常规</em>"命名空间附加到"<em class="nc">常规用户</em>"组</li><li id="c1f9" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">"<em class="nc">RBAC-安全</em>命名空间附加到"<em class="nc"> securezoneusers </em>"组</li></ul><p id="d52c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我为常规用户测试创建项目:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="5dc0" class="nm lm iq ni b gy nn no l np nq">oc new-project rbac-regular</span></pre><p id="db25" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">此时，我们可以检查名称空间中是否包含了<em class="nc"> tolerationsWhitelist </em>注释:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="4a76" class="nm lm iq ni b gy nn no l np nq">$ oc get namespace rbac-regular -o yaml | grep tolerations</span><span id="25dc" class="nm lm iq ni b gy nv no l np nq">    scheduler.alpha.kubernetes.io/tolerationsWhitelist: '[{"operator": "Exists", "effect":<br/>          f:scheduler.alpha.kubernetes.io/tolerationsWhitelist: {}</span></pre><p id="7c3c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">并且两个网络策略与每个项目相关联:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="6ee0" class="nm lm iq ni b gy nn no l np nq">$ oc get networkpolicies.networking.k8s.io -n rbac-regular</span><span id="fe89" class="nm lm iq ni b gy nv no l np nq">NAME                              POD-SELECTOR   AGE<br/>allow-from-openshift-monitoring   &lt;none&gt;         23s<br/>allow-from-same-namespace         &lt;none&gt;         23s<br/>allow-from-openshift-ingress      &lt;none&gt;         23s</span></pre><p id="ebf4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我还将创建一个项目来测试安全区域允许的用户:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="1fe2" class="nm lm iq ni b gy nn no l np nq">oc new-project rbac-secure</span></pre><p id="8df2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">由于该项目将被允许使用安全区域，我们需要在默认设置中包含一些手动配置:</p><ul class=""><li id="eef1" class="mo mp iq jw b jx jy kb kc kf mq kj mr kn ms kr mt mu mv mw bi translated">更改<em class="nc">容忍白名单</em> <strong class="jw ir"> </strong>注释，以允许使用安全区域所需的容忍</li><li id="f18f" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">(可选)包含一个<em class="nc">default tolerations</em><strong class="jw ir"/>注释，这样用户就不需要在他们的kubernetes对象中包含容忍配置</li><li id="8bb0" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">(可选)包含默认的nodeSelector注释，这样用户就不需要在他们的对象中包含正确的nodeSelector。如果您配置了默认的nodeSelector，那么名称空间将只包含带有该标签的工作者组，因为所有部署都将包含这样的nodeSelector。如果您想让命名空间在两个区域中创建应用程序，请不要包括它(对于其他用例，如“不受信任的用户区域”将是一个要求)。</li><li id="1ab8" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">在名称空间中包含标签<em class="nc"> securityzone= secure </em></li></ul><p id="3a9b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们可以在注释中包含我们正在使用的容差，但是由于我没有更多必须限制的组或容差，因此我将为该测试做的只是从名称空间<em class="nc"> rbac-secure </em>对象中删除<em class="nc">容差白名单</em>注释，这将使该名称空间中的用户能够使用他们需要的任何容差。</p><p id="1902" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们还将默认包含安全区域的容错，因此用户只需在他们的部署中使用<em class="nc"> nodeSelector </em>(即使他们没有指定，容错也将始终被配置)。</p><p id="fab6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">用粗体文本检查名称空间对象中的更改:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="600d" class="nm lm iq ni b gy nn no l np nq">apiVersion: v1<br/>kind: Namespace<br/>metadata:<br/><strong class="ni ir">  labels:<br/>    securityzone: secure</strong><br/>  annotations:<br/>    openshift.io/description: ""<br/>    openshift.io/display-name: ""<br/>    openshift.io/requester: system:admin<br/>    openshift.io/sa.scc.mcs: s0:c27,c9<br/>    openshift.io/sa.scc.supplemental-groups: 1000720000/10000<br/>    openshift.io/sa.scc.uid-range: 1000720000/10000<br/>    <strong class="ni ir">openshift.io/node-selector: node-role.kubernetes.io/secure-worker=<br/>    scheduler.alpha.kubernetes.io/defaultTolerations: '[{"Key": "securityzone", "Operator":"Equal", "Value": "secure", "effect": "NoSchedule"}]'</strong><br/>  creationTimestamp: "2020-07-21T07:18:06Z"<br/>  managedFields:<br/>...</span></pre><p id="fd63" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">一旦我们有了项目/名称空间，作为clusteradmin，我们就可以将权限分配给我们已经创建的用户组，赋予他们在配置步骤中生成的角色editrestricted:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="8177" class="nm lm iq ni b gy nn no l np nq">$  oc adm policy add-role-to-group editrestricted regularusers -n rbac-regular</span><span id="103f" class="nm lm iq ni b gy nv no l np nq">clusterrole.rbac.authorization.k8s.io/editrestricted added: "regularusers"</span><span id="7c51" class="nm lm iq ni b gy nv no l np nq">$ oc adm policy add-role-to-group editrestricted securezoneusers -n rbac-secure</span><span id="2e96" class="nm lm iq ni b gy nv no l np nq">clusterrole.rbac.authorization.k8s.io/editrestricted added: "securezoneusers"</span></pre><p id="1d5f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">绑定已配置，让我们运行这些测试(区域之间的网络连接保护已经在之前关于网络配置的帖子中测试过):</p><ul class=""><li id="06d3" class="mo mp iq jw b jx jy kb kc kf mq kj mr kn ms kr mt mu mv mw bi translated">作为用户，我将尝试创建一个新的项目/名称空间，但应该会失败。</li><li id="8f6d" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">作为用户，我将尝试删除/创建网络策略，但应该会失败。</li><li id="a5ab" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">作为regularusers组的用户，我将在常规区域创建一个应用程序，它应该会成功。</li><li id="4bf6" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">作为regularusers组的用户，我将在安全区域创建一个应用程序，但它应该会失败。</li><li id="f422" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">作为securezoneusers组的用户，我将在常规区域创建一个应用程序，应该会成功。</li><li id="cfbb" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">作为securezoneusers组的用户，我将在安全区域创建一个应用程序，应该会成功。</li></ul><p id="e50b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">1-作为用户，我将尝试创建一个新项目/名称空间，但应该会失败。</strong></p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="5a30" class="nm lm iq ni b gy nn no l np nq">$ oc login</span><span id="947c" class="nm lm iq ni b gy nv no l np nq">Authentication required for <a class="ae nw" href="https://api.ocp.136.243.40.222.nip.io:6443" rel="noopener ugc nofollow" target="_blank">https://api.ocp.136.243.40.222.nip.io:6443</a> (openshift)<br/>Username: user1<br/>Password: <br/>Login successful.</span><span id="3f52" class="nm lm iq ni b gy nv no l np nq">You have one project on this server: "default"</span><span id="2067" class="nm lm iq ni b gy nv no l np nq">Using project "default".</span><span id="515a" class="nm lm iq ni b gy nv no l np nq">$ oc new-project hola<br/>Error from server (Forbidden): You may not request a new project via this API.</span></pre><p id="b387" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">2-作为用户，我将尝试删除/创建网络策略，但应该会失败。</strong></p><p id="1bf9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">作为rbac-regular项目中的用户1，我尝试列出网络策略:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="67bd" class="nm lm iq ni b gy nn no l np nq">$ oc get networkpolicy</span><span id="9465" class="nm lm iq ni b gy nv no l np nq">Error from server (Forbidden): networkpolicies.networking.k8s.io is forbidden: User "user1" cannot list resource "networkpolicies" in API group "networking.k8s.io" in the namespace "rbac-regular"</span></pre><p id="d34a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我假设用户知道默认网络工作策略的名称，并试图删除一个:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="4f48" class="nm lm iq ni b gy nn no l np nq">$ oc delete networkpolicies allow-from-same-namespace</span><span id="9461" class="nm lm iq ni b gy nv no l np nq">Error from server (Forbidden): networkpolicies.networking.k8s.io "allow-from-same-namespace" is forbidden: User "user1" cannot delete resource "networkpolicies" in API group "networking.k8s.io" in the namespace "rbac-regular"</span></pre><p id="127f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我还尝试创建一个新的网络策略:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="96f3" class="nm lm iq ni b gy nn no l np nq">$ oc create -f - &lt;&lt; EOF<br/>&gt; apiVersion: networking.k8s.io/v1<br/>&gt; kind: NetworkPolicy<br/>&gt; metadata:<br/>&gt;   name: allow-from-openshift-ingress<br/>&gt; spec:<br/>&gt;   ingress:<br/>&gt;   - from:<br/>&gt;     - namespaceSelector:<br/>&gt;         matchLabels:<br/>&gt;           network.openshift.io/policy-group: ingress<br/>&gt;   podSelector: {}<br/>&gt;   policyTypes:<br/>&gt;   - Ingress<br/>&gt; EOF</span><span id="4732" class="nm lm iq ni b gy nv no l np nq">Error from server (Forbidden): error when creating "STDIN": networkpolicies.networking.k8s.io is forbidden: User "user1" cannot create resource "networkpolicies" in API group "networking.k8s.io" in the namespace "rbac-regular"</span></pre><p id="efcf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">3-作为regularusers组的用户，我将在常规区域创建一个应用程序，它应该会成功。</strong></p><p id="27f1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">作为rbac-regular项目中的用户1，我尝试创建此POD:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="0e84" class="nm lm iq ni b gy nn no l np nq">apiVersion: v1<br/>kind: Pod<br/>metadata:<br/>  namespace: rbac-regular<br/>  name: test-regular<br/>  labels:<br/>    app: test-regular<br/>spec:<br/>  containers:<br/>  - name: test<br/>    image: centos/tools<br/>    command: ["/bin/bash", "-c", "sleep 9000000"]</span></pre><p id="3f8f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是允许的，并且pod运行在常规区域:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="4be3" class="nm lm iq ni b gy nn no l np nq">$ oc get pod -o wide -n rbac-regular  | grep test | awk {'print $1" " $7'} | column -t</span><span id="eac4" class="nm lm iq ni b gy nv no l np nq">test-regular  worker0.ocp.136.243.40.222.nip.io</span></pre><p id="e2e3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">4-作为regularusers组的用户，我将在安全区域创建一个应用程序，但应该会失败。</strong></p><p id="d02a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">作为rbac-regular项目中的用户1，我尝试创建此POD:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="0ef2" class="nm lm iq ni b gy nn no l np nq">apiVersion: v1<br/>kind: Pod<br/>metadata:<br/>  namespace: rbac-regular<br/>  name: test-secure<br/>  labels:<br/>    app: test-secure<br/>spec:<br/>  containers:<br/>  - name: test-secure-tole<br/>    image: centos/tools<br/>    command: ["/bin/bash", "-c", "sleep 9000000"]<br/>  tolerations:<br/>    - key: "securityzone"<br/>      operator: "Equal"<br/>      value: "secure"<br/>      effect: "NoSchedule"<br/>  nodeSelector:<br/>    node-role.kubernetes.io/secure-worker: ''</span></pre><p id="349a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">不允许显示此错误:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="eef8" class="nm lm iq ni b gy nn no l np nq">pod tolerations (possibly merged with namespace default tolerations) conflict with its namespace whitelist</span></pre><p id="5008" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">作为securezoneusers组的用户，我将在常规区域创建一个应用程序，应该会成功。</p><p id="0278" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">作为rbac-secure项目中的用户8，我尝试创建此POD:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="47b8" class="nm lm iq ni b gy nn no l np nq">apiVersion: v1<br/>kind: Pod<br/>metadata:<br/>  namespace: rbac-secure<br/>  name: test-regular<br/>  labels:<br/>    app: test-regular<br/>spec:<br/>  containers:<br/>  - name: test<br/>    image: centos/tools<br/>    command: ["/bin/bash", "-c", "sleep 9000000"]</span></pre><p id="6b6a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是允许的，并且pod运行在常规区域:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="2f75" class="nm lm iq ni b gy nn no l np nq">$ oc get pod -o wide -n rbac-secure  | grep test | awk {'print $1" " $7'} | column -t</span><span id="9a33" class="nm lm iq ni b gy nv no l np nq">test-regular  worker0.ocp.136.243.40.222.nip.i</span></pre><p id="0dfe" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">6-作为securezoneusers组的用户，我将在安全区域创建一个应用程序，它应该会成功。</strong></p><p id="1bec" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">作为rbac-secure项目中的用户8，我尝试创建这个POD(请记住，我没有在POD定义中包含<em class="nc">容错</em>或<em class="nc">节点选择器</em>，因为我们强制将其默认包含在名称空间对象中)</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="6715" class="nm lm iq ni b gy nn no l np nq">apiVersion: v1<br/>kind: Pod<br/>metadata:<br/>  namespace: rbac-secure<br/>  name: test-secure<br/>  labels:<br/>    app: test-secure<br/>spec:<br/>  containers:<br/>  - name: test-secure-tole<br/>    image: centos/tools<br/>    command: ["/bin/bash", "-c", "sleep 9000000"]</span></pre><p id="56e2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">它是允许的，并且在安全区域workers中运行(记住总是默认为worker4，因为worker2和worker3有一个<em class="nc">preferno schedule</em>tain):</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="6b40" class="nm lm iq ni b gy nn no l np nq">$ oc get pod -o wide -n rbac-secure  | grep test | awk {'print $1" " $7'} | column -t</span><span id="d8c4" class="nm lm iq ni b gy nv no l np nq">test-regular  worker0.ocp.136.243.40.222.nip.io<br/>test-secure   worker4.ocp.136.243.40.222.nip.io</span></pre><p id="ece1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们可以检查安全区域容差以及群集默认容差:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="3b92" class="nm lm iq ni b gy nn no l np nq">...</span><span id="7ef4" class="nm lm iq ni b gy nv no l np nq">tolerations:<br/>  - effect: NoExecute<br/>    key: node.kubernetes.io/not-ready<br/>    operator: Exists<br/>    tolerationSeconds: 300<br/>  - effect: NoExecute<br/>    key: node.kubernetes.io/unreachable<br/>    operator: Exists<br/>    tolerationSeconds: 300<br/>  - effect: NoSchedule<br/>    key: securityzone<br/>    operator: Equal<br/>    value: secure<br/>...</span></pre><h1 id="ebbc" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">搞定了。，让我们回顾一下我们执行的步骤</h1><p id="a952" class="pw-post-body-paragraph ju jv iq jw b jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr ij bi translated">我们完了！，让我们回顾一下我们遵循的步骤，但首先，看一下我们配置的体系结构:</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div class="ab gu cl nx"><img src="../Images/6a83a8c4d9008a9dbc556d0b6b9d8035.png" data-original-src="https://miro.medium.com/v2/format:webp/1*WQlR8BXVZJd4BTKhiys4dA.png"/></div></figure><p id="0faa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">第0步。静态IPs </strong></p><p id="8453" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">创建新节点时配置静态IP，包括安全区域访问网络<a class="ae nw" href="https://docs.openshift.com/container-platform/4.5/installing/installing_bare_metal/installing-bare-metal.html#installation-user-infra-machines-static-network_installing-bare-metal" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="0ab6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">第一步。给新区域的所有工人贴上标签并污染他们</strong></p><p id="593e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您需要在位于该区域的所有员工中包含一个新标签(我选择创建一个新的“角色”):</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="764c" class="nm lm iq ni b gy nn no l np nq">oc label node &lt;newzoneworker&gt; node-role.kubernetes.io/secure-worker=''</span></pre><p id="70ff" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因为我创建了一个新角色，所以我删除了这些workers中的默认角色:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="61d5" class="nm lm iq ni b gy nn no l np nq">oc label node &lt;newzoneworker&gt; node-role.kubernetes.io/worker-</span></pre><p id="c468" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">创建污点以防止工作负载被安排到新区域，除非您配置了特定的容差:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="58fe" class="nm lm iq ni b gy nn no l np nq">oc adm taint node worker2.ocp.136.243.40.222.nip.io securityzone=secure:NoSchedule</span></pre><p id="312c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">第二步。给新区域的“进入”工人贴上标签并进行污染</strong></p><p id="34a2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在IngressController将位于的工作线程(可以访问安全区域访问网络的线程)中，我添加了一个额外的标签和污点:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="f6d5" class="nm lm iq ni b gy nn no l np nq">oc label node worker2.ocp.136.243.40.222.nip.io ingressaccess=true</span></pre><p id="7ea0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是因为如果可能的话，我们不希望在这些节点上安排任何工作负载:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="8d4d" class="nm lm iq ni b gy nn no l np nq">oc adm taint node worker2.ocp.136.243.40.222.nip.io ingressaccess=true:PreferNoSchedule</span></pre><p id="aebd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">第三步。为新角色创建一个新的MachineConfigPool</strong></p><p id="2054" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因为我们创建了一个新角色，所以我们需要创建一个新的MachineConfigPool，以便允许在这些节点中进行升级:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="583f" class="nm lm iq ni b gy nn no l np nq">apiVersion: machineconfiguration.openshift.io/v1<br/>kind: MachineConfigPool<br/>metadata:<br/>  name: secure-worker<br/>spec:<br/>  machineConfigSelector:<br/>    matchExpressions:<br/>      - {key: machineconfiguration.openshift.io/role, operator: In, values: [worker,secure-worker]}<br/>  nodeSelector:<br/>    matchLabels:<br/>      node-role.kubernetes.io/secure-worker: ""<br/>  paused: false</span></pre><p id="eb15" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">步骤四。创建一个新的Ingres controller</strong></p><p id="fb32" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">创建一个新的IngressController，包括一个namespaceSelector，以确保我们可以选择要使用的入口。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="d53d" class="nm lm iq ni b gy nn no l np nq">apiVersion: operator.openshift.io/v1<br/>kind: IngressController<br/>metadata:<br/>  name: secure-ingress<br/>  namespace: openshift-ingress-operator<br/>spec:<br/>  endpointPublishingStrategy:<br/>    type: HostNetwork <br/>  domain: secureapps.ocp.136.243.40.222.nip.io<br/>  replicas: 2<br/>  nodePlacement:<br/>    nodeSelector:<br/>      matchLabels:<br/>        node-role.kubernetes.io/secure-worker: ""<br/>        ingressaccess: "true"<br/>  namespaceSelector:<br/>    matchExpressions:<br/>      - key: securityzone<br/>        operator: In<br/>        values:<br/>        - secure</span></pre><p id="ecd8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">由于我们希望在使用安全Ingres controller时不使用默认的Ingres controller，因此我们在默认Ingres controller中配置了相反的选择器</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="e72f" class="nm lm iq ni b gy nn no l np nq">oc edit ingresscontrollers.operator.openshift.io -n openshift-ingress-operator default</span><span id="8dc1" class="nm lm iq ni b gy nv no l np nq">...<br/>spec:<br/><strong class="ni ir">  namespaceSelector:<br/>    matchExpressions:<br/>    - key: securityzone<br/>      operator: DoesNotExist</strong><br/>...</span></pre><p id="2ee8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后，因为新的IngressControllers将在SecureZone workers上运行，所以您必须在openshift-ingress名称空间中包含Tolaration</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="9648" class="nm lm iq ni b gy nn no l np nq">oc edit namespace openshift-ingress</span><span id="918e" class="nm lm iq ni b gy nv no l np nq">...<br/>  annotations:<br/>    openshift.io/node-selector: ''<br/>    openshift.io/sa.scc.mcs: 's0:c24,c4'<br/>    openshift.io/sa.scc.supplemental-groups: 1000560000/10000<br/>    openshift.io/sa.scc.uid-range: 1000560000/10000<br/><strong class="ni ir">    scheduler.alpha.kubernetes.io/defaultTolerations: '[{"Key": "securityzone", "Operator":"Equal", "Value": "secure", "effect": "NoSchedule"}]'</strong><br/>  managedFields:<br/> ...</span></pre><p id="a59f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">第五步。在默认命名空间中包含一个标签，以允许访问控制器流量</strong></p><p id="3cca" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">由于我们的新IngressController使用主机网络访问，我们必须在默认命名空间中包含此标签，以便配置所需的网络策略</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="3ce2" class="nm lm iq ni b gy nn no l np nq">oc edit namespace default</span><span id="7487" class="nm lm iq ni b gy nv no l np nq">apiVersion: v1<br/>kind: Namespace<br/>metadata:<br/><strong class="ni ir">  labels:<br/>    network.openshift.io/policy-group: ingress</strong><br/>  annotations:<br/>...</span></pre><p id="5add" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">第六步。移除自供应项目</strong></p><p id="af00" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">不要让用户创建他们自己的项目/名称空间:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="4a8d" class="nm lm iq ni b gy nn no l np nq">$ oc patch clusterrolebinding.rbac self-provisioners -p '{"subjects": null}'</span></pre><p id="a6e3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">删除可能会将群集角色重置为默认状态的自动更新:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="991a" class="nm lm iq ni b gy nn no l np nq">$ oc patch clusterrolebinding.rbac self-provisioners -p ‘{ “metadata”: { “annotations”: { “rbac.authorization.kubernetes.io/autoupdate”: “false” } } }’</span></pre><p id="e539" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">第七步。修改项目创建模板</strong></p><p id="8cda" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">生成项目创建模板:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="6ddb" class="nm lm iq ni b gy nn no l np nq">$ oc adm create-bootstrap-project-template -o yaml &gt; projecttemplate.yaml</span></pre><p id="06fb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在项目中包括默认的NetworkPolicy对象和注释，以限制用户可以配置的容忍度:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="1047" class="nm lm iq ni b gy nn no l np nq">apiVersion: template.openshift.io/v1<br/>kind: Template<br/>metadata:<br/>  creationTimestamp: null<br/>  name: project-request<br/>objects:<br/><strong class="ni ir">- apiVersion: networking.k8s.io/v1<br/>  kind: NetworkPolicy<br/>  metadata:<br/>    name: allow-from-same-namespace<br/>  spec:<br/>    podSelector:<br/>    ingress:<br/>    - from:<br/>      - podSelector: {}<br/>- apiVersion: networking.k8s.io/v1<br/>  kind: NetworkPolicy<br/>  metadata:<br/>    name: allow-from-openshift-monitoring<br/>  spec:<br/>    ingress:<br/>    - from:<br/>      - namespaceSelector:<br/>          matchLabels:<br/>            network.openshift.io/policy-group: monitoring<br/>    podSelector: {}<br/>    policyTypes:<br/>    - Ingress<br/>- apiVersion: networking.k8s.io/v1<br/>  kind: NetworkPolicy<br/>  metadata:<br/>    name: allow-from-openshift-ingress<br/>  spec:<br/>    ingress:<br/>    - from:<br/>      - namespaceSelector:<br/>          matchLabels:<br/>            network.openshift.io/policy-group: ingress<br/>    podSelector: {}<br/>    policyTypes:<br/>    - Ingress<br/></strong>- apiVersion: project.openshift.io/v1<br/>  kind: Project<br/>  metadata:<br/>    annotations:<br/>      openshift.io/description: ${PROJECT_DESCRIPTION}<br/>      openshift.io/display-name: ${PROJECT_DISPLAYNAME}<br/>      openshift.io/requester: ${PROJECT_REQUESTING_USER}<br/><strong class="ni ir">      scheduler.alpha.kubernetes.io/tolerationsWhitelist: '[{"operator": "Exists", "effect": "NoExecute", "tolerationSeconds": 300, "key": "node.kubernetes.io/not-ready"},{"operator": "Exists", "effect": "NoExecute", "tolerationSeconds": 300, "key": "node.kubernetes.io/unreachable"}]'</strong><br/>    creationTimestamp: null<br/>    name: ${PROJECT_NAME}<br/>  spec: {}<br/>  status: {}<br/>...</span></pre><p id="d004" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">准备好模板后，在openshift-config名称空间中创建它:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="c75a" class="nm lm iq ni b gy nn no l np nq">$ oc create -f projecttemplate.yaml -n openshift-config</span></pre><p id="f9da" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后，您需要在集群项目配置对象中添加对此模板的引用:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="7bc0" class="nm lm iq ni b gy nn no l np nq">oc edit project.config.openshift.io/cluster</span></pre><p id="8cc7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查粗体文本中的更改:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="25ec" class="nm lm iq ni b gy nn no l np nq">...<br/>spec:<br/>  projectRequestTemplate:<br/>    name: project-request</span></pre><p id="8a24" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">第八步。创建用户组</strong></p><p id="e9c1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我创建了两个组，每个区域一个(但是您可以创建任意多个)</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="a2da" class="nm lm iq ni b gy nn no l np nq">oc adm groups new &lt;zone1-users&gt; &lt;user1&gt; &lt;user2&gt; ... &lt;usern&gt;</span><span id="7af3" class="nm lm iq ni b gy nv no l np nq">oc adm groups new &lt;zone2-users&gt; &lt;usera&gt; &lt;userb&gt; ... &lt;userx&gt;</span></pre><p id="820d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">第九步。创建一个限制网络策略管理的新角色</strong></p><p id="1d7f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">创建一个无权访问网络策略管理的新角色。我基于默认的“编辑”角色创建了一个</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="2e14" class="nm lm iq ni b gy nn no l np nq">oc get clusterrole edit -o yaml &gt; editrestricted.yaml</span></pre><p id="867e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在那个文件里</p><ul class=""><li id="8652" class="mo mp iq jw b jx jy kb kc kf mq kj mr kn ms kr mt mu mv mw bi translated">更改对象的名称。</li><li id="566b" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">移除除名称之外的所有元数据</li><li id="a42d" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">删除所有出现“networkpolicies”的地方。</li></ul><p id="9744" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">完成所有这些修改后，您就可以创建对象了，在本例中，我将使用OC CLI:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="24e2" class="nm lm iq ni b gy nn no l np nq">oc create -f editrestricted.yaml</span></pre><p id="8f3d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">第十步。创建名称空间并分配用户和角色</strong></p><p id="acea" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">无需进一步配置，即可使用此命令创建常规区域项目:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="248e" class="nm lm iq ni b gy nn no l np nq">oc new-project &lt;project name&gt;</span></pre><p id="1210" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对于安全区域中允许的项目，需要对名称空间对象执行一些额外的步骤:</p><ul class=""><li id="bfc3" class="mo mp iq jw b jx jy kb kc kf mq kj mr kn ms kr mt mu mv mw bi translated">添加一个标签以选择IngressController(示例中的<em class="nc"> securityzone= secure </em>)</li><li id="1801" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">移除<em class="nc">容忍白名单</em> <strong class="jw ir"> </strong>注释</li><li id="9d15" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">(可选)包含一个<em class="nc">default tolerations</em><strong class="jw ir"/>注释，这样用户就不需要在部署中包含容忍配置，如果他们不想这样做的话</li><li id="7ba3" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">(可选)在注释中包含一个默认的nodeSelector，这样用户就不需要在他们的部署对象中包含它。如果您配置了默认的nodeSelector，那么名称空间将只包含带有该标签的工作者组，因为所有部署都将包含这样的nodeSelector。如果您想让命名空间在两个区域中创建应用程序，请不要包括它(对于其他用例，如“不受信任的用户区域”将是一个要求)。</li></ul><p id="1f79" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你可以在这里看到一个例子:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="b622" class="nm lm iq ni b gy nn no l np nq">apiVersion: v1<br/>kind: Namespace<br/>metadata:<br/><strong class="ni ir">  labels:<br/>    securityzone: secure</strong><br/>  annotations:<br/>    openshift.io/description: ""<br/>    openshift.io/display-name: ""<br/>    openshift.io/requester: system:admin<br/>    openshift.io/sa.scc.mcs: s0:c27,c9<br/>    openshift.io/sa.scc.supplemental-groups: 1000720000/10000<br/>    openshift.io/sa.scc.uid-range: 1000720000/10000<br/>    <strong class="ni ir">openshift.io/node-selector: node-role.kubernetes.io/secure-worker=</strong><br/>    <strong class="ni ir">scheduler.alpha.kubernetes.io/defaultTolerations: '[{"Key": "securityzone", "Operator":"Equal", "Value": "secure", "effect": "NoSchedule"}]'</strong><br/>  creationTimestamp: "2020-07-21T07:18:06Z"<br/>  managedFields:<br/>...</span></pre><p id="af54" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">通过添加我们已经创建的附加到名称空间的角色，授予用户(或用户组)访问权限。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="9d0b" class="nm lm iq ni b gy nn no l np nq">oc adm policy add-role-to-group &lt;new role created&gt; &lt;group&gt; -n &lt;namespace&gt;</span></pre><p id="e31c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">第十一步。为木尔图斯</strong>创建额外的网络</p><p id="78e4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在集群网络运营商对象中包括<em class="nc">附加网络</em>密钥</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="e559" class="nm lm iq ni b gy nn no l np nq">oc edit networks.operator.openshift.io cluster</span></pre><p id="7598" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在<em class="nc">附加网络密钥中，您必须指定:</em></p><ul class=""><li id="d42e" class="mo mp iq jw b jx jy kb kc kf mq kj mr kn ms kr mt mu mv mw bi translated">您允许使用VLAN命名空间</li><li id="8e68" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">插件类型</li><li id="b845" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">主界面</li><li id="e745" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">IPAM构型</li></ul><p id="4902" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">例如:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="345d" class="nm lm iq ni b gy nn no l np nq">...<br/>spec:<br/><strong class="ni ir">  additionalNetworks:<br/>    - name: test-vlan<br/>      namespace: test-securezone<br/>      rawCNIConfig: '{ "cniVersion": "0.3.1", "type": "macvlan", "capabilities": { "ips": true }, "master": "ens4", "mode": "bridge", "ipam": { "type": "static" } }'<br/>      type: Raw</strong><br/>  clusterNetwork:<br/>...</span></pre><p id="d45e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">第十二步。到无限远处</strong></p><p id="e76d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">添加您认为对您有意义的任何配置，例如，您可以有不同的存储类，在我们的示例中，我们可以为安全区域添加一个专用的存储类，然后限制其仅用于该区域中应用程序的PV。天空是极限。</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nz oa di ob bf oc"><div class="gh gi ny"><img src="../Images/d8913ae774d53f819d470011e9c3eaae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*01LrtIfzm5mZ0mAB.png"/></div></div></figure><blockquote class="od"><p id="39db" class="oe of iq bd og oh oi oj ok ol om kr dk translated"><em class="on">以防万一你想重新开始，或者回顾配置安全区域所执行的任何步骤:</em></p></blockquote><div class="oo op oq or os kv"><a href="https://medium.com/@luis.ariz/security-zones-in-openshift-worker-nodes-part-i-introduction-4f85762962d7" rel="noopener follow" target="_blank"><div class="kw ab fo"><div class="kx ab ky cl cj kz"><h2 class="bd ir gy z fp la fr fs lb fu fw ip bi translated">OpenShift工作节点中的安全区域—第一部分—简介</h2><div class="lc l"><h3 class="bd b gy z fp la fr fs lb fu fw dk translated">在这个系列文章中，您将看到如何将OpenShift工作人员分成多个安全区域。</h3></div><div class="ld l"><p class="bd b dl z fp la fr fs lb fu fw dk translated">medium.com</p></div></div><div class="le l"><div class="ot l lg lh li le lj js kv"/></div></div></a></div><div class="ks kt gp gr ku kv"><a href="https://medium.com/@luis.ariz/security-zones-in-openshift-worker-nodes-part-ii-grouping-workers-8e97f1d601ba" rel="noopener follow" target="_blank"><div class="kw ab fo"><div class="kx ab ky cl cj kz"><h2 class="bd ir gy z fp la fr fs lb fu fw ip bi translated">OpenShift工人节点中的安全区域—第二部分—工人分组</h2><div class="lc l"><h3 class="bd b gy z fp la fr fs lb fu fw dk translated">这是本系列的第二部分，我们将配置两组不同的工作人员。</h3></div><div class="ld l"><p class="bd b dl z fp la fr fs lb fu fw dk translated">medium.com</p></div></div><div class="le l"><div class="lf l lg lh li le lj js kv"/></div></div></a></div><div class="ks kt gp gr ku kv"><a href="https://medium.com/@luis.ariz/security-zones-in-openshift-worker-nodes-part-iii-network-configuration-3a887854a4d" rel="noopener follow" target="_blank"><div class="kw ab fo"><div class="kx ab ky cl cj kz"><h2 class="bd ir gy z fp la fr fs lb fu fw ip bi translated">OpenShift工作节点中的安全区域—第三部分—网络配置</h2><div class="lc l"><h3 class="bd b gy z fp la fr fs lb fu fw dk translated">在本帖中，我们将重点讨论在我们的安全系统中分离入站和出站流量所需的网络配置…</h3></div><div class="ld l"><p class="bd b dl z fp la fr fs lb fu fw dk translated">medium.com</p></div></div><div class="le l"><div class="lk l lg lh li le lj js kv"/></div></div></a></div></div></div>    
</body>
</html>