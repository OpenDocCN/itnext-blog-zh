<html>
<head>
<title>Building A Node CMS With KeystoneJS, Mongo DB, React and Redux — Part III</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用KeystoneJS、Mongo DB、React和Redux构建节点CMS第三部分</h1>
<blockquote>原文：<a href="https://itnext.io/building-a-node-cms-with-keystonejs-mongo-db-react-and-redux-part-iii-4c8b991cc3f?source=collection_archive---------3-----------------------#2018-03-18">https://itnext.io/building-a-node-cms-with-keystonejs-mongo-db-react-and-redux-part-iii-4c8b991cc3f?source=collection_archive---------3-----------------------#2018-03-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="cd33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">添加Redux</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/0c5dffa29bdd25adbd6b531d2da95d95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XaKOIw69lqg1pu6LxEAkvw.png"/></div></div></figure><blockquote class="kx ky kz"><p id="e0d7" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated"><a class="ae le" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fitnext.io%2Fbuilding-a-node-cms-with-keystonejs-mongo-db-react-and-redux-part-iii-4c8b991cc3f" rel="noopener ugc nofollow" target="_blank">点击这里在LinkedIn上分享这篇文章</a></p></blockquote><p id="cb19" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="la">如果你想看这个项目的最终版本，你可以从</em> <a class="ae le" href="https://github.com/Colour-Full/medium-keystone-react-cms" rel="noopener ugc nofollow" target="_blank"> <em class="la"> github </em> </a>获得回购</p><p id="a526" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">欢迎阅读本系列的第三章，也是最后一章。在<a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/building-a-node-cms-with-keystonejs-mongo-db-react-and-redux-part-i-ae5958496df2">第一部分</a>中，我们成功安装了Keystone Js，在<a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/building-a-node-cms-with-keystonejs-mongo-db-react-and-redux-part-ii-842a85ebd9f7">第二部分</a>中，我们添加了React，现在我们将让它们与Redux进行通信。</p><p id="37c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在Redux可能会有点混乱，所以如果你以前没有这方面的经验，我强烈建议你观看Redux的创造者Dan Abramov的视频课程:</p><div class="lf lg gp gr lh li"><a href="https://egghead.io/courses/getting-started-with-redux" rel="noopener  ugc nofollow" target="_blank"><div class="lj ab fo"><div class="lk ab ll cl cj lm"><h2 class="bd ir gy z fp ln fr fs lo fu fw ip bi translated">Redux入门</h2><div class="lp l"><h3 class="bd b gy z fp ln fr fs lo fu fw dk translated">Redux为管理React应用程序中的状态提供了一个可靠、稳定和成熟的解决方案。通过一把…</h3></div><div class="lq l"><p class="bd b dl z fp ln fr fs lo fu fw dk translated">蛋头</p></div></div><div class="lr l"><div class="ls l lt lu lv lr lw kv li"/></div></div></a></div><p id="9d4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有许多工作要做，所以我们最好现在就开始。</p><p id="9d00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们将安装redux和react-redux</p><pre class="km kn ko kp gt lx ly lz ma aw mb bi"><span id="34bd" class="mc md iq ly b gy me mf l mg mh">npm install redux react-redux</span></pre><p id="311c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们将在客户端文件夹中添加几个子文件夹。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/992fa1e08a199e56e1fd00e835676c02.png" data-original-src="https://miro.medium.com/v2/resize:fit:434/format:webp/1*eQvQxrMXzp-psrC1rXl4Xg.png"/></div></figure><p id="7538" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将在后面逐一介绍，但首先，我们需要在客户机上更新index.jsx。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="8d2c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们继续之前，我想回到服务器。如果你看过一些关于Redux的教程，你可能会注意到它们通常处理从REST API获取数据。我们将做完全相同的事情，但是使用Keystone API。Keystone提供了一个RESTful API，但不幸的是，这并没有很好的记录。我能找到的最好的文档是这个<a class="ae le" href="https://gist.github.com/JedWatson/9741171" rel="noopener ugc nofollow" target="_blank">线程</a>。</p><p id="b37e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们做这个例子，希望事情会变得更清楚。在我们的服务器/根文件夹中，我们将创建一个名为api的新的子文件夹。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ml"><img src="../Images/813b9234602af193153c54cca52931ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:448/format:webp/1*raSe0wNaXY178DRyy6QEdg.png"/></div></div></figure><p id="f856" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个文件夹中，我们将添加一个新文件:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="952b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们把配方API端点放到我们的服务器上。在server/routes/index.js文件中，我们需要添加:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="cf76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，让我们检查一下是否一切正常。为了测试API，我们将使用<a class="ae le" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank"> postman </a></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mm"><img src="../Images/6a61c3ca1943156a4d80d439604c31f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l5dM-9bSA12c_4grFPrLDw.png"/></div></div></figure><p id="fddb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">太好了，我们已经为redux做好了一切准备，让我们继续吧。</p><p id="dc92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们将创建一些动作来利用我们刚刚创建的API。在这里，我们将为axios项目引入两个新的依赖项(如果您觉得使用fetch更舒服，可以使用fetch)和redux-thunks。</p><pre class="km kn ko kp gt lx ly lz ma aw mb bi"><span id="3dcb" class="mc md iq ly b gy me mf l mg mh">npm install axios redux-thunk</span></pre><p id="21e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Thunks是一个Redux中间件，允许您编写返回函数而不是动作的动作创建器。这主要是为了对API进行异步调用，这正是我们要做的。在client/actions/中，我们将创建一个名为actions.js的新文件(请记住，这个命名并不常规，我只是这样命名该文件，以便更容易理解)，我们将添加</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="63e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们需要使用reducers文件夹中的操作，我们将添加一个新文件reducers.js和新文件夹recipe_actions。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/0616560415da86ffec39b1c5e5183e11.png" data-original-src="https://miro.medium.com/v2/resize:fit:482/format:webp/1*IHd3EDRCwLT7PFvBavR0Nw.png"/></div></figure><p id="bb8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后在actions文件夹中，我们将需要两个文件分别用于我们的每个操作</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/834cf57601b2616e2dc7181b4c63d88c.png" data-original-src="https://miro.medium.com/v2/resize:fit:566/format:webp/1*gEun-EWH1qUnRQTKwsl5mw.png"/></div></figure><p id="926b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mj mk l"/></div></figure><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="9949" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">没什么特别的，只有两个函数在被调用时会更新我们的状态。你可能会认为把它分成多个文件是一种很麻烦的方法，但是我喜欢这样做，因为这样可以让你直观地看到你的应用程序中有哪些可用的操作。在您自己的项目中，您可能希望将所有操作合并到一个文件中。</p><p id="6b0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好的，最后让我们把所有的都放在reducers.js中</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="bbbe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很好，现在我们需要去我们的容器文件夹，并创建我们的食谱容器。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/f3f748c5a0cb50c25adc531f62458e8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:424/format:webp/1*7tIG6IglK7eT_Igocng0og.png"/></div></figure><p id="aca2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个小的旁注，你们中的一些人可能想知道为什么我们把它添加到容器文件夹中，而不是组件文件夹中。简而言之，所有只关注事物的外观而不涉及状态的东西都应该是一个组件。现在，这是一个过于简化的问题，但是对于本文来说，它是可行的。要了解完整的故事，请阅读丹·阿布拉莫夫的以下文章:</p><div class="lf lg gp gr lh li"><a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0" rel="noopener follow" target="_blank"><div class="lj ab fo"><div class="lk ab ll cl cj lm"><h2 class="bd ir gy z fp ln fr fs lo fu fw ip bi translated">表示和容器组件</h2><div class="lp l"><h3 class="bd b gy z fp ln fr fs lo fu fw dk translated">你会发现如果你把组件分成两类，你的组件更容易重用和推理。</h3></div><div class="lq l"><p class="bd b dl z fp ln fr fs lo fu fw dk translated">medium.com</p></div></div><div class="lr l"><div class="mq l lt lu lv lr lw kv li"/></div></div></a></div><p id="1d8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了保持文章简洁明了，我将不做任何组件，我们将只在一个容器中构建我们的食谱，但是在现实世界中，你可能会想把它分成几个组件，例如</p><ul class=""><li id="4d2c" class="mr ms iq jp b jq jr ju jv jy mt kc mu kg mv kk mw mx my mz bi translated">配方图像组件</li><li id="fded" class="mr ms iq jp b jq na ju nb jy nc kc nd kg ne kk mw mx my mz bi translated">成分列表组件</li><li id="1fbe" class="mr ms iq jp b jq na ju nb jy nc kc nd kg ne kk mw mx my mz bi translated">烹饪指令组件</li></ul><p id="4c38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后可能使用所有这些组件来创建食谱列表、食谱张贴等。我会让你在自己的时间里探索这一点，或者这可以是另一篇文章…</p><p id="db5f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总之回到我们的简单例子。在客户端/容器中，我们创建了Recipe.jsx文件。为此，我们还需要安装lodash，所以不要忘记</p><pre class="km kn ko kp gt lx ly lz ma aw mb bi"><span id="af6e" class="mc md iq ly b gy me mf l mg mh">npm install lodash</span></pre><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="1ba1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在是最后一步，回到我们的应用程序根，我们需要填充我们的商店，并添加食谱组件，如下所示:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="449d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们启动我们的应用程序，查看index.html，您应该会看到如下内容</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/cfe4cf05e42fdcc3830c41e74fa0a4c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*eS7euIy2ba22NaG9V9YhSQ.png"/></div></figure><p id="c8ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">太好了，让我们跳到管理面板，添加缺失的数据</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ng"><img src="../Images/6ac169699f2878f4d5b1e2e0b1572530.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rxSn98XNgtyeBfo-Q4wYcA.png"/></div></div></figure><p id="1a83" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">保存它，现在如果我们再次查看索引页:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nh"><img src="../Images/be7cb1c89cce9fbbbc36ddabfb87af1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*vFGxza_NKfMmsa_8Gvt3jw.png"/></div></div></figure><p id="f7a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，我承认，它看起来并不令人印象深刻，但造型不是我们在这里的目标。我们实际上想要实现的是从我们的Keystone管理面板获取数据，并在前端呈现出来，这正是我们所做的。</p><p id="e187" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本教程到此结束，希望对你有所帮助，并让你学到一些新东西。如果你有任何意见或问题，欢迎在评论中分享。</p></div></div>    
</body>
</html>