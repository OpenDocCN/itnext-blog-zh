<html>
<head>
<title>Testing Symfony applications with PhpStorm</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用PhpStorm测试Symfony应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/testing-symfony-applications-with-phpstorm-7dccd30dfbba?source=collection_archive---------6-----------------------#2019-02-10">https://itnext.io/testing-symfony-applications-with-phpstorm-7dccd30dfbba?source=collection_archive---------6-----------------------#2019-02-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6bdeebe2e2d1a980bb0ad00ac07f5564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1uGtG2ppl50jhbEV3yCHZg.png"/></div></div></figure><p id="f057" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我一直是一个重度IDE用户——但是对于一些事情，比如运行测试，我仍然更喜欢终端。最近，我尝试了测试的内部可能性，并对它们相当满意。由于Symfony附带了一种定制的测试体验，下面介绍如何设置您的IDE来测试您的Symfony应用程序——以及在您的IDE中测试的其他特性。</p><h1 id="9010" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">IDE配置</h1><p id="f2c2" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">遵循当前的<a class="ae lz" href="https://symfony.com/doc/current/testing.html" rel="noopener ugc nofollow" target="_blank">测试</a>文档后，必须在您的终端上手动运行<code class="fe ma mb mc md b">./bin/phpunit</code>一次。Symfony将在你的<code class="fe ma mb mc md b">bin</code>目录中安装它自己的<a class="ae lz" href="https://phpunit.de/" rel="noopener ugc nofollow" target="_blank"> PHPUnit </a>实例，它将为我们的ide提供可执行的<code class="fe ma mb mc md b">phpunit</code>文件。</p><p id="0502" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行这个命令后，您会在您的<code class="fe ma mb mc md b">bin</code>目录中看到一个<code class="fe ma mb mc md b">.phpunit</code>目录。</p><p id="314a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了能够通过您的IDE运行您的测试，打开您的设置窗口并导航到<code class="fe ma mb mc md b">Languages &amp; Frameworks &gt; PHP &gt; Test Frameworks</code>。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/5d1eaeb74af71140b15ef4f3468cfb43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xSu1-A_gDHzSuTsIRQPLgA.png"/></div></div></figure><p id="817e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">点击右侧的<code class="fe ma mb mc md b">+</code>图标，选择<code class="fe ma mb mc md b">PHPUnit Local</code>。指定<code class="fe ma mb mc md b">Path to phpunit.phar</code>并在<code class="fe ma mb mc md b">.phpunit</code>目录中选择<code class="fe ma mb mc md b">phpunit</code>文件。此外，将您的<code class="fe ma mb mc md b">Default configuration file</code>设置为Symfony目录中的<code class="fe ma mb mc md b">phpunit.xml</code>。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mj"><img src="../Images/87011301bd8eface4ecec6b04539d78f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f7nsPeDODXzwMGRwbOs2lQ.png"/></div></div></figure><p id="b09d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注意:</strong>如果您使用定制的配置文件，请记住将您的配置文件更改为<code class="fe ma mb mc md b">phpunit.xml</code>而不是<code class="fe ma mb mc md b">phpunit.xml.dist</code>。</p><p id="d61d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开一个测试，点击<code class="fe ma mb mc md b">Run test</code>图标并选择<code class="fe ma mb mc md b">Run '&lt;your test name&gt;'</code>。将弹出一个窗口，您可以在其中编辑您的配置(我们稍后将讨论这个主题)；而且，如果您还没有为您的项目设置解释器，您会看到一个感叹号，带有一条非常奇怪的消息:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/6947ce6722d02c916941b35cb4858f0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*AKkwqYDsSAGF66NV0mSIdg.png"/></div></figure><p id="0846" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">点击<code class="fe ma mb mc md b">Fix</code>按钮将打开一个窗口，您可以在其中设置CLI解释器。如果你的下拉列表中没有解释器，点击下拉列表旁边的图标，添加你的PHP解释器路径。这看起来应该有点像这样:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/2f9261afe6534a99d0eb63757b3de88b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cn8htOdLwkPUUU0ZSJKrYQ.png"/></div></div></figure><p id="a489" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注意:</strong>建议安装类似<code class="fe ma mb mc md b">xdebug</code>的调试器。如果你用的是Ubuntu，只需用<code class="fe ma mb mc md b">sudo apt install php-xdebug</code>安装即可。</p><p id="f64b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在选择您的解释器路径，感叹号应该会消失——这意味着您已经准备好运行您的测试了。</p><p id="396d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">点击<code class="fe ma mb mc md b">Run</code>应该会在你的IDE中打开一个额外的视图，显示你的测试结果。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mm"><img src="../Images/9b400885f2ad6699162f712021f8b67e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oHKXlqhq8qdts05IG0fPMA.png"/></div></div></figure><h1 id="f0c3" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">使用</h1><p id="b547" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">能够在您的IDE中运行测试是一回事，理解和利用它是另一回事。让我们更深入地看看我们的可能性:</p><h1 id="dfdc" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">配置</h1><p id="4621" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">您可以为每个单独的测试、整个测试类或者任何您想要的东西添加配置。例如，您可以创建一个执行所有单元测试但不执行功能测试的配置——单击IDE顶部配置下拉列表中的<code class="fe ma mb mc md b">Edit configurations</code>项，为指向单元测试目录的单元测试创建一个新配置。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/d20ceb1061e913cf59057b2854cebbf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ehQSLSa6znn32LASFQ4Tpg.png"/></div></div></figure><p id="39de" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在选择<code class="fe ma mb mc md b">Unit tests</code>配置将运行所有的单元测试——除此之外别无其他。</p><h1 id="a64a" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">代码覆盖率</h1><p id="73ee" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated"><strong class="ka ir">重要提示</strong>:切记这需要<code class="fe ma mb mc md b">xdebug</code>扩展！</p><p id="b910" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您努力追求更高的代码覆盖率，PhpStorm提供了很好的工具，让您的生活更轻松。假设以下代码:</p><pre class="mf mg mh mi gt mo md mp mq aw mr bi"><span id="5874" class="ms kx iq md b gy mt mu l mv mw">public function equals13($input)<br/>{<br/>    if (! is_numeric($input)) {  <br/>        throw new \InvalidArgumentException("Argument must a number");  <br/>    }  <br/>    return $input === 13; <br/>}</span></pre><p id="628a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对此的测试非常简单:</p><pre class="mf mg mh mi gt mo md mp mq aw mr bi"><span id="56c2" class="ms kx iq md b gy mt mu l mv mw">public function testEquals13()<br/>{<br/>    $helper = new NumberHelper();<br/>    $this-&gt;assertTrue($helper-&gt;equals13(13));<br/>    $this-&gt;assertFalse($helper-&gt;equals13(42));<br/>}</span></pre><p id="1d84" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一个伟大方法的伟大测试，然而我们遗漏了一些东西:我们遗漏了测试非数字值的路径。</p><p id="1b56" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果使用<code class="fe ma mb mc md b">Run '&lt;your test&gt; with Coverage</code>运行测试，PhpStorm将会生成测试的可视化表示。在你的<code class="fe ma mb mc md b">equals13</code>方法的情况下，它看起来像这样:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/ea882e6f68726e1ded9f8e4621a2866f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*N5Dlx1BfpmqJVcVOZ9QG-A.png"/></div></figure><p id="5cbf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这使得您很容易检测到未测试的代码。此外，PhpStorm现在将显示一个覆盖报告<em class="my">和</em>显示你的项目结构中的代码覆盖。</p><p id="cf66" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你对自己的低覆盖率感到羞愧，并想再次隐藏这些统计数据，只需点击<code class="fe ma mb mc md b">Tools &gt; Hide coverage</code>让它们消失。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/101e1de1bd4ecf94484504d72d526bed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vl2BuI_wnvO2ex7PuYdCRg.png"/></div></div></figure><h1 id="e869" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">自动测试</h1><p id="066e" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">另一个有用的特性是自动测试，它本质上只是在你的代码被修改后执行你的测试(你不需要做任何事情)。要启用此功能，只需点击<code class="fe ma mb mc md b">Run</code>窗口中的<code class="fe ma mb mc md b">Toggle auto test</code>按钮。要调整代码更改和测试执行之间的延迟，您可以更改自动测试延迟的值(点击<code class="fe ma mb mc md b">Run</code>窗口中的齿轮图标)。</p><h1 id="dfdb" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">为什么没有终端？</h1><p id="08d1" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">自从我认识到测试的重要性并开始写测试，我就在终端中执行它们。在这段时间里，我发现我唯一需要<em class="my">有时</em>改变的参数是生成一个覆盖导出(用<code class="fe ma mb mc md b">--coverage-clover</code>)并且只执行一个测试而不是所有的测试(用<code class="fe ma mb mc md b">--filter</code>)。这样做的一个很大的缺点是，我总是不得不重新加载我的覆盖率文件，以防我想在我的IDE中看到更新的代码覆盖率，这真的很烦人。</p><p id="56f5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这两个选项在我的IDE中都有涉及——而且我可以做得更多，而不必存储大量的终端命令。点击“播放”图标可能不会让你看起来像一个黑客，就像输入复杂的终端命令一样——但它更容易、更快。</p><p id="c5fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果有任何关于测试的特性你认为应该添加到这篇文章中(或者你认为使用IDE代替终端进行测试有什么缺点),请在评论中告诉我。</p></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><p id="22fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="my">如果你喜欢这篇文章，请留下你的👏，关注我上</em> <a class="ae lz" href="https://twitter.com/nehalist" rel="noopener ugc nofollow" target="_blank"> <em class="my">推特</em> </a> <em class="my">并订阅</em> <a class="ae lz" href="https://nehalist.io/newsletter/" rel="noopener ugc nofollow" target="_blank"> <em class="my">我的快讯</em> </a> <em class="my">。最初发表于</em><a class="ae lz" href="https://nehalist.io/testing-symfony-applications-in-phpstorm/" rel="noopener ugc nofollow" target="_blank"><em class="my">nehalist . io</em></a><em class="my">。</em></p></div></div>    
</body>
</html>