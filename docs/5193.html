<html>
<head>
<title>Benchmark PostgreSQL on all three systems: Docker versus native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在所有三个系统上测试PostgreSQL:Docker与native</h1>
<blockquote>原文：<a href="https://itnext.io/benchmark-postgresql-docker-versus-native-2dde6b5a8552?source=collection_archive---------1-----------------------#2021-01-08">https://itnext.io/benchmark-postgresql-docker-versus-native-2dde6b5a8552?source=collection_archive---------1-----------------------#2021-01-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5937" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用所有PGTune设置</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7d85c01fb642adc8133fddf6aba86c1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6e2hgIdgQWXH8SH_tKcGBQ.png"/></div></div></figure><p id="f0b3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这篇文章可以看作是对以前的大型数据库基准测试的扩展。</p><div class="lq lr gp gr ls lt"><a href="https://petrjahoda.medium.com/benchmark-databases-in-docker-mysql-postgresql-sql-server-7b129368eed7" rel="noopener follow" target="_blank"><div class="lu ab fo"><div class="lv ab lw cl cj lx"><h2 class="bd iu gy z fp ly fr fs lz fu fw is bi translated">Docker中的基准数据库:MySQL、PostgreSQL、SQL Server</h2><div class="ma l"><h3 class="bd b gy z fp ly fr fs lz fu fw dk translated">加上MariaDB、Percona和TimescaleDB</h3></div><div class="mb l"><p class="bd b dl z fp ly fr fs lz fu fw dk translated">petrjahoda.medium.com</p></div></div><div class="mc l"><div class="md l me mf mg mc mh ks lt"/></div></div></a></div><p id="3b8f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因为PostgreSQL是赢家，所以比较一下在Docker中运行PostgreSQL和在本地运行PostgreSQL会很有意思。如果使用<a class="ae mi" href="https://pgtune.leopard.in.ua/#/" rel="noopener ugc nofollow" target="_blank"> PGTune </a>进行微调的数据库设置之间存在差异，也很有意思。</p><p id="8895" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">该基准测试在所有三个主要系统上完成，本机运行PostgreSQL。在所有这些服务器上，在Docker中运行PostgreSQL。</p><p id="15de" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">该基准测试的目标不是比较Linux、Windows和Mac(但是您将会得到结果)。目标是比较在Docker中运行的PostgreSQL和在本地运行的PostgreSQL。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="f374" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">使用PGTune微调Docker中的数据库</h1><p id="109e" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">PGTune是一个在线工具，可以为您的PostgreSQL数据库生成稍微好一点的配置。我测试了它们在Docker中运行的数据库。以下是参数，符合我的Docker设置:2 GB的内存和2个CPU的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/5db73e8ff218ef5a3e26f40db79de449.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vQEiSFKPTcxBA9ZZBMs6cg.png"/></div></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="335b" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">MacOS写性能指标评测(MacOS 11.1 Big Sur)</h1><p id="1a81" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">我使用了和以前一样的基准工具。</p><div class="lq lr gp gr ls lt"><a href="https://github.com/petrjahoda/medium_database_benchmark" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab fo"><div class="lv ab lw cl cj lx"><h2 class="bd iu gy z fp ly fr fs lz fu fw is bi translated">petrjahoda/medium _ database _ benchmark</h2><div class="ma l"><h3 class="bd b gy z fp ly fr fs lz fu fw dk translated">通过在GitHub上创建一个帐户，为petrjahoda/medium _ database _ benchmark开发做出贡献。</h3></div><div class="mb l"><p class="bd b dl z fp ly fr fs lz fu fw dk translated">github.com</p></div></div><div class="mc l"><div class="no l me mf mg mc mh ks lt"/></div></div></a></div><p id="f0e9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是结果。</p><p id="4555" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">原生运行PostgreSQL确实对写速度<strong class="kw iu">有很大影响</strong>。这是意料之中的，因为在macOS上的Docker中运行的PostgreSQL使用的是<em class="np">虚拟硬盘</em>。</p><p id="4797" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">优化数据库设置不会对这个特定的写基准产生太大影响。另一方面:如果你调整这些设置，你不会做错任何事。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/1b0aa312cb01149027b676a2366f306c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gnvLkbg7TGoJsKwTEnHMWg.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">越低越好</figcaption></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="c47d" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">MacOS读取性能指标评测(MacOS 11.1 Big Sur)</h1><p id="a89f" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">当我第一次在本机运行于macOS上的PostgreSQL上运行这个基准测试时，我觉得有些不对劲。但是我做了10次基准测试，每次都有相似的结果。</p><p id="17e4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">看到这个结果，<strong class="kw iu">对我来说有点震惊</strong>，因为我确实没有预料到这一点。本机macOS PostgreSQL上的读取速度比在macOS上的Docker中运行的PostgreSQL慢。</p><p id="dfe8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">同样，使用PGTune修改设置不会对这个特定的read基准产生太大影响，所以在即将到来的测试中不会使用它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/138be6f2885ffc3ae1cdf49b483a7fc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u-HX8noqC4hJUJKOkEAwBg.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">越低越好</figcaption></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="c058" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">Windows写入性能指标评测(Windows 10 Pro 20H2)</h1><p id="0bcc" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">原生运行PostgreSQL确实对写速度有很大影响<strong class="kw iu"/>，就像在MacOS上一样。写入速度提高了1度。</p><p id="594e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用WSL2比使用Hyper-V产生的结果稍好一些。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/5ae67f77065688e5e8cdd2b51314b816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V9L2ga7DjFY4V1o8FhnUdA.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">越低越好</figcaption></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="0d19" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">Windows读取性能指标评测(Windows 10 Pro 20H2)</h1><p id="8f0a" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">这几乎反映了MacOS上的行为。在Docker中运行PostgreSQL时，读取速度会更快。</p><p id="6b5f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里，使用Hyper-V给出的结果比使用WSL2稍好。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/be0b9ea725eb2ffe1823463e732154b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*38Tefw3EWNZpPQ1o_WcGJw.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">越低越好</figcaption></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="b33e" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">Linux写基准测试(Fedora 33)</h1><p id="f3b8" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">如您所见，在Docker中运行PostgreSQL会稍微影响写入速度。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/b5fbd8fc3660e034f9987f9bdc40899b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NbGvYQCJ3gn7opXClMvA3Q.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">越低越好</figcaption></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="71d5" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">Linux读取基准测试(Fedora 33)</h1><p id="e02c" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">读取速度是相同的。因此，从read的角度来看，无论您选择在Docker中运行PostgreSQL还是在Linux上本地运行PostgreSQL，都没有关系。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/f6f69d972516d9caaf03c52c1c43373f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VBFiHmbEFA0ylkezu7ey7g.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">越低越好</figcaption></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="d300" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">有趣的信息</h1><ul class=""><li id="206b" class="oa ob it kw b kx ni la nj ld oc lh od ll oe lp of og oh oi bi translated">MacOS测试在macbook上运行:16GB内存，固态硬盘，2.3Ghz 8核</li><li id="6d78" class="oa ob it kw b kx oj la ok ld ol lh om ll on lp of og oh oi bi translated">Windows测试在定制pc上运行:16GB内存、固态硬盘、2.3Ghz 8核</li><li id="8815" class="oa ob it kw b kx oj la ok ld ol lh om ll on lp of og oh oi bi translated">Linux测试在定制pc上运行:16GB内存、固态硬盘、2.3Ghz 8核</li></ul><p id="a721" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我在这篇文章的开头写道，我们的目标不是比较这些系统，但是我认为，这种比较会给你一个更清晰的概述。</p><h2 id="33ea" class="oo mr it bd ms op oq dn mw or os dp na ld ot ou nc lh ov ow ne ll ox oy ng oz bi translated">写入基准</h2><p id="8acc" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">Linux出乎意料地慢，几乎完全一样，因为它在MacOS上的Docker和Windows上的Docker都很慢。</p><p id="98af" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我的猜测是，Windows和MacOS文件系统更适合写数据，因为这两个系统上的Docker在虚拟机中使用Linux文件系统，这与其缓慢的速度相匹配。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/ea5650ef36c135392e6ac68e0eae7344.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ZiqsTuirN8VeBliY04DGQ.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">越低越好</figcaption></figure><h2 id="be4d" class="oo mr it bd ms op oq dn mw or os dp na ld ot ou nc lh ov ow ne ll ox oy ng oz bi translated">读取基准</h2><p id="7a5c" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">这里正好相反。Linux很快，装有MacOS的Windows要慢得多。</p><p id="08d9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是当在这两个系统上使用Docker时，速度几乎赶上了Linux。</p><p id="67d3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我的猜测和之前一模一样。MacOS和Windows的Docker匹配Linux文件系统的读取速度，因为它使用Linux文件系统。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/5753f70715e08b065b949f822525c068.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RlicTRk2LTCBsrkzDhH0Qg.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">越低越好</figcaption></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="aef3" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">在Docker中运行PostgreSQL的结论</h1><p id="6d01" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated"><strong class="kw iu">对于开发:</strong>不要害怕在Docker中运行PostgreSQL，无论是在Linux、Windows还是MacOS上。在macOS和Windows的情况下，你可以获得更好的读取速度，但写入速度要差得多。</p><p id="8f9f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">对于生产:</strong>视情况而定……在原生Windows、原生MacOS上写入速度更快。一般来说，在原生Linux和使用Docker的情况下，读取速度更快。所以在这里，我真的不知道，如何做出结论。你得自己决定，把这些结果作为一个信息。</p><p id="7732" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">关于微调:</strong>在这个特定的基准测试中，我对PGTune不抱太大希望，但是我建议您在准备生产时，使用PGTune用不同的设置测试您的数据库。</p></div></div>    
</body>
</html>