<html>
<head>
<title>How to Speed Up Your Website with Azure CDN</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Azure CDN加速你的网站</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-speed-up-your-website-762ecfb14d69?source=collection_archive---------2-----------------------#2021-03-29">https://itnext.io/how-to-speed-up-your-website-762ecfb14d69?source=collection_archive---------2-----------------------#2021-03-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/463ca1d415da5b6c29f2dc1511a70be2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*df9d2DJglw65yzVAh2SEKw.png"/></div></div></figure><h1 id="ff40" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">什么是CDN？</h1><p id="f3c7" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">内容交付网络(CDN)帮助您更快地交付内容。您可以提供在一段时间内保持不变的任何类型的内容，如图像、视频、CSS、JavaScript、HTML文件、pdf等。</p><p id="9dbb" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">CDN是一组分布在世界各地的服务器，从<em class="lz">边缘服务器</em>传送内容。边缘服务器是离发出请求的地方最近的服务器。</p><p id="8963" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">根据请求，边缘服务器可以从缓存中返回内容，也可以从<em class="lz">源服务器</em>获取内容。提供实际内容的服务器称为源服务器。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ma"><img src="../Images/26dee06d77d1ed1f0681972db6536242.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ct2r396ZxqOgbjhq.png"/></div></div></figure><p id="7833" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">在上图中，边缘服务器位于世界各地，源服务器位于美国加利福尼亚州。当发出请求时，位于印度孟买的边缘服务器可能会联系源服务器，如果它不能提供内容的话。</p><h1 id="a0c6" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">CDN是如何工作的？</h1><p id="632f" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">cdn有四个主要部分:消费者、DNs、边缘服务器和源服务器。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mf"><img src="../Images/0a4e8c1458a6cf25b457cdcb17442ee9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZIuh4I2lsrGPY-V6.png"/></div></div></figure><p id="2649" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">当消费者提出请求时，它首先被其互联网服务提供商(ISP)接受。然后，ISP将点击内容提供商的<em class="lz">权威DNS </em>。</p><blockquote class="mg mh mi"><p id="f7c0" class="kw kx lz ky b kz lu lb lc ld lv lf lg mj lw lj lk mk lx ln lo ml ly lr ls lt ij bi translated">权威DNS将DNS请求转换成IP请求。</p></blockquote><p id="a000" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">建立权威DNS后，它会返回最近的边缘服务器的IP地址。然后，边缘服务器将在其自己的缓存中检查所请求的内容是否可用。</p><p id="ceea" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">如果是，那么它返回内容。如果内容不可用，它从源服务器请求内容，并在检索时缓存它。</p><h1 id="74d7" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">CDN的优势</h1><h2 id="b792" class="mm jz iq bd ka mn mo dn ke mp mq dp ki lh mr ms km ll mt mu kq lp mv mw ku mx bi translated">低带宽消耗</h2><p id="f688" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">许多web主机每月的带宽分配有限。如果你超过那个，你将被额外收费。</p><p id="34e3" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">有了CDN，你的大部分带宽将被节省，因为内容将由边缘服务器提供。</p><h2 id="9e3f" class="mm jz iq bd ka mn mo dn ke mp mq dp ki lh mr ms km ll mt mu kq lp mv mw ku mx bi translated">低延迟</h2><p id="c209" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">边缘服务器缓存内容。因此，无论何时请求缓存内容，延迟都会显著降低。这是因为请求不会一直到达源服务器。</p><h2 id="a47d" class="mm jz iq bd ka mn mo dn ke mp mq dp ki lh mr ms km ll mt mu kq lp mv mw ku mx bi translated">针对DDoS的安全性</h2><p id="0683" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">几乎所有流行的CDN都有能力保护你的网络服务器免受分布式拒绝服务(DDos)攻击。</p><h2 id="5448" class="mm jz iq bd ka mn mo dn ke mp mq dp ki lh mr ms km ll mt mu kq lp mv mw ku mx bi translated">提高搜索引擎优化</h2><p id="0551" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">加载时间是影响网站SEO排名的因素之一。如果你通过CDN提供大部分内容，加载时间会大大减少，有助于提高你的搜索引擎优化。</p><h1 id="74c3" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">深入了解Azure CDN</h1><p id="b07e" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">假设您已经创建了一个Azure存储帐户并托管了一个非常简单的站点，该站点将Hello World显示为h1。现在你知道了CDN的好处，你想通过CDN服务你的简单站点。</p><p id="45e1" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">您将拥有一个类似于<a class="ae my" href="https://demostorageaccountarjav.z29.web.core.windows.net/" rel="noopener ugc nofollow" target="_blank"><em class="lz">【https://demostorageaccountarjav.z29.web.core.windows.net/】</em></a>的端点(而不是demostorageaccountarjav，它将是您的存储帐户的名称)。这里有更多关于如何<a class="ae my" href="https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blob-static-website" rel="noopener ugc nofollow" target="_blank">建立一个静态网站</a>的细节。</p><p id="f001" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">登录到你的Azure门户，点击<em class="lz">从你的仪表板创建一个资源</em>。搜索<em class="lz"> CDN </em>，这将在市场中打开资源，如下所示。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/371a5a038bf3a1acfdf6dd1c9b532847.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gb35PRWTtE6XEtBm.png"/></div></div></figure><p id="bad4" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">这将打开一个创建CDN配置文件的表单。CDN配置文件是一组CDN端点。除了名称、资源组和定价层之外，这里没有什么需要填写的。</p><p id="9a4c" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">接下来，选中复选框以创建CDN端点。端点是消费者请求内容的地方。因此，如果您有多个站点，也可以创建多个端点。</p><p id="b4c9" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">我附上了一个截屏供您参考，在什么价值投入。由于CDN是一项全球服务，因此区域选择将被禁用。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/de285562ac190986f6932ff4bae0fbc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8nhLWZ3HUJREQbn_.png"/></div></div></figure><p id="a2b1" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">您现在可以点击<em class="lz"> Create </em>来生成概要文件和端点。创建需要几分钟时间。创建后，当您转到主屏幕时，您将拥有以下4种资源:</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/a1d0e00543be70b044a872b4b8fe9686.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PxD64ipOOtXY9LH6.png"/></div></div></figure><p id="95da" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">如前所述，CDN配置文件是一组<em class="lz">端点</em>。要查看详细信息，请单击* <em class="lz">端点</em>资源。您将看到一个概述，其中包含一个到<em class="lz">端点主机名</em>的链接。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/f644a6dee2b62b004f429124ad39eac9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QN32RU6YC7ChAI-U.png"/></div></div></figure><p id="e605" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">当您打开端点主机名时，最初可能会显示“404未找到”。你可能需要再等10-15分钟才能看到你的网站。</p><p id="1099" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">正如在优点部分中所讨论的，您可以为安全性、缓存、路由和许多其他事情配置端点。您可以在此探索更多选项<a class="ae my" href="https://docs.microsoft.com/en-us/azure/cdn/cdn-how-caching-works" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="ddf6" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">如何通过SAS令牌访问</h1><p id="887e" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">您可能想知道，如果您的资源在私有容器中，并且只能通过<em class="lz">共享访问签名</em> (SAS)令牌来访问，该怎么办。你很幸运！查询字符串按原样传递，因为SAS是一个查询字符串，所以很好。</p><p id="423a" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">继续创建新的存储帐户(禁用静态网站)。在CDN配置文件中添加一个指向新创建的存储帐户的新端点。</p><p id="5f7c" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">出于演示的目的，我创建了一个名为<em class="lz"> site </em>的容器，具有私有访问级别。我上传了一个名为<em class="lz">Photo.jpeg</em>的Blob到一个URL为<a class="ae my" href="https://demostorageaccountarjav.blob.core.windows.net/" rel="noopener ugc nofollow" target="_blank">https://demostorageaccountarjav.blob.core.windows.net</a>的存储账户中。</p><p id="ca50" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">你当然可以直接从Azure门户获取SAS令牌进行测试，但这不是你在现实世界中通常会做的。为此，您将在下面找到在Node.js中创建SAS令牌的简单代码片段。</p><pre class="mb mc md me gt nd ne nf ng aw nh bi"><span id="6d37" class="mm jz iq ne b gy ni nj l nk nl">const azureSasToken = require('azure-sas-token');<br/> <br/>// default token validity is 7 days<br/>let sasToken = azureSasToken.createSharedAccessToken('https://&lt;service namespace&gt;.servicebus.windows.net/&lt;topic name or queue&gt;',<br/>                                '&lt;signature key name&gt;',<br/>                                '&lt;signature hash&gt;');<br/>console.log(`sasToken: ${sasToken}`);<br/> <br/>// Specify your own validity in secs, two hours in this example<br/>sasToken = azureSasToken.createSharedAccessToken('https://&lt;service namespace&gt;.servicebus.windows.net/&lt;topic name or queue&gt;',<br/>                                '&lt;signature key name&gt;',<br/>                                '&lt;signature hash&gt;', <br/>                                60 * 60 * 2);<br/>console.log(`sasToken: ${sasToken}`);</span></pre><p id="8270" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">我们使用了一个简单的名为<a class="ae my" href="https://www.npmjs.com/package/azure-sas-token" rel="noopener ugc nofollow" target="_blank"> azure-sas-token </a>的npm包。生成SAS后，您的URL将类似于以下内容:</p><pre class="mb mc md me gt nd ne nf ng aw nh bi"><span id="2de0" class="mm jz iq ne b gy ni nj l nk nl"><a class="ae my" href="https://demostorageaccountarjav.blob.core.windows.net/site/Photo.jpeg?sp=r&amp;st=2021-03-25T07:28:45Z&amp;se=2022-02-02T15:28:45Z&amp;spr=https&amp;sv=2020-02-10&amp;sr=b&amp;sig=PD4HlRI8bDEirMevpYQgpx6drwh%2BE5EpILfXkQOMlvw%3D" rel="noopener ugc nofollow" target="_blank">https://demostorageaccountarjav.blob.core.windows.net/site/Photo.jpeg?sp=r&amp;st=2021-03-25T07:28:45Z&amp;se=2022-02-02T15:28:45Z&amp;spr=https&amp;sv=2020-02-10&amp;sr=b&amp;sig=PD4HlRI8bDEirMevpYQgpx6drwh%2BE5EpILfXkQOMlvw%3D</a></span></pre><p id="4d14" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">上面的URL直接指向存储帐户。所以继续改变原点，使它使用原点端点。</p><pre class="mb mc md me gt nd ne nf ng aw nh bi"><span id="a80f" class="mm jz iq ne b gy ni nj l nk nl"><a class="ae my" href="https://demowebsitearjav.azureedge.net/site/Photo.jpeg?sp=r&amp;st=2021-03-25T07:28:45Z&amp;se=2022-02-02T15:28:45Z&amp;spr=https&amp;sv=2020-02-10&amp;sr=b&amp;sig=PD4HlRI8bDEirMevpYQgpx6drwh%2BE5EpILfXkQOMlvw%3D" rel="noopener ugc nofollow" target="_blank">https://demowebsitearjav.azureedge.net/site/Photo.jpeg?sp=r&amp;st=2021-03-25T07:28:45Z&amp;se=2022-02-02T15:28:45Z&amp;spr=https&amp;sv=2020-02-10&amp;sr=b&amp;sig=PD4HlRI8bDEirMevpYQgpx6drwh%2BE5EpILfXkQOMlvw%3D</a></span></pre><p id="b9c0" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">当您访问该网站时，您将能够通过CDN查看受保护的资源。您可能需要等待几分钟和/或清除您的端点才能看到更新的内容。</p><h1 id="5cc1" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">结论</h1><p id="2a0d" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">在我看来，每个人都应该使用内容交付网络。还有许多其他提供商，如Cloudflare、S3等。但是微软是提供各种服务的主要参与者之一。</p><p id="c49d" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">如果你和我一样是Azure的粉丝，你绝对应该试试Azure CDN。</p><p id="b2bc" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">对于任何反馈或问题，你可以<a class="ae my" href="https://arjavdave.com/contact/" rel="noopener ugc nofollow" target="_blank">与我联系</a>。</p><p id="ce23" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">点击<a class="ae my" href="https://arjavdave.com/" rel="noopener ugc nofollow" target="_blank">这里</a>查看更多类似的教程。</p></div></div>    
</body>
</html>