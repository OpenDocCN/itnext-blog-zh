<html>
<head>
<title>Shrinking Go executables</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">收缩Go可执行文件</h1>
<blockquote>原文：<a href="https://itnext.io/shrinking-go-executable-9e9c17b47a41?source=collection_archive---------1-----------------------#2022-03-16">https://itnext.io/shrinking-go-executable-9e9c17b47a41?source=collection_archive---------1-----------------------#2022-03-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="2daf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用Go 1.18和UPX</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/2e0e19ca4417aea61b797f9ffe1d675a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*js44yVeaAcSv-cjJ6w2lhw.jpeg"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">由Renee French创建的原始地鼠图像，使用由Maria Letta创建的地鼠图像</figcaption></figure><p id="8eca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你是一名开发人员，很可能你总是希望你的代码更快、更好、更可读…</p><p id="f8b2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，我希望，您希望您的可执行文件(二进制文件)尽可能小。如果你正在使用Go，也许你会惊讶，一个简单的“Hello World”可执行文件能有多大。</p><p id="ae33" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这篇文章不是关于“为什么”，而是关于“用它做什么”。</p><p id="d890" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">作为一个理智的人，你可以做的事情主要有两个步骤。请继续读下去。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h1 id="fa00" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">收缩可执行文件</h1><p id="1e64" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">在本文中，我使用真实世界的例子，代码来自下面的资源库。</p><div class="mk ml gp gr mm mn"><a href="https://github.com/petrjahoda/system_webservice" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab fo"><div class="mp ab mq cl cj mr"><h2 class="bd iu gy z fp ms fr fs mt fu fw is bi translated">GitHub-petrjahoda/system _ web service</h2><div class="mu l"><h3 class="bd b gy z fp ms fr fs mt fu fw dk translated">在docker运行时下使用这个docker文件映像安装用户UI的web服务，命令如下:docker-compose…</h3></div><div class="mv l"><p class="bd b dl z fp ms fr fs mt fu fw dk translated">github.com</p></div></div><div class="mw l"><div class="mx l my mz na mw nb ku mn"/></div></div></a></div><p id="aad7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当你用标准的方式创建一个可执行文件时，使用<code class="fe nc nd ne nf b">go build</code>，来自这个特定仓库的可执行文件将会是16.6MB，这是一个很大的数目。但是构建时间不到一秒。</p><p id="aa9e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是16.6MB真的很多。</p><p id="7723" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上面提到的那两个步骤真的很简单。首先，使用两个go build标志，像这样创建可执行文件:<code class="fe nc nd ne nf b">go build -ldflags="-s -w"</code>。然后使用UPX让你的可执行文件变小。</p><p id="0241" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这就是这篇文章的主要原因。</p><p id="b3ce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用UPX，你可以使你的可执行文件尽可能的小，但是这需要很多时间(有时)。或者你可以满足于一个“不是最小的”可执行文件，但是打包时间会更快。<br/>问题是……什么是最适合UPX的参数，打包您的文件甚至需要多长时间？</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h1 id="c9fb" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">尺寸变量</h1><p id="bece" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">首先，我们来看尺寸。这是一张不同尺寸、不同设置的表格。如您所见，第一行是非优化版本。普通身材。正如你在其他栏目中看到的，UPX的能力是有限的。3.5MB是最小的大小，UPX可以压缩这个特定的可执行文件。这大约是原始大小的21%。还不错。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ng"><img src="../Images/d6a96897021a58b3d351cf20e8e05386.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BqCL3aZ_10rDh9jtjKVKvQ.png"/></div></div></figure></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h1 id="bb27" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">时间变量</h1><p id="e0cd" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">现在让我们看看时间。最快的是带有go build标志的第二行。</p><p id="5cc3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以看到，当使用<code class="fe nc nd ne nf b">best</code>、<code class="fe nc nd ne nf b">brute</code>和<code class="fe nc nd ne nf b">ultra-brute</code>参数时，构建时间——或者说打包时间——疯狂增长。</p><p id="628e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我不认为任何理智的人会等两分钟来构建二进制文件。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ng"><img src="../Images/ae344cf19373c7b2a843d10c2279e2c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ui-YYP7AvHAkck0nmxxqpw.png"/></div></div></figure><p id="c98d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是有些事情。大家可以看到，使用<code class="fe nc nd ne nf b">--best --lzma</code>的时候，时间大概是7.25秒。如果您查看第一个表，您可以看到文件大小约为3.5MB</p><p id="fda7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，通过使用这两个参数，您将在合理的构建时间内获得尽可能小的尺寸。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h1 id="b7c6" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">摘要</h1><p id="4b3d" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">对我来说总结很简单。创建二进制时，使用<code class="fe nc nd ne nf b">go build -ldflags="-s -w"</code>，然后使用带<code class="fe nc nd ne nf b">--best --lzma</code>参数的UPX。</p><p id="dace" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意，一些反病毒程序不喜欢UPX压缩二进制文件。</p><p id="4697" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你好奇，为什么我会关心这些…</p><p id="5975" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我经常使用docker，并在我的Docker映像中使用这些二进制文件。所以我想让这些图像尽可能的小。我不想浪费时间在网上上传和下载软件。<br/>我简单地构建一个二进制文件，然后创建尽可能小的图像。</p><p id="7a9e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，通过使用这个二进制“在Docker中”,没有必要担心那些抗病毒药物。</p></div></div>    
</body>
</html>