<html>
<head>
<title>Kubernetes: Minikube, and a LoadBalancer in the Pending status</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes: Minikube和一个处于挂起状态的负载平衡器</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-minikube-and-a-loadbalancer-in-the-pending-status-c6bdea2d7bca?source=collection_archive---------10-----------------------#2022-10-05">https://itnext.io/kubernetes-minikube-and-a-loadbalancer-in-the-pending-status-c6bdea2d7bca?source=collection_archive---------10-----------------------#2022-10-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/eded490b304e670ab62bf1c871aff256.png" data-original-src="https://miro.medium.com/v2/resize:fit:260/format:webp/0*7HTKUVs-UefkWxFy.png"/></div></figure><p id="efc4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在Minikube中运行Pritunl后，无法连接到VPN:</p><blockquote class="ks kt ku"><p id="8aef" class="ju jv kv jw b jx jy jz ka kb kc kd ke kw kg kh ki kx kk kl km ky ko kp kq kr ij bi translated">…<br/>2022–10–03 13:50:32 TCP/UDP:保留最近使用的远程地址:[AF _ INET]194 . 168 . 3 . 100:1194<br/>2022–10–03 13:50:32 UDP链接本地:(未绑定)<br/>2022–10–03 13:50:32 UDP链接远程:[AF _ INET]194.166</p></blockquote><p id="7593" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">查看其Kubernetes服务:</p><pre class="kz la lb lc gt ld le lf bn lg lh bi"><span id="85d3" class="li lj iq le b be lk ll l lm ln">$ kubectl -n pritunl-local get svc<br/>NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE<br/>pritunl LoadBalancer 10.102.129.25 &lt;pending&gt; 1194:30166/TCP 47m<br/>…</span></pre><p id="c68e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">类型是<code class="fe lo lp lq le b">LoadBalancer</code>，但是它的<code class="fe lo lp lq le b">EXTERNAL-IP</code>状态是<strong class="jw ir"><em class="kv"/></strong>，因为Minikube没有LoadBalancer类型的服务，因为它必须在基础设施级别创建——AWS、GCE、Azure，然后Kubernetes从它们那里接收一个IP或URL，将请求路由到这个负载平衡器。</p><h1 id="5f19" class="lr lj iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">负载平衡器<code class="fe lo lp lq le b">&lt;pending&gt;</code>解决方案</h1><p id="789d" class="pw-post-body-paragraph ju jv iq jw b jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn ms kp kq kr ij bi translated">对于Minikube，有几种解决方案:</p><ul class=""><li id="3877" class="mt mu iq jw b jx jy kb kc kf mv kj mw kn mx kr my mz na nb bi translated">使用<code class="fe lo lp lq le b"><a class="ae nc" href="https://translate.google.com/website?sl=uk&amp;tl=ru&amp;hl=en&amp;client=webapp&amp;u=https://minikube.sigs.k8s.io/docs/handbook/accessing/%23using-minikube-tunnel" rel="noopener ugc nofollow" target="_blank">minikube tunnel</a></code> -将在Kubernetes中的主机和服务之间创建一个隧道</li><li id="b8ef" class="mt mu iq jw b jx nd kb ne kf nf kj ng kn nh kr my mz na nb bi translated">或者<code class="fe lo lp lq le b"><a class="ae nc" href="https://translate.google.com/website?sl=uk&amp;tl=ru&amp;hl=en&amp;client=webapp&amp;u=https://minikube.sigs.k8s.io/docs/commands/service/" rel="noopener ugc nofollow" target="_blank">minikube service</a></code>——获得一个直接的网址连接</li><li id="6a6e" class="mt mu iq jw b jx nd kb ne kf nf kj ng kn nh kr my mz na nb bi translated">或者设置<code class="fe lo lp lq le b"><a class="ae nc" href="https://translate.google.com/website?sl=uk&amp;tl=ru&amp;hl=en&amp;client=webapp&amp;u=https://kubernetes.io/docs/concepts/services-networking/service/%23external-ips" rel="noopener ugc nofollow" target="_blank">externalIPs</a></code> -用于Kubernetes负载平衡器服务-手动配置</li></ul><p id="c0b3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们尝试一切。</p><h2 id="e53a" class="ni lj iq bd ls nj nk dn lw nl nm dp ma kf nn no me kj np nq mi kn nr ns mm nt bi translated">迷你库贝隧道</h2><p id="0e48" class="pw-post-body-paragraph ju jv iq jw b jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn ms kp kq kr ij bi translated">检查主机上的路线:</p><pre class="kz la lb lc gt ld le lf bn lg lh bi"><span id="d758" class="li lj iq le b be lk ll l lm ln">$ route -n<br/>Kernel IP routing table<br/>Destination Gateway Genmask Flags Metric Ref Use Iface<br/>0.0.0.0 192.168.3.1 0.0.0.0 UG 100 0 0 enp38s0<br/>172.17.0.0 0.0.0.0 255.255.0.0 U 0 0 0 docker0<br/>172.18.0.0 0.0.0.0 255.255.0.0 U 0 0 0 br-9c291321e71a]<br/>192.168.3.0 0.0.0.0 255.255.255.0 U 100 0 0 enp38s0<br/>192.168.59.0 0.0.0.0 255.255.255.0 U 0 0 0 vboxnet0</span></pre><p id="cdbe" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这里可以看到我们的VirtualBox的路线— <code class="fe lo lp lq le b">192.168.59.0 0.0.0.0 255.255.255.0 U 0 0 0 vboxnet0</code>。</p><p id="13ea" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">发射<code class="fe lo lp lq le b">tunnel</code>:</p><pre class="kz la lb lc gt ld le lf bn lg lh bi"><span id="8a92" class="li lj iq le b be lk ll l lm ln">$ minikube tunnel<br/>[sudo] password for setevoy:<br/>Status:<br/>machine: minikube<br/>pid: 333552<br/>route: 10.96.0.0/12 -&gt; 192.168.59.107<br/>minikube: Running<br/>services: [pritunl]<br/>errors:<br/>minikube: no errors<br/>router: no errors<br/>loadbalancer emulator: no errors<br/>…</span></pre><p id="0924" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在检查路由——有一条通过<em class="kv"> 192.168.59.107 </em>到网络<em class="kv">10 . 96 . 0 . 0</em>(CIDR)的新路由——这是一个运行Minikube本身的VirtualBox虚拟机:</p><pre class="kz la lb lc gt ld le lf bn lg lh bi"><span id="f947" class="li lj iq le b be lk ll l lm ln">$ route -n<br/>Kernel IP routing table<br/>Destination Gateway Genmask Flags Metric Ref Use Iface<br/>0.0.0.0 192.168.3.1 0.0.0.0 UG 100 0 0 enp38s0<br/>10.96.0.0 192.168.59.107 255.240.0.0 UG 0 0 0 vboxnet0<br/>172.17.0.0 0.0.0.0 255.255.0.0 U 0 0 0 docker0<br/>172.18.0.0 0.0.0.0 255.255.0.0 U 0 0 0 br-9c291321e71a<br/>192.168.3.0 0.0.0.0 255.255.255.0 U 100 0 0 enp38s0<br/>192.168.59.0 0.0.0.0 255.255.255.0 U 0 0 0 vboxnet0</span></pre><p id="2163" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">立即检查Kubernetes负载平衡器:</p><pre class="kz la lb lc gt ld le lf bn lg lh bi"><span id="441b" class="li lj iq le b be lk ll l lm ln">$ kubectl -n pritunl-local get svc pritunl<br/>NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE<br/>pritunl LoadBalancer 10.102.129.25 10.102.129.25 1194:30166/TCP 54m</span></pre><p id="4577" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="kv">“管用！”</em></p><h2 id="7081" class="ni lj iq bd ls nj nk dn lw nl nm dp ma kf nn no me kj np nq mi kn nr ns mm nt bi translated">迷你库服务</h2><p id="de83" class="pw-post-body-paragraph ju jv iq jw b jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn ms kp kq kr ij bi translated">运行<code class="fe lo lp lq le b">minikube service</code>，指定服务的名称空间和名称——Minicube将返回连接的URL给我们:</p><pre class="kz la lb lc gt ld le lf bn lg lh bi"><span id="defd" class="li lj iq le b be lk ll l lm ln">$ minikube service -n pritunl-local pritunl<br/>| — — — — — — — -| — — — — -| — — — — — — — | — — — — — — — — — — — — — — -|<br/>| NAMESPACE | NAME | TARGET PORT | URL |<br/>| — — — — — — — -| — — — — -| — — — — — — — | — — — — — — — — — — — — — — -|<br/>| pritunl-local | pritunl | openvpn/1194 | http://192.168.59.108:32350 |<br/>| — — — — — — — -| — — — — -| — — — — — — — | — — — — — — — — — — — — — — -|<br/>🎉 Opening service pritunl-local/pritunl in default browser…</span></pre><p id="c142" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里，<em class="kv"> 192.168.59.108 </em>是我们VirtualBox服务器的地址，<em class="kv"> 32350 </em>是上面的NodePort，运行的是Pritunl服务器。</p><p id="f665" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您还可以使用<code class="fe lo lp lq le b">list</code>列出所有Kubernetes服务:</p><pre class="kz la lb lc gt ld le lf bn lg lh bi"><span id="46f1" class="li lj iq le b be lk ll l lm ln">$ minikube service -n pritunl-local list<br/>| — — — — — — — -| — — — — — — — — -| — — — — — — — | — — — — — — — — — — — — — — -|<br/>| NAMESPACE | NAME | TARGET PORT | URL |<br/>| — — — — — — — -| — — — — — — — — -| — — — — — — — | — — — — — — — — — — — — — — -|<br/>| pritunl-local | pritunl | openvpn/1194 | http://192.168.59.108:32350 |<br/>| pritunl-local | pritunl-mongodb | No node port |<br/>| pritunl-local | pritunl-web | No node port |<br/>| — — — — — — — -| — — — — — — — — -| — — — — — — — | — — — — — — — — — — — — — — -|</span></pre><p id="dd61" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">或者在一行而不是一个表格中获取URL:</p><pre class="kz la lb lc gt ld le lf bn lg lh bi"><span id="5058" class="li lj iq le b be lk ll l lm ln">$ kubectl -n priminikube service -n pritunl-local pritunl — url<br/>http://192.168.59.108:32350</span></pre><p id="5aca" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">尝试连接:</p><pre class="kz la lb lc gt ld le lf bn lg lh bi"><span id="74cb" class="li lj iq le b be lk ll l lm ln">$ telnet 192.168.59.108 32350<br/>Trying 192.168.59.108…<br/>Connected to 192.168.59.108.<br/>Escape character is ‘^]’.</span></pre><p id="db4c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Pritunl日志:</p><figure class="kz la lb lc gt jr gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/1579d1d85ead1a0718e2a54997d8e59f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/0*DpYf1CSo_SN5REC9.png"/></div></figure><p id="8f5a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="kv">“管用！”</em></p><h2 id="f2a3" class="ni lj iq bd ls nj nk dn lw nl nm dp ma kf nn no me kj np nq mi kn nr ns mm nt bi translated">负载平衡器<code class="fe lo lp lq le b">externalIPs</code></h2><p id="c2e1" class="pw-post-body-paragraph ju jv iq jw b jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn ms kp kq kr ij bi translated">获取VirtualBox计算机的IP:</p><pre class="kz la lb lc gt ld le lf bn lg lh bi"><span id="ac20" class="li lj iq le b be lk ll l lm ln">$ minikube ip<br/>192.168.59.108</span></pre><p id="9575" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">编辑负载平衡器:</p><pre class="kz la lb lc gt ld le lf bn lg lh bi"><span id="1ee1" class="li lj iq le b be lk ll l lm ln">$ kubectl -n pritunl-local edit svc pritunl</span></pre><p id="3a1d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">设置<code class="fe lo lp lq le b">externalIPs</code>:</p><pre class="kz la lb lc gt ld le nv nw aw nx bi"><span id="0995" class="ni lj iq le b gy ny nz l oa ln">...<br/>  externalIPs:<br/>  - 192.168.59.108<br/>...</span></pre><p id="c7d3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">保存，检查服务本身:</p><pre class="kz la lb lc gt ld le lf bn lg lh bi"><span id="36ec" class="li lj iq le b be lk ll l lm ln">$ kubectl -n pritunl-local get svc pritunl<br/>NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE<br/>pritunl LoadBalancer 10.104.33.93 192.168.59.108 1194:32350/TCP 81m</span></pre><p id="34d8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">并检查连接:</p><pre class="kz la lb lc gt ld le lf bn lg lh bi"><span id="8b30" class="li lj iq le b be lk ll l lm ln">$ telnet 192.168.59.108 1194<br/>Trying 192.168.59.108…<br/>Connected to 192.168.59.108.<br/>Escape character is ‘^]’.</span></pre><p id="67bb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="kv">“管用！”</em></p><p id="8bd4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">完成了。</p></div><div class="ab cl ob oc hu od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="ij ik il im in"><p id="a42d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="kv">最初发布于</em> <a class="ae nc" href="https://rtfm.co.ua/en/kubernetes-minikube-and-a-loadbalancer-in-the-pending-status/" rel="noopener ugc nofollow" target="_blank"> <em class="kv"> RTFM: Linux、DevOps、系统管理</em> </a> <em class="kv">。</em></p></div></div>    
</body>
</html>