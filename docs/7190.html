<html>
<head>
<title>Terraform Tutorial — Part 2 — Providers and Resources</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Terraform教程—第2部分—提供商和资源</h1>
<blockquote>原文：<a href="https://itnext.io/terraform-tutorial-part-2-providers-and-resources-30121e28359b?source=collection_archive---------1-----------------------#2022-07-10">https://itnext.io/terraform-tutorial-part-2-providers-and-resources-30121e28359b?source=collection_archive---------1-----------------------#2022-07-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/41c9d380d66f15ce3a617460c9f8c65f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ubPEM_ajVaqE9J6C2m1eKA.png"/></div></div></figure><p id="afb5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我谈到了平台提供者和资源。如果你没有看上一篇文章，那么是时候看完再继续这篇文章了。你可以在下面的GitHub资源库中找到所有的Terraform教程及其示例。</p><div class="kw kx gp gr ky kz"><a href="https://github.com/ssbostan/terraform-tutorial" rel="noopener  ugc nofollow" target="_blank"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">GitHub-ssbo stan/terraform-tutorial:最完整的terra form教程，参考，牛逼…</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">如果你觉得有用，就看星星。星星星星星星。Terraform教程的参考和示例库…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">github.com</p></div></div><div class="li l"><div class="lj l lk ll lm li ln jw kz"/></div></div></a></div><h1 id="6527" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">什么是提供者，它做什么？</h1><p id="9d27" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">提供商是Terraform的重要组成部分。一方面，他们从平台上获得他们应该做的事情，另一方面，他们与真正的基础设施、软件等进行交流。，要做实实在在的行动。他们知道Terraform生命周期的真实世界方面的一切。例如，当您编写Terraform代码以在AWS中创建EC2实例时，AWS提供者知道如何连接到AWS API，向其进行身份验证，应该调用哪个端点来创建EC2实例，并且它知道AWS API响应等。所以，如果你想把Terraform和云环境、基础设施、软件等整合起来。，你需要它的提供者使平台能够与之通信。Terraform有大量的提供者，他们分为三种类型。<strong class="ka ir">官方提供者</strong>由HashiCorp团队官方开发、维护和提供。<strong class="ka ir">验证提供者</strong>由软件官方团队开发、维护和分发(例如Cloudflare提供者由Cloudflare公司提供)。<strong class="ka ir">社区提供者</strong>由像我、你或每个人这样的第三方开发、维护和分发。</p><p id="5484" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以在Terraform注册表中找到所有可用的提供程序:</p><p id="284f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae mr" href="https://registry.terraform.io/" rel="noopener ugc nofollow" target="_blank">https://registry . terraform . io</a></p><h1 id="f571" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">什么是资源，它有什么作用？</h1><p id="ebad" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">资源是一个抽象的实体，它指向现实世界中的某些东西。它可能指向VMware基础架构中的一个虚拟机、本地系统中的一个文件、Grafana仪表板中的一个用户、AWS云中的一个数据库，有时，“在空资源的情况下”它什么也不指向。那么，你如何找到并使用它们呢？实际上，这取决于提供商。每个平台提供商可以提供一个或多个资源。例如，AWS提供商提供了大量资源，使您能够在AWS云服务中做任何事情。您可以在提供商的文档中找到提供商提供的所有资源。例如，它是<a class="ae mr" href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs" rel="noopener ugc nofollow" target="_blank"> AWS </a>文档页面。</p><h1 id="41a9" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">关于资源块的一些事情:</h1><p id="1bee" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">Terraform资源块需要两个参数。资源名称和对象/实例名称。资源名来自提供者，对象名用于定义所用资源的实例。对象/实例名称在资源的当前范围内应该是唯一的。我会解释“什么是范围？”在以后的文章中，当我解释Terraform模块时。现在，请记住，您不能用相同的名称定义一个资源的两个或多个实例。例如，在使用“aws_instance”资源的情况下，不能创建同名的两个实例。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="27d4" class="nb lp iq mx b gy nc nd l ne nf">resource "<strong class="mx ir">RESOURCE_NAME</strong>" "<strong class="mx ir">OBJECT_NAME</strong>" {<br/>  argument1 = value1<br/>  argument2 = value2<br/>  nested_block1 {<br/>    argument1 = value1<br/>    argument2 = value2<br/>  }<br/>  nested_block2 {<br/>    argument1 = value1<br/>    argument2 = value2<br/>  }</span></pre><p id="717a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，下面的代码为您创建了一个私钥。</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="1223" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要部署它，请运行以下命令:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="3d20" class="nb lp iq mx b gy nc nd l ne nf">terraform init</span><span id="9ad4" class="nb lp iq mx b gy ni nd l ne nf">terraform apply</span></pre><p id="47f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行<code class="fe nj nk nl mx b">terraform init</code>命令后，您可以看到Terraform检测到所需的提供程序并自动安装它们。对吗？几乎没有！实际上，Terraform能够自动安装官方提供者，如果你想使用任何非官方提供者“认证提供者或社区提供者”,你应该在terraform 块的<strong class="ka ir"> required_providers </strong>块中定义它们。</p><p id="ec21" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注:所有官方提供商都存储在<strong class="ka ir"> hashicorp </strong>账户中。</p><figure class="ms mt mu mv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/c110db3277ca0bdc2000d6f9cad30685.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*upO47GPRQc5sykiPvJ3S7A.png"/></div></div></figure><p id="f0c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">另一个问题是Terraform如何意识到它应该安装<strong class="ka ir"> tls </strong> provider？Terraform读取资源名的第一部分来检测提供者。例如，如果您定义了tls_private_key资源，它会读取第一个下划线(_)之前的第一部分，并将其视为提供程序名称。这是适用于所有资源和提供商的全局规则。</p><p id="78d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们试试另一个例子:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="c410" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要部署它，请运行以下命令:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="1858" class="nb lp iq mx b gy nc nd l ne nf">terraform init</span></pre><p id="1e8e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">发生了什么事？</p><figure class="ms mt mu mv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/e47fe3409b8ed38d0ac87109c4039669.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yGjKiAg0YxW12kDnKuSe-w.png"/></div></div></figure><p id="0c1b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以看到所需的提供商没有自动安装，因为它不是官方的Terraform提供商，并且不在他们的官方帐户中。因此，我们必须定义它来告诉Terraform应该在哪里找到提供者并安装它。为了解决上面的例子，我们需要定义docker提供者源。</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="ffe4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们再次尝试init命令:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="b732" class="nb lp iq mx b gy nc nd l ne nf">terraform init</span></pre><p id="b5b9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以看到docker提供程序安装成功。</p><figure class="ms mt mu mv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/7479edeb46f044cd529af3da56d27a08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BtunSnmsBGhExnsRrEsMKw.png"/></div></div></figure><p id="1500" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">重要提示:</strong> <br/>真正的基础设施应该在使用提供者之前就存在于现实世界中。例如，要使用Docker提供程序，您必须在使用之前在您的系统上安装Docker。</p><h1 id="4581" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">Terraform提供商配置:</h1><p id="183a" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">大多数提供商在使用前需要配置。例如，您应该为AWS提供者配置访问密钥、秘密密钥、区域等。，或者Kubernetes提供者提供API地址、用户名、密码或其他信息。在上面的例子中，docker，Terraform如何识别在您的本地机器上部署Docker容器，以及我们如何告诉它部署到另一个Docker主机？所有这些都可以通过provider块进行配置。您可以为每个提供程序添加零个或多个提供程序块。有些提供程序带有默认的提供程序配置，您可能不需要更改它们，而有些提供程序需要配置。您可以从提供者文档中检查它。</p><p id="3cda" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行以下代码并查看错误:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="4975" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以使用以下命令运行它:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="38d3" class="nb lp iq mx b gy nc nd l ne nf">terraform init</span><span id="460b" class="nb lp iq mx b gy ni nd l ne nf">terraform apply</span></pre><p id="fcb2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">发生了什么事？</p><figure class="ms mt mu mv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/bad6f2263c8b6bbdce9a4b49b0a2f879.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cpc9DVtHu-8ASN1IDrAIIg.png"/></div></div></figure><p id="88ad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你得到了一个错误，因为Grafana提供者需要一个配置，但是为什么你在应用Docker容器时没有得到任何错误，前面的代码？是因为<strong class="ka ir">默认</strong>配置。Docker provider带有一个默认配置，指向您的本地Docker主机，但是在Grafana的情况下，在应用之前应该设置一些必需的参数。</p><p id="e204" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">那么，我该如何配置提供商呢？</strong> <br/>您可以在提供者文档页面上找到配置提供者的所有可用参数。当您获得一些关于提供者配置的知识时，您可以在terraform代码的提供者块中定义它们。例如，求解上面的代码:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="de02" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如您所见，我告诉了Terraform提供者什么是Grafana仪表板地址和用户认证细节。应用上述代码后，您可以看到代码已成功部署。请注意，您应该在使用上述代码之前部署Grafana。</p><figure class="ms mt mu mv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/73d385bd1be5e57c45852653482d245a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WFvW2jX5GOL8ldGrgJBD9A.png"/></div></div></figure><p id="1a81" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，登录Grafana仪表板并查看用户页面。应该会创建一个新用户“ssbostan ”,并显示在您的仪表板中。</p><figure class="ms mt mu mv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/fe594f04392ccae11922b13c26a74d9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EukfvJsA66Q_Zd98KhlNrg.png"/></div></div></figure><p id="0921" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">若要删除用户，请运行以下代码:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="ebda" class="nb lp iq mx b gy nc nd l ne nf">terraform destroy</span></pre><p id="681e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就是这样。你用地形做到了。</p><h1 id="d6ae" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">死信:</h1><p id="c50b" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">我称之为一纸空文是因为你感染了Terraform:)现在你对Terraform，它的提供者和资源有了一个大的了解。要成为人形忍者，我们还有很长的路要走。如果你有任何问题或需要任何帮助，只要平我。此外，您可以在下面的资源库中找到所有示例和相关文章。启动它，并将其发送给你的朋友，同事和需要学习Terraform的人。</p><p id="2595" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关注我的LinkedIn<a class="ae mr" href="https://www.linkedin.com/in/ssbostan" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/ssbostan</a></p><div class="kw kx gp gr ky kz"><a href="https://github.com/ssbostan/terraform-tutorial" rel="noopener  ugc nofollow" target="_blank"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">GitHub-ssbo stan/terraform-tutorial:最完整的terra form教程，参考，牛逼…</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">如果你觉得有用，就看星星。星星星星星星。Terraform教程的参考和示例库…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">github.com</p></div></div><div class="li l"><div class="no l lk ll lm li ln jw kz"/></div></div></a></div></div></div>    
</body>
</html>