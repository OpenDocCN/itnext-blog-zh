<html>
<head>
<title>Anthos Service Mesh — Configuring global settings</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Anthos服务网格—配置全局设置</h1>
<blockquote>原文：<a href="https://itnext.io/anthos-service-mesh-configuring-global-settings-e03adc6e0b22?source=collection_archive---------4-----------------------#2022-07-18">https://itnext.io/anthos-service-mesh-configuring-global-settings-e03adc6e0b22?source=collection_archive---------4-----------------------#2022-07-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="17c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近，当我在使用Google托管控制平面的多集群设置中解决服务发现问题时，我需要配置网格范围的设置。我不会进入实际的故事，那是另一个博客的主题，因为我想把重点放在配置步骤上</p><p id="4c1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当查看与Anthos Service Mesh相关的文档时，我经常依赖于官方的Istio文档，因为它更完整，对于Google来说复制它的全部没有意义。然而，我希望谷歌能让ASM的特定页面更加流行……稍后会有更多的介绍。</p><p id="6207" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在配置全局设置的背景下，我针对我遇到的问题设计了这两页</p><ul class=""><li id="5675" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">https://istio . io/latest/docs/ops/configuration/traffic-management/multi cluster/—这一页概述了我需要做出的更改……但对如何做出更改却知之甚少，除非你已经知道如何/在哪里做出更改。基本上，我想将一些名称空间配置为clusterLocal，并“禁用”名称空间一致性的影响。</li><li id="5c90" class="kl km iq jp b jq kv ju kw jy kx kc ky kg kz kk kq kr ks kt bi translated"><a class="ae ku" href="https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#MeshConfig-ServiceSettings-Settings" rel="noopener ugc nofollow" target="_blank">https://istio . io/latest/docs/reference/config/istio . mesh . v1 alpha 1/# MeshConfig-service Settings-Settings</a>—所有mesh config设置的参考页面</li></ul><p id="7209" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我知道了变化是什么，我必须弄清楚如何变化。许多页面都引用了IstioOperator CRD，您可以在那里创建一个自定义资源，并让Istio为您翻译它。不幸的是，在受管理的控制平面中，该操作符是隐藏的/不可用的。然而，这是一个有助于找到方法的线索。这是我真正想要的配置</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div class="gh gi la"><img src="../Images/00d47c907b48f0cdeed450fe02185fca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*zCDUHKI6c1jof8vqmOqkGQ.png"/></div><figcaption class="li lj gj gh gi lk ll bd b be z dk translated">将ArgoCD命名空间配置为集群本地</figcaption></figure><p id="d41a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我找到了这个<a class="ae ku" href="https://cloud.google.com/service-mesh/docs/managed/enable-managed-anthos-service-mesh-optional-features" rel="noopener ugc nofollow" target="_blank">页面</a>，它介绍了如何在托管Anthos服务网格上配置可选功能。它只有很少的配置示例，并且与Istio参考资料不太一致，尽管在配置模式中需要一些翻译。</p><p id="d084" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后一个同行发现了一个关于从IstioOperator迁移到ASM的<a class="ae ku" href="https://cloud.google.com/service-mesh/docs/managed/migrate-istio-operator" rel="noopener ugc nofollow" target="_blank">页面</a>。现在我有了一个FROM，一个翻译机制，我离如何排序更近了！</p><pre class="lb lc ld le gt lm ln lo lp aw lq bi"><span id="2a9b" class="lr ls iq ln b gy lt lu l lv lw">asmcli experimental mcp-migrate-check -f clusterlocal.yaml</span></pre><p id="9ce7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行上面的命令将IstioOperator配置转换为Istio ConfigMap(参见下面的代码片段)。我用我们的GitOps工具部署了它。不料，这第一次尝试就成功了！</p><pre class="lb lc ld le gt lm ln lo lp aw lq bi"><span id="be94" class="lr ls iq ln b gy lt lu l lv lw">apiVersion: v1<br/>kind: ConfigMap<br/>metadata:<br/>  name: istio-asm-managed<br/>  namespace: istio-system<br/>data:<br/>  mesh: |-<br/>    serviceSettings:<br/>    - hosts:<br/>      - '*.argocd-system.svc.cluster.local'</span></pre></div></div>    
</body>
</html>