<html>
<head>
<title>Catcher e2e tests tool for beginners</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">捕手e2e测试工具的初学者</h1>
<blockquote>原文：<a href="https://itnext.io/catcher-e2e-tests-tool-for-beginners-359413721e28?source=collection_archive---------9-----------------------#2020-05-11">https://itnext.io/catcher-e2e-tests-tool-for-beginners-359413721e28?source=collection_archive---------9-----------------------#2020-05-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/557be12294ad322b1b66cd9753f57b83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dEfuHOPJlpf8WumZ.png"/></div></div></figure><p id="602c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它是一个端到端的测试工具，专门设计用于测试包含许多组件的系统。最初是作为端到端微服务测试工具开发的，它非常适合数据管道测试的需求。这里我们描述基本的<a class="ae kw" href="https://github.com/comtihon/catcher" rel="noopener ugc nofollow" target="_blank">捕捉器</a>概念。</p><p id="c4fd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Catcher是一个模块化系统。它有捕捉器自带的核心模块和可根据需要单独安装的<a class="ae kw" href="https://github.com/comtihon/catcher_modules" rel="noopener ugc nofollow" target="_blank">附加</a>模块。</p><h1 id="b81e" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">步伐</h1><p id="0e1c" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在捕手术语模块和步骤是相同的。<br/>每个捕手测试都可以有下一个步骤类型:</p><ul class=""><li id="ea9e" class="ma mb iq ka b kb kc kf kg kj mc kn md kr me kv mf mg mh mi bi translated">内置岩心捕捉器步骤。包括<a class="ae kw" href="https://catcher-test-tool.readthedocs.io/en/latest/source/internal_modules.html#module-catcher.steps.check" rel="noopener ugc nofollow" target="_blank">检查</a>、<a class="ae kw" href="https://catcher-test-tool.readthedocs.io/en/latest/source/internal_modules.html#sh-run-shell-command" rel="noopener ugc nofollow" target="_blank"> sh </a>、<a class="ae kw" href="https://catcher-test-tool.readthedocs.io/en/latest/source/internal_modules.html#loop-loop-over-the-data" rel="noopener ugc nofollow" target="_blank">循环</a>、<a class="ae kw" href="https://catcher-test-tool.readthedocs.io/en/latest/source/internal_modules.html#http-perform-http-request" rel="noopener ugc nofollow" target="_blank"> http </a>、<a class="ae kw" href="https://catcher-test-tool.readthedocs.io/en/latest/source/internal_modules.html#wait-delay-testcase-execution" rel="noopener ugc nofollow" target="_blank">等待</a>和<a class="ae kw" href="https://catcher-test-tool.readthedocs.io/en/latest/source/internal_modules.html" rel="noopener ugc nofollow" target="_blank">其他</a>等基本步骤；</li><li id="70c1" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">延伸捕手步骤。它们的实现更复杂，有时需要在系统中安装依赖项或驱动程序。比如:<a class="ae kw" href="https://catcher-modules.readthedocs.io/en/latest/source/catcher_modules.mq.html#catcher_modules.mq.kafka.Kafka" rel="noopener ugc nofollow" target="_blank">卡夫卡</a>，<a class="ae kw" href="https://catcher-modules.readthedocs.io/en/latest/source/catcher_modules.service.html#catcher-modules-service-elastic-module" rel="noopener ugc nofollow" target="_blank">弹力</a>，<a class="ae kw" href="https://catcher-modules.readthedocs.io/en/latest/source/catcher_modules.service.html#catcher-modules-service-docker-module" rel="noopener ugc nofollow" target="_blank"> docker </a>，<a class="ae kw" href="https://catcher-modules.readthedocs.io/en/latest/source/catcher_modules.database.html#catcher-modules-database-mongo-module" rel="noopener ugc nofollow" target="_blank"> mongo </a>，<a class="ae kw" href="https://catcher-modules.readthedocs.io/en/latest/source/catcher_modules.service.html#catcher-modules-service-s3-module" rel="noopener ugc nofollow" target="_blank"> s3 </a>等。</li><li id="0ff2" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">您的<a class="ae kw" href="https://catcher-test-tool.readthedocs.io/en/latest/source/modules.html" rel="noopener ugc nofollow" target="_blank">自定义</a>步骤，用Python、Java、sh或任何您喜欢的语言编写。</li></ul><p id="a42f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">测试的简单示例如下:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="aa40" class="mx ky iq mt b gy my mz l na nb">steps: <br/>  - http: # load answers via post body <br/>      post: <br/>        url: 'http://127.0.0.1:8080/load' <br/>        body_from_file: "data/answers.json" <br/>  - elastic: # check in the logs that answers were loaded <br/>      search: <br/>        url: 'http://127.0.0.1:9200' <br/>        index: test <br/>        query: <br/>          match: {payload : "answers loaded successfully"}</span></pre><h1 id="776c" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">变量</h1><p id="7a81" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">具有硬编码值的步骤没有那么有用。变量是捕手的关键特征之一。完全支持Jinja2 模板。尽可能多地使用变量，以避免代码重复，并使事情变得灵活。</p><h2 id="ab61" class="mx ky iq bd kz nc nd dn ld ne nf dp lh kj ng nh ll kn ni nj lp kr nk nl lt nm bi translated">测试局部变量</h2><p id="d24f" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">通过在<code class="fe nn no np mt b">variables</code>部分定义变量，每一步都可以使用现有的变量。它们可以是静态的(如<code class="fe nn no np mt b">token</code>)或计算的(如<code class="fe nn no np mt b">user_email</code>)。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="eaef" class="mx ky iq mt b gy my mz l na nb">variables: <br/>  user_email: '{{ random("email") }}' <br/>  token: 'my_secret_token' <br/>steps: <br/>  - http: <br/>      post: <br/>      headers: {Content-Type: 'application/json', Authorization: '{{ token }}'} <br/>      url: 'http://127.0.0.1:8080?user={{ user_email }}' <br/>      body: {'foo': bar}</span></pre><p id="823d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">每个步骤还可以将其输出(或部分输出)注册为一个新变量:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="b2f5" class="mx ky iq mt b gy my mz l na nb">variables: <br/>  user_email: '{{ random("email") }}' <br/>  token: 'my_secret_token' <br/>steps: <br/>  - mongo: # search MongoDb for user <br/>      request: <br/>        conf: <br/>          database: test <br/>          username: test <br/>          password: test <br/>          host: localhost <br/>          port: 27017 <br/>        collection: 'users' <br/>        find_one: {'user_id': '{{ user_email }}'} <br/>      register: {found_user: '{{ OUTPUT }}'} <br/>  - check: # check token was saved <br/>      equals: {the: '{{ found_user["token"] }}', is: "{{ token }}"}</span></pre><p id="cb53" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们仔细看看这条线:<code class="fe nn no np mt b">register: {found_user: '{{ OUTPUT }}'}</code>。这里<code class="fe nn no np mt b">OUTPUT</code>系统变量存储mongo step的输出。我们将其注册为一个新变量<code class="fe nn no np mt b">found_user</code>。</p><p id="5213" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">OUTPUT是系统变量，用于存储每个步骤的输出<strong class="ka ir">。</strong></p><h2 id="dfbc" class="mx ky iq bd kz nc nd dn ld ne nf dp lh kj ng nh ll kn ni nj lp kr nk nl lt nm bi translated">系统变量</h2><p id="9b51" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Catcher还可以访问您的系统环境变量。F.e .运行<code class="fe nn no np mt b">export MY_ENV_HOST=localhost &amp;&amp; catcher my_test.yml</code>,您的环境变量将被选取。您可以通过运行带有<strong class="ka ir"> -s </strong>标志:<code class="fe nn no np mt b">catcher -s false my_test.yml</code>的Catcher来禁用此行为。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="45fd" class="mx ky iq mt b gy my mz l na nb">steps: <br/>  - http: # load answers via post body <br/>      post: <br/>        url: 'http://{{ MY_ENV_HOST }}/load'</span></pre><p id="f4a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行测试时，使用<strong class="ka ir"> -e </strong>参数覆盖变量:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="28bd" class="mx ky iq mt b gy my mz l na nb">catcher -e var=value -e other_var=other_value tests/</span></pre><p id="b04b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">覆盖优先级是:</p><ol class=""><li id="1d9c" class="ma mb iq ka b kb kc kf kg kj mc kn md kr me kv nq mg mh mi bi translated">命令行变量覆盖下面的所有内容</li><li id="9a8e" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv nq mg mh mi bi translated">新注册的变量会覆盖下面的所有内容</li><li id="c8c6" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv nq mg mh mi bi translated">测试局部变量覆盖下面的所有内容</li><li id="32b7" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv nq mg mh mi bi translated">库存变量覆盖下面的所有内容</li><li id="b0a8" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv nq mg mh mi bi translated">环境变量不覆盖任何东西</li></ol><h1 id="0954" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">存货</h1><p id="22b7" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">正如您可能注意到的，无论是在测试中还是在测试变量中，硬编码服务配置都不是那么灵活，因为它们对于每个环境都是不同的。Catcher使用库存文件进行特定于环境的配置。库存储存在<code class="fe nn no np mt b">inventory</code>文件夹中。它们也支持模板。</p><p id="784e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以创建库存档案:<code class="fe nn no np mt b">local.yml</code>并在其中设置变量:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="ccef" class="mx ky iq mt b gy my mz l na nb">airflow_web: 'http://127.0.0.1:8080' <br/>s3_config: <br/>  url: <a class="ae kw" href="http://127.0.0.1:9001" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:9001</a> <br/>  key_id: minio <br/>  secret_key: minio123</span></pre><p id="1cd9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并且用变量创建<code class="fe nn no np mt b">develop_aws.yml</code>:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="2db3" class="mx ky iq mt b gy my mz l na nb">airflow_web: 'http://my_airflow:8080' <br/>s3_config: <br/>  key_id: my_real_aws_key_id <br/>  secret_key: my_real_aws_secrey</span></pre><p id="a6ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行Catcher时，您可以通过<strong class="ka ir"> -i </strong>参数指定库存:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="6bfd" class="mx ky iq mt b gy my mz l na nb">catcher -i inventory/local.yml test</span></pre><h1 id="1281" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">报告</h1><p id="51d7" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">有时，当您编写测试时，您需要在每一步之后查看系统中正在发生什么。目前，Catcher只支持json输出。使用<strong class="ka ir"> -p </strong> <code class="fe nn no np mt b">json</code>选项运行:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="38c2" class="mx ky iq mt b gy my mz l na nb">catcher -p json my_test.yml</span></pre><p id="0eed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并查看<code class="fe nn no np mt b"> reports</code>目录中的json分步报告。它将包含每一步的所有输入和输出变量。</p><h1 id="f8b8" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">装置</h1><h2 id="5418" class="mx ky iq bd kz nc nd dn ld ne nf dp lh kj ng nh ll kn ni nj lp kr nk nl lt nm bi translated">码头工人</h2><p id="7495" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">为了快速开始，你可以使用捕手Docker <a class="ae kw" href="https://hub.docker.com/repository/docker/comtihon/catcher" rel="noopener ugc nofollow" target="_blank">图像</a>。它包括catcher-core、所有扩展模块、驱动程序和依赖项。它随时可以使用——您所需要做的就是用您的测试、清单等挂载您的本地目录。<br/>运行它的完整命令是:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="b10c" class="mx ky iq mt b gy my mz l na nb">docker run -v $(pwd)/inventory:/opt/catcher/inventory <br/>           -v $(pwd)/resources:/opt/catcher/resources <br/>           -v $(pwd)/test:/opt/catcher/tests <br/>           -v $(pwd)/steps:/opt/catcher/steps <br/>           -v $(pwd)/reports:/opt/catcher/reports catcher <br/>           -i inventory/my_inventory.yml tests</span></pre><p id="9e16" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Docker中的Catcher通常用于CI，而开发人员更喜欢在本地安装Catcher来编写测试。</p><h2 id="e6bf" class="mx ky iq bd kz nc nd dn ld ne nf dp lh kj ng nh ll kn ni nj lp kr nk nl lt nm bi translated">当地的</h2><p id="f940" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">对于本地安装，请确保您拥有Python 3.5以上版本。没有的话可以用<a class="ae kw" href="https://docs.conda.io/en/latest/miniconda.html" rel="noopener ugc nofollow" target="_blank"> miniconda </a>。</p><p id="ca95" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行<code class="fe nn no np mt b">pip install catcher</code>安装捕捉器芯。它将安装捕捉器和基本<a class="ae kw" href="https://catcher-test-tool.readthedocs.io/en/latest/source/internal_modules.html" rel="noopener ugc nofollow" target="_blank">步骤</a>。如果您需要任何<a class="ae kw" href="https://catcher-modules.readthedocs.io/en/latest/genindex.html" rel="noopener ugc nofollow" target="_blank">扩展</a>步骤，您需要单独安装它们。对于卡夫卡和波斯特格雷，你必须运行<code class="fe nn no np mt b">pip install catcher_modules[kafka,postgres]</code></p><p id="f450" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一些扩展步骤还要求先安装驱动程序和系统要求。用于Oracle数据库的库。</p></div></div>    
</body>
</html>