<html>
<head>
<title>Debugging Blazor Web Assembly Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">调试Blazor Web程序集应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/debugging-blazor-web-assembly-apps-c47ef25bcb5f?source=collection_archive---------5-----------------------#2020-01-06">https://itnext.io/debugging-blazor-web-assembly-apps-c47ef25bcb5f?source=collection_archive---------5-----------------------#2020-01-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/1976bfe6de049ca345e8a4f6376def08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1JfRIWqd1_h_co-SMJq81w.png"/></div></div></figure><p id="b91f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Blazor只是另一个和其他一样的SPA框架，但是它和其他的有什么不同呢？Blazor写在<strong class="kd iu">上面。NET </strong>并且可以发布为<strong class="kd iu"> WebAssembly </strong>。用<strong class="kd iu"> C#、</strong>编写你的应用，用<strong class="kd iu">赋予它力量。NET </strong>库并将其作为<strong class="kd iu"> WebAssembly </strong>！</p><p id="2f56" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Blazor提供了两种不同的托管模式，Web Assembly和Blazor Server。Blazor-server在服务器上运行代码，使用SignalR与前端通信。这提供了容易的调试；这个应用程序就像你每天用来调试的老的好的ASP.NET核心应用程序一样。然而说到BlazorWasm，调试从来都不容易！😢</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><p id="e6e7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Blazor WebAssembly是ASP.NET核心3.1的预览版，目前调试是有限的，错误百出，有点困难。例如，您可以:</p><ul class=""><li id="75dd" class="lh li it kd b ke kf ki kj km lj kq lk ku ll ky lm ln lo lp bi translated">设置/删除断点</li><li id="45e5" class="lh li it kd b ke lq ki lr km ls kq lt ku lu ky lm ln lo lp bi translated">F10，F8调试中的步骤和恢复</li><li id="d86b" class="lh li it kd b ke lq ki lr km ls kq lt ku lu ky lm ln lo lp bi translated">观察局部变量的值，这些变量是<strong class="kd iu"> int </strong>、<strong class="kd iu"> string </strong>或<strong class="kd iu"> bool </strong></li><li id="7f89" class="lh li it kd b ke lq ki lr km ls kq lt ku lu ky lm ln lo lp bi translated">查看调用堆栈</li></ul><p id="3627" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">调试BlazorWasm应用程序时只能做几件事，这意味着你不能<strong class="kd iu">悬停查看值</strong>，不能<strong class="kd iu">进入异步</strong>方法，不能<strong class="kd iu">在浏览器控制台中评估表达式</strong>。</p><p id="c427" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">除了Blazor提供的东西之外，我还创建了一个调试库(名为“BlazeDBG”)来超越限制。首先，从Blazor提供的内容开始。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h2 id="2c44" class="lv lw it bd lx ly lz dn ma mb mc dp md km me mf mg kq mh mi mj ku mk ml mm mn bi translated">入门指南</h2><p id="6ed9" class="pw-post-body-paragraph kb kc it kd b ke mo kg kh ki mp kk kl km mq ko kp kq mr ks kt ku ms kw kx ky im bi translated">在谷歌Chrome(70版或更高版本)或微软Edge预览版中可以调试BlazorWasm。</p><p id="7506" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我在Blazor上有一个简单的剃刀页:</p><figure class="mt mu mv mw gt ju"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="1d46" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我想调试一下<code class="fe mz na nb nc b">IncrementCount</code>方法。</p><p id="8c37" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了能够调试，您需要使用调试配置文件运行Blazor应用程序。为此，在项目的根目录下打开一个终端，并执行下面的命令:</p><pre class="mt mu mv mw gt nd nc ne nf aw ng bi"><span id="31a9" class="lv lw it nc b gy nh ni l nj nk">dotnet run --configuration Debug</span></pre><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nl"><img src="../Images/c98eb22ac8ee5b1a992f7425c1b07caf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ZOBzVrtljn3HeOxbdQ_PWw.gif"/></div></div></figure><ul class=""><li id="af72" class="lh li it kd b ke kf ki kj km lj kq lk ku ll ky lm ln lo lp bi translated">导航到将在其上运行您的应用程序的URL。(https://localhost:5001)。</li><li id="1c53" class="lh li it kd b ke lq ki lr km ls kq lt ku lu ky lm ln lo lp bi translated">按下Shfit+Alt + D ( <em class="nm">上的Mac Shift + Cmd + D </em></li></ul><p id="7991" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">大多数时候，Blazor和Chrome debugger无法连接到你的应用程序，并给你一个这样的错误:</p><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/aa823d5e75b8d611e701b3ff04c1bac0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q-9ldwkgRjTv3j4-8Wldfg.png"/></div></div></figure><p id="2f7d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您看到了这个窗口，请复制该命令，并在run中使用这些参数运行Chrome:</p><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/fc16d72eb9fbe74504fd7f08d6a68609.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*cZ3POFwu8DBj-OoICRmUdQ.png"/></div></figure><pre class="mt mu mv mw gt nd nc ne nf aw ng bi"><span id="6331" class="lv lw it nc b gy nh ni l nj nk"><strong class="nc iu">chrome --remote-debugging-port=9222 --user-data-dir="\Temp\blazor-chrome-debug" http://localhost:5000/</strong></span></pre><p id="d702" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">它将打开Chrome，按下调试器组合键打开调试器。在源代码和文件中://你可以看到你的源代码，设置或删除断点来控制你的应用程序工作流。</p><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/9a52b2e082d8fd0fa09c8ecf355a4841.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*AWIApr5yr2iqp9UeU0a4Rg.gif"/></div></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">调试示例</figcaption></figure><p id="3936" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如您所见，即使悬停鼠标或添加观察器，我也看不到属性值。为了能够看到应用程序内部的值，您可以通过Blazor代码中的<code class="fe mz na nb nc b">Console.WriteLine</code>在浏览器控制台中写入数据。</p><figure class="mt mu mv mw gt ju"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="4b1f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当运行你的应用程序时(不需要调试配置文件)，每次应用程序到达<code class="fe mz na nb nc b">Console.WriteLine</code>时，它将在浏览器控制台中记录它。</p><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/68606cff3f0bcb5c0ad24b70979f00a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*7Gr2qRm-iANVyXxeQrFdZQ.gif"/></div></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">控制台日志记录</figcaption></figure><h2 id="d372" class="lv lw it bd lx ly lz dn ma mb mc dp md km me mf mg kq mh mi mj ku mk ml mm mn bi translated">错误诊断</h2><p id="7d81" class="pw-post-body-paragraph kb kc it kd b ke mo kg kh ki mp kk kl km mq ko kp kq mr ks kt ku ms kw kx ky im bi translated">考虑下面的代码:</p><pre class="mt mu mv mw gt nd nc ne nf aw ng bi"><span id="51fb" class="lv lw it nc b gy nh ni l nj nk"><a class="ae kz" href="http://twitter.com/code" rel="noopener ugc nofollow" target="_blank">@code</a> {<br/>    private int currentCount = 0;</span><span id="d1fb" class="lv lw it nc b gy nu ni l nj nk">private void IncrementCount()<br/>    {<br/>        int a = 0;<br/>        int b = 0;</span><span id="cfb6" class="lv lw it nc b gy nu ni l nj nk">currentCount = a / b;<br/>    }<br/>}</span></pre><p id="ee42" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">上面的代码会抛出一个异常。如果我们运行应用程序，您将在浏览器控制台中看到错误和堆栈状态。</p><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/7cd993d2d2c77082ac7386cccec7e73d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*afc42wGU_hEyaldEmLffug.png"/></div></div></figure><ul class=""><li id="5dfb" class="lh li it kd b ke kf ki kj km lj kq lk ku ll ky lm ln lo lp bi translated">它告诉你发生了什么异常。</li><li id="d49c" class="lh li it kd b ke lq ki lr km ls kq lt ku lu ky lm ln lo lp bi translated">您可以看到是什么方法和哪一行导致了错误。</li></ul><p id="3ed9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="nm">例如，</em> <code class="fe mz na nb nc b"><em class="nm">Attempted to divide by zero.</em></code> <em class="nm">中的异常已经抛出</em> <code class="fe mz na nb nc b"><em class="nm">Pages.Counter.IncrementCount</em></code> <em class="nm">方法中的</em> <code class="fe mz na nb nc b"><em class="nm">Counter.razor</em></code> <em class="nm">第19行。</em></p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><p id="f595" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这些是Blazor为调试提供的主要东西，但是我们知道Blazor支持<a class="ae kz" href="https://docs.microsoft.com/en-us/aspnet/core/blazor/javascript-interop?view=aspnetcore-3.1" rel="noopener ugc nofollow" target="_blank"> JavaScript interop </a>。通过注入一些JS并在C#中实现一些helper方法，我们应该能够调试更多！</p><p id="3482" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我创建了一个类，它只是通过在JS和。Blazor内部的NET。我称之为BlazeDBG。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h2 id="ba15" class="lv lw it bd lx ly lz dn ma mb mc dp md km me mf mg kq mh mi mj ku mk ml mm mn bi translated">BlazeDBG</h2><p id="ab15" class="pw-post-body-paragraph kb kc it kd b ke mo kg kh ki mp kk kl km mq ko kp kq mr ks kt ku ms kw kx ky im bi translated">从<a class="ae kz" href="https://github.com/0x414c49/BlazorDebugger" rel="noopener ugc nofollow" target="_blank"> GitHub </a>中抓取接口和类。</p><ul class=""><li id="82f4" class="lh li it kd b ke kf ki kj km lj kq lk ku ll ky lm ln lo lp bi translated">在您的服务中将IBlazeDebugger注册为Singleton。</li></ul><pre class="mt mu mv mw gt nd nc ne nf aw ng bi"><span id="d402" class="lv lw it nc b gy nh ni l nj nk">public class Startup<br/>    {<br/>        public void ConfigureServices(IServiceCollection services)<br/>        {<br/>            services.AddSingleton&lt;IBlazeDebugger, BlazeDebugger&gt;();<br/>        }<br/>    }</span></pre><ul class=""><li id="e4d5" class="lh li it kd b ke kf ki kj km lj kq lk ku ll ky lm ln lo lp bi translated">将对象注入到您的razor页面:</li></ul><pre class="mt mu mv mw gt nd nc ne nf aw ng bi"><span id="e969" class="lv lw it nc b gy nh ni l nj nk">@using BlazeDBG;<br/>@inject IBlazeDebugger BlazeDbg;</span></pre><ul class=""><li id="a3d1" class="lh li it kd b ke kf ki kj km lj kq lk ku ll ky lm ln lo lp bi translated">将您想要的任何内容记录到控制台:</li></ul><pre class="mt mu mv mw gt nd nc ne nf aw ng bi"><span id="0195" class="lv lw it nc b gy nh ni l nj nk">@code {<br/>    private int currentCount = 0;</span><span id="e5d6" class="lv lw it nc b gy nu ni l nj nk">    private void IncrementCount()<br/>    {<br/>        BlazeDbg.ConsoleLog("counterCount before", currentCount);</span><span id="f718" class="lv lw it nc b gy nu ni l nj nk">        currentCount++;</span><span id="7771" class="lv lw it nc b gy nu ni l nj nk">        BlazeDbg.ConsoleLog("counterCount after", currentCount, LogLevel.Warn);<br/>    }</span><span id="db68" class="lv lw it nc b gy nu ni l nj nk">}</span></pre><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nw"><img src="../Images/15aaee876bf8ee5e8d1e4ac758b4c996.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*tGRcwxtszMbwVhzN80HAsw.gif"/></div></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">实际调试</figcaption></figure></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h2 id="ef08" class="lv lw it bd lx ly lz dn ma mb mc dp md km me mf mg kq mh mi mj ku mk ml mm mn bi translated">注意事项:</h2><ol class=""><li id="5a1d" class="lh li it kd b ke mo ki mp km nx kq ny ku nz ky oa ln lo lp bi translated">目前MonoWasm只有。WebAssembly的. NET运行库。mono团队正在进行一个项目，将整个应用程序编译到wasm中。现在还没准备好，但将来会的。</li></ol></div></div>    
</body>
</html>