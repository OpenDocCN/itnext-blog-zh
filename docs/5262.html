<html>
<head>
<title>Tackling iPhone or iPad Images Support In HTML5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在HTML5中处理iPhone或iPad图像支持</h1>
<blockquote>原文：<a href="https://itnext.io/tackling-iphone-or-ipad-images-support-in-browser-8e3e64e9aaa1?source=collection_archive---------1-----------------------#2021-01-26">https://itnext.io/tackling-iphone-or-ipad-images-support-in-browser-8e3e64e9aaa1?source=collection_archive---------1-----------------------#2021-01-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="92ec" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">java描述语言</h2><div class=""/><div class=""><h2 id="95d3" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">在浏览器中显示HEIF/HEIC图像</h2></div><p id="3e97" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">好吧，好吧，好吧……你可能已经猜到了，HEIC和HEIF文件不被HTML5中的<code class="fe ln lo lp lq b">img</code>标记所支持。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi lr"><img src="../Images/98dc0fc8e4690ed0f681cab2679e0aa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1cHuHjWI45Dd6YGHWGQFdw.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">来源:<a class="ae mh" href="https://caniuse.com/heif" rel="noopener ugc nofollow" target="_blank">https://caniuse.com/heif</a></figcaption></figure><p id="d66d" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">最常见的情况是，你会遇到这些扩展是突发照片或任何其他苹果图像功能，生成<code class="fe ln lo lp lq b">.heic</code>或<code class="fe ln lo lp lq b">.mov</code>文件。然而，它并不严格地与苹果设备相关。</p><div class="mi mj gp gr mk ml"><a href="https://en.wikipedia.org/wiki/High_Efficiency_Image_File_Format" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">高效图像文件格式</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">比较JPEG，JPEG 2000，JPEG XR和HEIF文件在类似的文件大小文件扩展名。嘿，嘿。heifs。heic…</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">en.wikipedia.org</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz mb ml"/></div></div></a></div><p id="d55b" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在我当前的项目中，我们必须显示存储在AWS s3桶中的图像，这些图像是由我们的用户上传的。然而，HEIC上传的图像与我们的web界面(在Vue.js中开发)不兼容。对于我的同事来说，每次这类文件出现时，下载图像真的很痛苦。</p><p id="adaf" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我将向您展示我是如何克服这个障碍的:在web浏览器中显示HEIC或HEIF图像。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi na"><img src="../Images/df2e6a12bbcdbf60a365a82f60a553e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YoPC7H75-eVkZWNv"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">照片由<a class="ae mh" href="https://unsplash.com/@vmxhu?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Szabo Viktor </a>在<a class="ae mh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="ee39" class="nb nc it bd nd ne nf ng nh ni nj nk nl ki nm kj nn kl no km np ko nq kp nr ns bi translated">行动计划</h1><h2 id="2569" class="nt nc it bd nd nu nv dn nh nw nx dp nl la ny nz nn le oa ob np li oc od nr iz bi translated">处理步骤</h2><p id="3c1f" class="pw-post-body-paragraph kr ks it kt b ku oe kd kw kx of kg kz la og lc ld le oh lg lh li oi lk ll lm im bi translated">由于HTML5不支持这些扩展名，所以现有的唯一选项是文件转换。因此，以下是要遵循的步骤:</p><ul class=""><li id="b8af" class="oj ok it kt b ku kv kx ky la ol le om li on lm oo op oq or bi translated">将运行中的文件转换成<code class="fe ln lo lp lq b">Buffer</code></li><li id="a07d" class="oj ok it kt b ku os kx ot la ou le ov li ow lm oo op oq or bi translated">将<code class="fe ln lo lp lq b">Buffer</code>解析成一个Base64字符串</li><li id="c61f" class="oj ok it kt b ku os kx ot la ou le ov li ow lm oo op oq or bi translated">向<code class="fe ln lo lp lq b">img</code>标签提供输出</li></ul><h2 id="86ea" class="nt nc it bd nd nu nv dn nh nw nx dp nl la ny nz nn le oa ob np li oc od nr iz bi translated">选择转换库</h2><p id="de85" class="pw-post-body-paragraph kr ks it kt b ku oe kd kw kx of kg kz la og lc ld le oh lg lh li oi lk ll lm im bi translated">为了转换图像，我首先尝试了Alex Corvi的heic2any库。</p><div class="mi mj gp gr mk ml"><a href="https://github.com/alexcorvi/heic2any" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">alexcorvi/heic2any</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">在浏览器中将HEIF/HEIF图像格式转换为PNG/GIF/JPEG</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">github.com</p></div></div><div class="mu l"><div class="ox l mw mx my mu mz mb ml"/></div></div></a></div><p id="0e34" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">但是，我得到了问题<code class="fe ln lo lp lq b">Could not parse HEIF file</code>。即使我尝试了各种配置选项，我也无法转换文件。</p><p id="0f73" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">这就是为什么我跳到了第二个现存的库:<code class="fe ln lo lp lq b">heic-convert</code>并且成功了！</p><div class="mi mj gp gr mk ml"><a href="https://github.com/catdad-experiments/heic-convert#readme" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">cat dad-实验/heic-转换</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">将HEIC/HEIF图像转换为JPEG和PNG将HEIC中的主图像转换为JPEG将HEIC中的主图像转换为…</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">github.com</p></div></div><div class="mu l"><div class="oy l mw mx my mu mz mb ml"/></div></div></a></div><p id="dd0c" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">让我们在实践中看看这个库！</p></div><div class="ab cl oz pa hx pb" role="separator"><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe"/></div><div class="im in io ip iq"><h1 id="e941" class="nb nc it bd nd ne pg ng nh ni ph nk nl ki pi kj nn kl pj km np ko pk kp nr ns bi translated">实践</h1><p id="4703" class="pw-post-body-paragraph kr ks it kt b ku oe kd kw kx of kg kz la og lc ld le oh lg lh li oi lk ll lm im bi translated">作为先决条件，将包添加到您的项目中，这要归功于:</p><pre class="ls lt lu lv gt pl lq pm pn aw po bi"><span id="65b2" class="nt nc it lq b gy pp pq l pr ps">npm install --save heic-convert</span><span id="050d" class="nt nc it lq b gy pt pq l pr ps"># OR</span><span id="92c5" class="nt nc it lq b gy pt pq l pr ps">yarn add -D heic-convert</span></pre><div class="mi mj gp gr mk ml"><a href="https://www.npmjs.com/package/heic-convert" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">高度转换</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">将HEIC/HEIF图像转换为JPEG和PNG将HEIC中的主图像转换为JPEG将HEIC中的主图像转换为…</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">www.npmjs.com</p></div></div><div class="mu l"><div class="pu l mw mx my mu mz mb ml"/></div></div></a></div><h2 id="4168" class="nt nc it bd nd nu nv dn nh nw nx dp nl la ny nz nn le oa ob np li oc od nr iz bi translated">1 —转换为缓冲</h2><figure class="ls lt lu lv gt lw"><div class="bz fp l di"><div class="pv pw l"/></div></figure><p id="8e15" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">第一个语句是通过使用<code class="fe ln lo lp lq b">fetch</code>方法的<a class="ae mh" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" rel="noopener ugc nofollow" target="_blank">获取API </a>来检索文件。</p><p id="331a" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">然后，我用<code class="fe ln lo lp lq b">arrayBuffer</code>函数将文件内容转换成一个<code class="fe ln lo lp lq b">Buffer</code>。该缓冲区将作为转换库提供的<code class="fe ln lo lp lq b">heicConvert</code>转换方法的输入。</p><blockquote class="px py pz"><p id="e04c" class="kr ks qa kt b ku kv kd kw kx ky kg kz qb lb lc ld qc lf lg lh qd lj lk ll lm im bi translated">有关转换器配置的更多详细信息，您可以在此处阅读文档<a class="ae mh" href="https://github.com/catdad-experiments/heic-convert#readme" rel="noopener ugc nofollow" target="_blank"/>。</p></blockquote><p id="69c1" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">由于我们处理的是承诺(包裹退回)，所以有必要在适当的地方加上<code class="fe ln lo lp lq b">async</code>、<code class="fe ln lo lp lq b">await</code>关键词。</p><h2 id="a6f5" class="nt nc it bd nd nu nv dn nh nw nx dp nl la ny nz nn le oa ob np li oc od nr iz bi translated">2 —转换为Base64</h2><p id="e752" class="pw-post-body-paragraph kr ks it kt b ku oe kd kw kx of kg kz la og lc ld le oh lg lh li oi lk ll lm im bi translated">目前，<code class="fe ln lo lp lq b">output</code>变量存储一个有符号整数数组。这对于输入一个<code class="fe ln lo lp lq b">img</code>标签的源来说是不方便的。这就是为什么，必须将其转换为Base64字符串。</p><p id="67e7" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">为此，<code class="fe ln lo lp lq b"><a class="ae mh" href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/btoa" rel="noopener ugc nofollow" target="_blank">btoa</a></code> <a class="ae mh" href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/btoa" rel="noopener ugc nofollow" target="_blank">浏览器API </a>函数将非常方便地实现这种转换:</p><figure class="ls lt lu lv gt lw"><div class="bz fp l di"><div class="pv pw l"/></div></figure><h2 id="9fe4" class="nt nc it bd nd nu nv dn nh nw nx dp nl la ny nz nn le oa ob np li oc od nr iz bi translated">3-编码到图像标签</h2><p id="a599" class="pw-post-body-paragraph kr ks it kt b ku oe kd kw kx of kg kz la og lc ld le oh lg lh li oi lk ll lm im bi translated">因为我得到了一个Base64图像字符串，所以我只需要将它提供给我的图像标记。有必要添加一个前缀，以便浏览器能够处理它。</p><figure class="ls lt lu lv gt lw"><div class="bz fp l di"><div class="pv pw l"/></div></figure></div><div class="ab cl oz pa hx pb" role="separator"><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe"/></div><div class="im in io ip iq"><h1 id="7609" class="nb nc it bd nd ne pg ng nh ni ph nk nl ki pi kj nn kl pj km np ko pk kp nr ns bi translated">把所有的放在一起</h1><p id="4850" class="pw-post-body-paragraph kr ks it kt b ku oe kd kw kx of kg kz la og lc ld le oh lg lh li oi lk ll lm im bi translated">最后，我们到了:从指向HEIC图像的<code class="fe ln lo lp lq b">url</code>到用<code class="fe ln lo lp lq b">img</code>在HTML5中处理的东西。</p><figure class="ls lt lu lv gt lw"><div class="bz fp l di"><div class="pv pw l"/></div></figure></div><div class="ab cl oz pa hx pb" role="separator"><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe"/></div><div class="im in io ip iq"><h1 id="79da" class="nb nc it bd nd ne pg ng nh ni ph nk nl ki pi kj nn kl pj km np ko pk kp nr ns bi translated">走得更远</h1><p id="09e3" class="pw-post-body-paragraph kr ks it kt b ku oe kd kw kx of kg kz la og lc ld le oh lg lh li oi lk ll lm im bi translated">根据图像的特征(尺寸、质量)，转换可能需要几秒钟。我建议您:</p><ul class=""><li id="baec" class="oj ok it kt b ku kv kx ky la ol le om li on lm oo op oq or bi translated">一边转换一边放一个加载器(当然！)</li><li id="332f" class="oj ok it kt b ku os kx ot la ou le ov li ow lm oo op oq or bi translated">使用<a class="ae mh" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map" rel="noopener ugc nofollow" target="_blank">映射</a>将转换的输出保存在内存中(您可以使用文件名作为映射键)</li></ul></div><div class="ab cl oz pa hx pb" role="separator"><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe"/></div><div class="im in io ip iq"><h1 id="b93a" class="nb nc it bd nd ne pg ng nh ni ph nk nl ki pi kj nn kl pj km np ko pk kp nr ns bi translated">结束想法</h1><p id="7763" class="pw-post-body-paragraph kr ks it kt b ku oe kd kw kx of kg kz la og lc ld le oh lg lh li oi lk ll lm im bi translated">事实上，处理HEIC格式并不复杂。在将图像显示成合适的HTML5标签之前，只需要几个转换步骤。</p><p id="c610" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">另一个可行的解决方案可能是在用户必须上传图像时实现这个代码。或者甚至在后端处理转换。无论如何，有了十几行代码，我们就可以在浏览器中管理它了！</p><p id="05c2" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">参考文献</strong></p><div class="mi mj gp gr mk ml"><a href="https://caniuse.com/heif" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">我能用吗...HEIC/HEIF—html 5、CSS3等的支持表</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">“我可以使用吗”提供了最新的浏览器支持表，以支持桌面和移动设备上的前端web技术…</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">caniuse.com</p></div></div></div></a></div><div class="mi mj gp gr mk ml"><a href="https://en.wikipedia.org/wiki/High_Efficiency_Image_File_Format" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">高效图像文件格式</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">比较JPEG，JPEG 2000，JPEG XR和HEIF文件在类似的文件大小文件扩展名。嘿，嘿。heifs。heic…</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">en.wikipedia.org</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz mb ml"/></div></div></a></div><div class="mi mj gp gr mk ml"><a href="https://github.com/alexcorvi/heic2any" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">alexcorvi/heic2any</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">在浏览器中将HEIF/HEIF图像格式转换为PNG/GIF/JPEG</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">github.com</p></div></div><div class="mu l"><div class="ox l mw mx my mu mz mb ml"/></div></div></a></div><div class="mi mj gp gr mk ml"><a href="https://www.npmjs.com/package/heic-convert" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">高度转换</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">将HEIC/HEIF图像转换为JPEG和PNG将HEIC中的主图像转换为JPEG将HEIC中的主图像转换为…</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">www.npmjs.com</p></div></div><div class="mu l"><div class="pu l mw mx my mu mz mb ml"/></div></div></a></div></div></div>    
</body>
</html>