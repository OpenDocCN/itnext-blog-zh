<html>
<head>
<title>AWS CDK + AutoScale + Lifecycle Hooks + Lambda + SSM =💪</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS CDK +自动缩放+生命周期挂钩+λ+SSM =💪</h1>
<blockquote>原文：<a href="https://itnext.io/aws-cdk-autoscale-lifecycle-hooks-lambda-ssm-531093db89a7?source=collection_archive---------3-----------------------#2022-07-06">https://itnext.io/aws-cdk-autoscale-lifecycle-hooks-lambda-ssm-531093db89a7?source=collection_archive---------3-----------------------#2022-07-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a1ca44791af847ce26c4139c25e8d85b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Aax4gwhT0dAQrgZ6"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kc" href="https://unsplash.com/@dpascoa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Daniel Páscoa </a>拍照</figcaption></figure><p id="37b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Kubernetes有时太重或太贵，无法解决所有问题，或者对于开发团队来说是一个太大的“提升和转移”解决方案。但是，当解决方案迁移到云并经常遇到工作负载增加时，由于成本或利用率的原因，解决方案仍然需要能够动态扩展。并非每个应用程序或解决方案都能自动或轻松地横向扩展。有些情况下，当解决方案的某个组件扩大或缩小时，需要采取措施；例如，如果worker组件向上或向下扩展，您可能需要通过配置更新让控制节点知道这些变化。</p><p id="d367" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们来看看Amazon Web Services上的一种方法，在这种方法中，自动伸缩组(ASG)可以使用生命周期挂钩来触发实例启动或终止期间的操作。在此细分中，我们将利用AWS简单通知服务(SNS ),它将提供与ASG生命周期相关的消息AWS Lambda，其中无服务器功能将监听SNS生命周期主题，以便对更改做出反应AWS Systems Manager，它将用于调用目标端点上的shell命令，以便显示这些挂钩如何影响各种系统上的更改。一个重要的注意事项是，系统管理器代理(SMS)默认情况下只安装在Amazon Linux镜像上。您可能需要更新您的Amazon机器镜像，以包括<a class="ae kc" href="https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-manual-agent-install.html" rel="noopener ugc nofollow" target="_blank">该项目的安装和设置</a>。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="2365" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们浏览这些概念时，我们将看到的示例存储库利用了亚马逊云开发工具包(CDK)。CDK允许您使用许多流行的代码语言中的一种，以便定义可用于可重复部署的云形成模板。这个基本示例设置了一个VPC和一个自动缩放组。</p><h2 id="c270" class="li lj iq bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">循序渐进</h2><p id="faee" class="pw-post-body-paragraph kd ke iq kf b kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw mf ky kz la ij bi translated">让我们来看一个基于CDK的示例项目，它将:<br/> 1。创建虚拟专用网络(VPC)</p><p id="f292" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2.创建自动缩放组</p><p id="36ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3.创建社交网络话题</p><p id="336a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">4.注册Lambda函数并订阅SNS主题</p><p id="f8b4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">5.创建Lambda函数</p><p id="28d5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以下示例GitHub存储库中包含了这五个不同的项目:</p><div class="mg mh gp gr mi mj"><a href="https://github.com/chambridge/cdk-autoscale-lambda-ssm-action" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd ir gy z fp mo fr fs mp fu fw ip bi translated">GitHub-cham bridge/CDK-auto scale-lambda-SSM-action:这个示例项目展示了一个AWS CDK部署…</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">该示例项目展示了一个自动缩放组的AWS CDK部署，该自动缩放组具有一个将触发Lambda…</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">github.com</p></div></div><div class="ms l"><div class="mt l mu mv mw ms mx jw mj"/></div></div></a></div><h2 id="7578" class="li lj iq bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">创造一个VPC</h2><p id="f46d" class="pw-post-body-paragraph kd ke iq kf b kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw mf ky kz la ij bi translated">有许多VPC基本设置的例子。我们将把注意力集中在<code class="fe my mz na nb b">net.py</code>文件上。下面您可以看到一个简单的虚拟专用网络的创建。</p><figure class="nc nd ne nf gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="7d94" class="li lj iq bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">创建自动缩放组</h2><p id="1d4f" class="pw-post-body-paragraph kd ke iq kf b kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw mf ky kz la ij bi translated">下一段代码<code class="fe my mz na nb b">systems.py</code>提供了一个示例autoscale组，我们将使用它来跟踪生命周期的变化，以实现自动化。</p><figure class="nc nd ne nf gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="b0d4" class="li lj iq bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">创建社交网络话题</h2><p id="4685" class="pw-post-body-paragraph kd ke iq kf b kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw mf ky kz la ij bi translated">现在我们有了自动缩放组，我们可以创建SNS主题，并让它侦听来自自动缩放组的生命周期事件。</p><figure class="nc nd ne nf gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="6968" class="li lj iq bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">注册一个Lambda函数并订阅SNS主题</h2><p id="f20d" class="pw-post-body-paragraph kd ke iq kf b kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw mf ky kz la ij bi translated">有了SNS主题，我们可以定义一个Lambda函数来监听自动缩放组生命周期事件发出的通知。</p><figure class="nc nd ne nf gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="7e3d" class="li lj iq bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">Lambda函数背后的代码</h2><p id="2a53" class="pw-post-body-paragraph kd ke iq kf b kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw mf ky kz la ij bi translated">让我们也看看Lambda函数的代码是什么样子的。在这种情况下，我们将使用Systems Manager API进行一个简单的调用，将一个文件写入文件系统，但是根据您的具体使用情况，您可以进行许多更复杂的更改。</p><figure class="nc nd ne nf gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="3ba2" class="ni lj iq bd lk nj nk nl ln nm nn no lq np nq nr lt ns nt nu lw nv nw nx lz ny bi translated">摘要</h1><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/d8066ba852029560947b87913baf2e11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0c5QbBf-H3PkmRcE"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">由<a class="ae kc" href="https://unsplash.com/@spongzy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卡尔·阿布伊德</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="5f96" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了上面描述的方法，您就有了一套强大的工具来构建一个动态的、反应式的部署。您可以利用更多云原生功能的优势，减轻现有解决方案的重量，减少对现有解决方案的重新设计。我们已经通过基础设施即代码实现了所有这些步骤，利用了CDK的力量，并简单地在一些额外的AWS服务上进行分层，从而开放了一系列功能。</p></div></div>    
</body>
</html>